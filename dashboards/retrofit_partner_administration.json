{
  "title": "Retrofit Partner Administration",
  "image": "tb-image;/api/images/tenant/belimo_retrofit_plus_padding.png",
  "mobileHide": false,
  "mobileOrder": 2,
  "configuration": {
    "description": "",
    "widgets": {
      "777ded27-e3b8-d901-ca42-3079a23f7a12": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "Retrofit Partner",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": true,
            "entityNameColumnTitle": "Name",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Retrofit companies",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "04917190-aea7-e407-e308-4598f1671a71",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "70%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.1345774127559587,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ]
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Manage Doktorkits",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Doktorkits",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "Manage gateways",
                "icon": "router",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "gateways",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2bb38f25-6b60-0a00-6ef8-8b8656ac8d0d"
              },
              {
                "name": "Manage devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "devices",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1ff495e4-f4af-3172-63c3-14c96faf3307"
              },
              {
                "name": "Manage Doktorkits",
                "icon": "medical_services",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Doktorkits",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "ef986bd4-8ab7-fde5-79e7-52b3bb257474"
              },
              {
                "name": "Manage Sensorkits",
                "icon": "sensors",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Sensorkits",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "8f70f993-9679-9464-4a74-09ec6d0db30f"
              },
              {
                "name": "Manage users",
                "icon": "people",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "b47615c0-bfa9-11ee-8196-b3999b4a11b6",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "347536c1-e013-249a-c93e-acc1706de1bb"
              },
              {
                "name": "Manage Payments",
                "icon": "payments",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "payments",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9d971af7-9656-5839-b6cd-7fdc468c262c"
              },
              {
                "name": "Edit Partner",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"editPartnerFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Edit Partner</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n      <mat-form-field fxFlex class=\"mat-block\">\n        <mat-label>Partner title</mat-label>\n        <input matInput formControlName=\"title\" required>\n        <mat-error *ngIf=\"editPartnerFormGroup.get('title').hasError('required')\">\n          Partner title is required.\n        </mat-error>\n        <mat-error *ngIf=\"editPartnerFormGroup.get('title').hasError('maxlength')\">\n          {{ 'customer.title-max-length' | translate }}\n        </mat-error>\n      </mat-form-field>\n      <tb-contact [parentForm]=\"editPartnerFormGroup\" [isEdit]=\"true\"></tb-contact>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editPartnerFormGroup.invalid || !editPartnerFormGroup.dirty\">\n      Save Partner\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "const POSTAL_CODE_PATTERNS = {\n  'United States': '(\\\\d{5}([\\\\-]\\\\d{4})?)',\n  'Australia': '[0-9]{4}',\n  'Austria': '[0-9]{4}',\n  'Belgium': '[0-9]{4}',\n  'Brazil': '[0-9]{5}[\\\\-]?[0-9]{3}',\n  'Canada': '^(?!.*[DFIOQU])[A-VXY][0-9][A-Z][ -]?[0-9][A-Z][0-9]$',\n  'Denmark': '[0-9]{3,4}',\n  'Faroe Islands': '[0-9]{3,4}',\n  'Netherlands': '[1-9][0-9]{3}\\\\s?[a-zA-Z]{2}',\n  'Germany': '[0-9]{5}',\n  'Hungary': '[0-9]{4}',\n  'Italy': '[0-9]{5}',\n  'Japan': '\\\\d{3}-\\\\d{4}',\n  'Luxembourg': '(L\\\\s*(-|—|–))\\\\s*?[\\\\d]{4}',\n  'Poland': '[0-9]{2}\\\\-[0-9]{3}',\n  'Spain': '((0[1-9]|5[0-2])|[1-4][0-9])[0-9]{3}',\n  'Sweden': '\\\\d{3}\\\\s?\\\\d{2}',\n  'United Kingdom': '[A-Za-z]{1,2}[0-9Rr][0-9A-Za-z]? [0-9][ABD-HJLNP-UW-Zabd-hjlnp-uw-z]{2}'\n};\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenEditPartnerDialog();\n\nfunction openEditPartnerDialog() {\n  customDialog.customDialog(htmlTemplate, EditPartnerDialogController).subscribe();\n}\n\nfunction EditPartnerDialogController(instance) {\n  let vm = instance;\n  \n  vm.customer = {};\n\n  vm.editPartnerFormGroup = vm.fb.group({\n    title: ['', [vm.validators.required, vm.validators.maxLength(255)]]\n  });\n  \n  vm.editPartnerFormGroup.addControl('country', vm.fb.control('', []));\n  vm.editPartnerFormGroup.addControl('city', vm.fb.control('', []));\n  vm.editPartnerFormGroup.addControl('state', vm.fb.control('', []));\n  vm.editPartnerFormGroup.addControl('zip', vm.fb.control('',\n      zipValidators('')\n  ));\n  vm.editPartnerFormGroup.addControl('address', vm.fb.control('', []));\n  vm.editPartnerFormGroup.addControl('address2', vm.fb.control('', []));\n  vm.editPartnerFormGroup.addControl('phone', vm.fb.control('', []));\n  vm.editPartnerFormGroup.addControl('email', vm.fb.control('', [vm.validators.email]));\n  \n  \n  vm.editPartnerFormGroup.get('country').valueChanges.subscribe(\n      (country) => {\n        vm.editPartnerFormGroup.get('zip').setValidators(zipValidators(country));\n        vm.editPartnerFormGroup.get('zip').updateValueAndValidity({onlySelf: true});\n        vm.editPartnerFormGroup.get('zip').markAsTouched({onlySelf: true});\n      }\n  );\n  \n  getPartner();\n\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    vm.editPartnerFormGroup.markAsPristine();\n    savePartnerObservable().subscribe(\n      function (customer) {\n          widgetContext.rxjs.forkJoin([\n              saveAttributes(customer)\n          ]).subscribe(\n              function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n  \n  function getPartner() {\n      customerService.getCustomer(entityId.id).subscribe(\n          (customer) => {\n                vm.customer = customer;          \n                vm.editPartnerFormGroup.patchValue({\n                  title: vm.customer.title,\n                  country: vm.customer.country,\n                  city: vm.customer.city,\n                  state: vm.customer.state,\n                  zip: vm.customer.zip,\n                  address: vm.customer.address,\n                  address2: vm.customer.address2,\n                  phone: vm.customer.phone,\n                  email: vm.customer.email\n                }, {emitEvent: false});\n                vm.editPartnerFormGroup.get('zip').setValidators(zipValidators(vm.customer.country));\n                vm.editPartnerFormGroup.get('zip').updateValueAndValidity({onlySelf: true});\n          }\n    );\n  }\n  \n  function zipValidators(country) {\n    const zipValidators = [];\n    if (country && POSTAL_CODE_PATTERNS[country]) {\n      const postalCodePattern = POSTAL_CODE_PATTERNS[country];\n      zipValidators.push(vm.validators.pattern(postalCodePattern));\n    }\n    return zipValidators;\n  }\n\n  function savePartnerObservable() {\n      const formValues = vm.editPartnerFormGroup.value;\n      vm.customer.title = formValues.title;\n      vm.customer.country = formValues.country;\n      vm.customer.city = formValues.city;\n      vm.customer.state = formValues.state;\n      vm.customer.zip = formValues.zip;\n      vm.customer.address = formValues.address;\n      vm.customer.address2 = formValues.address2;\n      vm.customer.phone = formValues.phone;\n      vm.customer.email = formValues.email;\n      return customerService.saveCustomer(vm.customer);\n  }\n  \n  function saveAttributes(customer) {\n    let attributesArray = [\n        {\n            key: 'type',\n            value: 'retail'\n        },\n        {\n            key: 'address',\n            value: getAddressValue(customer)\n        }\n    ];\n    return attributeService.saveEntityAttributes(customer.id, \"SERVER_SCOPE\", attributesArray);\n  }\n  \n  function getAddressValue(customer) {\n      var address = '';\n      if (customer.address) {\n          address += customer.address;\n      }\n      if (customer.address2) {\n          address += (address ? ', ' : '') + customer.address2;\n      }\n      if (customer.city) {\n          address += (address ? ', ' : '') + customer.city;\n      }\n      if (customer.state) {\n          address += (address ? ', ' : '') + customer.state;\n      }\n      if (customer.zip) {\n          address += (customer.state ? ' ' : (address ? ', ' : '')) + customer.zip;\n      }\n      if (customer.country) {\n          address += (address ? ', ' : '') + customer.country;\n      }\n      return address;\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "449af9be-1767-a18a-2e1b-cfba5b6ee674"
              },
              {
                "name": "Delete Partner",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\n\nopenDeleteCustomerDialog();\n\nfunction openDeleteCustomerDialog() {\n  var title = 'Are you sure you want to delete the Partner ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the Partner and all related data will become unrecoverable!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteCustomer();\n      }\n    }\n  );\n}\n\nfunction deleteCustomer() {\n  customerService.deleteCustomer(entityId.id).subscribe(\n    function() {\n      widgetContext.updateAliases();\n    }\n  );\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b8747e47-5bc7-db5a-8f81-816c24eec09a"
              }
            ],
            "headerButton": [
              {
                "name": "Add Partner",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addPartnerFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Add Partner</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n      <mat-form-field fxFlex class=\"mat-block\">\n        <mat-label>Partner title</mat-label>\n        <input matInput formControlName=\"title\" required>\n        <mat-error *ngIf=\"addPartnerFormGroup.get('title').hasError('required')\">\n          Partner title is required.\n        </mat-error>\n        <mat-error *ngIf=\"addPartnerFormGroup.get('title').hasError('maxlength')\">\n          {{ 'customer.title-max-length' | translate }}\n        </mat-error>\n      </mat-form-field>\n      <tb-contact [parentForm]=\"addPartnerFormGroup\" [isEdit]=\"true\"></tb-contact>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addPartnerFormGroup.invalid || !addPartnerFormGroup.dirty\">\n      Add Partner\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "const POSTAL_CODE_PATTERNS = {\n  'United States': '(\\\\d{5}([\\\\-]\\\\d{4})?)',\n  'Australia': '[0-9]{4}',\n  'Austria': '[0-9]{4}',\n  'Belgium': '[0-9]{4}',\n  'Brazil': '[0-9]{5}[\\\\-]?[0-9]{3}',\n  'Canada': '^(?!.*[DFIOQU])[A-VXY][0-9][A-Z][ -]?[0-9][A-Z][0-9]$',\n  'Denmark': '[0-9]{3,4}',\n  'Faroe Islands': '[0-9]{3,4}',\n  'Netherlands': '[1-9][0-9]{3}\\\\s?[a-zA-Z]{2}',\n  'Germany': '[0-9]{5}',\n  'Hungary': '[0-9]{4}',\n  'Italy': '[0-9]{5}',\n  'Japan': '\\\\d{3}-\\\\d{4}',\n  'Luxembourg': '(L\\\\s*(-|—|–))\\\\s*?[\\\\d]{4}',\n  'Poland': '[0-9]{2}\\\\-[0-9]{3}',\n  'Spain': '((0[1-9]|5[0-2])|[1-4][0-9])[0-9]{3}',\n  'Sweden': '\\\\d{3}\\\\s?\\\\d{2}',\n  'United Kingdom': '[A-Za-z]{1,2}[0-9Rr][0-9A-Za-z]? [0-9][ABD-HJLNP-UW-Zabd-hjlnp-uw-z]{2}'\n};\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet roleService = $injector.get(widgetContext.servicesMap.get('roleService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenAddPartnerDialog();\n\nfunction openAddPartnerDialog() {\n  customDialog.customDialog(htmlTemplate, AddPartnerDialogController).subscribe();\n}\n\nfunction AddPartnerDialogController(instance) {\n  let vm = instance;\n\n  vm.addPartnerFormGroup = vm.fb.group({\n    title: ['', [vm.validators.required, vm.validators.maxLength(255)]]\n  });\n  \n  vm.addPartnerFormGroup.addControl('country', vm.fb.control('', []));\n  vm.addPartnerFormGroup.addControl('city', vm.fb.control('', []));\n  vm.addPartnerFormGroup.addControl('state', vm.fb.control('', []));\n  vm.addPartnerFormGroup.addControl('zip', vm.fb.control('',\n      zipValidators('')\n  ));\n  vm.addPartnerFormGroup.addControl('address', vm.fb.control('', []));\n  vm.addPartnerFormGroup.addControl('address2', vm.fb.control('', []));\n  vm.addPartnerFormGroup.addControl('phone', vm.fb.control('', []));\n  vm.addPartnerFormGroup.addControl('email', vm.fb.control('', [vm.validators.email]));\n  \n  \n  vm.addPartnerFormGroup.get('country').valueChanges.subscribe(\n      (country) => {\n        vm.addPartnerFormGroup.get('zip').setValidators(zipValidators(country));\n        vm.addPartnerFormGroup.get('zip').updateValueAndValidity({onlySelf: true});\n        vm.addPartnerFormGroup.get('zip').markAsTouched({onlySelf: true});\n      }\n  );\n\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    vm.addPartnerFormGroup.markAsPristine();\n    savePartnerObservable().subscribe(\n      function (customer) {\n          widgetContext.rxjs.forkJoin([\n              saveAttributes(customer),\n              saveUserGroups(customer.id)\n          ]).subscribe(\n              function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n  \n  function zipValidators(country) {\n    const zipValidators = [];\n    if (country && POSTAL_CODE_PATTERNS[country]) {\n      const postalCodePattern = POSTAL_CODE_PATTERNS[country];\n      zipValidators.push(vm.validators.pattern(postalCodePattern));\n    }\n    return zipValidators;\n  }\n\n  function savePartnerObservable() {\n      return getOrCreateSmartRetailCustomerGroup().pipe(\n          widgetContext.rxjs.switchMap((smartRetail) => {\n              const formValues = vm.addPartnerFormGroup.value;\n              let customer = {\n                  title: formValues.title,\n                  country: formValues.country,\n                  city: formValues.city,\n                  state: formValues.state,\n                  zip: formValues.zip,\n                  address: formValues.address,\n                  address2: formValues.address2,\n                  phone: formValues.phone,\n                  email: formValues.email\n              };\n              return customerService.saveCustomer(customer, smartRetail.id.id);\n          })\n      );\n  }\n  \n  function getOrCreateSmartRetailCustomerGroup() {\n      return getEntityGroupByName(\"Belimo Retrofit\", \"CUSTOMER\").pipe(\n          widgetContext.rxjs.switchMap((group) => {\n              if (group) {\n                  return widgetContext.rxjs.of(group);\n              } else {\n                  var smartRetail = {\n                    type: 'CUSTOMER',\n                    name: 'Belimo Retrofit'\n                  };\n                  return entityGroupService.saveEntityGroup(smartRetail);\n              }\n          })\n      );\n  }\n  \n  function saveUserGroups(customerId) {\n      \n      return widgetContext.rxjs.forkJoin([\n         getRoleByName(\"Belimo Retrofit Read Only\", \"GROUP\"),\n         getRoleByName(\"Belimo Retrofit User\", \"GENERIC\"),\n         getRoleByName(\"Belimo Retrofit Administrator\", \"GENERIC\"),\n         getEntityGroupByName(\"Doktorkit Users Shared\", \"DASHBOARD\"),\n         getEntityGroupByName(\"Doktorkit Administrators Shared\", \"DASHBOARD\")\n      ]).pipe(widgetContext.rxjs.switchMap((data) => {\n          \n            var smartRetailReadOnlyGroupRole = data[0];\n            var smartRetailUserGenericRole = data[1];\n            var smartRetailAdministratorGenericRole = data[2];\n            var smartDoktorkitSharedGroup = data[3];\n            var smartDoktorkitGroup = data[4];\n            \n            var smartRetailUsers = {\n              type: 'USER',\n              name: 'Belimo Retrofit Users',\n              ownerId: customerId\n            };\n            \n            var smartRetailAdministrators = {\n              type: 'USER',\n              name: 'Belimo Retrofit Administrators',\n              ownerId: customerId\n            };\n    \n            return widgetContext.rxjs.forkJoin([\n                entityGroupService.saveEntityGroup(smartRetailUsers),\n                entityGroupService.saveEntityGroup(smartRetailAdministrators)\n            ]).pipe(widgetContext.rxjs.switchMap((data) => {\n                var smartRetailUsersGroup = data[0];\n                var smartRetailAdministratorsGroup = data[1];\n                const tasks = [];\n\n                if (smartRetailReadOnlyGroupRole) {\n                    if (smartDoktorkitSharedGroup) {\n                        let smartDoktorkitSharedGroupPermissionForUsers = {\n                            userGroupId: smartRetailUsersGroup.id,\n                            roleId: smartRetailReadOnlyGroupRole.id,\n                            entityGroupId: smartDoktorkitSharedGroup.id,\n                            entityGroupType: smartDoktorkitSharedGroup.type\n                        };\n                        let smartDoktorkitSharedGroupPermissionForAdmins = {\n                            userGroupId: smartRetailAdministratorsGroup.id,\n                            roleId: smartRetailReadOnlyGroupRole.id,\n                            entityGroupId: smartDoktorkitSharedGroup.id,\n                            entityGroupType: smartDoktorkitSharedGroup.type\n                        };\n                        tasks.push(roleService.saveGroupPermission(smartDoktorkitSharedGroupPermissionForUsers));\n                        tasks.push(roleService.saveGroupPermission(smartDoktorkitSharedGroupPermissionForAdmins));\n                    }\n                    if (smartDoktorkitGroup) {\n                        let smartDoktorkitGroupPermissionForAdmins = {\n                            userGroupId: smartRetailAdministratorsGroup.id,\n                            roleId: smartRetailReadOnlyGroupRole.id,\n                            entityGroupId: smartDoktorkitGroup.id,\n                            entityGroupType: smartDoktorkitGroup.type\n                        };\n                        tasks.push(roleService.saveGroupPermission(smartDoktorkitGroupPermissionForAdmins));\n                    }\n                }\n\n                if (smartRetailUserGenericRole) {\n                    let smartRetailUserGenericPermission = {\n                        userGroupId: smartRetailUsersGroup.id,\n                        roleId: smartRetailUserGenericRole.id\n                    };\n                    tasks.push(roleService.saveGroupPermission(smartRetailUserGenericPermission));\n                }\n\n                if (smartRetailAdministratorGenericRole) {\n                    let smartRetailAdminGenericPermission = {\n                        userGroupId: smartRetailAdministratorsGroup.id,\n                        roleId: smartRetailAdministratorGenericRole.id\n                    };\n                    tasks.push(roleService.saveGroupPermission(smartRetailAdminGenericPermission));\n                }\n                \n                if (tasks.length) {\n                    return widgetContext.rxjs.forkJoin(tasks);\n                } else {\n                    return widgetContext.rxjs.of(null);\n                }\n            }));\n          \n      }));\n      \n  }\n  \n  function getRoleByName(roleName, type) {\n      var rolesPageLink = widgetContext.pageLink(10, 0, roleName);\n      return roleService.getRoles(rolesPageLink, type, {ignoreLoading: true}).pipe(\n          widgetContext.rxjs.map((data) => {\n            if (data.data.length) {\n                return data.data.find((role) => role.name === roleName);\n            } else {\n                return null;\n            }\n          })\n      );\n  }\n  \n  function getEntityGroupByName(groupName, groupType) {\n      var entityGroupsPageLink = widgetContext.pageLink(10, 0, groupName);\n      return entityGroupService.getEntityGroupsByPageLink(entityGroupsPageLink, groupType, {ignoreLoading: true}).pipe(\n          widgetContext.rxjs.map((data) => {\n            if (data.data.length) {\n                return data.data.find((group) => group.name === groupName);\n            } else {\n                return null;\n            }\n          })\n      );\n  }\n  \n  function saveAttributes(customer) {\n    let attributesArray = [\n        {key: 'address', value: getAddressValue(customer)},\n        {key: 'weatherAPIToken', value: '587f1474e94ea6b52e6ce6e99d13d75a'}\n    ];\n    return attributeService.saveEntityAttributes(customer.id, \"SERVER_SCOPE\", attributesArray);\n  }\n  \n  function getAddressValue(customer) {\n      var address = '';\n      if (customer.address) {\n          address += customer.address;\n      }\n      if (customer.address2) {\n          address += (address ? ', ' : '') + customer.address2;\n      }\n      if (customer.city) {\n          address += (address ? ', ' : '') + customer.city;\n      }\n      if (customer.state) {\n          address += (address ? ', ' : '') + customer.state;\n      }\n      if (customer.zip) {\n          address += (customer.state ? ' ' : (address ? ', ' : '')) + customer.zip;\n      }\n      if (customer.country) {\n          address += (address ? ', ' : '') + customer.country;\n      }\n      return address;\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f089248b-5725-30f6-58dd-64e50dfb0496"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "777ded27-e3b8-d901-ca42-3079a23f7a12",
        "typeFullFqn": "system.cards.entities_table"
      },
      "c2559a58-e82d-3250-7e35-f520ced0d916": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div style=\"width: 100%; height: 100%; padding: 0;\">\n   <tb-dashboard-state *ngIf=\"ctx.currentUser.authority === 'TENANT_ADMIN'\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"retail_companies\"></tb-dashboard-state>\n   <tb-dashboard-state *ngIf=\"ctx.currentUser.authority === 'CUSTOMER_USER'\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkits\"></tb-dashboard-state>\n</div>"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "c2559a58-e82d-3250-7e35-f520ced0d916",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "28303a0b-d427-6d9e-0ee1-ae2c3f344769": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": []
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\n    <div fxLayout=\"row\">\n        <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" fxFlex style=\"height: 430px;\" stateId='edit_Doktorkit_alias'></tb-dashboard-state>\n    </div>\n    <div fxLayout=\"row\">\n        <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" fxFlex style=\"height: 200px;\" stateId='edit_Doktorkit_floorplan'></tb-dashboard-state>\n    </div>\n    <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" fxFlex stateId='edit_Doktorkit_location'></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "return '# Some title\\\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "save-title",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#save-title', widgetContext.$container[0]);\n\nvar title = $(targetElement).attr('data-title');\n\nwidgetContext.assetService.getAsset(entityId.id, {ignoreLoading: true}).subscribe((Doktorkit) => {\n    Doktorkit.name = title;\n    widgetContext.assetService.saveAsset(Doktorkit, null, {ignoreLoading: true}).subscribe(() => {\n       var stateParams = widgetContext.stateController.getStateParams();\n       stateParams.selectedDoktorkit.entityName = title;\n       widgetContext.stateController.updateState(null, stateParams);\n       /*if (widgetContext.parentDashboard) {\n           widgetContext.parentDashboard.aliasController.updateAliases();\n       }\n       widgetContext.updateAliases();*/\n    });\n});\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "088a4799-8551-7ab4-892f-2a08d6d40a7c"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "28303a0b-d427-6d9e-0ee1-ae2c3f344769",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "4a524a3c-2b87-903c-6256-47a5df398ba5": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSearch": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "entityName",
            "displayEntityName": true,
            "displayEntityType": false,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "entitiesTitle": "Doktorkits",
            "entityNameColumnTitle": "Name",
            "displayEntityLabel": false,
            "useRowStyleFunction": false
          },
          "title": "Doktorkits",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c348dad-e738-a4db-5e7e-4c0271790ab7",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "70%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.1345774127559587,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "Location Alias",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.7448728411727017,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Select Doktorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedDoktorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "Open Doktorkit devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Doktorkit_devices_table",
                "setEntityId": true,
                "stateEntityParamName": "selectedDoktorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "71c478b6-a4b1-e569-e99a-85d5562cc721"
              },
              {
                "name": "Delete Doktorkit",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteDoktorkitDialog();\n\nfunction openDeleteDoktorkitDialog() {\n  var title = 'Are you sure you want to delete the Doktorkit ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the Doktorkit will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteDoktorkit();\n      }\n    }\n  );\n}\n\nfunction deleteDoktorkit() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteDoktorkitToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Doktorkit Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Doktorkit Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteDoktorkitToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "338d9fd7-c752-eb0e-4687-2c2e32ca1a32"
              }
            ],
            "headerButton": [
              {
                "name": "Add Doktorkit",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDoktorkitFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Add Doktorkit</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n    <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n      <mat-form-field fxFlex class=\"mat-block\">\n        <mat-label>Doktorkit title</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"addDoktorkitFormGroup.get('name').hasError('required')\">\n          Doktorkit title is required.\n        </mat-error>\n      </mat-form-field>\n    </div>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addDoktorkitFormGroup.invalid || !addDoktorkitFormGroup.dirty\">\n      Add Doktorkit\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddDoktorkitDialog();\n\nfunction openAddDoktorkitDialog() {\n  customDialog.customDialog(htmlTemplate, AddDoktorkitDialogController).subscribe();\n}\n\nfunction AddDoktorkitDialogController(instance) {\n  let vm = instance;\n\n  vm.addDoktorkitFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]]\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var customerId;\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n    vm.addDoktorkitFormGroup.markAsPristine();\n    saveDoktorkitObservable(customerId).subscribe(\n      function (Doktorkit) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToDoktorkitRelation(customerId, Doktorkit.id),\n              saveAttributes(Doktorkit.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedDoktorkit = params['selectedDoktorkit'];\n                params['selectedDoktorkit'] = { entityId: Doktorkit.id, entityName: Doktorkit.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveDoktorkitObservable(customerId) {\n    return getDoktorkitsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((DoktorkitsGroup) => {\n            const formValues = vm.addDoktorkitFormGroup.value;\n            let Doktorkit = {\n              name: formValues.name,\n              type: 'Doktorkit',\n              customerId: customerId\n            };\n            return assetService.saveAsset(Doktorkit, DoktorkitsGroup.id.id)\n        })\n    );\n  }\n  \n  function getDoktorkitsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var DoktorkitsGroup = entityGroups.find(group => group.name === 'Doktorkits');\n              if (DoktorkitsGroup) {\n                  return widgetContext.rxjs.of(DoktorkitsGroup);\n              } else {\n                  DoktorkitsGroup = {\n                      type: 'ASSET',\n                      name: 'Doktorkits',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(DoktorkitsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToDoktorkitRelation(customerId, DoktorkitId) {\n      var relation = {\n          from: customerId,\n          to: DoktorkitId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'latitude',\n            value: 48.1406022\n        },\n        {\n            key: 'longitude',\n            value: 16.2932688\n        },\n        {\n            key: 'address',\n            value: 'N/A'\n        },\n        {\n            key: 'state',\n            value: 'normal'\n        },\n        {\n            key: 'units',\n            value: 'metric'\n        },\n        {\n            key: 'floorplan',\n            value: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K'\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e965b8a1-a6ac-5ae4-fd79-2b7220b91ed1"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "4a524a3c-2b87-903c-6256-47a5df398ba5",
        "typeFullFqn": "system.cards.entities_table"
      },
      "ab845ee8-ff10-b684-3652-cb49e2d9acbe": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\n    <section *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex fxLayout=\"column\">\n\t<h5 class=\"market-title\">{{ ctx.stateController.getStateParams().selectedDoktorkit.entityName }}</h5>\n\t<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_card\"></tb-dashboard-state>\n    </section>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" stateId=\"Doktorkits_card\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>\n    <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkit_alarms\"></tb-dashboard-state>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"false\" stateId=\"Doktorkits_alarms\"></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "var DoktorkitState;\r\nif (data && data.length && data[0]['entityId']) {\r\n    DoktorkitState = true;\r\n} else {\r\n    DoktorkitState = false;\r\n}\r\n\r\nvar typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-480q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v480q0 33-23.5 56.5T800-80H160Zm240-640h160v-80H400v80Zm40 360v120h80v-120h120v-80H520v-120h-80v120H320v80h120Z\"/></svg>';\r\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\r\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\r\n\r\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\r\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\r\n                   '<div class=\"title\">Edit Doktorkit: {{ ctx.stateController.getStateParams().selectedDoktorkit?.entityName }}</div>' +\r\n                '</div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"start\"><button id=\"Doktorkit-devices\" type=\"button\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">devices_other</mat-icon><span>Doktorkit devices</span></button></div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"start\"><button id=\"get-location\" type=\"button\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">location_on</mat-icon></button></div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"start\" style=\"padding-right: 24px;\"><button id=\"delete-Doktorkit\" type=\"button\" mat-raised-button color=\"accent\"><mat-icon class=\"tb-mat-20\">delete</mat-icon><span>Delete</span></button></div>' +\r\n             '</div>';\r\n             \r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n          (DoktorkitState \r\n            ? (header +\r\n               '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"edit_Doktorkit_card\"></tb-dashboard-state>') \r\n            : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkits_card\"></tb-dashboard-state>') +\r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 12px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedDoktorkit'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              },
              {
                "name": "Doktorkit-devices",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Doktorkit_devices_table",
                "setEntityId": true,
                "stateEntityParamName": "selectedDoktorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f921410a-47b7-5884-1c63-d010a39064a4"
              },
              {
                "name": "delete-Doktorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteDoktorkitDialog();\n\nfunction openDeleteDoktorkitDialog() {\n  var title = 'Are you sure you want to delete the Doktorkit ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the Doktorkit will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteDoktorkit();\n      }\n    }\n  );\n}\n\nfunction deleteDoktorkit() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteDoktorkitToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Doktorkit Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Doktorkit Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteDoktorkitToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1af63269-0a95-b82e-0703-86bd8daf9356"
              },
              {
                "name": "get-location",
                "icon": "location_on",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "mobileAction",
                "mobileAction": {
                  "type": "getLocation",
                  "handleEmptyResultFunction": "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Get location action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert('Empty result', message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction": "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to get phone location', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processLocationFunction": "// Function body to process current location of the phone. \n// - latitude - phone location latitude\n// - longitude - phone location longitude\nlet $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\n//showLocationDialog('Location', latitude, longitude);\nsaveEntityLocationAttributes('latitude', 'longitude', latitude, longitude);\nfunction getSelectedKitId() {\n    let stateParams = widgetContext.stateController.getStateParams();\n    return stateParams.selectedDoktorkit.entityId;\n}\n\nfunction saveEntityLocationAttributes(latitudeAttributeName, longitudeAttributeName, latitude, longitude) {\n    let entityId = getSelectedKitId();\n    if (entityId) {\n        let attributes = [\n            { key: \"latitude\", value: latitude },\n            { key: \"longitude\", value: longitude }\n        ];\n        attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributes).subscribe(\n        widgetContext.dialogs.alert('Location attributes saved!\\nLatitude: ' + latitude + '\\nLongitude: ' + longitude),\n           function() {\n               widgetContext.showSuccessToast('Location attributes saved!');\n           },\n           function(error) {\n               widgetContext.dialogs.alert('Location attributes save failed', JSON.stringify(error));\n           }\n        );\n    }\n}\n\n\nfunction showLocationDialog(title, latitude, longitude) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Latitude: '+latitude+'<br>Longitude: ' + longitude).subscribe();\n    }, 100);\n}"
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "94c2e448-3356-0d9d-d976-d11a0ac2165c"
              }
            ],
            "headerButton": []
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "ab845ee8-ff10-b684-3652-cb49e2d9acbe",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "980bd0c3-44e9-a1f9-c8f9-3dc533011fde": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7546586070710162
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showResultMessage": false,
            "showLabel": true,
            "isRequired": true,
            "labelValue": "Address",
            "requiredErrorMessage": "Address is required"
          },
          "title": "New Update server string attribute",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "980bd0c3-44e9-a1f9-c8f9-3dc533011fde",
        "typeFullFqn": "system.input_widgets.update_server_string_attribute"
      },
      "00041a85-d8fe-09f2-4aab-1c86d8a7444d": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": []
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div style=\"width: 100%; height: 100%;\" fxLayout=\"row\" class=\"attribute-update-form\" style=\"padding: 0 8px;\">\n    <div fxFlex fxLayout=\"column\">\n        <mat-form-field class=\"mat-block\" style=\"width: 100%;\">\n              <mat-label>Title</mat-label>\n              <input #titleInput #titleInputCtrl=\"ngModel\" required matInput [(ngModel)]=\"titleInput.value\"\n                     value=\"${entityName}\" (keyUp.enter)=\"titleInput.value !== '${entityName}' ? saveTitleButton._elementRef.nativeElement.click() : return;\"\n                     (keyUp.escape)=\"titleInput.value = '${entityName}';\"/>\n              <mat-error *ngIf=\"!titleInputCtrl.valid\">Title is required</mat-error>         \n        </mat-form-field>\n    </div>\n    <div class=\"input-buttons\">\n        <button #saveTitleButton id=\"save-title\" [disabled]=\"titleInput.value === '${entityName}' || !titleInputCtrl.valid\" [attr.data-title]=\"titleInput.value\" type=\"button\" mat-icon-button>\n            <mat-icon>check</mat-icon>\n        </button> \n        <button [disabled]=\"titleInput.value === '${entityName}'\" type=\"button\" mat-icon-button (click)=\"titleInput.value = '${entityName}';\">\n            <mat-icon>close</mat-icon>\n        </button>\n    </div>\n</div>\n",
            "markdownCss": ".tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view  .grid__element:last-child {\n    margin-top: 19px;\n    margin-left: 7px;\n}\n\n.tb-markdown-view  .attribute-update-form .mat-icon-button {\n    width: 32px;\n    min-width: 32px;\n    height: 32px;\n    min-height: 32px;\n    padding: 0 !important;\n    margin: 0 !important;\n    line-height: 20px;\n}\n\n.tb-markdown-view  .attribute-update-form .mat-icon-button mat-icon {\n    width: 20px;\n    min-width: 20px;\n    height: 20px;\n    min-height: 20px;\n    font-size: 20px;\n}\n\n.tb-markdown-view .attribute-update-form .input-buttons {\n    margin-top: 19px;\n    margin-left: 7px;\n    display: flex;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "save-title",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#save-title', widgetContext.$container[0]);\n\nvar title = $(targetElement).attr('data-title');\n\nwidgetContext.assetService.getAsset(entityId.id, {ignoreLoading: true}).subscribe((Doktorkit) => {\n    Doktorkit.name = title;\n    widgetContext.assetService.saveAsset(Doktorkit, null, {ignoreLoading: true}).subscribe(() => {\n       widgetContext.stateController.getStateParams().selectedDoktorkit.entityName = title;\n       widgetContext.updateAliases();\n    });\n});\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "088a4799-8551-7ab4-892f-2a08d6d40a7c"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "00041a85-d8fe-09f2-4aab-1c86d8a7444d",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "1d0b53f4-7805-fbfd-1cc6-e91d0df3d4bf": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "latitude",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.862061599769905
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "longitude",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.017864596400994026
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "CartoDB.Positron",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 14,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": true,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${entityName}",
            "labelFunction": "var deviceType = dsData[dsIndex]['Type'];\r\nif (typeof deviceType !== undefined) {\r\n    if (deviceType == \"energy meter\") {\r\n        return '<span style=\"color:orange;\">${entityName}, ${energy:2} kWt</span>';\r\n    } else if (deviceType == \"thermometer\") {\r\n        return '<span style=\"color:blue;\">${entityName}, ${temperature:2} °C</span>';\r\n    }\r\n}",
            "showTooltip": false,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": false,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><link-act name='Doktorkit-devices'>Doktorkit devices</link-act>",
            "tooltipFunction": "var deviceType = dsData[dsIndex]['Type'];\r\nif (typeof deviceType !== undefined) {\r\n    if (deviceType == \"energy meter\") {\r\n        return '<b>${entityName}</b><br/><b>Energy:</b> ${energy:2} kWt<br/>';\r\n    } else if (deviceType == \"thermometer\") {\r\n        return '<b>${entityName}</b><br/><b>Temperature:</b> ${temperature:2} °C<br/>';\r\n    }\r\n}",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": false,
            "useMarkerImageFunction": true,
            "markerImageSize": 34,
            "markerImageFunction": "var width = 30;\nvar svgStr = getDoktorkitSvg(width);\nvar encodedSvg = encodeURIComponent(svgStr);\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\n\nreturn {\n    url: svgUrl,\n    size: width,\n    markerOffset: [width / 2, width / 2],\n    tooltipOffset: [width * 0.5 - width / 2, - (width / 2)]\n};\n\nfunction getDoktorkitSvg(width, isSelected) {\n    var shape = '<path d=\"m18.636 15.8c0.59978 0 1.1276-0.32788 1.3995-0.82369l2.8629-5.1901c0.29589-0.5278-0.08796-1.1836-0.69574-1.1836h-11.836l-0.75172-1.5994h-2.615v1.5994h1.5994l2.8789 6.0697-1.0796 1.9513c-0.58378 1.0716 0.18393 2.3751 1.3995 2.3751h9.5964v-1.5994h-9.5964l0.87967-1.5994zm-7.5092-5.5979h9.7164l-2.2072 3.9985h-5.6139zm0.67175 9.5964c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994 1.5994-0.71973 1.5994-1.5994-0.71973-1.5994-1.5994-1.5994zm7.997 0c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994c0.87967 0 1.5994-0.71973 1.5994-1.5994s-0.71973-1.5994-1.5994-1.5994z\" fill=\"white\" stroke-width=\".7997\"/>';\n    var color = '#1F8B4D';\n    var background = getBackground(color);\n    var svgWidth = width;\n    var svgHeight = 30;\n    \n    var opacity = 1;\n    \n    var DoktorkitSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgWidth + '\" height=\"' + svgHeight + '\" viewBox=\"0 0 ' + svgWidth + ' ' + svgHeight + '\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                    background + shape;\n    DoktorkitSvg += '</svg>';\n    return DoktorkitSvg;    \n}\n\nfunction getBackground(color) {\n     return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>';\n}\n",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "snappable": false,
            "initDragMode": true,
            "hideAllControlButton": true,
            "useClusterMarkers": false,
            "zoomOnClick": true,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true,
            "useIconCreateFunction": false
          },
          "title": "Edit Doktorkit location",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [],
            "tooltipAction": []
          },
          "showTitleIcon": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "titleTooltip": ""
        },
        "row": 0,
        "col": 0,
        "id": "1d0b53f4-7805-fbfd-1cc6-e91d0df3d4bf",
        "typeFullFqn": "system.maps_v2.openstreetmap"
      },
      "59df0b6f-17dd-3c4c-a484-69c0836246da": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "floorplan",
                  "type": "attribute",
                  "label": "floorplan",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.5234606901361916
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showResultMessage": false,
            "displayPreview": true,
            "displayClearButton": false,
            "widgetTitle": "Floor plan",
            "displayApplyButton": false,
            "displayDiscardButton": true
          },
          "title": "Floor plan",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "59df0b6f-17dd-3c4c-a484-69c0836246da",
        "typeFullFqn": "system.input_widgets.update_server_image_attribute"
      },
      "8a7abdae-72fd-610d-7977-4e211fa999f4": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c348dad-e738-a4db-5e7e-4c0271790ab7",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "latitude",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.862061599769905
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "longitude",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.017864596400994026
                }
              ]
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "selectedDoktorkit",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5292772206260663,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value !== '') {\n    return true;\n} else {\n    return false;\n}"
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "CartoDB.Positron",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "useV3": false
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "",
            "imageUrlAttribute": "",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 18,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "draggableMarker": true,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${entityName}",
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": false,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><link-act name='Doktorkit-devices'>Doktorkit devices</link-act><br/><br/><link-act name='delete-Doktorkit'>Delete</link-act>",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": false,
            "useMarkerImageFunction": true,
            "markerImageFunction": "var selectedDoktorkit = data['selectedDoktorkit'] === true;\nvar selectedMode = dsData.filter(function (data) { return data['selectedDoktorkit'] === true; }).length > 0;\n\nvar width = 30;\nvar svgStr = getDoktorkitSvg(width, selectedDoktorkit);\nvar encodedSvg = encodeURIComponent(svgStr);\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\n\nif (selectedDoktorkit) {\n    width += 8;\n}\n\nreturn {\n    url: svgUrl,\n    size: width,\n    markerOffset: [width / 2, width / 2],\n    tooltipOffset: [width * 0.5 - width / 2, - (width / 2)]\n};\n\nfunction getDoktorkitSvg(width, isSelected) {\n    var shape = '<path d=\"m18.636 15.8c0.59978 0 1.1276-0.32788 1.3995-0.82369l2.8629-5.1901c0.29589-0.5278-0.08796-1.1836-0.69574-1.1836h-11.836l-0.75172-1.5994h-2.615v1.5994h1.5994l2.8789 6.0697-1.0796 1.9513c-0.58378 1.0716 0.18393 2.3751 1.3995 2.3751h9.5964v-1.5994h-9.5964l0.87967-1.5994zm-7.5092-5.5979h9.7164l-2.2072 3.9985h-5.6139zm0.67175 9.5964c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994 1.5994-0.71973 1.5994-1.5994-0.71973-1.5994-1.5994-1.5994zm7.997 0c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994c0.87967 0 1.5994-0.71973 1.5994-1.5994s-0.71973-1.5994-1.5994-1.5994z\" fill=\"white\" stroke-width=\".7997\"/>';\n    var color = '#1F8B4D';\n    var background = getBackground(color);\n    var svgWidth = isSelected ? (width + 8) : width;\n    var svgHeight = isSelected ? 38 : 30;\n    \n    var opacity = selectedMode && !isSelected ? 0.4 : 1;\n    \n    var DoktorkitSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgWidth + '\" height=\"' + svgHeight + '\" viewBox=\"0 0 ' + svgWidth + ' ' + svgHeight + '\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                    wrapIfSelected(background + shape, isSelected);\n    if (isSelected) {\n        DoktorkitSvg += getDoktorkitSelectionStroke();\n    }\n    DoktorkitSvg += '</svg>';\n    return DoktorkitSvg;    \n}\n\nfunction wrapIfSelected(svg, isSelected) {\n    if (isSelected) {\n        return '<g transform=\"translate(4 4)\">' + svg + '</g>';\n    } else {\n        return svg;\n    }\n}\n\nfunction getBackground(color) {\n     return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>';\n}\n\nfunction getDoktorkitSelectionStroke() {\n     return '<circle cx=\"19\" cy=\"19\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n}\n",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "snappable": false,
            "initDragMode": true,
            "hideAllControlButton": true,
            "hideDrawControlButton": false,
            "hideEditControlButton": false,
            "hideRemoveControlButton": false,
            "useClusterMarkers": false,
            "zoomOnClick": true,
            "maxZoom": null,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true,
            "useIconCreateFunction": false,
            "clusterMarkerFunction": null
          },
          "title": "Doktorkits map",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Select Doktorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nvar selectedDoktorkit = params['selectedDoktorkit'];\nif (selectedDoktorkit && selectedDoktorkit.entityId.id === entityId.id) {\n    params['selectedDoktorkit'] = null;\n} else {\n    params['selectedDoktorkit'] = { entityId: entityId, entityName: entityName, entityLabel: entityLabel };\n}\nwidgetContext.stateController.updateState(null, params);\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4de7962b-a1de-5cb1-cd78-993dc7863614"
              }
            ],
            "tooltipAction": [
              {
                "name": "Doktorkit-devices",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nparams['selectedDoktorkit'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedDoktorkit';\nparams['selectedDevice'] = null;\n\nwidgetContext.stateController.openState('Doktorkit_devices', params);\t",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1ca54350-817a-27b3-26a7-3572544d8523"
              },
              {
                "name": "delete-Doktorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteDoktorkitDialog();\n\nfunction openDeleteDoktorkitDialog() {\n  var title = 'Are you sure you want to delete the Doktorkit ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the Doktorkit will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteDoktorkit();\n      }\n    }\n  );\n}\n\nfunction deleteDoktorkit() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, customerId, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, customerId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteDoktorkitToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Doktorkit Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Doktorkit Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteDoktorkitToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "89d67b54-a78e-f190-3832-1aae29cee395"
              }
            ]
          },
          "showTitleIcon": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "titleTooltip": ""
        },
        "row": 0,
        "col": 0,
        "id": "8a7abdae-72fd-610d-7977-4e211fa999f4",
        "typeFullFqn": "system.maps_v2.openstreetmap"
      },
      "7a671e82-7171-d1e2-75cc-565f67598090": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n",
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n     <div fxLayout=\"row\" style=\"width: 100%; height: 60px;\" fxLayoutAlign=\"center start\">\n        <h5 fxFlex class=\"market-title\">Doktorkits</h5>\n        <button id=\"add-Doktorkit\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add Doktorkit</span></button>\n     </div>\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkits_map\"></tb-dashboard-state>\n    </div>\n</div>"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-Doktorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDoktorkitFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Add Doktorkit</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n    <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n      <mat-form-field fxFlex class=\"mat-block\">\n        <mat-label>Doktorkit title</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"addDoktorkitFormGroup.get('name').hasError('required')\">\n          Doktorkit title is required.\n        </mat-error>\n      </mat-form-field>\n    </div>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addDoktorkitFormGroup.invalid || !addDoktorkitFormGroup.dirty\">\n      Add Doktorkit\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddDoktorkitDialog();\n\nfunction openAddDoktorkitDialog() {\n  customDialog.customDialog(htmlTemplate, AddDoktorkitDialogController).subscribe();\n}\n\nfunction AddDoktorkitDialogController(instance) {\n  let vm = instance;\n\n  vm.addDoktorkitFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]]\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var customerId;\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n    vm.addDoktorkitFormGroup.markAsPristine();\n    saveDoktorkitObservable(customerId).subscribe(\n      function (Doktorkit) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToDoktorkitRelation(customerId, Doktorkit.id),\n              saveAttributes(Doktorkit.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedDoktorkit = params['selectedDoktorkit'];\n                params['selectedDoktorkit'] = { entityId: Doktorkit.id, entityName: Doktorkit.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveDoktorkitObservable(customerId) {\n    return getDoktorkitsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((DoktorkitsGroup) => {\n            const formValues = vm.addDoktorkitFormGroup.value;\n            let Doktorkit = {\n              name: formValues.name,\n              type: 'Doktorkit',\n              customerId: customerId\n            };\n            return assetService.saveAsset(Doktorkit, DoktorkitsGroup.id.id)\n        })\n    );\n  }\n  \n  function getDoktorkitsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var DoktorkitsGroup = entityGroups.find(group => group.name === 'Doktorkits');\n              if (DoktorkitsGroup) {\n                  return widgetContext.rxjs.of(DoktorkitsGroup);\n              } else {\n                  DoktorkitsGroup = {\n                      type: 'ASSET',\n                      name: 'Doktorkits',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(DoktorkitsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToDoktorkitRelation(customerId, DoktorkitId) {\n      var relation = {\n          from: customerId,\n          to: DoktorkitId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'latitude',\n            value: 48.1406022\n        },\n        {\n            key: 'longitude',\n            value: 16.2932688\n        },\n        {\n            key: 'alias',\n            value: 'N/A'\n        },        \n        {\n            key: 'address',\n            value: 'N/A'\n        },\n        {\n            key: 'state',\n            value: 'normal'\n        },\n        {\n            key: 'units',\n            value: 'metric'\n        },\n        {\n            key: 'floorplan',\n            value: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K'\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "7a671e82-7171-d1e2-75cc-565f67598090",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "eac6e38e-62f2-1f91-754b-299d11e87c19": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "enableSearch": true,
            "displayPagination": true,
            "defaultPageSize": 15,
            "defaultSortOrder": "Name",
            "displayEntityName": false,
            "displayEntityType": false,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityLabel": false,
            "useRowStyleFunction": false,
            "entitiesTitle": "Devices"
          },
          "title": "Devices",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "67255800-8289-4839-c068-7a223831f12a",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.46096251592014714
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#4caf50",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "cellContentFunction": "var type = value;\n\nvar typeSvg = getTypeSvg(type);\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ typeSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ type +'</span>' +\n       '</span>';\n            \nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Smart Shelf':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.5 2C2.22386 2 2 2.22386 2 2.5V17.5C2 17.7761 2.22386 18 2.5 18C2.77614 18 3 17.7761 3 17.5V17H17V17.5C17 17.7761 17.2239 18 17.5 ' +\n                      '18C17.7761 18 18 17.7761 18 17.5V2.5C18 2.22386 17.7761 2 17.5 2C17.2239 2 17 2.22386 17 2.5V8H14C14.5523 8 15 7.55228 15 7V4C15 3.44772 14.5523 3 14 3H11C10.4477 3 10 3.44772 10 4V7C10 ' +\n                      '7.55228 10.4477 8 11 8H7C7.55228 8 8 7.55228 8 7V6C8 5.44772 7.55228 5 7 5H6C5.44772 5 5 5.44772 5 6V7C5 7.55228 5.44772 8 6 8H3V2.5C3 2.22386 2.77614 2 2.5 2ZM17 16V9H3V16H6C5.44772 16 ' +\n                      '5 15.5523 5 15V12C5 11.4477 5.44772 11 6 11H9C9.55228 11 10 11.4477 10 12V15C10 15.5523 9.55228 16 9 16H12C11.4477 16 11 15.5523 11 15V13C11 12.4477 11.4477 12 12 12H14C14.5523 12 15 ' +\n                      '12.4477 15 13V15C15 15.5523 14.5523 16 14 16H17Z\" fill=\"#212121\"/>';\n            break;\n        case 'Freezer':            \n            typeSvg = '<rect x=\"9\" y=\"2\" width=\"2\" height=\"16\" rx=\"1\" fill=\"#212121\"/>' +\n                      '<path d=\"M12.5 3.5L10 6L7.5 3.5M12.5 16.5L10 14L7.5 16.5\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<path d=\"M16.8792 8.91509L13.4641 8.00002L14.3792 4.58496M5.62082 15.4151L6.53588 12L3.12082 11.085\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<path d=\"M5.62085 4.58491L6.53591 7.99998L3.12085 8.91504M16.8792 11.0849L13.4641 12L14.3792 15.415\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<rect x=\"16.4282\" y=\"5.13379\" width=\"2\" height=\"16\" rx=\"1\" transform=\"rotate(60 16.4282 5.13379)\" fill=\"#212121\"/>' +\n                      '<rect x=\"2.57178\" y=\"6.86621\" width=\"2\" height=\"16\" rx=\"1\" transform=\"rotate(-60 2.57178 6.86621)\" fill=\"#212121\"/>';\n            break;\n        case 'Chiller':            \n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M13.0001 7.49994C13.0001 8.53714 12.2661 9.2516 11.4454 9.64333C11.2807 9.72191 11.1185 9.75061 10.9657 9.73874C10.9881 9.82201 ' +\n                      '11.0001 9.90957 11.0001 9.99994C11.0001 10.0304 10.9988 10.0605 10.9961 10.0902C11.1511 10.0322 11.322 9.99993 11.5001 9.99993L12.5001 9.99994L13.5 9.99993C14.3285 9.99992 15.0003 ' +\n                      '10.6975 14.6435 11.4452C14.2517 12.2658 13.5373 12.9999 12.5001 12.9999C11.4629 12.9999 10.7484 12.2658 10.3567 11.4452C10.2781 11.2805 10.2494 11.1184 10.2613 10.9655C10.178 10.988 ' +\n                      '10.0905 10.9999 10.0001 10.9999C9.96965 10.9999 9.93949 10.9986 9.90971 10.9959C9.96779 11.1509 10 11.3218 10 11.5L10 12.4999L10 13.4999C10.0001 14.3284 9.30246 15.0002 8.55482 ' +\n                      '14.6433C7.73413 14.2516 7.00006 13.5371 7.00006 12.4999C7.00006 11.4627 7.73413 10.7483 8.55482 10.3566C8.71948 10.278 8.8817 10.2493 9.03459 10.2611C9.01212 10.1779 9.00013 10.0903 ' +\n                      '9.00013 9.99994C9.00013 9.9695 9.00149 9.93938 9.00416 9.90963C8.84921 9.96766 8.67837 9.9999 8.50029 9.99989L7.50031 9.99988L6.50033 9.99989C5.67189 9.9999 5.00006 9.3023 5.35692 ' +\n                      '8.55467C5.74865 7.73397 6.46311 6.99991 7.50031 6.99991C8.5375 6.99991 9.25197 7.73397 9.6437 8.55467C9.72227 8.71929 9.75098 8.88149 9.73911 9.03435C9.82232 9.01191 9.90983 8.99994 ' +\n                      '10.0001 8.99994C10.0306 8.99994 10.0607 9.0013 10.0905 9.00397C10.0324 8.84898 10.0002 8.67807 10.0002 8.49992L10.0002 7.49994L10.0002 6.49996C10.0001 5.67153 10.6977 4.99969 11.4454 ' +\n                      '5.35655C12.2661 5.74828 13.0001 6.46274 13.0001 7.49994Z\" fill=\"#212121\"/>' +\n                      '<circle cx=\"10\" cy=\"10\" r=\"8\" stroke=\"#212121\" stroke-width=\"2\"/>';\n            break;                      \n        case 'Smart Bin':\n            typeSvg = '<path d=\"M6.71849 14C5.15241 14 4.19394 12.2816 5.01686 10.9491L5.09816 10.8175C5.17797 10.8327 5.26094 10.8383 5.34575 10.8332C5.89704 10.8001 6.31713 10.3264 6.28404 9.77509L6.21705 8.65906C6.19838 8.34795 6.03571 8.06333 5.77714 7.88933C5.51856 7.71533 5.19363 7.67184 4.8984 7.77171L3.93237 8.09851C3.40921 8.27549 3.12858 8.84306 3.30556 9.36622C3.34237 9.47504 3.39608 9.57337 3.46278 9.65927L3.31523 9.89818C1.66939 12.5631 3.58633 16 6.71849 16H7.83485C8.38714 16 8.83485 15.5523 8.83485 15C8.83485 14.4478 8.38714 14 7.83485 14L6.71849 14Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M13.3135 13.8409C14.8789 13.8873 15.8879 12.198 15.1048 10.8418L14.5467 9.87495C14.2705 9.39666 14.4344 8.78507 14.9127 8.50893C15.391 8.23279 16.0026 8.39666 16.2787 8.87495L16.8369 9.84175C18.403 12.5543 16.3849 15.9329 13.2542 15.84L12.9735 15.8317C12.9324 15.9324 12.8741 16.0281 12.7983 16.1143C12.4337 16.5292 11.8019 16.5699 11.387 16.2054L10.621 15.5322C10.3869 15.3264 10.2621 15.0233 10.2835 14.7123C10.3049 14.4014 10.47 14.1182 10.7301 13.9465L11.6632 13.3305C12.124 13.0262 12.7444 13.1531 13.0487 13.614C13.0955 13.6849 13.1321 13.7596 13.1588 13.8363L13.3135 13.8409Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M11.6696 5.21002C10.9272 3.83113 8.95968 3.80195 8.17664 5.15821L7.61846 6.12501C7.34232 6.6033 6.73073 6.76718 6.25244 6.49104C5.77414 6.21489 5.61027 5.6033 5.88641 5.12501L6.44459 4.15821C8.01067 1.44568 11.9456 1.50404 13.4306 4.26183L13.5637 4.50907C13.6715 4.49425 13.7835 4.4969 13.8961 4.51943C14.4377 4.62774 14.7889 5.15457 14.6806 5.69613L14.4806 6.69613C14.4195 7.00175 14.2193 7.26139 13.9393 7.39833C13.6594 7.53526 13.3315 7.53382 13.0528 7.39444L12.0528 6.89444C11.5588 6.64745 11.3586 6.04678 11.6056 5.5528C11.6436 5.47681 11.6899 5.40777 11.743 5.34624L11.6696 5.21002Z\" fill=\"#212121\"/>';\n            break;          \n        case 'Door Sensor':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 4H6V16H14V4ZM8 12C8.55228 12 9 11.5523 9 11C9 10.4477 8.55228 10 8 10C7.44772 10 7 10.4477 7 11C7 11.5523 7.44772 12 8 12Z\" fill=\"#212121\"/>' +\n                      '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16 17V3C16 2.44772 15.5523 2 15 2H5C4.44772 2 4 2.44772 4 3V17H3.5C3.22386 17 3 17.2239 3 17.5C3 17.7761 3.22386 18 3.5 18H16.5C16.7761 18 17 17.7761 17 17.5C17 17.2239 16.7761 17 16.5 17H16ZM15 3H5L5 17H15V3Z\" fill=\"#212121\"/>';\n            break;\n        case 'Liquid Level Sensor':\n            typeSvg = '<path d=\"M14.6363 0.453212C14.8228 0.210257 15.1772 0.210257 15.3637 0.453213C15.9404 1.2044 17 2.73057 17 3.80373C17 5.02723 16.1143 5.99982 15 5.99982C13.8857 5.99982 13 5.02723 13 3.80373C13 2.73057 14.0596 1.2044 14.6363 0.453212Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M8.3017 2.76073C8.67788 2.33798 9.32212 2.33798 9.6983 2.76073C11.2801 4.53832 15 9.0479 15 12.1437C15 15.4064 12.3427 18 9 18C5.65725 18 3 15.4064 3 12.1437C3 9.0479 6.71994 4.53832 8.3017 2.76073Z\" fill=\"#212121\"/>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<path d=\"M2.5 5C2.22386 5 2 5.22386 2 5.5C2 5.77614 2.22386 6 2.5 6H4C4 6.55228 4.44772 7 5 7H15C15.5523 7 16 6.55228 16 6H17.5C17.7761 6 18 5.77614 18 5.5C18 5.22386 17.7761 5 17.5 5H2.5Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M12.0001 12C12.5524 12 13.0001 11.5523 13.0001 11C13.0001 10.4477 12.5524 10 12.0001 10C11.4478 10 11.0001 10.4477 11.0001 11C11.0001 11.5523 11.4478 12 12.0001 12Z\" fill=\"#212121\"/>' +\n                      '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10.0001 16C14.0804 16 17.4472 12.9453 17.9384 8.99801C18.0066 8.44996 17.5524 8 17.0001 8H3.00009C2.4478 8 1.99353 8.44996 2.06173 8.99801C2.55295 12.9453 5.91978 16 10.0001 16ZM12.0001 13C13.1047 13 14.0001 12.1046 14.0001 11C14.0001 9.89543 13.1047 9 12.0001 9C10.8955 9 10.0001 9.89543 10.0001 11C10.0001 12.1046 10.8955 13 12.0001 13Z\" fill=\"#212121\"/>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<path d=\"M7 3.5C7 4.32843 6.32843 5 5.5 5C4.67157 5 4 4.32843 4 3.5C4 2.67157 4.67157 2 5.5 2C6.32843 2 7 2.67157 7 3.5Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M3 12C2.44772 12 2 11.5523 2 11L2 7.88652C2 6.84462 2.84462 6 3.88652 6C3.90535 6 3.92403 6.00055 3.94255 6.00162C3.96157 6.00055 3.98072 6 4 6H7C7.01928 6 7.03843 6.00055 7.05745 6.00162C7.07597 6.00055 7.09465 6 7.11348 6C8.15538 6 9 6.84462 9 7.88652V11C9 11.5523 8.55229 12 8 12V17C8 17.5523 7.55228 18 7 18C6.44772 18 6 17.5523 6 17L6 14H5V17C5 17.5523 4.55228 18 4 18C3.44772 18 3 17.5523 3 17V12Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M16 18C15.4477 18 15 17.5523 15 17V14H14V17C14 17.5523 13.5523 18 13 18C12.4477 18 12 17.5523 12 17V14H10.7215C10.3724 14 10.1308 13.6513 10.2533 13.3244L12.4733 7.40449C12.7901 6.55968 13.5977 6 14.5 6C15.4023 6 16.2099 6.55968 16.5267 7.40449L18.7467 13.3244C18.8692 13.6513 18.6276 14 18.2785 14H17V17C17 17.5523 16.5523 18 16 18Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M14.5 5C15.3284 5 16 4.32843 16 3.5C16 2.67157 15.3284 2 14.5 2C13.6716 2 13 2.67157 13 3.5C13 4.32843 13.6716 5 14.5 5Z\" fill=\"#212121\"/>';\n            break;\n        case 'Smoke Sensor':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9.64491 2.08319C9.48444 1.9888 9.28482 1.99138 9.12685 2.08988C8.96887 2.18839 8.87871 2.3665 8.89285 2.55213C8.98169 3.71876 8.78795 4.5943 8.45363 5.30483C8.11607 6.02225 7.62209 6.60008 7.06387 7.157C6.88401 7.33644 6.69008 7.52013 6.49214 7.70763C6.10197 8.07721 5.69618 8.46158 5.35189 8.85718C4.81113 9.47853 4.35082 10.1982 4.15741 11.131C3.35478 15.0023 6.43952 18.1649 10.361 17.9822C10.41 17.9806 10.4592 17.9779 10.5088 17.9741L10.55 17.9708L10.5673 17.9695C10.6635 17.9622 10.7585 17.9532 10.8523 17.9427C10.897 17.9427 10.9422 17.9409 10.9878 17.9375C11.1369 17.9261 11.2735 17.9002 11.3976 17.8614C12.9028 17.5787 14.0571 16.8581 14.836 15.8302C15.7453 14.6303 16.1036 13.0646 15.9781 11.4151C15.7275 8.1215 13.5473 4.37866 9.64491 2.08319ZM12.1372 15.5326C12.1487 15.5269 12.1601 15.521 12.1714 15.5152C12.2227 15.2706 12.2393 15.0003 12.2172 14.7101C12.1353 13.6344 11.5243 12.3752 10.3912 11.4298C10.3443 11.6743 10.2711 11.8979 10.1767 12.1045C9.97248 12.5515 9.68116 12.8915 9.40451 13.1748C9.2918 13.2902 9.1897 13.3891 9.09461 13.4812C8.93666 13.6341 8.79804 13.7684 8.66241 13.9284C8.46694 14.1591 8.33595 14.3839 8.28119 14.6575C8.20904 15.018 8.23357 15.3634 8.33595 15.6725C8.69526 15.8186 9.08844 15.9185 9.50948 15.9633C9.62655 15.764 9.79981 15.6036 9.97777 15.4389C10.3505 15.0938 10.7439 14.7297 10.6844 13.949C11.3929 14.3558 11.8813 14.938 12.1372 15.5326ZM13.2143 14.6343L13.2159 14.6563L13.2421 14.6222C13.7907 13.8983 14.0816 12.8503 13.9839 11.5668C13.8301 9.5445 12.7138 7.15459 10.6097 5.25541C10.5143 5.57021 10.3981 5.86993 10.2634 6.15628C9.78098 7.18157 9.09869 7.9521 8.47652 8.57282C8.20885 8.83986 7.97694 9.05847 7.76612 9.25719C7.43058 9.57348 7.14846 9.83941 6.86065 10.1701C6.45742 10.6334 6.21678 11.0502 6.11585 11.537C5.83546 12.8894 6.29313 14.1616 7.23945 14.9971C7.24423 14.8222 7.26422 14.6432 7.30064 14.4613C7.39921 13.9687 7.63564 13.5933 7.89951 13.2819C8.06367 13.0882 8.26661 12.8908 8.44919 12.7131C8.53584 12.6288 8.61792 12.549 8.68907 12.4761C8.93347 12.2258 9.13295 11.9826 9.26713 11.689C9.39844 11.4016 9.47964 11.0379 9.44124 10.5337C9.42702 10.347 9.51835 10.168 9.67788 10.0698C9.83741 9.97174 10.0384 9.97101 10.1986 10.068C12.0451 11.1851 13.0906 13.0082 13.2143 14.6343Z\" fill=\"#212121\"/>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' + \n           typeSvg +\n           '</svg>';\n} \n"
                  },
                  "_hash": 0.8077097060074172,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#f44336",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.4057433451983201
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "State",
                  "color": "#ffc107",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "cellContentFunction": "var state = value;\nvar active = entity.active;\nif (active === 'false') {\n    state = 'disconnected';\n}\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#607d8b",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "disabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.04680501891139488,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "ownerName",
                  "type": "entityField",
                  "label": "Owner name",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.4252028260327432
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [],
            "headerButton": [
              {
                "name": "Add Device Manually",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Add device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-form-field class=\"mat-block\">\r\n      <mat-label>Device type</mat-label>\r\n      <mat-select formControlName=\"type\" (selectionChange)=\"onDeviceTypeChange($event.value)\" required>\r\n        <mat-option *ngFor=\"let type of deviceTypes\" [value]=\"type\">\r\n          {{ type }}\r\n        </mat-option>\r\n      </mat-select>\r\n      <mat-error *ngIf=\"addDeviceFormGroup.get('type').hasError('required')\">\r\n        Device type is required.\r\n      </mat-error>\r\n    </mat-form-field>\r\n    <mat-form-field class=\"mat-block\">\r\n      <mat-label>Device name</mat-label>\r\n      <input matInput formControlName=\"name\" required>\r\n      <mat-error *ngIf=\"addDeviceFormGroup.get('name').hasError('required')\">\r\n        Device name is required.\r\n      </mat-error>\r\n    </mat-form-field>\r\n\r\n    <!-- Serial Number field for Doktorkit (P-Flow D116) -->\r\n    <div *ngIf=\"selectedDeviceType === 'P-Flow D116'\">\r\n      <mat-form-field class=\"mat-block\">\r\n        <mat-label>Serial Number</mat-label>\r\n        <input matInput formControlName=\"serialNumber\" required>\r\n        <mat-error *ngIf=\"addDeviceFormGroup.get('serialNumber').hasError('required')\">\r\n          Serial Number is required.\r\n        </mat-error>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <!-- devEUI field for Sensorkits-->\r\n    <div *ngIf=\"selectedDeviceType !== 'P-Flow D116'\">\r\n      <mat-form-field class=\"mat-block\">\r\n        <mat-label>devEUI</mat-label>\r\n        <input matInput formControlName=\"devEUI\" required pattern=\"[a-zA-Z0-9]{16}\">\r\n        <mat-error *ngIf=\"addDeviceFormGroup.get('devEUI').hasError('required')\">\r\n          devEUI is required.\r\n        </mat-error>\r\n        <mat-error *ngIf=\"addDeviceFormGroup.get('devEUI').hasError('pattern')\">\r\n          devEUI must be 16 alphanumeric characters.\r\n        </mat-error>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <mat-form-field class=\"mat-block\">\r\n      <mat-label>Device label</mat-label>\r\n      <input matInput formControlName=\"label\">\r\n    </mat-form-field>\r\n  </div>\r\n  \r\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(isLoading$ | async)\"\r\n            (click)=\"cancel()\" cdkFocusInitial>\r\n      Cancel\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid || !addDeviceFormGroup.dirty\">\r\n      Add device\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet PageLink = widgetContext.servicesMap.get('PageLink');\nopenAddDeviceDialog();\n\nfunction openAddDeviceDialog() {\n  customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\n}\n\nfunction AddDeviceDialogController(instance) {\n  let vm = instance;\n  let customerID = widgetContext.stateController.getStateParams().entityId.id;\n  let customerName = widgetContext.stateController.getStateParams().entityName;\n  let customerShortName;\n  vm.deviceTypes = [\n    'P-Flow D116',       // Doktorkit\n    'Room Sensor T',     // Sensorkit\n    'Room Sensor CO2'    // Sensorkit\n  ];\n\n  vm.deviceTypeShortNames = {\n    'P-Flow D116': 'PF',\n    'Room Sensor T': 'ERST',\n    'Room Sensor CO2': 'ERSCO2'\n  };\n\n  vm.selectedDeviceType = '';\n\n  vm.addDeviceFormGroup = vm.fb.group({\n    name: [{ value: '', disabled: true }, [vm.validators.required]], // Disabled to show as readonly\n    type: ['', [vm.validators.required]],\n    label: [''],\n    serialNumber: [''],\n    devEUI: ['', [vm.validators.pattern('[a-zA-Z0-9]{16}')]]\n  });\n\n  // Fetch short name and set up the name field\n  attributeService.getEntityAttributes({ entityType: 'CUSTOMER', id: customerID }, 'SERVER_SCOPE', ['shortName']).subscribe(attributes => {\n    let shortNameAttr = attributes.find(attr => attr.key === 'shortName');\n    customerShortName = shortNameAttr ? shortNameAttr.value : generateCustomerShortName(customerName);\n    \n    vm.addDeviceFormGroup.get('serialNumber').valueChanges.subscribe(value => {\n      vm.addDeviceFormGroup.get('name').setValue(constructDeviceName(customerShortName, vm.deviceTypeShortNames, vm.addDeviceFormGroup.value));\n    });\n\n    vm.addDeviceFormGroup.get('devEUI').valueChanges.subscribe(value => {\n      vm.addDeviceFormGroup.get('name').setValue(constructDeviceName(customerShortName, vm.deviceTypeShortNames, vm.addDeviceFormGroup.value));\n    });\n\n    vm.addDeviceFormGroup.get('type').valueChanges.subscribe(value => {\n      vm.addDeviceFormGroup.get('name').setValue(constructDeviceName(customerShortName, vm.deviceTypeShortNames, vm.addDeviceFormGroup.value));\n    });\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function () {\n    var customerId = widgetContext.stateController.getStateParams().entityId;\n    var formValues = vm.addDeviceFormGroup.value;\n    formValues.name = constructDeviceName(customerShortName, vm.deviceTypeShortNames, formValues);\n    vm.addDeviceFormGroup.markAsPristine();\n    \n    // Check if the device is a Doktorkit or Sensorkit\n    if (formValues.type === 'P-Flow D116') {\n      getTargetDeviceGroups(customerId, 'Doktorkit Devices', 'Unassigned Doktorkit Devices', 'Kit Devices').pipe(\n        widgetContext.rxjs.switchMap((targetDevicesGroup) => {\n            var DoktorkitDevicesGroup = targetDevicesGroup[0];\n            var unassignedDoktorkitGroup = targetDevicesGroup[1];\n            var kitDeviceGroup = targetDevicesGroup[2];\n            return saveDeviceObservable(customerId, DoktorkitDevicesGroup, unassignedDoktorkitGroup, kitDeviceGroup);\n        })\n      ).subscribe(\n        function (device) {\n          saveAttributes(device.id).subscribe(\n            function () {\n              widgetContext.updateAliases();\n              vm.dialogRef.close(null);\n            }\n          );\n        }\n      );\n    } else {\n      getTargetDeviceGroups(customerId, 'Sensorkit Devices', 'Unassigned Sensorkit Devices','Kit Devices').pipe(\n        widgetContext.rxjs.switchMap((targetDevicesGroup) => {\n            var SensorkitDevicesGroup = targetDevicesGroup[0];\n            var unassignedSensorkitGroup = targetDevicesGroup[1];\n            var kitDeviceGroup = targetDevicesGroup[2];\n            return saveDeviceObservable(customerId, SensorkitDevicesGroup, unassignedSensorkitGroup,kitDeviceGroup);\n        })\n      ).subscribe(\n        function (device) {\n          saveAttributes(device.id).subscribe(\n            function () {\n              widgetContext.updateAliases();\n              vm.dialogRef.close(null);\n            }\n          );\n        }\n      );\n    }\n  };\n\n  function constructDeviceName(customerShortName, deviceTypeShortNames, formValues) {\n    let identifier = formValues.serialNumber || formValues.devEUI;\n    let typeShortName = deviceTypeShortNames[formValues.type] || '';\n    return customerShortName + \"_\" + typeShortName + \"_\" + identifier;\n  }\n\n  function saveDeviceObservable(customerId, primaryDevicesGroup, unassignedDevicesGroup,kitDeviceGroup) {\n    const formValues = vm.addDeviceFormGroup.value;\n    let device = {\n      name: formValues.name,\n      type: formValues.type,\n      label: formValues.label,\n      customerId: customerId,\n      serialNumber: formValues.serialNumber,\n      devEUI: formValues.devEUI\n    };\n      return deviceService.saveDevice(device, unassignedDevicesGroup.id.id).pipe(\n    widgetContext.rxjs.switchMap((savedDevice) => {\n      // Add to primaryDevicesGroup\n      return entityGroupService.addEntityToEntityGroup(primaryDevicesGroup.id.id, savedDevice.id.id).pipe(\n        // Switch to the next operation to add to kitDeviceGroup\n        widgetContext.rxjs.switchMap(() => {\n          return entityGroupService.addEntityToEntityGroup(kitDeviceGroup.id.id, savedDevice.id.id);\n        }),\n        // After all operations, return the savedDevice\n        widgetContext.rxjs.map(() => {\n          return savedDevice;\n        })\n      );\n    })\n  );\n}\n\n  function getTargetDeviceGroups(customerId, primaryGroupName, unassignedGroupName,kitDeviceGroup) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n      widgetContext.rxjs.switchMap((groups) => {\n        return widgetContext.rxjs.forkJoin([\n          getOrCreateDevicesGroup(groups, primaryGroupName, customerId),\n          getOrCreateDevicesGroup(groups, unassignedGroupName, customerId),\n          getOrCreateDevicesGroup(groups, kitDeviceGroup, customerId)\n        ]);\n      })\n    );\n  }\n\n  function getOrCreateDevicesGroup(groups, groupName, customerId) {\n    var devicesGroup = groups.find(group => group.name === groupName);\n    if (devicesGroup) {\n      return widgetContext.rxjs.of(devicesGroup);\n    } else {\n      devicesGroup = {\n        type: 'DEVICE',\n        name: groupName,\n        ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(devicesGroup);\n    }\n  }\n\n  function saveAttributes(entityId) {\n    let attributesArray = [\n      { key: 'state', value: 'normal' },\n      { key: 'inactivityTimeout', value: '3700000' }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n\n  vm.onDeviceTypeChange = function (selectedType) {\n    vm.selectedDeviceType = selectedType;\n    if (selectedType === 'P-Flow D116') {\n      vm.addDeviceFormGroup.get('serialNumber').setValidators([vm.validators.required]);\n      vm.addDeviceFormGroup.get('devEUI').clearValidators();\n    } else {\n      vm.addDeviceFormGroup.get('serialNumber').clearValidators();\n      vm.addDeviceFormGroup.get('devEUI').setValidators([vm.validators.required, vm.validators.pattern('[a-zA-Z0-9]{16}')]);\n    }\n    vm.addDeviceFormGroup.get('serialNumber').updateValueAndValidity();\n    vm.addDeviceFormGroup.get('devEUI').updateValueAndValidity();\n  };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3b5d65e6-84b8-d3b1-6d05-4172d2d15c48"
              },
              {
                "name": "Import Devices",
                "icon": "mdi:file-upload-outline",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addEntityFormGroup\" (ngSubmit)=\"import()\" style=\"width:640px\">\r\n    <mat-toolbar color=\"primary\">\r\n        <h2>Register devices</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content fxLayout=\"column\" style=\"position:relative\">\r\n        <div fxLayout=\"row\" fxLayoutAlign=\"start center\">\r\n            <div fxLayout=\"column\" fxLayoutAlign=\"center\" style=\"margin-right: 10px;\">\r\n                <button id=\"lorawan-dashboard\" type=\"button\" mat-button color=\"primary\"\r\n                        (click)=\"switchCard('lorawan')\" [class.selected]=\"selectedCard === 'lorawan'\">\r\n                    <mat-icon class=\"tb-mat-18\">wifi</mat-icon>\r\n                    <span>LoRaWAN</span>\r\n                </button>\r\n            </div>\r\n            <div fxLayout=\"column\" fxLayoutAlign=\"center\">\r\n                <button id=\"muc-settings\" type=\"button\" mat-button color=\"primary\"\r\n                        (click)=\"switchCard('muc')\" [class.selected]=\"selectedCard === 'muc'\">\r\n                    <mat-icon class=\"tb-mat-18\">cable</mat-icon>\r\n                    <span>MUC</span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <fieldset [disabled]=\"isLoading$ | async\" tb-toast toastTarget=\"importSensorsTarget\">\r\n            <tb-file-input formControlName=\"importData\"\r\n                           required\r\n                           label=\"Devices file\"\r\n                           [allowedExtensions]=\"'csv,txt'\"\r\n                           [accept]=\"'.csv,application/csv,text/csv,.txt,text/plain'\"\r\n                           dropLabel=\"{{'import.drop-file-csv-or' | translate}}\">\r\n            </tb-file-input>\r\n            <mat-form-field class=\"mat-block\" style=\"margin-top:12px\">\r\n                <mat-label translate>import.csv-delimiter</mat-label>\r\n                <mat-select required formControlName=\"delim\">\r\n                    <mat-option *ngFor=\"let delimiter of delimiters\" [value]=\"delimiter.key\">\r\n                        {{ delimiter.value }}\r\n                    </mat-option>\r\n                </mat-select>\r\n            </mat-form-field>\r\n        </fieldset>\r\n        <div class=\"import-info-section\">\r\n            <div class=\"import-info-header\">CSV file must contain columns:</div>\r\n            <div class=\"import-info-text\" *ngIf=\"selectedCard === 'lorawan'\">\r\n                <div>1. Name</div>\r\n                <div>2. Type</div>\r\n                <div>3. Label</div>\r\n                <div>4. location</div>\r\n                <div>5. displayName</div>\r\n                <div>6. meterType</div>\r\n                <div>7. customer</div>\r\n                <div>8. forwardTo</div>\r\n                <div>9. devEui</div>\r\n                <div>10. appKey</div>\r\n                <div>11. isDisabled</div>\r\n                <div>12. meterId</div>\r\n            </div>\r\n            <div class=\"import-info-text\" *ngIf=\"selectedCard === 'muc'\">\r\n                <div>1. Name</div>\r\n                <div>2. Type</div>\r\n                <div>3. Label</div>\r\n                <div>4. location</div>\r\n                <div>5. displayName</div>\r\n                <div>6. meterType</div>\r\n                <div>7. customer</div>\r\n                <div>8. forwardTo</div>\r\n                <div>9. meterId</div>\r\n            </div>\r\n            <div class=\"import-info-header\" style=\"margin-top:12px;margin-bottom:6px\">Example:</div>\r\n            <div [innerHTML]=\"exampleContent\" class=\"example-content\"></div>\r\n        </div>\r\n    </div>\r\n    <div mat-dialog-actions fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\"\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async)\"\r\n                (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n        </button>\r\n        <button mat-button mat-raised-button color=\"primary\"\r\n                type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || addEntityFormGroup.invalid || !addEntityFormGroup.dirty\">\r\n            Import\r\n        </button>\r\n    </div>\r\n</form>\r\n",
                "customCss": ".import-info-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: 12px 16px;\r\n    background-color: rgba(0, 0, 0, 0.04);\r\n    border-radius: 4px;\r\n}\r\n\r\n.import-info-header,\r\n.import-info-text {\r\n    font-size: 14px;\r\n    line-height: 20px;\r\n    letter-spacing: 0.2px;\r\n    color: rgba(0, 0, 0, 0.54);\r\n}\r\n\r\n.import-info-header {\r\n    font-weight: 700;\r\n}\r\n\r\n.delim-value {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    font-weight: 700;\r\n}\r\n\r\n.example-content {\r\n    padding: 12px;\r\n    border: 1px solid rgba(0, 0, 0, 0.12);\r\n    border-radius: 6px;\r\n    background-color: rgba(255, 255, 255, 0.08);\r\n}\r\n\r\n.example-content .import-info-text {\r\n    font-size: 10px;\r\n    color: rgba(0, 0, 0, 0.38);\r\n}\r\n\r\n\r\nbutton.selected {\r\n    background-color: var(--tb-primary-500) !important;\r\n    color: var(--tb-primary-contrast-500) !important;\r\n}\r\n\r\nbutton.selected mat-icon.tb-mat-18 {\r\n    color: var(--tb-primary-contrast-500) !important;\r\n}\r\n\r\nbutton mat-icon.tb-mat-18 {\r\n    font-size: 18px;\r\n    margin-right: 4px;\r\n}\r\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\nlet PageLink = widgetContext.servicesMap.get('PageLink');\r\nopenAddDeviceDialog();\r\n\r\nfunction openAddDeviceDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n  let vm = instance;\r\n  let customerID = widgetContext.stateController.getStateParams().entityId.id;\r\n  let customerName = widgetContext.stateController.getStateParams().entityName;\r\n  let customerShortName;\r\n  vm.deviceTypes = [\r\n    'P-Flow D116',       // Doktorkit\r\n    'Room Sensor T',     // Sensorkit\r\n    'Room Sensor CO2'    // Sensorkit\r\n  ];\r\n\r\n  vm.deviceTypeShortNames = {\r\n    'P-Flow D116': 'PF',\r\n    'Room Sensor T': 'ERST',\r\n    'Room Sensor CO2': 'ERSCO2'\r\n  };\r\n\r\n  vm.selectedDeviceType = '';\r\n\r\n  vm.addDeviceFormGroup = vm.fb.group({\r\n    name: [{ value: '', disabled: true }, [vm.validators.required]], // Disabled to show as readonly\r\n    type: ['', [vm.validators.required]],\r\n    label: [''],\r\n    serialNumber: [''],\r\n    devEUI: ['', [vm.validators.pattern('[a-zA-Z0-9]{16}')]]\r\n  });\r\n\r\n  // Fetch short name and set up the name field\r\n  attributeService.getEntityAttributes({ entityType: 'CUSTOMER', id: customerID }, 'SERVER_SCOPE', ['shortName']).subscribe(attributes => {\r\n    let shortNameAttr = attributes.find(attr => attr.key === 'shortName');\r\n    customerShortName = shortNameAttr ? shortNameAttr.value : generateCustomerShortName(customerName);\r\n    \r\n    vm.addDeviceFormGroup.get('serialNumber').valueChanges.subscribe(value => {\r\n      vm.addDeviceFormGroup.get('name').setValue(constructDeviceName(customerShortName, vm.deviceTypeShortNames, vm.addDeviceFormGroup.value));\r\n    });\r\n\r\n    vm.addDeviceFormGroup.get('devEUI').valueChanges.subscribe(value => {\r\n      vm.addDeviceFormGroup.get('name').setValue(constructDeviceName(customerShortName, vm.deviceTypeShortNames, vm.addDeviceFormGroup.value));\r\n    });\r\n\r\n    vm.addDeviceFormGroup.get('type').valueChanges.subscribe(value => {\r\n      vm.addDeviceFormGroup.get('name').setValue(constructDeviceName(customerShortName, vm.deviceTypeShortNames, vm.addDeviceFormGroup.value));\r\n    });\r\n  });\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n\r\n  vm.save = function () {\r\n    var customerId = widgetContext.stateController.getStateParams().entityId;\r\n    var formValues = vm.addDeviceFormGroup.value;\r\n    formValues.name = constructDeviceName(customerShortName, vm.deviceTypeShortNames, formValues);\r\n    vm.addDeviceFormGroup.markAsPristine();\r\n    \r\n    // Check if the device is a Doktorkit or Sensorkit\r\n    if (formValues.type === 'P-Flow D116') {\r\n      getTargetDeviceGroups(customerId, 'Doktorkit Devices', 'Unassigned Doktorkit Devices').pipe(\r\n        widgetContext.rxjs.switchMap((targetDevicesGroup) => {\r\n            var DoktorkitDevicesGroup = targetDevicesGroup[0];\r\n            var unassignedDoktorkitGroup = targetDevicesGroup[1];\r\n            return saveDeviceObservable(customerId, DoktorkitDevicesGroup, unassignedDoktorkitGroup);\r\n        })\r\n      ).subscribe(\r\n        function (device) {\r\n          saveAttributes(device.id).subscribe(\r\n            function () {\r\n              widgetContext.updateAliases();\r\n              vm.dialogRef.close(null);\r\n            }\r\n          );\r\n        }\r\n      );\r\n    } else {\r\n      getTargetDeviceGroups(customerId, 'Sensorkit Devices', 'Unassigned Sensorkit Devices').pipe(\r\n        widgetContext.rxjs.switchMap((targetDevicesGroup) => {\r\n            var SensorkitDevicesGroup = targetDevicesGroup[0];\r\n            var unassignedSensorkitGroup = targetDevicesGroup[1];\r\n            return saveDeviceObservable(customerId, SensorkitDevicesGroup, unassignedSensorkitGroup);\r\n        })\r\n      ).subscribe(\r\n        function (device) {\r\n          saveAttributes(device.id).subscribe(\r\n            function () {\r\n              widgetContext.updateAliases();\r\n              vm.dialogRef.close(null);\r\n            }\r\n          );\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  function constructDeviceName(customerShortName, deviceTypeShortNames, formValues) {\r\n    let identifier = formValues.serialNumber || formValues.devEUI;\r\n    let typeShortName = deviceTypeShortNames[formValues.type] || '';\r\n    return customerShortName + \"_\" + typeShortName + \"_\" + identifier;\r\n  }\r\n\r\n  function saveDeviceObservable(customerId, primaryDevicesGroup, unassignedDevicesGroup) {\r\n    const formValues = vm.addDeviceFormGroup.value;\r\n    let device = {\r\n      name: formValues.name,\r\n      type: formValues.type,\r\n      label: formValues.label,\r\n      customerId: customerId,\r\n      serialNumber: formValues.serialNumber,\r\n      devEUI: formValues.devEUI\r\n    };\r\n    return deviceService.saveDevice(device, unassignedDevicesGroup.id.id).pipe(\r\n      widgetContext.rxjs.switchMap((savedDevice) => {\r\n        return widgetContext.rxjs.forkJoin([\r\n          entityGroupService.addEntityToEntityGroup(primaryDevicesGroup.id.id, savedDevice.id.id),\r\n          addToKitDevicesGroup(savedDevice.id.id)  // Add device to \"Kit Devices\" group\r\n        ]).pipe(\r\n          widgetContext.rxjs.map(() => {\r\n            return savedDevice;\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  function addToKitDevicesGroup(deviceId) {\r\n    return entityGroupService.getEntityGroupsByOwnerId(customerID.entityType, customerID, 'DEVICE').pipe(\r\n      widgetContext.rxjs.switchMap((groups) => {\r\n        let kitDevicesGroup = groups.find(group => group.name === 'Kit Devices');\r\n        if (kitDevicesGroup) {\r\n          return entityGroupService.addEntityToEntityGroup(kitDevicesGroup.id.id, deviceId);\r\n        } else {\r\n          let newGroup = {\r\n            type: 'DEVICE',\r\n            name: 'Kit Devices',\r\n            ownerId: customerID\r\n          };\r\n          return entityGroupService.saveEntityGroup(newGroup).pipe(\r\n            widgetContext.rxjs.switchMap((savedGroup) => {\r\n              return entityGroupService.addEntityToEntityGroup(savedGroup.id.id, deviceId);\r\n            })\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  function getTargetDeviceGroups(customerId, primaryGroupName, unassignedGroupName) {\r\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n      widgetContext.rxjs.switchMap((groups) => {\r\n        return widgetContext.rxjs.forkJoin([\r\n          getOrCreateDevicesGroup(groups, primaryGroupName, customerId),\r\n          getOrCreateDevicesGroup(groups, unassignedGroupName, customerId)\r\n        ]);\r\n      })\r\n    );\r\n  }\r\n\r\n  function getOrCreateDevicesGroup(groups, groupName, customerId) {\r\n    var devicesGroup = groups.find(group => group.name === groupName);\r\n    if (devicesGroup) {\r\n      return widgetContext.rxjs.of(devicesGroup);\r\n    } else {\r\n      devicesGroup = {\r\n        type: 'DEVICE',\r\n        name: groupName,\r\n        ownerId: customerId\r\n      };\r\n      return entityGroupService.saveEntityGroup(devicesGroup);\r\n    }\r\n  }\r\n\r\n  function saveAttributes(entityId) {\r\n    let attributesArray = [\r\n      { key: 'state', value: 'normal' },\r\n      { key: 'inactivityTimeout', value: '3700000' }\r\n    ];\r\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n  }\r\n\r\n  vm.onDeviceTypeChange = function (selectedType) {\r\n    vm.selectedDeviceType = selectedType;\r\n    if (selectedType === 'P-Flow D116') {\r\n      vm.addDeviceFormGroup.get('serialNumber').setValidators([vm.validators.required]);\r\n      vm.addDeviceFormGroup.get('devEUI').clearValidators();\r\n    } else {\r\n      vm.addDeviceFormGroup.get('serialNumber').clearValidators();\r\n      vm.addDeviceFormGroup.get('devEUI').setValidators([vm.validators.required, vm.validators.pattern('[a-zA-Z0-9]{16}')]);\r\n    }\r\n    vm.addDeviceFormGroup.get('serialNumber').updateValueAndValidity();\r\n    vm.addDeviceFormGroup.get('devEUI').updateValueAndValidity();\r\n  };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1c7c2297-0f78-e396-fa35-5f362bae07f7"
              }
            ],
            "actionCellButton": [
              {
                "name": "Edit device",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"editDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Edit device</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n      <mat-form-field class=\"mat-block\">\n        <mat-label>Device name</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"editDeviceFormGroup.get('name').hasError('required')\">\n          Device name is required.\n        </mat-error>\n      </mat-form-field>\n      <mat-form-field class=\"mat-block\">\n          <mat-label>Device type</mat-label>\n          <mat-select formControlName=\"type\" required>\n            <mat-option *ngFor=\"let type of deviceTypes\" [value]=\"type\">\n              {{ type }}\n            </mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"editDeviceFormGroup.get('type').hasError('required')\">\n            Device type is required.\n          </mat-error>\n      </mat-form-field>\n      <mat-form-field class=\"mat-block\">\n        <mat-label>Device label</mat-label>\n        <input matInput formControlName=\"label\" required>\n        <mat-error *ngIf=\"editDeviceFormGroup.get('label').hasError('required')\">\n          Device label is required.\n        </mat-error>\n      </mat-form-field>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editDeviceFormGroup.invalid || !editDeviceFormGroup.dirty\">\n      Save device\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenEditDeviceDialog();\n\nfunction openEditDeviceDialog() {\n  customDialog.customDialog(htmlTemplate, EditDeviceDialogController).subscribe();\n}\n\nfunction EditDeviceDialogController(instance) {\n  let vm = instance;\n  \n  vm.deviceTypes = [\n      'P-Flow D116',\n      'Room Sensor T',\n      'Room Sensor CO2',\n      'Chiller',\n      'Door Sensor',\n      'Freezer',\n      'Liquid Level Sensor',\n      'Motion Sensor',\n      'Occupancy Sensor',\n      'Smart Bin',\n      'Smart Shelf',\n      'Smoke Sensor'\n  ];\n\n  vm.device = {};\n\n  vm.editDeviceFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]],\n    type: ['', [vm.validators.required]],\n    label: ['', [vm.validators.required]]\n  });\n\n  getDevice();\n\n  vm.cancel = function() {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function() {\n    vm.editDeviceFormGroup.markAsPristine();\n    saveDevice().subscribe(\n      function () {\n        widgetContext.updateAliases();\n        vm.dialogRef.close(null);\n      }\n    );\n  };\n\n  function getDevice() {\n      deviceService.getDevice(entityId.id).subscribe(\n          function (device) {\n                vm.device = device;          \n                vm.editDeviceFormGroup.patchValue({\n                  name: vm.device.name,\n                  type: vm.device.type,\n                  label: vm.device.label\n                }, {emitEvent: false});\n              }\n    );\n  }\n\n  function saveDevice() {\n    const formValues = vm.editDeviceFormGroup.value;\n    vm.device.name = formValues.name;\n    if (vm.device.type !== formValues.type) {\n        vm.device.type = formValues.type;\n        vm.device.deviceProfileId = null;\n    }\n    vm.device.label = formValues.label;\n    return deviceService.saveDevice(vm.device);\n  }\n\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7e870fd2-9559-9a6e-d847-beefc971ecaa"
              },
              {
                "name": "Delete device",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenDeleteDeviceDialog();\n\nfunction openDeleteDeviceDialog() {\n  var title = 'Are you sure you want to delete the device ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the device and all related data will become unrecoverable!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteDevice();\n      }\n    }\n  );\n}\n\nfunction deleteDevice() {\n  deviceService.deleteDevice(entityId.id).subscribe(\n    function() {\n      widgetContext.updateAliases();\n    }\n  );\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "70f87b5b-3dbc-91e6-0e59-80511b0be772"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "eac6e38e-62f2-1f91-754b-299d11e87c19",
        "typeFullFqn": "system.cards.entities_table"
      },
      "0c48ee70-d617-faa5-2418-d9766c6ff378": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "d13f6078-0d81-ec59-529c-64acbbcaf470",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8768256363159095
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7481769686268884
                },
                {
                  "name": "xPos",
                  "type": "attribute",
                  "label": "xPos",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.1947251343876919
                },
                {
                  "name": "yPos",
                  "type": "attribute",
                  "label": "yPos",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8911555639185675
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8300505638957978
                },
                {
                  "name": "weight",
                  "type": "timeseries",
                  "label": "weight",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.9334528007194596
                },
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "temperature",
                  "color": "#6200ea",
                  "settings": {},
                  "_hash": 0.314068102635481,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "volumeFlow",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.297402152245241,
                  "aggregationType": "NONE",
                  "units": "L/hr",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "co2",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.48208432838586246
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "image-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "OpenStreetMap.Mapnik",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": true,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "Selected Doktorkit",
            "imageUrlAttribute": "floorplan",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": null,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 0.5,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": true,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "<div style=\"position: relative; white-space: nowrap; text-align: center; font-size: 12px; top: -5px;\"><span style=\"margin-left: -500%;\"></span><span style=\"border-radius: 10px; color: #fff; background-color: #666; padding-left: 5px; padding-right: 5px; padding-top: 3px; padding-bottom: 3px;\">${entityLabel}</span><span style=\"margin-right: -500%;\"></span></div>",
            "labelFunction": null,
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": false,
            "tooltipPattern": "<b>${entityLabel}</b><br/><span>${entityName}</span><br/><br/><link-act name='update-label'>Update label</link-act><br/><br/><link-act name='remove-device'>Remove device</link-act>",
            "tooltipFunction": null,
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -0.5,
            "color": "#FE7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var type = data['Type'];\nvar active = data['active'];\nvar state = data['state'];\nvar selectedDevice = data['selectedDevice'] === true;\nvar selectedMode = dsData.filter(function (data) { return data['selectedDevice'] === true; }).length > 0;\n\nvar status = state;\nif (active === 'false') {\n    status = 'disconnected';\n}\n\nvar text = getDeviceText(type, status);\n\nvar defaultMarkerWidth = 30;\n\nvar width = defaultMarkerWidth + getTextWidth(text);\n\nvar svgStr = getDeviceSvg(type, status, width, text, selectedDevice);\n\nvar encodedSvg = encodeURIComponent(svgStr);\n\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\n\n\n\nif (selectedDevice) {\n    width += 8;\n    defaultMarkerWidth += 8;\n}\n\nreturn {\n    url: svgUrl,\n    size: width,\n    markerOffset: [defaultMarkerWidth / 2, defaultMarkerWidth / 2],\n    tooltipOffset: [width * 0.5 - defaultMarkerWidth / 2, - (defaultMarkerWidth / 2)]\n};\n\n\n\nfunction getDeviceSvg(type, status, width, text, isSelected) {\n    var shape = getDeviceShape(type);\n    var color = getBackgroundColor(type, status);\n    var background = getDeviceBackground(color, width);\n    var svgWidth = isSelected ? (width + 8) : width;\n    var svgHeight = isSelected ? 38 : 30;\n    \n    var opacity = selectedMode && !selectedDevice ? 0.4 : 1;\n    \n    var deviceSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgWidth + '\" height=\"' + svgHeight + '\" viewBox=\"0 0 ' + svgWidth + ' ' + svgHeight + '\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                    wrapIfSelected(background + shape, isSelected);\n    if (status === 'disconnected') {\n        deviceSvg += wrapIfSelected('<path d=\"M6.92896 21.728L21.0711 7.58589L22.4853 9.00011L8.34317 23.1422L6.92896 21.728Z\" fill=\"' + color + '\"/>' +\n                     '<path d=\"M7.10692 21.3171C6.81393 21.0241 6.81393 20.5491 7.10692 20.2561L20.1852 7.17788C20.4781 6.88489 20.9532 6.88489 21.2462 7.17788V7.17788C21.5392 7.47088 21.5392 7.94591 21.2462 8.2389L8.16794 21.3171C7.87495 21.6101 7.39991 21.6101 7.10692 21.3171V21.3171Z\" fill=\"white\"/>', isSelected);\n    }\n    if (text !== '') {\n        var transform = isSelected ? '34 10' : '30 6';\n        deviceSvg += '<text transform=\"translate(' + transform + ')\" fill=\"white\" xml:space=\"preserve\" style=\"white-space: pre\" font-family=\"Roboto\" font-size=\"15.4\" font-weight=\"500\" letter-spacing=\"0em\"><tspan x=\"0.10664\" y=\"14.2637\">' + text + '</tspan></text>';\n    }\n    if (selectedDevice) {\n        deviceSvg += getDeviceSelectionStroke(width);\n    }\n    deviceSvg += '</svg>';\n    return deviceSvg;    \n}\n\nfunction wrapIfSelected(svg, isSelected) {\n    if (isSelected) {\n        return '<g transform=\"translate(4 4)\">' + svg + '</g>';\n    } else {\n        return svg;\n    }\n}\n\nfunction getDeviceBackground(color, width) {\n     if (width === 30) {\n         return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>';\n     } else {\n         return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>' + \n                '<circle cx=\"' + (width - 15) + '\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>' +\n                '<rect x=\"15\" y=\"0\" width=\"' + (width - 30) + '\" height=\"30\" rx=\"1\" fill=\"'+ color +'\"/>';\n     }\n}\n\nfunction getDeviceSelectionStroke(width) {\n     if (width === 30) {\n         return '<circle cx=\"19\" cy=\"19\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n     } else {\n         var rectWidth = width + 6;\n         return '<rect x=\"1\" y=\"1\" width=\"' + rectWidth + '\" height=\"36\" rx=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n     }\n}\n\nfunction getBackgroundColor(type, status) {\n    switch(status) {\n        case 'major':\n            return '#D5C21B';\n        case 'critical':   \n            return '#E64A19';\n        case 'disconnected':\n            return '#CAC1D2';\n        case 'normal':\n        default:    \n            switch(type) {\n                case 'Room Sensor T':\n                    return '#4A8AEC';\n                case 'Room Sensor CO2':\n                    return '#4A8AEC';\n                default:\n                    return '#1F8B4D';\n            }\n            break;\n    }\n}\n\nfunction getTextWidth(text) {\n    var width = 0;\n    for (var i = 0; i < text.length; i++) {\n        var charWidth;\n        var character = text.charAt(i);\n        if (character === ' ') {\n            charWidth = 8;\n        } else if (character === '-') {\n            charWidth = 7;\n        } else if (character === '°') {\n            charWidth = 5;\n        } else if (!isNaN(character * 1)){\n            charWidth = 9;\n        } else {\n            // Upper case\n            if (character === character.toUpperCase()) {\n                charWidth = 12;\n            // Lower case    \n            } else {\n                charWidth = 10;\n            }\n        }\n        width += charWidth;\n    }\n    return width;\n}\n\nfunction getDeviceText(type, status) {\n    switch(status) {\n        case 'disconnected':\n            return 'NO CONN';\n        case 'normal':\n        default:    \n            switch(type) {\n                case 'Room Sensor T':\n                    var temperature = Number(data['temperature']);\n                    return 'T: ' + temperature + ' °C';\n                case 'Room Sensor CO2':\n                    var co2 = Number(data['co2']);\n                    return 'CO2: ' + co2 + ' ppm';\n                case 'P-Flow D116':\n                    var vFlow = Number(data['volumeFlow']);\n                    return 'Flow: ' + vFlow  + ' L/hr';\n                default:\n                    return '';\n            }\n            break;        \n    }\n}\n\nfunction getDeviceShape(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Room Sensor T':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Room Sensor CO2':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Door Sensor':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M19 9H11V21H19V9ZM13 17C13.5523 17 14 16.5523 14 16C14 15.4477 13.5523 15 13 15C12.4477 15 12 15.4477 12 16C12 16.5523 12.4477 17 13 17Z\" fill=\"white\"/>' +\n                   '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M21 22V8C21 7.44772 20.5523 7 20 7H10C9.44772 7 9 7.44772 9 8V22H8.5C8.22386 22 8 22.2239 8 22.5C8 22.7761 8.22386 23 8.5 23H21.5C21.7761 23 22 22.7761 22 22.5C22 22.2239 21.7761 22 21.5 22H21ZM20 8H10L10 22H20V8Z\" fill=\"white\"/>';\n        case 'Motion Sensor':\n            return '<path d=\"M7.5 10C7.22386 10 7 10.2239 7 10.5C7 10.7761 7.22386 11 7.5 11H9C9 11.5523 9.44772 12 10 12H20C20.5523 12 21 11.5523 21 11H22.5C22.7761 11 23 10.7761 23 10.5C23 10.2239 22.7761 10 22.5 10H7.5Z\" fill=\"white\"/>' +\n                   '<path d=\"M17.0001 17C17.5524 17 18.0001 16.5523 18.0001 16C18.0001 15.4477 17.5524 15 17.0001 15C16.4478 15 16.0001 15.4477 16.0001 16C16.0001 16.5523 16.4478 17 17.0001 17Z\" fill=\"white\"/>' +\n                   '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15.0001 21C19.0804 21 22.4472 17.9453 22.9384 13.998C23.0066 13.45 22.5524 13 22.0001 13H8.00009C7.4478 13 6.99353 13.45 7.06173 13.998C7.55295 17.9453 10.9198 21 15.0001 21ZM17.0001 18C18.1047 18 19.0001 17.1046 19.0001 16C19.0001 14.8954 18.1047 14 17.0001 14C15.8955 14 15.0001 14.8954 15.0001 16C15.0001 17.1046 15.8955 18 17.0001 18Z\" fill=\"white\"/>';\n        case 'Occupancy Sensor':\n            return '<path d=\"M12 8.5C12 9.32843 11.3284 10 10.5 10C9.67157 10 9 9.32843 9 8.5C9 7.67157 9.67157 7 10.5 7C11.3284 7 12 7.67157 12 8.5Z\" fill=\"white\"/>' +\n                   '<path d=\"M10 22L10 19H11L11 22C11 22.5523 11.4477 23 12 23C12.5523 23 13 22.5523 13 22V17C13.5523 17 14 16.5523 14 16V12.8865C14 11.8446 13.1554 11 12.1135 11C12.0947 11 12.076 11.0005 12.0574 11.0016C12.0384 11.0005 12.0193 11 12 11L9 11C8.98072 11 8.96157 11.0005 8.94255 11.0016C8.92403 11.0005 8.90535 11 8.88652 11C7.84462 11 7 11.8446 7 12.8865V16C7 16.5523 7.44772 17 8 17V22C8 22.5523 8.44772 23 9 23C9.55229 23 10 22.5523 10 22Z\" fill=\"white\"/>' +\n                   '<path d=\"M21 23C20.4477 23 20 22.5523 20 22V19H19V22C19 22.5523 18.5523 23 18 23C17.4477 23 17 22.5523 17 22V19H15.7215C15.3724 19 15.1308 18.6513 15.2533 18.3244L17.4733 12.4045C17.7901 11.5597 18.5977 11 19.5 11C20.4023 11 21.2099 11.5597 21.5267 12.4045L23.7467 18.3244C23.8692 18.6513 23.6276 19 23.2785 19H22V22C22 22.5523 21.5523 23 21 23Z\" fill=\"white\"/>' +\n                   '<path d=\"M19.5 10C20.3284 10 21 9.32843 21 8.5C21 7.67157 20.3284 7 19.5 7C18.6716 7 18 7.67157 18 8.5C18 9.32843 18.6716 10 19.5 10Z\" fill=\"white\"/>';\n        default:\n            return '';\n    }\n}\n",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "coordinates",
            "editablePolygon": true,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3c897f",
            "polygonOpacity": 0.3,
            "usePolygonColorFunction": true,
            "polygonColorFunction": "var deviceType = data['Type'];\r\nvar status = 'normal';\r\nreturn getColor(status);\r\n\r\nfunction getColor(status) {\r\n    switch(status) {\r\n        case 'major':\r\n            return '#D5C21B';\r\n        case 'critical':   \r\n            return '#E64A19';\r\n        case 'off':\r\n        case 'disconnected':\r\n            return '#CAC1D2';\r\n        case 'normal':\r\n        default:    \r\n            return '#817889';\r\n    }\r\n}",
            "polygonStrokeColor": "#817889",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 1,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "snappable": false,
            "initDragMode": true,
            "hideAllControlButton": true,
            "hideDrawControlButton": false,
            "hideEditControlButton": false,
            "hideRemoveControlButton": false
          },
          "title": "Devices",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [],
            "tooltipAction": [
              {
                "name": "remove-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenRemoveDeviceDialog();\n\nfunction openRemoveDeviceDialog() {\n  var title = 'Are you sure you want to remove the device ' + entityName + '?';\n  var content = 'After the confirmation, the device will be unassigned from the current Doktorkit!';\n  dialogs.confirm(title, content, 'Cancel', 'Remove from Doktorkit').subscribe(\n    function(result) {\n      if (result) {\n        doRemoveDevice();\n      }\n    }\n  );\n}\n\nfunction doRemoveDevice() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var DoktorkitId = widgetContext.stateController.getStateParams().selectedDoktorkit.entityId;\n  removeDevice(entityId, DoktorkitId, customerId).subscribe(() => {\n      widgetContext.updateAliases();\n  });\n}\n\nfunction removeDevice(deviceId, DoktorkitId, customerId) {\n    return getUnassignedDevicesGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n            return widgetContext.rxjs.forkJoin([\n                entityGroupService.addEntityToEntityGroup(unassignedDevicesGroup.id.id, deviceId.id),\n                deleteDoktorkitToDeviceRelation(DoktorkitId, deviceId),\n                removePositionAttributes(deviceId)\n            ]);\n        })\n    );\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Doktorkit Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Doktorkit Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteDoktorkitToDeviceRelation(DoktorkitId, deviceId) {\n    return entityRelationService.deleteRelation(DoktorkitId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(deviceId) {\n    return attributeService.deleteEntityAttributes(deviceId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7035bc33-31d7-515b-3428-b7e43d840422"
              },
              {
                "name": "update-label",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"editDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Update label</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n      <mat-form-field class=\"mat-block\">\n        <mat-label>New label</mat-label>\n        <input matInput formControlName=\"label\" required>\n        <mat-error *ngIf=\"editDeviceFormGroup.get('label').hasError('required')\">\n          Device label is required.\n        </mat-error>\n      </mat-form-field>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editDeviceFormGroup.invalid || !editDeviceFormGroup.dirty\">\n      Update label\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenEditDeviceDialog();\n\nfunction openEditDeviceDialog() {\n  customDialog.customDialog(htmlTemplate, EditDeviceDialogController).subscribe();\n}\n\nfunction EditDeviceDialogController(instance) {\n  let vm = instance;\n  \n  vm.device = {};\n\n  vm.editDeviceFormGroup = vm.fb.group({\n    label: ['', [vm.validators.required]]\n  });\n\n  getDevice();\n\n  vm.cancel = function() {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function() {\n    vm.editDeviceFormGroup.markAsPristine();\n    saveDevice().subscribe(\n      function () {\n        widgetContext.updateAliases();\n        vm.dialogRef.close(null);\n      }\n    );\n  };\n\n  function getDevice() {\n      deviceService.getDevice(entityId.id).subscribe(\n          function (device) {\n                vm.device = device;          \n                vm.editDeviceFormGroup.patchValue({\n                  label: vm.device.label\n                }, {emitEvent: false});\n              }\n    );\n  }\n\n  function saveDevice() {\n    const formValues = vm.editDeviceFormGroup.value;\n    vm.device.label = formValues.label;\n    return deviceService.saveDevice(vm.device);\n  }\n\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "ccfd9333-1377-fc69-0671-4725f0422c0f"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "noDataDisplayMessage": "",
          "widgetCss": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "0c48ee70-d617-faa5-2418-d9766c6ff378",
        "typeFullFqn": "system.maps_v2.image_map"
      },
      "2f3d74ea-ed1f-a52a-03c1-9dfb2f956dd8": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Title",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.7261262741197994,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.859170990312162,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "Location Alias",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.3661436310629984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "installationLocation",
                  "type": "attribute",
                  "label": "Installation Location",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9713428384988825,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.906407032891368,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "Longitude",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.43074100328683707,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "Latitude",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6537625289167603,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "from",
                  "type": "attribute",
                  "label": "From",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "date",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5519683485420257,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1707571374578,
                "endTimeMs": 1707657774578
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": null,
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "40",
          "settings": {
            "widgetTitle": "Doktorkit Attributes",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": true,
            "saveButtonLabel": "Save",
            "resetButtonLabel": "Undo",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 1,
            "rowGap": 5,
            "columnGap": 10
          },
          "title": "Update Multiple Attributes",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {
            "headerButton": []
          },
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleIcon": null,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px"
        },
        "row": 0,
        "col": 0,
        "id": "2f3d74ea-ed1f-a52a-03c1-9dfb2f956dd8"
      },
      "0c7469aa-7b86-be27-5216-bc6cc702f8b1": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "entitiesTitle": "Gateways",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 15,
            "defaultSortOrder": "Name",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Devices",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "60f60877-be45-311d-9ee7-25b68c466d89",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.46096251592014714
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": false,
                    "cellContentFunction": "var type = value;\n\nvar typeSvg = getTypeSvg(type);\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ typeSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ type +'</span>' +\n       '</span>';\n            \nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Smart Shelf':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.5 2C2.22386 2 2 2.22386 2 2.5V17.5C2 17.7761 2.22386 18 2.5 18C2.77614 18 3 17.7761 3 17.5V17H17V17.5C17 17.7761 17.2239 18 17.5 ' +\n                      '18C17.7761 18 18 17.7761 18 17.5V2.5C18 2.22386 17.7761 2 17.5 2C17.2239 2 17 2.22386 17 2.5V8H14C14.5523 8 15 7.55228 15 7V4C15 3.44772 14.5523 3 14 3H11C10.4477 3 10 3.44772 10 4V7C10 ' +\n                      '7.55228 10.4477 8 11 8H7C7.55228 8 8 7.55228 8 7V6C8 5.44772 7.55228 5 7 5H6C5.44772 5 5 5.44772 5 6V7C5 7.55228 5.44772 8 6 8H3V2.5C3 2.22386 2.77614 2 2.5 2ZM17 16V9H3V16H6C5.44772 16 ' +\n                      '5 15.5523 5 15V12C5 11.4477 5.44772 11 6 11H9C9.55228 11 10 11.4477 10 12V15C10 15.5523 9.55228 16 9 16H12C11.4477 16 11 15.5523 11 15V13C11 12.4477 11.4477 12 12 12H14C14.5523 12 15 ' +\n                      '12.4477 15 13V15C15 15.5523 14.5523 16 14 16H17Z\" fill=\"#212121\"/>';\n            break;\n        case 'Freezer':            \n            typeSvg = '<rect x=\"9\" y=\"2\" width=\"2\" height=\"16\" rx=\"1\" fill=\"#212121\"/>' +\n                      '<path d=\"M12.5 3.5L10 6L7.5 3.5M12.5 16.5L10 14L7.5 16.5\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<path d=\"M16.8792 8.91509L13.4641 8.00002L14.3792 4.58496M5.62082 15.4151L6.53588 12L3.12082 11.085\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<path d=\"M5.62085 4.58491L6.53591 7.99998L3.12085 8.91504M16.8792 11.0849L13.4641 12L14.3792 15.415\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<rect x=\"16.4282\" y=\"5.13379\" width=\"2\" height=\"16\" rx=\"1\" transform=\"rotate(60 16.4282 5.13379)\" fill=\"#212121\"/>' +\n                      '<rect x=\"2.57178\" y=\"6.86621\" width=\"2\" height=\"16\" rx=\"1\" transform=\"rotate(-60 2.57178 6.86621)\" fill=\"#212121\"/>';\n            break;\n        case 'Chiller':            \n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M13.0001 7.49994C13.0001 8.53714 12.2661 9.2516 11.4454 9.64333C11.2807 9.72191 11.1185 9.75061 10.9657 9.73874C10.9881 9.82201 ' +\n                      '11.0001 9.90957 11.0001 9.99994C11.0001 10.0304 10.9988 10.0605 10.9961 10.0902C11.1511 10.0322 11.322 9.99993 11.5001 9.99993L12.5001 9.99994L13.5 9.99993C14.3285 9.99992 15.0003 ' +\n                      '10.6975 14.6435 11.4452C14.2517 12.2658 13.5373 12.9999 12.5001 12.9999C11.4629 12.9999 10.7484 12.2658 10.3567 11.4452C10.2781 11.2805 10.2494 11.1184 10.2613 10.9655C10.178 10.988 ' +\n                      '10.0905 10.9999 10.0001 10.9999C9.96965 10.9999 9.93949 10.9986 9.90971 10.9959C9.96779 11.1509 10 11.3218 10 11.5L10 12.4999L10 13.4999C10.0001 14.3284 9.30246 15.0002 8.55482 ' +\n                      '14.6433C7.73413 14.2516 7.00006 13.5371 7.00006 12.4999C7.00006 11.4627 7.73413 10.7483 8.55482 10.3566C8.71948 10.278 8.8817 10.2493 9.03459 10.2611C9.01212 10.1779 9.00013 10.0903 ' +\n                      '9.00013 9.99994C9.00013 9.9695 9.00149 9.93938 9.00416 9.90963C8.84921 9.96766 8.67837 9.9999 8.50029 9.99989L7.50031 9.99988L6.50033 9.99989C5.67189 9.9999 5.00006 9.3023 5.35692 ' +\n                      '8.55467C5.74865 7.73397 6.46311 6.99991 7.50031 6.99991C8.5375 6.99991 9.25197 7.73397 9.6437 8.55467C9.72227 8.71929 9.75098 8.88149 9.73911 9.03435C9.82232 9.01191 9.90983 8.99994 ' +\n                      '10.0001 8.99994C10.0306 8.99994 10.0607 9.0013 10.0905 9.00397C10.0324 8.84898 10.0002 8.67807 10.0002 8.49992L10.0002 7.49994L10.0002 6.49996C10.0001 5.67153 10.6977 4.99969 11.4454 ' +\n                      '5.35655C12.2661 5.74828 13.0001 6.46274 13.0001 7.49994Z\" fill=\"#212121\"/>' +\n                      '<circle cx=\"10\" cy=\"10\" r=\"8\" stroke=\"#212121\" stroke-width=\"2\"/>';\n            break;                      \n        case 'Smart Bin':\n            typeSvg = '<path d=\"M6.71849 14C5.15241 14 4.19394 12.2816 5.01686 10.9491L5.09816 10.8175C5.17797 10.8327 5.26094 10.8383 5.34575 10.8332C5.89704 10.8001 6.31713 10.3264 6.28404 9.77509L6.21705 8.65906C6.19838 8.34795 6.03571 8.06333 5.77714 7.88933C5.51856 7.71533 5.19363 7.67184 4.8984 7.77171L3.93237 8.09851C3.40921 8.27549 3.12858 8.84306 3.30556 9.36622C3.34237 9.47504 3.39608 9.57337 3.46278 9.65927L3.31523 9.89818C1.66939 12.5631 3.58633 16 6.71849 16H7.83485C8.38714 16 8.83485 15.5523 8.83485 15C8.83485 14.4478 8.38714 14 7.83485 14L6.71849 14Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M13.3135 13.8409C14.8789 13.8873 15.8879 12.198 15.1048 10.8418L14.5467 9.87495C14.2705 9.39666 14.4344 8.78507 14.9127 8.50893C15.391 8.23279 16.0026 8.39666 16.2787 8.87495L16.8369 9.84175C18.403 12.5543 16.3849 15.9329 13.2542 15.84L12.9735 15.8317C12.9324 15.9324 12.8741 16.0281 12.7983 16.1143C12.4337 16.5292 11.8019 16.5699 11.387 16.2054L10.621 15.5322C10.3869 15.3264 10.2621 15.0233 10.2835 14.7123C10.3049 14.4014 10.47 14.1182 10.7301 13.9465L11.6632 13.3305C12.124 13.0262 12.7444 13.1531 13.0487 13.614C13.0955 13.6849 13.1321 13.7596 13.1588 13.8363L13.3135 13.8409Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M11.6696 5.21002C10.9272 3.83113 8.95968 3.80195 8.17664 5.15821L7.61846 6.12501C7.34232 6.6033 6.73073 6.76718 6.25244 6.49104C5.77414 6.21489 5.61027 5.6033 5.88641 5.12501L6.44459 4.15821C8.01067 1.44568 11.9456 1.50404 13.4306 4.26183L13.5637 4.50907C13.6715 4.49425 13.7835 4.4969 13.8961 4.51943C14.4377 4.62774 14.7889 5.15457 14.6806 5.69613L14.4806 6.69613C14.4195 7.00175 14.2193 7.26139 13.9393 7.39833C13.6594 7.53526 13.3315 7.53382 13.0528 7.39444L12.0528 6.89444C11.5588 6.64745 11.3586 6.04678 11.6056 5.5528C11.6436 5.47681 11.6899 5.40777 11.743 5.34624L11.6696 5.21002Z\" fill=\"#212121\"/>';\n            break;          \n        case 'Door Sensor':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 4H6V16H14V4ZM8 12C8.55228 12 9 11.5523 9 11C9 10.4477 8.55228 10 8 10C7.44772 10 7 10.4477 7 11C7 11.5523 7.44772 12 8 12Z\" fill=\"#212121\"/>' +\n                      '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16 17V3C16 2.44772 15.5523 2 15 2H5C4.44772 2 4 2.44772 4 3V17H3.5C3.22386 17 3 17.2239 3 17.5C3 17.7761 3.22386 18 3.5 18H16.5C16.7761 18 17 17.7761 17 17.5C17 17.2239 16.7761 17 16.5 17H16ZM15 3H5L5 17H15V3Z\" fill=\"#212121\"/>';\n            break;\n        case 'Liquid Level Sensor':\n            typeSvg = '<path d=\"M14.6363 0.453212C14.8228 0.210257 15.1772 0.210257 15.3637 0.453213C15.9404 1.2044 17 2.73057 17 3.80373C17 5.02723 16.1143 5.99982 15 5.99982C13.8857 5.99982 13 5.02723 13 3.80373C13 2.73057 14.0596 1.2044 14.6363 0.453212Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M8.3017 2.76073C8.67788 2.33798 9.32212 2.33798 9.6983 2.76073C11.2801 4.53832 15 9.0479 15 12.1437C15 15.4064 12.3427 18 9 18C5.65725 18 3 15.4064 3 12.1437C3 9.0479 6.71994 4.53832 8.3017 2.76073Z\" fill=\"#212121\"/>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<path d=\"M2.5 5C2.22386 5 2 5.22386 2 5.5C2 5.77614 2.22386 6 2.5 6H4C4 6.55228 4.44772 7 5 7H15C15.5523 7 16 6.55228 16 6H17.5C17.7761 6 18 5.77614 18 5.5C18 5.22386 17.7761 5 17.5 5H2.5Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M12.0001 12C12.5524 12 13.0001 11.5523 13.0001 11C13.0001 10.4477 12.5524 10 12.0001 10C11.4478 10 11.0001 10.4477 11.0001 11C11.0001 11.5523 11.4478 12 12.0001 12Z\" fill=\"#212121\"/>' +\n                      '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10.0001 16C14.0804 16 17.4472 12.9453 17.9384 8.99801C18.0066 8.44996 17.5524 8 17.0001 8H3.00009C2.4478 8 1.99353 8.44996 2.06173 8.99801C2.55295 12.9453 5.91978 16 10.0001 16ZM12.0001 13C13.1047 13 14.0001 12.1046 14.0001 11C14.0001 9.89543 13.1047 9 12.0001 9C10.8955 9 10.0001 9.89543 10.0001 11C10.0001 12.1046 10.8955 13 12.0001 13Z\" fill=\"#212121\"/>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<path d=\"M7 3.5C7 4.32843 6.32843 5 5.5 5C4.67157 5 4 4.32843 4 3.5C4 2.67157 4.67157 2 5.5 2C6.32843 2 7 2.67157 7 3.5Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M3 12C2.44772 12 2 11.5523 2 11L2 7.88652C2 6.84462 2.84462 6 3.88652 6C3.90535 6 3.92403 6.00055 3.94255 6.00162C3.96157 6.00055 3.98072 6 4 6H7C7.01928 6 7.03843 6.00055 7.05745 6.00162C7.07597 6.00055 7.09465 6 7.11348 6C8.15538 6 9 6.84462 9 7.88652V11C9 11.5523 8.55229 12 8 12V17C8 17.5523 7.55228 18 7 18C6.44772 18 6 17.5523 6 17L6 14H5V17C5 17.5523 4.55228 18 4 18C3.44772 18 3 17.5523 3 17V12Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M16 18C15.4477 18 15 17.5523 15 17V14H14V17C14 17.5523 13.5523 18 13 18C12.4477 18 12 17.5523 12 17V14H10.7215C10.3724 14 10.1308 13.6513 10.2533 13.3244L12.4733 7.40449C12.7901 6.55968 13.5977 6 14.5 6C15.4023 6 16.2099 6.55968 16.5267 7.40449L18.7467 13.3244C18.8692 13.6513 18.6276 14 18.2785 14H17V17C17 17.5523 16.5523 18 16 18Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M14.5 5C15.3284 5 16 4.32843 16 3.5C16 2.67157 15.3284 2 14.5 2C13.6716 2 13 2.67157 13 3.5C13 4.32843 13.6716 5 14.5 5Z\" fill=\"#212121\"/>';\n            break;\n        case 'Smoke Sensor':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9.64491 2.08319C9.48444 1.9888 9.28482 1.99138 9.12685 2.08988C8.96887 2.18839 8.87871 2.3665 8.89285 2.55213C8.98169 3.71876 8.78795 4.5943 8.45363 5.30483C8.11607 6.02225 7.62209 6.60008 7.06387 7.157C6.88401 7.33644 6.69008 7.52013 6.49214 7.70763C6.10197 8.07721 5.69618 8.46158 5.35189 8.85718C4.81113 9.47853 4.35082 10.1982 4.15741 11.131C3.35478 15.0023 6.43952 18.1649 10.361 17.9822C10.41 17.9806 10.4592 17.9779 10.5088 17.9741L10.55 17.9708L10.5673 17.9695C10.6635 17.9622 10.7585 17.9532 10.8523 17.9427C10.897 17.9427 10.9422 17.9409 10.9878 17.9375C11.1369 17.9261 11.2735 17.9002 11.3976 17.8614C12.9028 17.5787 14.0571 16.8581 14.836 15.8302C15.7453 14.6303 16.1036 13.0646 15.9781 11.4151C15.7275 8.1215 13.5473 4.37866 9.64491 2.08319ZM12.1372 15.5326C12.1487 15.5269 12.1601 15.521 12.1714 15.5152C12.2227 15.2706 12.2393 15.0003 12.2172 14.7101C12.1353 13.6344 11.5243 12.3752 10.3912 11.4298C10.3443 11.6743 10.2711 11.8979 10.1767 12.1045C9.97248 12.5515 9.68116 12.8915 9.40451 13.1748C9.2918 13.2902 9.1897 13.3891 9.09461 13.4812C8.93666 13.6341 8.79804 13.7684 8.66241 13.9284C8.46694 14.1591 8.33595 14.3839 8.28119 14.6575C8.20904 15.018 8.23357 15.3634 8.33595 15.6725C8.69526 15.8186 9.08844 15.9185 9.50948 15.9633C9.62655 15.764 9.79981 15.6036 9.97777 15.4389C10.3505 15.0938 10.7439 14.7297 10.6844 13.949C11.3929 14.3558 11.8813 14.938 12.1372 15.5326ZM13.2143 14.6343L13.2159 14.6563L13.2421 14.6222C13.7907 13.8983 14.0816 12.8503 13.9839 11.5668C13.8301 9.5445 12.7138 7.15459 10.6097 5.25541C10.5143 5.57021 10.3981 5.86993 10.2634 6.15628C9.78098 7.18157 9.09869 7.9521 8.47652 8.57282C8.20885 8.83986 7.97694 9.05847 7.76612 9.25719C7.43058 9.57348 7.14846 9.83941 6.86065 10.1701C6.45742 10.6334 6.21678 11.0502 6.11585 11.537C5.83546 12.8894 6.29313 14.1616 7.23945 14.9971C7.24423 14.8222 7.26422 14.6432 7.30064 14.4613C7.39921 13.9687 7.63564 13.5933 7.89951 13.2819C8.06367 13.0882 8.26661 12.8908 8.44919 12.7131C8.53584 12.6288 8.61792 12.549 8.68907 12.4761C8.93347 12.2258 9.13295 11.9826 9.26713 11.689C9.39844 11.4016 9.47964 11.0379 9.44124 10.5337C9.42702 10.347 9.51835 10.168 9.67788 10.0698C9.83741 9.97174 10.0384 9.97101 10.1986 10.068C12.0451 11.1851 13.0906 13.0082 13.2143 14.6343Z\" fill=\"#212121\"/>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' + \n           typeSvg +\n           '</svg>';\n} \n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.8077097060074172,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#f44336",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.4057433451983201
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "State",
                  "color": "#ffc107",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "cellContentFunction": "var state = value;\nvar active = entity.active;\nif (active === 'false') {\n    state = 'disconnected';\n}\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#607d8b",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "disabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.04680501891139488,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [],
            "headerButton": [
              {
                "name": "Add Gateway",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"edit-entity-form\">\r\n    <mat-toolbar class=\"tb-default mat-primary\" fxLayout=\"row\" style=\"background-color: primary; border-bottom: solid 1px #0000001f;\">\r\n        <h2>Add gateway</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content style=\"height: 100%; display: flex; flex-direction: column; justify-content: space-between;\">\r\n        <mat-stepper *ngIf=\"editEntityFormGroup\" #stepper [linear]=\"true\" (selectionChange)=\"onStepChange($event)\" animationDuration=\"500ms\" style=\"flex-grow: 1;\">\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('general')\">\r\n                <ng-template matStepLabel>Gateway details</ng-template>\r\n                <div fxLayout=\"column\" fxLayoutAlign=\"start stretch\" style=\"flex-grow: 1;\" [formGroup]=\"editEntityFormGroup.get('general')\">\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>Device Type</mat-label>\r\n                        <mat-select formControlName=\"type\" placeholder=\"Select Type\">\r\n                            <mat-option value=\"MUC\">MUC.easy</mat-option>\r\n                            <mat-option value=\"IoT Gateway\">IoT Gateway</mat-option>\r\n                            <mat-option value=\"Gateway\">LoRaWAN Gateway</mat-option>\r\n                        </mat-select>\r\n                    </mat-form-field>\r\n                    <!--Fields for MUC-->\r\n                    <div *ngIf=\"editEntityFormGroup.get('general').get('type').value === 'MUC'\">\r\n                        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>Name</mat-label>\r\n                                <input matInput formControlName=\"entityName\" required>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('entityName').hasError('required')\">\r\n                                    Entity name is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>Label</mat-label>\r\n                                <input matInput formControlName=\"entityLabel\">\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div formGroupName=\"attributes\" fxLayout=\"column\">\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Display Name</mat-label>\r\n                                    <input matInput formControlName=\"displayName\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Customer</mat-label>\r\n                                    <input matInput formControlName=\"customer\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                             <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Serial Number</mat-label>\r\n                                    <input matInput formControlName=\"serialNumber\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Inactivity Timeout</mat-label>\r\n                                    <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <!-- IoT Gateway fields here -->\r\n                    <div *ngIf=\"editEntityFormGroup.get('general').get('type').value === 'IoT Gateway'\">\r\n                        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>Name</mat-label>\r\n                                <input matInput formControlName=\"entityName\" required>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('entityName').hasError('required')\">\r\n                                    Entity name is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>Label</mat-label>\r\n                                <input matInput formControlName=\"entityLabel\">\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div formGroupName=\"attributes\" fxLayout=\"column\">\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Display Name</mat-label>\r\n                                    <input matInput formControlName=\"displayName\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Customer</mat-label>\r\n                                    <input matInput formControlName=\"customer\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                             <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Serial Number</mat-label>\r\n                                    <input matInput formControlName=\"serialNumber\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Inactivity Timeout</mat-label>\r\n                                    <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <!-- Fields for LoRaWAN Gateway -->\r\n                    <div *ngIf=\"editEntityFormGroup.get('general').get('type').value === 'Gateway'\">\r\n                        <!-- LoRaWAN Gateway fields here -->\r\n                        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>Name</mat-label>\r\n                                <input matInput formControlName=\"entityName\" required>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('entityName').hasError('required')\">\r\n                                    Entity name is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>Label</mat-label>\r\n                                <input matInput formControlName=\"entityLabel\">\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div formGroupName=\"attributes\" fxLayout=\"column\">\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Display Name</mat-label>\r\n                                    <input matInput formControlName=\"displayName\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Gateway ID</mat-label>\r\n                                    <input matInput formControlName=\"gatewayID\" required pattern=\"[a-zA-Z0-9]{16}\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>Inactivity Timeout</mat-label>\r\n                                    <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <!--<div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayoutAlign=\"end center\" style=\"margin-top: auto;\">\r\n                    <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\r\n                        Cancel\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" matStepperNext type=\"button\">\r\n                        Next\r\n                    </button>\r\n                </div>-->\r\n                <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayoutAlign=\"end center\" style=\"margin-top: auto;\">\r\n                    <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\r\n                        Cancel\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" matStepperNext type=\"button\" *ngIf=\"editEntityFormGroup.get('general').get('type').value !== 'Gateway'\">\r\n                        Next\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" type=\"submit\" *ngIf=\"editEntityFormGroup.get('general').get('type').value === 'Gateway'\" [disabled]=\"(isLoading$ | async) || editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\r\n                        Create\r\n                    </button>\r\n                </div>\r\n            </mat-step>\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('credentials')\" *ngIf=\"editEntityFormGroup.get('general').get('type').value !== 'Gateway'\">\r\n                <ng-template matStepLabel>Credentials</ng-template>\r\n                <div fxLayout=\"column\" fxLayoutAlign=\"start stretch\" style=\"margin-top: 30px;\" [formGroup]=\"editEntityFormGroup.get('credentials')\">\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>Credentials Type</mat-label>\r\n                        <input matInput formControlName=\"credentialsType\" readonly>\r\n                    </mat-form-field>\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>Client ID</mat-label>\r\n                        <input matInput formControlName=\"clientId\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Client ID\" (click)=\"copyToClipboard($event, 'clientId')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('clientId').hasError('required')\">\r\n                            Client ID is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>User Name</mat-label>\r\n                        <input matInput formControlName=\"userName\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy User Name\" (click)=\"copyToClipboard($event, 'userName')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('userName').hasError('required')\">\r\n                            User Name is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>Password</mat-label>\r\n                        <input matInput [type]=\"hidePassword ? 'password' : 'text'\" formControlName=\"password\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"{{ hidePassword ? 'Show Password' : 'Hide Password' }}\" (click)=\"togglePasswordVisibility()\">\r\n                            <mat-icon>{{ hidePassword ? 'visibility' : 'visibility_off' }}</mat-icon>\r\n                        </button>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Password\" (click)=\"copyToClipboard($event, 'password')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('password').hasError('required')\">\r\n                            Password is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                </div>\r\n                <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayoutAlign=\"end center\" style=\"margin-top: auto;\">\r\n                    <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\">\r\n                        Cancel\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\r\n                        Create\r\n                    </button>\r\n                </div>\r\n            </mat-step>\r\n        </mat-stepper>\r\n    </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\n\r\nopenAddEntityDialog();\r\n\r\nfunction openAddEntityDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction getSelectedCustomerId() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    if (stateParams.entityId && stateParams.entityId.id) {\r\n        return stateParams.entityId.id;\r\n    } else {\r\n        console.error('Entity ID is undefined');\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction getSelectedCustomerName() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    try {\r\n        return stateParams.entityName;\r\n    } catch (error) {\r\n        return stateParams.entityName;\r\n    }\r\n}\r\n\r\nfunction generateRandomPassword() {\r\n    const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';\r\n    let password = '';\r\n    for (let i = 0; i < 20; i++) {\r\n        password += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return password;\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n    let vm = instance;\r\n    let customerID = widgetContext.stateController.getStateParams().entityId.id;\r\n    let customerName = widgetContext.stateController.getStateParams().entityName;\r\n    vm.allowedEntityTypes = ['ASSET', 'DEVICE', 'Gateway'];\r\n    vm.entitySearchDirection = {\r\n        from: \"FROM\",\r\n        to: \"TO\"\r\n    }\r\n\r\n    vm.editEntityFormGroup = vm.fb.group({\r\n        general: vm.fb.group({\r\n            type: ['MUC', [vm.validators.required]], // Default to MUC\r\n            entityName: [{ value: ''}, [vm.validators.required]],\r\n            entityLabel: [''],\r\n            attributes: vm.fb.group({\r\n                isGateway: [true],\r\n                inactivityTimeout: ['60'],\r\n                street: [''],\r\n                displayName: [''],\r\n                city: [''],\r\n                plz: [''],\r\n                customer: [getSelectedCustomerName()]\r\n            })\r\n        }),\r\n        credentials: vm.fb.group({\r\n            credentialsType: ['MQTT_BASIC'],\r\n            clientId: [vm.editEntityFormGroup?.get('general').get('entityName').value || '', [vm.validators.required]],\r\n            userName: ['pke', [vm.validators.required]],\r\n            password: [generateRandomPassword(), [vm.validators.required]]\r\n        }),\r\n        relations: vm.fb.array([])\r\n    });\r\n\r\n    // Update clientId whenever entityName changes\r\n    vm.editEntityFormGroup.get('general').get('entityName').valueChanges.subscribe(value => {\r\n        vm.editEntityFormGroup.get('credentials').patchValue({\r\n            clientId: value\r\n        });\r\n    });\r\n\r\n    // Initialize controls based on the initial type\r\n    updateControls();\r\n\r\n    // Function to update subscriptions whenever controls change\r\n    function setupControlSubscriptions() {\r\n        // Subscribe to entityName changes\r\n        vm.editEntityFormGroup.get('general').get('entityName').valueChanges.subscribe(value => {\r\n            vm.editEntityFormGroup.get('credentials').patchValue({\r\n                clientId: value\r\n            });\r\n        });\r\n\r\n        // Subscribe to serialNumber changes if present\r\n        const serialNumberControl = vm.editEntityFormGroup.get('general').get('attributes').get('serialNumber');\r\n        if (serialNumberControl) {\r\n            serialNumberControl.valueChanges.subscribe(() => updateEntityName());\r\n        }\r\n\r\n        // Subscribe to gatewayID changes if present\r\n        const gatewayIDControl = vm.editEntityFormGroup.get('general').get('attributes').get('gatewayID');\r\n        if (gatewayIDControl) {\r\n            gatewayIDControl.valueChanges.subscribe(() => updateEntityName());\r\n        }\r\n    }\r\n\r\n    // Function to update controls based on the selected type\r\n    function updateControls() {\r\n        const type = vm.editEntityFormGroup.get('general').get('type').value;\r\n        const attributesGroup = vm.editEntityFormGroup.get('general').get('attributes');\r\n\r\n        // Clear previous subscriptions\r\n        if (vm.serialNumberSubscription) vm.serialNumberSubscription.unsubscribe();\r\n        if (vm.gatewayIDSubscription) vm.gatewayIDSubscription.unsubscribe();\r\n\r\n        if (type === 'Gateway') {\r\n            if (!attributesGroup.contains('gatewayID')) {\r\n                attributesGroup.addControl('gatewayID', vm.fb.control(''));\r\n            }\r\n            if (attributesGroup.contains('serialNumber')) {\r\n                attributesGroup.removeControl('serialNumber');\r\n            }\r\n        } else {\r\n            if (!attributesGroup.contains('serialNumber')) {\r\n                attributesGroup.addControl('serialNumber', vm.fb.control(''));\r\n            }\r\n            if (attributesGroup.contains('gatewayID')) {\r\n                attributesGroup.removeControl('gatewayID');\r\n            }\r\n        }\r\n\r\n        // Set up new subscriptions\r\n        setupControlSubscriptions();\r\n    }\r\n\r\n   // Function to update the entity name based on current form values\r\n    function updateEntityName() {\r\n        const type = vm.editEntityFormGroup.get('general').get('type').value;\r\n        const serialNumber = vm.editEntityFormGroup.get('general').get('attributes').get('serialNumber')?.value || '';\r\n        const gatewayID = vm.editEntityFormGroup.get('general').get('attributes').get('gatewayID')?.value || '';\r\n        const customerShortName = vm.customerShortName || '';\r\n        const updatedDeviceName = constructDeviceName(customerShortName, type, serialNumber, gatewayID);\r\n        vm.editEntityFormGroup.get('general').get('entityName').setValue(updatedDeviceName);\r\n    }\r\n\r\n    // Fetch initial customer short name and set up initial entity name\r\n    attributeService.getEntityAttributes({ entityType: 'CUSTOMER', id: customerID }, 'SERVER_SCOPE', ['shortName']).subscribe(attributes => {\r\n        const shortNameAttr = attributes.find(attr => attr.key === 'shortName');\r\n        vm.customerShortName = shortNameAttr ? shortNameAttr.value : generateCustomerShortName(customerName);\r\n        updateEntityName();\r\n    });\r\n\r\n    // Subscribe to type changes to update controls and entity name\r\n    vm.editEntityFormGroup.get('general').get('type').valueChanges.subscribe(() => {\r\n        updateControls();\r\n        updateEntityName();\r\n    });\r\n\r\n    // Initialize form control subscriptions\r\n    setupControlSubscriptions();\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.relations = function () {\r\n        return vm.editEntityFormGroup.get('relations');\r\n    };\r\n\r\n    vm.save = function () {\r\n        // Get customer ID and form values\r\n        var customer = widgetContext.stateController.getStateParams().entityId;\r\n        var formValues = vm.editEntityFormGroup.value;\r\n\r\n        // Mark form as pristine\r\n        vm.editEntityFormGroup.markAsPristine();\r\n\r\n        try {\r\n            // Get target device groups\r\n            getTargetDeviceGroups(customer).pipe(\r\n                widgetContext.rxjs.switchMap((targetDevicesGroup) => {\r\n                    console.log(targetDevicesGroup[0],targetDevicesGroup[1],targetDevicesGroup[3],targetDevicesGroup[2],targetDevicesGroup[4])\r\n                    var DoktorkitDevicesGroup = targetDevicesGroup[0];\r\n                    var unassignedDoktorkitsGroup = targetDevicesGroup[1];\r\n                    var SensorDevicesGroup = targetDevicesGroup[2];\r\n                    var unassignedSensorkitGroup = targetDevicesGroup[3];\r\n                    var Gateways = targetDevicesGroup[4];\r\n\r\n                    // Save entity and handle the result\r\n                    return saveEntityObservable(customer, DoktorkitDevicesGroup, unassignedDoktorkitsGroup, SensorDevicesGroup, unassignedSensorkitGroup, Gateways);\r\n                })\r\n            ).subscribe(\r\n                function (device) {\r\n                    widgetContext.rxjs.forkJoin([\r\n                        saveAttributes(device.id),\r\n                        updateCredentials(device.id),\r\n                        saveRelations(device.id)\r\n                    ]).subscribe(\r\n                        function () {\r\n                            widgetContext.updateAliases();\r\n                            vm.dialogRef.close(null);\r\n                        },\r\n                        function (error) {\r\n                            widgetContext.dialogs.alert('Error saving attributes/credentials/relations:', error.message);\r\n                        }\r\n                    );\r\n                },\r\n                function (error) {\r\n                    widgetContext.dialogs.alert('Error saving entity:', error.message);\r\n                }\r\n            );\r\n        } catch (error) {\r\n            widgetContext.dialogs.alert('Unexpected error:', error.message);\r\n        }\r\n    };\r\n\r\n    vm.copyToClipboard = function (event, controlName) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const value = vm.editEntityFormGroup.get('credentials').get(controlName).value;\r\n        navigator.clipboard.writeText(value);\r\n    };\r\n\r\n    vm.onDeviceTypeChange = function(stepper) {\r\n        const type = vm.editEntityFormGroup.get('general').get('type').value;\r\n        if (type === 'Gateway') {\r\n            vm.editEntityFormGroup.get('credentials').disable();\r\n            stepper.selectedIndex = 0; // Reset stepper to the first step\r\n        } else {\r\n            vm.editEntityFormGroup.get('credentials').enable();\r\n            if (stepper.selectedIndex === 0) {\r\n                stepper.selectedIndex = 1; // Move to the next step if currently on the first step\r\n            }\r\n        }\r\n    };\r\n\r\n    vm.editEntityFormGroup.get('general').get('type').valueChanges.subscribe(type => {\r\n        if (type === 'Gateway') {\r\n            vm.editEntityFormGroup.get('credentials').disable();\r\n        } else {\r\n            vm.editEntityFormGroup.get('credentials').enable();\r\n        }\r\n    });\r\n\r\n    vm.hidePassword = true; // Initial State for password\r\n\r\n    vm.togglePasswordVisibility = function() {\r\n        vm.hidePassword = !vm.hidePassword;\r\n    };\r\n\r\n    vm.copyToClipboard = function (event, controlName) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const value = vm.editEntityFormGroup.get(controlName.split('.')).value;\r\n        navigator.clipboard.writeText(value).then(() => {\r\n            widgetContext.showSuccessToast('Copied to clipboard!', 2000, 'top', 'center');\r\n        }).catch(err => {\r\n            widgetContext.showErrorToast('Failed to copy to clipboard.', 2000, 'top', 'center');\r\n        });\r\n    };\r\n\r\n    function getTargetDeviceGroups(customerId) {\r\n        return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n            widgetContext.rxjs.switchMap((groups) => {\r\n                return widgetContext.rxjs.forkJoin([\r\n                    getOrCreateDevicesGroup(groups, 'Doktorkit Devices', customerId),\r\n                    getOrCreateDevicesGroup(groups, 'Unassigned Doktorkit Devices', customerId),\r\n                    getOrCreateDevicesGroup(groups, 'Sensorkit Devices', customerId),\r\n                    getOrCreateDevicesGroup(groups, 'Unassigned Sensorkit Devices', customerId),\r\n                    getOrCreateDevicesGroup(groups, 'Gateways', customerId)\r\n                ]);\r\n            })\r\n        );\r\n    }\r\n\r\n    function getOrCreateDevicesGroup(groups, groupName, customerId) {\r\n        var devicesGroup = groups.find(group => group.name === groupName);\r\n        if (devicesGroup) {\r\n            return widgetContext.rxjs.of(devicesGroup);\r\n        } else {\r\n            devicesGroup = {\r\n                type: 'DEVICE',\r\n                name: groupName,\r\n                ownerId: customerId\r\n            };\r\n            return entityGroupService.saveEntityGroup(devicesGroup);\r\n        }\r\n    }\r\n\r\n    function saveEntityObservable(customerId, DoktorkitDevicesGroup, unassignedDoktorkitsGroup, SensorDevicesGroup, unassignedSensorkitGroup, Gateways) {\r\n        const formValues = vm.editEntityFormGroup.get('general').value;\r\n        console.log(\"entity Values:\",formValues.entityName,formValues.type, formValues.entityLabel,customerId);\r\n        let entity = {\r\n            name: formValues.entityName,\r\n            type: formValues.type,\r\n            label: formValues.entityLabel,\r\n            customerId: customerId\r\n        };\r\n\r\n        let targetGroup;\r\n        let unassignedGroup;\r\n        if (formValues.type === 'MUC' || 'IOT Gateway') {\r\n            targetGroup = DoktorkitDevicesGroup.id.id;\r\n            unassignedGroup = unassignedDoktorkitsGroup.id.id;\r\n        } else if (formValues.type === 'Gateway') {\r\n            targetGroup = SensorDevicesGroup.id.id;\r\n            unassignedGroup = unassignedSensorkitGroup.id.id;\r\n        }\r\n\r\n        return deviceService.saveDevice(entity, unassignedGroup).pipe(\r\n            widgetContext.rxjs.switchMap((savedDevice) => {\r\n                return entityGroupService.addEntityToEntityGroup(targetGroup, savedDevice.id.id).pipe(\r\n                    widgetContext.rxjs.switchMap(() => {\r\n                        return entityGroupService.addEntityToEntityGroup(Gateways.id.id, savedDevice.id.id).pipe(\r\n                            widgetContext.rxjs.map(() => savedDevice)\r\n                        );\r\n                    })\r\n                );\r\n            })\r\n        );\r\n    }\r\n\r\n    function constructDeviceName(customerShortName, type, serialNumber = '', gatewayID = '') {\r\n        return type === 'Gateway' ? `${customerShortName}_gw_${gatewayID}` : `${customerShortName}_gw_${serialNumber}`;\r\n    }    \r\n\r\n    function updateCredentials(entityId) {\r\n        return deviceService.getDeviceCredentials(entityId.id).pipe(\r\n            widgetContext.rxjs.mergeMap(existingCredentials => {\r\n                let credentials = vm.editEntityFormGroup.get('credentials').value;\r\n                let deviceCredentials = {\r\n                    id: existingCredentials.id,\r\n                    deviceId: existingCredentials.deviceId,\r\n                    credentialsType: credentials.credentialsType,\r\n                    credentialsValue: JSON.stringify({\r\n                        clientId: credentials.clientId,\r\n                        userName: credentials.userName,\r\n                        password: credentials.password\r\n                    })\r\n                };\r\n                return deviceService.saveDeviceCredentials(deviceCredentials);\r\n            }),\r\n            widgetContext.rxjs.catchError(error => {\r\n                widgetContext.showErrorToast(`Failed to update credentials: ${error.message}`, 4000, 'top', 'center');\r\n                return widgetContext.rxjs.throwError(error);\r\n            })\r\n        );\r\n    }\r\n    \r\n    function saveAttributes(entityId) {\r\n        let attributes = vm.editEntityFormGroup.get('general').get('attributes').value;\r\n        attributes.inactivityTimeout *= 60000; // inactivityTimeout = 60 Min\r\n        let attributesArray = [];\r\n        for (let key in attributes) {\r\n            if (attributes[key] !== null) {\r\n                attributesArray.push({\r\n                    key: key,\r\n                    value: attributes[key]\r\n                });\r\n            }\r\n        }\r\n        if (attributesArray.length > 0) {\r\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n\r\n    function saveRelations(entityId) {\r\n        let relations = vm.editEntityFormGroup.get('relations').value;\r\n        let tasks = [];\r\n        for (let i = 0; i < relations.length; i++) {\r\n            let relation = {\r\n                type: relations[i].relationType,\r\n                typeGroup: 'COMMON'\r\n            };\r\n            if (relations[i].direction == 'FROM') {\r\n                relation.to = relations[i].relatedEntity;\r\n                relation.from = entityId;\r\n            } else {\r\n                relation.to = entityId;\r\n                relation.from = relations[i].relatedEntity;\r\n            }\r\n            tasks.push(entityRelationService.saveRelation(relation));\r\n        }\r\n        if (tasks.length > 0) {\r\n            return widgetContext.rxjs.forkJoin(tasks);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "dd13ad24-5569-02a3-b26d-446d9e9d436b"
              }
            ],
            "actionCellButton": [
              {
                "name": "Edit device",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"editDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Edit device</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n      <mat-form-field class=\"mat-block\">\n        <mat-label>Device name</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"editDeviceFormGroup.get('name').hasError('required')\">\n          Device name is required.\n        </mat-error>\n      </mat-form-field>\n      <mat-form-field class=\"mat-block\">\n          <mat-label>Device type</mat-label>\n          <mat-select formControlName=\"type\" required>\n            <mat-option *ngFor=\"let type of deviceTypes\" [value]=\"type\">\n              {{ type }}\n            </mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"editDeviceFormGroup.get('type').hasError('required')\">\n            Device type is required.\n          </mat-error>\n      </mat-form-field>\n      <mat-form-field class=\"mat-block\">\n        <mat-label>Device label</mat-label>\n        <input matInput formControlName=\"label\" required>\n        <mat-error *ngIf=\"editDeviceFormGroup.get('label').hasError('required')\">\n          Device label is required.\n        </mat-error>\n      </mat-form-field>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editDeviceFormGroup.invalid || !editDeviceFormGroup.dirty\">\n      Save device\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenEditDeviceDialog();\n\nfunction openEditDeviceDialog() {\n  customDialog.customDialog(htmlTemplate, EditDeviceDialogController).subscribe();\n}\n\nfunction EditDeviceDialogController(instance) {\n  let vm = instance;\n  \n  vm.deviceTypes = [\n      'MUC',\n      'LoRaWAN Gateway'\n  ];\n\n  vm.device = {};\n\n  vm.editDeviceFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]],\n    type: ['', [vm.validators.required]],\n    label: ['', [vm.validators.required]]\n  });\n\n  getDevice();\n\n  vm.cancel = function() {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function() {\n    vm.editDeviceFormGroup.markAsPristine();\n    saveDevice().subscribe(\n      function () {\n        widgetContext.updateAliases();\n        vm.dialogRef.close(null);\n      }\n    );\n  };\n\n  function getDevice() {\n      deviceService.getDevice(entityId.id).subscribe(\n          function (device) {\n                vm.device = device;          \n                vm.editDeviceFormGroup.patchValue({\n                  name: vm.device.name,\n                  type: vm.device.type,\n                  label: vm.device.label\n                }, {emitEvent: false});\n              }\n    );\n  }\n\n  function saveDevice() {\n    const formValues = vm.editDeviceFormGroup.value;\n    vm.device.name = formValues.name;\n    if (vm.device.type !== formValues.type) {\n        vm.device.type = formValues.type;\n        vm.device.deviceProfileId = null;\n    }\n    vm.device.label = formValues.label;\n    return deviceService.saveDevice(vm.device);\n  }\n\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7e870fd2-9559-9a6e-d847-beefc971ecaa"
              },
              {
                "name": "Delete device",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenDeleteDeviceDialog();\n\nfunction openDeleteDeviceDialog() {\n  var title = 'Are you sure you want to delete the device ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the device and all related data will become unrecoverable!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteDevice();\n      }\n    }\n  );\n}\n\nfunction deleteDevice() {\n  deviceService.deleteDevice(entityId.id).subscribe(\n    function() {\n      widgetContext.updateAliases();\n    }\n  );\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "70f87b5b-3dbc-91e6-0e59-80511b0be772"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "0c7469aa-7b86-be27-5216-bc6cc702f8b1",
        "typeFullFqn": "system.cards.entities_table"
      },
      "3e37bd68-28bb-243c-012d-785d1b7d92bf": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1713435502260,
                "endTimeMs": 1713521902260
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "displayEntityLabel": false,
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "entitiesTitle": "Entities"
          },
          "title": "Entities table",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d13f6078-0d81-ec59-529c-64acbbcaf470",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.1849002505353028
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8128568406469565,
                  "decimals": 0
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.3089029814236317,
                  "decimals": 0
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9719730919393044,
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "actionCellButton": [
              {
                "name": "Add Device to Doctorkit",
                "icon": "medical_services",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!--=======================================================================-->\n<!--=====  There are two example templates: for edit and add entity   =====-->\n<!--=======================================================================-->\n<!--========================  Edit entity example  ========================-->\n<!--=======================================================================-->\n<!-- -->\n<!--<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\"-->\n<!--      (ngSubmit)=\"save()\"  class=\"edit-entity-form\">-->\n<!--    <mat-toolbar fxLayout=\"row\" color=\"primary\">-->\n<!--        <h2>Edit {{entityType.toLowerCase()}} {{entityName}}</h2>-->\n<!--        <span fxFlex></span>-->\n<!--        <button mat-icon-button (click)=\"cancel()\" type=\"button\">-->\n<!--            <mat-icon class=\"material-icons\">close</mat-icon>-->\n<!--        </button>-->\n<!--    </mat-toolbar>-->\n<!--    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">-->\n<!--    </mat-progress-bar>-->\n<!--    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>-->\n<!--    <div mat-dialog-content fxLayout=\"column\">-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Name</mat-label>-->\n<!--                <input matInput formControlName=\"entityName\" required readonly=\"\">-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Label</mat-label>-->\n<!--                <input matInput formControlName=\"entityLabel\">-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Type</mat-label>-->\n<!--                <input matInput formControlName=\"entityType\" readonly>-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Type</mat-label>-->\n<!--                <input matInput formControlName=\"type\" readonly>-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div formGroupName=\"attributes\" fxLayout=\"column\">-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Latitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Longitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Address</mat-label>-->\n<!--                    <input matInput formControlName=\"address\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Owner</mat-label>-->\n<!--                    <input matInput formControlName=\"owner\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Integer Value</mat-label>-->\n<!--                    <input type=\"number\" step=\"1\" matInput formControlName=\"number\">-->\n<!--                    <mat-error *ngIf=\"editEntityFormGroup.get('attributes.number').hasError('pattern')\">-->\n<!--                        Invalid integer value.-->\n<!--                    </mat-error>-->\n<!--                </mat-form-field>-->\n<!--                <div class=\"boolean-value-input\" fxLayout=\"column\" fxLayoutAlign=\"center start\" fxFlex>-->\n<!--                    <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                    <mat-checkbox formControlName=\"booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                        {{ (editEntityFormGroup.get('attributes.booleanValue').value ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                    </mat-checkbox>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list old-relations\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"oldRelations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"oldRelations\" -->\n<!--                     *ngFor=\"let relation of oldRelations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        required=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        required=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeOldRelation(i, relation.value)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">New Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"relations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"relations\" *ngFor=\"let relation of relations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        [required]=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        [required]=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeRelation(i)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--            <div>-->\n<!--                <button mat-raised-button color=\"primary\"-->\n<!--                        type=\"button\"-->\n<!--                        (click)=\"addRelation()\"-->\n<!--                        matTooltip=\"Add Relation\"-->\n<!--                        matTooltipPosition=\"above\">-->\n<!--                    Add-->\n<!--                </button>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--    </div>-->\n<!--    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">-->\n<!--        <button mat-button color=\"primary\"-->\n<!--                type=\"button\"-->\n<!--                [disabled]=\"(isLoading$ | async)\"-->\n<!--                (click)=\"cancel()\" cdkFocusInitial>-->\n<!--            Cancel-->\n<!--        </button>-->\n<!--        <button mat-button mat-raised-button color=\"primary\"-->\n<!--                type=\"submit\"-->\n<!--                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">-->\n<!--            Save-->\n<!--        </button>-->\n<!--    </div>-->\n<!--</form>-->\n<!---->\n<!--========================================================================-->\n<!--=========================  Add entity example  =========================-->\n<!--========================================================================-->\n<!---->\n<!--<form #addEntityForm=\"ngForm\" [formGroup]=\"addEntityFormGroup\"-->\n<!--      (ngSubmit)=\"save()\" class=\"add-entity-form\">-->\n<!--    <mat-toolbar fxLayout=\"row\" color=\"primary\">-->\n<!--        <h2>Add entity</h2>-->\n<!--        <span fxFlex></span>-->\n<!--        <button mat-icon-button (click)=\"cancel()\" type=\"button\">-->\n<!--            <mat-icon class=\"material-icons\">close</mat-icon>-->\n<!--        </button>-->\n<!--    </mat-toolbar>-->\n<!--    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">-->\n<!--    </mat-progress-bar>-->\n<!--    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>-->\n<!--    <div mat-dialog-content fxLayout=\"column\">-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Name</mat-label>-->\n<!--                <input matInput formControlName=\"entityName\" required>-->\n<!--                <mat-error *ngIf=\"addEntityFormGroup.get('entityName').hasError('required')\">-->\n<!--                    Entity name is required.-->\n<!--                </mat-error>-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Label</mat-label>-->\n<!--                <input matInput formControlName=\"entityLabel\" >-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <tb-entity-type-select-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"entityType\"-->\n<!--                    [showLabel]=\"true\"-->\n<!--                    [allowedEntityTypes]=\"allowedEntityTypes\"-->\n<!--            ></tb-entity-type-select>-->\n<!--            <tb-entity-subtype-autocomplete-->\n<!--                    fxFlex *ngIf=\"addEntityFormGroup.get('entityType').value == 'ASSET'\"-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"type\"-->\n<!--                    [required]=\"true\"-->\n<!--                    [entityType]=\"'ASSET'\"-->\n<!--            ></tb-entity-subtype-autocomplete>-->\n<!--            <tb-entity-subtype-autocomplete-->\n<!--                    fxFlex *ngIf=\"addEntityFormGroup.get('entityType').value != 'ASSET'\"-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"type\"-->\n<!--                    [required]=\"true\"-->\n<!--                    [entityType]=\"'DEVICE'\"-->\n<!--            ></tb-entity-subtype-autocomplete>-->\n<!--        </div>-->\n<!--        <div formGroupName=\"attributes\" fxLayout=\"column\">-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Latitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Longitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Address</mat-label>-->\n<!--                    <input matInput formControlName=\"address\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Owner</mat-label>-->\n<!--                    <input matInput formControlName=\"owner\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Integer Value</mat-label>-->\n<!--                    <input type=\"number\" step=\"1\" matInput formControlName=\"number\">-->\n<!--                    <mat-error *ngIf=\"addEntityFormGroup.get('attributes.number').hasError('pattern')\">-->\n<!--                        Invalid integer value.-->\n<!--                    </mat-error>-->\n<!--                </mat-form-field>-->\n<!--                <div class=\"boolean-value-input\" fxLayout=\"column\" fxLayoutAlign=\"center start\" fxFlex>-->\n<!--                    <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                    <mat-checkbox formControlName=\"booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                        {{ (addEntityFormGroup.get('attributes.booleanValue').value ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                    </mat-checkbox>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"relations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"relations\" *ngFor=\"let relation of relations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        [required]=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        [required]=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeRelation(i)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--            <div>-->\n<!--                <button mat-raised-button color=\"primary\"-->\n<!--                        type=\"button\"-->\n<!--                        (click)=\"addRelation()\"-->\n<!--                        matTooltip=\"Add Relation\"-->\n<!--                        matTooltipPosition=\"above\">-->\n<!--                    Add-->\n<!--                </button>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--    </div>-->\n<!--    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">-->\n<!--        <button mat-button color=\"primary\"-->\n<!--                type=\"button\"-->\n<!--                [disabled]=\"(isLoading$ | async)\"-->\n<!--                (click)=\"cancel()\" cdkFocusInitial>-->\n<!--            Cancel-->\n<!--        </button>-->\n<!--        <button mat-button mat-raised-button color=\"primary\"-->\n<!--                type=\"submit\"-->\n<!--                [disabled]=\"(isLoading$ | async) || addEntityForm.invalid || !addEntityForm.dirty\">-->\n<!--            Create-->\n<!--        </button>-->\n<!--    </div>-->\n<!--</form>-->\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "/*=======================================================================*/\n/*=====  There are three examples: for delete, edit and add entity  =====*/\n/*=======================================================================*/\n/*=======================  Delete entity example  =======================*/\n/*=======================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//\n//openDeleteEntityDialog();\n//\n//function openDeleteEntityDialog() {\n//    let title = 'Delete ' + entityId.entityType.toLowerCase() + ' ' +\n//                 entityName;\n//    let content = 'Are you sure you want to delete the ' +\n//                  entityId.entityType.toLowerCase() + ' ' + entityName + '?';\n//    dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n//        function(result) {\n//            if (result) {\n//                deleteEntity();\n//            }\n//        }\n//    );\n//}\n//\n//function deleteEntity() {\n//    deleteEntityObservable(entityId).subscribe(\n//        function success() {\n//            widgetContext.updateAliases();\n//        },\n//        function fail() {\n//            showErrorDialog();\n//        }\n//    );\n//}\n//\n//function deleteEntityObservable(entityId) {\n//    if (entityId.entityType == \"ASSET\") {\n//        return assetService.deleteAsset(entityId.id);\n//    } else if (entityId.entityType == \"DEVICE\") {\n//        return deviceService.deleteDevice(entityId.id);\n//    }\n//}\n//\n//function showErrorDialog() {\n//    let title = 'Error';\n//    let content = 'An error occurred while deleting the entity. Please try again.';\n//    dialogs.alert(title, content, 'CLOSE').subscribe(\n//        function(result) {}\n//    );\n//}\n//\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\n//let entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//let attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n//let entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n//\n//openEditEntityDialog();\n//\n//function openEditEntityDialog() {\n//    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n//}\n//\n//function EditEntityDialogController(instance) {\n//    let vm = instance;\n//\n//    vm.entityName = entityName;\n//    vm.entityType = entityId.entityType;\n//    vm.entitySearchDirection = {\n//        from: \"FROM\",\n//        to: \"TO\"\n//    };\n//    vm.attributes = {};\n//    vm.oldRelationsData = [];\n//    vm.relationsToDelete = [];\n//    vm.entity = {};\n//\n//    vm.editEntityFormGroup = vm.fb.group({\n//        entityName: ['', [vm.validators.required]],\n//        entityType: [null],\n//        entityLabel: [null],\n//        type: ['', [vm.validators.required]],\n//        attributes: vm.fb.group({\n//            latitude: [null],\n//            longitude: [null],\n//            address: [null],\n//            owner: [null],\n//            number: [null, [vm.validators.pattern(/^-?[0-9]+$/)]],\n//            booleanValue: [false]\n//        }),\n//        oldRelations: vm.fb.array([]),\n//        relations: vm.fb.array([])\n//    });\n//\n//    getEntityInfo();\n//\n//    vm.cancel = function() {\n//        vm.dialogRef.close(null);\n//    };\n//\n//    vm.relations = function() {\n//        return vm.editEntityFormGroup.get('relations');\n//    };\n//\n//    vm.oldRelations = function() {\n//        return vm.editEntityFormGroup.get('oldRelations');\n//    };\n//\n//    vm.addRelation = function() {\n//        vm.relations().push(vm.fb.group({\n//            relatedEntity: [null, [vm.validators.required]],\n//            relationType: [null, [vm.validators.required]],\n//            direction: [null, [vm.validators.required]]\n//        }));\n//    };\n//\n//    function addOldRelation() {\n//        vm.oldRelations().push(vm.fb.group({\n//            relatedEntity: [{value: null, disabled: true}, [vm.validators.required]],\n//            relationType: [{value: null, disabled: true}, [vm.validators.required]],\n//            direction: [{value: null, disabled: true}, [vm.validators.required]]\n//        }));\n//    }\n//\n//    vm.removeRelation = function(index) {\n//        vm.relations().removeAt(index);\n//        vm.relations().markAsDirty();\n//    };\n//\n//    vm.removeOldRelation = function(index, relation) {\n//        vm.oldRelations().removeAt(index);\n//        vm.relationsToDelete.push(relation);\n//        vm.oldRelations().markAsDirty();\n//    };\n//\n//    vm.save = function() {\n//        vm.editEntityFormGroup.markAsPristine();\n//        widgetContext.rxjs.forkJoin([\n//            saveAttributes(entityId),\n//            saveRelations(entityId),\n//            saveEntity()\n//        ]).subscribe(\n//            function () {\n//                widgetContext.updateAliases();\n//                vm.dialogRef.close(null);\n//            }\n//        );\n//    };\n//\n//    function getEntityAttributes(attributes) {\n//        for (var i = 0; i < attributes.length; i++) {\n//            vm.attributes[attributes[i].key] = attributes[i].value;\n//        }\n//    }\n//\n//    function getEntityRelations(relations) {\n//        let relationsFrom = relations[0];\n//        let relationsTo = relations[1];\n//        for (let i=0; i < relationsFrom.length; i++) {\n//            let relation = {\n//                direction: 'FROM',\n//                relationType: relationsFrom[i].type,\n//                relatedEntity: relationsFrom[i].to\n//            };\n//            vm.oldRelationsData.push(relation);\n//            addOldRelation();\n//        }\n//        for (let i=0; i < relationsTo.length; i++) {\n//            let relation = {\n//                direction: 'TO',\n//                relationType: relationsTo[i].type,\n//                relatedEntity: relationsTo[i].from\n//            };\n//            vm.oldRelationsData.push(relation);\n//            addOldRelation();\n//        }\n//    }\n//\n//    function getEntityInfo() {\n//         widgetContext.rxjs.forkJoin([\n//             entityRelationService.findInfoByFrom(entityId),\n//             entityRelationService.findInfoByTo(entityId),\n//             attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE'),\n//             entityService.getEntity(entityId.entityType, entityId.id)\n//         ]).subscribe(\n//             function (data) {\n//                 getEntityRelations(data.slice(0,2));\n//                 getEntityAttributes(data[2]);\n//                 vm.entity = data[3];\n//                 vm.editEntityFormGroup.patchValue({\n//                     entityName: vm.entity.name,\n//                     entityType: vm.entityType,\n//                     entityLabel: vm.entity.label,\n//                     type: vm.entity.type,\n//                     attributes: vm.attributes,\n//                     oldRelations: vm.oldRelationsData\n//                 }, {emitEvent: false});\n//             }\n//         );\n//     }\n//\n//    function saveEntity() {\n//        const formValues = vm.editEntityFormGroup.value;\n//        if (vm.entity.label !== formValues.entityLabel){\n//            vm.entity.label = formValues.entityLabel;\n//            if (formValues.entityType == 'ASSET') {\n//                return assetService.saveAsset(vm.entity);\n//            } else if (formValues.entityType == 'DEVICE') {\n//                return deviceService.saveDevice(vm.entity);\n//            }\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveAttributes(entityId) {\n//        let attributes = vm.editEntityFormGroup.get('attributes').value;\n//        let attributesArray = [];\n//        for (let key in attributes) {\n//            if (attributes[key] !== vm.attributes[key]) {\n//                attributesArray.push({key: key, value: attributes[key]});\n//            }\n//        }\n//        if (attributesArray.length > 0) {\n//            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveRelations(entityId) {\n//        let relations = vm.editEntityFormGroup.get('relations').value;\n//        let tasks = [];\n//        for(let i=0; i < relations.length; i++) {\n//            let relation = {\n//                type: relations[i].relationType,\n//                typeGroup: 'COMMON'\n//            };\n//            if (relations[i].direction == 'FROM') {\n//                relation.to = relations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = relations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        for (let i=0; i < vm.relationsToDelete.length; i++) {\n//            let relation = {\n//                type: vm.relationsToDelete[i].relationType\n//            };\n//            if (vm.relationsToDelete[i].direction == 'FROM') {\n//                relation.to = vm.relationsToDelete[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = vm.relationsToDelete[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.deleteRelation(relation.from, relation.type, relation.to));\n//        }\n//        if (tasks.length > 0) {\n//            return widgetContext.rxjs.forkJoin(tasks);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//}\n//\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//let attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n//let entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n//\n//openAddEntityDialog();\n//\n//function openAddEntityDialog() {\n//    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\n//}\n//\n//function AddEntityDialogController(instance) {\n//    let vm = instance;\n//\n//    vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\n//    vm.entitySearchDirection = {\n//        from: \"FROM\",\n//        to: \"TO\"\n//    }\n//\n//    vm.addEntityFormGroup = vm.fb.group({\n//      entityName: ['', [vm.validators.required]],\n//      entityType: ['DEVICE'],\n//      entityLabel: [null],\n//      type: ['', [vm.validators.required]],\n//      attributes: vm.fb.group({\n//          latitude: [null],\n//          longitude: [null],\n//          address: [null],\n//          owner: [null],\n//          number: [null, [vm.validators.pattern(/^-?[0-9]+$/)]],\n//          booleanValue: [null]\n//      }),\n//      relations: vm.fb.array([])\n//    });\n//\n//    vm.cancel = function() {\n//        vm.dialogRef.close(null);\n//    };\n//\n//    vm.relations = function() {\n//        return vm.addEntityFormGroup.get('relations');\n//    };\n//\n//    vm.addRelation = function() {\n//        vm.relations().push(vm.fb.group({\n//          relatedEntity: [null, [vm.validators.required]],\n//          relationType: [null, [vm.validators.required]],\n//          direction: [null, [vm.validators.required]]\n//        }));\n//    };\n//\n//    vm.removeRelation = function(index) {\n//        vm.relations().removeAt(index);\n//        vm.relations().markAsDirty();\n//    };\n//\n//    vm.save = function() {\n//        vm.addEntityFormGroup.markAsPristine();\n//        saveEntityObservable().subscribe(\n//            function (entity) {\n//                widgetContext.rxjs.forkJoin([\n//                    saveAttributes(entity.id),\n//                    saveRelations(entity.id)\n//                ]).subscribe(\n//                    function () {\n//                        widgetContext.updateAliases();\n//                        vm.dialogRef.close(null);\n//                    }\n//                );\n//            }\n//        );\n//    };\n//\n//    function saveEntityObservable() {\n//        const formValues = vm.addEntityFormGroup.value;\n//        let entity = {\n//            name: formValues.entityName,\n//            type: formValues.type,\n//            label: formValues.entityLabel\n//        };\n//        if (formValues.entityType == 'ASSET') {\n//            return assetService.saveAsset(entity);\n//        } else if (formValues.entityType == 'DEVICE') {\n//            return deviceService.saveDevice(entity);\n//        }\n//    }\n//\n//    function saveAttributes(entityId) {\n//        let attributes = vm.addEntityFormGroup.get('attributes').value;\n//        let attributesArray = [];\n//        for (let key in attributes) {\n//            if(attributes[key] !== null) {\n//                attributesArray.push({key: key, value: attributes[key]});\n//            }\n//        }\n//        if (attributesArray.length > 0) {\n//            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveRelations(entityId) {\n//        let relations = vm.addEntityFormGroup.get('relations').value;\n//        let tasks = [];\n//        for(let i=0; i < relations.length; i++) {\n//            let relation = {\n//                type: relations[i].relationType,\n//                typeGroup: 'COMMON'\n//            };\n//            if (relations[i].direction == 'FROM') {\n//                relation.to = relations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = relations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        if (tasks.length > 0) {\n//            return widgetContext.rxjs.forkJoin(tasks);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "de8b83e9-cadb-9935-a0a3-45e634805302"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "list",
          "iconColor": null,
          "titleFont": null,
          "titleColor": null,
          "enableDataExport": true,
          "desktopHide": true
        },
        "row": 0,
        "col": 0,
        "id": "3e37bd68-28bb-243c-012d-785d1b7d92bf"
      },
      "1057e70b-f6e4-a753-6411-52246b4f793d": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n     <div fxLayout=\"row\" style=\"width: 100%; height: 40px; justify-content: flex-start;\" fxLayoutAlign=\"start start\">\r\n        <h5 fxFlex class=\"market-title\">Devices</h5>\r\n        <div style=\"margin-right: 30px;\">\r\n        <button id=\"add-device\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add device manually</span></button>\r\n        <button id=\"replace-device\" mat-raised-button color=\"primary\" style=\"display: none;\">\r\n                <mat-icon class=\"tb-mat-20\">add</mat-icon>\r\n                <span>Replace Device</span>\r\n        </button>\r\n        </div> \r\n     </div>\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"doktorkit_devices_header_buttons\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 800px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Add device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Device</mat-label>\r\n          <mat-select formControlName=\"device\" required>\r\n            <mat-select-trigger>\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.label}}</div>\r\n                  <div class=\"device-name\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type}}</div>\r\n              </div>\r\n            </mat-select-trigger>\r\n            <mat-option *ngFor=\"let device of availableDevices\" [value]=\"device\">\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{device?.label}}</div>\r\n                  <div class=\"device-name\">{{device?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{device?.type}}</div>\r\n              </div>\r\n              <mat-divider></mat-divider>\r\n            </mat-option>\r\n            <mat-option *ngIf=\"!availableDevices?.length\" disabled [value]=\"null\">\r\n              <div class=\"device-item\">\r\n                No devices available\r\n              </div>\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').hasError('required')\">\r\n            Device is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Label</mat-label>\r\n          <input matInput formControlName=\"label\">\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.label').hasError('required')\">\r\n            Device label is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Attributes</ng-template>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Installation Type</mat-label>\r\n          <mat-select formControlName=\"installationType\" required>\r\n            <mat-option value=\"heating\">Heating</mat-option>\r\n            <mat-option value=\"cooling\">Cooling</mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n            Installation Type is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Outside Temperature Threshold</mat-label>\r\n          <input matInput formControlName=\"loadCourseAnalysisTemperature\" type=\"number\">\r\n        </mat-form-field>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n            <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n              <mat-option value=\"above\">Above</mat-option>\r\n              <mat-option value=\"below\">Below</mat-option>\r\n            </mat-select>\r\n            <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n              Temperature Condition is required.\r\n            </mat-error>\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Outside Temperature Threshold</mat-label>\r\n            <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n          </mat-form-field>\r\n        </div>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n        <mat-form-field class=\"mat-block\" fxFlex>\r\n          <mat-label>Maximum Power Threshold</mat-label>\r\n          <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\" fxFlex>\r\n          <mat-label>Nominal Flow</mat-label>\r\n          <input matInput formControlName=\"nominalFlow\" type=\"number\">\r\n        </mat-form-field>\r\n        </div>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Delta T</mat-label>\r\n            <input matInput formControlName=\"deltaT\" type=\"number\">\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Circulation Pump Energy Consumption</mat-label>\r\n            <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Floor Volume (l/h)</mat-label>\r\n            <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n          </mat-form-field>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">\r\n            Back\r\n          </button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'P-Flow D116'\">\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">\r\n            Back\r\n          </button>\r\n          <button mat-button mat-raised-button color=\"primary\"\r\n                  type=\"submit\"\r\n                  [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n\r\n",
                "customCss": "\n.device-item {\n    line-height: 24px;\n    width: 100%;\n    padding-top: 8px;\n    padding-bottom: 8px;\n}\n\n.device-item .device-name {\n    font-size: 12px;\n    opacity: 0.7;\n}\n\n.device-item .device-type {\n    font-size: 14px;\n    opacity: 0.7;\n}\n\nmat-option {\n    height: auto !important;\n    white-space: normal !important;\n}\n\n.mat-select-value-text {\n    display: block;\n    width: 100%;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\n\r\nif (additionalParams.source === \"replace Device\") {\r\n    if (additionalParams.choice === true) {\r\n        openAddDeviceDialog();\r\n    } else {\r\n        // Handle other cases if needed\r\n    }\r\n} else if (additionalParams.source !== \"replace Device\") {\r\n    openAddDeviceDialog();\r\n}\r\n\r\nfunction openAddDeviceDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                device: [null, [vm.validators.required]],\r\n                label: [{ value: null, disabled: true }]\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: ['heating', [vm.validators.required]],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: ['above', [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n            })\r\n        })\r\n    });\r\n    \r\n     // Set initial deltaT based on default installationType\r\n    let initialInstallationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n    if (initialInstallationType === 'heating') {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(15);\r\n    } else if (initialInstallationType === 'cooling') {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(6);\r\n    }\r\n    \r\n    // Watch for changes in installationType to set default deltaT value\r\n    vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').valueChanges.subscribe((installationType) => {\r\n        if (installationType === 'heating') {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(15);\r\n        } else if (installationType === 'cooling') {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(6);\r\n        }\r\n    });\r\n    // Additional state to control the visibility of the attributes step\r\n    vm.showAttributesStep = true;\r\n\r\n    vm.addDeviceFormGroup.get('stepper.assignmentStep.device').valueChanges.subscribe((device) => {\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').patchValue(device.label, { emitEvent: false });\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').enable({ emitEvent: false });\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').updateValueAndValidity({ onlySelf: true });\r\n    });\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n    var DoktorkitId = widgetContext.stateController.getStateParams().selectedDoktorkit.entityId;\r\n    vm.addDeviceFormGroup.markAsPristine();\r\n    var device = vm.addDeviceFormGroup.value.stepper.assignmentStep.device;\r\n    var label = vm.addDeviceFormGroup.value.stepper.assignmentStep.label;\r\n    var installationType = vm.addDeviceFormGroup.value.stepper.attributesStep.installationType;\r\n    var maxVolumeFlowCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxVolumeFlowCriticalThreshold;\r\n    var maxVolumeFlowMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxVolumeFlowMajorThreshold;\r\n    var loadCourseAnalysisTemperature = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseAnalysisTemperature;\r\n    var loadCourseFilterTemperature = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterTemperature;\r\n    var loadCourseFilterTemperatureValue = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterTemperatureValue;\r\n    var loadCourseFilterMaxPower = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterMaxPower;\r\n    var nominalFlow = vm.addDeviceFormGroup.value.stepper.attributesStep.nominalFlow;\r\n    var deltaT = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaT;\r\n    var deltaTAnalysisPumpEnergy = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaTAnalysisPumpEnergy;\r\n    var deltaTAnalysisFloorVolume = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaTAnalysisFloorVolume;\r\n    var maxEnergyCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxEnergyCriticalThreshold;\r\n    var maxEnergyMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxEnergyMajorThreshold;\r\n    var minTemperatureDifferenceCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold;\r\n    var minTemperatureDifferenceMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.minTemperatureDifferenceMajorThreshold;\r\n    var deviceId = device.deviceId;\r\n    \r\n    widgetContext.rxjs.forkJoin([\r\n        entityGroupService.removeEntityFromEntityGroup(vm.unassignedDevicesGroup.id.id, deviceId.id),\r\n        saveDeviceToDoktorkitRelation(DoktorkitId, deviceId),\r\n        saveAttributes(\r\n            deviceId,\r\n            installationType,\r\n            maxVolumeFlowCriticalThreshold,\r\n            maxVolumeFlowMajorThreshold,\r\n            loadCourseAnalysisTemperature,\r\n            loadCourseFilterTemperature,\r\n            loadCourseFilterTemperatureValue,\r\n            loadCourseFilterMaxPower,\r\n            nominalFlow,\r\n            deltaT,\r\n            deltaTAnalysisPumpEnergy,\r\n            deltaTAnalysisFloorVolume,\r\n            maxEnergyCriticalThreshold,\r\n            maxEnergyMajorThreshold,\r\n            minTemperatureDifferenceCriticalThreshold,\r\n            minTemperatureDifferenceMajorThreshold\r\n        ),\r\n        updateDeviceLabel(device, label)\r\n    ]).subscribe(() => {\r\n        widgetContext.updateAliases();\r\n        vm.dialogRef.close(null);\r\n    });\r\n};\r\n\r\n\r\n    init();\r\n\r\n    function init() {\r\n        vm.unassignedDevicesGroup = null;\r\n        vm.assignedDevicesGroup = null;\r\n        vm.availableDevices = [];\r\n        vm.assignedDevices = [];\r\n\r\n        if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n            vm.customerId = widgetContext.stateController.getStateParams().entityId;\r\n        } else {\r\n            vm.customerId = {\r\n                id: widgetContext.currentUser.customerId,\r\n                entityType: 'CUSTOMER'\r\n            };\r\n        }\r\n        entityGroupService.getEntityGroupsByOwnerId(vm.customerId.entityType, vm.customerId.id, 'DEVICE').subscribe((entityGroups) => {\r\n            vm.customerDevicesGroups = entityGroups;\r\n            vm.unassignedDevicesGroup = entityGroups.find(group => group.name === 'Unassigned Doktorkit Devices');\r\n            vm.assignedDevicesGroup = entityGroups.find(group => group.name === 'Doktorkit Devices');\r\n            if (vm.unassignedDevicesGroup) {\r\n                var query = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.unassignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query).subscribe((data) => {\r\n                    vm.availableDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n\r\n                });\r\n            }\r\n            if (vm.assignedDevicesGroup) {\r\n                var query2 = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.assignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query2).subscribe((data) => {\r\n                    vm.assignedDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n                    if (additionalParams.source === \"qrcode\" || additionalParams.source === \"replace Device\") {\r\n                        checkAdditionalParams();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function saveDeviceToDoktorkitRelation(DoktorkitId, deviceId) {\r\n        var relation = {\r\n            from: DoktorkitId,\r\n            to: deviceId,\r\n            typeGroup: 'COMMON',\r\n            type: 'Contains'\r\n        };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n\r\n    function saveAttributes(entityId, installationType, maxVolumeFlowCriticalThreshold, maxVolumeFlowMajorThreshold, loadCourseAnalysisTemperature, loadCourseFilterTemperature, loadCourseFilterTemperatureValue, loadCourseFilterMaxPower, nominalFlow,deltaT, deltaTAnalysisPumpEnergy, deltaTAnalysisFloorVolume, maxEnergyCriticalThreshold, maxEnergyMajorThreshold, minTemperatureDifferenceCriticalThreshold, minTemperatureDifferenceMajorThreshold, highCo2CriticalThreshold, highCo2MajorThreshold, highTemperatureCriticalThreshold, highHumidityCriticalThreshold, highTemperatureMajorThreshold, highHumidityMajorThreshold) {\r\n    let attributesArray = [\r\n        { key: 'xPos', value: 0.5 },\r\n        { key: 'yPos', value: 0.5 },\r\n        { key: 'installationType', value: installationType },\r\n        { key: 'maxVolumeFlowCriticalThreshold', value: maxVolumeFlowCriticalThreshold },\r\n        { key: 'maxVolumeFlowMajorThreshold', value: maxVolumeFlowMajorThreshold },\r\n        { key: 'loadCourseAnalysisTemperature', value: loadCourseAnalysisTemperature },\r\n        { key: 'loadCourseFilterTemperature', value: loadCourseFilterTemperature },\r\n        { key: 'loadCourseFilterTemperatureValue', value: loadCourseFilterTemperatureValue },\r\n        { key: 'loadCourseFilterMaxPower', value: loadCourseFilterMaxPower },\r\n        { key: 'nominalFlow', value: nominalFlow },\r\n        { key: 'deltaT', value: deltaT },\r\n        { key: 'deltaTAnalysisPumpEnergy', value: deltaTAnalysisPumpEnergy },\r\n        { key: 'deltaTAnalysisFloorVolume', value: deltaTAnalysisFloorVolume },\r\n        { key: 'maxEnergyCriticalThreshold', value: maxEnergyCriticalThreshold },\r\n        { key: 'maxEnergyMajorThreshold', value: maxEnergyMajorThreshold },\r\n        { key: 'minTemperatureDifferenceCriticalThreshold', value: minTemperatureDifferenceCriticalThreshold },\r\n        { key: 'minTemperatureDifferenceMajorThreshold', value: minTemperatureDifferenceMajorThreshold }\r\n    ];\r\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n}\r\n\r\n\r\n    function updateDeviceLabel(device, label) {\r\n        if (device.label !== label) {\r\n            return deviceService.getDevice(device.deviceId.id).pipe(\r\n                widgetContext.rxjs.switchMap((origDevice) => {\r\n                    origDevice.label = label;\r\n                    return deviceService.saveDevice(origDevice);\r\n                })\r\n            );\r\n        } else {\r\n            return widgetContext.rxjs.of(null);\r\n        }\r\n    }\r\n\r\n    function checkAdditionalParams() {\r\n        const matchingAvailableDevice = vm.availableDevices.find(device => device.name === additionalParams.code);\r\n        const matchingAssignedDevice = vm.assignedDevices.find(device => device.name === additionalParams.code);\r\n\r\n                if (!matchingAvailableDevice && !matchingAssignedDevice) {\r\n            widgetContext.dialogs.alert(\"Device doesn't exist\").subscribe();\r\n        }\r\n        if (matchingAssignedDevice && !matchingAvailableDevice) {\r\n            getDoktorkit(additionalParams.code);\r\n        }\r\n        if (matchingAvailableDevice && matchingAssignedDevice) {\r\n            vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { device: matchingAvailableDevice } } }, { emitEvent: false });\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.device').markAsDirty();\r\n            vm.addDeviceFormGroup.updateValueAndValidity();\r\n            setTimeout(() => {\r\n                const selectElement = document.querySelector('mat-select[formControlName=\"device\"]');\r\n                if (selectElement) {\r\n                    selectElement.dispatchEvent(new Event('change'));\r\n                }\r\n\r\n                if (!vm.changeDetectorRef) {\r\n                    vm.changeDetectorRef = widgetContext.$scope.$injector.get('$rootScope').$root.$$childHead;\r\n                }\r\n                vm.changeDetectorRef.$applyAsync();\r\n            });\r\n        }\r\n    }\r\n\r\n    function getDoktorkit(code) {\r\n        vm.deviceEntityId = null;\r\n        vm.relations = null;\r\n        vm.assignedToDoktorkit = null;\r\n\r\n        deviceService.findByName(code)\r\n            .pipe(\r\n                widgetContext.rxjs.map((origDevice) => {\r\n                    vm.deviceEntityId = origDevice.id.id;\r\n                })\r\n            ).subscribe(() => {\r\n                entityRelationService.findByTo({ 'id': vm.deviceEntityId, 'entityType': 'DEVICE' }).pipe(\r\n                    widgetContext.rxjs.map((origRelation) => {\r\n                        vm.relations = origRelation[0].from.id;\r\n                    })\r\n                ).subscribe(() => {\r\n                    assetService.getAsset(vm.relations).pipe(\r\n                        widgetContext.rxjs.map((origAsset) => {\r\n                            vm.assignedToDoktorkit = origAsset.name;\r\n                        })\r\n                    ).subscribe(() => {\r\n                        let actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\r\n                        let qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"replace-device\");\r\n                        let params = {\r\n                            \"doktorkit\": vm.assignedToDoktorkit,\r\n                            \"device\": vm.deviceEntityId,\r\n                            \"code\": additionalParams.code\r\n                        };\r\n                        try {\r\n                            vm.dialogRef.close(null);\r\n                            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\r\n                        } catch (error) {\r\n                            widgetContext.dialogs.alert('Error handling widget action:', error);\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n    }\r\n}\r\n\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              },
              {
                "name": "replace-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!-- replace-device-dialog.component.html -->\r\n<div class=\"replace-device-dialog-form\" style=\"width: 400px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Replace Device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-dialog-content fxLayout=\"column\" class=\"mat-typography\">\r\n    <p>{{ confirmationMessage }}</p>\r\n  </mat-dialog-content>\r\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n    <button mat-button color=\"primary\" (click)=\"cancel()\" type=\"button\" cdkFocusInitial>\r\n      No\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\" (click)=\"confirm()\" type=\"button\">\r\n      Yes\r\n    </button>\r\n  </div>\r\n</div>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\n\nopenReplaceDeviceDialog();\n\nfunction openReplaceDeviceDialog() {\n    customDialog.customDialog(htmlTemplate, ReplaceDeviceDialogController).subscribe();\n}\n\nfunction returnSelection(replaceDevice) {\n    let params = {\n        source: \"replace Device\",\n        choice: replaceDevice // Use event.replaceDevice instead of replaceDevice directly\n    };\n    //widgetContext.dialogs.alert(\"User selected 2\" + replaceDevice.toString() + \"!\");\n    try {\n        widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n    } catch (error) {\n        widgetContext.dialogs.alert('Error handling widget action:', error);\n    }\n}\n\nfunction ReplaceDeviceDialogController(instance) {\n    let vm = instance;\n    let replaceDevice;\n    //widgetContext.dialogs.alert(\"Aditional Params: \" + JSON.stringify(additionalParams) + additionalParams.device);\n\n    vm.confirmationMessage = \"Device is already assigned to \" + additionalParams.doktorkit + \"!\\n\" +\n        \"Do you want to remove it from \" + additionalParams.doktorkit + \" and assign it to the current one?\";\n\n    vm.cancel = function() {\n        replaceDevice = false; // Set replaceDevice to false\n        vm.handleConfirm({ replaceDevice: replaceDevice });\n    };\n\n    vm.confirm = function() {\n        let entityId = { 'id': additionalParams.device, 'entityType': 'DEVICE' };\n        let entityGroupId = \"684410d0-bfae-11ee-8196-b3999b4a11b6\";\n        //widgetContext.dialogs.alert(\"Additional Params: \" + JSON.stringify(entityId));\n        try {\n            entityRelationService.deleteRelations(entityId).subscribe(\n                () => {\n                    try {\n                        entityGroupService.addEntityToEntityGroup(entityGroupId, entityId.id).subscribe(\n                            () => {\n                                replaceDevice = true; // Set replaceDevice to true\n                                vm.handleConfirm({ replaceDevice: replaceDevice });\n                            },\n                            error => {\n                                widgetContext.dialogs.alert('Error handling add to Group action: ' + JSON.stringify(error));\n                            }\n                        );\n                    } catch (error) {\n                        widgetContext.dialogs.alert('Error initiating addEntityToEntityGroup: ' + JSON.stringify(error));\n                    }\n                },\n                error => {\n                    widgetContext.dialogs.alert('Error handling deleteRelations: ' + JSON.stringify(error));\n                }\n            );\n        } catch (error) {\n            widgetContext.dialogs.alert('Error initiating deleteRelations: ' + JSON.stringify(error));\n        }\n    };\n\n    vm.handleConfirm = function(event) {\n        vm.dialogRef.close(event);\n        let params = {\n            source: \"replace Device\",\n            choice: event.replaceDevice, // Use event.replaceDevice instead of replaceDevice directly\n            device: additionalParams.device,\n            code: additionalParams.code\n        };\n        try {\n            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n        } catch (error) {\n            widgetContext.dialogs.alert('Error handling widget action:', error);\n        }\n    };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c45ba341-9bcd-8608-b0f5-15317d44eb8a"
              }
            ],
            "headerButton": [
              {
                "name": "qr-code",
                "icon": "qr_code_scanner",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "mobileAction",
                "mobileAction": {
                  "type": "scanQrCode",
                  "handleEmptyResultFunction": "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Scan QR code action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert('Empty result', message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction": "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to scan QR code', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processQrCodeFunction": "// Function body to process result of QR code scanning. \n// - code - scanned QR code\n// - format - scanned QR code format\n//widgetContext.actionsApi.qrCodeCallback(code);\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\n\nlet params = {\n    source: \"qrcode\",\n    code: code\n}\ntry {\n    widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n} catch (error) {\n    widgetContext.dialogs.alert('Error handling widget action:', error);\n}\n\n//showQrCodeDialog(\"Code\", code, format);\nfunction showQrCodeDialog(title, code, format) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Code: ['+code+']<br>Format: ' + format).subscribe();\n    }, 100);\n}\n\n"
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "01671463-1c6c-41bb-da25-4eb5ee1ef842"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "1057e70b-f6e4-a753-6411-52246b4f793d",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "248d9bcd-6dcc-381f-cd4c-211ec095b8c8": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "Doktorkit_devices_table"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Table",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "Doktorkit_devices_table",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "248d9bcd-6dcc-381f-cd4c-211ec095b8c8"
      },
      "1bed8029-36f3-d139-9171-d41e4dc9bfa4": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "Doktorkit_devices_plan"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Plan",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "Doktorkit_devices_plan",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "1bed8029-36f3-d139-9171-d41e4dc9bfa4"
      },
      "c7bcd0ec-a47b-5bb5-d7cf-9c07fbe96d98": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d13f6078-0d81-ec59-529c-64acbbcaf470",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1719396870991,
                "endTimeMs": 1719483270991
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_table_doktorkit\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "c7bcd0ec-a47b-5bb5-d7cf-9c07fbe96d98"
      },
      "5d58360e-ec9a-cace-33d3-f64d2ba8e946": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n     <div fxLayout=\"row\" style=\"width: 100%; height: 40px; justify-content: flex-start;\" fxLayoutAlign=\"start start\">\r\n        <h5 fxFlex class=\"market-title\">Devices</h5>\r\n        <div style=\"margin-right: 30px;\">\r\n        <button id=\"add-device\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add device manually</span></button>\r\n        <button id=\"replace-device\" mat-raised-button color=\"primary\" style=\"display: none;\">\r\n                <mat-icon class=\"tb-mat-20\">add</mat-icon>\r\n                <span>Replace Device</span>\r\n        </button>\r\n        </div> \r\n     </div>\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"doktorkit_devices_header_buttons\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 800px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Add device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Device</mat-label>\r\n          <mat-select formControlName=\"device\" required>\r\n            <mat-select-trigger>\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.label}}</div>\r\n                  <div class=\"device-name\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type}}</div>\r\n              </div>\r\n            </mat-select-trigger>\r\n            <mat-option *ngFor=\"let device of availableDevices\" [value]=\"device\">\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{device?.label}}</div>\r\n                  <div class=\"device-name\">{{device?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{device?.type}}</div>\r\n              </div>\r\n              <mat-divider></mat-divider>\r\n            </mat-option>\r\n            <mat-option *ngIf=\"!availableDevices?.length\" disabled [value]=\"null\">\r\n              <div class=\"device-item\">\r\n                No devices available\r\n              </div>\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').hasError('required')\">\r\n            Device is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Label</mat-label>\r\n          <input matInput formControlName=\"label\">\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.label').hasError('required')\">\r\n            Device label is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Attributes</ng-template>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Installation Type</mat-label>\r\n          <mat-select formControlName=\"installationType\" required>\r\n            <mat-option value=\"heating\">Heating</mat-option>\r\n            <mat-option value=\"cooling\">Cooling</mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n            Installation Type is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Outside Temperature Threshold</mat-label>\r\n          <input matInput formControlName=\"loadCourseAnalysisTemperature\" type=\"number\">\r\n        </mat-form-field>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n            <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n              <mat-option value=\"above\">Above</mat-option>\r\n              <mat-option value=\"below\">Below</mat-option>\r\n            </mat-select>\r\n            <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n              Temperature Condition is required.\r\n            </mat-error>\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Outside Temperature Threshold</mat-label>\r\n            <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n          </mat-form-field>\r\n        </div>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n        <mat-form-field class=\"mat-block\" fxFlex>\r\n          <mat-label>Maximum Power Threshold</mat-label>\r\n          <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\" fxFlex>\r\n          <mat-label>Nominal Flow</mat-label>\r\n          <input matInput formControlName=\"nominalFlow\" type=\"number\">\r\n        </mat-form-field>\r\n        </div>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Delta T</mat-label>\r\n            <input matInput formControlName=\"deltaT\" type=\"number\">\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Circulation Pump Energy Consumption</mat-label>\r\n            <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Floor Volume (l/h)</mat-label>\r\n            <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n          </mat-form-field>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">\r\n            Back\r\n          </button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'P-Flow D116'\">\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        </div>\r\n         <!-- Additional fields for Room Sensor CO2 type -->\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor CO2'\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High CO2 Threshold for critical alarm</mat-label>\r\n                <input matInput formControlName=\"highCo2CriticalThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High CO2 Threshold for major alarm</mat-label>\r\n                <input matInput formControlName=\"highCo2MajorThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <!-- Additional fields for Room Sensor T type -->\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor T' ||addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor CO2'\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Temperature Critical Threshold</mat-label>\r\n                <input matInput formControlName=\"highTemperatureCriticalThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Humidity Critical Threshold</mat-label>\r\n                <input matInput formControlName=\"highHumidityCriticalThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Temperature Major Threshold</mat-label>\r\n                <input matInput formControlName=\"highTemperatureMajorThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Humidity Major Threshold</mat-label>\r\n                <input matInput formControlName=\"highHumidityMajorThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <!-- End of additional fields for Room Sensor T type -->\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">\r\n            Back\r\n          </button>\r\n          <button mat-button mat-raised-button color=\"primary\"\r\n                  type=\"submit\"\r\n                  [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n\r\n",
                "customCss": "\n.device-item {\n    line-height: 24px;\n    width: 100%;\n    padding-top: 8px;\n    padding-bottom: 8px;\n}\n\n.device-item .device-name {\n    font-size: 12px;\n    opacity: 0.7;\n}\n\n.device-item .device-type {\n    font-size: 14px;\n    opacity: 0.7;\n}\n\nmat-option {\n    height: auto !important;\n    white-space: normal !important;\n}\n\n.mat-select-value-text {\n    display: block;\n    width: 100%;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\n\r\nif (additionalParams.source === \"replace Device\") {\r\n    if (additionalParams.choice === true) {\r\n        openAddDeviceDialog();\r\n    } else {\r\n        // Handle other cases if needed\r\n    }\r\n} else if (additionalParams.source !== \"replace Device\") {\r\n    openAddDeviceDialog();\r\n}\r\n\r\nfunction openAddDeviceDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                device: [null, [vm.validators.required]],\r\n                label: [{ value: null, disabled: true }]\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: ['heating', [vm.validators.required]],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: ['above', [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                // Additional fields for Room Sensor CO2 type\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                // Additional fields for Room Sensor T type\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null]\r\n            })\r\n        })\r\n    });\r\n    \r\n     // Set initial deltaT based on default installationType\r\n    let initialInstallationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n    if (initialInstallationType === 'heating') {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(15);\r\n    } else if (initialInstallationType === 'cooling') {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(6);\r\n    }\r\n    \r\n    // Watch for changes in installationType to set default deltaT value\r\n    vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').valueChanges.subscribe((installationType) => {\r\n        if (installationType === 'heating') {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(15);\r\n        } else if (installationType === 'cooling') {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(6);\r\n        }\r\n    });\r\n    // Additional state to control the visibility of the attributes step\r\n    vm.showAttributesStep = true;\r\n\r\n    vm.addDeviceFormGroup.get('stepper.assignmentStep.device').valueChanges.subscribe((device) => {\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').patchValue(device.label, { emitEvent: false });\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').enable({ emitEvent: false });\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').updateValueAndValidity({ onlySelf: true });\r\n\r\n        // Check the device type and conditionally show/hide the attributes step\r\n        if (device.type === \"Room Sensor CO2\" || device.type === \"Room Sensor T\") {\r\n            vm.showAttributesStep = false;\r\n        } else {\r\n            vm.showAttributesStep = true;\r\n        }\r\n\r\n        // Trigger change detection manually\r\n        vm.changeDetectorRef.detectChanges();\r\n    });\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n    var DoktorkitId = widgetContext.stateController.getStateParams().selectedDoktorkit.entityId;\r\n    vm.addDeviceFormGroup.markAsPristine();\r\n    var device = vm.addDeviceFormGroup.value.stepper.assignmentStep.device;\r\n    var label = vm.addDeviceFormGroup.value.stepper.assignmentStep.label;\r\n    var installationType = vm.addDeviceFormGroup.value.stepper.attributesStep.installationType;\r\n    var maxVolumeFlowCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxVolumeFlowCriticalThreshold;\r\n    var maxVolumeFlowMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxVolumeFlowMajorThreshold;\r\n    var loadCourseAnalysisTemperature = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseAnalysisTemperature;\r\n    var loadCourseFilterTemperature = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterTemperature;\r\n    var loadCourseFilterTemperatureValue = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterTemperatureValue;\r\n    var loadCourseFilterMaxPower = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterMaxPower;\r\n    var nominalFlow = vm.addDeviceFormGroup.value.stepper.attributesStep.nominalFlow;\r\n    var deltaT = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaT;\r\n    var deltaTAnalysisPumpEnergy = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaTAnalysisPumpEnergy;\r\n    var deltaTAnalysisFloorVolume = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaTAnalysisFloorVolume;\r\n    var maxEnergyCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxEnergyCriticalThreshold;\r\n    var maxEnergyMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxEnergyMajorThreshold;\r\n    var minTemperatureDifferenceCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold;\r\n    var minTemperatureDifferenceMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.minTemperatureDifferenceMajorThreshold;\r\n    var highCo2CriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highCo2CriticalThreshold;\r\n    var highCo2MajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highCo2MajorThreshold;\r\n    var highTemperatureCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highTemperatureCriticalThreshold;\r\n    var highHumidityCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highHumidityCriticalThreshold;\r\n    var highTemperatureMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highTemperatureMajorThreshold;\r\n    var highHumidityMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highHumidityMajorThreshold;\r\n\r\n    var deviceId = device.deviceId;\r\n    \r\n    widgetContext.rxjs.forkJoin([\r\n        entityGroupService.removeEntityFromEntityGroup(vm.unassignedDevicesGroup.id.id, deviceId.id),\r\n        saveDeviceToDoktorkitRelation(DoktorkitId, deviceId),\r\n        saveAttributes(\r\n            deviceId,\r\n            installationType,\r\n            maxVolumeFlowCriticalThreshold,\r\n            maxVolumeFlowMajorThreshold,\r\n            loadCourseAnalysisTemperature,\r\n            loadCourseFilterTemperature,\r\n            loadCourseFilterTemperatureValue,\r\n            loadCourseFilterMaxPower,\r\n            nominalFlow,\r\n            deltaT,\r\n            deltaTAnalysisPumpEnergy,\r\n            deltaTAnalysisFloorVolume,\r\n            maxEnergyCriticalThreshold,\r\n            maxEnergyMajorThreshold,\r\n            minTemperatureDifferenceCriticalThreshold,\r\n            minTemperatureDifferenceMajorThreshold,\r\n            highCo2CriticalThreshold,\r\n            highCo2MajorThreshold,\r\n            highTemperatureCriticalThreshold,\r\n            highHumidityCriticalThreshold,\r\n            highTemperatureMajorThreshold,\r\n            highHumidityMajorThreshold\r\n        ),\r\n        updateDeviceLabel(device, label)\r\n    ]).subscribe(() => {\r\n        widgetContext.updateAliases();\r\n        vm.dialogRef.close(null);\r\n    });\r\n};\r\n\r\n\r\n    init();\r\n\r\n    function init() {\r\n        vm.unassignedDevicesGroup = null;\r\n        vm.assignedDevicesGroup = null;\r\n        vm.availableDevices = [];\r\n        vm.assignedDevices = [];\r\n\r\n        if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n            vm.customerId = widgetContext.stateController.getStateParams().entityId;\r\n        } else {\r\n            vm.customerId = {\r\n                id: widgetContext.currentUser.customerId,\r\n                entityType: 'CUSTOMER'\r\n            };\r\n        }\r\n        entityGroupService.getEntityGroupsByOwnerId(vm.customerId.entityType, vm.customerId.id, 'DEVICE').subscribe((entityGroups) => {\r\n            vm.customerDevicesGroups = entityGroups;\r\n            vm.unassignedDevicesGroup = entityGroups.find(group => group.name === 'Unassigned Doktorkit Devices');\r\n            vm.assignedDevicesGroup = entityGroups.find(group => group.name === 'Doktorkit Devices');\r\n            if (vm.unassignedDevicesGroup) {\r\n                var query = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.unassignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query).subscribe((data) => {\r\n                    vm.availableDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n\r\n                });\r\n            }\r\n            if (vm.assignedDevicesGroup) {\r\n                var query2 = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.assignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query2).subscribe((data) => {\r\n                    vm.assignedDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n                    if (additionalParams.source === \"qrcode\" || additionalParams.source === \"replace Device\") {\r\n                        checkAdditionalParams();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function saveDeviceToDoktorkitRelation(DoktorkitId, deviceId) {\r\n        var relation = {\r\n            from: DoktorkitId,\r\n            to: deviceId,\r\n            typeGroup: 'COMMON',\r\n            type: 'Contains'\r\n        };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n\r\n    function saveAttributes(entityId, installationType, maxVolumeFlowCriticalThreshold, maxVolumeFlowMajorThreshold, loadCourseAnalysisTemperature, loadCourseFilterTemperature, loadCourseFilterTemperatureValue, loadCourseFilterMaxPower, nominalFlow,deltaT, deltaTAnalysisPumpEnergy, deltaTAnalysisFloorVolume, maxEnergyCriticalThreshold, maxEnergyMajorThreshold, minTemperatureDifferenceCriticalThreshold, minTemperatureDifferenceMajorThreshold, highCo2CriticalThreshold, highCo2MajorThreshold, highTemperatureCriticalThreshold, highHumidityCriticalThreshold, highTemperatureMajorThreshold, highHumidityMajorThreshold) {\r\n    let attributesArray = [\r\n        { key: 'xPos', value: 0.5 },\r\n        { key: 'yPos', value: 0.5 },\r\n        { key: 'installationType', value: installationType },\r\n        { key: 'maxVolumeFlowCriticalThreshold', value: maxVolumeFlowCriticalThreshold },\r\n        { key: 'maxVolumeFlowMajorThreshold', value: maxVolumeFlowMajorThreshold },\r\n        { key: 'loadCourseAnalysisTemperature', value: loadCourseAnalysisTemperature },\r\n        { key: 'loadCourseFilterTemperature', value: loadCourseFilterTemperature },\r\n        { key: 'loadCourseFilterTemperatureValue', value: loadCourseFilterTemperatureValue },\r\n        { key: 'loadCourseFilterMaxPower', value: loadCourseFilterMaxPower },\r\n        { key: 'nominalFlow', value: nominalFlow },\r\n        { key: 'deltaT', value: deltaT },\r\n        { key: 'deltaTAnalysisPumpEnergy', value: deltaTAnalysisPumpEnergy },\r\n        { key: 'deltaTAnalysisFloorVolume', value: deltaTAnalysisFloorVolume },\r\n        { key: 'maxEnergyCriticalThreshold', value: maxEnergyCriticalThreshold },\r\n        { key: 'maxEnergyMajorThreshold', value: maxEnergyMajorThreshold },\r\n        { key: 'minTemperatureDifferenceCriticalThreshold', value: minTemperatureDifferenceCriticalThreshold },\r\n        { key: 'minTemperatureDifferenceMajorThreshold', value: minTemperatureDifferenceMajorThreshold },\r\n        { key: 'highCo2CriticalThreshold', value: highCo2CriticalThreshold },\r\n        { key: 'highCo2MajorThreshold', value: highCo2MajorThreshold },\r\n        { key: 'highHumidityCriticalThreshold', value: highHumidityCriticalThreshold },\r\n        { key: 'highHumidityMajorThreshold', value: highHumidityMajorThreshold },\r\n        { key: 'highTemperatureCriticalThreshold', value: highTemperatureCriticalThreshold },\r\n        { key: 'highTemperatureMajorThreshold', value: highTemperatureMajorThreshold }\r\n    ];\r\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n}\r\n\r\n\r\n    function updateDeviceLabel(device, label) {\r\n        if (device.label !== label) {\r\n            return deviceService.getDevice(device.deviceId.id).pipe(\r\n                widgetContext.rxjs.switchMap((origDevice) => {\r\n                    origDevice.label = label;\r\n                    return deviceService.saveDevice(origDevice);\r\n                })\r\n            );\r\n        } else {\r\n            return widgetContext.rxjs.of(null);\r\n        }\r\n    }\r\n\r\n    function checkAdditionalParams() {\r\n        const matchingAvailableDevice = vm.availableDevices.find(device => device.name === additionalParams.code);\r\n        const matchingAssignedDevice = vm.assignedDevices.find(device => device.name === additionalParams.code);\r\n\r\n                if (!matchingAvailableDevice && !matchingAssignedDevice) {\r\n            widgetContext.dialogs.alert(\"Device doesn't exist\").subscribe();\r\n        }\r\n        if (matchingAssignedDevice && !matchingAvailableDevice) {\r\n            getDoktorkit(additionalParams.code);\r\n        }\r\n        if (matchingAvailableDevice && matchingAssignedDevice) {\r\n            vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { device: matchingAvailableDevice } } }, { emitEvent: false });\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.device').markAsDirty();\r\n            vm.addDeviceFormGroup.updateValueAndValidity();\r\n            setTimeout(() => {\r\n                const selectElement = document.querySelector('mat-select[formControlName=\"device\"]');\r\n                if (selectElement) {\r\n                    selectElement.dispatchEvent(new Event('change'));\r\n                }\r\n\r\n                if (!vm.changeDetectorRef) {\r\n                    vm.changeDetectorRef = widgetContext.$scope.$injector.get('$rootScope').$root.$$childHead;\r\n                }\r\n                vm.changeDetectorRef.$applyAsync();\r\n            });\r\n        }\r\n    }\r\n\r\n    function getDoktorkit(code) {\r\n        vm.deviceEntityId = null;\r\n        vm.relations = null;\r\n        vm.assignedToDoktorkit = null;\r\n\r\n        deviceService.findByName(code)\r\n            .pipe(\r\n                widgetContext.rxjs.map((origDevice) => {\r\n                    vm.deviceEntityId = origDevice.id.id;\r\n                })\r\n            ).subscribe(() => {\r\n                entityRelationService.findByTo({ 'id': vm.deviceEntityId, 'entityType': 'DEVICE' }).pipe(\r\n                    widgetContext.rxjs.map((origRelation) => {\r\n                        vm.relations = origRelation[0].from.id;\r\n                    })\r\n                ).subscribe(() => {\r\n                    assetService.getAsset(vm.relations).pipe(\r\n                        widgetContext.rxjs.map((origAsset) => {\r\n                            vm.assignedToDoktorkit = origAsset.name;\r\n                        })\r\n                    ).subscribe(() => {\r\n                        let actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\r\n                        let qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"replace-device\");\r\n                        let params = {\r\n                            \"doktorkit\": vm.assignedToDoktorkit,\r\n                            \"device\": vm.deviceEntityId,\r\n                            \"code\": additionalParams.code\r\n                        };\r\n                        try {\r\n                            vm.dialogRef.close(null);\r\n                            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\r\n                        } catch (error) {\r\n                            widgetContext.dialogs.alert('Error handling widget action:', error);\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n    }\r\n}\r\n\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              },
              {
                "name": "replace-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!-- replace-device-dialog.component.html -->\r\n<div class=\"replace-device-dialog-form\" style=\"width: 400px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Replace Device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-dialog-content fxLayout=\"column\" class=\"mat-typography\">\r\n    <p>{{ confirmationMessage }}</p>\r\n  </mat-dialog-content>\r\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n    <button mat-button color=\"primary\" (click)=\"cancel()\" type=\"button\" cdkFocusInitial>\r\n      No\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\" (click)=\"confirm()\" type=\"button\">\r\n      Yes\r\n    </button>\r\n  </div>\r\n</div>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\n\nopenReplaceDeviceDialog();\n\nfunction openReplaceDeviceDialog() {\n    customDialog.customDialog(htmlTemplate, ReplaceDeviceDialogController).subscribe();\n}\n\nfunction returnSelection(replaceDevice) {\n    let params = {\n        source: \"replace Device\",\n        choice: replaceDevice // Use event.replaceDevice instead of replaceDevice directly\n    };\n    //widgetContext.dialogs.alert(\"User selected 2\" + replaceDevice.toString() + \"!\");\n    try {\n        widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n    } catch (error) {\n        widgetContext.dialogs.alert('Error handling widget action:', error);\n    }\n}\n\nfunction ReplaceDeviceDialogController(instance) {\n    let vm = instance;\n    let replaceDevice;\n    //widgetContext.dialogs.alert(\"Aditional Params: \" + JSON.stringify(additionalParams) + additionalParams.device);\n\n    vm.confirmationMessage = \"Device is already assigned to \" + additionalParams.doktorkit + \"!\\n\" +\n        \"Do you want to remove it from \" + additionalParams.doktorkit + \" and assign it to the current one?\";\n\n    vm.cancel = function() {\n        replaceDevice = false; // Set replaceDevice to false\n        vm.handleConfirm({ replaceDevice: replaceDevice });\n    };\n\n    vm.confirm = function() {\n        let entityId = { 'id': additionalParams.device, 'entityType': 'DEVICE' };\n        let entityGroupId = \"684410d0-bfae-11ee-8196-b3999b4a11b6\";\n        //widgetContext.dialogs.alert(\"Additional Params: \" + JSON.stringify(entityId));\n        try {\n            entityRelationService.deleteRelations(entityId).subscribe(\n                () => {\n                    try {\n                        entityGroupService.addEntityToEntityGroup(entityGroupId, entityId.id).subscribe(\n                            () => {\n                                replaceDevice = true; // Set replaceDevice to true\n                                vm.handleConfirm({ replaceDevice: replaceDevice });\n                            },\n                            error => {\n                                widgetContext.dialogs.alert('Error handling add to Group action: ' + JSON.stringify(error));\n                            }\n                        );\n                    } catch (error) {\n                        widgetContext.dialogs.alert('Error initiating addEntityToEntityGroup: ' + JSON.stringify(error));\n                    }\n                },\n                error => {\n                    widgetContext.dialogs.alert('Error handling deleteRelations: ' + JSON.stringify(error));\n                }\n            );\n        } catch (error) {\n            widgetContext.dialogs.alert('Error initiating deleteRelations: ' + JSON.stringify(error));\n        }\n    };\n\n    vm.handleConfirm = function(event) {\n        vm.dialogRef.close(event);\n        let params = {\n            source: \"replace Device\",\n            choice: event.replaceDevice, // Use event.replaceDevice instead of replaceDevice directly\n            device: additionalParams.device,\n            code: additionalParams.code\n        };\n        try {\n            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n        } catch (error) {\n            widgetContext.dialogs.alert('Error handling widget action:', error);\n        }\n    };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c45ba341-9bcd-8608-b0f5-15317d44eb8a"
              }
            ],
            "headerButton": [
              {
                "name": "qr-code",
                "icon": "qr_code_scanner",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "mobileAction",
                "mobileAction": {
                  "type": "scanQrCode",
                  "handleEmptyResultFunction": "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Scan QR code action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert('Empty result', message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction": "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to scan QR code', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processQrCodeFunction": "// Function body to process result of QR code scanning. \n// - code - scanned QR code\n// - format - scanned QR code format\n//widgetContext.actionsApi.qrCodeCallback(code);\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\n\nlet params = {\n    source: \"qrcode\",\n    code: code\n}\ntry {\n    widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n} catch (error) {\n    widgetContext.dialogs.alert('Error handling widget action:', error);\n}\n\n//showQrCodeDialog(\"Code\", code, format);\nfunction showQrCodeDialog(title, code, format) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Code: ['+code+']<br>Format: ' + format).subscribe();\n    }, 100);\n}\n\n"
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "01671463-1c6c-41bb-da25-4eb5ee1ef842"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "5d58360e-ec9a-cace-33d3-f64d2ba8e946",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "faaa7767-eace-1546-163d-30d272242806": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d13f6078-0d81-ec59-529c-64acbbcaf470",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1719396870991,
                "endTimeMs": 1719483270991
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_plan\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "faaa7767-eace-1546-163d-30d272242806"
      },
      "ddd7f4ba-76b5-4dc2-2b89-ede83a5e2844": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n     <div fxLayout=\"row\" style=\"width: 100%; height: 60px;\" fxLayoutAlign=\"center start\">\n        <h5 fxFlex class=\"market-title\">Sensorkits</h5>\n        <button id=\"add-Sensorkit\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add Sensorkit</span></button>\n     </div>\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Sensorkits_map\"></tb-dashboard-state>\n    </div>\n</div>",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-Sensorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addSensorkitFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Add Sensorkit</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n    <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n      <mat-form-field fxFlex class=\"mat-block\">\n        <mat-label>Sensorkit title</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"addSensorkitFormGroup.get('name').hasError('required')\">\n          Sensorkit title is required.\n        </mat-error>\n      </mat-form-field>\n    </div>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addSensorkitFormGroup.invalid || !addSensorkitFormGroup.dirty\">\n      Add Sensorkit\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddSensorkitDialog();\n\nfunction openAddSensorkitDialog() {\n  customDialog.customDialog(htmlTemplate, AddSensorkitDialogController).subscribe();\n}\n\nfunction AddSensorkitDialogController(instance) {\n  let vm = instance;\n\n  vm.addSensorkitFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]]\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var customerId;\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n    vm.addSensorkitFormGroup.markAsPristine();\n    saveSensorkitObservable(customerId).subscribe(\n      function (Sensorkit) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToSensorkitRelation(customerId, Sensorkit.id),\n              saveAttributes(Sensorkit.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedSensorkit = params['selectedSensorkit'];\n                params['selectedSensorkit'] = { entityId: Sensorkit.id, entityName: Sensorkit.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveSensorkitObservable(customerId) {\n    return getSensorkitsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((SensorkitsGroup) => {\n            const formValues = vm.addSensorkitFormGroup.value;\n            let Sensorkit = {\n              name: formValues.name,\n              type: 'Sensorkit',\n              customerId: customerId\n            };\n            return assetService.saveAsset(Sensorkit, SensorkitsGroup.id.id)\n        })\n    );\n  }\n  \n  function getSensorkitsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var SensorkitsGroup = entityGroups.find(group => group.name === 'Sensorkits');\n              if (SensorkitsGroup) {\n                  return widgetContext.rxjs.of(SensorkitsGroup);\n              } else {\n                  SensorkitsGroup = {\n                      type: 'ASSET',\n                      name: 'Sensorkits',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(SensorkitsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToSensorkitRelation(customerId, SensorkitId) {\n      var relation = {\n          from: customerId,\n          to: SensorkitId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'latitude',\n            value: 48.1406022\n        },\n        {\n            key: 'longitude',\n            value: 16.2932688\n        },\n        {\n            key: 'alias',\n            value: 'N/A'\n        },        \n        {\n            key: 'address',\n            value: 'N/A'\n        },\n        {\n            key: 'state',\n            value: 'normal'\n        },\n        {\n            key: 'units',\n            value: 'metric'\n        },\n        {\n            key: 'floorplan',\n            value: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K'\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "ddd7f4ba-76b5-4dc2-2b89-ede83a5e2844",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "edba9e49-62f1-733b-f500-b893b4770b2b": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\n    <section *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex fxLayout=\"column\">\n\t<h5 class=\"market-title\">{{ ctx.stateController.getStateParams().selectedDoktorkit.entityName }}</h5>\n\t<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_card\"></tb-dashboard-state>\n    </section>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" stateId=\"Doktorkits_card\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>\n    <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkit_alarms\"></tb-dashboard-state>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"false\" stateId=\"Doktorkits_alarms\"></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "var SensorkitState;\r\nif (data && data.length && data[0]['entityId']) {\r\n    SensorkitState = true;\r\n} else {\r\n    SensorkitState = false;\r\n}\r\n\r\nvar typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-480q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v480q0 33-23.5 56.5T800-80H160Zm240-640h160v-80H400v80Zm40 360v120h80v-120h120v-80H520v-120h-80v120H320v80h120Z\"/></svg>';\r\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\r\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\r\n\r\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\r\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\r\n                   '<div class=\"title\">Edit Sensorkit: {{ ctx.stateController.getStateParams().selectedSensorkit?.entityName }}</div>' +\r\n                '</div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"start\"><button id=\"Sensorkit-devices\" type=\"button\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">devices_other</mat-icon><span>Sensorkit devices</span></button></div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"start\"><button id=\"get-location\" type=\"button\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">location_on</mat-icon></button></div>' +\r\n                '<div fxLayout=\"column\" fxLayoutAlign=\"start\" style=\"padding-right: 24px;\"><button id=\"delete-Sensorkit\" type=\"button\" mat-raised-button color=\"accent\"><mat-icon class=\"tb-mat-20\">delete</mat-icon><span>Delete</span></button></div>' +\r\n             '</div>';\r\n             \r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n          (SensorkitState \r\n            ? (header +\r\n               '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"edit_Sensorkit_card\"></tb-dashboard-state>') \r\n            : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Sensorkits_card\"></tb-dashboard-state>') +\r\n       '</div>';",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 12px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedSensorkit'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              },
              {
                "name": "Sensorkit-devices",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Sensorkit_devices_table",
                "setEntityId": true,
                "stateEntityParamName": "selectedSensorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f921410a-47b7-5884-1c63-d010a39064a4"
              },
              {
                "name": "delete-Sensorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteSensorkitDialog();\n\nfunction openDeleteSensorkitDialog() {\n  var title = 'Are you sure you want to delete the Sensorkit ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the Sensorkit will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteSensorkit();\n      }\n    }\n  );\n}\n\nfunction deleteSensorkit() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteSensorkitToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Sensorkit Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Sensorkit Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteSensorkitToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1af63269-0a95-b82e-0703-86bd8daf9356"
              },
              {
                "name": "get-location",
                "icon": "location_on",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "mobileAction",
                "mobileAction": {
                  "type": "getLocation",
                  "handleEmptyResultFunction": "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Get location action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert('Empty result', message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction": "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to get phone location', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processLocationFunction": "// Function body to process current location of the phone. \n// - latitude - phone location latitude\n// - longitude - phone location longitude\nlet $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\n//showLocationDialog('Location', latitude, longitude);\nsaveEntityLocationAttributes('latitude', 'longitude', latitude, longitude);\nfunction getSelectedKitId() {\n    let stateParams = widgetContext.stateController.getStateParams();\n    return stateParams.selectedSensorkit.entityId;\n}\n\nfunction saveEntityLocationAttributes(latitudeAttributeName, longitudeAttributeName, latitude, longitude) {\n    let entityId = getSelectedKitId();\n    if (entityId) {\n        let attributes = [\n            { key: \"latitude\", value: latitude },\n            { key: \"longitude\", value: longitude }\n        ];\n        attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributes).subscribe(\n        widgetContext.dialogs.alert('Location attributes saved!\\nLatitude: ' + latitude + '\\nLongitude: ' + longitude),\n           function() {\n               widgetContext.showSuccessToast('Location attributes saved!');\n           },\n           function(error) {\n               widgetContext.dialogs.alert('Location attributes save failed', JSON.stringify(error));\n           }\n        );\n    }\n}\n\n\nfunction showLocationDialog(title, latitude, longitude) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Latitude: '+latitude+'<br>Longitude: ' + longitude).subscribe();\n    }, 100);\n}"
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "94c2e448-3356-0d9d-d976-d11a0ac2165c"
              }
            ],
            "headerButton": []
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "edba9e49-62f1-733b-f500-b893b4770b2b",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "0b67574e-500a-d44a-492b-6aa70ba46690": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7c45df90-1684-2f63-5740-c34127d166b2",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "latitude",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.862061599769905
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "longitude",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.017864596400994026
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "selectedSensorkit",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5292772206260663,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value !== '') {\n    return true;\n} else {\n    return false;\n}",
                  "aggregationType": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "CartoDB.Positron",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": false,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "",
            "imageUrlAttribute": "",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 18,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": true,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${entityName}",
            "labelFunction": null,
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": false,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><link-act name='Sensorkit-devices'>Sensorkit devices</link-act><br/><br/><link-act name='delete-Sensorkit'>Delete</link-act>",
            "tooltipFunction": null,
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var selectedSensorkit = data['selectedSensorkit'] === true;\nvar selectedMode = dsData.filter(function (data) { return data['selectedSensorkit'] === true; }).length > 0;\n\nvar width = 30;\nvar svgStr = getSensorkitSvg(width, selectedSensorkit);\nvar encodedSvg = encodeURIComponent(svgStr);\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\n\nif (selectedSensorkit) {\n    width += 8;\n}\n\nreturn {\n    url: svgUrl,\n    size: width,\n    markerOffset: [width / 2, width / 2],\n    tooltipOffset: [width * 0.5 - width / 2, - (width / 2)]\n};\n\nfunction getSensorkitSvg(width, isSelected) {\n    var shape = '<path d=\"m18.636 15.8c0.59978 0 1.1276-0.32788 1.3995-0.82369l2.8629-5.1901c0.29589-0.5278-0.08796-1.1836-0.69574-1.1836h-11.836l-0.75172-1.5994h-2.615v1.5994h1.5994l2.8789 6.0697-1.0796 1.9513c-0.58378 1.0716 0.18393 2.3751 1.3995 2.3751h9.5964v-1.5994h-9.5964l0.87967-1.5994zm-7.5092-5.5979h9.7164l-2.2072 3.9985h-5.6139zm0.67175 9.5964c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994 1.5994-0.71973 1.5994-1.5994-0.71973-1.5994-1.5994-1.5994zm7.997 0c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994c0.87967 0 1.5994-0.71973 1.5994-1.5994s-0.71973-1.5994-1.5994-1.5994z\" fill=\"white\" stroke-width=\".7997\"/>';\n    var color = '#1F8B4D';\n    var background = getBackground(color);\n    var svgWidth = isSelected ? (width + 8) : width;\n    var svgHeight = isSelected ? 38 : 30;\n    \n    var opacity = selectedMode && !isSelected ? 0.4 : 1;\n    \n    var SensorkitSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgWidth + '\" height=\"' + svgHeight + '\" viewBox=\"0 0 ' + svgWidth + ' ' + svgHeight + '\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                    wrapIfSelected(background + shape, isSelected);\n    if (isSelected) {\n        SensorkitSvg += getSensorkitSelectionStroke();\n    }\n    SensorkitSvg += '</svg>';\n    return SensorkitSvg;    \n}\n\nfunction wrapIfSelected(svg, isSelected) {\n    if (isSelected) {\n        return '<g transform=\"translate(4 4)\">' + svg + '</g>';\n    } else {\n        return svg;\n    }\n}\n\nfunction getBackground(color) {\n     return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>';\n}\n\nfunction getSensorkitSelectionStroke() {\n     return '<circle cx=\"19\" cy=\"19\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n}\n",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "snappable": false,
            "initDragMode": true,
            "hideAllControlButton": true,
            "hideDrawControlButton": false,
            "hideEditControlButton": false,
            "hideRemoveControlButton": false,
            "useClusterMarkers": false,
            "zoomOnClick": true,
            "maxZoom": null,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true,
            "useIconCreateFunction": false,
            "clusterMarkerFunction": null
          },
          "title": "Doktorkits map",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Select Sensorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nvar selectedSensorkit = params['selectedSensorkit'];\nif (selectedSensorkit && selectedSensorkit.entityId.id === entityId.id) {\n    params['selectedSensorkit'] = null;\n} else {\n    params['selectedSensorkit'] = { entityId: entityId, entityName: entityName, entityLabel: entityLabel };\n}\nwidgetContext.stateController.updateState(null, params);\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4de7962b-a1de-5cb1-cd78-993dc7863614"
              }
            ],
            "tooltipAction": [
              {
                "name": "Sensorkit-devices",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nparams['selectedSensorkit'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedSensorkit';\nparams['selectedDevice'] = null;\n\nwidgetContext.stateController.openState('Sensorkit_devices', params);\t",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1ca54350-817a-27b3-26a7-3572544d8523"
              },
              {
                "name": "delete-Sensorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteSensorkitDialog();\n\nfunction openDeleteSensorkitDialog() {\n  var title = 'Are you sure you want to delete the Sensorkit ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the Sensorkit will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteSensorkit();\n      }\n    }\n  );\n}\n\nfunction deleteSensorkit() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, customerId, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, customerId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteSensorkitToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Sensorkit Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Sensorkit Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteSensorkitToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "89d67b54-a78e-f190-3832-1aae29cee395"
              }
            ]
          },
          "showTitleIcon": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "titleTooltip": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "0b67574e-500a-d44a-492b-6aa70ba46690",
        "typeFullFqn": "system.maps_v2.openstreetmap"
      },
      "92ce9463-8441-6190-2fcb-46edda67b9d2": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "Sensorkits",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": true,
            "entityNameColumnTitle": "Name",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Sensorkits",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7c45df90-1684-2f63-5740-c34127d166b2",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "70%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.1345774127559587,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "Location Alias",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.7448728411727017,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Select Sensorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": "selectedSensorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "Open Sensorkit devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Sensorkit_devices_table",
                "setEntityId": true,
                "stateEntityParamName": "selectedSensorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "71c478b6-a4b1-e569-e99a-85d5562cc721"
              },
              {
                "name": "Delete Sensorkit",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteSensorkitDialog();\n\nfunction openDeleteSensorkitDialog() {\n  var title = 'Are you sure you want to delete the Sensorkit ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the Sensorkit will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteSensorkit();\n      }\n    }\n  );\n}\n\nfunction deleteSensorkit() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteSensorkitToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Sensorkit Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Sensorkit Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteSensorkitToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "338d9fd7-c752-eb0e-4687-2c2e32ca1a32"
              }
            ],
            "headerButton": [
              {
                "name": "Add Sensorkit",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addSensorkitFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Add Sensorkit</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content fxLayout=\"column\">\n    <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n      <mat-form-field fxFlex class=\"mat-block\">\n        <mat-label>Sensorkit title</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"addSensorkitFormGroup.get('name').hasError('required')\">\n          Sensorkit title is required.\n        </mat-error>\n      </mat-form-field>\n    </div>\n  </div>\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addSensorkitFormGroup.invalid || !addSensorkitFormGroup.dirty\">\n      Add Sensorkit\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddSensorkitDialog();\n\nfunction openAddSensorkitDialog() {\n  customDialog.customDialog(htmlTemplate, AddSensorkitDialogController).subscribe();\n}\n\nfunction AddSensorkitDialogController(instance) {\n  let vm = instance;\n\n  vm.addSensorkitFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]]\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var customerId;\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n    vm.addSensorkitFormGroup.markAsPristine();\n    saveSensorkitObservable(customerId).subscribe(\n      function (Sensorkit) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToSensorkitRelation(customerId, Sensorkit.id),\n              saveAttributes(Sensorkit.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedSensorkit = params['selectedSensorkit'];\n                params['selectedSensorkit'] = { entityId: Sensorkit.id, entityName: Sensorkit.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveSensorkitObservable(customerId) {\n    return getSensorkitsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((SensorkitsGroup) => {\n            const formValues = vm.addSensorkitFormGroup.value;\n            let Sensorkit = {\n              name: formValues.name,\n              type: 'Sensorkit',\n              customerId: customerId\n            };\n            return assetService.saveAsset(Sensorkit, SensorkitsGroup.id.id)\n        })\n    );\n  }\n  \n  function getSensorkitsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var SensorkitsGroup = entityGroups.find(group => group.name === 'Sensorkits');\n              if (SensorkitsGroup) {\n                  return widgetContext.rxjs.of(SensorkitsGroup);\n              } else {\n                  SensorkitsGroup = {\n                      type: 'ASSET',\n                      name: 'Sensorkits',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(SensorkitsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToSensorkitRelation(customerId, SensorkitId) {\n      var relation = {\n          from: customerId,\n          to: SensorkitId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'latitude',\n            value: 48.1406022\n        },\n        {\n            key: 'longitude',\n            value: 16.2932688\n        },\n        {\n            key: 'address',\n            value: 'N/A'\n        },\n        {\n            key: 'state',\n            value: 'normal'\n        },\n        {\n            key: 'units',\n            value: 'metric'\n        },\n        {\n            key: 'floorplan',\n            value: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K'\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e965b8a1-a6ac-5ae4-fd79-2b7220b91ed1"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "92ce9463-8441-6190-2fcb-46edda67b9d2",
        "typeFullFqn": "system.cards.entities_table"
      },
      "7c944842-fac8-74e6-71f1-7c2325746bae": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n     <div fxLayout=\"row\" style=\"width: 100%; height: 40px; justify-content: flex-start;\" fxLayoutAlign=\"start start\">\r\n        <h5 fxFlex class=\"market-title\">Devices</h5>\r\n        <div style=\"margin-right: 30px;\">\r\n        <button id=\"add-device\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add device manually</span></button>\r\n        <button id=\"replace-device\" mat-raised-button color=\"primary\" style=\"display: none;\">\r\n                <mat-icon class=\"tb-mat-20\">add</mat-icon>\r\n                <span>Replace Device</span>\r\n        </button>\r\n        </div> \r\n     </div>\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensorkit_devices_header_buttons\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 800px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Add Sensor</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Sensor</mat-label>\r\n          <mat-select formControlName=\"device\" required>\r\n            <mat-select-trigger>\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.label}}</div>\r\n                  <div class=\"device-name\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type}}</div>\r\n              </div>\r\n            </mat-select-trigger>\r\n            <mat-option *ngFor=\"let device of availableDevices\" [value]=\"device\">\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{device?.label}}</div>\r\n                  <div class=\"device-name\">{{device?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{device?.type}}</div>\r\n              </div>\r\n              <mat-divider></mat-divider>\r\n            </mat-option>\r\n            <mat-option *ngIf=\"!availableDevices?.length\" disabled [value]=\"null\">\r\n              <div class=\"device-item\">\r\n                No devices available\r\n              </div>\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').hasError('required')\">\r\n            Sensor is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Label</mat-label>\r\n          <input matInput formControlName=\"label\" required>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.label').hasError('required')\">\r\n            Sensor label is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n\r\n        <!-- Additional fields for Room Sensor CO2 type -->\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor CO2'\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High CO2 Threshold for critical alarm</mat-label>\r\n                <input matInput formControlName=\"highCo2CriticalThreshold\" type=\"number\" required>\r\n              </mat-form-field>\r\n            </div>\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High CO2 Threshold for major alarm</mat-label>\r\n                <input matInput formControlName=\"highCo2MajorThreshold\" type=\"number\" required>\r\n              </mat-form-field>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Additional fields for Room Sensor T type -->\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor T' || addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor CO2'\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Temperature Critical Threshold</mat-label>\r\n                <input matInput formControlName=\"highTemperatureCriticalThreshold\" type=\"number\" required>\r\n              </mat-form-field>\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Humidity Critical Threshold</mat-label>\r\n                <input matInput formControlName=\"highHumidityCriticalThreshold\" type=\"number\" required>\r\n              </mat-form-field>\r\n            </div>\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Temperature Major Threshold</mat-label>\r\n                <input matInput formControlName=\"highTemperatureMajorThreshold\" type=\"number\" required>\r\n              </mat-form-field>\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Humidity Major Threshold</mat-label>\r\n                <input matInput formControlName=\"highHumidityMajorThreshold\" type=\"number\" required>\r\n              </mat-form-field>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">\r\n            Back\r\n          </button>\r\n          <button mat-button mat-raised-button color=\"primary\"\r\n                  type=\"submit\"\r\n                  [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "\n.device-item {\n    line-height: 24px;\n    width: 100%;\n    padding-top: 8px;\n    padding-bottom: 8px;\n}\n\n.device-item .device-name {\n    font-size: 12px;\n    opacity: 0.7;\n}\n\n.device-item .device-type {\n    font-size: 14px;\n    opacity: 0.7;\n}\n\nmat-option {\n    height: auto !important;\n    white-space: normal !important;\n}\n\n.mat-select-value-text {\n    display: block;\n    width: 100%;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\n\r\nif (additionalParams.source === \"replace Device\") {\r\n    if (additionalParams.choice === true) {\r\n        openAddDeviceDialog();\r\n    } else {\r\n        // Handle other cases if needed\r\n    }\r\n} else if (additionalParams.source !== \"replace Device\") {\r\n    openAddDeviceDialog();\r\n}\r\n\r\nfunction openAddDeviceDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                device: [null, [vm.validators.required]],\r\n                label: [{ value: null, disabled: true }]\r\n            }),\r\n            \r\n            alarmThresholdsStep: vm.fb.group({\r\n                // Additional fields for Room Sensor CO2 type\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                // Additional fields for Room Sensor T type\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null]\r\n            })\r\n        })\r\n    });\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n    var SensorkitId = widgetContext.stateController.getStateParams().selectedSensorkit.entityId;\r\n    vm.addDeviceFormGroup.markAsPristine();\r\n    var device = vm.addDeviceFormGroup.value.stepper.assignmentStep.device;\r\n    var label = vm.addDeviceFormGroup.value.stepper.assignmentStep.label;\r\n    var highCo2CriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highCo2CriticalThreshold;\r\n    var highCo2MajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highCo2MajorThreshold;\r\n    var highTemperatureCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highTemperatureCriticalThreshold;\r\n    var highHumidityCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highHumidityCriticalThreshold;\r\n    var highTemperatureMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highTemperatureMajorThreshold;\r\n    var highHumidityMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highHumidityMajorThreshold;\r\n\r\n    var deviceId = device.deviceId;\r\n    \r\n    widgetContext.rxjs.forkJoin([\r\n        entityGroupService.removeEntityFromEntityGroup(vm.unassignedDevicesGroup.id.id, deviceId.id),\r\n        saveDeviceToSensorkitRelation(SensorkitId, deviceId),\r\n        saveAttributes(\r\n            deviceId,\r\n            highCo2CriticalThreshold,\r\n            highCo2MajorThreshold,\r\n            highTemperatureCriticalThreshold,\r\n            highHumidityCriticalThreshold,\r\n            highTemperatureMajorThreshold,\r\n            highHumidityMajorThreshold\r\n        ),\r\n        updateDeviceLabel(device, label)\r\n    ]).subscribe(() => {\r\n        widgetContext.updateAliases();\r\n        vm.dialogRef.close(null);\r\n    });\r\n};\r\n\r\n\r\n    init();\r\n\r\n    function init() {\r\n        vm.unassignedDevicesGroup = null;\r\n        vm.assignedDevicesGroup = null;\r\n        vm.availableDevices = [];\r\n        vm.assignedDevices = [];\r\n\r\n        if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n            vm.customerId = widgetContext.stateController.getStateParams().entityId;\r\n        } else {\r\n            vm.customerId = {\r\n                id: widgetContext.currentUser.customerId,\r\n                entityType: 'CUSTOMER'\r\n            };\r\n        }\r\n        entityGroupService.getEntityGroupsByOwnerId(vm.customerId.entityType, vm.customerId.id, 'DEVICE').subscribe((entityGroups) => {\r\n            vm.customerDevicesGroups = entityGroups;\r\n            vm.unassignedDevicesGroup = entityGroups.find(group => group.name === 'Unassigned Sensorkit Devices');\r\n            vm.assignedDevicesGroup = entityGroups.find(group => group.name === 'Sensorkit Devices');\r\n            if (vm.unassignedDevicesGroup) {\r\n                var query = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.unassignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query).subscribe((data) => {\r\n                    vm.availableDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n\r\n                });\r\n            }\r\n            if (vm.assignedDevicesGroup) {\r\n                var query2 = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.assignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query2).subscribe((data) => {\r\n                    vm.assignedDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n                    if (additionalParams.source === \"qrcode\" || additionalParams.source === \"replace Device\") {\r\n                        checkAdditionalParams();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function saveDeviceToSensorkitRelation(SensorkitId, deviceId) {\r\n        var relation = {\r\n            from: SensorkitId,\r\n            to: deviceId,\r\n            typeGroup: 'COMMON',\r\n            type: 'Contains'\r\n        };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n\r\n    function saveAttributes(entityId, highCo2CriticalThreshold, highCo2MajorThreshold, highTemperatureCriticalThreshold, highHumidityCriticalThreshold, highTemperatureMajorThreshold, highHumidityMajorThreshold) {\r\n    let attributesArray = [\r\n        { key: 'xPos', value: 0.5 },\r\n        { key: 'yPos', value: 0.5 },\r\n        { key: 'highCo2CriticalThreshold', value: highCo2CriticalThreshold },\r\n        { key: 'highCo2MajorThreshold', value: highCo2MajorThreshold },\r\n        { key: 'highHumidityCriticalThreshold', value: highHumidityCriticalThreshold },\r\n        { key: 'highHumidityMajorThreshold', value: highHumidityMajorThreshold },\r\n        { key: 'highTemperatureCriticalThreshold', value: highTemperatureCriticalThreshold },\r\n        { key: 'highTemperatureMajorThreshold', value: highTemperatureMajorThreshold }\r\n    ];\r\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n}\r\n\r\n\r\n    function updateDeviceLabel(device, label) {\r\n        if (device.label !== label) {\r\n            return deviceService.getDevice(device.deviceId.id).pipe(\r\n                widgetContext.rxjs.switchMap((origDevice) => {\r\n                    origDevice.label = label;\r\n                    return deviceService.saveDevice(origDevice);\r\n                })\r\n            );\r\n        } else {\r\n            return widgetContext.rxjs.of(null);\r\n        }\r\n    }\r\n\r\n    function checkAdditionalParams() {\r\n        const matchingAvailableDevice = vm.availableDevices.find(device => device.name === additionalParams.code);\r\n        const matchingAssignedDevice = vm.assignedDevices.find(device => device.name === additionalParams.code);\r\n\r\n                if (!matchingAvailableDevice && !matchingAssignedDevice) {\r\n            widgetContext.dialogs.alert(\"Device doesn't exist\").subscribe();\r\n        }\r\n        if (matchingAssignedDevice && !matchingAvailableDevice) {\r\n            getSensorkit(additionalParams.code);\r\n        }\r\n        if (matchingAvailableDevice && matchingAssignedDevice) {\r\n            vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { device: matchingAvailableDevice } } }, { emitEvent: false });\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.device').markAsDirty();\r\n            vm.addDeviceFormGroup.updateValueAndValidity();\r\n            setTimeout(() => {\r\n                const selectElement = document.querySelector('mat-select[formControlName=\"device\"]');\r\n                if (selectElement) {\r\n                    selectElement.dispatchEvent(new Event('change'));\r\n                }\r\n\r\n                if (!vm.changeDetectorRef) {\r\n                    vm.changeDetectorRef = widgetContext.$scope.$injector.get('$rootScope').$root.$$childHead;\r\n                }\r\n                vm.changeDetectorRef.$applyAsync();\r\n            });\r\n        }\r\n    }\r\n\r\n    function getSensorkit(code) {\r\n        vm.deviceEntityId = null;\r\n        vm.relations = null;\r\n        vm.assignedToSensorkit = null;\r\n\r\n        deviceService.findByName(code)\r\n            .pipe(\r\n                widgetContext.rxjs.map((origDevice) => {\r\n                    vm.deviceEntityId = origDevice.id.id;\r\n                })\r\n            ).subscribe(() => {\r\n                entityRelationService.findByTo({ 'id': vm.deviceEntityId, 'entityType': 'DEVICE' }).pipe(\r\n                    widgetContext.rxjs.map((origRelation) => {\r\n                        vm.relations = origRelation[0].from.id;\r\n                    })\r\n                ).subscribe(() => {\r\n                    assetService.getAsset(vm.relations).pipe(\r\n                        widgetContext.rxjs.map((origAsset) => {\r\n                            vm.assignedToSensorkit = origAsset.name;\r\n                        })\r\n                    ).subscribe(() => {\r\n                        let actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\r\n                        let qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"replace-device\");\r\n                        let params = {\r\n                            \"sensorkit\": vm.assignedToSensorkit,\r\n                            \"device\": vm.deviceEntityId,\r\n                            \"code\": additionalParams.code\r\n                        };\r\n                        try {\r\n                            vm.dialogRef.close(null);\r\n                            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\r\n                        } catch (error) {\r\n                            widgetContext.dialogs.alert('Error handling widget action:', error);\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n    }\r\n}\r\n\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              },
              {
                "name": "replace-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!-- replace-device-dialog.component.html -->\r\n<div class=\"replace-device-dialog-form\" style=\"width: 400px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Replace Device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-dialog-content fxLayout=\"column\" class=\"mat-typography\">\r\n    <p>{{ confirmationMessage }}</p>\r\n  </mat-dialog-content>\r\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n    <button mat-button color=\"primary\" (click)=\"cancel()\" type=\"button\" cdkFocusInitial>\r\n      No\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\" (click)=\"confirm()\" type=\"button\">\r\n      Yes\r\n    </button>\r\n  </div>\r\n</div>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\n\nopenReplaceDeviceDialog();\n\nfunction openReplaceDeviceDialog() {\n    customDialog.customDialog(htmlTemplate, ReplaceDeviceDialogController).subscribe();\n}\n\nfunction returnSelection(replaceDevice) {\n    let params = {\n        source: \"replace Device\",\n        choice: replaceDevice // Use event.replaceDevice instead of replaceDevice directly\n    };\n    //widgetContext.dialogs.alert(\"User selected 2\" + replaceDevice.toString() + \"!\");\n    try {\n        widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n    } catch (error) {\n        widgetContext.dialogs.alert('Error handling widget action:', error);\n    }\n}\n\nfunction ReplaceDeviceDialogController(instance) {\n    let vm = instance;\n    let replaceDevice;\n    //widgetContext.dialogs.alert(\"Aditional Params: \" + JSON.stringify(additionalParams) + additionalParams.device);\n\n    vm.confirmationMessage = \"Device is already assigned to \" + additionalParams.sensorkit + \"!\\n\" +\n        \"Do you want to remove it from \" + additionalParams.sensorkit + \" and assign it to the current one?\";\n\n    vm.cancel = function() {\n        replaceDevice = false; // Set replaceDevice to false\n        vm.handleConfirm({ replaceDevice: replaceDevice });\n    };\n\n    vm.confirm = function() {\n        let entityId = { 'id': additionalParams.device, 'entityType': 'DEVICE' };\n        let entityGroupId = \"684410d0-bfae-11ee-8196-b3999b4a11b6\";\n        //widgetContext.dialogs.alert(\"Additional Params: \" + JSON.stringify(entityId));\n        try {\n            entityRelationService.deleteRelations(entityId).subscribe(\n                () => {\n                    try {\n                        entityGroupService.addEntityToEntityGroup(entityGroupId, entityId.id).subscribe(\n                            () => {\n                                replaceDevice = true; // Set replaceDevice to true\n                                vm.handleConfirm({ replaceDevice: replaceDevice });\n                            },\n                            error => {\n                                widgetContext.dialogs.alert('Error handling add to Group action: ' + JSON.stringify(error));\n                            }\n                        );\n                    } catch (error) {\n                        widgetContext.dialogs.alert('Error initiating addEntityToEntityGroup: ' + JSON.stringify(error));\n                    }\n                },\n                error => {\n                    widgetContext.dialogs.alert('Error handling deleteRelations: ' + JSON.stringify(error));\n                }\n            );\n        } catch (error) {\n            widgetContext.dialogs.alert('Error initiating deleteRelations: ' + JSON.stringify(error));\n        }\n    };\n\n    vm.handleConfirm = function(event) {\n        vm.dialogRef.close(event);\n        let params = {\n            source: \"replace Device\",\n            choice: event.replaceDevice, // Use event.replaceDevice instead of replaceDevice directly\n            device: additionalParams.device,\n            code: additionalParams.code\n        };\n        try {\n            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n        } catch (error) {\n            widgetContext.dialogs.alert('Error handling widget action:', error);\n        }\n    };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c45ba341-9bcd-8608-b0f5-15317d44eb8a"
              }
            ],
            "headerButton": [
              {
                "name": "qr-code",
                "icon": "qr_code_scanner",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "mobileAction",
                "mobileAction": {
                  "type": "scanQrCode",
                  "handleEmptyResultFunction": "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Scan QR code action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert('Empty result', message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction": "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to scan QR code', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processQrCodeFunction": "// Function body to process result of QR code scanning. \n// - code - scanned QR code\n// - format - scanned QR code format\n//widgetContext.actionsApi.qrCodeCallback(code);\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\n\nlet params = {\n    source: \"qrcode\",\n    code: code\n}\ntry {\n    widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n} catch (error) {\n    widgetContext.dialogs.alert('Error handling widget action:', error);\n}\n\n//showQrCodeDialog(\"Code\", code, format);\nfunction showQrCodeDialog(title, code, format) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Code: ['+code+']<br>Format: ' + format).subscribe();\n    }, 100);\n}\n\n"
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "01671463-1c6c-41bb-da25-4eb5ee1ef842"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "7c944842-fac8-74e6-71f1-7c2325746bae",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "f930ec11-5a79-ca5e-6460-d6c34d33d099": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "Sensorkit_devices_plan"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "autoScale": true,
              "showLabel": true,
              "label": "Plan",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "Sensorkit_devices_plan",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "f930ec11-5a79-ca5e-6460-d6c34d33d099"
      },
      "71ab3bf8-933b-3b3f-8262-2f6a6d3bb012": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "Sensorkit_devices_table"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "autoScale": true,
              "showLabel": true,
              "label": "Table",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "Sensorkit_devices_table",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "71ab3bf8-933b-3b3f-8262-2f6a6d3bb012"
      },
      "37f9fa85-f39f-e87e-c47c-2c3241848216": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n     <div fxLayout=\"row\" style=\"width: 100%; height: 40px; justify-content: flex-start;\" fxLayoutAlign=\"start start\">\r\n        <h5 fxFlex class=\"market-title\">Devices</h5>\r\n        <div style=\"margin-right: 30px;\">\r\n        <button id=\"add-device\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add device manually</span></button>\r\n        <button id=\"replace-device\" mat-raised-button color=\"primary\" style=\"display: none;\">\r\n                <mat-icon class=\"tb-mat-20\">add</mat-icon>\r\n                <span>Replace Device</span>\r\n        </button>\r\n        </div> \r\n     </div>\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensorkit_devices_header_buttons\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 800px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Add device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Device</mat-label>\r\n          <mat-select formControlName=\"device\" required>\r\n            <mat-select-trigger>\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.label}}</div>\r\n                  <div class=\"device-name\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type}}</div>\r\n              </div>\r\n            </mat-select-trigger>\r\n            <mat-option *ngFor=\"let device of availableDevices\" [value]=\"device\">\r\n              <div class=\"device-item\" fxLayout=\"row\">\r\n                <div fxLayout=\"column\" fxFlex>\r\n                  <div>{{device?.label}}</div>\r\n                  <div class=\"device-name\">{{device?.name}}</div>\r\n                </div>\r\n                <div class=\"device-type\">{{device?.type}}</div>\r\n              </div>\r\n              <mat-divider></mat-divider>\r\n            </mat-option>\r\n            <mat-option *ngIf=\"!availableDevices?.length\" disabled [value]=\"null\">\r\n              <div class=\"device-item\">\r\n                No devices available\r\n              </div>\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').hasError('required')\">\r\n            Device is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Label</mat-label>\r\n          <input matInput formControlName=\"label\">\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.label').hasError('required')\">\r\n            Device label is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Attributes</ng-template>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Installation Type</mat-label>\r\n          <mat-select formControlName=\"installationType\" required>\r\n            <mat-option value=\"heating\">Heating</mat-option>\r\n            <mat-option value=\"cooling\">Cooling</mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n            Installation Type is required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Outside Temperature Threshold</mat-label>\r\n          <input matInput formControlName=\"loadCourseAnalysisTemperature\" type=\"number\">\r\n        </mat-form-field>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n            <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n              <mat-option value=\"above\">Above</mat-option>\r\n              <mat-option value=\"below\">Below</mat-option>\r\n            </mat-select>\r\n            <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n              Temperature Condition is required.\r\n            </mat-error>\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Outside Temperature Threshold</mat-label>\r\n            <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n          </mat-form-field>\r\n        </div>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n        <mat-form-field class=\"mat-block\" fxFlex>\r\n          <mat-label>Maximum Power Threshold</mat-label>\r\n          <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n        </mat-form-field>\r\n        <mat-form-field class=\"mat-block\" fxFlex>\r\n          <mat-label>Nominal Flow</mat-label>\r\n          <input matInput formControlName=\"nominalFlow\" type=\"number\">\r\n        </mat-form-field>\r\n        </div>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Delta T</mat-label>\r\n            <input matInput formControlName=\"deltaT\" type=\"number\">\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Circulation Pump Energy Consumption</mat-label>\r\n            <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n          </mat-form-field>\r\n          <mat-form-field class=\"mat-block\" fxFlex>\r\n            <mat-label>Floor Volume (l/h)</mat-label>\r\n            <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n          </mat-form-field>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">\r\n            Back\r\n          </button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'P-Flow D116'\">\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        </div>\r\n         <!-- Additional fields for Room Sensor CO2 type -->\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor CO2'\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High CO2 Threshold for critical alarm</mat-label>\r\n                <input matInput formControlName=\"highCo2CriticalThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High CO2 Threshold for major alarm</mat-label>\r\n                <input matInput formControlName=\"highCo2MajorThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <!-- Additional fields for Room Sensor T type -->\r\n        <div *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor T' ||addDeviceFormGroup.get('stepper.assignmentStep.device').value?.type === 'Room Sensor CO2'\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Temperature Critical Threshold</mat-label>\r\n                <input matInput formControlName=\"highTemperatureCriticalThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Humidity Critical Threshold</mat-label>\r\n                <input matInput formControlName=\"highHumidityCriticalThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n            <div fxFlex=\"50%\">\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Temperature Major Threshold</mat-label>\r\n                <input matInput formControlName=\"highTemperatureMajorThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n              <mat-form-field class=\"mat-block\">\r\n                <mat-label>High Humidity Major Threshold</mat-label>\r\n                <input matInput formControlName=\"highHumidityMajorThreshold\" type=\"number\">\r\n              </mat-form-field>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <!-- End of additional fields for Room Sensor T type -->\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n          </button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">\r\n            Back\r\n          </button>\r\n          <button mat-button mat-raised-button color=\"primary\"\r\n                  type=\"submit\"\r\n                  [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n\r\n",
                "customCss": "\n.device-item {\n    line-height: 24px;\n    width: 100%;\n    padding-top: 8px;\n    padding-bottom: 8px;\n}\n\n.device-item .device-name {\n    font-size: 12px;\n    opacity: 0.7;\n}\n\n.device-item .device-type {\n    font-size: 14px;\n    opacity: 0.7;\n}\n\nmat-option {\n    height: auto !important;\n    white-space: normal !important;\n}\n\n.mat-select-value-text {\n    display: block;\n    width: 100%;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\n\r\nif (additionalParams.source === \"replace Device\") {\r\n    if (additionalParams.choice === true) {\r\n        openAddDeviceDialog();\r\n    } else {\r\n        // Handle other cases if needed\r\n    }\r\n} else if (additionalParams.source !== \"replace Device\") {\r\n    openAddDeviceDialog();\r\n}\r\n\r\nfunction openAddDeviceDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                device: [null, [vm.validators.required]],\r\n                label: [{ value: null, disabled: true }]\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: ['heating', [vm.validators.required]],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: ['above', [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                // Additional fields for Room Sensor CO2 type\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                // Additional fields for Room Sensor T type\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null]\r\n            })\r\n        })\r\n    });\r\n    \r\n     // Set initial deltaT based on default installationType\r\n    let initialInstallationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n    if (initialInstallationType === 'heating') {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(15);\r\n    } else if (initialInstallationType === 'cooling') {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(6);\r\n    }\r\n    \r\n    // Watch for changes in installationType to set default deltaT value\r\n    vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').valueChanges.subscribe((installationType) => {\r\n        if (installationType === 'heating') {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(15);\r\n        } else if (installationType === 'cooling') {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').patchValue(6);\r\n        }\r\n    });\r\n    // Additional state to control the visibility of the attributes step\r\n    vm.showAttributesStep = true;\r\n\r\n    vm.addDeviceFormGroup.get('stepper.assignmentStep.device').valueChanges.subscribe((device) => {\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').patchValue(device.label, { emitEvent: false });\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').enable({ emitEvent: false });\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.label').updateValueAndValidity({ onlySelf: true });\r\n\r\n        // Check the device type and conditionally show/hide the attributes step\r\n        if (device.type === \"Room Sensor CO2\" || device.type === \"Room Sensor T\") {\r\n            vm.showAttributesStep = false;\r\n        } else {\r\n            vm.showAttributesStep = true;\r\n        }\r\n\r\n        // Trigger change detection manually\r\n        vm.changeDetectorRef.detectChanges();\r\n    });\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n    var SensorkitId = widgetContext.stateController.getStateParams().selectedSensorkit.entityId;\r\n    vm.addDeviceFormGroup.markAsPristine();\r\n    var device = vm.addDeviceFormGroup.value.stepper.assignmentStep.device;\r\n    var label = vm.addDeviceFormGroup.value.stepper.assignmentStep.label;\r\n    var installationType = vm.addDeviceFormGroup.value.stepper.attributesStep.installationType;\r\n    var maxVolumeFlowCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxVolumeFlowCriticalThreshold;\r\n    var maxVolumeFlowMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxVolumeFlowMajorThreshold;\r\n    var loadCourseAnalysisTemperature = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseAnalysisTemperature;\r\n    var loadCourseFilterTemperature = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterTemperature;\r\n    var loadCourseFilterTemperatureValue = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterTemperatureValue;\r\n    var loadCourseFilterMaxPower = vm.addDeviceFormGroup.value.stepper.attributesStep.loadCourseFilterMaxPower;\r\n    var nominalFlow = vm.addDeviceFormGroup.value.stepper.attributesStep.nominalFlow;\r\n    var deltaT = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaT;\r\n    var deltaTAnalysisPumpEnergy = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaTAnalysisPumpEnergy;\r\n    var deltaTAnalysisFloorVolume = vm.addDeviceFormGroup.value.stepper.attributesStep.deltaTAnalysisFloorVolume;\r\n    var maxEnergyCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxEnergyCriticalThreshold;\r\n    var maxEnergyMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.maxEnergyMajorThreshold;\r\n    var minTemperatureDifferenceCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold;\r\n    var minTemperatureDifferenceMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.minTemperatureDifferenceMajorThreshold;\r\n    var highCo2CriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highCo2CriticalThreshold;\r\n    var highCo2MajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highCo2MajorThreshold;\r\n    var highTemperatureCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highTemperatureCriticalThreshold;\r\n    var highHumidityCriticalThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highHumidityCriticalThreshold;\r\n    var highTemperatureMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highTemperatureMajorThreshold;\r\n    var highHumidityMajorThreshold = vm.addDeviceFormGroup.value.stepper.alarmThresholdsStep.highHumidityMajorThreshold;\r\n\r\n    var deviceId = device.deviceId;\r\n    \r\n    widgetContext.rxjs.forkJoin([\r\n        entityGroupService.removeEntityFromEntityGroup(vm.unassignedDevicesGroup.id.id, deviceId.id),\r\n        saveDeviceToSensorkitRelation(SensorkitId, deviceId),\r\n        saveAttributes(\r\n            deviceId,\r\n            installationType,\r\n            maxVolumeFlowCriticalThreshold,\r\n            maxVolumeFlowMajorThreshold,\r\n            loadCourseAnalysisTemperature,\r\n            loadCourseFilterTemperature,\r\n            loadCourseFilterTemperatureValue,\r\n            loadCourseFilterMaxPower,\r\n            nominalFlow,\r\n            deltaT,\r\n            deltaTAnalysisPumpEnergy,\r\n            deltaTAnalysisFloorVolume,\r\n            maxEnergyCriticalThreshold,\r\n            maxEnergyMajorThreshold,\r\n            minTemperatureDifferenceCriticalThreshold,\r\n            minTemperatureDifferenceMajorThreshold,\r\n            highCo2CriticalThreshold,\r\n            highCo2MajorThreshold,\r\n            highTemperatureCriticalThreshold,\r\n            highHumidityCriticalThreshold,\r\n            highTemperatureMajorThreshold,\r\n            highHumidityMajorThreshold\r\n        ),\r\n        updateDeviceLabel(device, label)\r\n    ]).subscribe(() => {\r\n        widgetContext.updateAliases();\r\n        vm.dialogRef.close(null);\r\n    });\r\n};\r\n\r\n\r\n    init();\r\n\r\n    function init() {\r\n        vm.unassignedDevicesGroup = null;\r\n        vm.assignedDevicesGroup = null;\r\n        vm.availableDevices = [];\r\n        vm.assignedDevices = [];\r\n\r\n        if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n            vm.customerId = widgetContext.stateController.getStateParams().entityId;\r\n        } else {\r\n            vm.customerId = {\r\n                id: widgetContext.currentUser.customerId,\r\n                entityType: 'CUSTOMER'\r\n            };\r\n        }\r\n        entityGroupService.getEntityGroupsByOwnerId(vm.customerId.entityType, vm.customerId.id, 'DEVICE').subscribe((entityGroups) => {\r\n            vm.customerDevicesGroups = entityGroups;\r\n            vm.unassignedDevicesGroup = entityGroups.find(group => group.name === 'Unassigned Sensorkit Devices');\r\n            vm.assignedDevicesGroup = entityGroups.find(group => group.name === 'Sensorkit Devices');\r\n            if (vm.unassignedDevicesGroup) {\r\n                var query = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.unassignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query).subscribe((data) => {\r\n                    vm.availableDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n\r\n                });\r\n            }\r\n            if (vm.assignedDevicesGroup) {\r\n                var query2 = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.assignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: {\r\n                        pageSize: 100,\r\n                        page: 0\r\n                    },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query2).subscribe((data) => {\r\n                    vm.assignedDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n                    if (additionalParams.source === \"qrcode\" || additionalParams.source === \"replace Device\") {\r\n                        checkAdditionalParams();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    function saveDeviceToSensorkitRelation(SensorkitId, deviceId) {\r\n        var relation = {\r\n            from: SensorkitId,\r\n            to: deviceId,\r\n            typeGroup: 'COMMON',\r\n            type: 'Contains'\r\n        };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n\r\n    function saveAttributes(entityId, installationType, maxVolumeFlowCriticalThreshold, maxVolumeFlowMajorThreshold, loadCourseAnalysisTemperature, loadCourseFilterTemperature, loadCourseFilterTemperatureValue, loadCourseFilterMaxPower, nominalFlow,deltaT, deltaTAnalysisPumpEnergy, deltaTAnalysisFloorVolume, maxEnergyCriticalThreshold, maxEnergyMajorThreshold, minTemperatureDifferenceCriticalThreshold, minTemperatureDifferenceMajorThreshold, highCo2CriticalThreshold, highCo2MajorThreshold, highTemperatureCriticalThreshold, highHumidityCriticalThreshold, highTemperatureMajorThreshold, highHumidityMajorThreshold) {\r\n    let attributesArray = [\r\n        { key: 'xPos', value: 0.5 },\r\n        { key: 'yPos', value: 0.5 },\r\n        { key: 'installationType', value: installationType },\r\n        { key: 'maxVolumeFlowCriticalThreshold', value: maxVolumeFlowCriticalThreshold },\r\n        { key: 'maxVolumeFlowMajorThreshold', value: maxVolumeFlowMajorThreshold },\r\n        { key: 'loadCourseAnalysisTemperature', value: loadCourseAnalysisTemperature },\r\n        { key: 'loadCourseFilterTemperature', value: loadCourseFilterTemperature },\r\n        { key: 'loadCourseFilterTemperatureValue', value: loadCourseFilterTemperatureValue },\r\n        { key: 'loadCourseFilterMaxPower', value: loadCourseFilterMaxPower },\r\n        { key: 'nominalFlow', value: nominalFlow },\r\n        { key: 'deltaT', value: deltaT },\r\n        { key: 'deltaTAnalysisPumpEnergy', value: deltaTAnalysisPumpEnergy },\r\n        { key: 'deltaTAnalysisFloorVolume', value: deltaTAnalysisFloorVolume },\r\n        { key: 'maxEnergyCriticalThreshold', value: maxEnergyCriticalThreshold },\r\n        { key: 'maxEnergyMajorThreshold', value: maxEnergyMajorThreshold },\r\n        { key: 'minTemperatureDifferenceCriticalThreshold', value: minTemperatureDifferenceCriticalThreshold },\r\n        { key: 'minTemperatureDifferenceMajorThreshold', value: minTemperatureDifferenceMajorThreshold },\r\n        { key: 'highCo2CriticalThreshold', value: highCo2CriticalThreshold },\r\n        { key: 'highCo2MajorThreshold', value: highCo2MajorThreshold },\r\n        { key: 'highHumidityCriticalThreshold', value: highHumidityCriticalThreshold },\r\n        { key: 'highHumidityMajorThreshold', value: highHumidityMajorThreshold },\r\n        { key: 'highTemperatureCriticalThreshold', value: highTemperatureCriticalThreshold },\r\n        { key: 'highTemperatureMajorThreshold', value: highTemperatureMajorThreshold }\r\n    ];\r\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n}\r\n\r\n\r\n    function updateDeviceLabel(device, label) {\r\n        if (device.label !== label) {\r\n            return deviceService.getDevice(device.deviceId.id).pipe(\r\n                widgetContext.rxjs.switchMap((origDevice) => {\r\n                    origDevice.label = label;\r\n                    return deviceService.saveDevice(origDevice);\r\n                })\r\n            );\r\n        } else {\r\n            return widgetContext.rxjs.of(null);\r\n        }\r\n    }\r\n\r\n    function checkAdditionalParams() {\r\n        const matchingAvailableDevice = vm.availableDevices.find(device => device.name === additionalParams.code);\r\n        const matchingAssignedDevice = vm.assignedDevices.find(device => device.name === additionalParams.code);\r\n\r\n                if (!matchingAvailableDevice && !matchingAssignedDevice) {\r\n            widgetContext.dialogs.alert(\"Device doesn't exist\").subscribe();\r\n        }\r\n        if (matchingAssignedDevice && !matchingAvailableDevice) {\r\n            getSensorkit(additionalParams.code);\r\n        }\r\n        if (matchingAvailableDevice && matchingAssignedDevice) {\r\n            vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { device: matchingAvailableDevice } } }, { emitEvent: false });\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.device').markAsDirty();\r\n            vm.addDeviceFormGroup.updateValueAndValidity();\r\n            setTimeout(() => {\r\n                const selectElement = document.querySelector('mat-select[formControlName=\"device\"]');\r\n                if (selectElement) {\r\n                    selectElement.dispatchEvent(new Event('change'));\r\n                }\r\n\r\n                if (!vm.changeDetectorRef) {\r\n                    vm.changeDetectorRef = widgetContext.$scope.$injector.get('$rootScope').$root.$$childHead;\r\n                }\r\n                vm.changeDetectorRef.$applyAsync();\r\n            });\r\n        }\r\n    }\r\n\r\n    function getSensorkit(code) {\r\n        vm.deviceEntityId = null;\r\n        vm.relations = null;\r\n        vm.assignedToSensorkit = null;\r\n\r\n        deviceService.findByName(code)\r\n            .pipe(\r\n                widgetContext.rxjs.map((origDevice) => {\r\n                    vm.deviceEntityId = origDevice.id.id;\r\n                })\r\n            ).subscribe(() => {\r\n                entityRelationService.findByTo({ 'id': vm.deviceEntityId, 'entityType': 'DEVICE' }).pipe(\r\n                    widgetContext.rxjs.map((origRelation) => {\r\n                        vm.relations = origRelation[0].from.id;\r\n                    })\r\n                ).subscribe(() => {\r\n                    assetService.getAsset(vm.relations).pipe(\r\n                        widgetContext.rxjs.map((origAsset) => {\r\n                            vm.assignedToSensorkit = origAsset.name;\r\n                        })\r\n                    ).subscribe(() => {\r\n                        let actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\r\n                        let qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"replace-device\");\r\n                        let params = {\r\n                            \"sensorkit\": vm.assignedToSensorkit,\r\n                            \"device\": vm.deviceEntityId,\r\n                            \"code\": additionalParams.code\r\n                        };\r\n                        try {\r\n                            vm.dialogRef.close(null);\r\n                            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\r\n                        } catch (error) {\r\n                            widgetContext.dialogs.alert('Error handling widget action:', error);\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n    }\r\n}\r\n\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              },
              {
                "name": "replace-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!-- replace-device-dialog.component.html -->\r\n<div class=\"replace-device-dialog-form\" style=\"width: 400px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Replace Device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-dialog-content fxLayout=\"column\" class=\"mat-typography\">\r\n    <p>{{ confirmationMessage }}</p>\r\n  </mat-dialog-content>\r\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n    <button mat-button color=\"primary\" (click)=\"cancel()\" type=\"button\" cdkFocusInitial>\r\n      No\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\" (click)=\"confirm()\" type=\"button\">\r\n      Yes\r\n    </button>\r\n  </div>\r\n</div>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\n\nopenReplaceDeviceDialog();\n\nfunction openReplaceDeviceDialog() {\n    customDialog.customDialog(htmlTemplate, ReplaceDeviceDialogController).subscribe();\n}\n\nfunction returnSelection(replaceDevice) {\n    let params = {\n        source: \"replace Device\",\n        choice: replaceDevice // Use event.replaceDevice instead of replaceDevice directly\n    };\n    //widgetContext.dialogs.alert(\"User selected 2\" + replaceDevice.toString() + \"!\");\n    try {\n        widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n    } catch (error) {\n        widgetContext.dialogs.alert('Error handling widget action:', error);\n    }\n}\n\nfunction ReplaceDeviceDialogController(instance) {\n    let vm = instance;\n    let replaceDevice;\n    //widgetContext.dialogs.alert(\"Aditional Params: \" + JSON.stringify(additionalParams) + additionalParams.device);\n\n    vm.confirmationMessage = \"Device is already assigned to \" + additionalParams.sensorkit + \"!\\n\" +\n        \"Do you want to remove it from \" + additionalParams.sensorkit + \" and assign it to the current one?\";\n\n    vm.cancel = function() {\n        replaceDevice = false; // Set replaceDevice to false\n        vm.handleConfirm({ replaceDevice: replaceDevice });\n    };\n\n    vm.confirm = function() {\n        let entityId = { 'id': additionalParams.device, 'entityType': 'DEVICE' };\n        let entityGroupId = \"684410d0-bfae-11ee-8196-b3999b4a11b6\";\n        //widgetContext.dialogs.alert(\"Additional Params: \" + JSON.stringify(entityId));\n        try {\n            entityRelationService.deleteRelations(entityId).subscribe(\n                () => {\n                    try {\n                        entityGroupService.addEntityToEntityGroup(entityGroupId, entityId.id).subscribe(\n                            () => {\n                                replaceDevice = true; // Set replaceDevice to true\n                                vm.handleConfirm({ replaceDevice: replaceDevice });\n                            },\n                            error => {\n                                widgetContext.dialogs.alert('Error handling add to Group action: ' + JSON.stringify(error));\n                            }\n                        );\n                    } catch (error) {\n                        widgetContext.dialogs.alert('Error initiating addEntityToEntityGroup: ' + JSON.stringify(error));\n                    }\n                },\n                error => {\n                    widgetContext.dialogs.alert('Error handling deleteRelations: ' + JSON.stringify(error));\n                }\n            );\n        } catch (error) {\n            widgetContext.dialogs.alert('Error initiating deleteRelations: ' + JSON.stringify(error));\n        }\n    };\n\n    vm.handleConfirm = function(event) {\n        vm.dialogRef.close(event);\n        let params = {\n            source: \"replace Device\",\n            choice: event.replaceDevice, // Use event.replaceDevice instead of replaceDevice directly\n            device: additionalParams.device,\n            code: additionalParams.code\n        };\n        try {\n            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n        } catch (error) {\n            widgetContext.dialogs.alert('Error handling widget action:', error);\n        }\n    };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c45ba341-9bcd-8608-b0f5-15317d44eb8a"
              }
            ],
            "headerButton": [
              {
                "name": "qr-code",
                "icon": "qr_code_scanner",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "mobileAction",
                "mobileAction": {
                  "type": "scanQrCode",
                  "handleEmptyResultFunction": "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Scan QR code action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert('Empty result', message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction": "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to scan QR code', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processQrCodeFunction": "// Function body to process result of QR code scanning. \n// - code - scanned QR code\n// - format - scanned QR code format\n//widgetContext.actionsApi.qrCodeCallback(code);\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\n\nlet params = {\n    source: \"qrcode\",\n    code: code\n}\ntry {\n    widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n} catch (error) {\n    widgetContext.dialogs.alert('Error handling widget action:', error);\n}\n\n//showQrCodeDialog(\"Code\", code, format);\nfunction showQrCodeDialog(title, code, format) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Code: ['+code+']<br>Format: ' + format).subscribe();\n    }, 100);\n}\n\n"
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "01671463-1c6c-41bb-da25-4eb5ee1ef842"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "37f9fa85-f39f-e87e-c47c-2c3241848216",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "cb949ac7-0fc6-dd75-c3b0-7e659cf906a0": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a9368516-3948-3176-cf0c-d3f9c15e4031",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1719396870991,
                "endTimeMs": 1719483270991
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_plan\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "cb949ac7-0fc6-dd75-c3b0-7e659cf906a0"
      },
      "dabd43d9-b69b-078f-5202-14359e3af1fd": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a9368516-3948-3176-cf0c-d3f9c15e4031",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1719396870991,
                "endTimeMs": 1719483270991
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\r\n    <div fxFlex fxLayout=\"column\" style=\"position: relative;\">\r\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_table_sensorkit\"></tb-dashboard-state>\r\n    </div>\r\n</div>\r\n",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "dabd43d9-b69b-078f-5202-14359e3af1fd"
      },
      "062dee7d-6e8c-d4a5-9c34-5f0cd6ffe7f8": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "floorplan",
                  "type": "attribute",
                  "label": "floorplan",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.5234606901361916
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showResultMessage": false,
            "displayPreview": true,
            "displayClearButton": false,
            "widgetTitle": "Floor plan",
            "displayApplyButton": false,
            "displayDiscardButton": true
          },
          "title": "Floor plan",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "062dee7d-6e8c-d4a5-9c34-5f0cd6ffe7f8",
        "typeFullFqn": "system.input_widgets.update_server_image_attribute"
      },
      "afdf4c35-40b2-b560-7008-70a4e40e33ea": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1713435502260,
                "endTimeMs": 1713521902260
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "displayEntityLabel": false,
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "entitiesTitle": "Entities"
          },
          "title": "Entities table",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a9368516-3948-3176-cf0c-d3f9c15e4031",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.1849002505353028
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8128568406469565,
                  "decimals": 0
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.3089029814236317,
                  "decimals": 0
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9719730919393044,
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "actionCellButton": [
              {
                "name": "Add Device to Doctorkit",
                "icon": "medical_services",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!--=======================================================================-->\n<!--=====  There are two example templates: for edit and add entity   =====-->\n<!--=======================================================================-->\n<!--========================  Edit entity example  ========================-->\n<!--=======================================================================-->\n<!-- -->\n<!--<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\"-->\n<!--      (ngSubmit)=\"save()\"  class=\"edit-entity-form\">-->\n<!--    <mat-toolbar fxLayout=\"row\" color=\"primary\">-->\n<!--        <h2>Edit {{entityType.toLowerCase()}} {{entityName}}</h2>-->\n<!--        <span fxFlex></span>-->\n<!--        <button mat-icon-button (click)=\"cancel()\" type=\"button\">-->\n<!--            <mat-icon class=\"material-icons\">close</mat-icon>-->\n<!--        </button>-->\n<!--    </mat-toolbar>-->\n<!--    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">-->\n<!--    </mat-progress-bar>-->\n<!--    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>-->\n<!--    <div mat-dialog-content fxLayout=\"column\">-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Name</mat-label>-->\n<!--                <input matInput formControlName=\"entityName\" required readonly=\"\">-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Label</mat-label>-->\n<!--                <input matInput formControlName=\"entityLabel\">-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Type</mat-label>-->\n<!--                <input matInput formControlName=\"entityType\" readonly>-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Type</mat-label>-->\n<!--                <input matInput formControlName=\"type\" readonly>-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div formGroupName=\"attributes\" fxLayout=\"column\">-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Latitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Longitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Address</mat-label>-->\n<!--                    <input matInput formControlName=\"address\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Owner</mat-label>-->\n<!--                    <input matInput formControlName=\"owner\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Integer Value</mat-label>-->\n<!--                    <input type=\"number\" step=\"1\" matInput formControlName=\"number\">-->\n<!--                    <mat-error *ngIf=\"editEntityFormGroup.get('attributes.number').hasError('pattern')\">-->\n<!--                        Invalid integer value.-->\n<!--                    </mat-error>-->\n<!--                </mat-form-field>-->\n<!--                <div class=\"boolean-value-input\" fxLayout=\"column\" fxLayoutAlign=\"center start\" fxFlex>-->\n<!--                    <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                    <mat-checkbox formControlName=\"booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                        {{ (editEntityFormGroup.get('attributes.booleanValue').value ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                    </mat-checkbox>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list old-relations\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"oldRelations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"oldRelations\" -->\n<!--                     *ngFor=\"let relation of oldRelations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        required=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        required=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeOldRelation(i, relation.value)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">New Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"relations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"relations\" *ngFor=\"let relation of relations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        [required]=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        [required]=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeRelation(i)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--            <div>-->\n<!--                <button mat-raised-button color=\"primary\"-->\n<!--                        type=\"button\"-->\n<!--                        (click)=\"addRelation()\"-->\n<!--                        matTooltip=\"Add Relation\"-->\n<!--                        matTooltipPosition=\"above\">-->\n<!--                    Add-->\n<!--                </button>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--    </div>-->\n<!--    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">-->\n<!--        <button mat-button color=\"primary\"-->\n<!--                type=\"button\"-->\n<!--                [disabled]=\"(isLoading$ | async)\"-->\n<!--                (click)=\"cancel()\" cdkFocusInitial>-->\n<!--            Cancel-->\n<!--        </button>-->\n<!--        <button mat-button mat-raised-button color=\"primary\"-->\n<!--                type=\"submit\"-->\n<!--                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">-->\n<!--            Save-->\n<!--        </button>-->\n<!--    </div>-->\n<!--</form>-->\n<!---->\n<!--========================================================================-->\n<!--=========================  Add entity example  =========================-->\n<!--========================================================================-->\n<!---->\n<!--<form #addEntityForm=\"ngForm\" [formGroup]=\"addEntityFormGroup\"-->\n<!--      (ngSubmit)=\"save()\" class=\"add-entity-form\">-->\n<!--    <mat-toolbar fxLayout=\"row\" color=\"primary\">-->\n<!--        <h2>Add entity</h2>-->\n<!--        <span fxFlex></span>-->\n<!--        <button mat-icon-button (click)=\"cancel()\" type=\"button\">-->\n<!--            <mat-icon class=\"material-icons\">close</mat-icon>-->\n<!--        </button>-->\n<!--    </mat-toolbar>-->\n<!--    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">-->\n<!--    </mat-progress-bar>-->\n<!--    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>-->\n<!--    <div mat-dialog-content fxLayout=\"column\">-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Name</mat-label>-->\n<!--                <input matInput formControlName=\"entityName\" required>-->\n<!--                <mat-error *ngIf=\"addEntityFormGroup.get('entityName').hasError('required')\">-->\n<!--                    Entity name is required.-->\n<!--                </mat-error>-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Label</mat-label>-->\n<!--                <input matInput formControlName=\"entityLabel\" >-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <tb-entity-type-select-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"entityType\"-->\n<!--                    [showLabel]=\"true\"-->\n<!--                    [allowedEntityTypes]=\"allowedEntityTypes\"-->\n<!--            ></tb-entity-type-select>-->\n<!--            <tb-entity-subtype-autocomplete-->\n<!--                    fxFlex *ngIf=\"addEntityFormGroup.get('entityType').value == 'ASSET'\"-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"type\"-->\n<!--                    [required]=\"true\"-->\n<!--                    [entityType]=\"'ASSET'\"-->\n<!--            ></tb-entity-subtype-autocomplete>-->\n<!--            <tb-entity-subtype-autocomplete-->\n<!--                    fxFlex *ngIf=\"addEntityFormGroup.get('entityType').value != 'ASSET'\"-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"type\"-->\n<!--                    [required]=\"true\"-->\n<!--                    [entityType]=\"'DEVICE'\"-->\n<!--            ></tb-entity-subtype-autocomplete>-->\n<!--        </div>-->\n<!--        <div formGroupName=\"attributes\" fxLayout=\"column\">-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Latitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Longitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Address</mat-label>-->\n<!--                    <input matInput formControlName=\"address\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Owner</mat-label>-->\n<!--                    <input matInput formControlName=\"owner\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Integer Value</mat-label>-->\n<!--                    <input type=\"number\" step=\"1\" matInput formControlName=\"number\">-->\n<!--                    <mat-error *ngIf=\"addEntityFormGroup.get('attributes.number').hasError('pattern')\">-->\n<!--                        Invalid integer value.-->\n<!--                    </mat-error>-->\n<!--                </mat-form-field>-->\n<!--                <div class=\"boolean-value-input\" fxLayout=\"column\" fxLayoutAlign=\"center start\" fxFlex>-->\n<!--                    <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                    <mat-checkbox formControlName=\"booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                        {{ (addEntityFormGroup.get('attributes.booleanValue').value ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                    </mat-checkbox>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"relations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"relations\" *ngFor=\"let relation of relations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        [required]=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        [required]=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeRelation(i)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--            <div>-->\n<!--                <button mat-raised-button color=\"primary\"-->\n<!--                        type=\"button\"-->\n<!--                        (click)=\"addRelation()\"-->\n<!--                        matTooltip=\"Add Relation\"-->\n<!--                        matTooltipPosition=\"above\">-->\n<!--                    Add-->\n<!--                </button>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--    </div>-->\n<!--    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">-->\n<!--        <button mat-button color=\"primary\"-->\n<!--                type=\"button\"-->\n<!--                [disabled]=\"(isLoading$ | async)\"-->\n<!--                (click)=\"cancel()\" cdkFocusInitial>-->\n<!--            Cancel-->\n<!--        </button>-->\n<!--        <button mat-button mat-raised-button color=\"primary\"-->\n<!--                type=\"submit\"-->\n<!--                [disabled]=\"(isLoading$ | async) || addEntityForm.invalid || !addEntityForm.dirty\">-->\n<!--            Create-->\n<!--        </button>-->\n<!--    </div>-->\n<!--</form>-->\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "/*=======================================================================*/\n/*=====  There are three examples: for delete, edit and add entity  =====*/\n/*=======================================================================*/\n/*=======================  Delete entity example  =======================*/\n/*=======================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//\n//openDeleteEntityDialog();\n//\n//function openDeleteEntityDialog() {\n//    let title = 'Delete ' + entityId.entityType.toLowerCase() + ' ' +\n//                 entityName;\n//    let content = 'Are you sure you want to delete the ' +\n//                  entityId.entityType.toLowerCase() + ' ' + entityName + '?';\n//    dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n//        function(result) {\n//            if (result) {\n//                deleteEntity();\n//            }\n//        }\n//    );\n//}\n//\n//function deleteEntity() {\n//    deleteEntityObservable(entityId).subscribe(\n//        function success() {\n//            widgetContext.updateAliases();\n//        },\n//        function fail() {\n//            showErrorDialog();\n//        }\n//    );\n//}\n//\n//function deleteEntityObservable(entityId) {\n//    if (entityId.entityType == \"ASSET\") {\n//        return assetService.deleteAsset(entityId.id);\n//    } else if (entityId.entityType == \"DEVICE\") {\n//        return deviceService.deleteDevice(entityId.id);\n//    }\n//}\n//\n//function showErrorDialog() {\n//    let title = 'Error';\n//    let content = 'An error occurred while deleting the entity. Please try again.';\n//    dialogs.alert(title, content, 'CLOSE').subscribe(\n//        function(result) {}\n//    );\n//}\n//\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\n//let entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//let attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n//let entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n//\n//openEditEntityDialog();\n//\n//function openEditEntityDialog() {\n//    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n//}\n//\n//function EditEntityDialogController(instance) {\n//    let vm = instance;\n//\n//    vm.entityName = entityName;\n//    vm.entityType = entityId.entityType;\n//    vm.entitySearchDirection = {\n//        from: \"FROM\",\n//        to: \"TO\"\n//    };\n//    vm.attributes = {};\n//    vm.oldRelationsData = [];\n//    vm.relationsToDelete = [];\n//    vm.entity = {};\n//\n//    vm.editEntityFormGroup = vm.fb.group({\n//        entityName: ['', [vm.validators.required]],\n//        entityType: [null],\n//        entityLabel: [null],\n//        type: ['', [vm.validators.required]],\n//        attributes: vm.fb.group({\n//            latitude: [null],\n//            longitude: [null],\n//            address: [null],\n//            owner: [null],\n//            number: [null, [vm.validators.pattern(/^-?[0-9]+$/)]],\n//            booleanValue: [false]\n//        }),\n//        oldRelations: vm.fb.array([]),\n//        relations: vm.fb.array([])\n//    });\n//\n//    getEntityInfo();\n//\n//    vm.cancel = function() {\n//        vm.dialogRef.close(null);\n//    };\n//\n//    vm.relations = function() {\n//        return vm.editEntityFormGroup.get('relations');\n//    };\n//\n//    vm.oldRelations = function() {\n//        return vm.editEntityFormGroup.get('oldRelations');\n//    };\n//\n//    vm.addRelation = function() {\n//        vm.relations().push(vm.fb.group({\n//            relatedEntity: [null, [vm.validators.required]],\n//            relationType: [null, [vm.validators.required]],\n//            direction: [null, [vm.validators.required]]\n//        }));\n//    };\n//\n//    function addOldRelation() {\n//        vm.oldRelations().push(vm.fb.group({\n//            relatedEntity: [{value: null, disabled: true}, [vm.validators.required]],\n//            relationType: [{value: null, disabled: true}, [vm.validators.required]],\n//            direction: [{value: null, disabled: true}, [vm.validators.required]]\n//        }));\n//    }\n//\n//    vm.removeRelation = function(index) {\n//        vm.relations().removeAt(index);\n//        vm.relations().markAsDirty();\n//    };\n//\n//    vm.removeOldRelation = function(index, relation) {\n//        vm.oldRelations().removeAt(index);\n//        vm.relationsToDelete.push(relation);\n//        vm.oldRelations().markAsDirty();\n//    };\n//\n//    vm.save = function() {\n//        vm.editEntityFormGroup.markAsPristine();\n//        widgetContext.rxjs.forkJoin([\n//            saveAttributes(entityId),\n//            saveRelations(entityId),\n//            saveEntity()\n//        ]).subscribe(\n//            function () {\n//                widgetContext.updateAliases();\n//                vm.dialogRef.close(null);\n//            }\n//        );\n//    };\n//\n//    function getEntityAttributes(attributes) {\n//        for (var i = 0; i < attributes.length; i++) {\n//            vm.attributes[attributes[i].key] = attributes[i].value;\n//        }\n//    }\n//\n//    function getEntityRelations(relations) {\n//        let relationsFrom = relations[0];\n//        let relationsTo = relations[1];\n//        for (let i=0; i < relationsFrom.length; i++) {\n//            let relation = {\n//                direction: 'FROM',\n//                relationType: relationsFrom[i].type,\n//                relatedEntity: relationsFrom[i].to\n//            };\n//            vm.oldRelationsData.push(relation);\n//            addOldRelation();\n//        }\n//        for (let i=0; i < relationsTo.length; i++) {\n//            let relation = {\n//                direction: 'TO',\n//                relationType: relationsTo[i].type,\n//                relatedEntity: relationsTo[i].from\n//            };\n//            vm.oldRelationsData.push(relation);\n//            addOldRelation();\n//        }\n//    }\n//\n//    function getEntityInfo() {\n//         widgetContext.rxjs.forkJoin([\n//             entityRelationService.findInfoByFrom(entityId),\n//             entityRelationService.findInfoByTo(entityId),\n//             attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE'),\n//             entityService.getEntity(entityId.entityType, entityId.id)\n//         ]).subscribe(\n//             function (data) {\n//                 getEntityRelations(data.slice(0,2));\n//                 getEntityAttributes(data[2]);\n//                 vm.entity = data[3];\n//                 vm.editEntityFormGroup.patchValue({\n//                     entityName: vm.entity.name,\n//                     entityType: vm.entityType,\n//                     entityLabel: vm.entity.label,\n//                     type: vm.entity.type,\n//                     attributes: vm.attributes,\n//                     oldRelations: vm.oldRelationsData\n//                 }, {emitEvent: false});\n//             }\n//         );\n//     }\n//\n//    function saveEntity() {\n//        const formValues = vm.editEntityFormGroup.value;\n//        if (vm.entity.label !== formValues.entityLabel){\n//            vm.entity.label = formValues.entityLabel;\n//            if (formValues.entityType == 'ASSET') {\n//                return assetService.saveAsset(vm.entity);\n//            } else if (formValues.entityType == 'DEVICE') {\n//                return deviceService.saveDevice(vm.entity);\n//            }\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveAttributes(entityId) {\n//        let attributes = vm.editEntityFormGroup.get('attributes').value;\n//        let attributesArray = [];\n//        for (let key in attributes) {\n//            if (attributes[key] !== vm.attributes[key]) {\n//                attributesArray.push({key: key, value: attributes[key]});\n//            }\n//        }\n//        if (attributesArray.length > 0) {\n//            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveRelations(entityId) {\n//        let relations = vm.editEntityFormGroup.get('relations').value;\n//        let tasks = [];\n//        for(let i=0; i < relations.length; i++) {\n//            let relation = {\n//                type: relations[i].relationType,\n//                typeGroup: 'COMMON'\n//            };\n//            if (relations[i].direction == 'FROM') {\n//                relation.to = relations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = relations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        for (let i=0; i < vm.relationsToDelete.length; i++) {\n//            let relation = {\n//                type: vm.relationsToDelete[i].relationType\n//            };\n//            if (vm.relationsToDelete[i].direction == 'FROM') {\n//                relation.to = vm.relationsToDelete[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = vm.relationsToDelete[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.deleteRelation(relation.from, relation.type, relation.to));\n//        }\n//        if (tasks.length > 0) {\n//            return widgetContext.rxjs.forkJoin(tasks);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//}\n//\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//let attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n//let entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n//\n//openAddEntityDialog();\n//\n//function openAddEntityDialog() {\n//    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\n//}\n//\n//function AddEntityDialogController(instance) {\n//    let vm = instance;\n//\n//    vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\n//    vm.entitySearchDirection = {\n//        from: \"FROM\",\n//        to: \"TO\"\n//    }\n//\n//    vm.addEntityFormGroup = vm.fb.group({\n//      entityName: ['', [vm.validators.required]],\n//      entityType: ['DEVICE'],\n//      entityLabel: [null],\n//      type: ['', [vm.validators.required]],\n//      attributes: vm.fb.group({\n//          latitude: [null],\n//          longitude: [null],\n//          address: [null],\n//          owner: [null],\n//          number: [null, [vm.validators.pattern(/^-?[0-9]+$/)]],\n//          booleanValue: [null]\n//      }),\n//      relations: vm.fb.array([])\n//    });\n//\n//    vm.cancel = function() {\n//        vm.dialogRef.close(null);\n//    };\n//\n//    vm.relations = function() {\n//        return vm.addEntityFormGroup.get('relations');\n//    };\n//\n//    vm.addRelation = function() {\n//        vm.relations().push(vm.fb.group({\n//          relatedEntity: [null, [vm.validators.required]],\n//          relationType: [null, [vm.validators.required]],\n//          direction: [null, [vm.validators.required]]\n//        }));\n//    };\n//\n//    vm.removeRelation = function(index) {\n//        vm.relations().removeAt(index);\n//        vm.relations().markAsDirty();\n//    };\n//\n//    vm.save = function() {\n//        vm.addEntityFormGroup.markAsPristine();\n//        saveEntityObservable().subscribe(\n//            function (entity) {\n//                widgetContext.rxjs.forkJoin([\n//                    saveAttributes(entity.id),\n//                    saveRelations(entity.id)\n//                ]).subscribe(\n//                    function () {\n//                        widgetContext.updateAliases();\n//                        vm.dialogRef.close(null);\n//                    }\n//                );\n//            }\n//        );\n//    };\n//\n//    function saveEntityObservable() {\n//        const formValues = vm.addEntityFormGroup.value;\n//        let entity = {\n//            name: formValues.entityName,\n//            type: formValues.type,\n//            label: formValues.entityLabel\n//        };\n//        if (formValues.entityType == 'ASSET') {\n//            return assetService.saveAsset(entity);\n//        } else if (formValues.entityType == 'DEVICE') {\n//            return deviceService.saveDevice(entity);\n//        }\n//    }\n//\n//    function saveAttributes(entityId) {\n//        let attributes = vm.addEntityFormGroup.get('attributes').value;\n//        let attributesArray = [];\n//        for (let key in attributes) {\n//            if(attributes[key] !== null) {\n//                attributesArray.push({key: key, value: attributes[key]});\n//            }\n//        }\n//        if (attributesArray.length > 0) {\n//            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveRelations(entityId) {\n//        let relations = vm.addEntityFormGroup.get('relations').value;\n//        let tasks = [];\n//        for(let i=0; i < relations.length; i++) {\n//            let relation = {\n//                type: relations[i].relationType,\n//                typeGroup: 'COMMON'\n//            };\n//            if (relations[i].direction == 'FROM') {\n//                relation.to = relations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = relations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        if (tasks.length > 0) {\n//            return widgetContext.rxjs.forkJoin(tasks);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "de8b83e9-cadb-9935-a0a3-45e634805302"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "list",
          "iconColor": null,
          "titleFont": null,
          "titleColor": null,
          "enableDataExport": true,
          "desktopHide": true
        },
        "row": 0,
        "col": 0,
        "id": "afdf4c35-40b2-b560-7008-70a4e40e33ea"
      },
      "0e7bbc5a-393d-557d-af44-bdf80d07edc8": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "filterId": null,
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\n    <div fxLayout=\"row\">\n        <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" fxFlex style=\"height: 430px;\" stateId='edit_Sensorkit_alias'></tb-dashboard-state>\n    </div>\n    <div fxLayout=\"row\">\n        <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" fxFlex style=\"height: 200px;\" stateId='edit_Sensorkit_floorplan'></tb-dashboard-state>\n    </div>\n    <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" fxFlex stateId='edit_Sensorkit_location'></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "return '# Some title\\\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "save-title",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#save-title', widgetContext.$container[0]);\n\nvar title = $(targetElement).attr('data-title');\n\nwidgetContext.assetService.getAsset(entityId.id, {ignoreLoading: true}).subscribe((Sensorkit) => {\n    Sensorkit.name = title;\n    widgetContext.assetService.saveAsset(Sensorkit, null, {ignoreLoading: true}).subscribe(() => {\n       var stateParams = widgetContext.stateController.getStateParams();\n       stateParams.selectedSensorkit.entityName = title;\n       widgetContext.stateController.updateState(null, stateParams);\n       /*if (widgetContext.parentDashboard) {\n           widgetContext.parentDashboard.aliasController.updateAliases();\n       }\n       widgetContext.updateAliases();*/\n    });\n});\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "088a4799-8551-7ab4-892f-2a08d6d40a7c"
              }
            ]
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "0e7bbc5a-393d-557d-af44-bdf80d07edc8",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "5ddbced4-8e27-a3d7-0329-e86b9c613b98": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "filterId": null,
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div style=\"width: 100%; height: 100%;\" fxLayout=\"row\" class=\"attribute-update-form\" style=\"padding: 0 8px;\">\n    <div fxFlex fxLayout=\"column\">\n        <mat-form-field class=\"mat-block\" style=\"width: 100%;\">\n              <mat-label>Title</mat-label>\n              <input #titleInput #titleInputCtrl=\"ngModel\" required matInput [(ngModel)]=\"titleInput.value\"\n                     value=\"${entityName}\" (keyUp.enter)=\"titleInput.value !== '${entityName}' ? saveTitleButton._elementRef.nativeElement.click() : return;\"\n                     (keyUp.escape)=\"titleInput.value = '${entityName}';\"/>\n              <mat-error *ngIf=\"!titleInputCtrl.valid\">Title is required</mat-error>         \n        </mat-form-field>\n    </div>\n    <div class=\"input-buttons\">\n        <button #saveTitleButton id=\"save-title\" [disabled]=\"titleInput.value === '${entityName}' || !titleInputCtrl.valid\" [attr.data-title]=\"titleInput.value\" type=\"button\" mat-icon-button>\n            <mat-icon>check</mat-icon>\n        </button> \n        <button [disabled]=\"titleInput.value === '${entityName}'\" type=\"button\" mat-icon-button (click)=\"titleInput.value = '${entityName}';\">\n            <mat-icon>close</mat-icon>\n        </button>\n    </div>\n</div>\n",
            "markdownCss": ".tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view  .grid__element:last-child {\n    margin-top: 19px;\n    margin-left: 7px;\n}\n\n.tb-markdown-view  .attribute-update-form .mat-icon-button {\n    width: 32px;\n    min-width: 32px;\n    height: 32px;\n    min-height: 32px;\n    padding: 0 !important;\n    margin: 0 !important;\n    line-height: 20px;\n}\n\n.tb-markdown-view  .attribute-update-form .mat-icon-button mat-icon {\n    width: 20px;\n    min-width: 20px;\n    height: 20px;\n    min-height: 20px;\n    font-size: 20px;\n}\n\n.tb-markdown-view .attribute-update-form .input-buttons {\n    margin-top: 19px;\n    margin-left: 7px;\n    display: flex;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "save-title",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#save-title', widgetContext.$container[0]);\n\nvar title = $(targetElement).attr('data-title');\n\nwidgetContext.assetService.getAsset(entityId.id, {ignoreLoading: true}).subscribe((Sensorkit) => {\n    Sensorkit.name = title;\n    widgetContext.assetService.saveAsset(Sensorkit, null, {ignoreLoading: true}).subscribe(() => {\n       widgetContext.stateController.getStateParams().selectedSensorkit.entityName = title;\n       widgetContext.updateAliases();\n    });\n});\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "088a4799-8551-7ab4-892f-2a08d6d40a7c"
              }
            ]
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "5ddbced4-8e27-a3d7-0329-e86b9c613b98",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "f5207bfc-2c70-8adb-9f3e-ebd3cdfba24e": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "latitude",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.862061599769905
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "longitude",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.017864596400994026
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "CartoDB.Positron",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": true,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "",
            "imageUrlAttribute": "",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 14,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": true,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${entityName}",
            "labelFunction": "var deviceType = dsData[dsIndex]['Type'];\r\nif (typeof deviceType !== undefined) {\r\n    if (deviceType == \"energy meter\") {\r\n        return '<span style=\"color:orange;\">${entityName}, ${energy:2} kWt</span>';\r\n    } else if (deviceType == \"thermometer\") {\r\n        return '<span style=\"color:blue;\">${entityName}, ${temperature:2} °C</span>';\r\n    }\r\n}",
            "showTooltip": false,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": false,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><link-act name='Doktorkit-devices'>Doktorkit devices</link-act>",
            "tooltipFunction": "var deviceType = dsData[dsIndex]['Type'];\r\nif (typeof deviceType !== undefined) {\r\n    if (deviceType == \"energy meter\") {\r\n        return '<b>${entityName}</b><br/><b>Energy:</b> ${energy:2} kWt<br/>';\r\n    } else if (deviceType == \"thermometer\") {\r\n        return '<b>${entityName}</b><br/><b>Temperature:</b> ${temperature:2} °C<br/>';\r\n    }\r\n}",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var width = 30;\nvar svgStr = getSensorkitSvg(width);\nvar encodedSvg = encodeURIComponent(svgStr);\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\n\nreturn {\n    url: svgUrl,\n    size: width,\n    markerOffset: [width / 2, width / 2],\n    tooltipOffset: [width * 0.5 - width / 2, - (width / 2)]\n};\n\nfunction getSensorkitSvg(width, isSelected) {\n    var shape = '<path d=\"m18.636 15.8c0.59978 0 1.1276-0.32788 1.3995-0.82369l2.8629-5.1901c0.29589-0.5278-0.08796-1.1836-0.69574-1.1836h-11.836l-0.75172-1.5994h-2.615v1.5994h1.5994l2.8789 6.0697-1.0796 1.9513c-0.58378 1.0716 0.18393 2.3751 1.3995 2.3751h9.5964v-1.5994h-9.5964l0.87967-1.5994zm-7.5092-5.5979h9.7164l-2.2072 3.9985h-5.6139zm0.67175 9.5964c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994 1.5994-0.71973 1.5994-1.5994-0.71973-1.5994-1.5994-1.5994zm7.997 0c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994c0.87967 0 1.5994-0.71973 1.5994-1.5994s-0.71973-1.5994-1.5994-1.5994z\" fill=\"white\" stroke-width=\".7997\"/>';\n    var color = '#1F8B4D';\n    var background = getBackground(color);\n    var svgWidth = width;\n    var svgHeight = 30;\n    \n    var opacity = 1;\n    \n    var SensorkitSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgWidth + '\" height=\"' + svgHeight + '\" viewBox=\"0 0 ' + svgWidth + ' ' + svgHeight + '\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                    background + shape;\n    SensorkitSvg += '</svg>';\n    return SensorkitSvg;    \n}\n\nfunction getBackground(color) {\n     return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>';\n}\n",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "snappable": false,
            "initDragMode": true,
            "hideAllControlButton": true,
            "hideDrawControlButton": false,
            "hideEditControlButton": false,
            "hideRemoveControlButton": false,
            "useClusterMarkers": false,
            "zoomOnClick": true,
            "maxZoom": null,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true,
            "useIconCreateFunction": false,
            "clusterMarkerFunction": null
          },
          "title": "Edit Doktorkit location",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [],
            "tooltipAction": []
          },
          "showTitleIcon": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "titleTooltip": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "f5207bfc-2c70-8adb-9f3e-ebd3cdfba24e",
        "typeFullFqn": "system.maps_v2.openstreetmap"
      },
      "fba391f1-ce10-7dd2-7389-b6c808f5761f": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7546586070710162
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showResultMessage": false,
            "showLabel": true,
            "isRequired": true,
            "labelValue": "Address",
            "requiredErrorMessage": "Address is required"
          },
          "title": "New Update server string attribute",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "fba391f1-ce10-7dd2-7389-b6c808f5761f",
        "typeFullFqn": "system.input_widgets.update_server_string_attribute"
      },
      "ff237520-902e-9e76-589f-7472f2efcd0b": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Title",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.7261262741197994,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.859170990312162,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "Location Alias",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.3661436310629984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "installationLocation",
                  "type": "attribute",
                  "label": "Installation Location",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9713428384988825,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.906407032891368,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "Longitude",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.43074100328683707,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "Latitude",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6537625289167603,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "from",
                  "type": "attribute",
                  "label": "From",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "date",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5519683485420257,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1707571374578,
                "endTimeMs": 1707657774578
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": null,
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "40",
          "settings": {
            "widgetTitle": "Sensorkit Attributes",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": true,
            "saveButtonLabel": "Save",
            "resetButtonLabel": "Undo",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 1,
            "rowGap": 5,
            "columnGap": 10
          },
          "title": "Update Multiple Attributes",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {
            "headerButton": []
          },
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleIcon": null,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px"
        },
        "row": 0,
        "col": 0,
        "id": "ff237520-902e-9e76-589f-7472f2efcd0b"
      }
    },
    "states": {
      "default": {
        "name": "Smart Doktorkit Administration",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "c2559a58-e82d-3250-7e35-f520ced0d916": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "retail_companies": {
        "name": "Retail companies",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "777ded27-e3b8-d901-ca42-3079a23f7a12": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "Doktorkits": {
        "name": "${entityName}: Doktorkits",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ab845ee8-ff10-b684-3652-cb49e2d9acbe": {
                "sizeX": 9,
                "sizeY": 12,
                "row": 0,
                "col": 16
              },
              "7a671e82-7171-d1e2-75cc-565f67598090": {
                "sizeX": 16,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "edit_Doktorkit_card": {
        "name": "Edit Doktorkit card",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "28303a0b-d427-6d9e-0ee1-ae2c3f344769": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "Doktorkits_card": {
        "name": "Doktorkits card",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4a524a3c-2b87-903c-6256-47a5df398ba5": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "edit_Doktorkit_address": {
        "name": "Edit Doktorkit address",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "980bd0c3-44e9-a1f9-c8f9-3dc533011fde": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "edit_Doktorkit_location": {
        "name": "Edit Doktorkit location",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "1d0b53f4-7805-fbfd-1cc6-e91d0df3d4bf": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "edit_Doktorkit_floorplan": {
        "name": "Edit Doktorkit floorplan",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "59df0b6f-17dd-3c4c-a484-69c0836246da": {
                "sizeX": 24,
                "sizeY": 3,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "edit_Doktorkit_title": {
        "name": "edit_Doktorkit_title",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "00041a85-d8fe-09f2-4aab-1c86d8a7444d": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "Doktorkits_map": {
        "name": "Doktorkits map",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "8a7abdae-72fd-610d-7977-4e211fa999f4": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "devices": {
        "name": "${entityName}: Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "eac6e38e-62f2-1f91-754b-299d11e87c19": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "devices_plan": {
        "name": "Devices plan",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0c48ee70-d617-faa5-2418-d9766c6ff378": {
                "sizeX": 24,
                "sizeY": 10,
                "row": 0,
                "col": 6,
                "mobileHide": true
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "edit_Doktorkit_alias": {
        "name": "Edit Doktorkit alias",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2f3d74ea-ed1f-a52a-03c1-9dfb2f956dd8": {
                "sizeX": 24,
                "sizeY": 15,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 0,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "gateways": {
        "name": "${entityName}: Gateways",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0c7469aa-7b86-be27-5216-bc6cc702f8b1": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "Doktorkit_devices_plan": {
        "name": "${selectedDoktorkit:entityName}: Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "5d58360e-ec9a-cace-33d3-f64d2ba8e946": {
                "sizeX": 60,
                "sizeY": 4,
                "row": 0,
                "col": 0
              },
              "faaa7767-eace-1546-163d-30d272242806": {
                "sizeX": 60,
                "sizeY": 24,
                "row": 4,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 60,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "Doktorkit_devices_table": {
        "name": "${selectedDoktorkit:entityName}: Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "1057e70b-f6e4-a753-6411-52246b4f793d": {
                "sizeX": 60,
                "sizeY": 4,
                "row": 0,
                "col": 0
              },
              "c7bcd0ec-a47b-5bb5-d7cf-9c07fbe96d98": {
                "sizeX": 60,
                "sizeY": 24,
                "row": 4,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 60,
              "margin": 5,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "doktorkit_devices_header_buttons": {
        "name": "doktorkit devices header buttons",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "248d9bcd-6dcc-381f-cd4c-211ec095b8c8": {
                "sizeX": 25,
                "sizeY": 1,
                "row": 0,
                "col": 0
              },
              "1bed8029-36f3-d139-9171-d41e4dc9bfa4": {
                "sizeX": 25,
                "sizeY": 1,
                "row": 0,
                "col": 25
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 50,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Sensorkits": {
        "name": "${entityName}: Sensorkits",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ddd7f4ba-76b5-4dc2-2b89-ede83a5e2844": {
                "sizeX": 16,
                "sizeY": 12,
                "row": 0,
                "col": 0
              },
              "edba9e49-62f1-733b-f500-b893b4770b2b": {
                "sizeX": 8,
                "sizeY": 12,
                "row": 0,
                "col": 16
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "payments": {
        "name": "${entityName}: Payments",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {},
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "Sensorkits_card": {
        "name": "Sensorkits Card",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "92ce9463-8441-6190-2fcb-46edda67b9d2": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "Sensorkits_map": {
        "name": "Sensorkits map",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0b67574e-500a-d44a-492b-6aa70ba46690": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "Sensorkit_devices_plan": {
        "name": "${selectedSensorkit:entityName}: Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "37f9fa85-f39f-e87e-c47c-2c3241848216": {
                "sizeX": 24,
                "sizeY": 2,
                "row": 0,
                "col": 0
              },
              "cb949ac7-0fc6-dd75-c3b0-7e659cf906a0": {
                "sizeX": 24,
                "sizeY": 9,
                "row": 2,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "Sensorkit_devices_table": {
        "name": "${selectedSensorkit:entityName}: Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7c944842-fac8-74e6-71f1-7c2325746bae": {
                "sizeX": 25,
                "sizeY": 2,
                "row": 0,
                "col": 0
              },
              "dabd43d9-b69b-078f-5202-14359e3af1fd": {
                "sizeX": 25,
                "sizeY": 12,
                "row": 2,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "sensorkit_devices_header_buttons": {
        "name": "sensorkit devices header buttons",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f930ec11-5a79-ca5e-6460-d6c34d33d099": {
                "sizeX": 12,
                "sizeY": 1,
                "row": 0,
                "col": 12
              },
              "71ab3bf8-933b-3b3f-8262-2f6a6d3bb012": {
                "sizeX": 12,
                "sizeY": 1,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "edit_Sensorkit_address": {
        "name": "Edit Sensorkit address",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "fba391f1-ce10-7dd2-7389-b6c808f5761f": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "edit_Sensorkit_alias": {
        "name": "Edit Sensorkit alias",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ff237520-902e-9e76-589f-7472f2efcd0b": {
                "sizeX": 24,
                "sizeY": 15,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "edit_Sensorkit_card": {
        "name": "Edit Sensorkit card",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0e7bbc5a-393d-557d-af44-bdf80d07edc8": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "edit_Sensorkit_floorplan": {
        "name": "Edit Sensorkit floorplan",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "062dee7d-6e8c-d4a5-9c34-5f0cd6ffe7f8": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "edit_Sensorkit_location": {
        "name": "Edit Sensorkit location",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f5207bfc-2c70-8adb-9f3e-ebd3cdfba24e": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "edit_Sensorkit_title": {
        "name": "edit_Sensorkit_title",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "5ddbced4-8e27-a3d7-0329-e86b9c613b98": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "devices_table_doktorkit": {
        "name": "Devices table Doktorkit",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "3e37bd68-28bb-243c-012d-785d1b7d92bf": {
                "sizeX": 29,
                "sizeY": 14,
                "desktopHide": false,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      },
      "devices_table_sensorkit": {
        "name": "Devices table Sensorkit",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "afdf4c35-40b2-b560-7008-70a4e40e33ea": {
                "sizeX": 29,
                "sizeY": 14,
                "desktopHide": false,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true
            }
          }
        }
      }
    },
    "entityAliases": {
      "1c348dad-e738-a4db-5e7e-4c0271790ab7": {
        "id": "1c348dad-e738-a4db-5e7e-4c0271790ab7",
        "alias": "Doktorkits",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Doktorkit"
          ]
        }
      },
      "d13f6078-0d81-ec59-529c-64acbbcaf470": {
        "id": "d13f6078-0d81-ec59-529c-64acbbcaf470",
        "alias": "Doktorkit Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "P-Flow D116"
          ]
        }
      },
      "04917190-aea7-e407-e308-4598f1671a71": {
        "id": "04917190-aea7-e407-e308-4598f1671a71",
        "alias": "Retrofit Partner",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": false,
          "stateEntityParamName": "selectedCustomer",
          "groupType": "CUSTOMER",
          "entityGroupNameFilter": "Belimo Retrofit"
        }
      },
      "7add11d8-cbf7-fd15-6b12-d5df058f11fa": {
        "id": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
        "alias": "Selected Doktorkit",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null
        }
      },
      "984b0bbe-9a03-40ac-90f0-31db7e70dc8c": {
        "id": "984b0bbe-9a03-40ac-90f0-31db7e70dc8c",
        "alias": "Customer Doktorkit Devices",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": true,
          "stateEntityParamName": null,
          "groupType": "DEVICE",
          "entityGroupNameFilter": "Doktorkit Devices"
        }
      },
      "60f60877-be45-311d-9ee7-25b68c466d89": {
        "id": "60f60877-be45-311d-9ee7-25b68c466d89",
        "alias": "Customer Doktorkit Gateways",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": true,
          "stateEntityParamName": null,
          "groupType": "DEVICE",
          "entityGroupNameFilter": "Gateways"
        }
      },
      "fe796be3-ffda-37f5-f182-7fb7fcd53f31": {
        "id": "fe796be3-ffda-37f5-f182-7fb7fcd53f31",
        "alias": "Selected device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null
        }
      },
      "21d657b1-d301-fa72-ed75-6e2000eb5e51": {
        "id": "21d657b1-d301-fa72-ed75-6e2000eb5e51",
        "alias": "Retrofit Partner 2",
        "filter": {
          "type": "entityGroup",
          "resolveMultiple": true,
          "groupStateEntity": false,
          "stateEntityParamName": null,
          "defaultStateGroupType": "CUSTOMER",
          "defaultStateEntityGroup": null,
          "groupType": "CUSTOMER",
          "entityGroup": "efb837e0-b576-11ee-a6c2-a149ed03c64d"
        }
      },
      "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59": {
        "id": "896c66c9-0794-cec4-6ad5-fa6bc6ddbb59",
        "alias": "Selected Sensorkit",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedSensorkit",
          "defaultStateEntity": null
        }
      },
      "7c45df90-1684-2f63-5740-c34127d166b2": {
        "id": "7c45df90-1684-2f63-5740-c34127d166b2",
        "alias": "Sensorkits",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Sensorkit"
          ]
        }
      },
      "a9368516-3948-3176-cf0c-d3f9c15e4031": {
        "id": "a9368516-3948-3176-cf0c-d3f9c15e4031",
        "alias": "Sensorkit Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedSensorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor CO2",
            "Room Sensor T"
          ]
        }
      },
      "8545626f-19c9-df34-f9c4-a571cfdee614": {
        "id": "8545626f-19c9-df34-f9c4-a571cfdee614",
        "alias": "Customer Sensorkit Devices",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": true,
          "stateEntityParamName": null,
          "groupType": "DEVICE",
          "entityGroupNameFilter": "Sensorkit Devices"
        }
      },
      "f2b1f47e-b19c-acc9-4ef5-587e62c2d98c": {
        "id": "f2b1f47e-b19c-acc9-4ef5-587e62c2d98c",
        "alias": "Customer Sensorkit Gateways",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": false,
          "stateEntityParamName": null,
          "groupType": "DEVICE",
          "entityGroupNameFilter": "Gateways"
        }
      },
      "358179a7-a92c-b539-e43d-6d3e6251938d": {
        "id": "358179a7-a92c-b539-e43d-6d3e6251938d",
        "alias": "Customer Devices",
        "filter": {
          "type": "entityGroupList",
          "resolveMultiple": true,
          "groupType": "DEVICE",
          "entityGroupList": [
            "efb85ef1-b576-11ee-a6c2-a149ed03c64d"
          ]
        }
      },
      "67255800-8289-4839-c068-7a223831f12a": {
        "id": "67255800-8289-4839-c068-7a223831f12a",
        "alias": "Devices",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": true,
          "stateEntityParamName": null,
          "groupType": "DEVICE",
          "entityGroupNameFilter": "Kit Devices"
        }
      }
    },
    "filters": {},
    "timewindow": {
      "displayValue": "",
      "hideInterval": false,
      "hideAggregation": false,
      "hideAggInterval": false,
      "hideTimezone": false,
      "selectedTab": 0,
      "realtime": {
        "realtimeType": 0,
        "interval": 1000,
        "timewindowMs": 60000,
        "quickInterval": "CURRENT_DAY"
      },
      "history": {
        "historyType": 0,
        "interval": 1000,
        "timewindowMs": 60000,
        "fixedTimewindow": {
          "startTimeMs": 1639908545606,
          "endTimeMs": 1639994945606
        },
        "quickInterval": "CURRENT_DAY"
      },
      "aggregation": {
        "type": "AVG",
        "limit": 25000
      }
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": true,
      "showEntitiesSelect": false,
      "showDashboardTimewindow": false,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true,
      "titleColor": "rgba(0,0,0,0.870588)",
      "showDashboardLogo": false,
      "dashboardLogoUrl": null,
      "hideToolbar": false,
      "showFilters": false,
      "showUpdateDashboardImage": false,
      "dashboardCss": ".tb-widget-container > .tb-widget {\n    border-radius: 8px;\n}\n\ngridster-item:not(.tb-noselect) > .tb-widget-container > .tb-widget {\n    cursor: default !important;\n}\n\n.tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-row {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-legend-keys {\n    cursor: pointer;\n}"
    }
  },
  "name": "Retrofit Partner Administration",
  "resources": null,
  "id": {
    "entityType": "DASHBOARD",
    "id": "d6561ca0-5953-11ef-9653-5b043856d68a"
  },
  "createdTime": 1723540208490,
  "tenantId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  },
  "customerId": null,
  "assignedCustomers": null,
  "externalId": null,
  "version": 28,
  "ownerId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  }
}