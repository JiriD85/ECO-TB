{
  "title": "Energiemanagement Administration",
  "image": "tb-image;/api/images/tenant/smart-meter_17306237.png",
  "mobileHide": false,
  "mobileOrder": 6,
  "configuration": {
    "description": "",
    "widgets": {
      "c041f263-bbb2-823f-99b0-7d89ba3d3754": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "disabled",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.30807984538041655,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "ownerName",
                  "type": "entityField",
                  "label": "Owner name",
                  "color": "#cddc39",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "disabled",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.24537248064543693,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#673ab7",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "disabled",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.255285117191699,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#009688",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "disabled",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.8435953448042998,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayName",
                  "type": "attribute",
                  "label": "Display Name",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.8308645356850439,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "Meter Type",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "H",
                        "label": "WMZ"
                      },
                      {
                        "value": "C",
                        "label": "KMZ"
                      },
                      {
                        "value": "CHC",
                        "label": "HYZ"
                      },
                      {
                        "value": "W",
                        "label": "KWZ"
                      },
                      {
                        "value": "WW",
                        "label": "WWZ"
                      },
                      {
                        "value": "E",
                        "label": "ELZ"
                      },
                      {
                        "value": "G",
                        "label": "GAS"
                      },
                      {
                        "value": "S",
                        "label": "Sensor"
                      },
                      {
                        "value": "Other",
                        "label": "Other"
                      },
                      {
                        "value": "MUC",
                        "label": "MUC"
                      },
                      {
                        "value": "Gateway",
                        "label": "Gateway"
                      },
                      {
                        "value": "API",
                        "label": "API"
                      },
                      {
                        "value": "Converter",
                        "label": "Converter"
                      }
                    ],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.11093456331679019,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "forwardTo",
                  "type": "attribute",
                  "label": "Integration",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "Energy Expert API",
                        "label": "Energy Expert API"
                      },
                      {
                        "value": "Energy Expert Forward",
                        "label": "Energy Expert Forward"
                      },
                      {
                        "value": "Energy Expert",
                        "label": "Energy Expert"
                      },
                      {
                        "value": "IoT Hub",
                        "label": "IoT Hub"
                      },
                      {
                        "value": "None",
                        "label": "No Integration"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.47964771970150744,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "inactivityTimeout",
                  "type": "attribute",
                  "label": "Inactivity Timeout",
                  "color": "#2196f3",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return value/60/1000;",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value*60*1000;"
                  },
                  "_hash": 0.22637598131028258,
                  "aggregationType": null,
                  "units": "min",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "meterId",
                  "type": "attribute",
                  "label": "Meter ID",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.3540480972878266,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "mainDatapoint",
                  "type": "attribute",
                  "label": "Main Datapoint",
                  "color": "#ff5722",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "readonly",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.8993220872068526,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "mucId",
                  "type": "attribute",
                  "label": "MUC ID",
                  "color": "#00c853",
                  "settings": {
                    "dataKeyHidden": true,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5815969851546697,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "eeMqttTopic",
                  "type": "attribute",
                  "label": "EE MQTT Topic",
                  "color": "#d50000",
                  "settings": {
                    "dataKeyHidden": true,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.3148426326824876,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "cfgAttributesCreated",
                  "type": "attribute",
                  "label": "Trigger EE Config",
                  "color": "#2962ff",
                  "settings": {
                    "dataKeyHidden": true,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6872195732225846,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "offset",
                  "type": "attribute",
                  "label": "Offset",
                  "color": "#00bcd4",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "double",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.2103948358701193,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "counterFactor",
                  "type": "attribute",
                  "label": "Counter Factor",
                  "color": "#ff5722",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "double",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.8988028436911775,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "4e0d3536-3894-3955-99c2-a40916175da9",
              "dataKeys": [
                {
                  "name": "isLoRaWANDevice",
                  "type": "attribute",
                  "label": "LoRaWAN Device",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "sensors",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.9865899718096911,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "isDisabled",
                  "type": "attribute",
                  "label": "Enable in CS",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "power_settings_new",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.1710755593177009,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value === true) {\n    return false;\n} else return true;"
                },
                {
                  "name": "appKey",
                  "type": "attribute",
                  "label": "App Key",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.9194583760515146,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "devEui",
                  "type": "attribute",
                  "label": "Dev EUI",
                  "color": "#ffeb3b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.32710943166037554,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "deviceProfileId",
                  "type": "attribute",
                  "label": "Device Profile in CS",
                  "color": "#03a9f4",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "isLoRaWANDevice",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "8020b2cd-f4a5-4697-824f-ae6ac0f7152a",
                        "label": "Acrios M-Bus IoT converter"
                      },
                      {
                        "value": "3cbe1ca7-a464-4667-b107-01bdf32af718",
                        "label": "Adeunis Analog"
                      },
                      {
                        "value": "fd28688a-61f7-4773-9472-d46d17d37284",
                        "label": "Dragino CPL01"
                      },
                      {
                        "value": "f4c684e5-accb-47b7-ac0d-c355135c1a84",
                        "label": "Eastron SDM230"
                      },
                      {
                        "value": "c40c83d0-4157-4030-a995-7d0f73b7f796",
                        "label": "Eastron SDM630MCT"
                      },
                      {
                        "value": "9def6e68-ad33-48d5-bed9-14a1b22c2567",
                        "label": "Elsys EMS Door"
                      },
                      {
                        "value": "0901f567-63f3-48c0-830f-076195a68aaf",
                        "label": "Elsys ERS CO2 Lite"
                      },
                      {
                        "value": "52293c15-0219-48ab-8064-86dd198d11d2",
                        "label": "Elsys ERS Lite"
                      },
                      {
                        "value": "9148c483-ad3e-403e-b8ff-c06e9dfaf4f9",
                        "label": "EMU Professional II LoRa"
                      },
                      {
                        "value": "ef257efa-a7d4-4cc6-86e2-deb9d628f77a",
                        "label": "Enginko LW06485 Energy Valve"
                      },
                      {
                        "value": "6df1dcb5-b330-4c7f-8ddd-84c4bf468335",
                        "label": "Fludia FM432g"
                      },
                      {
                        "value": "62c9b89b-1eda-45e7-864f-c7bbb84b92c2",
                        "label": "Innotas Modularis"
                      },
                      {
                        "value": "a0e3fdcd-4ed4-4fc5-b909-3b54aa1d5be1",
                        "label": "MClimate Multipurpose Button"
                      },
                      {
                        "value": "02f861e1-1f95-45f8-90ff-bf9e4088c44e",
                        "label": "Milesight AM300"
                      },
                      {
                        "value": "9fbf95d7-e555-4ee3-9939-ed94046fcc10",
                        "label": "Milesight EM300-DI"
                      },
                      {
                        "value": "6d22439b-bb2c-4c2b-acb1-b2fc430f2c38",
                        "label": "Milesight EM300-TH"
                      },
                      {
                        "value": "8ba1ba84-97b9-4817-8a3b-28c9e8ac12d3",
                        "label": "Milesight EM300-ZLD"
                      },
                      {
                        "value": "0eac0920-5a07-4669-8918-882cddab5a51",
                        "label": "Milesight EM310-UDL"
                      },
                      {
                        "value": "a0d5859c-96a0-4658-bc37-7cdb7c108631",
                        "label": "Milesight UC100"
                      },
                      {
                        "value": "fa285287-1203-4b24-a762-b3b9186fc987",
                        "label": "Milesight WS101"
                      },
                      {
                        "value": "76f4af07-286b-4421-bc0a-82f0160ac120",
                        "label": "Milesight WS301"
                      },
                      {
                        "value": "dc3d051f-a3a6-4b7b-91ee-6d5afd25ffbf",
                        "label": "Milesight WS522"
                      },
                      {
                        "value": "e61d2c6a-e3e2-404b-9779-6926969463e6",
                        "label": "Sontex Supercal 739"
                      },
                      {
                        "value": "bc262398-c81f-4460-bf89-6ed426eba080",
                        "label": "Wassergeraete VoluMess VI-E"
                      },
                      {
                        "value": "null",
                        "label": "No Selection"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5119726936319918,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "applicationId",
                  "type": "attribute",
                  "label": "Application in CS",
                  "color": "#ff9800",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "isLoRaWANDevice",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "f39aacae-3622-4e19-91a0-b1f8df30737c",
                        "label": "AKBild"
                      },
                      {
                        "value": "391b5688-6873-427f-847d-c7ecb3c0321b",
                        "label": "Arealis"
                      },
                      {
                        "value": "599aa47b-d9db-4ce1-88e6-8dbc9ac729fc",
                        "label": "BAWAG"
                      },
                      {
                        "value": "410c4c8a-b522-4a9d-9840-9c41a14f2ff3",
                        "label": "Bilfinger"
                      },
                      {
                        "value": "4143221b-ec1e-4aef-b9e2-379060b0d96c",
                        "label": "Hotel Sacher Salzburg"
                      },
                      {
                        "value": "2a3d5a98-a8dd-416d-869d-0a7c8a1fef44",
                        "label": "Humanomed"
                      },
                      {
                        "value": "2c427b51-3609-4932-b495-4293b02c7b88",
                        "label": "ICON Vienna"
                      },
                      {
                        "value": "58dea514-530c-45af-8aac-45f797ce3f13",
                        "label": "IG Immobilien"
                      },
                      {
                        "value": "4d4ed2d2-b9f5-4e49-b58e-02ff466b4c04",
                        "label": "OSG"
                      },
                      {
                        "value": "670669d0-6d51-4e55-9ef2-2af4129c451c",
                        "label": "PKE Test"
                      },
                      {
                        "value": "43729bf4-da49-4d37-8d5f-2b50bb2f70c5",
                        "label": "PKE Deutschland"
                      },
                      {
                        "value": "64dcb625-3826-458d-81c5-81c63714e0c9",
                        "label": "PKE Oesterreich"
                      },
                      {
                        "value": "73957256-89d6-45f1-bec0-ae1597ea258e",
                        "label": "Real Estate Burgenland"
                      },
                      {
                        "value": "2f2c8421-34dc-4728-9200-5c28d4c0bc78",
                        "label": "Sturm Messdienste"
                      },
                      {
                        "value": "cb4ff58b-db7f-486d-be15-21d3de7768c5",
                        "label": "Wiener Wohnen"
                      },
                      {
                        "value": "61ba6f18-29f4-4f8a-99d9-ea056ac3b13e",
                        "label": "Dockal"
                      },
                      {
                        "value": "e76f16e2-04c2-40be-87f2-b507334ed39e",
                        "label": "Austria Real Estate"
                      },
                      {
                        "value": "e1608ddd-e4e7-47ec-b9f5-04e8c9bf5e7f",
                        "label": "Erzbistum Wien"
                      },
                      {
                        "value": "713d58ee-1f37-4f8d-ba3d-d4eb428a38ed",
                        "label": "Green"
                      },
                      {
                        "value": "4143221b-ec1e-4aef-b9e2-379060b0d96c",
                        "label": "Hotel Sacher"
                      },
                      {
                        "value": "0ec1c4a5-9609-4733-9148-a0e817774c97",
                        "label": "Solid Campus"
                      },
                      {
                        "value": "null",
                        "label": "No Selection"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6738967281594584,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9557fc2a-5b75-2111-2686-e72cdbe60236",
              "dataKeys": [
                {
                  "name": "vpnIp",
                  "type": "attribute",
                  "label": "VPN IP",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.39351448471859296,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709744245406,
                "endTimeMs": 1709830645406
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FAFAFA",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 2,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "Device Attributes",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "displayTimewindow": true,
          "showTitleIcon": true,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px"
        },
        "row": 0,
        "col": 0,
        "id": "c041f263-bbb2-823f-99b0-7d89ba3d3754"
      },
      "af25b50d-3ba5-4adf-65ad-f955a8a54111": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "5b0de159-a631-e2d6-c153-a4c3b5dc60e4",
              "dataKeys": [
                {
                  "name": "eeProjectGuid",
                  "type": "attribute",
                  "label": "eeProjectGuid",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.028609724719192542
                },
                {
                  "name": "weatherAPIToken",
                  "type": "attribute",
                  "label": "weatherAPIToken",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.22890724209292657
                },
                {
                  "name": "solarEdgeAPIToken",
                  "type": "attribute",
                  "label": "solarEdgeAPIToken",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8341564121583211,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "froniusAPIToken",
                  "type": "attribute",
                  "label": "froniusAPIToken",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.6927620611572922
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709761791025,
                "endTimeMs": 1709848191025
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": true,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "column",
            "fieldsInRow": null,
            "rowGap": 2,
            "columnGap": 10
          },
          "title": "Update Customer Attributes",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "showTitleIcon": false,
          "titleTooltip": ""
        },
        "row": 0,
        "col": 0,
        "id": "af25b50d-3ba5-4adf-65ad-f955a8a54111"
      },
      "ca3c9991-7d3d-76a4-4ed0-4bccf109076c": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "33721d14-df94-e23d-f1b0-a13735f4b9cb",
              "dataKeys": [
                {
                  "name": "specificEEProjectGuid",
                  "type": "attribute",
                  "label": "Specific Project GUID in Energy Expert",
                  "color": "#4caf50",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.04201522719735995,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "eeProjectGuid",
                  "type": "attribute",
                  "label": "Specific Energy Expert Project GUID",
                  "color": "#2196f3",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "specificEEProjectGuid",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5504658509680118,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "street",
                  "type": "attribute",
                  "label": "Street",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.3422200964566555,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "plz",
                  "type": "attribute",
                  "label": "PLZ",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.15182813533612483,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "city",
                  "type": "attribute",
                  "label": "City",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.756211124743891,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "Latitude",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.7788885981653226,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "Longitude",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.44981795075992537,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709763182296,
                "endTimeMs": 1709849582296
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": true,
            "groupTitle": "${entityLabel}",
            "fieldsAlignment": "column",
            "fieldsInRow": 2,
            "rowGap": 2,
            "columnGap": 10
          },
          "title": "Update Location Attributes",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "ca3c9991-7d3d-76a4-4ed0-4bccf109076c"
      },
      "af648660-82b1-7785-e56f-5d9ab107a043": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d448bf9d-472d-50c0-673d-d6ef75ccd28f",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.9967549141360346
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.5624884360658327
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8984113434164049
                },
                {
                  "name": "displayName",
                  "type": "attribute",
                  "label": "displayName",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.25180997441907293
                },
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "status_battery_level",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.22071149447668148
                },
                {
                  "name": "status_margin",
                  "type": "timeseries",
                  "label": "status_margin",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.9146292142531982
                },
                {
                  "name": "battery",
                  "type": "timeseries",
                  "label": "battery",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8061053402016021
                },
                {
                  "name": "vpnIp",
                  "type": "attribute",
                  "label": "vpnIp",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.049656195239825895
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "meterType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.8248093970853291
                },
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "service",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.43793392037516243
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.13086289102320703
                },
                {
                  "name": "lastActivityTime",
                  "type": "attribute",
                  "label": "lastActivityTime",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.22434944053371275,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": {
                    "body": "//return utils.unixToIso(value);\n\nif (value) {\n  return moment(value).format(\"DD/MM/YY HH:mm\");\n}\nreturn '{i18n:custom.activity.never-seen}';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                    }
                  }
                },
                {
                  "name": "rssi",
                  "type": "timeseries",
                  "label": "rssi",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.028010026066390692
                },
                {
                  "name": "snr",
                  "type": "timeseries",
                  "label": "snr",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.9752331552707985
                },
                {
                  "name": "sim",
                  "type": "attribute",
                  "label": "sim",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.5048478617351604
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "entityName",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.0627942695322049,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "e8f543a9-82ff-0b69-d012-8349ea363657",
              "dataKeys": [
                {
                  "name": "sim_ip",
                  "type": "attribute",
                  "label": "sim_ip",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.2563743905893755
                },
                {
                  "name": "sim_status",
                  "type": "attribute",
                  "label": "sim_status",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.3596255622913921
                },
                {
                  "name": "sim_provider",
                  "type": "attribute",
                  "label": "sim_provider",
                  "color": "#ff5722",
                  "settings": {},
                  "_hash": 0.09768258511490857
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1711476503570,
                "endTimeMs": 1711562903570
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FAFAFA",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "var name, label, type, displayName, active, batteryLevel, linkMargin;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    type = data[0]['Type'];\n    displayName = data[0]['displayName'];\n    active = data[0]['active'];\n    batteryLevel = data[0]['status_battery_level'];\n    linkMargin = data[0]['status_margin'];\n    if (active === 'false') {\n        state = 'disconnected';\n    } else state = 'connected';\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    displayName = 'N/A';\n    active = 'N/A';\n    batteryLevel = 'N/A';\n    linkMargin = 'N/A';\n}\n\nvar displayBatteryLevel = showBatteryLevel(type);\n\nvar typeSvg = getTypeSvg(type);\n    var encodedTypeSvg = encodeURIComponent(typeSvg);\n    var typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + label + '</div>' +\n                   '<div class=\"subtitle\">' + displayName + '</div>' +\n                '</div>' +\n//                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-day\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">dashboard</mat-icon><span>Day</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-full\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">device-dashboard</mat-icon><span>Dashboard</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"settings\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">settings</mat-icon><span>Settings</span></button></div>' +\n                '</div>';\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n          header +\n          '<div fxLayout=\"row\" class=\"params\">' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Type: </div>' +\n                '<div class=\"param\">'+ type +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Label: </div>' +\n                '<div class=\"param\">'+ label +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">State: </div>' +\n                '<div class=\"param\">'+ getStateHtml(state) +'</div>' +\n              '</div>' +\n              (displayBatteryLevel ? ('<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Battery level: </div>' +\n                '<div class=\"param\">'+ getBatteryLevelHtml(batteryLevel) +'</div>' +\n              '</div>') : '') +\n          '</div>' +\n       '<div>';\n\nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Enginko LW06485_EV':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Elsys ERS Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Milesight EM300-TH':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Elsys ERS CO2 Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Milesight AM300':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M360-480q17 0 28.5-11.5T400-520v-120q0-17-11.5-28.5T360-680q-17 0-28.5 11.5T320-640v120q0 17 11.5 28.5T360-480Zm40 240h160v-80q0-33-23.5-56.5T480-400q-33 0-56.5 23.5T400-320v80Zm200-240q17 0 28.5-11.5T640-520v-120q0-17-11.5-28.5T600-680q-17 0-28.5 11.5T560-640v120q0 17 11.5 28.5T600-480ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z\"/></svg>';\n            break;\n        case 'Milesight WS522':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Dragino CPL01':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Adeunis Pulse':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-160h80v160h160v80H160ZM80-640v-160q0-33 23.5-56.5T160-880h160v80H160v160H80Zm360 436q-92-14-157-79t-79-157h80q12 59 54.5 101.5T440-284v80ZM204-520q14-92 79-157.5T440-756v80q-59 12-101.5 54.5T284-520h-80Zm276 120q-33 0-56.5-23.5T400-480q0-34 23.5-57t56.5-23q34 0 57 23t23 57q0 33-23 56.5T480-400Zm40 196v-80q59-12 101.5-54.5T676-440h80q-13 92-78.5 157T520-204Zm156-316q-12-59-54.5-101.5T520-676v-80q92 14 157.5 79T756-520h-80ZM640-80v-80h160v-160h80v160q0 33-23.5 56.5T800-80H640Zm160-560v-160H640v-80h160q33 0 56.5 23.5T880-800v160h-80Z\"/></svg>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-520q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM240-280v-76q0-21 10.5-39.5T279-425q45-26 95-40.5T480-480q56 0 106 14.5t95 40.5q18 11 28.5 29.5T720-356v76H240Zm609-354q-31-73-86.5-128.5T634-849l31-74q88 36 154.5 103T923-665l-74 31Zm-738 0-74-31q37-88 103.5-154.5T295-923l31 74q-73 31-128.5 86.5T111-634ZM295-37q-88-36-154.5-103T37-295l74-31q31 73 86.5 128.5T326-111l-31 74Zm370 0-31-74q73-31 128.5-86.5T849-326l74 31q-36 88-103 154.5T665-37Z\"/></svg>';\n            break;\n        case 'Innotas Modularis':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M491-200q12-1 20.5-9.5T520-230q0-14-9-22.5t-23-7.5q-41 3-87-22.5T343-375q-2-11-10.5-18t-19.5-7q-14 0-23 10.5t-6 24.5q17 91 80 130t127 35ZM480-80q-137 0-228.5-94T160-408q0-100 79.5-217.5T480-880q161 137 240.5 254.5T800-408q0 140-91.5 234T480-80Zm0-80q104 0 172-70.5T720-408q0-73-60.5-165T480-774Q361-665 300.5-573T240-408q0 107 68 177.5T480-160Zm0-320Z\"/></svg>';\n            break;\n        case 'Fludia FM432g':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Fludia FM432e':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM310-UDL':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight WS301':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-DI':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-ZLD':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KWZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC WMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC ELZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC GZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC Device':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return typeSvg;\n} \n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n    '</span>';\n}\n\nfunction getBatteryLevelHtml(batteryLevel) {\n    var batteryLevelNumber = Number(batteryLevel);\n    var batteryLevelSvg = getBatteryLevelSvg(batteryLevelNumber);\n    var encodedBatteryLevelSvg = encodeURIComponent(batteryLevelSvg);\n    var batteryLevelSvgUrl = 'data:image/svg+xml,' + encodedBatteryLevelSvg;\n    return '<div>' +\n              '<img class=\"mat-icon\" src=\"'+ batteryLevelSvgUrl +'\">' +\n              '<span style=\"padding-left: 8px; padding-right: 8px;\">' + batteryLevelNumber.toFixed(0) + '%</span>' +\n              '<button id=\"battery-level\" matTooltip=\"Battery Level History\" type=\"button\" mat-flat-button color=\"primary\"><mat-icon>bar_chart</mat-icon></button>' +\n            '</div>';\n}\n\n\nfunction getStateSvg(state) {\n    switch (state) {\n/*        \n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>'; \n*/\n        case 'connected':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getBatteryLevelSvg(batteryLevel) {\n    var batteryLevelSvg;\n    if (batteryLevel <= 5) {\n        batteryLevelSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 35) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#E64A19\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 65) {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#D5C21B\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#D5C21B\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#D5C21B\"/>';\n    } else if (batteryLevel <= 95) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 11H14V13H6V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 8H6V10H14V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#1F8B4D\"/>';\n    } else {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 8H14V10H6V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 5H6V7H14V5Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#1F8B4D\"/>';\n    }\n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n              batteryLevelSvg +\n            '</svg>';\n}\n\n\nfunction getStateLabel(state) {\n    switch(state) {\n/*        \n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n*/\n        case 'connected':\n            return 'Connected';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n\nfunction showBatteryLevel(deviceType) {\n    switch(deviceType) {\n        case 'Innotas Modularis':\n            return true;\n        case 'Fludia FM432g':\n            return true;\n        case 'Fludia FM432e':\n            return true;        \n        case 'Milesight EM310-UDL':\n            return true;\n        case 'Milesight WS301':\n            return true;\n        case 'Milesight EM300-DI':\n            return true;\n        case 'Milesight EM300-TH':\n            return true;\n        case 'Milesight EM300-ZLD':\n            return true;\n        case 'Enginko LW06485_EV':\n            return false;\n        case 'Dragino CPL01':\n            return true;\n        case 'Elsys ERS Lite':\n            return true;\n        case 'Elsys ERS CO2 Lite':\n            return true;\n        case 'Milesight WS522':\n            return false;\n        case 'MUC':\n            return false;\n        case 'MUC KWZ':\n            return false;\n        case 'MUC KMZ':\n            return false;\n        case 'MUC WMZ':\n            return false;\n        case 'MUC ELZ':\n            return false;\n        case 'MUC GZ':\n            return false;\n        case 'MUC Device':\n            return true;\n        case 'Door Sensor':\n            return true;\n        case 'Motion Sensor':\n            return true;\n        case 'Occupancy Sensor':\n            return true;\n        default:\n            return false;\n    }\n}   \n",
            "markdownTextFunction": {
              "body": "const d = data?.[0] || {};\nconst s = data?.[1] || {};\n\nlet label = d.Label ?? 'N/A';\nlet type = d.Type ?? 'N/A';\nlet entityName = d.entityName ?? 'N/A';\nlet displayName = d.displayName ?? 'N/A';\nlet active = d.active ?? 'N/A';\nlet service = d.service ?? d.Service ?? 'N/A';\nlet state = d.state ?? d.State ?? 'N/A';\nlet batteryLevel = d.battery ?? 'N/A';\nlet rssi = d.rssi ?? 'N/A';\nlet snr = d.snr ?? 'N/A';\nlet linkMargin = d.status_margin ?? 'N/A';\nlet meterType = d.meterType ?? 'N/A';\nlet vpnIp = d.vpnIp ?? 'N/A';\nlet lastActivityTime = d.lastActivityTime ?? 'N/A';\n\nconst _dn = String(displayName ?? '').trim();\nconst _hasDisplayName = _dn && _dn !== 'N/A';\nconst _titleText = _hasDisplayName ? displayName :\n    entityName;\nconst _subtitleText = _hasDisplayName ? entityName : '';\n\nlet simIp = s.simIp ?? s.sim_ip ?? 'N/A';\nlet simStatus = s.simStatus ?? 'N/A';\n\nconst _simStatusObj = (() => {\n    try {\n        return s.sim_status ? JSON.parse(s\n            .sim_status) : null;\n    } catch {\n        return null;\n    }\n})();\nconst simStatusIdRaw = _simStatusObj?.id ?? simStatus;\nconst simStatusId = Number(simStatusIdRaw);\nconst simCarrierLabel = (() => {\n    try {\n        return s.sim_provider ? (JSON.parse(s\n                .sim_provider).label ?? 'N/A') :\n            'N/A';\n    } catch {\n        return 'N/A';\n    }\n})();\n\nconst simIsTechPlus = simCarrierLabel === 'tech+';\nconst simOnline = simIp && simIp !== 'N/A';\n\nconst displaySim = (() => {\n    try {\n        const sim = d.sim ? JSON.parse(d.sim) :\n        null;\n        const iccid = sim?.iccid;\n        if (iccid == null) return false;\n        const str = String(iccid).trim()\n            .toLowerCase();\n        return str && str !== 'n/a' && str !==\n            'null' && str !== 'undefined';\n    } catch {\n        return false;\n    }\n})();\n\n// primary: #3498db\n// secondary: #4caf50\nconst getCss = (name, fallback) =>\n    getComputedStyle(document.documentElement)\n    .getPropertyValue(name)?.trim() || fallback;\n\nconst colorPrimary = getCss('--tb-primary-500', '#0094d0');\nconst colorSecondary = getCss('--tb-accent-500', '#4caf50');\nconst colorMuted = getCss('--tb-accent-200', '#a5d6a7');\nconst colorError = 'red';\nconst colorGrey = 'gray';\n\nlet simStatusColor = simStatusId === 2 ?\n    (simOnline ? colorSecondary : colorGrey) :\n    (simStatusId == 5 ? colorError : colorPrimary);\n\nconst displayBatteryLevel = !!batteryLevel &&\n    batteryLevel !== 'N/A';\nconst displayRssiLevel = !!rssi && rssi !== 'N/A';\nconst displaySnrLevel = !!snr && snr !== 'N/A';\nconst showWebBtn = meterType === 'Gateway' && vpnIp &&\n    vpnIp !== 'N/A';\n\nconst icon = utils.getDeviceIcon(type);\nconst stateHtml = utils.getStateHtml(state, service);\nconst batteryLevelHtml = utils.getBatteryLevelHtml(\n    batteryLevel);\nconst rssiLevelHtml = utils.getRssiHtml(rssi);\nconst snrLevelHtml = utils.getSnrHtml(snr);\n/*const activeHtml = utils.getActivity(active);*/\n\nconst isActive = active === 'true';\nconst color = isActive ? '#27AE60' : '#FF0000';\nconst bgColor = isActive ? 'rgba(39, 174, 96, 0.1)' : 'rgba(255, 0, 0, 0.1)';\n\nconst activeHtml =\n  '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n  color +\n  ';background-color:' +\n  bgColor +\n  '\">' +\n  lastActivityTime +\n  '</div>';\n\n// --- metric card helpers (same look as inspo) ---\nconst metricLabelStyle =\n  'font-size:14px; font-weight:700; color:#334155; letter-spacing:.01em;';\nconst metricValueWrap = 'display:inline-block; transform:scale(.90); transform-origin:left top;';\nconst metricValueRow = [\n  'display:flex',\n  'align-items:center',\n  'white-space:nowrap',\n  'overflow:hidden',\n  'text-overflow:ellipsis'\n].join(';') + ';';\n\n// If you need the clickable variant, pass { id, dataValue, tooltip }\n// Otherwise it renders a plain <div> card (non-clickable)\nfunction metricCard(label, valueHtml, opts = {}) {\n  const base =\n    'metric-card'; // class gives the same border/hover/rounded behavior\n  const isButton = !!(opts.id || opts.dataValue);\n  const attrId = opts.id ? ` id=\"${opts.id}\"` : '';\n  const attrData = opts.dataValue ? ` data-value=\"${opts.dataValue}\" (click)=\"ctx.actionsApi.elementClick($event)\"` : '';\n  const tt = opts.tooltip ? ` matTooltip=\"${opts.tooltip}\" matTooltipPosition=\"below\"` : '';\n\n  const inner =\n    `<div class=\"metric-label\" style=\"${metricLabelStyle}\">${label}</div>` +\n    `<div style=\"${metricValueRow}\"><div style=\"${metricValueWrap}\">${valueHtml}</div></div>`;\n\n  if (isButton) {\n    return `<button type=\"button\"${attrId}${attrData}${tt} class=\"${base} metric-card--button\" aria-label=\"${label}\">${inner}</button>`;\n  }\n  return `<div class=\"${base}\">${inner}</div>`;\n}\n\n\nlet header =\n  '<div class=\"header\" role=\"group\">' +\n\n    // INFO (title / subtitle / last activity)\n    '<div class=\"header__info\">' +\n      '<div class=\"title\" title=\"' + _titleText + '\">' +\n          '<span class=\"title-text\">' + _titleText + '</span>' +\n          '<span class=\"material-icons title-icon\">' + icon + '</span>' +\n        '</div>' +\n      (_subtitleText\n        ? '<div class=\"subtitle\" title=\"' + _subtitleText + '\">' + _subtitleText + '</div>'\n        : '') +\n      /*(lastActivityTime\n        ? '<div class=\"last-activity\" title=\"' + lastActivityTime + '\">' +\n            '<span class=\"material-icons clock\">schedule</span>' + lastActivityTime +\n          '</div>'\n        : '') +*/\n    '</div>' +\n\n    // 3) actions (service + buttons), hugging top & right\n    '<div class=\"header__actions\">' +\n\n      /*'<button id=\"detailed-data-dashboard\" ' +\n          'mat-flat-button color=\"primary\" class=\"icon-btn\"' +\n          'matTooltip=\"Data Dashboard\" ' +\n          'matTooltipPosition=\"below\">' +\n            '<mat-icon class=\"tb-mat-18 mr-1\">insert_chart</mat-icon>' +\n            //'<span>Data Dashboard</span>' +\n        '</button>' +*/\n\n\n\n\n\n      '<button id=\"device-management\" mat-flat-button color=\"accent\" class=\"icon-btn\" ' +\n        'matTooltip=\"Open Device\" matTooltipPosition=\"below\">' +\n        '<mat-icon>devices_other</mat-icon>' +\n      '</button>' +\n\n    (showWebBtn ?\n        '<a mat-flat-button color=\"primary\" class=\"icon-btn\" ' +\n        'href=\"http://' + vpnIp +\n        '\" target=\"_blank\" rel=\"noopener\" ' +\n        'matTooltip=\"Webserver\" matTooltipPosition=\"below\">' +\n        '<mat-icon>language</mat-icon>' +\n        '</a>' : '') +\n\n    (displaySim ?\n        ('<button id=\"sim-menu\" data-action=\"sim-menu\" type=\"button\" ' +\n            'mat-flat-button class=\"icon-btn\" ' +\n            'style=\"background-color:' + simStatusColor +\n            ';color:#fff\" ' +\n            'matTooltip=\"Open SIM Menu\" matTooltipPosition=\"below\">' +\n            '<mat-icon>sim_card</mat-icon>' +\n            '</button>') :\n        '') +\n    '<div class=\"service-item\" matTooltip=\"Service\">' +\n        '<tb-dashboard-state style=\"width:100px;border-radius:8px;overflow:hidden;\" ' +\n        '[ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Service Attribute\">' +\n        '</tb-dashboard-state>' +\n      '</div>' +\n    '</div>' +\n    '</div>';\n\nconst paramsRow =\n  '<div class=\"metric-row\">' +\n    metricCard('State',    stateHtml) +\n    metricCard('Activity', activeHtml) +\n    (displayBatteryLevel ? metricCard('Battery', batteryLevelHtml, { id: 'battery-level', dataValue: 'battery-level', tooltip: 'Battery Level History' }) : '') +\n    (displayRssiLevel   ? metricCard('RSSI',    rssiLevelHtml,    { id: 'rssi-widget',    dataValue: 'rssi-widget',    tooltip: 'RSSI Details' }) : '') +\n    (displaySnrLevel    ? metricCard('SNR',     snrLevelHtml,     { id: 'snr-widget',     dataValue: 'snr-widget',     tooltip: 'SNR Details' }) : '') +\n  '</div>';\n\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">' +\n  header +\n  paramsRow +         //  replaces the old .params grid\n  '<div>';\n",
              "modules": {
                "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* HEADER (scoped) */\r\n.main-layout .header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  gap: 8px;\r\n\r\n  padding: 4px 8px 0 8px;   /* no bottom padding */\r\n  margin: 0 0 8px 0;       /*  negative bottom margin = less gap */\r\n  box-sizing: border-box;\r\n  background-color: #FAFAFA;\r\n}\r\n\r\n/* ICON SECTION */\r\n.main-layout .header__icon {\r\n  display: flex;\r\n  align-items: flex-start; /* hug top */\r\n  justify-content: center;\r\n  padding: 0;\r\n  margin: 0;\r\n}\r\n.main-layout .header .title-icon {\r\n  width: 40px;\r\n  height: 40px;\r\n  margin: 0;\r\n}\r\n\r\n/* INFO SECTION (title, subtitle, last activity) */\r\n.main-layout .header__info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: flex-start;\r\n  align-items: flex-start;\r\n  gap: 0; /* remove flex gap */\r\n}\r\n\r\n.main-layout .header__info .title {\r\n  display: inline-flex;      /* sit inline; no stretching */\r\n  align-items: flex-start;\r\n  gap: 8px;                  /* space between text and icon */\r\n  max-width: 100%;\r\n  margin: 0;\r\n  padding: 0;\r\n  font-size: 18px;\r\n  font-weight: 500;\r\n  color: #28232D;\r\n  line-height: 1.2;\r\n}\r\n.main-layout .header__info .title .title-text {\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;       /* text hugs left and ellipsizes */\r\n}\r\n.main-layout .header__info .title .title-icon {\r\n  flex: 0 0 auto;            /* dont shrink */\r\n  font-size: 18px;           /* tweak if you want smaller/larger */\r\n  opacity: .9;\r\n  vertical-align: middle;\r\n}\r\n\r\n.main-layout .header__info .subtitle,\r\n.main-layout .header__info .last-activity {\r\n  font-size: 13px;\r\n  font-weight: normal;\r\n  color: #757575;\r\n  margin: 0;\r\n  padding: 0;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  line-height: 1.2;\r\n}\r\n.main-layout .header__info .last-activity {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n}\r\n\r\n.main-layout .header__info .subtitle {\r\n  margin-top: -14px;\r\n  line-height: 1;\r\n}\r\n.main-layout .header__info .clock {\r\n  font-size: 14px;\r\n  width: 14px;\r\n  height: 14px;\r\n  line-height: 14px;\r\n  opacity: 0.8;\r\n}\r\n\r\n/* ACTIONS SECTION (Service + Buttons) */\r\n.main-layout .header__actions {\r\n  display: flex;\r\n  align-items: flex-start;   /* hug upper edge */\r\n  justify-content: flex-end; /* hug right edge */\r\n  gap: 8px;                  /* spacing between items */\r\n  padding: 0;\r\n  margin: 0;\r\n}\r\n.main-layout .header__actions > * {\r\n  margin: 0;\r\n}\r\n\r\n.main-layout .header__actions > .header-btn {\r\n  padding: 0 18px;          /* same as inspo */\r\n  height: 40px;\r\n}\r\n\r\n.main-layout .header__actions .service-item {\r\n  display: inline-flex;\r\n  align-items: flex-start;\r\n  height: 40px;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n.main-layout .header__actions .service-item tb-dashboard-state {\r\n  height: 40px;\r\n  display: block;\r\n}\r\n\r\n/* BUTTONS (device, web, sim) */\r\n.icon-btn {\r\n  width: 40px;\r\n  height: 40px;\r\n  min-width: 40px;\r\n  max-width: 40px;\r\n  min-height: 40px;\r\n  max-height: 40px;\r\n  flex: 0 0 40px;\r\n  border-radius: 999px;\r\n  padding: 0;\r\n  margin: 0;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-decoration: none;\r\n  line-height: 1;\r\n  box-sizing: border-box;\r\n}\r\n.icon-btn .mat-icon {\r\n  color: #fff;\r\n  margin: 0;\r\n  font-size: 20px;\r\n  width: 20px;\r\n  height: 20px;\r\n}\r\n\r\n/* ROW HOLDING THE METRIC CARDS\r\n    spacing tightened to header */\r\n.main-layout .metric-row {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  align-items: stretch;\r\n  justify-content: flex-start;\r\n  gap: 4px;\r\n  width: 100%;\r\n  padding: 0 4px 8px;       /* no top padding */\r\n  box-sizing: border-box;\r\n  margin-top: 0;            /* dont push it down */\r\n}\r\n\r\n/* METRIC CARDS */\r\n.metric-card,\r\n.metric-card--button {\r\n  flex: 1 1 auto;\r\n  display: grid;\r\n  grid-template-rows: auto 1fr;\r\n  align-items: center;\r\n  row-gap: 6px;\r\n  padding: 8px 10px;\r\n  border: 1px solid #e5e7eb;\r\n  border-radius: 15px;\r\n  max-width: calc(50% - 2px);\r\n  box-sizing: border-box;\r\n  height: 72px;\r\n  text-align: left;\r\n  transition: background .15s ease, border-color .15s ease, box-shadow .15s ease;\r\n  background: #FAFAFA;\r\n}\r\n\r\n.metric-card--button {\r\n  appearance: none;\r\n  -webkit-appearance: none;\r\n  border: 1px solid #e5e7eb;\r\n  background-clip: padding-box;\r\n  box-shadow: none;\r\n  cursor: pointer;\r\n}\r\n\r\n/* hover & focus states stay the same */\r\n.metric-card--button:hover,\r\n.metric-card--button:focus {\r\n  background: #f0f0f0;\r\n  border-color: #d1d5db;\r\n}\r\n.metric-card--button:focus-visible {\r\n  outline: none;\r\n  box-shadow: 0 0 0 3px rgba(2, 132, 199, .25);\r\n}\r\n\r\n.metric-card .metric-label {\r\n  font-size: 14px;\r\n  font-weight: 700;\r\n  color: #334155;\r\n  letter-spacing: .01em;\r\n}\r\n\r\n/* ICONS AND GENERAL TWEAKS */\r\n.sim-tooltip { white-space: pre-line; }\r\n.header .flex-1 { min-width: 0; }\r\n.header .title, .header .subtitle {\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n.tb-markdown-view .params { display: none !important; }\r\n\r\n/* LEGACY COMPAT FIXES  maintain alignment */\r\n.main-layout .header > .flex:first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n/* WIDE ICON BUTTON VARIANT */\r\n.icon-btn--wide {\r\n  width: auto !important;\r\n  min-width: 110px;\r\n  padding: 0 12px !important;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;\r\n  border-radius: 999px;\r\n}\r\n\r\n/* fix mat-icon alignment inside wide buttons */\r\n.icon-btn--wide .mat-icon {\r\n  font-size: 18px !important;\r\n  width: 18px !important;\r\n  height: 18px !important;\r\n  margin: 0 4px 0 0;\r\n  vertical-align: middle;\r\n}\r\n\r\n/* style text next to icon */\r\n.icon-btn--wide span {\r\n  color: #fff;\r\n  font-weight: 500;\r\n  font-size: 14px;\r\n  line-height: 1;\r\n  white-space: nowrap;\r\n}\r\n\r\n/* RED BUTTON + PILL BUTTON STYLE */\r\n.red-btn { background-color: #ED2939; }\r\n.red-btn:hover { background-color: #d32f2f; }\r\n\r\n/* keep icon size/color like inspo */\r\n.header-btn mat-icon {\r\n  font-size: 18px;\r\n  color: #fff;\r\n}\r\n\r\n/* Base inspo button (pill) */\r\n.main-layout .header__actions .header-btn {\r\n  padding: 0 18px;\r\n  height: 40px;\r\n  border: none;\r\n  border-radius: 9999px;      /* <- pill shape */\r\n  box-sizing: border-box;\r\n\r\n  display: inline-flex;       /* proper vertical centering */\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;\r\n\r\n  font-family: 'Roboto', sans-serif;\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  color: #fff;\r\n  cursor: pointer;\r\n  white-space: nowrap;\r\n  transition: background-color 0.3s ease;\r\n}\r\n\r\n/* red variant (like inspo, just red) */\r\n.main-layout .header__actions .red-btn:hover {\r\n  background-color: #d32f2f;\r\n}\r\n\r\n/* metric card flex behaviour */\r\n.metric-row > .metric-card,\r\n.metric-row > .metric-card--button {\r\n  flex: 1 1 0;          /* equal width for all cards */\r\n  min-width: 0;         /* allows shrinking properly */\r\n  box-sizing: border-box;\r\n}\r\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "device-settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#device-settings', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = widgetContext.stateController.getStateParams();\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\n// widgetContext.actionsApi.openDashboardStateInSeparateDialog(stateId, params, entityName, false, '1280', '1024');\n// widgetContext.stateController.openState(stateId, params);\n// widgetContext.actionsApi.handleWidgetAction($event, stateId, params);\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '600px', '800px');\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            return 'wassergeraete_volumess_wmz_settings';\n        case 'Elsys ERS Lite':            \n            return 'elsys_ers_lite_settings';\n        case 'Elsys ERS CO2 Lite':            \n            return 'elsys_ers_co2_lite_settings';                      \n        case 'Dragino CPL01':\n            return 'dragino_cpl01_settings';\n        case 'Innotas Modularis':            \n            return 'innotas_modularis_settings';\n        case 'Fludia FM432g':            \n            return 'fludia_fm432g_settings';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl_settings';\n        case 'Milesight WS301':            \n            return 'milesight_ws301_settings';\n        case 'Milesight EM300-DI':            \n            return 'milesight_em300_di_settings';                      \n        case 'Milesight EM300-TH':\n            return 'milesight_em300_th_settings';\n        case 'Milesight EM300-ZLD':            \n            return 'milesight_em300_zld_settings';\n        case 'Milesight AM300':            \n            return 'milesight_am300_settings';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl_settings';\n        case 'MUC':            \n            return 'muc_settings';                      \n        case 'MUC KWZ':\n            return 'muc_kwz_settings';\n        case 'MUC KMZ':            \n            return 'muc_kmz_settings';\n        case 'MUC WMZ':            \n            return 'muc_wmz_settings';                      \n        case 'MUC ELZ':\n            return 'muc_elz_settings';\n        case 'MUC GZ':\n            return 'muc_gz_settings';\n        case 'Beckhoff RT':\n            return 'beckhoff_rt_settings';\n        case 'Beckhoff EV':\n            return 'beckhoff_ev_settings';\n        case 'Beckhoff ELZ':\n            return 'beckhoff_ev_settings';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_full';\n        default:\n            return 'unknown_settings';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2ad18dd5-c734-2c7a-44c8-c903d49c2a60"
              },
              {
                "name": "device-dashboard",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#device-dashboard', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = widgetContext.stateController.getStateParams();\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\n// widgetContext.actionsApi.openDashboardStateInSeparateDialog(stateId, params, entityName, false, '1280', '1024');\nwidgetContext.stateController.openState(stateId, params);\n// widgetContext.actionsApi.handleWidgetAction($event, stateId, params);\n// widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px');\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            return 'wassergeraete_volumess_wmz'; \n        case 'Sontex Supercal 739':\n            return 'sontex_supercal_739';\n        case 'Elsys ERS Lite':            \n            return 'elsys_ers_lite';\n        case 'Elsys ERS CO2 Lite':            \n            return 'elsys_ersco2_lite';                      \n        case 'Dragino CPL01':\n            return 'dragino_cpl01';\n        case 'Innotas Modularis':            \n            return 'innotas_modularis';\n        case 'Fludia FM432g':            \n            return 'fludia_fm432g';  \n        case 'MClimate Multipurpose Button':            \n            return 'mclimate_multipurpose_button';   \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'Milesight WS301':            \n            return 'milesight_ws301';\n        case 'Milesight EM300-DI':            \n            return 'milesight_em300_di';                      \n        case 'Milesight EM300-TH':\n            return 'milesight_em300_th';\n        case 'Milesight EM300-ZLD':            \n            return 'milesight_em300_zld';\n        case 'Milesight AM300':            \n            return 'milesight_am300';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'MUC':            \n            return 'muc';                      \n        case 'MUC KWZ':\n            return 'muc_kwz';\n        case 'MUC KMZ':            \n            return 'muc_kmz';\n        case 'MUC WMZ':            \n            return 'muc_wmz';                      \n        case 'MUC ELZ':\n            return 'muc_elz';\n        case 'MUC GZ':\n            return 'muc_gz';\n        case 'Acrios KWZ':\n            return 'acrios_kwz';\n        case 'Acrios KMZ':            \n            return 'acrios_kmz';\n        case 'Acrios WMZ':            \n            return 'acrios_wmz';                      \n        case 'Acrios ELZ':\n            return 'acrios_elz';\n        case 'Acrios GZ':\n            return 'acrios_gz';    \n        case 'Enginko LW06485_EV':\n            return 'enginko_lw06485_ev';\n        case 'Beckhoff RT':\n            return 'beckhoff_rt';\n        case 'Beckhoff EV':\n            return 'beckhoff_ev';\n        case 'Beckhoff ELZ':\n            return 'beckhoff_elz';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Eastron SDM230':\n            return 'eastron_sdm230';\n        case 'Eastron SDM630':\n            return 'eastron_sdm630';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_full';\n        case 'Zenner Zelsius C5 ISF':\n            return 'zenner_zelsius_C5_isf'; \n        case 'Zenner Minomess A':\n            return 'minomess';\n        case 'Huawei Fusion Solar':\n            return 'pv';\n        case 'Fronius Fusion Solar':\n            return 'pv';\n        default:\n            return 'unknown_type';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "12591466-cb13-8a32-ea68-0fe8f6ae1a1c"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Battery Level Chart",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2189eb1f-7e2b-dfd4-252f-0ae6cdc82a6c"
              },
              {
                "name": "datapoints-config",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" class=\"add-entity-form\" style=\"width: 350px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Device Configuration</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <mat-tab-group>\r\n    <mat-tab label=\"Datapoint Config\">\r\n      <div mat-dialog-content fxLayout=\"column\">\r\n        <form [formGroup]=\"changeDatapointConfigFormGroup\" (ngSubmit)=\"saveDatapointConfig()\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n            <mat-form-field fxFlex class=\"mat-block\">\r\n              <mat-label>Datapoint</mat-label>\r\n              <mat-select formControlName=\"datapoint\" (selectionChange)=\"onDatapointChange($event.value)\">\r\n                <mat-option *ngFor=\"let attribute of cfgAttributes\" [value]=\"attribute.key\">{{ attribute.key }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('datapoint').hasError('required')\">Datapoint is required</mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n\r\n          <div *ngIf=\"selectedAttribute\">\r\n            <!-- Datapoint Config Fields -->\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('unit').hasError('required')\">Unit is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Archive</mat-label>\r\n             <mat-select formControlName=\"archive\">\r\n                <mat-option [value]=11>11-SmartMeterUni</mat-option>\r\n                <mat-option [value]=21>21-SmartMeasureUni</mat-option>\r\n                <mat-option [value]=31>31-SmartSensorUni</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('archive').hasError('required')\">Archive is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Aggregation</mat-label>\r\n              <mat-select formControlName=\"aggregation\">\r\n                <mat-option [value]=0>0-Sum</mat-option>\r\n                <mat-option [value]=1>1-Average</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('aggregation').hasError('required')\">Aggregation is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Display Name</mat-label>\r\n              <input matInput formControlName=\"displayName\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('displayName').hasError('required')\">Display Name is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Scale</mat-label>\r\n              <input matInput formControlName=\"scale\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('scale').hasError('required')\">Scale is required</mat-error>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('scale').hasError('pattern')\">Invalid scale format</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Decimal Points</mat-label>\r\n              <input matInput formControlName=\"decimalPoints\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('decimalPoints').hasError('required')\">Decimal Points are required</mat-error>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('decimalPoints').hasError('pattern')\">Decimal Points must be between 0 and 5</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Active</mat-label>\r\n              <mat-select formControlName=\"active\">\r\n                <mat-option [value]=\"true\">Yes</mat-option>\r\n                <mat-option [value]=\"false\">No</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('active').hasError('required')\">Active status is required</mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n\r\n          <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n            <button mat-button color=\"primary\" type=\"button\" [disabled]=\"isLoading$ | async\" (click)=\"cancel()\" cdkFocusInitial>Cancel</button>\r\n            <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || changeDatapointConfigFormGroup.invalid || !changeDatapointConfigFormGroup.dirty\">Save Config</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </mat-tab>\r\n    <mat-tab label=\"Alarm Config\">\r\n  <div mat-dialog-content fxLayout=\"column\" style=\"width: 350px;\">\r\n    <form [formGroup]=\"changeAlarmConfigFormGroup\" (ngSubmit)=\"saveAlarmConfig()\">\r\n      <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n        <mat-form-field fxFlex class=\"mat-block\">\r\n          <mat-label>Alarm Type</mat-label>\r\n          <mat-select formControlName=\"alarmType\" (selectionChange)=\"onAlarmTypeChange($event.value)\">\r\n            <mat-option *ngFor=\"let alarm of alarms\" [value]=\"alarm.alarmType\">\r\n              {{ alarm.alarmType }} ({{ alarmStatus[alarm.alarmType]?.active ? 'active' : 'inactive' }})\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"changeAlarmConfigFormGroup.get('alarmType').hasError('required')\">Alarm Type is required</mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <!-- Create Rules -->\r\n      <div *ngFor=\"let rule of createRuleFields\">\r\n        <div class=\"severity-text\">{{ rule.name }} Alarm</div>\r\n        <div *ngFor=\"let condition of rule.conditions\">\r\n          <mat-form-field fxFlex class=\"mat-block\">\r\n            <mat-label>{{ condition.label }}</mat-label>\r\n            <input matInput [formControl]=\"condition.control\">\r\n            <span *ngIf=\"condition.duration\" class=\"duration-unit\">{{ condition.duration.unit }}</span>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Clear Rule -->\r\n      <div *ngIf=\"clearRuleFields.length > 0\">\r\n        <div class=\"severity-text\">Clear Rule</div>\r\n        <div *ngFor=\"let condition of clearRuleFields\">\r\n          <mat-form-field fxFlex class=\"mat-block\">\r\n            <mat-label>{{ condition.label }}</mat-label>\r\n            <input matInput [formControl]=\"condition.control\">\r\n            <span *ngIf=\"condition.duration\" class=\"duration-unit\">{{ condition.duration.unit }}</span>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"isLoading$ | async\" (click)=\"cancel()\" cdkFocusInitial>Cancel</button>\r\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || changeAlarmConfigFormGroup.invalid || !changeAlarmConfigFormGroup.dirty\">Save Config</button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</mat-tab>\r\n  </mat-tab-group>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet deviceProfileService = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\r\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\r\nlet cfgAttributes = [];\r\nlet deviceProfileId;\r\nlet alarms = [];\r\nlet attributesList = [];\r\nlet alarmStatus = {};\r\n\r\nattributeService.getEntityAttributes({ entityType: 'DEVICE', id: deviceID }, 'SERVER_SCOPE').subscribe(attributes => {\r\n    attributesList = attributes;\r\n\r\n    deviceService.getDevice(deviceID).subscribe((deviceInfo) => {\r\n        deviceProfileId = deviceInfo.deviceProfileId.id;\r\n        deviceProfileService.getDeviceProfile(deviceProfileId).subscribe((response) => {\r\n            alarms = response.profileData.alarms;\r\n\r\n           \r\n\r\n            // Function to extract source attributes from a condition\r\n            function getSourceAttributesFromCondition(condition) {\r\n                let sourceAttributes = [];\r\n                if (condition.condition && Array.isArray(condition.condition)) {\r\n                    condition.condition.forEach(cond => {\r\n                        if (cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue) {\r\n                            sourceAttributes.push(cond.predicate.value.dynamicValue.sourceAttribute);\r\n                        }\r\n                    });\r\n                }\r\n                if (condition.spec && condition.spec.predicate && condition.spec.predicate.dynamicValue) {\r\n                    sourceAttributes.push(condition.spec.predicate.dynamicValue.sourceAttribute);\r\n                }\r\n                return sourceAttributes;\r\n            }\r\n\r\n            // Loop through each alarm to check for sourceAttributes\r\n            alarms.forEach(alarm => {\r\n                let sourceAttributes = [];\r\n\r\n                // Initialize alarmType status\r\n                if (!alarmStatus[alarm.alarmType]) {\r\n                    alarmStatus[alarm.alarmType] = { active: true };\r\n                }\r\n\r\n                // Check createRules\r\n                Object.keys(alarm.createRules).forEach(ruleKey => {\r\n                    const rule = alarm.createRules[ruleKey];\r\n                    if (rule.condition) {\r\n                        sourceAttributes = sourceAttributes.concat(getSourceAttributesFromCondition(rule.condition));\r\n                    }\r\n                });\r\n\r\n                // Check clearRule\r\n                if (alarm.clearRule && alarm.clearRule.condition) {\r\n                    sourceAttributes = sourceAttributes.concat(getSourceAttributesFromCondition(alarm.clearRule.condition));\r\n                }\r\n\r\n                // Check if each sourceAttribute is in attributesList\r\n                sourceAttributes.forEach(sourceAttribute => {\r\n                    const attributeExists = attributesList.some(attribute => attribute.key === sourceAttribute);\r\n                    if (!attributeExists) {\r\n                        console.warn(`Source attribute ${sourceAttribute} for alarm ${alarm.alarmType} not found in attributes list.`);\r\n                        // Set the active flag to false if any source attribute is missing\r\n                        alarmStatus[alarm.alarmType].active = false;\r\n                    }\r\n                });\r\n            });\r\n\r\n            //widgetContext.dialogs.alert(JSON.stringify(alarmStatus));\r\n\r\n            attributeService.getEntityAttributes({ entityType: 'DEVICE', id: deviceID }, 'SERVER_SCOPE').subscribe(attributes => {\r\n                cfgAttributes = attributes.filter(attribute => attribute.key.startsWith('cfg_') && attribute.key !== 'cfg_activeDatapoints');\r\n                openChangeConfigForm();\r\n            });\r\n        });\r\n    });\r\n});\r\n\r\n\r\nfunction openChangeConfigForm() {\r\n    customDialog.customDialog(htmlTemplate, changeConfigForm).subscribe();\r\n}\r\n\r\nfunction changeConfigForm(instance) {\r\n    let vm = instance;\r\n    vm.cfgAttributes = cfgAttributes;\r\n    vm.alarms = alarms;\r\n    vm.selectedAttribute = null;\r\n    vm.createRuleFields = [];\r\n    vm.clearRuleFields = [];\r\n    vm.alarmStatus = alarmStatus;  // Pass the alarmStatus to the instance\r\n    // Initialize the form group with default values from attributesList\r\n    vm.changeDatapointConfigFormGroup = vm.fb.group({\r\n        datapoint: ['', [vm.validators.required]],\r\n        unit: ['', [vm.validators.required]],\r\n        archive: ['', [vm.validators.required]],\r\n        aggregation: [0, [vm.validators.required]], // Initialize with default value\r\n        displayName: ['', [vm.validators.required]],\r\n        scale: ['', [vm.validators.required, vm.validators.pattern('^[0-9]+(\\\\.[0-9]+)?$')]],\r\n        decimalPoints: ['', [vm.validators.required, vm.validators.pattern('[0-5]'), vm.validators.maxLength(1)]],\r\n        active: ['', [vm.validators.required]]\r\n    });\r\n\r\n    vm.changeAlarmConfigFormGroup = vm.fb.group({\r\n        alarmType: ['', [vm.validators.required]]\r\n    });\r\n\r\n    vm.changeAlarmConfigFormGroup.valueChanges.subscribe(change => {\r\n        console.log('changeAlarmConfigFormGroup changed:', change);\r\n    });\r\n\r\n    vm.onDatapointChange = function (selectedKey) {\r\n        let selected = vm.cfgAttributes.find(attr => attr.key === selectedKey);\r\n        vm.selectedAttribute = selected ? selected.value : null;\r\n        if (selected) {\r\n            vm.changeDatapointConfigFormGroup.patchValue({\r\n                unit: selected.value.unit || '',\r\n                archive: selected.value.archive || '',\r\n                aggregation: selected.value.aggregation !== undefined ? selected.value.aggregation : 0, // Handle undefined case\r\n                displayName: selected.value.displayName || '',\r\n                scale: selected.value.scale || '',\r\n                decimalPoints: selected.value.decimalPoints || '',\r\n                active: selected.value.active !== undefined ? selected.value.active : ''\r\n            });\r\n        } else {\r\n            vm.changeDatapointConfigFormGroup.patchValue({\r\n                unit: '',\r\n                archive: '',\r\n                aggregation: 0, // Default value\r\n                displayName: '',\r\n                scale: '',\r\n                decimalPoints: '',\r\n                active: ''\r\n            });\r\n        }\r\n    };\r\n\r\n    vm.onAlarmTypeChange = function (selectedType) {\r\n        let selectedAlarm = vm.alarms.find(alarm => alarm.alarmType === selectedType);\r\n\r\n        // Clear previous controls from form group\r\n        Object.keys(vm.changeAlarmConfigFormGroup.controls).forEach(control => {\r\n            if (control !== 'alarmType') {\r\n                vm.changeAlarmConfigFormGroup.removeControl(control);\r\n            }\r\n        });\r\n\r\n        if (selectedAlarm) {\r\n            vm.createRuleFields = [];\r\n            vm.clearRuleFields = [];\r\n\r\n            let addedControls = new Set();\r\n\r\n            // Process createRules\r\n            Object.keys(selectedAlarm.createRules).forEach(ruleName => {\r\n                let rule = selectedAlarm.createRules[ruleName];\r\n                let conditions = [];\r\n\r\n                rule.condition.condition.forEach(cond => {\r\n                    if (cond.key && cond.key.key) {\r\n                        let sourceAttribute = cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue && cond.predicate.value.dynamicValue.sourceAttribute;\r\n                        if (sourceAttribute) {\r\n                            let defaultValue = attributesList.find(attr => attr.key === sourceAttribute)?.value || '';\r\n                            if (!addedControls.has(sourceAttribute)) {\r\n                                let formControl = vm.fb.control(defaultValue, vm.validators.required);\r\n                                conditions.push({\r\n                                    label: sourceAttribute,\r\n                                    control: formControl\r\n                                });\r\n                                vm.changeAlarmConfigFormGroup.addControl(sourceAttribute, formControl);\r\n                                addedControls.add(sourceAttribute);\r\n                                formControl.valueChanges.subscribe(change => {\r\n                                    console.log(`Form control ${sourceAttribute} changed:`, change);\r\n                                    vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                                });\r\n                            }\r\n                        } else if (cond.predicate.value && cond.predicate.value.defaultValue) {\r\n                            let defaultValue = cond.predicate.value.defaultValue;\r\n                            conditions.push({\r\n                                label: cond.key.key,\r\n                                control: vm.fb.control({ value: defaultValue, disabled: true })\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (rule.condition.spec && rule.condition.spec.type === \"DURATION\") {\r\n                    let durationPredicate = rule.condition.spec.predicate;\r\n                    let durationSourceAttribute = durationPredicate && durationPredicate.dynamicValue && durationPredicate.dynamicValue.sourceAttribute;\r\n                    let durationControlName = durationPredicate && durationPredicate.dynamicValue ? durationPredicate.dynamicValue.sourceAttribute : rule.condition.spec.defaultSourceAttribute;\r\n                    if (durationControlName) {\r\n                        let durationDefaultValue = attributesList.find(attr => attr.key === durationControlName)?.value || '';\r\n                        if (!addedControls.has(durationControlName)) {\r\n                            let durationControl = vm.fb.control(durationDefaultValue, vm.validators.required);\r\n                            conditions.push({\r\n                                label: durationControlName,\r\n                                control: durationControl,\r\n                                duration: {\r\n                                    control: durationControl,\r\n                                    unit: rule.condition.spec.unit || 'MINUTES'\r\n                                }\r\n                            });\r\n                            console.log(`Creating form control for duration: ${durationControlName}`);\r\n                            vm.changeAlarmConfigFormGroup.addControl(durationControlName, durationControl);\r\n                            addedControls.add(durationControlName);\r\n                            durationControl.valueChanges.subscribe(change => {\r\n                                console.log(`Duration control ${durationControlName} changed:`, change);\r\n                                vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                            });\r\n                        }\r\n                    } else if (rule.condition.spec.defaultSourceAttribute) {\r\n                        let durationDefaultValue = rule.condition.spec.defaultSourceAttribute;\r\n                        conditions.push({\r\n                            label: durationDefaultValue,\r\n                            control: vm.fb.control({ value: durationDefaultValue, disabled: true })\r\n                        });\r\n                    }\r\n                }\r\n                vm.createRuleFields.push({\r\n                    name: ruleName,\r\n                    conditions: conditions\r\n                });\r\n            });\r\n\r\n            // Process clearRule\r\n            let clearConditions = [];\r\n\r\n            selectedAlarm.clearRule.condition.condition.forEach(cond => {\r\n                if (cond.key && cond.key.key) {\r\n                    let sourceAttribute = cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue && cond.predicate.value.dynamicValue.sourceAttribute;\r\n                    if (sourceAttribute) {\r\n                        let clearDefaultValue = attributesList.find(attr => attr.key === sourceAttribute)?.value || '';\r\n                        if (!addedControls.has(sourceAttribute)) {\r\n                            let formControl = vm.fb.control(clearDefaultValue, vm.validators.required);\r\n                            clearConditions.push({\r\n                                label: sourceAttribute,\r\n                                control: formControl\r\n                            });\r\n                            console.log(`Creating form control for clearRule sourceAttribute: ${sourceAttribute}`);\r\n                            vm.changeAlarmConfigFormGroup.addControl(sourceAttribute, formControl);\r\n                            addedControls.add(sourceAttribute);\r\n                            formControl.valueChanges.subscribe(change => {\r\n                                console.log(`Form control ${sourceAttribute} changed:`, change);\r\n                                vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                            });\r\n                        }\r\n                    } else if (cond.predicate.value && cond.predicate.value.defaultValue) {\r\n                        let clearDefaultValue = cond.predicate.value.defaultValue;\r\n                        clearConditions.push({\r\n                            label: cond.key.key,\r\n                            control: vm.fb.control({ value: clearDefaultValue, disabled: true })\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (selectedAlarm.clearRule.condition.spec && selectedAlarm.clearRule.condition.spec.type === \"DURATION\") {\r\n                let durationPredicate = selectedAlarm.clearRule.condition.spec.predicate;\r\n                let durationSourceAttribute = durationPredicate && durationPredicate.dynamicValue && durationPredicate.dynamicValue.sourceAttribute;\r\n                let durationControlName = durationPredicate && durationPredicate.dynamicValue ? durationPredicate.dynamicValue.sourceAttribute : selectedAlarm.clearRule.condition.spec.defaultSourceAttribute;\r\n                if (durationControlName) {\r\n                    let clearDurationDefaultValue = attributesList.find(attr => attr.key === durationControlName)?.value || '';\r\n                    if (!addedControls.has(durationControlName)) {\r\n                        let durationControl = vm.fb.control(clearDurationDefaultValue, vm.validators.required);\r\n                        clearConditions.push({\r\n                            label: durationControlName,\r\n                            control: durationControl,\r\n                            duration: {\r\n                                control: durationControl,\r\n                                unit: selectedAlarm.clearRule.condition.spec.unit || 'MINUTES'\r\n                            }\r\n                        });\r\n                        console.log(`Creating form control for clearRule duration: ${durationControlName}`);\r\n                        vm.changeAlarmConfigFormGroup.addControl(durationControlName, durationControl);\r\n                        addedControls.add(durationControlName);\r\n                        durationControl.valueChanges.subscribe(change => {\r\n                            console.log(`ClearRule Duration control ${durationControlName} changed:`, change);\r\n                            vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                        });\r\n                    }\r\n                } else if (selectedAlarm.clearRule.condition.spec.defaultSourceAttribute) {\r\n                    let clearDurationDefaultValue = selectedAlarm.clearRule.condition.spec.defaultSourceAttribute;\r\n                    clearConditions.push({\r\n                        label: clearDurationDefaultValue,\r\n                        control: vm.fb.control({ value: clearDurationDefaultValue, disabled: true })\r\n                    });\r\n                }\r\n            }\r\n            vm.clearRuleFields = clearConditions;\r\n        } else {\r\n            vm.createRuleFields = [];\r\n            vm.clearRuleFields = [];\r\n            vm.changeAlarmConfigFormGroup.setControl('alarmSources', vm.fb.array([]));\r\n        }\r\n\r\n        // Subscribe to the valueChanges of the entire form to manage the Save button state\r\n        vm.changeAlarmConfigFormGroup.valueChanges.subscribe(() => {\r\n            vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid;\r\n        });\r\n\r\n        // Initialize saveButtonEnabled based on current form validity\r\n        vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid;\r\n    };\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.saveDatapointConfig = function () {\r\n        const formValues = vm.changeDatapointConfigFormGroup.value;\r\n        const attributeValue = {\r\n            unit: formValues.unit,\r\n            archive: formValues.archive,\r\n            aggregation: formValues.aggregation,\r\n            displayName: formValues.displayName,\r\n            scale: formValues.scale,\r\n            decimalPoints: formValues.decimalPoints,\r\n            active: formValues.active\r\n        };\r\n        attributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            [{\r\n                key: formValues.datapoint,\r\n                value: attributeValue\r\n            }]\r\n        ).subscribe(\r\n            () => {\r\n                console.log('Datapoint config saved successfully.');\r\n                vm.dialogRef.close(null);\r\n            },\r\n            error => {\r\n                console.error('Failed to save datapoint config:', error);\r\n            }\r\n        );\r\n    };\r\n\r\n    vm.saveAlarmConfig = function () {\r\n        const formValues = vm.changeAlarmConfigFormGroup.value;\r\n        let alarmConfigList = [];\r\n\r\n        // Process createRules\r\n        vm.createRuleFields.forEach(rule => {\r\n            rule.conditions.forEach(condition => {\r\n                if (condition.control) {\r\n                    let value = formValues[condition.label] || null;\r\n                    alarmConfigList.push({\r\n                        key: condition.label,\r\n                        value: value\r\n                    });\r\n\r\n                    if (condition.duration) {\r\n                        let durationValue = formValues[condition.duration.control.name] || null;\r\n                        alarmConfigList.push({\r\n                            key: condition.duration.control.name,\r\n                            value: durationValue\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        // Process clearRule\r\n        vm.clearRuleFields.forEach(condition => {\r\n            if (condition.control) {\r\n                let value = formValues[condition.label] || null;\r\n                alarmConfigList.push({\r\n                    key: condition.label,\r\n                    value: value\r\n                });\r\n\r\n                if (condition.duration) {\r\n                    let durationValue = formValues[condition.duration.control.name] || null;\r\n                    alarmConfigList.push({\r\n                        key: condition.duration.control.name,\r\n                        value: durationValue\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        attributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            alarmConfigList\r\n        ).subscribe(\r\n            response => {\r\n                console.log('Alarm config saved successfully:', response);\r\n                vm.dialogRef.close(null);\r\n            },\r\n            error => {\r\n                widgetContext.dialogs.alert('Failed to save alarm config:', JSON.stringify(error));\r\n                console.error('Failed to save alarm config:', error);\r\n            }\r\n        );\r\n    };\r\n}\r\n\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5f4009b7-f9da-9c30-568d-46cb3185d82b"
              },
              {
                "name": "device-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "function openDeviceManagement() {\r\n  const id = entityId?.id;\r\n  if (!id) {\r\n    console.warn('No entityId found!');\r\n    return;\r\n  }\r\n\r\n  const url = `https://cloud.pke-iot.expert/entities/devices/all/${id}`;\r\n  window.open(url, '_blank', 'noopener,noreferrer');\r\n}\r\n\r\nopenDeviceManagement();",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "be8286ca-7714-e447-6087-7557cf2ab664"
              },
              {
                "name": "sim-menu",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "SIM Menu",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "380px",
                "popoverHeight": "375px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "c0969926-8076-b422-4d0e-d590ecc2491e"
              },
              {
                "name": "rssi-widget",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "RSSI Widget",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "300px",
                "popoverHeight": "150px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "4ae94c03-cbd9-7a4a-8428-604eb636ce43"
              },
              {
                "name": "snr-widget",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "SNR Widget",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "300px",
                "popoverHeight": "150px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "f9c6a348-9996-2eff-af31-b788df5c0c31"
              },
              {
                "name": "detailed-data-dashboard",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "157474db-8ba0-c6c2-4308-6da392bf94bb"
              }
            ],
            "headerButton": [
              {
                "name": "Devices",
                "buttonType": "flat",
                "showIcon": true,
                "icon": "devices_other",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openURL",
                "openNewBrowserTab": true,
                "url": "https://cloud.pke-iot.expert/entities/devices/all",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "05d82221-07cc-6709-2a32-0a96d9b1ea75"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "af648660-82b1-7785-e56f-5d9ab107a043"
      },
      "082945e5-d522-45e0-07c6-e3c6bdc557ec": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d448bf9d-472d-50c0-673d-d6ef75ccd28f",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.9967549141360346
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.5624884360658327
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8984113434164049
                },
                {
                  "name": "displayName",
                  "type": "attribute",
                  "label": "displayName",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.25180997441907293
                },
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "status_battery_level",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.22071149447668148
                },
                {
                  "name": "status_margin",
                  "type": "timeseries",
                  "label": "status_margin",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.9146292142531982
                },
                {
                  "name": "location",
                  "type": "attribute",
                  "label": "location",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.45188454883503604
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "meterType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.9376840919233482
                },
                {
                  "name": "status_battery_level_unavailable",
                  "type": "attribute",
                  "label": "status_battery_level_unavailable",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.01081878012315074
                },
                {
                  "name": "status_external_power_source",
                  "type": "attribute",
                  "label": "status_external_power_source",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.7065153448336075
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1711476503570,
                "endTimeMs": 1711562903570
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "var name, label, type, displayName, active, batteryLevel, linkMargin;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    type = data[0]['Type'];\n    displayName = data[0]['displayName'];\n    active = data[0]['active'];\n    batteryLevel = data[0]['status_battery_level'];\n    linkMargin = data[0]['status_margin'];\n    if (active === 'false') {\n        state = 'disconnected';\n    } else state = 'connected';\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    displayName = 'N/A';\n    active = 'N/A';\n    batteryLevel = 'N/A';\n    linkMargin = 'N/A';\n}\n\nvar displayBatteryLevel = showBatteryLevel(type);\n\nvar typeSvg = getTypeSvg(type);\n    var encodedTypeSvg = encodeURIComponent(typeSvg);\n    var typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + label + '</div>' +\n                   '<div class=\"subtitle\">' + displayName + '</div>' +\n                '</div>' +\n//                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-day\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">dashboard</mat-icon><span>Day</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-full\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">device-dashboard</mat-icon><span>Dashboard</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"settings\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">settings</mat-icon><span>Settings</span></button></div>' +\n                '</div>';\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n          header +\n          '<div fxLayout=\"row\" class=\"params\">' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Type: </div>' +\n                '<div class=\"param\">'+ type +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Label: </div>' +\n                '<div class=\"param\">'+ label +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">State: </div>' +\n                '<div class=\"param\">'+ getStateHtml(state) +'</div>' +\n              '</div>' +\n              (displayBatteryLevel ? ('<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Battery level: </div>' +\n                '<div class=\"param\">'+ getBatteryLevelHtml(batteryLevel) +'</div>' +\n              '</div>') : '') +\n          '</div>' +\n       '<div>';\n\nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Enginko LW06485_EV':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Elsys ERS Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Milesight EM300-TH':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Elsys ERS CO2 Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Milesight AM300':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M360-480q17 0 28.5-11.5T400-520v-120q0-17-11.5-28.5T360-680q-17 0-28.5 11.5T320-640v120q0 17 11.5 28.5T360-480Zm40 240h160v-80q0-33-23.5-56.5T480-400q-33 0-56.5 23.5T400-320v80Zm200-240q17 0 28.5-11.5T640-520v-120q0-17-11.5-28.5T600-680q-17 0-28.5 11.5T560-640v120q0 17 11.5 28.5T600-480ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z\"/></svg>';\n            break;\n        case 'Milesight WS522':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Dragino CPL01':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Adeunis Pulse':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-160h80v160h160v80H160ZM80-640v-160q0-33 23.5-56.5T160-880h160v80H160v160H80Zm360 436q-92-14-157-79t-79-157h80q12 59 54.5 101.5T440-284v80ZM204-520q14-92 79-157.5T440-756v80q-59 12-101.5 54.5T284-520h-80Zm276 120q-33 0-56.5-23.5T400-480q0-34 23.5-57t56.5-23q34 0 57 23t23 57q0 33-23 56.5T480-400Zm40 196v-80q59-12 101.5-54.5T676-440h80q-13 92-78.5 157T520-204Zm156-316q-12-59-54.5-101.5T520-676v-80q92 14 157.5 79T756-520h-80ZM640-80v-80h160v-160h80v160q0 33-23.5 56.5T800-80H640Zm160-560v-160H640v-80h160q33 0 56.5 23.5T880-800v160h-80Z\"/></svg>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-520q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM240-280v-76q0-21 10.5-39.5T279-425q45-26 95-40.5T480-480q56 0 106 14.5t95 40.5q18 11 28.5 29.5T720-356v76H240Zm609-354q-31-73-86.5-128.5T634-849l31-74q88 36 154.5 103T923-665l-74 31Zm-738 0-74-31q37-88 103.5-154.5T295-923l31 74q-73 31-128.5 86.5T111-634ZM295-37q-88-36-154.5-103T37-295l74-31q31 73 86.5 128.5T326-111l-31 74Zm370 0-31-74q73-31 128.5-86.5T849-326l74 31q-36 88-103 154.5T665-37Z\"/></svg>';\n            break;\n        case 'Innotas Modularis':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M491-200q12-1 20.5-9.5T520-230q0-14-9-22.5t-23-7.5q-41 3-87-22.5T343-375q-2-11-10.5-18t-19.5-7q-14 0-23 10.5t-6 24.5q17 91 80 130t127 35ZM480-80q-137 0-228.5-94T160-408q0-100 79.5-217.5T480-880q161 137 240.5 254.5T800-408q0 140-91.5 234T480-80Zm0-80q104 0 172-70.5T720-408q0-73-60.5-165T480-774Q361-665 300.5-573T240-408q0 107 68 177.5T480-160Zm0-320Z\"/></svg>';\n            break;\n        case 'Fludia FM432g':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Fludia FM432e':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM310-UDL':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight WS301':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-DI':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-ZLD':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KWZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC WMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC ELZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC GZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC Device':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return typeSvg;\n} \n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n    '</span>';\n}\n\nfunction getBatteryLevelHtml(batteryLevel) {\n    var batteryLevelNumber = Number(batteryLevel);\n    var batteryLevelSvg = getBatteryLevelSvg(batteryLevelNumber);\n    var encodedBatteryLevelSvg = encodeURIComponent(batteryLevelSvg);\n    var batteryLevelSvgUrl = 'data:image/svg+xml,' + encodedBatteryLevelSvg;\n    return '<div>' +\n              '<img class=\"mat-icon\" src=\"'+ batteryLevelSvgUrl +'\">' +\n              '<span style=\"padding-left: 8px; padding-right: 8px;\">' + batteryLevelNumber.toFixed(0) + '%</span>' +\n              '<button id=\"battery-level\" matTooltip=\"Battery Level History\" type=\"button\" mat-flat-button color=\"primary\"><mat-icon>bar_chart</mat-icon></button>' +\n            '</div>';\n}\n\n\nfunction getStateSvg(state) {\n    switch (state) {\n/*        \n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>'; \n*/\n        case 'connected':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getBatteryLevelSvg(batteryLevel) {\n    var batteryLevelSvg;\n    if (batteryLevel <= 5) {\n        batteryLevelSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 35) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#E64A19\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 65) {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#D5C21B\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#D5C21B\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#D5C21B\"/>';\n    } else if (batteryLevel <= 95) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 11H14V13H6V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 8H6V10H14V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#1F8B4D\"/>';\n    } else {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 8H14V10H6V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 5H6V7H14V5Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#1F8B4D\"/>';\n    }\n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n              batteryLevelSvg +\n            '</svg>';\n}\n\n\nfunction getStateLabel(state) {\n    switch(state) {\n/*        \n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n*/\n        case 'connected':\n            return 'Connected';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n\nfunction showBatteryLevel(deviceType) {\n    switch(deviceType) {\n        case 'Innotas Modularis':\n            return true;\n        case 'Fludia FM432g':\n            return true;\n        case 'Fludia FM432e':\n            return true;        \n        case 'Milesight EM310-UDL':\n            return true;\n        case 'Milesight WS301':\n            return true;\n        case 'Milesight EM300-DI':\n            return true;\n        case 'Milesight EM300-TH':\n            return true;\n        case 'Milesight EM300-ZLD':\n            return true;\n        case 'Enginko LW06485_EV':\n            return false;\n        case 'Dragino CPL01':\n            return true;\n        case 'Elsys ERS Lite':\n            return true;\n        case 'Elsys ERS CO2 Lite':\n            return true;\n        case 'Milesight WS522':\n            return false;\n        case 'MUC':\n            return false;\n        case 'MUC KWZ':\n            return false;\n        case 'MUC KMZ':\n            return false;\n        case 'MUC WMZ':\n            return false;\n        case 'MUC ELZ':\n            return false;\n        case 'MUC GZ':\n            return false;\n        case 'MUC Device':\n            return true;\n        case 'Door Sensor':\n            return true;\n        case 'Motion Sensor':\n            return true;\n        case 'Occupancy Sensor':\n            return true;\n        default:\n            return false;\n    }\n}   \n",
            "markdownTextFunction": "var name, label, type, displayName, active, batteryLevel, linkMargin, state, location, meterType;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    type = data[0]['Type'];\n    location = data[0]['location'];\n    meterType = data[0]['meterType'];\n    displayName = data[0]['displayName'];\n    active = data[0]['active'];\n    batteryLevel = data[0]['status_battery_level'];\n    linkMargin = data[0]['status_margin'];\n    if (active === 'false') {\n        state = 'disconnected';\n    } else state = 'connected';\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    displayName = 'N/A';\n    active = 'N/A';\n    batteryLevel = 'N/A';\n    linkMargin = 'N/A';\n    state = 'N/A';\n}\n\nvar displayBatteryLevel = showBatteryLevel(type);\n\nvar typeSvg = getTypeSvg(type);\n    var encodedTypeSvg = encodeURIComponent(typeSvg);\n    var typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\n/*var header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"5px\">' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + displayName  + '</div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + name  + '</div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + label  + '</div>' +\n                '</div>' +\n                '</div>';*/\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"5px\">' +\n                '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                    '<div class=\"param-title\">Name: </div>' +\n                    '<div class=\"param\">' + displayName + '</div>' +\n                '</div>' +\n                '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                    '<div class=\"param-title\">Meter Name: </div>' +\n                    '<div class=\"param\">' + name + '</div>' +\n                '</div>' +\n                '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                    '<div class=\"param-title\">Location: </div>' +\n                    '<div class=\"param\">'+ location +'</div>' +\n                '</div>' +\n                '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                    '<div class=\"param-title\">Label: </div>' +\n                    '<div class=\"param\">' + label + '</div>' +\n                '</div>' +\n             '</div>';\n\n\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n          header +\n          '<div fxLayout=\"row\" class=\"params\">' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Device Profile: </div>' +\n                '<div class=\"param\">'+ type +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Meter Type: </div>' +\n                '<div class=\"param\">'+ meterType +'</div>' +\n              '</div>' +\n//              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n//                '<div class=\"param-title\">Label: </div>' +\n//                '<div class=\"param\">'+ label +'</div>' +\n//              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">State: </div>' +\n                '<div class=\"param\">'+ getStateHtml(state) +'</div>' +\n              '</div>' +\n              (displayBatteryLevel ? ('<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Battery Level: </div>' +\n                '<div class=\"param\">'+ getBatteryLevelHtml(batteryLevel) +'</div>' +\n              '</div>') : '') +\n          '</div>' +\n       '<div>';\n\nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Enginko LW06485_EV':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Elsys ERS Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Milesight EM300-TH':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Elsys ERS CO2 Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Milesight AM300':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M360-480q17 0 28.5-11.5T400-520v-120q0-17-11.5-28.5T360-680q-17 0-28.5 11.5T320-640v120q0 17 11.5 28.5T360-480Zm40 240h160v-80q0-33-23.5-56.5T480-400q-33 0-56.5 23.5T400-320v80Zm200-240q17 0 28.5-11.5T640-520v-120q0-17-11.5-28.5T600-680q-17 0-28.5 11.5T560-640v120q0 17 11.5 28.5T600-480ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z\"/></svg>';\n            break;\n        case 'Milesight WS522':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Dragino CPL01':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Adeunis Pulse':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-160h80v160h160v80H160ZM80-640v-160q0-33 23.5-56.5T160-880h160v80H160v160H80Zm360 436q-92-14-157-79t-79-157h80q12 59 54.5 101.5T440-284v80ZM204-520q14-92 79-157.5T440-756v80q-59 12-101.5 54.5T284-520h-80Zm276 120q-33 0-56.5-23.5T400-480q0-34 23.5-57t56.5-23q34 0 57 23t23 57q0 33-23 56.5T480-400Zm40 196v-80q59-12 101.5-54.5T676-440h80q-13 92-78.5 157T520-204Zm156-316q-12-59-54.5-101.5T520-676v-80q92 14 157.5 79T756-520h-80ZM640-80v-80h160v-160h80v160q0 33-23.5 56.5T800-80H640Zm160-560v-160H640v-80h160q33 0 56.5 23.5T880-800v160h-80Z\"/></svg>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-520q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM240-280v-76q0-21 10.5-39.5T279-425q45-26 95-40.5T480-480q56 0 106 14.5t95 40.5q18 11 28.5 29.5T720-356v76H240Zm609-354q-31-73-86.5-128.5T634-849l31-74q88 36 154.5 103T923-665l-74 31Zm-738 0-74-31q37-88 103.5-154.5T295-923l31 74q-73 31-128.5 86.5T111-634ZM295-37q-88-36-154.5-103T37-295l74-31q31 73 86.5 128.5T326-111l-31 74Zm370 0-31-74q73-31 128.5-86.5T849-326l74 31q-36 88-103 154.5T665-37Z\"/></svg>';\n            break;\n        case 'Innotas Modularis':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M491-200q12-1 20.5-9.5T520-230q0-14-9-22.5t-23-7.5q-41 3-87-22.5T343-375q-2-11-10.5-18t-19.5-7q-14 0-23 10.5t-6 24.5q17 91 80 130t127 35ZM480-80q-137 0-228.5-94T160-408q0-100 79.5-217.5T480-880q161 137 240.5 254.5T800-408q0 140-91.5 234T480-80Zm0-80q104 0 172-70.5T720-408q0-73-60.5-165T480-774Q361-665 300.5-573T240-408q0 107 68 177.5T480-160Zm0-320Z\"/></svg>';\n            break;\n        case 'Fludia FM432g':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Fludia FM432e':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM310-UDL':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight WS301':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-DI':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-ZLD':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KWZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC WMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC ELZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC GZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC Device':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return typeSvg;\n} \n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n    '</span>';\n}\n\nfunction getBatteryLevelHtml(batteryLevel) {\n    var batteryLevelNumber = Number(batteryLevel);\n    var batteryLevelSvg = getBatteryLevelSvg(batteryLevelNumber);\n    var encodedBatteryLevelSvg = encodeURIComponent(batteryLevelSvg);\n    var batteryLevelSvgUrl = 'data:image/svg+xml,' + encodedBatteryLevelSvg;\n    return '<div>' +\n              '<img class=\"mat-icon\" src=\"'+ batteryLevelSvgUrl +'\">' +\n              '<span style=\"padding-left: 8px; padding-right: 8px;\">' + batteryLevelNumber.toFixed(0) + '%</span>' +\n              '<button id=\"battery-level\" matTooltip=\"Battery Level History\" type=\"button\" mat-flat-button color=\"primary\"><mat-icon>bar_chart</mat-icon></button>' +\n            '</div>';\n}\n\n\nfunction getStateSvg(state) {\n    switch (state) {\n/*        \n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>'; \n*/\n        case 'connected':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getBatteryLevelSvg(batteryLevel) {\n    var batteryLevelSvg;\n    if (batteryLevel <= 5) {\n        batteryLevelSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 35) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#E64A19\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 65) {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#D5C21B\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#D5C21B\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#D5C21B\"/>';\n    } else if (batteryLevel <= 95) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 11H14V13H6V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 8H6V10H14V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#1F8B4D\"/>';\n    } else {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 8H14V10H6V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 5H6V7H14V5Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#1F8B4D\"/>';\n    }\n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n              batteryLevelSvg +\n            '</svg>';\n}\n\n\nfunction getStateLabel(state) {\n    switch(state) {\n/*        \n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n*/\n        case 'connected':\n            return 'Connected';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n\nfunction showBatteryLevel(deviceType) {\n    switch(deviceType) {\n        case 'Wassergeraete VoluMess VI-E':\n            return true;\n        case 'Innotas Modularis':\n            return true;\n        case 'Fludia FM432g':\n            return true;\n        case 'Fludia FM432e':\n            return true;        \n        case 'Milesight EM310-UDL':\n            return true;\n        case 'Milesight WS301':\n            return true;\n        case 'Milesight EM300-DI':\n            return true;\n        case 'Milesight EM300-TH':\n            return true;\n        case 'Milesight EM300-ZLD':\n            return true;\n        case 'Enginko LW06485_EV':\n            return false;\n        case 'Dragino CPL01':\n            return true;\n        case 'Elsys ERS Lite':\n            return true;\n        case 'Elsys ERS CO2 Lite':\n            return true;\n        case 'Milesight WS522':\n            return false;\n        case 'MUC':\n            return false;\n        case 'MUC KWZ':\n            return false;\n        case 'MUC KMZ':\n            return false;\n        case 'MUC WMZ':\n            return false;\n        case 'MUC ELZ':\n            return false;\n        case 'MUC GZ':\n            return false;\n        case 'MUC Device':\n            return false;\n        case 'Door Sensor':\n            return true;\n        case 'Motion Sensor':\n            return true;\n        case 'Occupancy Sensor':\n            return true;\n        default:\n            return false;\n    }\n}   \n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".main-layout .header {\n    background-color: #E1E1E1;\n    border-radius: 4px;\n    padding: 4px;\n    margin-bottom: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 4px;\n    margin-bottom: 4px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 0 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "device-settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": null,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2ad18dd5-c734-2c7a-44c8-c903d49c2a60"
              },
              {
                "name": "device-dashboard",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#device-dashboard', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = widgetContext.stateController.getStateParams();\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\n// widgetContext.actionsApi.openDashboardStateInSeparateDialog(stateId, params, entityName, false, '1280', '1024');\nwidgetContext.stateController.openState(stateId, params);\n// widgetContext.actionsApi.handleWidgetAction($event, stateId, params);\n// widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px');\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            return 'wassergeraete_volumess_wmz';\n        case 'Elsys ERS Lite':            \n            return 'elsys_ers_lite';\n        case 'Elsys ERS CO2 Lite':            \n            return 'elsys_ersco2_lite';                      \n        case 'Dragino CPL01':\n            return 'dragino_cpl01';\n        case 'Innotas Modularis':            \n            return 'innotas_modularis';\n        case 'Fludia FM432g':            \n            return 'fludia_fm432g';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'Milesight WS301':            \n            return 'milesight_ws301';\n        case 'Milesight EM300-DI':            \n            return 'milesight_em300_di';                      \n        case 'Milesight EM300-TH':\n            return 'milesight_em300_th';\n        case 'Milesight EM300-ZLD':            \n            return 'milesight_em300_zld';\n        case 'Milesight AM300':            \n            return 'milesight_am300';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'MUC':            \n            return 'muc';                      \n        case 'MUC KWZ':\n            return 'muc_kwz';\n        case 'MUC KMZ':            \n            return 'muc_kmz';\n        case 'MUC WMZ':            \n            return 'muc_wmz';                      \n        case 'MUC ELZ':\n            return 'muc_elz';\n        case 'MUC GZ':\n            return 'muc_gz';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_full';\n        default:\n            return 'unknown_settings';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "12591466-cb13-8a32-ea68-0fe8f6ae1a1c"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery-level",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2189eb1f-7e2b-dfd4-252f-0ae6cdc82a6c"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "082945e5-d522-45e0-07c6-e3c6bdc557ec"
      },
      "5c8a725d-6e42-2a21-d365-1730b601c02c": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d448bf9d-472d-50c0-673d-d6ef75ccd28f",
              "dataKeys": [
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "status_battery_level",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.25118622968309157,
                  "units": "%",
                  "decimals": 1
                },
                {
                  "name": "battery",
                  "type": "timeseries",
                  "label": "Battery",
                  "color": "#4caf50",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.7552143191747047,
                  "aggregationType": null,
                  "units": "%",
                  "decimals": 0,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 2592000000,
              "quickInterval": "CURRENT_DAY",
              "interval": 86400000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "yAxes": {
              "default": {
                "units": "%",
                "decimals": 0,
                "show": true,
                "label": "Battery level",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "min": 0,
                "max": 100
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": false,
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false
            },
            "showTooltip": false,
            "tooltipTrigger": "axis",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": false,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "Battery Level History",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": false,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "5c8a725d-6e42-2a21-d365-1730b601c02c"
      },
      "c398e8a1-0343-c067-947c-f7c6ae40cdb4": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d448bf9d-472d-50c0-673d-d6ef75ccd28f",
              "dataKeys": [
                {
                  "name": "isLoRaWANDevice",
                  "type": "attribute",
                  "label": "LoRaWAN Device",
                  "color": "#ffeb3b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "sensors",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5272640564213735,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "isDisabled",
                  "type": "attribute",
                  "label": "Enable in CS",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "power_settings_new",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5865388505816236,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value === true) {\n    return false;\n} else return true;"
                },
                {
                  "name": "appKey",
                  "type": "attribute",
                  "label": "App Key",
                  "color": "#4caf50",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "isLoRaWANDevice",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "const newValue = \"****************\"\nreturn newValue;",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.10440870796591639,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "devEui",
                  "type": "attribute",
                  "label": "Dev EUI",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "isLoRaWANDevice",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.8229496866436739,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "deviceProfileId",
                  "type": "attribute",
                  "label": "Device Profile in CS",
                  "color": "#03a9f4",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "isLoRaWANDevice",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "8020b2cd-f4a5-4697-824f-ae6ac0f7152a",
                        "label": "Acrios M-Bus IoT converter"
                      },
                      {
                        "value": "3cbe1ca7-a464-4667-b107-01bdf32af718",
                        "label": "Adeunis Analog"
                      },
                      {
                        "value": "fd28688a-61f7-4773-9472-d46d17d37284",
                        "label": "Dragino CPL01"
                      },
                      {
                        "value": "f4c684e5-accb-47b7-ac0d-c355135c1a84",
                        "label": "Eastron SDM230"
                      },
                      {
                        "value": "c40c83d0-4157-4030-a995-7d0f73b7f796",
                        "label": "Eastron SDM630MCT"
                      },
                      {
                        "value": "9def6e68-ad33-48d5-bed9-14a1b22c2567",
                        "label": "Elsys EMS Door"
                      },
                      {
                        "value": "0901f567-63f3-48c0-830f-076195a68aaf",
                        "label": "Elsys ERS CO2 Lite"
                      },
                      {
                        "value": "52293c15-0219-48ab-8064-86dd198d11d2",
                        "label": "Elsys ERS Lite"
                      },
                      {
                        "value": "9148c483-ad3e-403e-b8ff-c06e9dfaf4f9",
                        "label": "EMU Professional II LoRa"
                      },
                      {
                        "value": "ef257efa-a7d4-4cc6-86e2-deb9d628f77a",
                        "label": "Enginko LW06485 Energy Valve"
                      },
                      {
                        "value": "6df1dcb5-b330-4c7f-8ddd-84c4bf468335",
                        "label": "Fludia FM432g"
                      },
                      {
                        "value": "62c9b89b-1eda-45e7-864f-c7bbb84b92c2",
                        "label": "Innotas Modularis"
                      },
                      {
                        "value": "a0e3fdcd-4ed4-4fc5-b909-3b54aa1d5be1",
                        "label": "MClimate Multipurpose Button"
                      },
                      {
                        "value": "02f861e1-1f95-45f8-90ff-bf9e4088c44e",
                        "label": "Milesight AM300"
                      },
                      {
                        "value": "9fbf95d7-e555-4ee3-9939-ed94046fcc10",
                        "label": "Milesight EM300-DI"
                      },
                      {
                        "value": "6d22439b-bb2c-4c2b-acb1-b2fc430f2c38",
                        "label": "Milesight EM300-TH"
                      },
                      {
                        "value": "8ba1ba84-97b9-4817-8a3b-28c9e8ac12d3",
                        "label": "Milesight EM300-ZLD"
                      },
                      {
                        "value": "0eac0920-5a07-4669-8918-882cddab5a51",
                        "label": "Milesight EM310-UDL"
                      },
                      {
                        "value": "a0d5859c-96a0-4658-bc37-7cdb7c108631",
                        "label": "Milesight UC100"
                      },
                      {
                        "value": "fa285287-1203-4b24-a762-b3b9186fc987",
                        "label": "Milesight WS101"
                      },
                      {
                        "value": "76f4af07-286b-4421-bc0a-82f0160ac120",
                        "label": "Milesight WS301"
                      },
                      {
                        "value": "dc3d051f-a3a6-4b7b-91ee-6d5afd25ffbf",
                        "label": "Milesight WS522"
                      },
                      {
                        "value": "e61d2c6a-e3e2-404b-9779-6926969463e6",
                        "label": "Sontex Supercal 739"
                      },
                      {
                        "value": "bc262398-c81f-4460-bf89-6ed426eba080",
                        "label": "Wassergeraete VoluMess VI-E"
                      },
                      {
                        "value": "null",
                        "label": "No Selection"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5511490368838781,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "applicationId",
                  "type": "attribute",
                  "label": "Application in CS",
                  "color": "#ff9800",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "isLoRaWANDevice",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "f39aacae-3622-4e19-91a0-b1f8df30737c",
                        "label": "AKBild"
                      },
                      {
                        "value": "391b5688-6873-427f-847d-c7ecb3c0321b",
                        "label": "Arealis"
                      },
                      {
                        "value": "599aa47b-d9db-4ce1-88e6-8dbc9ac729fc",
                        "label": "BAWAG"
                      },
                      {
                        "value": "410c4c8a-b522-4a9d-9840-9c41a14f2ff3",
                        "label": "Bilfinger"
                      },
                      {
                        "value": "4143221b-ec1e-4aef-b9e2-379060b0d96c",
                        "label": "Hotel Sacher Salzburg"
                      },
                      {
                        "value": "2a3d5a98-a8dd-416d-869d-0a7c8a1fef44",
                        "label": "Humanomed"
                      },
                      {
                        "value": "2c427b51-3609-4932-b495-4293b02c7b88",
                        "label": "ICON Vienna"
                      },
                      {
                        "value": "58dea514-530c-45af-8aac-45f797ce3f13",
                        "label": "IG Immobilien"
                      },
                      {
                        "value": "4d4ed2d2-b9f5-4e49-b58e-02ff466b4c04",
                        "label": "OSG"
                      },
                      {
                        "value": "670669d0-6d51-4e55-9ef2-2af4129c451c",
                        "label": "PKE Test"
                      },
                      {
                        "value": "43729bf4-da49-4d37-8d5f-2b50bb2f70c5",
                        "label": "PKE Deutschland"
                      },
                      {
                        "value": "64dcb625-3826-458d-81c5-81c63714e0c9",
                        "label": "PKE Oesterreich"
                      },
                      {
                        "value": "73957256-89d6-45f1-bec0-ae1597ea258e",
                        "label": "Real Estate Burgenland"
                      },
                      {
                        "value": "2f2c8421-34dc-4728-9200-5c28d4c0bc78",
                        "label": "Sturm Messdienste"
                      },
                      {
                        "value": "cb4ff58b-db7f-486d-be15-21d3de7768c5",
                        "label": "Wiener Wohnen"
                      },
                      {
                        "value": "61ba6f18-29f4-4f8a-99d9-ea056ac3b13e",
                        "label": "Dockal"
                      },
                      {
                        "value": "e76f16e2-04c2-40be-87f2-b507334ed39e",
                        "label": "Austria Real Estate"
                      },
                      {
                        "value": "e1608ddd-e4e7-47ec-b9f5-04e8c9bf5e7f",
                        "label": "Erzbistum Wien"
                      },
                      {
                        "value": "713d58ee-1f37-4f8d-ba3d-d4eb428a38ed",
                        "label": "Green"
                      },
                      {
                        "value": "4143221b-ec1e-4aef-b9e2-379060b0d96c",
                        "label": "Hotel Sacher"
                      },
                      {
                        "value": "0ec1c4a5-9609-4733-9148-a0e817774c97",
                        "label": "Solid Campus"
                      },
                      {
                        "value": "null",
                        "label": "No Selection"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.04766381150951804,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709744245406,
                "endTimeMs": 1709830645406
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FAFAFA",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 2,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "Device Attributes",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "displayTimewindow": true,
          "showTitleIcon": true,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px"
        },
        "row": 0,
        "col": 0,
        "id": "c398e8a1-0343-c067-947c-f7c6ae40cdb4"
      },
      "8b6cf0f7-1b42-c2f6-07ef-46ec9808f597": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "d448bf9d-472d-50c0-673d-d6ef75ccd28f",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1717768545131,
                "endTimeMs": 1717854945131
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ""
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "8b6cf0f7-1b42-c2f6-07ef-46ec9808f597"
      },
      "bf6c7567-1704-2793-6481-054a9d80f360": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "5b0de159-a631-e2d6-c153-a4c3b5dc60e4",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.031424315886006804
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.323899218375304
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "timeseries",
                  "label": "minorAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.7365514506853339
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\nvar minorCount = data[0]['minorAlarmsCount'];\n\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\nvar minorClass = minorCount && Number(minorCount) > 0 ? 'minor' : 'inactive';\n\nreturn '<div style=\"width: 100%; height: 100%; padding: 0;\"class=\"flex flex-row gap-4 justify-end items-center md:justify-center md:items-center\">'+\n       '<div id=\"critical-alarms\" class=\"alarm-badge '+ criticalClass +'\"><i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ criticalCount +'</span> Critical</div>' +\n       '<div id=\"major-alarms\" class=\"alarm-badge '+ majorClass +'\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ majorCount +'</span> Major</div>' +\n        '<div id=\"minor-alarms\" class=\"alarm-badge '+ minorClass +'\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ minorCount +'</span> Minor</div>' +\n       '<div>';",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 4px 16px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n/*.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.minor {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.minor:hover {\n    background-color: #b7a715;\n}*/\n\n.alarm-badge.critical {\n    background-color: #FF0000; /* Rot */\n}\n\n.alarm-badge.major {\n    background-color: #FF8C00; /* Dunkelorange */\n}\n\n.alarm-badge.minor {\n    background-color: #FFD700; /* Dunkelgelb */\n}\n\n.alarm-badge.critical:hover {\n    background-color: rgba(255, 0, 0, 0.8); /* Transparentes Rot bei Hover */\n}\n\n.alarm-badge.major:hover {\n    background-color: rgba(255, 140, 0, 0.8); /* Transparentes Dunkelorange bei Hover */\n}\n\n.alarm-badge.minor:hover {\n    background-color: rgba(255, 215, 0, 0.8); /* Transparentes Dunkelgelb bei Hover */\n}\n\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "critical-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Critical Alarms Card",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "left",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "1000px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2255454c-8c83-dfae-2e0b-8d0df6db6a70"
              },
              {
                "name": "major-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Major Alarms Card",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "1000px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "e52ae76c-959f-f84e-c6b7-3e49c242e70e"
              },
              {
                "name": "minor-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Minor Alarms Card",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "1000px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "04481c4c-b02c-a48a-0815-188879f45979"
              }
            ]
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "bf6c7567-1704-2793-6481-054a9d80f360",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "0d288b70-1157-70e5-088c-b59978a4781e": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "service",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.1809387167779002
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1722773596640,
                "endTimeMs": 1722859996640
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var service = data[0]['service'];\r\n\r\n/* one square tile */\r\nfunction tile(id, iconName, label) {\r\n  return ''\r\n    + '<div class=\"status-desc-container\">'\r\n    +   '<div class=\"status-desc-content\">'\r\n    +     '<button id=\"' + id + '\" type=\"button\" mat-button class=\"custom-button\">'\r\n    +       '<mat-icon class=\"tb-mat-24\">' + iconName + '</mat-icon>'\r\n    +       '<span class=\"btn-label\">' + label + '</span>'\r\n    +     '</button>'\r\n    +   '</div>'\r\n    + '</div>';\r\n}\r\n\r\n\r\n/* tiles */\r\nconst deviceTransferConfig        = tile('deviceTransfer-config',        'swap_vert',           'Transfer Device');\r\nconst datapointsConfig            = tile('datapoint-config',             'tune',                'Datapoint Config');\r\nconst alarmConfig                 = tile('alarm-config',                 'notification_important',               'Alarm Config');\r\nconst dataResend                  = tile('data-resend',                  'send',                'Resend Data');\r\nconst dataInterpolate             = tile('data-interpolate',             'query_stats',         'Interpolate Data');\r\nconst dataImport                  = tile('data-import',                  'drive_folder_upload', 'Import Data');\r\nconst dataTransfer                = tile('data-transfer',                'sync_alt',            'Transfer Data');\r\nconst triggerEEAPi                = tile('trigger-ee-api',               'settings',            'Trigger EE API');\r\nconst setLoraDeviceConfig         = tile('set-lora-device-config',       'devices',            'Configure Device');\r\nconst getHistoricalDataFronius    = tile('get-historical-data-fronius',  'history',            'Get Historical Data');\r\nconst enableInCS                  = tile('enable-in-cs',                 'toggle_on',           'Enable in CS (ToDo)');\r\nconst disableInCS                 = tile('disable-in-cs',                'toggle_off',          'Disable in CS (ToDo)');\r\n\r\n/* layout */\r\nvar html =\r\n  '<div class=\"main-layout\">'\r\n  + (service === true || service === \"true\" || service === \"True\" ? deviceTransferConfig : '')\r\n  + datapointsConfig\r\n  + alarmConfig\r\n  + dataResend\r\n  + dataInterpolate\r\n  + dataImport\r\n  + dataTransfer\r\n  + triggerEEAPi\r\n  + setLoraDeviceConfig\r\n  + getHistoricalDataFronius\r\n  + enableInCS\r\n  + disableInCS\r\n  + '</div>';\r\n\r\nreturn html;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* GRID: 4 columns, generous gaps */\r\n.main-layout {\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 12px;\r\n  display: grid;\r\n  grid-template-columns: repeat(4, minmax(0, 1fr));\r\n  gap: 20px;\r\n  background: transparent;\r\n}\r\n\r\n/* TILE: square via ::before spacer (works everywhere), 20px radius, white w/ primary border */\r\n.status-desc-container {\r\n  position: relative;\r\n  border-radius: 20px;\r\n  background: #ffffff;\r\n  border: 2px solid var(--tb-primary-500);\r\n  overflow: hidden;\r\n  box-shadow: 0 1px 2px rgba(0,0,0,0.06);\r\n  transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease;\r\n}\r\n\r\n/* Square spacer */\r\n.status-desc-container::before {\r\n  content: \"\";\r\n  display: block;\r\n  padding-top: 100%; /* 1:1 aspect */\r\n}\r\n\r\n/* Absolutely positioned content inside the square */\r\n.status-desc-content {\r\n  position: absolute;\r\n  inset: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* The entire square acts as the button */\r\n.custom-button {\r\n  width: 100%;\r\n  height: 100%;\r\n  border: 0;\r\n  background: transparent;\r\n  color: var(--tb-primary-500);\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 10px;\r\n  text-align: center;\r\n  border-radius: 20px;\r\n  cursor: pointer;\r\n  transition: color .18s ease, background-color .18s ease;\r\n}\r\n\r\n/* Label styling  uppercase only the label, not the icon */\r\n.custom-button .btn-label {\r\n  font-size: 14px;\r\n  font-weight: 700;\r\n  letter-spacing: .4px;\r\n  text-transform: uppercase;\r\n  color: var(--tb-primary-500);\r\n}\r\n\r\n/* Hover/active: invert colors for the whole tile */\r\n.status-desc-container:hover,\r\n.status-desc-container:active {\r\n  background: var(--tb-primary-500);\r\n  /*box-shadow: 0 6px 18px rgba(0,0,0,0.18);\r\n  transform: translateY(-2px);*/\r\n}\r\n\r\n.status-desc-container:hover .custom-button,\r\n.status-desc-container:active .custom-button {\r\n  color: #ffffff;\r\n}\r\n\r\n.status-desc-container:hover .btn-label,\r\n.status-desc-container:active .btn-label {\r\n  color: #ffffff;\r\n}\r\n\r\n/* Accessible focus */\r\n.custom-button:focus-visible {\r\n  outline: none;\r\n  box-shadow:\r\n    0 0 0 3px #ffffff,\r\n    0 0 0 6px var(--tb-primary-500);\r\n}\r\n\r\n/* Responsive breakpoints */\r\n@media (max-width: 1200px) {\r\n  .main-layout { grid-template-columns: repeat(3, minmax(0,1fr)); }\r\n}\r\n@media (max-width: 900px) {\r\n  .main-layout { grid-template-columns: repeat(2, minmax(0,1fr)); }\r\n}\r\n@media (max-width: 520px) {\r\n  .main-layout { grid-template-columns: 1fr; }\r\n}\r\n"
          },
          "title": "${entityName}",
          "showTitleIcon": true,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "datapoint-config",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" class=\"add-entity-form\" style=\"width: 350px;\">\n<mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\n<h2 class=\"text-lg font-semibold\">Device Configuration</h2>\n    <span class=\"flex-1\"></span>\n<button mat-icon-button (click)=\"cancel()\" type=\"button\">\n<mat-icon class=\"material-icons\">close</mat-icon>\n</button>\n</mat-toolbar>\n<mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n<div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n \n<div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\n <div class=\"flex w-full gap-2\">\n<mat-form-field appearance=\"fill\" class=\"flex-1\">\n    <mat-label>Datapoint</mat-label>\n    <mat-select formControlName=\"datapoint\" (selectionChange)=\"onDatapointChange($event.value)\">\n    <mat-option *ngFor=\"let attribute of cfgAttributes\" [value]=\"attribute.key\">{{ attribute.key }}</mat-option>\n    </mat-select>\n    <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('datapoint').hasError('required')\">Datapoint is required</mat-error>\n    </mat-form-field>\n</div>\n \n      <div *ngIf=\"selectedAttribute\">\n<!-- Datapoint Config Fields -->\n<mat-form-field appearance=\"fill\" class=\"w-full\">\n<mat-label>Unit</mat-label>\n<input matInput formControlName=\"unit\">\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('unit').hasError('required')\">Unit is required</mat-error>\n</mat-form-field>\n \n<mat-form-field appearance=\"fill\" class=\"w-full\">\n<mat-label>Archive</mat-label>\n<mat-select formControlName=\"archive\">\n<mat-option [value]=11>11-SmartMeterUni</mat-option>\n<mat-option [value]=21>21-SmartMeasureUni</mat-option>\n<mat-option [value]=31>31-SmartSensorUni</mat-option>\n</mat-select>\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('archive').hasError('required')\">Archive is required</mat-error>\n</mat-form-field>\n \n<mat-form-field appearance=\"fill\" class=\"w-full\">\n<mat-label>Aggregation</mat-label>\n<mat-select formControlName=\"aggregation\">\n<mat-option [value]=0>0-Sum</mat-option>\n<mat-option [value]=1>1-Average</mat-option>\n</mat-select>\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('aggregation').hasError('required')\">Aggregation is required</mat-error>\n</mat-form-field>\n \n<mat-form-field appearance=\"fill\" class=\"w-full\">\n<mat-label>Display Name</mat-label>\n<input matInput formControlName=\"displayName\">\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('displayName').hasError('required')\">Display Name is required</mat-error>\n</mat-form-field>\n \n<mat-form-field appearance=\"fill\" class=\"w-full\">\n<mat-label>Scale</mat-label>\n<input matInput formControlName=\"scale\">\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('scale').hasError('required')\">Scale is required</mat-error>\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('scale').hasError('pattern')\">Invalid scale format</mat-error>\n</mat-form-field>\n \n<mat-form-field appearance=\"fill\" class=\"w-full\">\n<mat-label>Decimal Points</mat-label>\n<input matInput formControlName=\"decimalPoints\">\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('decimalPoints').hasError('required')\">Decimal Points are required</mat-error>\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('decimalPoints').hasError('pattern')\">Decimal Points must be between 0 and 5</mat-error>\n</mat-form-field>\n \n<mat-form-field appearance=\"fill\" class=\"w-full\">\n<mat-label>Active</mat-label>\n<mat-select formControlName=\"active\">\n<mat-option [value]=\"true\">Yes</mat-option>\n<mat-option [value]=\"false\">No</mat-option>\n</mat-select>\n<mat-error *ngIf=\"changeDatapointConfigFormGroup.get('active').hasError('required')\">Active status is required</mat-error>\n</mat-form-field>\n</div>\n \n<div mat-dialog-actions class=\"flex justify-end gap-2\">\n<button mat-button color=\"primary\" type=\"button\" [disabled]=\"isLoading$ | async\" (click)=\"cancel()\" cdkFocusInitial>Cancel</button>\n<button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || changeDatapointConfigFormGroup.invalid || !changeDatapointConfigFormGroup.dirty\">Save Config</button>\n</div>\n</div>\n</form>\n",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": {
                  "body": "utils.datapointConfig(widgetContext);\n\n/*let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet deviceProfileService = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\nlet cfgAttributes = [];\nlet deviceProfileId;\n \n \n//widgetContext.dialogs.alert(JSON.stringify(alarmStatus));\n \nattributeService.getEntityAttributes({ entityType: 'DEVICE', id: deviceID }, 'SERVER_SCOPE').subscribe(attributes => {\n    cfgAttributes = attributes.filter(attribute => attribute.key.startsWith('cfg_') && attribute.key !== 'cfg_activeDatapoints');\n    openChangeConfigForm();\n});\n \n \nfunction openChangeConfigForm() {\n    customDialog.customDialog(htmlTemplate, changeConfigForm).subscribe();\n}\n \nfunction changeConfigForm(instance) {\n    let vm = instance;\n    vm.cfgAttributes = cfgAttributes;\n    vm.selectedAttribute = null;\n    vm.changeDatapointConfigFormGroup = vm.fb.group({\n        datapoint: ['', [vm.validators.required]],\n        unit: ['', [vm.validators.required]],\n        archive: ['', [vm.validators.required]],\n        aggregation: [0, [vm.validators.required]], // Initialize with default value\n        displayName: ['', [vm.validators.required]],\n        scale: ['', [vm.validators.required, vm.validators.pattern('^[0-9]+(\\\\.[0-9]+)?$')]],\n        decimalPoints: ['', [vm.validators.required, vm.validators.pattern('[0-5]'), vm.validators.maxLength(1)]],\n        active: ['', [vm.validators.required]]\n    });\n    vm.onDatapointChange = function (selectedKey) {\n        let selected = vm.cfgAttributes.find(attr => attr.key === selectedKey);\n        vm.selectedAttribute = selected ? selected.value : null;\n        if (selected) {\n            vm.changeDatapointConfigFormGroup.patchValue({\n                unit: selected.value.unit || '',\n                archive: selected.value.archive || '',\n                aggregation: selected.value.aggregation !== undefined ? selected.value.aggregation : 0, // Handle undefined case\n                displayName: selected.value.displayName || '',\n                scale: selected.value.scale || '',\n                decimalPoints: selected.value.decimalPoints !== undefined ? selected.value.decimalPoints : 0,\n                active: selected.value.active !== undefined ? selected.value.active : ''\n            });\n        } else {\n            vm.changeDatapointConfigFormGroup.patchValue({\n                unit: '',\n                archive: '',\n                aggregation: 0, // Default value\n                displayName: '',\n                scale: '',\n                decimalPoints: '',\n                active: ''\n            });\n        }\n    };\n    vm.cancel = function () {\n        vm.dialogRef.close(null);\n    };\n \n    vm.saveDatapointConfig = function () {\n        const formValues = vm.changeDatapointConfigFormGroup.value;\n        const attributeValue = {\n            unit: formValues.unit,\n            archive: parseInt(formValues.archive, 10),\n            aggregation: parseInt(formValues.aggregation, 10),\n            displayName: formValues.displayName,\n            scale: parseFloat(formValues.scale),\n            decimalPoints: parseInt(formValues.decimalPoints, 10),\n            active: formValues.active\n        };\n        attributeService.saveEntityAttributes(\n            { entityType: 'DEVICE', id: deviceID },\n            'SERVER_SCOPE',\n            [{\n                key: formValues.datapoint,\n                value: attributeValue\n            }]\n        ).subscribe(\n            () => {\n                console.log('Datapoint config saved successfully.');\n                vm.dialogRef.close(null);\n            },\n            error => {\n                console.error('Failed to save datapoint config:', error);\n            }\n        );\n    };\n}*/",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "951e9a91-3547-4f04-c730-5a58e5a086be"
              },
              {
                "name": "alarm-config",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" class=\"add-entity-form\" style=\"width: 350px;\">\r\n<mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n    <h2 class=\"text-lg font-semibold\">Alarm Configuration</h2>\r\n        <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n        <div class=\"flex w-full gap-2\">\r\n            <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n          <mat-label>Alarm Type</mat-label>\r\n          <mat-select formControlName=\"alarmType\" (selectionChange)=\"onAlarmTypeChange($event.value)\">\r\n            <mat-option *ngFor=\"let alarm of alarms\" [value]=\"alarm.alarmType\">\r\n              {{ alarm.alarmType }} ({{ alarmStatus[alarm.alarmType]?.active ? 'active' : 'inactive' }})\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"changeAlarmConfigFormGroup.get('alarmType').hasError('required')\">Alarm Type is required</mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <!-- Create Rules -->\r\n      <div *ngFor=\"let rule of createRuleFields\">\r\n        <div class=\"severity-text\">{{ rule.name }} Alarm</div>\r\n        <div *ngFor=\"let condition of rule.conditions\">\r\n          <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n            <mat-label>{{ condition.label }}</mat-label>\r\n            <input matInput [formControl]=\"condition.control\">\r\n            <span *ngIf=\"condition.duration\" class=\"duration-unit\">{{ condition.duration.unit }}</span>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Clear Rule -->\r\n      <div *ngIf=\"clearRuleFields.length > 0\">\r\n        <div class=\"severity-text\">Clear Rule</div>\r\n        <div *ngFor=\"let condition of clearRuleFields\">\r\n          <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n            <mat-label>{{ condition.label }}</mat-label>\r\n            <input matInput [formControl]=\"condition.control\">\r\n            <span *ngIf=\"condition.duration\" class=\"duration-unit\">{{ condition.duration.unit }}</span>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"isLoading$ | async\" (click)=\"cancel()\" cdkFocusInitial>Cancel</button>\r\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || changeAlarmConfigFormGroup.invalid || !changeAlarmConfigFormGroup.dirty\">Save Config</button>\r\n      </div>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet deviceProfileService = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\r\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\r\nlet deviceProfileId;\r\nlet alarms = [];\r\nlet attributesList = [];\r\nlet alarmStatus = {};\r\n\r\nattributeService.getEntityAttributes({ entityType: 'DEVICE', id: deviceID }, 'SERVER_SCOPE').subscribe(attributes => {\r\n    attributesList = attributes;\r\n\r\n    deviceService.getDevice(deviceID).subscribe((deviceInfo) => {\r\n        deviceProfileId = deviceInfo.deviceProfileId.id;\r\n        deviceProfileService.getDeviceProfile(deviceProfileId).subscribe((response) => {\r\n            alarms = response.profileData.alarms;\r\n\r\n          \r\n\r\n            // Function to extract source attributes from a condition\r\n            function getSourceAttributesFromCondition(condition) {\r\n                let sourceAttributes = [];\r\n                if (condition.condition && Array.isArray(condition.condition)) {\r\n                    condition.condition.forEach(cond => {\r\n                        if (cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue) {\r\n                            sourceAttributes.push(cond.predicate.value.dynamicValue.sourceAttribute);\r\n                        }\r\n                    });\r\n                }\r\n                if (condition.spec && condition.spec.predicate && condition.spec.predicate.dynamicValue) {\r\n                    sourceAttributes.push(condition.spec.predicate.dynamicValue.sourceAttribute);\r\n                }\r\n                return sourceAttributes;\r\n            }\r\n\r\n            // Loop through each alarm to check for sourceAttributes\r\n            alarms.forEach(alarm => {\r\n                let sourceAttributes = [];\r\n\r\n                // Initialize alarmType status\r\n                if (!alarmStatus[alarm.alarmType]) {\r\n                    alarmStatus[alarm.alarmType] = { active: true };\r\n                }\r\n\r\n               // Check createRules\r\n                Object.keys(alarm.createRules).forEach(ruleKey => {\r\n                    const rule = alarm.createRules[ruleKey];\r\n                    if (rule.condition) {\r\n                        sourceAttributes = sourceAttributes.concat(getSourceAttributesFromCondition(rule.condition));\r\n                    }\r\n                });\r\n\r\n                // Check clearRule\r\n                if (alarm.clearRule && alarm.clearRule.condition) {\r\n                    sourceAttributes = sourceAttributes.concat(getSourceAttributesFromCondition(alarm.clearRule.condition));\r\n                }\r\n\r\n                // Check if each sourceAttribute is in attributesList\r\n                sourceAttributes.forEach(sourceAttribute => {\r\n                    const attributeExists = attributesList.some(attribute => attribute.key === sourceAttribute);\r\n                    if (!attributeExists) {\r\n                        console.warn(`Source attribute ${sourceAttribute} for alarm ${alarm.alarmType} not found in attributes list.`);\r\n                        // Set the active flag to false if any source attribute is missing\r\n                        alarmStatus[alarm.alarmType].active = false;\r\n                    }\r\n                });\r\n            });\r\n               openChangeConfigForm();\r\n        });\r\n    });\r\n});\r\n\r\n\r\nfunction openChangeConfigForm() {\r\n    customDialog.customDialog(htmlTemplate, changeConfigForm).subscribe();\r\n}\r\n\r\nfunction changeConfigForm(instance) {\r\n    let vm = instance;\r\n    vm.alarms = alarms;\r\n    vm.selectedAttribute = null;\r\n    vm.createRuleFields = [];\r\n    vm.clearRuleFields = [];\r\n    vm.alarmStatus = alarmStatus;  // Pass the alarmStatus to the instance\r\n    // Initialize the form group with default values from attributesList\r\n\r\n    vm.changeAlarmConfigFormGroup = vm.fb.group({\r\n        alarmType: ['', [vm.validators.required]]\r\n    });\r\n\r\n    vm.changeAlarmConfigFormGroup.valueChanges.subscribe(change => {\r\n        console.log('changeAlarmConfigFormGroup changed:', change);\r\n    });\r\n\r\n   vm.onAlarmTypeChange = function (selectedType) {\r\n        let selectedAlarm = vm.alarms.find(alarm => alarm.alarmType === selectedType);\r\n\r\n        // Clear previous controls from form group\r\n        Object.keys(vm.changeAlarmConfigFormGroup.controls).forEach(control => {\r\n            if (control !== 'alarmType') {\r\n                vm.changeAlarmConfigFormGroup.removeControl(control);\r\n            }\r\n        });\r\n\r\n        if (selectedAlarm) {\r\n            vm.createRuleFields = [];\r\n            vm.clearRuleFields = [];\r\n\r\n            let addedControls = new Set();\r\n\r\n            // Process createRules\r\n            Object.keys(selectedAlarm.createRules).forEach(ruleName => {\r\n                let rule = selectedAlarm.createRules[ruleName];\r\n                let conditions = [];\r\n\r\n                rule.condition.condition.forEach(cond => {\r\n                    if (cond.key && cond.key.key) {\r\n                        let sourceAttribute = cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue && cond.predicate.value.dynamicValue.sourceAttribute;\r\n                        if (sourceAttribute) {\r\n                            let defaultValue = attributesList.find(attr => attr.key === sourceAttribute)?.value || '';\r\n                            if (!addedControls.has(sourceAttribute)) {\r\n                                let formControl = vm.fb.control(defaultValue, vm.validators.required);\r\n                                conditions.push({\r\n                                    label: sourceAttribute,\r\n                                    control: formControl\r\n                                });\r\n                                vm.changeAlarmConfigFormGroup.addControl(sourceAttribute, formControl);\r\n                                addedControls.add(sourceAttribute);\r\n                                formControl.valueChanges.subscribe(change => {\r\n                                    console.log(`Form control ${sourceAttribute} changed:`, change);\r\n                                    vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                                });\r\n                            }\r\n                        } else if (cond.predicate.value && cond.predicate.value.defaultValue) {\r\n                            let defaultValue = cond.predicate.value.defaultValue;\r\n                            conditions.push({\r\n                                label: cond.key.key,\r\n                                control: vm.fb.control({ value: defaultValue, disabled: true })\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (rule.condition.spec && rule.condition.spec.type === \"DURATION\") {\r\n                    let durationPredicate = rule.condition.spec.predicate;\r\n                    let durationSourceAttribute = durationPredicate && durationPredicate.dynamicValue && durationPredicate.dynamicValue.sourceAttribute;\r\n                    let durationControlName = durationPredicate && durationPredicate.dynamicValue ? durationPredicate.dynamicValue.sourceAttribute : rule.condition.spec.defaultSourceAttribute;\r\n                    if (durationControlName) {\r\n                        let durationDefaultValue = attributesList.find(attr => attr.key === durationControlName)?.value || '';\r\n                        if (!addedControls.has(durationControlName)) {\r\n                            let durationControl = vm.fb.control(durationDefaultValue, vm.validators.required);\r\n                            conditions.push({\r\n                                label: durationControlName,\r\n                                control: durationControl,\r\n                                duration: {\r\n                                    control: durationControl,\r\n                                    unit: rule.condition.spec.unit || 'MINUTES'\r\n                                }\r\n                            });\r\n                           console.log(`Creating form control for duration: ${durationControlName}`);\r\n                            vm.changeAlarmConfigFormGroup.addControl(durationControlName, durationControl);\r\n                            addedControls.add(durationControlName);\r\n                            durationControl.valueChanges.subscribe(change => {\r\n                                console.log(`Duration control ${durationControlName} changed:`, change);\r\n                                vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                            });\r\n                        }\r\n                    } else if (rule.condition.spec.defaultSourceAttribute) {\r\n                        let durationDefaultValue = rule.condition.spec.defaultSourceAttribute;\r\n                        conditions.push({\r\n                            label: durationDefaultValue,\r\n                            control: vm.fb.control({ value: durationDefaultValue, disabled: true })\r\n                        });\r\n                    }\r\n                }\r\n                vm.createRuleFields.push({\r\n                    name: ruleName,\r\n                    conditions: conditions\r\n                });\r\n            });\r\n\r\n            // Process clearRule\r\n            let clearConditions = [];\r\n\r\n            selectedAlarm.clearRule.condition.condition.forEach(cond => {\r\n                if (cond.key && cond.key.key) {\r\n                    let sourceAttribute = cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue && cond.predicate.value.dynamicValue.sourceAttribute;\r\n                    if (sourceAttribute) {\r\n                        let clearDefaultValue = attributesList.find(attr => attr.key === sourceAttribute)?.value || '';\r\n                        if (!addedControls.has(sourceAttribute)) {\r\n                            let formControl = vm.fb.control(clearDefaultValue, vm.validators.required);\r\n                            clearConditions.push({\r\n                                label: sourceAttribute,\r\n                                control: formControl\r\n                            });\r\n                            console.log(`Creating form control for clearRule sourceAttribute: ${sourceAttribute}`);\r\n                            vm.changeAlarmConfigFormGroup.addControl(sourceAttribute, formControl);\r\n                            addedControls.add(sourceAttribute);\r\n                            formControl.valueChanges.subscribe(change => {\r\n                                console.log(`Form control ${sourceAttribute} changed:`, change);\r\n                                vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                            });\r\n                        }\r\n                    } else if (cond.predicate.value && cond.predicate.value.defaultValue) {\r\n                        let clearDefaultValue = cond.predicate.value.defaultValue;\r\n                        clearConditions.push({\r\n                            label: cond.key.key,\r\n                            control: vm.fb.control({ value: clearDefaultValue, disabled: true })\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (selectedAlarm.clearRule.condition.spec && selectedAlarm.clearRule.condition.spec.type === \"DURATION\") {\r\n                let durationPredicate = selectedAlarm.clearRule.condition.spec.predicate;\r\n                let durationSourceAttribute = durationPredicate && durationPredicate.dynamicValue && durationPredicate.dynamicValue.sourceAttribute;\r\n                let durationControlName = durationPredicate && durationPredicate.dynamicValue ? durationPredicate.dynamicValue.sourceAttribute : selectedAlarm.clearRule.condition.spec.defaultSourceAttribute;\r\n                if (durationControlName) {\r\n                    let clearDurationDefaultValue = attributesList.find(attr => attr.key === durationControlName)?.value || '';\r\n                    if (!addedControls.has(durationControlName)) {\r\n                        let durationControl = vm.fb.control(clearDurationDefaultValue, vm.validators.required);\r\n                        clearConditions.push({\r\n                            label: durationControlName,\r\n                            control: durationControl,\r\n                            duration: {\r\n                                control: durationControl,\r\n                                unit: selectedAlarm.clearRule.condition.spec.unit || 'MINUTES'\r\n                            }\r\n                        });\r\n                        console.log(`Creating form control for clearRule duration: ${durationControlName}`);\r\n                        vm.changeAlarmConfigFormGroup.addControl(durationControlName, durationControl);\r\n                        addedControls.add(durationControlName);\r\n                        durationControl.valueChanges.subscribe(change => {\r\n                            console.log(`ClearRule Duration control ${durationControlName} changed:`, change);\r\n                            vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                        });\r\n                    }\r\n                } else if (selectedAlarm.clearRule.condition.spec.defaultSourceAttribute) {\r\n                    let clearDurationDefaultValue = selectedAlarm.clearRule.condition.spec.defaultSourceAttribute;\r\n                    clearConditions.push({\r\n                        label: clearDurationDefaultValue,\r\n                        control: vm.fb.control({ value: clearDurationDefaultValue, disabled: true })\r\n                    });\r\n                }\r\n            }\r\n            vm.clearRuleFields = clearConditions;\r\n        } else {\r\n            vm.createRuleFields = [];\r\n            vm.clearRuleFields = [];\r\n           vm.changeAlarmConfigFormGroup.setControl('alarmSources', vm.fb.array([]));\r\n        }\r\n\r\n        // Subscribe to the valueChanges of the entire form to manage the Save button state\r\n        vm.changeAlarmConfigFormGroup.valueChanges.subscribe(() => {\r\n            vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid;\r\n        });\r\n\r\n        // Initialize saveButtonEnabled based on current form validity\r\n        vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid;\r\n    };\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.saveAlarmConfig = function () {\r\n        const formValues = vm.changeAlarmConfigFormGroup.value;\r\n        let alarmConfigList = [];\r\n\r\n        // Process createRules\r\n        vm.createRuleFields.forEach(rule => {\r\n            rule.conditions.forEach(condition => {\r\n                if (condition.control) {\r\n                    let value = formValues[condition.label] || null;\r\n                    alarmConfigList.push({\r\n                        key: condition.label,\r\n                        value: value\r\n                    });\r\n\r\n                    if (condition.duration) {\r\n                        let durationValue = formValues[condition.duration.control.name] || null;\r\n                        alarmConfigList.push({\r\n                            key: condition.duration.control.name,\r\n                            value: durationValue\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        // Process clearRule\r\n        vm.clearRuleFields.forEach(condition => {\r\n            if (condition.control) {\r\n                let value = formValues[condition.label] || null;\r\n                alarmConfigList.push({\r\n                    key: condition.label,\r\n                    value: value\r\n                });\r\n\r\n                if (condition.duration) {\r\n                    let durationValue = formValues[condition.duration.control.name] || null;\r\n                    alarmConfigList.push({\r\n                        key: condition.duration.control.name,\r\n                        value: durationValue\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        attributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            alarmConfigList\r\n        ).subscribe(\r\n            response => {\r\n                console.log('Alarm config saved successfully:', response);\r\n                vm.dialogRef.close(null);\r\n            },\r\n            error => {\r\n                widgetContext.dialogs.alert('Failed to save alarm config:', JSON.stringify(error));\r\n                console.error('Failed to save alarm config:', error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "8595c004-8b66-6158-7ada-45a1f2879c1d"
              },
              {
                "name": "data-resend",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" class=\"add-entity-form\" style=\"width: 900px;\">\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\n    <h2>Resend Data</h2>\n    <span fxFlex></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n  <div mat-dialog-content fxLayout=\"column\" style=\"width: 900px;\">\n    <form [formGroup]=\"resendDataFormGroup\" (ngSubmit)=\"resendData()\">\n      <mat-horizontal-stepper [linear]=\"true\" #stepper>\n        <mat-step [stepControl]=\"timeseriesFormGroup\">\n          <ng-template matStepLabel><b>Select Timeseries</b></ng-template>\n          <form [formGroup]=\"timeseriesFormGroup\">\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-bottom: 16px;\">\n              <mat-checkbox (change)=\"toggleSelectAll($event.checked)\">Select All</mat-checkbox>\n            </div>\n            <div *ngFor=\"let key of timeseriesKeys\" style=\"margin-bottom: 8px;\">\n              <mat-checkbox [formControlName]=\"key\">{{ key }}</mat-checkbox>\n            </div>\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\n              <button mat-button matStepperNext [disabled]=\"!hasSelectedTimeseries()\">Next</button>\n            </div>\n          </form>\n        </mat-step>\n        <mat-step [stepControl]=\"timeWindowFormGroup\">\n          <ng-template matStepLabel><b>Select Timewindow</b></ng-template>\n          <form [formGroup]=\"timeWindowFormGroup\">\n            <section fxLayout=\"column\" fxLayoutAlign=\"center center\" style=\"width: 100%;\">\n              <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\n                  <mat-label>Date From</mat-label>\n                  <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\n                  <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                  <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\n                </mat-form-field>\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\n                  <mat-label>Time From</mat-label>\n                  <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\n                  <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                  <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\n                </mat-form-field>\n              </section>\n              <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\n                  <mat-label>Date To</mat-label>\n                  <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\n                  <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                  <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\n                </mat-form-field>\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\n                  <mat-label>Time To</mat-label>\n                  <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\n                  <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                  <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\n                </mat-form-field>\n              </section>\n            </section>\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\n              <div>\n                <button mat-button matStepperPrevious>Previous</button>\n                <button mat-button matStepperNext (click)=\"updateCombinedTimestamps()\">Next</button>\n              </div>\n            </div>\n          </form>\n        </mat-step>\n        <mat-step [stepControl]=\"resendToFormGroup\">\n          <ng-template matStepLabel><b>Resend To</b></ng-template>\n          <form [formGroup]=\"resendToFormGroup\">\n            <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\n              <mat-label>Resend To</mat-label>\n              <mat-select formControlName=\"resendForwardTo\">\n                <mat-option *ngFor=\"let option of resendOptions\" [value]=\"option\">{{ option }}</mat-option>\n              </mat-select>\n            </mat-form-field>\n            <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\n              <mat-label>Interval (min)</mat-label>\n              <input matInput type=\"number\" formControlName=\"interval\">\n            </mat-form-field>\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\n              <div>\n                <button mat-button matStepperPrevious>Previous</button>\n                <button mat-button matStepperNext>Next</button>\n              </div>\n            </div>\n          </form>\n        </mat-step>\n        <mat-step>\n          <ng-template matStepLabel><b>Review & Submit</b></ng-template>\n          <div>\n            <p style=\"font-size: 16px; font-weight: bold;\">Selected Timeseries:</p>\n            <ul>\n              <li *ngFor=\"let key of selectedTimeseriesKeys\" style=\"font-size: 14px;\">{{ key }}</li>\n            </ul>\n            <p style=\"font-size: 16px; font-weight: bold;\">Timewindow:</p>\n            <p style=\"font-size: 16px;\">Start: {{ combinedStartTs | date:'medium' }}</p>\n            <p style=\"font-size: 16px;\">End: {{ combinedEndTs | date:'medium' }}</p>\n            <p style=\"font-size: 16px; font-weight: bold;\">Resend To:</p>\n            <p style=\"font-size: 16px;\">{{resendToFormGroup.get('resendForwardTo').value}}</p>\n            <p style=\"font-size: 16px; font-weight: bold;\">Interval (min):</p>\n            <p style=\"font-size: 16px;\">{{resendToFormGroup.get('interval').value}}</p>\n          </div>\n        <div mat-dialog-actions class=\"flex justify-end gap-2\">\n            <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\n            <div>\n              <button mat-button matStepperPrevious>Previous</button>\n              <button mat-button type=\"submit\">Resend Data</button>\n            </div>\n          </div>\n        </mat-step>\n      </mat-horizontal-stepper>\n    </form>\n  </div>\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": {
                  "body": "utils.resendDataDevice(widgetContext);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "267e2f97-7034-7e9c-f753-4511f86c8a16"
              },
              {
                "name": "data-interpolate",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" class=\"add-entity-form\" style=\"width: 900px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Interpolate Data</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\" style=\"width: 900px;\">\r\n    <form [formGroup]=\"interpolateDataFormGroup\" (ngSubmit)=\"interpolateData()\">\r\n      <mat-horizontal-stepper [linear]=\"true\" #stepper>\r\n        <mat-step [stepControl]=\"timeseriesFormGroup\">\r\n          <ng-template matStepLabel><b>Select Timeseries</b></ng-template>\r\n          <form [formGroup]=\"timeseriesFormGroup\">\r\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-bottom: 16px;\">\r\n              <mat-checkbox (change)=\"toggleSelectAll($event.checked)\">Select All</mat-checkbox>\r\n            </div>\r\n            <div *ngFor=\"let key of timeseriesKeys\" style=\"margin-bottom: 8px;\">\r\n              <mat-checkbox [formControlName]=\"key\">{{ key }}</mat-checkbox>\r\n            </div>\r\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <button mat-button matStepperNext [disabled]=\"!hasSelectedTimeseries()\">Next</button>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <mat-step [stepControl]=\"timeWindowFormGroup\">\r\n          <ng-template matStepLabel><b>Select Timewindow</b></ng-template>\r\n          <form [formGroup]=\"timeWindowFormGroup\">\r\n            <section fxLayout=\"column\" fxLayoutAlign=\"center center\" style=\"width: 100%;\">\r\n              <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n                  <mat-label>Date From</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n                </mat-form-field>\r\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n                  <mat-label>Time From</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n                </mat-form-field>\r\n              </section>\r\n              <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n                  <mat-label>Date To</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n                </mat-form-field>\r\n                <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n                  <mat-label>Time To</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n                </mat-form-field>\r\n              </section>\r\n            </section>\r\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <div>\r\n                <button mat-button matStepperPrevious>Previous</button>\r\n                <button mat-button matStepperNext (click)=\"updateCombinedTimestamps()\">Next</button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <mat-step [stepControl]=\"interpolationConfigFormGroup\">\r\n          <ng-template matStepLabel><b>Interpolation Config</b></ng-template>\r\n          <form [formGroup]=\"interpolationConfigFormGroup\">\r\n            <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\r\n              <mat-label>Interpolation Method</mat-label>\r\n              <mat-select formControlName=\"interpolationMethod\">\r\n                <mat-option value=\"ffill\">Forward Fill</mat-option>\r\n                <mat-option value=\"bfill\">Backward Fill</mat-option>\r\n                <mat-option value=\"linear\">Linear</mat-option>\r\n              </mat-select>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\r\n              <mat-label>Interpolation Interval (minutes)</mat-label>\r\n              <input matInput formControlName=\"interpolationInterval\" type=\"number\" min=\"0\">\r\n            </mat-form-field>\r\n\r\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <div>\r\n                <button mat-button matStepperPrevious>Previous</button>\r\n                <button mat-button matStepperNext>Next</button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <mat-step>\r\n          <ng-template matStepLabel><b>Review & Submit</b></ng-template>\r\n          <div>\r\n            <p style=\"font-size: 16px; font-weight: bold;\">Selected Timeseries:</p>\r\n            <ul>\r\n              <li *ngFor=\"let key of selectedTimeseriesKeys\" style=\"font-size: 14px;\">{{ key }}</li>\r\n            </ul>\r\n            <p style=\"font-size: 16px; font-weight: bold;\">Timewindow:</p>\r\n            <p style=\"font-size: 16px;\">Start: {{ combinedStartTs | date:'medium' }}</p>\r\n            <p style=\"font-size: 16px;\">End: {{ combinedEndTs | date:'medium' }}</p>\r\n            <p style=\"font-size: 16px; font-weight: bold;\">Interpolation Method:</p>\r\n            <p style=\"font-size: 16px;\">{{ interpolationConfigFormGroup.get('interpolationMethod').value }}</p>\r\n            <p style=\"font-size: 16px; font-weight: bold;\">Sending Interval:</p>\r\n            <p style=\"font-size: 16px;\">{{ interpolationConfigFormGroup.get('interpolationInterval').value }} minutes</p>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\r\n            <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n            <div>\r\n              <button mat-button matStepperPrevious>Previous</button>\r\n              <button mat-button type=\"submit\">Interpolate Data</button>\r\n            </div>\r\n          </div>\r\n        </mat-step>\r\n      </mat-horizontal-stepper>\r\n    </form>\r\n  </div>\r\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\r\nlet timeseries = {};\r\nlet timeseriesKeys = [];\r\n\r\n//console.log(\"Test id: \" + deviceID);\r\nattributeService.getEntityTimeseriesLatest({ entityType: 'DEVICE', id: deviceID }).subscribe(response => {\r\n    timeseries = response;\r\n    timeseriesKeys = Object.keys(timeseries);\r\n    //console.log(\"Timeseries: \" + JSON.stringify(timeseries));\r\n    openInterpolateDataForm();\r\n});\r\n\r\nfunction openInterpolateDataForm() {\r\n    customDialog.customDialog(htmlTemplate, interpolateDataForm).subscribe();\r\n}\r\n\r\nfunction interpolateDataForm(instance) {\r\n    let vm = instance;\r\n    vm.timeseriesKeys = timeseriesKeys;\r\n    vm.selectedTimeseriesKeys = [];\r\n    vm.combinedStartTs = null;\r\n    vm.combinedEndTs = null;\r\n    vm.resendOptions = [\"Energy Expert API\", \"Energy Expert\", \"IoT Hub\"];\r\n    vm.timeseriesFormGroup = vm.fb.group({});\r\n    vm.timeseriesKeys.forEach(key => {\r\n        vm.timeseriesFormGroup.addControl(key, vm.fb.control(false));\r\n    });\r\n\r\n    vm.timeWindowFormGroup = vm.fb.group({\r\n        startDate: [null, vm.validators.required],\r\n        startTime: [null, vm.validators.required],\r\n        endDate: [null, vm.validators.required],\r\n        endTime: [null, vm.validators.required]\r\n    });\r\n\r\n    vm.interpolationConfigFormGroup = vm.fb.group({\r\n        interpolationMethod: ['linear', vm.validators.required], // Set default to 'linear'\r\n        interpolationInterval: [15, vm.validators.required] // Set default to 15\r\n    });\r\n\r\n    vm.interpolateDataFormGroup = vm.fb.group({\r\n        timeseriesForm: vm.timeseriesFormGroup,\r\n        timeWindowForm: vm.timeWindowFormGroup,\r\n        interpolationConfigForm: vm.interpolationConfigFormGroup\r\n    });\r\n\r\n    vm.timeseriesFormGroup.valueChanges.subscribe(value => {\r\n        vm.selectedTimeseriesKeys = Object.keys(value).filter(key => value[key]);\r\n        // Enable or disable the Next button based on selection\r\n        vm.stepper.steps.first._stepControl = vm.timeseriesFormGroup;\r\n        vm.stepper.next.disabled = !vm.hasSelectedTimeseries();\r\n    });\r\n\r\n    vm.toggleSelectAll = function (checked) {\r\n        Object.keys(vm.timeseriesFormGroup.controls).forEach(key => {\r\n            vm.timeseriesFormGroup.get(key).setValue(checked);\r\n        });\r\n    };\r\n\r\n    vm.hasSelectedTimeseries = function () {\r\n        return Object.values(vm.timeseriesFormGroup.value).some(val => val);\r\n    };\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.interpolateData = function () {\r\n        const timeseriesSelection = vm.timeseriesFormGroup.value;\r\n        const timeWindowSelection = vm.timeWindowFormGroup.value;\r\n        const interpolationMethod = vm.interpolationConfigFormGroup.get('interpolationMethod').value;\r\n        const interpolationInterval = vm.interpolationConfigFormGroup.get('interpolationInterval').value;\r\n        let selectedKeys = [];\r\n        Object.keys(timeseriesSelection).forEach(key => {\r\n            if (timeseriesSelection[key]) {\r\n                selectedKeys.push(key);\r\n            }\r\n        });\r\n        //console.log(\"startTime: \" + JSON.stringify(timeWindowSelection.startTime));\r\n        //console.log(\"endTime: \" + JSON.stringify(timeWindowSelection.endTime));\r\n\r\n        let startTs = combineDateAndTime(timeWindowSelection.startDate, timeWindowSelection.startTime);\r\n        let endTs = combineDateAndTime(timeWindowSelection.endDate, timeWindowSelection.endTime);\r\n\r\n        vm.combinedStartTs = startTs;\r\n        vm.combinedEndTs = endTs;\r\n\r\n        //console.log('Selected Timeseries Keys:', selectedKeys);\r\n        //console.log('Time Window - Start:', startTs);\r\n        //console.log('Time Window - End:', endTs);\r\n        //console.log('Interpolation Method:', interpolationMethod);\r\n        //console.log('Sending Interval:', interpolationInterval);\r\n\r\n        attributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            [{\r\n                key: \"interpolateData\",\r\n                value: {\r\n                    timeseries: timeseriesSelection,\r\n                    startTs : startTs,\r\n                    endTs : endTs,\r\n                    interpolationMethod: interpolationMethod,\r\n                    interpolationInterval: interpolationInterval\r\n                }\r\n            }]\r\n        ).subscribe(\r\n            () => {\r\n                console.log('Attribute saved successfully.');\r\n                vm.dialogRef.close(null);\r\n            },\r\n            error => {\r\n                console.error('Failed to save Attribute config:', error);\r\n            }\r\n        );\r\n        vm.dialogRef.close({\r\n            selectedKeys: selectedKeys,\r\n            startTs: startTs,\r\n            endTs: endTs,\r\n            interpolationMethod: interpolationMethod,\r\n            interpolationInterval: interpolationInterval\r\n        });\r\n    };\r\n\r\n    vm.updateCombinedTimestamps = function () {\r\n        const timeWindowSelection = vm.timeWindowFormGroup.value;\r\n        //console.log(\"timeWindowSelection: \" + JSON.stringify(timeWindowSelection));\r\n        vm.combinedStartTs = combineDateAndTime(timeWindowSelection.startDate, timeWindowSelection.startTime);\r\n        vm.combinedEndTs = combineDateAndTime(timeWindowSelection.endDate, timeWindowSelection.endTime);\r\n    };\r\n\r\n    function combineDateAndTime(date, time) {\r\n        if (!date || !time) return null;\r\n\r\n        // Convert the time string to a Date object\r\n        let timeObj = new Date(time);\r\n        let hours = timeObj.getHours();       // Get local hours\r\n        let minutes = timeObj.getMinutes();   // Get local minutes\r\n\r\n        // Create a new Date object from the selected date (local time zone)\r\n        let combined = new Date(date);\r\n\r\n        // Set hours and minutes on the combined date object\r\n        combined.setHours(hours);\r\n        combined.setMinutes(minutes);\r\n\r\n        // Return the timestamp of the combined date and time\r\n        return combined.getTime();\r\n    }\r\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0d5156ea-9aec-b3a1-d389-2329f7739e96"
              },
              {
                "name": "data-import",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addEntityFormGroup\" style=\"width: 640px\">\r\n    <mat-toolbar color=\"primary\">\r\n        <h2>Import Data</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <mat-tab-group [(selectedIndex)]=\"selectedTabIndex\">\r\n        <!-- First Tab: Data Input -->\r\n        <mat-tab label=\"Data\">\r\n            <div mat-dialog-content fxLayout=\"column\" style=\"position: relative\">\r\n                <fieldset [disabled]=\"isLoading$ | async\" tb-toast toastTarget=\"importSensorsTarget\">\r\n                    <tb-file-input formControlName=\"importData\"\r\n                                   required\r\n                                   label=\"Devices file\"\r\n                                   [allowedExtensions]=\"'csv,txt'\"\r\n                                   [accept]=\"'.csv,application/csv,text/csv,.txt,text/plain'\"\r\n                                   dropLabel=\"{{'import.drop-file-csv-or' | translate}}\">\r\n                    </tb-file-input>\r\n\r\n                    <mat-form-field class=\"mat-block\" style=\"margin-top: 12px\">\r\n                        <mat-label translate>import.csv-delimiter</mat-label>\r\n                        <mat-select required formControlName=\"delim\">\r\n                            <mat-option *ngFor=\"let delimiter of delimiters\" [value]=\"delimiter.key\">\r\n                                {{ delimiter.value }}\r\n                            </mat-option>\r\n                        </mat-select>\r\n                    </mat-form-field>\r\n\r\n                    <div class=\"import-info-section\" style=\"margin-top: 12px; font-size: 14px; color: gray;\">\r\n                        <div class=\"import-info-header\">Timestamp Format Examples:</div>\r\n                        <div class=\"import-info-text\" style=\"margin-top: 4px;\">\r\n                            <div>1. **MM/DD/YYYY HH:mm** (e.g., 10/23/2024 14:30)</div>\r\n                            <div>2. **DD.MM.YYYY HH:mm** (e.g., 23.10.2024 14:30)</div>\r\n                            <div>3. **YYYY.MM.DD HH:mm** (e.g., 2024.10.23 14:30)</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <mat-form-field class=\"mat-block\" style=\"margin-top: 12px\">\r\n                        <mat-label>Timestamp Format</mat-label>\r\n                        <mat-select formControlName=\"timestampFormat\" (selectionChange)=\"onTimestampFormatChange($event)\">\r\n                            <mat-option *ngFor=\"let format of timestampFormats\" [value]=\"format\">\r\n                                {{ format }}\r\n                            </mat-option>\r\n                            <mat-option value=\"other\">Other</mat-option>\r\n                        </mat-select>\r\n                    </mat-form-field>\r\n\r\n                    <mat-form-field *ngIf=\"customTimestampFormatVisible\" class=\"mat-block\">\r\n                        <mat-label>Custom Timestamp Format</mat-label>\r\n                        <input matInput formControlName=\"customTimestampFormat\" placeholder=\"Enter custom format\"\r\n                               (blur)=\"validateCustomTimestampFormat()\">\r\n                        <mat-error *ngIf=\"addEntityFormGroup.get('customTimestampFormat').hasError('invalid')\">\r\n                            Invalid format. Please enter a valid format.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n\r\n                    <div class=\"import-info-section\" style=\"margin-top: 12px\">\r\n                        <div class=\"import-info-header\">CSV file must contain columns:</div>\r\n                        <div class=\"import-info-text\">\r\n                            <div>1. timestamp</div>\r\n                            <div>2. datapoint 1 name</div>\r\n                            <div>3. datapoint 2 name</div>\r\n                            <div>4. datapoint 3 name</div>\r\n                            <div>5. ...</div>\r\n                        </div>\r\n                    </div>\r\n                </fieldset>\r\n            </div>\r\n            <div mat-dialog-actions fxLayoutAlign=\"end center\">\r\n                <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\">\r\n                    Cancel\r\n                </button>\r\n                <button mat-button mat-raised-button color=\"primary\" \r\n                        [disabled]=\"(isLoading$ | async) || addEntityFormGroup.invalid || !addEntityFormGroup.dirty\" \r\n                        (click)=\"navigateToOverview()\">\r\n                    Next\r\n                </button>\r\n            </div>\r\n        </mat-tab>\r\n\r\n        <!-- Second Tab: Overview -->\r\n        <mat-tab label=\"Overview\">\r\n            <div *ngIf=\"parsedData\">\r\n                <!-- Warning Message Section -->\r\n                <div *ngIf=\"warningMessage\" class=\"warning-message\">\r\n                    {{ warningMessage }}\r\n                </div>\r\n                <table mat-table [dataSource]=\"dataSource\" class=\"mat-elevation-z0\" style=\"margin-top: 20px; width: 100%;\">\r\n                    <!-- Column Names Definition -->\r\n                    <ng-container matColumnDef=\"columnNames\">\r\n                        <th mat-header-cell *matHeaderCellDef> Column Names </th>\r\n                        <td mat-cell *matCellDef=\"let element\"> {{ element.columnName }} </td>\r\n                    </ng-container>\r\n\r\n                    <!-- First Value Definition -->\r\n                    <ng-container matColumnDef=\"firstValue\">\r\n                        <th mat-header-cell *matHeaderCellDef> First Value </th>\r\n                        <td mat-cell *matCellDef=\"let element\"> {{ element.firstValue }} </td>\r\n                    </ng-container>\r\n\r\n                    <!-- Custom Telemetry Name Definition -->\r\n                    <ng-container matColumnDef=\"customTelemetryName\">\r\n                        <th mat-header-cell *matHeaderCellDef> Custom Telemetry Name </th>\r\n                        <td mat-cell *matCellDef=\"let element; let i = index\">\r\n                            <input *ngIf=\"i > 0\" matInput \r\n                                   [value]=\"element.customTelemetryName\" \r\n                                   [placeholder]=\"element.columnName\" \r\n                                   (input)=\"onCustomTelemetryNameChange(i, $event.target.value)\" />\r\n                            <span *ngIf=\"i === 0\"></span> <!-- No input field for the timestamp -->\r\n                        </td>\r\n                    </ng-container>\r\n\r\n                    <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\r\n                    <tr mat-row *matRowDef=\"let row; columns: displayedColumns;\"></tr>\r\n                </table>\r\n            </div>\r\n\r\n            <div mat-dialog-actions fxLayoutAlign=\"end center\" style=\"margin-top: 20px;\">\r\n                <button mat-button color=\"primary\" (click)=\"cancel()\">Cancel</button>\r\n                <button mat-button color=\"primary\" (click)=\"goBack()\">Back</button>\r\n                <button mat-button mat-raised-button color=\"primary\" (click)=\"importData()\">\r\n                    Import\r\n                </button>\r\n            </div>\r\n        </mat-tab>\r\n    </mat-tab-group>\r\n</form>\r\n",
                "customCss": ".import-info-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: 12px 16px;\r\n    background-color: rgba(0, 0, 0, 0.04);\r\n    border-radius: 4px;\r\n}\r\n\r\n.import-info-header,\r\n.import-info-text {\r\n    font-size: 14px;\r\n    line-height: 20px;\r\n    letter-spacing: 0.2px;\r\n    color: rgba(0, 0, 0, 0.54);\r\n}\r\n\r\n.import-info-header {\r\n    font-weight: 700;\r\n}\r\n\r\n.delim-value {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    font-weight: 700;\r\n}\r\n\r\n.example-content {\r\n    padding: 12px;\r\n    border: 1px solid rgba(0, 0, 0, 0.12);\r\n    border-radius: 6px;\r\n    background-color: rgba(255, 255, 255, 0.08);\r\n}\r\n\r\n.example-content .import-info-text {\r\n    font-size: 10px;\r\n    color: rgba(0, 0, 0, 0.38);\r\n}\r\n\r\n\r\nbutton.selected {\r\n    background-color: var(--tb-primary-500) !important;\r\n    color: var(--tb-primary-contrast-500) !important;\r\n}\r\n\r\nbutton.selected mat-icon.tb-mat-18 {\r\n    color: var(--tb-primary-contrast-500) !important;\r\n}\r\n\r\nbutton mat-icon.tb-mat-18 {\r\n    font-size: 18px;\r\n    margin-right: 4px;\r\n}\r\n.warning-message {\r\n    color: #d86f1d; /* Slightly darker orange for text */\r\n    background-color: #fff3cd; /* Light yellow background */\r\n    border: 1px solid #ffeeba; /* Light yellow border */\r\n    border-radius: 5px; /* Rounded corners */\r\n    padding: 10px; /* Padding for better spacing */\r\n    margin-top: 12px; /* Spacing above the warning */\r\n    font-weight: bold; /* Bold font */\r\n    font-size: 1rem; /* Font size for readability */\r\n    display: flex; /* Flexbox for better layout */\r\n    align-items: center; /* Center vertically */\r\n}\r\n\r\n.warning-message::before {\r\n    content: \"\"; /* Warning icon */\r\n    margin-right: 8px; /* Space between icon and text */\r\n}\r\n\r\n",
                "customFunction": {
                  "body": "utils.importData(widgetContext);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "95ab1c60-bd36-7b59-f01d-19c81a1a99d5"
              },
              {
                "name": "data-transfer",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!-- transfer-data-form.component.html -->\r\n<form #addEntityForm=\"ngForm\" class=\"add-entity-form\" fxLayout=\"column\" fxFlexFill>\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Transfer Data</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\" fxFlex=\"1 1 auto\" style=\"overflow: auto;\">\r\n    <form [formGroup]=\"transferDataFormGroup\" (ngSubmit)=\"transferData()\">\r\n      <mat-horizontal-stepper [linear]=\"true\" #stepper>\r\n        <mat-step [stepControl]=\"timeseriesFormGroup\">\r\n          <ng-template matStepLabel><b>Select Timeseries</b></ng-template>\r\n          <form [formGroup]=\"timeseriesFormGroup\">\r\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-bottom: 16px;\">\r\n              <mat-checkbox (change)=\"toggleSelectAll($event.checked)\">Select All</mat-checkbox>\r\n            </div>\r\n            <div *ngFor=\"let key of timeseriesKeys\" style=\"margin-bottom: 8px;\">\r\n              <mat-checkbox [formControlName]=\"key\">{{ key }}</mat-checkbox>\r\n            </div>\r\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <button mat-button matStepperNext [disabled]=\"!hasSelectedTimeseries()\">Next</button>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <mat-step [stepControl]=\"targetTimeseriesFormGroup\">\r\n          <ng-template matStepLabel><b>Target Timeseries</b></ng-template>\r\n          <form [formGroup]=\"targetTimeseriesFormGroup\">\r\n            <div style=\"overflow: auto;\">\r\n              <table mat-table [dataSource]=\"selectedTimeseriesKeys\" class=\"mat-elevation-z8 transfer-table\">\r\n                <ng-container matColumnDef=\"source\">\r\n                  <th mat-header-cell *matHeaderCellDef> Selected Timeseries </th>\r\n                  <td mat-cell *matCellDef=\"let element\"> {{element}} </td>\r\n                </ng-container>\r\n\r\n                <ng-container matColumnDef=\"target\">\r\n                  <th mat-header-cell *matHeaderCellDef> Target Timeseries </th>\r\n                  <td mat-cell *matCellDef=\"let element\">\r\n                    <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\r\n                      <mat-label>Target for {{element}}</mat-label>\r\n                      <input matInput [formControlName]=\"element\" required>\r\n                    </mat-form-field>\r\n                  </td>\r\n                </ng-container>\r\n\r\n                <ng-container matColumnDef=\"targetDevice\">\r\n                  <th mat-header-cell *matHeaderCellDef> Target Device </th>\r\n                  <td mat-cell *matCellDef=\"let element\">\r\n                    <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\r\n                      <mat-label>Device for {{element}}</mat-label>\r\n                      <input type=\"text\" matInput [formControlName]=\"element + '_device'\" [matAutocomplete]=\"auto\" (input)=\"filterDevices($event.target.value, element)\">\r\n                      <mat-autocomplete #auto=\"matAutocomplete\">\r\n                        <mat-option *ngFor=\"let dev of filteredDevices[element]\" [value]=\"dev.name\" matTooltip=\"{{dev.name}}\">\r\n                          {{dev.name}}\r\n                        </mat-option>\r\n                      </mat-autocomplete>\r\n                    </mat-form-field>\r\n                  </td>\r\n                </ng-container>\r\n\r\n                <ng-container matColumnDef=\"delete\">\r\n                  <th mat-header-cell *matHeaderCellDef> Delete Current Timeseries </th>\r\n                  <td mat-cell *matCellDef=\"let element\">\r\n                    <mat-checkbox [formControlName]=\"element + '_delete'\"></mat-checkbox>\r\n                  </td>\r\n                </ng-container>\r\n\r\n                <ng-container matColumnDef=\"interval\">\r\n                  <th mat-header-cell *matHeaderCellDef> Interval (minutes) </th>\r\n                  <td mat-cell *matCellDef=\"let element\">\r\n                    <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\r\n                      <mat-label>Interval for {{element}}</mat-label>\r\n                      <input matInput type=\"number\" min=\"1\" [formControlName]=\"element + '_interval'\" required>\r\n                    </mat-form-field>\r\n                  </td>\r\n                </ng-container>\r\n\r\n                <ng-container matColumnDef=\"resendTransferData\">\r\n                  <th mat-header-cell *matHeaderCellDef> Resend Data </th>\r\n                  <td mat-cell *matCellDef=\"let element\">\r\n                    <mat-checkbox [formControlName]=\"element + '_resendData'\"></mat-checkbox>\r\n                  </td>\r\n                </ng-container>\r\n\r\n                <ng-container matColumnDef=\"resendTo\">\r\n                  <th mat-header-cell *matHeaderCellDef> Resend To </th>\r\n                  <td mat-cell *matCellDef=\"let element\">\r\n                    <mat-form-field appearance=\"fill\" style=\"width: 100%;\" *ngIf=\"targetTimeseriesFormGroup.get(element + '_resendData').value === true\">\r\n                      <mat-label>Resend To for {{element}}</mat-label>\r\n                      <mat-select [formControlName]=\"element + '_resendTo'\">\r\n                        <mat-option value=\"Energy Expert API\">Energy Expert API</mat-option>\r\n                        <mat-option value=\"Energy Expert\">Energy Expert</mat-option>\r\n                      </mat-select>\r\n                    </mat-form-field>\r\n                  </td>\r\n                </ng-container>\r\n\r\n                <tr mat-header-row *matHeaderRowDef=\"['source', 'target', 'targetDevice', 'delete', 'interval', 'resendTransferData', 'resendTo']\"></tr>\r\n                <tr mat-row *matRowDef=\"let row; columns: ['source', 'target', 'targetDevice', 'delete', 'interval', 'resendTransferData', 'resendTo'];\"></tr>\r\n              </table>\r\n            </div>\r\n            <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <div>\r\n                <button mat-button matStepperPrevious>Previous</button>\r\n                <button mat-button matStepperNext [disabled]=\"!hasAllTargetDatapoints()\">Next</button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <mat-step>\r\n          <ng-template matStepLabel><b>Review & Submit</b></ng-template>\r\n          <div style=\"overflow: auto;\">\r\n            <table class=\"review-table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Selected Timeseries</th>\r\n                  <th>Target Timeseries</th>\r\n                  <th>Target Device</th>\r\n                  <th>Delete Current Timeseries</th>\r\n                  <th>Interval (minutes)</th>\r\n                  <th>Resend Data</th>\r\n                  <th>Resend To</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                <tr *ngFor=\"let key of selectedTimeseriesKeys\">\r\n                  <td>{{ key }}</td>\r\n                  <td>{{ targetTimeseriesFormGroup.get(key).value }}</td>\r\n                  <td>{{ targetTimeseriesFormGroup.get(key + '_device').value }}</td>\r\n                  <td>{{ targetTimeseriesFormGroup.get(key + '_delete').value }}</td>\r\n                  <td>{{ targetTimeseriesFormGroup.get(key + '_interval').value }}</td>\r\n                  <td>{{ targetTimeseriesFormGroup.get(key + '_resendData').value }}</td>\r\n                  <td>{{ targetTimeseriesFormGroup.get(key + '_resendData').value === true ? targetTimeseriesFormGroup.get(key + '_resendTo').value : '' }}</td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"margin-top: 16px;\">\r\n            <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n            <div>\r\n              <button mat-button matStepperPrevious>Previous</button>\r\n              <button mat-button type=\"submit\">Transfer Data</button>\r\n            </div>\r\n          </div>\r\n        </mat-step>\r\n      </mat-horizontal-stepper>\r\n    </form>\r\n  </div>\r\n</form>\r\n",
                "customCss": ".transfer-table {\r\n  width: 100%;\r\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\r\n  margin-bottom: 16px;\r\n  table-layout: auto;\r\n}\r\n\r\n.review-table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-bottom: 16px;\r\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\r\n  table-layout: auto;\r\n}\r\n\r\n.review-table th, .review-table td {\r\n  border: 1px solid #ddd;\r\n  padding: 8px;\r\n}\r\n\r\n.review-table th {\r\n  background-color: #f2f2f2;\r\n  text-align: left;\r\n}\r\n",
                "customFunction": "// transfer-data-form.component.ts\r\n\r\nlet $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\r\nlet currentDevice = widgetContext.stateController.getStateParams().selectedDevice.entityName;\r\nconst rxjs = widgetContext.rxjs;\r\nlet timeseries = {};\r\nlet timeseriesKeys = [];\r\nlet startTs;\r\nlet endTs = Math.floor(new Date().getTime());\r\nconsole.log(\"endTs\", endTs);\r\nlet devices;\r\n\r\nfunction getDevicesRecursively(page, acc) {\r\n    let pageLink = widgetContext.pageLink(1000, page, null, null);\r\n    return deviceService.getTenantDevices(pageLink).pipe(\r\n        rxjs.switchMap(response => {\r\n            acc = acc.concat(response.data || []);\r\n            if (response.hasNext) {\r\n                return getDevicesRecursively(page + 1, acc);\r\n            } else {\r\n                return rxjs.of(acc);\r\n            }\r\n        }),\r\n        rxjs.catchError(error => {\r\n            widgetContext.showErrorToast('Failed to fetch devices: ' + error.message, 'top', 'left', 'deviceError');\r\n            return rxjs.throwError(error);\r\n        })\r\n    );\r\n}\r\n\r\ngetDevicesRecursively(0, []).subscribe(dev => {\r\n    devices = dev;\r\n    attributeService.getEntityTimeseriesLatest({ entityType: 'DEVICE', id: deviceID }).subscribe(response => {\r\n        timeseries = response;\r\n        timeseriesKeys = Object.keys(timeseries);\r\n        deviceService.getDevice(deviceID).subscribe(device => {\r\n            startTs = Math.floor(new Date(device.createdTime).getTime());\r\n            console.log(\"startTs 1\", startTs);\r\n            if (startTs === 0) {\r\n                startTs = endTs - 26297460000;\r\n                console.log(\"startTs 2\", startTs);\r\n            }\r\n            if (!currentDevice) {\r\n                currentDevice = device.name;\r\n            }\r\n            openTransferDataForm();\r\n        });\r\n    });\r\n});\r\n\r\nfunction openTransferDataForm() {\r\n    customDialog.customDialog(htmlTemplate, transferDataForm).subscribe();\r\n}\r\n\r\nfunction transferDataForm(instance) {\r\n    let vm = instance;\r\n    vm.timeseriesKeys = timeseriesKeys;\r\n    vm.selectedTimeseriesKeys = [];\r\n    vm.combinedStartTs = startTs;\r\n    vm.combinedEndTs = endTs;\r\n    vm.devices = devices;\r\n    vm.filteredDevices = {};\r\n\r\n    vm.timeseriesFormGroup = vm.fb.group({});\r\n    vm.timeseriesKeys.forEach(key => {\r\n        vm.timeseriesFormGroup.addControl(key, vm.fb.control(false));\r\n    });\r\n\r\n    vm.targetTimeseriesFormGroup = vm.fb.group({});\r\n\r\n    vm.transferDataFormGroup = vm.fb.group({\r\n        timeseriesForm: vm.timeseriesFormGroup,\r\n        targetTimeseriesForm: vm.targetTimeseriesFormGroup\r\n    });\r\n\r\n    vm.timeseriesFormGroup.valueChanges.subscribe(value => {\r\n        vm.selectedTimeseriesKeys = Object.keys(value).filter(key => value[key]);\r\n        \r\n        vm.selectedTimeseriesKeys.forEach(key => {\r\n            if (!vm.targetTimeseriesFormGroup.contains(key)) {\r\n                vm.targetTimeseriesFormGroup.addControl(key, vm.fb.control('', vm.validators.required));\r\n            }\r\n            if (!vm.targetTimeseriesFormGroup.contains(key + '_delete')) {\r\n                vm.targetTimeseriesFormGroup.addControl(key + '_delete', vm.fb.control(false));\r\n            }\r\n            if (!vm.targetTimeseriesFormGroup.contains(key + '_interval')) {\r\n                vm.targetTimeseriesFormGroup.addControl(key + '_interval', vm.fb.control(15, [vm.validators.required, vm.validators.min(1)]));\r\n            }\r\n            if (!vm.targetTimeseriesFormGroup.contains(key + '_device')) {\r\n                vm.targetTimeseriesFormGroup.addControl(key + '_device', vm.fb.control(currentDevice, vm.validators.required));\r\n            }\r\n            if (!vm.targetTimeseriesFormGroup.contains(key + '_resendData')) {\r\n                vm.targetTimeseriesFormGroup.addControl(key + '_resendData', vm.fb.control(false));\r\n            }\r\n            // Add 'resendTo' control only if resendData is checked initially or once it changes\r\n            if (!vm.targetTimeseriesFormGroup.contains(key + '_resendTo')) {\r\n                vm.targetTimeseriesFormGroup.addControl(key + '_resendTo', vm.fb.control('Energy Expert API'));\r\n            }\r\n\r\n            vm.filteredDevices[key] = vm.devices.filter(d => d.name.toLowerCase().includes(currentDevice.toLowerCase()));\r\n        });\r\n\r\n        Object.keys(vm.targetTimeseriesFormGroup.controls).forEach(control => {\r\n            let baseKey = control.replace('_delete', '').replace('_interval', '').replace('_device', '').replace('_resendData', '').replace('_resendTo', '');\r\n            if (!vm.selectedTimeseriesKeys.includes(baseKey)) {\r\n                vm.targetTimeseriesFormGroup.removeControl(control);\r\n            }\r\n        });\r\n    });\r\n\r\n    vm.filterDevices = function(filterValue, key) {\r\n        filterValue = filterValue.toLowerCase();\r\n        vm.filteredDevices[key] = vm.devices.filter(d => d.name.toLowerCase().includes(filterValue));\r\n    };\r\n\r\n    vm.toggleSelectAll = function (checked) {\r\n        Object.keys(vm.timeseriesFormGroup.controls).forEach(key => {\r\n            vm.timeseriesFormGroup.get(key).setValue(checked);\r\n        });\r\n    };\r\n\r\n    vm.hasSelectedTimeseries = function () {\r\n        return Object.values(vm.timeseriesFormGroup.value).some(val => val);\r\n    };\r\n\r\n    vm.hasAllTargetDatapoints = function () {\r\n        return vm.selectedTimeseriesKeys.every(key => {\r\n            return vm.targetTimeseriesFormGroup.get(key).valid &&\r\n                   vm.targetTimeseriesFormGroup.get(key + '_delete') !== null &&\r\n                   vm.targetTimeseriesFormGroup.get(key + '_interval').valid &&\r\n                   vm.targetTimeseriesFormGroup.get(key + '_device').valid &&\r\n                   vm.targetTimeseriesFormGroup.get(key + '_resendData') !== null &&\r\n                   // resendTo is only required if resendData is checked\r\n                   (vm.targetTimeseriesFormGroup.get(key + '_resendData').value ? vm.targetTimeseriesFormGroup.get(key + '_resendTo').valid : true);\r\n        });\r\n    };\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.transferData = function () {\r\n        const targetTimeseries = {};\r\n        const deleteCurrent = {};\r\n        const intervals = {};\r\n        const targetDevices = {};\r\n        const resendDataFlags = {};\r\n        const resendToValues = {};\r\n\r\n        vm.selectedTimeseriesKeys.forEach(key => {\r\n            targetTimeseries[key] = vm.targetTimeseriesFormGroup.get(key).value;\r\n            deleteCurrent[key] = vm.targetTimeseriesFormGroup.get(key + '_delete').value;\r\n            intervals[key] = vm.targetTimeseriesFormGroup.get(key + '_interval').value;\r\n            targetDevices[key] = vm.targetTimeseriesFormGroup.get(key + '_device').value;\r\n            resendDataFlags[key] = vm.targetTimeseriesFormGroup.get(key + '_resendData').value;\r\n            resendToValues[key] = vm.targetTimeseriesFormGroup.get(key + '_resendTo').value;\r\n        });\r\n\r\n        const transferDataArray = vm.selectedTimeseriesKeys.map(key => {\r\n            let dataPoint = {\r\n                currentTimeserie: key,\r\n                targetTimeseries: targetTimeseries[key],\r\n                deleteCurrent: deleteCurrent[key],\r\n                interval: intervals[key],\r\n                targetDevice: targetDevices[key]\r\n            };\r\n            if (resendDataFlags[key]) {\r\n                dataPoint.resendTransferData = true;\r\n                dataPoint.resendTo = resendToValues[key];\r\n            }\r\n            return dataPoint;\r\n        });\r\n\r\n        const calls = [];\r\n\r\n        const datapointChunks = {};\r\n        transferDataArray.forEach(dataPoint => {\r\n            const intervalMs = dataPoint.interval * 60 * 1000 * 1000;\r\n            let count = 0;\r\n            for (let chunkStart = vm.combinedStartTs; chunkStart < vm.combinedEndTs; chunkStart += intervalMs) {\r\n                count++;\r\n            }\r\n            datapointChunks[dataPoint.currentTimeserie] = count;\r\n            console.log('Number of chunks for', dataPoint.currentTimeserie, ':', count);\r\n        });\r\n\r\n        transferDataArray.forEach(dataPoint => {\r\n            const intervalMs = dataPoint.interval * 60 * 1000 * 1000;\r\n            let chunkIndex = 0;\r\n            const totalChunks = datapointChunks[dataPoint.currentTimeserie];\r\n            \r\n            for (let chunkStart = vm.combinedStartTs; chunkStart < vm.combinedEndTs; chunkStart += intervalMs) {\r\n                const chunkEnd = Math.min(chunkStart + intervalMs, vm.combinedEndTs);\r\n                chunkIndex++;\r\n                console.log(\"ChunkEnd\", chunkEnd);\r\n                const isLastChunk = (chunkIndex === totalChunks);\r\n                const adjustedDeleteCurrent = dataPoint.deleteCurrent && isLastChunk ? true : false;\r\n\r\n                const chunkDataPoint = {\r\n                    currentTimeserie: dataPoint.currentTimeserie,\r\n                    targetTimeseries: dataPoint.targetTimeseries,\r\n                    deleteCurrent: adjustedDeleteCurrent,\r\n                    interval: dataPoint.interval,\r\n                    targetDevice: dataPoint.targetDevice\r\n                };\r\n\r\n                if (dataPoint.resendTransferData) {\r\n                    chunkDataPoint.resendTransferData = true;\r\n                    chunkDataPoint.resendTo = dataPoint.resendTo;\r\n                }\r\n\r\n                const singleTransferData = {\r\n                    startTs: chunkStart,\r\n                    endTs: chunkEnd,\r\n                    transferData: [chunkDataPoint]\r\n                };\r\n\r\n                if (isLastChunk) {\r\n                    console.log('Last chunk attribute for', dataPoint.currentTimeserie, ':', singleTransferData);\r\n                }\r\n\r\n                const call$ = attributeService.saveEntityAttributes(\r\n                    { entityType: 'DEVICE', id: deviceID },\r\n                    'SERVER_SCOPE',\r\n                    [{\r\n                        key: \"transferData\",\r\n                        value: singleTransferData\r\n                    }]\r\n                );\r\n                calls.push(call$);\r\n            }\r\n        });\r\n\r\n        if (calls.length === 0) {\r\n            vm.dialogRef.close(null);\r\n            return;\r\n        }\r\n\r\n        let subscription;\r\n        function executeNext(index) {\r\n            if (index >= calls.length) {\r\n                vm.dialogRef.close(null);\r\n                return;\r\n            }\r\n            subscription = calls[index].subscribe(\r\n                () => executeNext(index + 1),\r\n                error => {\r\n                    console.error('Failed to save Attribute config:', error);\r\n                    vm.dialogRef.close(null);\r\n                }\r\n            );\r\n        }\r\n        executeNext(0);\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b40e179c-f050-249e-be09-8019cf22101b"
              },
              {
                "name": "trigger-ee-api",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\r\n\r\n\r\nattributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            [{\r\n                key: \"cfgAttributesCreated\",\r\n                value: false\r\n            }]\r\n        ).subscribe(\r\n            () => {\r\n                console.log('Attribute saved successfully.');\r\n                alert(\"Config created successfully!\");\r\n            },\r\n            error => {\r\n                console.error('Failed to save Attribute config:', error);\r\n                alert(\"Failed to create config!\");\r\n            }\r\n        );\r\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "25aa5b95-f940-d160-1d33-871d70865dc4"
              },
              {
                "name": "set-lora-device-config",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\"\n      (ngSubmit)=\"save()\" class=\"edit-entity-form\">\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>Edit Device Configuration</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <div mat-dialog-content fxLayout=\"column\">\n        <!-- General Info Box -->\n        <div class=\"import-info-section\" style=\"margin-bottom: 8px;\">\n            <div class=\"import-info-header\">General</div>\n            <div class=\"import-info-text\">For {{ deviceProfileName }} devices the listed configuration options can be applied via downlink. To exclude a command from being sent down to the device the input field needs to be empty or the dropdown set to \"no change\".</div>\n        </div>\n\n        <!-- Dynamic Dropdowns for Downlink Keys -->\n        <div *ngIf=\"noConfigurationsMessage; else downlinkFields\">\n            <p>{{ noConfigurationsMessage }}</p>\n        </div>\n        <ng-template #downlinkFields>\n            <div *ngFor=\"let key of sortedKeys\">\n                <ng-container *ngIf=\"downlinkOptions[key].type === 'dropdown'; else inputField\">\n                    <mat-form-field fxFlex class=\"mat-block\">\n                        <mat-label>{{ key }}</mat-label>\n                        <mat-select [formControlName]=\"key\" (selectionChange)=\"onDropdownChange(key, $event.value)\">\n                            <mat-option *ngFor=\"let option of downlinkOptions[key].options\" [value]=\"option\">{{ option }}</mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </ng-container>\n                <ng-template #inputField>\n                    <mat-form-field fxFlex class=\"mat-block\">\n                        <mat-label>{{ key }}</mat-label>\n                        <input matInput type=\"number\" [formControlName]=\"key\" placeholder=\"Enter value\" />\n                    </mat-form-field>\n                </ng-template>\n                <div *ngIf=\"downlinkOptions[key].info\" class=\"import-info-section\" style=\"margin-top: 4px; margin-bottom: 16px;\">\n                    <div class=\"import-info-header\">{{ key }}</div>\n                    <div class=\"import-info-text\" [innerHTML]=\"downlinkOptions[key].info.split(' ').join('<br/>')\"></div>\n                </div>\n            </div>\n        </ng-template>\n    </div>\n\n    <mat-dialog-actions align=\"end\">\n        <button mat-button color=\"warn\" type=\"button\" (click)=\"cancel()\">\n            Cancel\n        </button>\n        <button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"editEntityFormGroup.invalid\">\n            Save\n        </button>\n    </mat-dialog-actions>\n</form>",
                "customCss": ".import-info-section {\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: 12px 16px;\r\n    background-color: rgba(0, 0, 0, 0.04);\r\n    border-radius: 4px;\r\n}\r\n\r\n.import-info-header,\r\n.import-info-text {\r\n    font-size: 14px;\r\n    line-height: 20px;\r\n    letter-spacing: 0.2px;\r\n    color: rgba(0, 0, 0, 0.54);\r\n}\r\n\r\n.import-info-header {\r\n    font-weight: 700;\r\n}\r\n\r\n.delim-value {\r\n    color: rgba(0, 0, 0, 0.87);\r\n    font-weight: 700;\r\n}\r\n\r\n.example-content {\r\n    padding: 12px;\r\n    border: 1px solid rgba(0, 0, 0, 0.12);\r\n    border-radius: 6px;\r\n    background-color: rgba(255, 255, 255, 0.08);\r\n}\r\n\r\n.example-content .import-info-text {\r\n    font-size: 10px;\r\n    color: rgba(0, 0, 0, 0.38);\r\n}\r\n\r\n\r\nbutton.selected {\r\n    background-color: var(--tb-primary-500) !important;\r\n    color: var(--tb-primary-contrast-500) !important;\r\n}\r\n\r\nbutton.selected mat-icon.tb-mat-18 {\r\n    color: var(--tb-primary-contrast-500) !important;\r\n}\r\n\r\nbutton mat-icon.tb-mat-18 {\r\n    font-size: 18px;\r\n    margin-right: 4px;\r\n}\r\n.warning-message {\r\n    color: #d86f1d; /* Slightly darker orange for text */\r\n    background-color: #fff3cd; /* Light yellow background */\r\n    border: 1px solid #ffeeba; /* Light yellow border */\r\n    border-radius: 5px; /* Rounded corners */\r\n    padding: 10px; /* Padding for better spacing */\r\n    margin-top: 12px; /* Spacing above the warning */\r\n    font-weight: bold; /* Bold font */\r\n    font-size: 1rem; /* Font size for readability */\r\n    display: flex; /* Flexbox for better layout */\r\n    align-items: center; /* Center vertically */\r\n}\r\n\r\n.warning-message::before {\r\n    content: \"\"; /* Warning icon */\r\n    margin-right: 8px; /* Space between icon and text */\r\n}\r\n\r\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet deviceProfileService = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\n\nlet deviceID = entityId; // Assuming the device ID comes from entityId\nlet deviceProfileId = null; // Store the deviceProfileId\nlet deviceProfileName = null;\n\n// Function to handle sequential entity info, device info, and device profile info retrieval\nfunction getEntityInfo() {\n    attributeService.getEntityAttributes(deviceID, 'SERVER_SCOPE').subscribe(\n        (attributes) => {\n            deviceService.getDevice(deviceID.id).subscribe(\n                (deviceInfo) => {\n                    deviceProfileId = deviceInfo.deviceProfileId.id;\n                    deviceProfileService.getDeviceProfile(deviceProfileId).subscribe(\n                        (deviceProfile) => {\n                            deviceProfileName = deviceProfile.name;\n                            let descriptionString = deviceProfile.description;\n                            if (!descriptionString) {\n                                console.warn(\"Description is empty or undefined.\");\n                                openNoConfigDialog();\n                                return;\n                            }\n\n                            let description = null;\n                            try {\n                                description = JSON.parse(descriptionString);\n                            } catch (e) {\n                                console.error(\"Failed to parse device profile description:\", e);\n                                widgetContext.showErrorToast(\"Failed to parse device profile description.\", 'top', 'left', 'dataParseError');\n                                return;\n                            }\n\n                            openEditEntityDialog(attributes, description);\n                        },\n                        (error) => {\n                            console.error(\"Error fetching device profile information:\", error);\n                            widgetContext.showErrorToast(\"Error fetching device profile information.\", 'top', 'left', 'dataFetchError');\n                        }\n                    );\n                },\n                (error) => {\n                    console.error(\"Error fetching device information:\", error);\n                    widgetContext.showErrorToast(\"Error fetching device information.\", 'top', 'left', 'dataFetchError');\n                }\n            );\n        },\n        (error) => {\n            console.error(\"Error fetching entity attributes:\", error);\n            widgetContext.showErrorToast(\"Error fetching entity attributes.\", 'top', 'left', 'dataFetchError');\n        }\n    );\n}\n\n// Opens the custom dialog after ensuring all necessary data is retrieved\nfunction openEditEntityDialog(attributes, description) {\n    customDialog.customDialog(htmlTemplate, (instance) => new EditEntityDialogController(instance, attributes, description)).subscribe();\n}\n\n// Handle the scenario where configuration is not available\nfunction openNoConfigDialog() {\n    console.warn(\"For this device type, there are no device configurations available.\");\n    alert(\"For this device type, there are no device configurations available.\");\n}\n\nfunction EditEntityDialogController(instance, attributes, description) {\n    let vm = instance;\n\n    // Assign deviceProfileName to vm\n    vm.deviceProfileName = deviceProfileName;\n\n    vm.editEntityFormGroup = vm.fb.group({});\n    vm.downlinkOptions = {};\n    vm.fPort = null;\n\n    if (!description || !description.Lorawan || !description.Lorawan.downlink) {\n        vm.noConfigurationsMessage = \"For this device type, there are no device configurations available.\";\n        return;\n    }\n\n    let downlink = description.Lorawan.downlink;\n    const keys = Object.keys(downlink).filter(key => key !== 'fPort' && key !== 'info');\n\n    if (keys.length === 0) {\n        vm.noConfigurationsMessage = \"For this device type, there are no device configurations available.\";\n    } else {\n        // Sort the keys alphabetically to ensure consistent ordering\n        vm.sortedKeys = keys.sort();\n\n        console.log('Sorted Keys:', vm.sortedKeys);\n        vm.sortedKeys.forEach(key => {\n            if (downlink[key].Input) {\n                // Create an input field for keys with 'Input'\n                vm.downlinkOptions[key] = {\n                    type: 'input',\n                    base: downlink[key].Input,\n                    length: parseInt(downlink[key].length, 10),\n                    info: downlink[key].info || null\n                };\n\n                let attribute = attributes.find(attr => attr.key === key);\n                if (attribute) {\n                    vm.editEntityFormGroup.addControl(key, vm.fb.control(attribute.value)); // Set default value from attributes\n                } else {\n                    vm.editEntityFormGroup.addControl(key, vm.fb.control('')); // Add control to form group\n                }\n            } else {\n                // Create a dropdown for other keys\n                let options = Object.keys(downlink[key]).filter(optionKey => optionKey !== 'default' && optionKey !== 'info');\n                if (!options.includes('no change')) {\n                    options.push('no change');\n                }\n\n                vm.downlinkOptions[key] = {\n                    type: 'dropdown',\n                    options: options,\n                    values: downlink[key],\n                    selected: [''],\n                    info: downlink[key].info || null\n                };\n\n                let attribute = attributes.find(attr => attr.key === key);\n                if (attribute) {\n                    vm.downlinkOptions[key].selected = attribute.value;\n                    vm.editEntityFormGroup.addControl(key, vm.fb.control(attribute.value));\n                } else {\n                    vm.editEntityFormGroup.addControl(key, vm.fb.control(''));\n                }\n\n                if (downlink.fPort) {\n                    vm.fPort = downlink.fPort;\n                }\n            }\n        });\n    }\n\n    // Function to handle dropdown change and apply adaptive filtering\n     vm.onDropdownChange = (key, value) => {\n        if (key === 'EcoMode' && value === 'no change' && deviceProfileName === \"Wassergeraete VoluMess VI-E\") {\n            let attribute = attributes.find(attr => attr.key === 'EcoMode');\n            console.log(\"Attribute Eco:\",attribute);\n            if (attribute && attribute.value === 'Enable EcoMode, 6 years' && downlink['sendingInterval']) {\n                let sendingIntervalOptions = Object.keys(downlink['sendingInterval']).filter(optionKey => optionKey !== 'default' && optionKey !== 'info');\n                if (!sendingIntervalOptions.includes('15min')) {\n                    sendingIntervalOptions.push('15min');\n                }\n                if (vm.downlinkOptions['sendingInterval']) {\n                    console.log(\"sendingIntervalOptions:\",sendingIntervalOptions);\n                    vm.downlinkOptions['sendingInterval'].options = sendingIntervalOptions;\n                }\n            }\n        }\n        else if (key === 'EcoMode' && deviceProfileName === \"Wassergeraete VoluMess VI-E\") {\n            if (downlink['sendingInterval']) {\n                let sendingIntervalOptions = Object.keys(downlink['sendingInterval']).filter(optionKey => optionKey !== 'default' && optionKey !== 'info');\n                if (value === 'Enable EcoMode, 6 years') {\n                    // Allow 15min option\n                    if (!sendingIntervalOptions.includes('15min')) {\n                        sendingIntervalOptions.push('15min');\n                    }\n                } else {\n                    // Remove 15min option if it exists\n                    sendingIntervalOptions = sendingIntervalOptions.filter(option => option !== '15min');\n                }\n                if (vm.downlinkOptions['sendingInterval']) {\n                    vm.downlinkOptions['sendingInterval'].options = sendingIntervalOptions;\n                }\n            }\n        }\n    };\n\n    vm.cancel = () => vm.dialogRef.close(null);\n\n    vm.save = () => {\n        vm.editEntityFormGroup.markAsPristine();\n\n        let downlinkArray = [];\n        let savedAttributes = [];\n        // Iterate over sorted keys to maintain consistent order\n        vm.sortedKeys.forEach(key => {\n            let control = vm.editEntityFormGroup.get(key);\n            if (!control) return;\n            let value = control.value;\n\n            if (vm.downlinkOptions[key].type === 'input') {\n                // Handle input fields\n                let base = vm.downlinkOptions[key].base;\n                let length = vm.downlinkOptions[key].length;\n                let hexValue = parseInt(value, 10).toString(16).padStart(length * 2, '0');\n                // Swap the bytes of the hex value\n                let swappedHexValue = hexValue.match(/../g).reverse().join('');\n                let finalCode = base + swappedHexValue;\n                downlinkArray.push({\n                    code: finalCode,\n                    fPort: vm.fPort\n                });\n                savedAttributes.push({\n                    key: key,\n                    value: value // Save the user input as a decimal value\n                });\n            } else if (value !== 'no change') {\n                // Handle dropdown fields\n                let selectedOption = value;\n                if (selectedOption) {\n                    let correspondingCode = vm.downlinkOptions[key].values[selectedOption];\n                    downlinkArray.push({\n                        code: correspondingCode,\n                        fPort: vm.fPort\n                    });\n                    savedAttributes.push({\n                        key: key,\n                        value: selectedOption\n                    });\n                }\n            }\n        });\n\n        console.log('Downlink Array:', downlinkArray);\n        attributeService.saveEntityAttributes(deviceID, 'SERVER_SCOPE', [\n            { key: 'downlink', value: JSON.stringify(downlinkArray) },\n            ...savedAttributes\n        ])\n        .subscribe(\n            (response) => {\n                console.log(\"Device configurations saved successfully:\", response);\n                vm.dialogRef.close(null);\n            },\n            (error) => {\n                console.error(\"Failed to save device configurations:\", error);\n                widgetContext.showErrorToast(\"Failed to save device configurations.\", 'top', 'left', 'importError');\n            }\n        );\n    };\n}\n\ngetEntityInfo();\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c40b4190-3218-7de2-88f3-1f73cc6e837e"
              },
              {
                "name": "get-historical-data-fronius",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"dateForm\" style=\"width: 400px;\">\r\n  <mat-toolbar color=\"primary\">\r\n    <span>Fronius API Trigger</span>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\"><mat-icon>close</mat-icon></button>\r\n  </mat-toolbar>\r\n  <mat-dialog-content style=\"padding: 16px;\">\r\n    <mat-form-field appearance=\"fill\" style=\"width: 100%;\">\r\n      <mat-label>Date From</mat-label>\r\n      <input matInput [matDatepicker]=\"fromPicker\" formControlName=\"startDate\">\r\n      <mat-datepicker-toggle matSuffix [for]=\"fromPicker\"></mat-datepicker-toggle>\r\n      <mat-datepicker #fromPicker></mat-datepicker>\r\n    </mat-form-field>\r\n\r\n    <mat-form-field appearance=\"fill\" style=\"width: 100%; margin-top: 12px;\">\r\n      <mat-label>Date To</mat-label>\r\n      <input matInput [matDatepicker]=\"toPicker\" formControlName=\"endDate\">\r\n      <mat-datepicker-toggle matSuffix [for]=\"toPicker\"></mat-datepicker-toggle>\r\n      <mat-datepicker #toPicker></mat-datepicker>\r\n    </mat-form-field>\r\n  </mat-dialog-content>\r\n  <mat-dialog-actions align=\"end\" style=\"padding: 8px 16px;\">\r\n    <button mat-button (click)=\"cancel()\">Cancel</button>\r\n    <button mat-button color=\"primary\" [disabled]=\"!dateForm.valid\" (click)=\"save()\">Confirm</button>\r\n  </mat-dialog-actions>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\r\n\r\ncustomDialog.customDialog(htmlTemplate, selectDateController).subscribe();\r\n\r\nfunction selectDateController(instance) {\r\n    let vm = instance;\r\n    vm.dateForm = vm.fb.group({\r\n        startDate: [null, vm.validators.required],\r\n        endDate: [null, vm.validators.required]\r\n    });\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close();\r\n    };\r\n\r\n    vm.save = function () {\r\n        let start = new Date(vm.dateForm.get('startDate').value);\r\n        let end = new Date(vm.dateForm.get('endDate').value);\r\n\r\n        let startIso = start.toISOString().split('.')[0] + 'Z';\r\n        let endIso = end.toISOString().split('.')[0] + 'Z';\r\n\r\n        let payload = {\r\n            startDate: startIso,\r\n            endDate: endIso\r\n        };\r\n\r\n        let saveAttributes = [\r\n            {\r\n                key: 'froniusApiManual',\r\n                value: payload\r\n            },\r\n            {\r\n                key: 'apiCall',\r\n                value: 'getFroniusData'\r\n            }\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            saveAttributes\r\n        ).subscribe(() => {\r\n            vm.dialogRef.close();\r\n        }, error => {\r\n            console.error('Fehler beim Speichern der Attribute:', error);\r\n        });\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fbbbe3d8-7c1e-97c0-a38e-275b2d799e98"
              },
              {
                "name": "deviceTransfer-config",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #transferDeviceForm=\"ngForm\" [formGroup]=\"transferDeviceFormGroup\" (ngSubmit)=\"save()\" style=\"width: 800px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Transfer Device</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <div class=\"form-field-container\" style=\"padding: 20px;\">\r\n    <mat-form-field appearance=\"fill\" class=\"full-width\">\r\n      <mat-label>Customer</mat-label>\r\n      <mat-select formControlName=\"customer\" (selectionChange)=\"onCustomerSelected($event)\">\r\n        <mat-option *ngFor=\"let customer of customers\" [value]=\"customer\">\r\n          {{ customer.title || customer.name }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n\r\n    <mat-form-field *ngIf=\"transferDeviceFormGroup.get('customer').value\" appearance=\"fill\" class=\"full-width\">\r\n      <mat-label>Location</mat-label>\r\n      <mat-select formControlName=\"location\">\r\n        <mat-option *ngFor=\"let location of locations\" [value]=\"location\">\r\n          {{ location.name }}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n    <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"transferDeviceFormGroup.invalid\">\r\n      Save\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/* Ensure all form fields take full width within the container */\r\n  .full-width {\r\n    width: 100%;\r\n  }\r\n  /* Optionally set a fixed height (if needed) for mat-form-field elements */\r\n  .mat-form-field {\r\n    height: 56px;\r\n  }\r\n  /* Add some margin between the dropdown fields */\r\n  .form-field-container > mat-form-field {\r\n    margin-bottom: 20px;\r\n  }",
                "customFunction": "let injector = widgetContext.$scope.$injector;\r\nlet customDialog = injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet dialogs = injector.get(widgetContext.servicesMap.get('dialogs'));\r\nlet assetService = injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet entityRelationService = injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet entityGroupService = injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet customerService = injector.get(widgetContext.servicesMap.get('customerService'));\r\nlet attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\nlet device = entityId;\r\n/*console.log(\"Initial device reference:\", device);*/\r\n\r\nlet customerId;\r\nif (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n  customerId = widgetContext.stateController.getStateParams().entityId;\r\n} else {\r\n  customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER' };\r\n}\r\n\r\nlet customers = [];\r\nlet customersLoaded = false;\r\n\r\nfunction checkAndOpenDialog() {\r\n  if (customersLoaded) {\r\n    openTransferDeviceDialog(customers);\r\n  }\r\n}\r\n\r\nconst pageLink = widgetContext.pageLink(100, 0, null, null);\r\ncustomerService.getUserCustomers(pageLink).subscribe(customersPage => {\r\n/*  console.log(\"customers:\", customersPage);*/\r\n  customers = customersPage.data.sort((a, b) => {\r\n    let nameA = (a.title || a.name || \"\").toUpperCase();\r\n    let nameB = (b.title || b.name || \"\").toUpperCase();\r\n    return nameA.localeCompare(nameB);\r\n  });\r\n  customersLoaded = true;\r\n  checkAndOpenDialog();\r\n}, error => {\r\n  console.error(\"Error fetching customers via customerService:\", error);\r\n  alert('Failed to fetch customers.');\r\n});\r\n\r\nfunction openTransferDeviceDialog(customers) {\r\n  customDialog.customDialog(htmlTemplate, TransferDeviceDialogController, {\r\n    customers: customers,\r\n    device: device\r\n  }).subscribe();\r\n}\r\n\r\nfunction getOrCreateGroupByName(owner, groupName) {\r\n  return entityGroupService.getEntityGroupsByOwnerId(owner.entityType, owner.id, 'DEVICE').pipe(\r\n    widgetContext.rxjs.switchMap(groups => {\r\n      let group = groups.find(g => g.name === groupName);\r\n      if (group) {\r\n        return widgetContext.rxjs.of(group);\r\n      } else {\r\n        let newGroup = { type: 'DEVICE', name: groupName, ownerId: owner };\r\n        return entityGroupService.saveEntityGroup(newGroup);\r\n      }\r\n    })\r\n  );\r\n}\r\n\r\nfunction TransferDeviceDialogController(instance) {\r\n  let vm = instance;\r\n  let data = vm.data || {};\r\n  vm.customers = data.customers || [];\r\n  \r\n  vm.transferDeviceFormGroup = vm.fb.group({\r\n    customer: ['', [vm.validators.required]],\r\n    location: ['']\r\n  });\r\n\r\n  vm.locations = [];\r\n  \r\n  vm.onCustomerSelected = function (event) {\r\n    let selectedCustomer = event.value;\r\n    vm.locations = [];\r\n    vm.transferDeviceFormGroup.get('location').setValue('');\r\n    if (selectedCustomer && selectedCustomer.id) {\r\n      let selectedCustomerId = selectedCustomer.id.id ? selectedCustomer.id.id : selectedCustomer.id;\r\n      let locationSearchQuery = { \r\n        parameters: {\r\n          rootId: selectedCustomerId,\r\n          rootType: 'CUSTOMER',\r\n          direction: 'FROM',\r\n          relationTypeGroup: 'COMMON',\r\n          maxLevel: 10,\r\n          fetchLastLevelOnly: false\r\n        },\r\n        relationType: 'Contains',\r\n        assetTypes: ['Location']\r\n      };\r\n      assetService.findByQuery(locationSearchQuery).subscribe(\r\n        locations => {\r\n          vm.locations = locations || [];\r\n        },\r\n        err => { console.error(\"Error fetching locations:\", err); }\r\n      );\r\n    }\r\n  };\r\n\r\n  if (data.device && data.device.id) {\r\n    attributeService.getEntityAttributes(data.device, 'SERVER_SCOPE', ['customer','location']).subscribe(\r\n      attrsArray => {\r\n        let attrs = {};\r\n        attrsArray.forEach(attr => {\r\n          attrs[attr.key] = attr.value;\r\n        });\r\n/*        console.log(\"Prefill - fetched device attributes:\", attrs);*/\r\n        let prefillCustomer = vm.customers.find(c => (c.title || c.name) === attrs.customer);\r\n        if (prefillCustomer) {\r\n          vm.transferDeviceFormGroup.patchValue({ customer: prefillCustomer });\r\n          vm.onCustomerSelected({ value: prefillCustomer });\r\n          setTimeout(() => {\r\n            let prefillLocation = vm.locations.find(l => l.name === attrs.location);\r\n            if (prefillLocation) {\r\n              vm.transferDeviceFormGroup.patchValue({ location: prefillLocation });\r\n            }\r\n          }, 1000);\r\n        }\r\n      },\r\n      err => {\r\n        console.error(\"Error fetching device attributes for prefill:\", err);\r\n      }\r\n    );\r\n  }\r\n\r\n  vm.save = function () {\r\n    let formValue = vm.transferDeviceFormGroup.value;\r\n    let selectedCustomer = formValue.customer;\r\n    if (!selectedCustomer || !selectedCustomer.id) {\r\n      console.warn('No customer selected.');\r\n      return;\r\n    }\r\n    let deviceId = data.device.id ? data.device.id : data.device;\r\n    deviceService.getDevice(deviceId).pipe(\r\n      widgetContext.rxjs.switchMap(fetchedDevice => {\r\n        let deviceEntity = fetchedDevice.id && fetchedDevice.id.entityType \r\n            ? fetchedDevice.id \r\n            : { id: fetchedDevice.id, entityType: 'DEVICE' };\r\n        let attributes = [];\r\n        attributes.push({ key: 'customer', value: selectedCustomer.title || selectedCustomer.name || '' });\r\n        if (formValue.location && formValue.location.name) {\r\n          attributes.push({ key: 'location', value: formValue.location.name });\r\n        } else {\r\n          attributes.push({ key: 'location', value: \"\" });\r\n        }\r\n        /*console.log(\"Saving attributes on device\", deviceEntity, \":\", attributes);*/\r\n        return attributeService.saveEntityAttributes(deviceEntity, 'SERVER_SCOPE', attributes).pipe(\r\n          widgetContext.rxjs.switchMap(() => {\r\n            return deviceService.getDevice(deviceEntity.id).pipe(\r\n              widgetContext.rxjs.switchMap(fetchedDevice2 => {\r\n/*                  console.log(\"fetched\", fetchedDevice2);\r\n                  console.log(\"fetchedtype\", fetchedDevice2.type);*/\r\n                let groupName = null;\r\n                if (fetchedDevice2.type === \"Beckhoff Gateway\" || fetchedDevice2.type === \"Wago Gateway\") {\r\n                  groupName = \"Gateway\";\r\n                } else if (fetchedDevice2.type === \"Gateway\") {\r\n                  groupName = \"LoRaWAN Gateways\";\r\n                }\r\n                if (groupName) {\r\n                  return getOrCreateGroupByName(fetchedDevice2.ownerId, groupName).pipe(\r\n                    widgetContext.rxjs.switchMap(group => {\r\n                      let groupId = group.id.id ? group.id.id : group.id;\r\n/*                      console.log(\"groupid\",group.id);\r\n                      console.log(\"deviceentity\",deviceEntity);*/\r\n                      return entityGroupService.addEntityToEntityGroup(groupId, deviceEntity.id);\r\n                    })\r\n                  );\r\n                } else {\r\n                  return widgetContext.rxjs.of(null);\r\n                }\r\n              })\r\n            );\r\n          })\r\n        );\r\n      })\r\n    ).subscribe(\r\n      () => {\r\n/*        console.log(\"Attributes updated and group assignment completed successfully.\");*/\r\n        widgetContext.updateAliases();\r\n        vm.dialogRef.close(formValue);\r\n      },\r\n      err => {\r\n        console.error('Error updating attributes or group:', err);\r\n      }\r\n    );\r\n  };\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b126068e-22ea-8a18-e19c-d0bee388d381"
              }
            ]
          },
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleIcon": "devices_other"
        },
        "row": 0,
        "col": 0,
        "id": "0d288b70-1157-70e5-088c-b59978a4781e"
      },
      "1d2b8d63-39b8-d2c0-1a37-e8fc7dc23353": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "H_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "H_C_Energy_Heating",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.44646303431475975,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "H_C_Volume",
                  "type": "timeseries",
                  "label": "H_C_Volume",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.7469421459012264
                },
                {
                  "name": "H_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "H_M_Energy_Heating",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.3087481061771207
                },
                {
                  "name": "H_M_Volume",
                  "type": "timeseries",
                  "label": "H_M_Volume",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7435591512826998
                },
                {
                  "name": "H_S_Power",
                  "type": "timeseries",
                  "label": "H_S_Power",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.401209544343448
                },
                {
                  "name": "H_S_TemperatureDifference",
                  "type": "timeseries",
                  "label": "H_S_TemperatureDifference",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.172549838549648
                },
                {
                  "name": "H_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "H_S_TemperatureFlow",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.4460888172822588
                },
                {
                  "name": "H_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "H_S_TemperatureReturn",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.9164088613019024
                },
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "status_battery_level",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.5846619666681463
                },
                {
                  "name": "status_margin",
                  "type": "timeseries",
                  "label": "status_margin",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.29374494591192946
                },
                {
                  "name": "CHC_C_Energy_Cooling",
                  "type": "timeseries",
                  "label": "CHC_C_Energy_Cooling",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.05375861965992779
                },
                {
                  "name": "CHC_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "CHC_C_Energy_Heating",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.9564136311307836
                },
                {
                  "name": "CHC_C_Volume",
                  "type": "timeseries",
                  "label": "CHC_C_Volume",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.5575905403432393
                },
                {
                  "name": "CHC_M_Volume",
                  "type": "timeseries",
                  "label": "CHC_M_Volume",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.9263771284876636
                },
                {
                  "name": "CHC_S_TemperatureDifference",
                  "type": "timeseries",
                  "label": "CHC_S_TemperatureDifference",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.8375856531592898
                },
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "CHC_S_TemperatureFlow",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.5304593725727262
                },
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "CHC_S_TemperatureReturn",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.304118765741342
                },
                {
                  "name": "CHC_M_Energy_Cooling",
                  "type": "timeseries",
                  "label": "CHC_M_Energy_Cooling",
                  "color": "#ff5722",
                  "settings": {},
                  "_hash": 0.8729238246883848
                },
                {
                  "name": "CHC_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "CHC_M_Energy_Heating",
                  "color": "#9e9e9e",
                  "settings": {},
                  "_hash": 0.9742004612563011
                },
                {
                  "name": "W_C_Volume",
                  "type": "timeseries",
                  "label": "W_C_Volume",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.6311427601645789
                },
                {
                  "name": "W_M_Volume",
                  "type": "timeseries",
                  "label": "W_M_Volume",
                  "color": "#00c853",
                  "settings": {},
                  "_hash": 0.14385465119074103
                },
                {
                  "name": "G_M_Volume",
                  "type": "timeseries",
                  "label": "G_M_Volume",
                  "color": "#d50000",
                  "settings": {},
                  "_hash": 0.16251568289715435
                },
                {
                  "name": "G_C_Volume",
                  "type": "timeseries",
                  "label": "G_C_Volume",
                  "color": "#ffab00",
                  "settings": {},
                  "_hash": 0.1056050316015964
                },
                {
                  "name": "E_C_ActiveEnergyTotal",
                  "type": "timeseries",
                  "label": "E_C_ActiveEnergyTotal",
                  "color": "#455a64",
                  "settings": {},
                  "_hash": 0.21220136212048124
                },
                {
                  "name": "E_M_ActiveEnergyTotal",
                  "type": "timeseries",
                  "label": "E_M_ActiveEnergyTotal",
                  "color": "#aa00ff",
                  "settings": {},
                  "_hash": 0.5559224574012667
                },
                {
                  "name": "E_S_ActivePowerTotal",
                  "type": "timeseries",
                  "label": "E_S_ActivePowerTotal",
                  "color": "#64dd17",
                  "settings": {},
                  "_hash": 0.11213024180135522
                },
                {
                  "name": "E_S_ApparentPowerTotal",
                  "type": "timeseries",
                  "label": "E_S_ApparentPowerTotal",
                  "color": "#304ffe",
                  "settings": {},
                  "_hash": 0.08364993685633282
                },
                {
                  "name": "E_S_Frequency",
                  "type": "timeseries",
                  "label": "E_S_Frequency",
                  "color": "#c51162",
                  "settings": {},
                  "_hash": 0.6447714179835056
                },
                {
                  "name": "E_S_Voltage",
                  "type": "timeseries",
                  "label": "E_S_Voltage",
                  "color": "#ffd600",
                  "settings": {},
                  "_hash": 0.13990606659405191
                },
                {
                  "name": "E_S_Current",
                  "type": "timeseries",
                  "label": "E_S_Current",
                  "color": "#0091ea",
                  "settings": {},
                  "_hash": 0.031642993074240344
                },
                {
                  "name": "E_S_ReactivePowerTotal",
                  "type": "timeseries",
                  "label": "E_S_ReactivePowerTotal",
                  "color": "#ff6d00",
                  "settings": {},
                  "_hash": 0.4613373576172557
                },
                {
                  "name": "E_S_CurrentTotal",
                  "type": "timeseries",
                  "label": "E_S_CurrentTotal",
                  "color": "#6200ea",
                  "settings": {},
                  "_hash": 0.8615908672176291
                },
                {
                  "name": "energy",
                  "type": "timeseries",
                  "label": "energy",
                  "color": "#aeea00",
                  "settings": {},
                  "_hash": 0.5723778270403515
                },
                {
                  "name": "power",
                  "type": "timeseries",
                  "label": "power",
                  "color": "#00bfa5",
                  "settings": {},
                  "_hash": 0.6667908302707168
                },
                {
                  "name": "volume",
                  "type": "timeseries",
                  "label": "volume",
                  "color": "#5d4037",
                  "settings": {},
                  "_hash": 0.9477803458361229
                },
                {
                  "name": "voltage",
                  "type": "timeseries",
                  "label": "voltage",
                  "color": "#00b8d4",
                  "settings": {},
                  "_hash": 0.7130441584619525
                },
                {
                  "name": "current",
                  "type": "timeseries",
                  "label": "current",
                  "color": "#dd2c00",
                  "settings": {},
                  "_hash": 0.3576115517207106
                },
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "temperature",
                  "color": "#616161",
                  "settings": {},
                  "_hash": 0.7273317981534848
                },
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "humidity",
                  "color": "#1e88e5",
                  "settings": {},
                  "_hash": 0.6338637191703418
                },
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "co2",
                  "color": "#43a047",
                  "settings": {},
                  "_hash": 0.608829321184652
                },
                {
                  "name": "voc",
                  "type": "timeseries",
                  "label": "voc",
                  "color": "#e53935",
                  "settings": {},
                  "_hash": 0.9666437874206149
                },
                {
                  "name": "o3",
                  "type": "timeseries",
                  "label": "o3",
                  "color": "#ffb300",
                  "settings": {},
                  "_hash": 0.9857513387465802
                },
                {
                  "name": "pulse",
                  "type": "timeseries",
                  "label": "pulse",
                  "color": "#546e7a",
                  "settings": {},
                  "_hash": 0.7225646617994133
                },
                {
                  "name": "digital",
                  "type": "timeseries",
                  "label": "digital",
                  "color": "#8e24aa",
                  "settings": {},
                  "_hash": 0.30808151256769745
                },
                {
                  "name": "light",
                  "type": "timeseries",
                  "label": "light",
                  "color": "#7cb342",
                  "settings": {},
                  "_hash": 0.3990032557312193
                },
                {
                  "name": "motion",
                  "type": "timeseries",
                  "label": "motion",
                  "color": "#3949ab",
                  "settings": {},
                  "_hash": 0.09039042127910646
                },
                {
                  "name": "leakage_status",
                  "type": "timeseries",
                  "label": "leakage_status",
                  "color": "#d81b60",
                  "settings": {},
                  "_hash": 0.6924330142328681
                },
                {
                  "name": "distance",
                  "type": "timeseries",
                  "label": "distance",
                  "color": "#fdd835",
                  "settings": {},
                  "_hash": 0.976347187053709
                },
                {
                  "name": "position",
                  "type": "timeseries",
                  "label": "position",
                  "color": "#039be5",
                  "settings": {},
                  "_hash": 0.8888117462431226
                },
                {
                  "name": "trapState",
                  "type": "timeseries",
                  "label": "trapState",
                  "color": "#fb8c00",
                  "settings": {},
                  "_hash": 0.6922345181256944
                },
                {
                  "name": "magnet_status",
                  "type": "timeseries",
                  "label": "magnet_status",
                  "color": "#5e35b1",
                  "settings": {},
                  "_hash": 0.7212438208836502
                },
                {
                  "name": "tamper_status",
                  "type": "timeseries",
                  "label": "tamper_status",
                  "color": "#c0ca33",
                  "settings": {},
                  "_hash": 0.08261969978881001
                },
                {
                  "name": "output1",
                  "type": "timeseries",
                  "label": "output1",
                  "color": "#00897b",
                  "settings": {},
                  "_hash": 0.6043267624707238
                },
                {
                  "name": "input1",
                  "type": "timeseries",
                  "label": "input1",
                  "color": "#6d4c41",
                  "settings": {},
                  "_hash": 0.41920401397802387
                },
                {
                  "name": "rxPackets_rx_count",
                  "type": "timeseries",
                  "label": "rxPackets_rx_count",
                  "color": "#00acc1",
                  "settings": {},
                  "_hash": 0.8989838300063484,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "txPackets_tx_count",
                  "type": "timeseries",
                  "label": "txPackets_tx_count",
                  "color": "#f4511e",
                  "settings": {},
                  "_hash": 0.8022671449469765,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "rxPacketsPerDr_0",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_0",
                  "color": "#757575",
                  "settings": {},
                  "_hash": 0.5135345916709977
                },
                {
                  "name": "rxPacketsPerDr_1",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_1",
                  "color": "#455a64",
                  "settings": {},
                  "_hash": 0.3147090975179878,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "rxPacketsPerDr_2",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_2",
                  "color": "#1976d2",
                  "settings": {},
                  "_hash": 0.36016054717724266
                },
                {
                  "name": "rxPacketsPerDr_3",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_3",
                  "color": "#388e3c",
                  "settings": {},
                  "_hash": 0.3680045015382747
                },
                {
                  "name": "rxPacketsPerDr_4",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_4",
                  "color": "#d32f2f",
                  "settings": {},
                  "_hash": 0.8093956472339183
                },
                {
                  "name": "rxPacketsPerDr_5",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_5",
                  "color": "#ffa000",
                  "settings": {},
                  "_hash": 0.8727983601547229
                },
                {
                  "name": "txPacketsPerStatus_OK",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_OK",
                  "color": "#7b1fa2",
                  "settings": {},
                  "_hash": 0.3130231904009564
                },
                {
                  "name": "txPacketsPerStatus_COLLISION_PACKET",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_COLLISION_PACKET",
                  "color": "#689f38",
                  "settings": {},
                  "_hash": 0.05273368869621464
                },
                {
                  "name": "txPacketsPerStatus_TOO_EARLY",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_TOO_EARLY",
                  "color": "#303f9f",
                  "settings": {},
                  "_hash": 0.7160874502952954,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "txPacketsPerStatus_TOO_LATE",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_TOO_LATE",
                  "color": "#c2185b",
                  "settings": {},
                  "_hash": 0.41899392820237713,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "dewPoint",
                  "type": "timeseries",
                  "label": "dewPoint",
                  "color": "#fbc02d",
                  "settings": {},
                  "_hash": 0.3035531173069764
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678117909802,
                "endTimeMs": 1678204309802
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "#29313c",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": "let dewPoint, selectedSensor, state, energyMeterHeating, energyConsumptionHeating, energyHybridMeterHeating, energyHybridConsumptionHeating, energyMeterCooling, energyConsumptionCooling, powerHeating, powerCooling, volumeMeterHeating, volumeConsumptionHeating, volumeMeterCooling, volumeConsumptionCooling, volumeFlowHeating, volumeFlowCooling, temperatureFlowHeating, temperatureReturnHeating, temperatureDifferenceHeating, temperatureFlowCooling, temperatureReturnCooling, temperatureDifferenceCooling, volumeWaterMeter, volumeWaterConsumption, volumeGasMeter, volumeGasConsumption, electricityActiveEnergyMeterTotal, electricityActiveEnergyConsumptionTotal, electricityActivePowerTotal, electricityApparentPowerTotal, electricityReactivePowerTotal, electricityPowerFactor, electricityFrequency, electricityVoltage, electricityVoltageL1, electricityVoltageL2, electricityVoltageL3, electricityCurrentTotal, electricityCurrentL1, electricityCurrentL2, electricityCurrentL3, energy, power, volume, current, voltage, frequency, temperature, humidity, voc, o3, co2, pulse, digital, light, motion, leakageStatus, position, distance, trapState, magnet_status, tamper_status, output1, input1, statusBattery, battery, statusMargin, margin,rxPackets_rx_count,txPackets_tx_count,rxPacketsPerDr_0,rxPacketsPerDr_1,rxPacketsPerDr_2,rxPacketsPerDr_3,rxPacketsPerDr_4,rxPacketsPerDr_5,txPacketsPerStatus_COLLISION_PACKET,txPacketsPerStatus_OK,txPacketsPerStatus_TOO_EARLY,txPacketsPerStatus_TOO_LATE;\r\nlet rxPacketsPerDr_0_value,rxPacketsPerDr_1_value,rxPacketsPerDr_2_value,rxPacketsPerDr_3_value,rxPacketsPerDr_4_value,rxPacketsPerDr_5_value,txPacketsPerDr_0_value,txPacketsPerDr_1_value,txPacketsPerDr_2_value,txPacketsPerDr_3_value,txPacketsPerDr_4_value,txPacketsPerDr_5_value,txPacketsPerStatus_COLLISION_PACKET_value,txPacketsPerStatus_OK_value,txPacketsPerStatus_TOO_EARLY_value,txPacketsPerStatus_TOO_LATE_value;\r\nif (data && data.length) {\r\n    selectedSensor = data[0];\r\n    // Telemetry\r\n    /* Heating and Combined Heating/Cooling Meter */\r\n    dewPoint = processValue(selectedSensor['dewPoint'], 0);\r\n    energyMeterHeating = processValue(selectedSensor['H_M_Energy_Heating'], 0);\r\n    energyConsumptionHeating = processValue(selectedSensor['H_C_Energy_Heating'], 2);\r\n    energyHybridMeterHeating = processValue(selectedSensor['CHC_M_Energy_Heating'], 0);\r\n    energyHybridConsumptionHeating = processValue(selectedSensor['CHC_C_Energy_Heating'], 2);\r\n    energyMeterCooling = processValue(selectedSensor['CHC_M_Energy_Cooling'], 0);\r\n    energyConsumptionCooling = processValue(selectedSensor['CHC_C_Energy_Cooling'], 2);\r\n    powerHeating = processValue(selectedSensor['H_S_Power'], 0);\r\n    powerCooling = processValue(selectedSensor['CHC_S_Power'], 0);\r\n    volumeMeterHeating = processValue(selectedSensor['H_M_Volume'], 3);\r\n    volumeConsumptionHeating = processValue(selectedSensor['H_C_Volume'], 3);\r\n    volumeMeterCooling = processValue(selectedSensor['CHC_M_Volume'], 3);\r\n    volumeConsumptionCooling = processValue(selectedSensor['CHC_C_Volume'], 3);\r\n    volumeFlowHeating = processValue(selectedSensor['H_S_VolumeFlow'], 3);\r\n    volumeFlowCooling = processValue(selectedSensor['CHC_S_VolumeFlow'], 3);\r\n    temperatureFlowHeating = processValue(selectedSensor['H_S_TemperatureFlow'], 1);\r\n    temperatureReturnHeating = processValue(selectedSensor['H_S_TemperatureReturn'], 1);\r\n    temperatureDifferenceHeating = processValue(selectedSensor['H_S_TemperatureDifference'], 1);\r\n    temperatureFlowCooling = processValue(selectedSensor['CHC_S_TemperatureFlow'], 1);\r\n    temperatureReturnCooling = processValue(selectedSensor['CHC_S_TemperatureReturn'], 1);\r\n    temperatureDifferenceCooling = processValue(selectedSensor['CHC_S_TemperatureDifference'], 1);\r\n    /* Water Meter */\r\n    volumeWaterMeter = processValue(selectedSensor['W_M_Volume'], 3);\r\n    volumeWaterConsumption = processValue(selectedSensor['W_C_Volume'], 3);\r\n    /* Gas Meter */\r\n    volumeGasMeter = processValue(selectedSensor['G_M_Volume'], 3);\r\n    volumeGasConsumption = processValue(selectedSensor['G_C_Volume'], 3);\r\n    /* Electricity Meter */\r\n    electricityActiveEnergyMeterTotal = processValue(selectedSensor['E_M_ActiveEnergyTotal'], 3);\r\n    electricityActiveEnergyConsumptionTotal = processValue(selectedSensor['E_C_ActiveEnergyTotal'], 3);\r\n    electricityActivePowerTotal = processValue(selectedSensor['E_S_ActivePowerTotal'], 3);\r\n    electricityApparentPowerTotal = processValue(selectedSensor['E_S_ApparentPowerTotal'], 3);\r\n    electricityReactivePowerTotal = processValue(selectedSensor['E_S_ReactivePowerTotal'], 3);\r\n    electricityPowerFactor = processValue(selectedSensor['E_S_PowerFactor'], 3);\r\n    electricityFrequency = processValue(selectedSensor['E_S_Frequency'], 2);\r\n    electricityVoltage = processValue(selectedSensor['E_S_Voltage'], 2);\r\n    electricityCurrentTotal = processValue(selectedSensor['E_S_CurrentTotal'] || selectedSensor['E_S_Current'], 3);\r\n    electricityCurrentL1 = electricityCurrentL2 = electricityCurrentL3 = 'N/A';\r\n    electricityVoltageL1 = electricityVoltageL2 = electricityVoltageL3 = 'N/A';\r\n\r\n    /* Other */\r\n    energy = processValue(selectedSensor['energy'], 3);\r\n    power = processValue(selectedSensor['power'], 3);\r\n    volume = processValue(selectedSensor['volume'], 3);\r\n    current = processValue(selectedSensor['current'], 3);\r\n    voltage = processValue(selectedSensor['voltage'], 3);\r\n    frequency = processValue(selectedSensor['frequency'], 3);\r\n    temperature = processValue(selectedSensor['temperature'], 3);\r\n    humidity = processValue(selectedSensor['humidity'], 3);\r\n    voc = processValue(selectedSensor['voc'], 3);\r\n    o3 = processValue(selectedSensor['o3'], 3);\r\n    co2 = processValue(selectedSensor['co2'], 1);\r\n    battery = processValue(selectedSensor['battery'], 1);\r\n    margin = processValue(selectedSensor['battery'], 1);\r\n    statusBattery = processValue(selectedSensor['status_battery_level'], 1);\r\n    statusMargin = processValue(selectedSensor['status_margin'], 1);\r\n    motion = processValue(selectedSensor['motion']);\r\n    light = processValue(selectedSensor['light'], 1);\r\n    pulse = processValue(selectedSensor['pulse'], 0);\r\n    digital = processValue(selectedSensor['digital'], 0);\r\n    leakageStatus = selectedSensor['leakage_status'] || 'N/A';\r\n    position = processValue(selectedSensor['position'], 0);\r\n    distance = processValue(selectedSensor['distance'], 0);\r\n    trapState = selectedSensor['trapState'] || 'N/A';\r\n    magnet_status = selectedSensor['magnet_status'] || 'N/A';\r\n    tamper_status = selectedSensor['tamper_status'] || 'N/A';\r\n    output1 = processValue(selectedSensor['output1'], 0);\r\n    input1 = processValue(selectedSensor['input1'], 0);\r\n    rxPackets_rx_count = processValue(selectedSensor['rxPackets_rx_count'], 0);\r\n    txPackets_tx_count = processValue(selectedSensor['txPackets_tx_count'], 0);\r\n    rxPacketsPerDr_0 = processValue(selectedSensor['rxPacketsPerDr_0'], 0);\r\n    rxPacketsPerDr_0_value = processValue(selectedSensor['rxPacketsPerDr_0'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['rxPacketsPerDr_0'], 0) ||0;\r\n    rxPacketsPerDr_1 = processValue(selectedSensor['rxPacketsPerDr_1'], 0);\r\n    rxPacketsPerDr_1_value = processValue(selectedSensor['rxPacketsPerDr_1'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['rxPacketsPerDr_1'], 0)||0;\r\n    rxPacketsPerDr_2 = processValue(selectedSensor['rxPacketsPerDr_2'], 0);\r\n    rxPacketsPerDr_2_value = processValue(selectedSensor['rxPacketsPerDr_2'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['rxPacketsPerDr_2'], 0)||0;\r\n    rxPacketsPerDr_3 = processValue(selectedSensor['rxPacketsPerDr_3'], 0);\r\n    rxPacketsPerDr_3_value = processValue(selectedSensor['rxPacketsPerDr_3'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['rxPacketsPerDr_3'], 0)||0;\r\n    rxPacketsPerDr_4 = processValue(selectedSensor['rxPacketsPerDr_4'], 0);\r\n     rxPacketsPerDr_4_value = processValue(selectedSensor['rxPacketsPerDr_4'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['rxPacketsPerDr_4'], 0)||0;\r\n    rxPacketsPerDr_5 = processValue(selectedSensor['rxPacketsPerDr_5'], 0);\r\n     rxPacketsPerDr_5_value = processValue(selectedSensor['rxPacketsPerDr_5'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['rxPacketsPerDr_5'], 0)||0;\r\n    txPacketsPerDr_0 = processValue(selectedSensor['txPacketsPerDr_0'], 0);\r\n     txPacketsPerDr_0_value = processValue(selectedSensor['txPacketsPerDr_0'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerDr_0'], 0)||0;\r\n    txPacketsPerDr_1 = processValue(selectedSensor['txPacketsPerDr_1'], 0);\r\n     txPacketsPerDr_1_value = processValue(selectedSensor['txPacketsPerDr_1'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerDr_1'], 0)||0;\r\n    txPacketsPerDr_2 = processValue(selectedSensor['txPacketsPerDr_2'], 0);\r\n     txPacketsPerDr_2_value = processValue(selectedSensor['txPacketsPerDr_2'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerDr_2'], 0)||0;\r\n    txPacketsPerDr_3 = processValue(selectedSensor['txPacketsPerDr_3'], 0);\r\n     txPacketsPerDr_3_value = processValue(selectedSensor['txPacketsPerDr_3'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerDr_3'], 0)||0;\r\n    txPacketsPerDr_4 = processValue(selectedSensor['txPacketsPerDr_4'], 0);\r\n     txPacketsPerDr_4_value = processValue(selectedSensor['txPacketsPerDr_4'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerDr_4'], 0)||0;\r\n    txPacketsPerDr_5 = processValue(selectedSensor['txPacketsPerDr_5'], 0);\r\n     txPacketsPerDr_5_value = processValue(selectedSensor['txPacketsPerDr_5'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerDr_5'], 0)||0;\r\n    txPacketsPerStatus_COLLISION_PACKET = processValue(selectedSensor['txPacketsPerStatus_COLLISION_PACKET'], 0);\r\n     txPacketsPerStatus_COLLISION_PACKET_value = processValue(selectedSensor['txPacketsPerStatus_COLLISION_PACKET'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerStatus_COLLISION_PACKET'], 0)||0;\r\n    txPacketsPerStatus_OK = processValue(selectedSensor['txPacketsPerStatus_OK'], 0);\r\n     txPacketsPerStatus_OK_value = processValue(selectedSensor['txPacketsPerStatus_OK'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerStatus_OK'], 0)||0;\r\n    txPacketsPerStatus_TOO_EARLY = processValue(selectedSensor['txPacketsPerStatus_TOO_EARLY'], 0);\r\n     txPacketsPerStatus_TOO_EARLY_value = processValue(selectedSensor['txPacketsPerStatus_TOO_EARLY'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerStatus_TOO_EARLY'], 0)||0;\r\n    txPacketsPerStatus_TOO_LATE = processValue(selectedSensor['txPacketsPerStatus_TOO_LATE'], 0);\r\n     txPacketsPerStatus_TOO_LATE_value = processValue(selectedSensor['txPacketsPerStatus_TOO_LATE'], 0) === \"N/A\" ? 0 : processValue(selectedSensor['txPacketsPerStatus_TOO_LATE'], 0)||0;\r\n} else {\r\n    state = 'N/A';\r\n    energyMeterHeating = dewPoint = energyConsumptionHeating = energyHybridMeterHeating = energyHybridConsumptionHeating = energyMeterCooling = energyConsumptionCooling = powerHeating, powerCooling = volumeMeterHeating = volumeConsumptionHeating = volumeMeterCooling = volumeConsumptionCooling = volumeFlowHeating = volumeFlowCooling = temperatureFlowHeating = temperatureReturnHeating = temperatureDifferenceHeating = temperatureFlowCooling = temperatureReturnCooling = temperatureDifferenceCooling = battery = margin = 'N/A';\r\n    volumeWaterMeter = volumeWaterConsumption = volumeGasMeter = volumeGasConsumption = electricityActiveEnergyMeterTotal = electricityActiveEnergyConsumptionTotal = electricityActivePowerTotal = electricityApparentPowerTotal = electricityReactivePowerTotal = electricityPowerFactor = electricityFrequency = electricityVoltage = electricityCurrentTotal = electricityCurrentL1 = electricityCurrentL2 = electricityCurrentL3 = electricityVoltageL1 = electricityVoltageL2 = electricityVoltageL3 = \r\n    energy = power = volume = current = voltage = frequency = temperature = humidity = voc = o3 = co2 = battery = margin = statusBattery = statusMargin = motion = light = pulse = digital = leakageStatus = distance = position = trapState = output1 = input1 = rxPackets_rx_count =txPackets_tx_count=rxPacketsPerDr_0=rxPacketsPerDr_1=rxPacketsPerDr_2=rxPacketsPerDr_3=rxPacketsPerDr_4=rxPacketsPerDr_5txPacketsPerDr_0=txPacketsPerDr_1=txPacketsPerDr_2=txPacketsPerDr_3=txPacketsPerDr_4=txPacketsPerDr_5=txPacketsPerStatus_TOO_LATE=txPacketsPerStatus_TOO_EARLY=txPacketsPerStatus_OK=txPacketsPerStatus_COLLISION_PACKET= 'N/A';\r\n}\r\n\r\nif (data && data.length && data[0].entityId) {\r\n    \r\n    const entityId = data[0].entityId;\r\n    const entityType = data[0].entityType;\r\n\r\n     let resultData = '<mat-tab-group disableRipple class=\"history-tabs\">';\r\n\r\n    /* Heating Meter */\r\n    // Energy Heating Tab\r\n    if (energyMeterHeating !== 'N/A' || energyConsumptionHeating !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Energy Heating</div>' +\r\n                            '<div class=\"data-point-value\">' + energyMeterHeating + ' kWh | ' + energyConsumptionHeating + ' kWh</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyheating_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyheating_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyheating_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyheating_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n/*                        '<mat-tab label=\"Alarms\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"device_alarms\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +*/\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    // Volume Tab\r\n    if (volumeMeterHeating !== 'N/A' || volumeConsumptionHeating !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Volume</div>' +\r\n                            '<div class=\"data-point-value\">' + volumeMeterHeating + ' m | ' + volumeConsumptionHeating + ' m</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumeheating_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumeheating_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumeheating_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumeheating_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    // Temperature Tab\r\n    if (temperatureFlowHeating !== 'N/A' || temperatureReturnHeating !== 'N/A' || temperatureDifferenceHeating !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Temperature</div>' +\r\n                            '<div class=\"data-point-value\">' + temperatureFlowHeating + ' C | ' + temperatureReturnHeating + ' C | ' + temperatureDifferenceHeating + ' C</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperatureheating_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperatureheating_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperatureheating_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperatureheating_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    // Power Tab\r\n    if (powerHeating !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Power</div>' +\r\n                            '<div class=\"data-point-value\">' + powerHeating + ' W</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powerheating_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powerheating_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powerheating_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powerheating_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    /* Combined Heating/Cooling Meter */\r\n    // Energy Heating Tab\r\n    if (energyHybridMeterHeating !== 'N/A' || energyHybridConsumptionHeating !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Energy Heating</div>' +\r\n                            '<div class=\"data-point-value\">' + energyHybridMeterHeating + ' kWh | ' + energyHybridConsumptionHeating + ' kWh</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyhybrid_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyhybrid_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyhybrid_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energyhybrid_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    // Energy Cooling Tab\r\n    if (energyMeterCooling !== 'N/A' || energyConsumptionCooling !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Energy Cooling</div>' +\r\n                            '<div class=\"data-point-value\">' + energyMeterCooling + ' kWh | ' + energyConsumptionCooling + ' kWh</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energycooling_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energycooling_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energycooling_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energycooling_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    // Volume Tab\r\n    if (volumeMeterCooling !== 'N/A' || volumeConsumptionCooling !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Volume</div>' +\r\n                            '<div class=\"data-point-value\">' + volumeMeterCooling + ' m | ' + volumeConsumptionCooling + ' m</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumecooling_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumecooling_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumecooling_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumecooling_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    // Temperature Tab\r\n    if (temperatureFlowCooling !== 'N/A' || temperatureReturnCooling !== 'N/A' || temperatureDifferenceCooling !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Temperature</div>' +\r\n                            '<div class=\"data-point-value\">' + temperatureFlowCooling + ' C | ' + temperatureReturnCooling + ' C | ' + temperatureDifferenceCooling + ' C</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperaturecooling_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperaturecooling_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperaturecooling_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperaturecooling_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    // Power Tab\r\n    if (powerCooling !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Power</div>' +\r\n                            '<div class=\"data-point-value\">' + powerCooling + ' W</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powercooling_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powercooling_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powercooling_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_powercooling_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    /* Water Meter */\r\n    // Volume Tab\r\n    if (volumeWaterMeter !== 'N/A' || volumeWaterConsumption !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Volume</div>' +\r\n                            '<div class=\"data-point-value\">' + volumeWaterMeter + ' m | ' + volumeWaterConsumption + ' m</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumewater_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumewater_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumewater_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumewater_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    /* Gas Meter */\r\n    // Volume Tab\r\n    if (volumeGasMeter !== 'N/A' || volumeGasConsumption !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Volume</div>' +\r\n                            '<div class=\"data-point-value\">' + volumeGasMeter + ' m | ' + volumeGasConsumption + ' m</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumegas_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumegas_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumegas_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volumegas_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    /* Electricity Meter */\r\n    // Energy Tab\r\n    if (electricityActiveEnergyMeterTotal !== 'N/A' || electricityActiveEnergyConsumptionTotal !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Energy</div>' +\r\n                            '<div class=\"data-point-value\">' + electricityActiveEnergyMeterTotal + ' kWh | ' + electricityActiveEnergyConsumptionTotal + ' kWh</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityactiveenergy_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityactiveenergy_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityactiveenergy_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityactiveenergy_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    // Power Tab\r\n    if (electricityActivePowerTotal !== 'N/A' || electricityApparentPowerTotal !== 'N/A' || electricityReactivePowerTotal !== 'N/A' ) {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Power</div>' +\r\n                            '<div class=\"data-point-value\">' + electricityActivePowerTotal + ' W | ' + electricityApparentPowerTotal + ' VA | ' + electricityReactivePowerTotal + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitypower_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitypower_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitypower_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitypower_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    // Frequency Tab\r\n    if (electricityFrequency !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Frequency</div>' +\r\n                            '<div class=\"data-point-value\">' + electricityFrequency + ' Hz</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityfrequency_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityfrequency_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityfrequency_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityfrequency_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    } \r\n    \r\n    if (electricityVoltage !== 'N/A' || electricityVoltageL1 !== 'N/A' || electricityVoltageL2 !== 'N/A' || electricityVoltageL3 !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Voltage</div>' +\r\n                            '<div class=\"data-point-value\">' + electricityVoltage + ' Hz</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityvoltage_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityvoltage_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityvoltage_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricityvoltage_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (electricityCurrentTotal !== 'N/A' || electricityCurrentL1 !== 'N/A' || electricityCurrentL2 !== 'N/A' || electricityCurrentL3 !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Current</div>' +\r\n                            '<div class=\"data-point-value\">' + electricityCurrentTotal + ' A</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitycurrent_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitycurrent_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitycurrent_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_electricitycurrent_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    } \r\n    \r\n    /* Other */\r\n    if (energy !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Energy</div>' +\r\n                            '<div class=\"data-point-value\">' + energy + ' kWh</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energy_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_energy_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (power !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Power</div>' +\r\n                            '<div class=\"data-point-value\">' + power + ' W</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_power_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_power_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_power_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_power_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    if (current !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Current</div>' +\r\n                            '<div class=\"data-point-value\">' + current + ' A</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_current_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_current_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_current_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_current_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n    if (voltage !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Power</div>' +\r\n                            '<div class=\"data-point-value\">' + Voltage + ' V</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voltage_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voltage_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voltage_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voltage_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (frequency !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Frequency</div>' +\r\n                            '<div class=\"data-point-value\">' + frequency + ' Hz</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_frequency_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_frequency_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_frequency_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_frequency_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (volume !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Volume</div>' +\r\n                            '<div class=\"data-point-value\">' + volume + ' m</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volume_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_volume_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }    \r\n    \r\n    if (temperature !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Temperature</div>' +\r\n                            '<div class=\"data-point-value\">' + temperature + ' C</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperature_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperature_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperature_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_temperature_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    } \r\n    \r\n    if (humidity !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Humidity</div>' +\r\n                            '<div class=\"data-point-value\">' + humidity + ' % r.H.</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_humidity_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_humidity_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_humidity_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_humidity_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    } \r\n    \r\n    if (co2 !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">CO<sub>2</sub></div>' +\r\n                            '<div class=\"data-point-value\">' + co2 + ' ppm</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_co2_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_co2_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_co2_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_co2_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (voc !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">VOC</div>' +\r\n                            '<div class=\"data-point-value\">' + voc + ' mg/m</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voc_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voc_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voc_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_voc_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    } \r\n    \r\n    if (o3 !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">O<sub>3</sub></div>' +\r\n                            '<div class=\"data-point-value\">' + o3 + ' g/m</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_o3_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_o3_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_o3_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_o3_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (light !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Light</div>' +\r\n                            '<div class=\"data-point-value\">' + light + ' Lux</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_light_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_light_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    } \r\n    \r\n    if (motion !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Motion</div>' +\r\n                            '<div class=\"data-point-value\">' + motion + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_motion_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_motion_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (pulse !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Pulse</div>' +\r\n                            '<div class=\"data-point-value\">' + pulse + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_pulse_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_pulse_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (digital !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Digital</div>' +\r\n                            '<div class=\"data-point-value\">' + digital + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_digital_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_digital_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (leakageStatus !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Leakage Status</div>' +\r\n                            '<div class=\"data-point-value\">' + leakageStatus + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_leakagestatus_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_leakagestatus_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (trapState !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Trap Status</div>' +\r\n                            '<div class=\"data-point-value\">' + trapState + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_trapstate_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_trapstate_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (magnet_status !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Magnet Status</div>' +\r\n                            '<div class=\"data-point-value\">' + magnet_status + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_magnetstatus_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_magnetstatus_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (tamper_status !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Tamper Status</div>' +\r\n                            '<div class=\"data-point-value\">' + tamper_status + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_tamperstatus_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_tamperstatus_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (distance !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Distance</div>' +\r\n                            '<div class=\"data-point-value\">' + distance + ' mm</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_distance_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_distance_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Year\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_distance_year\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_distance_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (output1 !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Output Status</div>' +\r\n                            '<div class=\"data-point-value\">' + output1 + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_output1_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_output1_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (battery !== 'N/A' || statusBattery !=='N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Battery</div>' +\r\n                            '<div class=\"data-point-value\">' + (battery !== 'N/A' ? battery : statusBattery) + ' %</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_battery_year\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_battery_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    } \r\n    \r\n    if (margin !== 'N/A' || statusMargin !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Margin</div>' +\r\n                            '<div class=\"data-point-value\">' + (margin !== 'N/A' ? margin : statusMargin) + ' dBm</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_margin_year\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_margin_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    if (rxPackets_rx_count !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Received</div>' +\r\n                            '<div class=\"data-point-value\">' + rxPackets_rx_count + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPackets_rx_count_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPackets_rx_count_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPackets_rx_count_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPackets_rx_count_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    if (txPackets_tx_count !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Transmitted</div>' +\r\n                            '<div class=\"data-point-value\">' + txPackets_tx_count + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPackets_tx_count_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPackets_tx_count_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPackets_tx_count_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPackets_tx_count_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    if (rxPacketsPerDr_0 !== 'N/A'|| rxPacketsPerDr_1 !== 'N/A'|| rxPacketsPerDr_2 !== 'N/A'|| rxPacketsPerDr_3 !== 'N/A'|| rxPacketsPerDr_4 !== 'N/A'|| rxPacketsPerDr_5 !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Received/Datarate</div>' +\r\n                            '<div class=\"data-point-value\">' + (rxPacketsPerDr_0_value+rxPacketsPerDr_1_value+rxPacketsPerDr_2_value+rxPacketsPerDr_3_value+rxPacketsPerDr_4_value+rxPacketsPerDr_5_value) + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPacketsPerDr_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPacketsPerDr_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPacketsPerDr_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_rxPacketsPerDr_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    if (txPacketsPerDr_0 !== 'N/A'|| txPacketsPerDr_1 !== 'N/A'|| txPacketsPerDr_2 !== 'N/A'|| txPacketsPerDr_3 !== 'N/A'|| txPacketsPerDr_4 !== 'N/A'|| txPacketsPerDr_5 !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Transmitted/Datarate</div>' +\r\n                            '<div class=\"data-point-value\">' + (txPacketsPerDr_0_value+txPacketsPerDr_1_value+txPacketsPerDr_2_value+txPacketsPerDr_3_value+txPacketsPerDr_4_value+txPacketsPerDr_5_value) + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerDr_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerDr_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerDr_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerDr_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    if (txPacketsPerStatus_COLLISION_PACKET !== 'N/A'|| txPacketsPerStatus_OK !== 'N/A'|| txPacketsPerStatus_TOO_EARLY !== 'N/A'|| txPacketsPerStatus_TOO_LATE !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Packets Per Status</div>' +\r\n                            '<div class=\"data-point-value\">' + (txPacketsPerStatus_OK_value +txPacketsPerStatus_COLLISION_PACKET_value+txPacketsPerStatus_TOO_EARLY_value+txPacketsPerStatus_TOO_LATE_value) + '</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerStatus_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerStatus_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerStatus_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_txPacketsPerStatus_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n    \r\n    if (dewPoint !== 'N/A') {\r\n        resultData += '<mat-tab>' +\r\n                    '<ng-template mat-tab-label>' +\r\n                        '<div class=\"data-point\">' +\r\n                            '<div class=\"data-point-name\">Dew Point</div>' +\r\n                            '<div class=\"data-point-value\">' + dewPoint + ' C</div>' +\r\n                        '</div>' +\r\n                    '</ng-template>' +\r\n                    '<mat-tab-group disableRipple class=\"history-tabs\">' +\r\n                        '<mat-tab label=\"Live\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_dewPoint_day\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Week\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_dewPoint_week\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Month\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_dewPoint_month\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n                        '<mat-tab label=\"Raw\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"ts_dewPoint_raw\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +\r\n/*                        '<mat-tab label=\"Alarms\">' +\r\n                            '<tb-dashboard-state [ctx]=\"ctx\" stateId=\"device_alarms\"></tb-dashboard-state>' +\r\n                        '</mat-tab>' +*/\r\n                    '</mat-tab-group>' +\r\n                  '</mat-tab>';\r\n    }\r\n\r\n     resultData += '</mat-tab-group>';\r\n    // Return only the inner tab group container without the outer \"Data\" label tab.\r\n    return '<div class=\"history-container\">' + resultData + '</div>';\r\n} else {\r\n    return '<div class=\"history-container\"></div>';\r\n}\r\n\r\nfunction isNumber(value) {\r\n    return (typeof value === 'number' && isFinite(value));\r\n}\r\n\r\nfunction processValue(value, dec) {\r\n    if (value === null || value === undefined) {\r\n        return 'N/A';\r\n    }\r\n\r\n    value = parseFloat(value);\r\n    if (isNumber(value)) {\r\n        if (isNumber(dec)) {\r\n            return parseFloat(value.toFixed(dec));\r\n        }\r\n        return value;\r\n    } else {\r\n        return 'N/A';\r\n    }\r\n}\r\n\r\n\r\n/*function onTabSelectionChange(index) {\r\n    let tabType;\r\n    // Map the index to a tab type string.\r\n    switch(index) {\r\n        case 0:\r\n            tabType = 'live';\r\n            break;\r\n        case 1:\r\n            tabType = 'week';\r\n            break;\r\n        case 2:\r\n            tabType = 'month';\r\n            break;\r\n        case 3:\r\n            tabType = 'raw';\r\n            break;\r\n        default:\r\n            tabType = 'live';\r\n            break;\r\n    }\r\n    // Assume you have a sensorData object available with sensor timestamps.\r\n    updateTimeWindow(tabType, sensorData);\r\n}\r\n\r\n\r\nfunction updateTimeWindow(tabType, sensorData) {\r\n    const now = Date.now();\r\n    // For the sake of example, assume sensorData contains startTimeMs and endTimeMs (if available)\r\n    let startTime = sensorData && sensorData.startTimeMs ? sensorData.startTimeMs : now - 1209600000; // default = 2 weeks\r\n    let endTime = sensorData && sensorData.endTimeMs ? sensorData.endTimeMs : now;\r\n    const timeThreshold = 3024000000; // 35 days threshold\r\n\r\n    // Example: if both start and end exist, use the provided range,\r\n    // but if the range is too long (delta > threshold), limit it.\r\n    if (sensorData && sensorData.startTimeMs && sensorData.endTimeMs) {\r\n        const deltaTime = sensorData.endTimeMs - sensorData.startTimeMs;\r\n        if (deltaTime > timeThreshold) {\r\n            // Limit the window to the most recent 35 days\r\n            startTime = sensorData.endTimeMs - timeThreshold;\r\n        }\r\n    }\r\n    // Alternatively update times based on the selected tab:\r\n    switch(tabType) {\r\n        case 'live':\r\n            // For live, we could use dynamic sensor data info if available,\r\n            // otherwise use a short window such as last hour or so.\r\n            // Here we simply use the sensorData or default above.\r\n            break;\r\n        case 'week':\r\n            startTime = now - 7 * 24 * 60 * 60 * 1000;\r\n            endTime = now;\r\n            break;\r\n        case 'month':\r\n            startTime = now - 30 * 24 * 60 * 60 * 1000;\r\n            endTime = now;\r\n            break;\r\n        case 'raw':\r\n            // Assume raw means all available history;\r\n            // if sensorData contains a startTime then use that.\r\n            // Otherwise you might keep the same logic as live.\r\n            startTime = sensorData && sensorData.startTimeMs ? sensorData.startTimeMs : now - 1209600000;\r\n            endTime = now;\r\n            break;\r\n        default:\r\n            // Fallback to a default, e.g., 2 weeks.\r\n            startTime = now - 1209600000;\r\n            endTime = now;\r\n            break;\r\n    }\r\n\r\n    // Build the dashboard time window object.\r\n    const newDashboardtimewindow = {\r\n        aggregation: {\r\n            limit: 100000,\r\n            type: \"NONE\"\r\n        },\r\n        hideAggInterval: true,\r\n        hideAggregation: true,\r\n        hideInterval: false,\r\n        history: {\r\n            historyType: 1,\r\n            fixedTimewindow: {\r\n                startTimeMs: startTime,\r\n                endTimeMs: endTime\r\n            }\r\n        },\r\n        selectedTab: tabType\r\n    };\r\n\r\n    // Send the new time window to the dashboard.\r\n    ctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\n\r\n    // Optionally update state parameters if needed.\r\n    let stateParams = ctx.stateController.getStateParams();\r\n    ctx.stateController.updateState(null, stateParams);\r\n}*/\r\n\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".history-container {\n    height: 100%;\n    width: 100%;\n    padding: 5px;\n    display: flex;\n    flex-direction: column;\n}\n\n.history-container .history-tabs {\n    height: 100%;\n    width: 100%;\n    overflow: visible;\n    flex: 1;\n}\n\n.history-container .history-content {\n    height: 100%;\n    width: 100%;\n    overflow: auto;\n    flex: 1;\n}\n\n.history-container .history-tabs .mat-mdc-tab .mdc-tab-indicator__content--underline {\n    border-color: var(--tb-primary-500);\n}\n\n.data-point {\n    display: flex;\n    flex-direction: column;\n}\n\n.data-point-name {\n    font-weight: 600;\n    font-size: 16px;\n    line-height: 18px;\n    margin-bottom: 2px;\n}\n\n.data-point-value {\n    font-weight: 500;\n    font-size: 16px;\n    line-height: 16px;\n    letter-spacing: 0.25px;\n    color: var(--tb-primary-500);\n}\n\n.device-tabs {\n    font-weight: 700;\n    font-size: 18px;\n    line-height: 20px;\n    padding: 10px;\n}\n\n\n\n/*.history-container {\n    height: 100%;\n    width: 100%;\n    padding: 5px;\n    display: flex;\n    flex-direction: column;\n}\n\n.history-container .history-tabs {\n    height: 100%;\n    width: 100%;\n    overflow: visible;\n    flex: 1;\n    margin-bottom: 8px;\n    margin-top: 8px;\n}\n\n.data-point {\n    display: flex;\n    flex-direction: column;\n}\n\n.data-point-name {\n    font-weight: 600;\n    font-size: 16px;\n    line-height: 18px;\n    margin-bottom: 2px;\n}\n\n.data-point-value {\n    font-weight: 500;\n    font-size: 16px;\n    line-height: 16px;\n    letter-spacing: 0.25px;\n    color: var(--tb-primary-500);\n}\n\n.device-tabs {\n    font-weight: 700;\n    font-size: 18px;\n    line-height: 20px;\n    padding: 10px;\n}\n*/"
          },
          "title": "Data",
          "showTitleIcon": true,
          "iconColor": "#0094D0",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {
            "border-style": "solid",
            "border-width": "1px",
            "border-color": "#ccc"
          },
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 500,
            "padding": "5px 5px 5px 5px"
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "\n.history-container .history-tabs .mat-mdc-tab-header {\n    border-bottom: none;\n}\n\n.history-container .history-tabs .mat-mdc-tab {\n    height: 40px;\n    min-width: 50px;\n    opacity: 1;\n}\n\n.history-container .history-tabs .mat-mdc-tab .mdc-tab__text-label {\n    font-size: 14px;\n    font-weight: 600;\n    line-height: 20px;\n    color: #9FA6B4;\n}\n\n.history-container .history-tabs .mat-mdc-tab.mdc-tab--active .mdc-tab__text-label {\n    color: #29313C;\n}\n\n.history-container .history-tabs .mat-mdc-tab .mdc-tab-indicator__content--underline {\n    border-color: #4B535B;\n}\n\n.history-container .history-tabs .mat-mdc-tab-body-wrapper {\n    height: calc(100% - 40px);\n}",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 18,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleIcon": "dashboard",
          "borderRadius": "8px"
        },
        "row": 0,
        "col": 0,
        "id": "1d2b8d63-39b8-d2c0-1a37-e8fc7dc23353",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "be207049-e858-e316-a7a4-b55b6de2c24f": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1746361917131,
                "endTimeMs": 1746448317131
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "Topographic",
                "provider": "openstreet",
                "layerType": "Esri.WorldTopoMap",
                "referenceLayer": null
              },
              {
                "label": "HOT",
                "provider": "openstreet",
                "layerType": "OpenStreetMap.HOT",
                "referenceLayer": null
              },
              {
                "label": "WorldStreetMap",
                "provider": "openstreet",
                "layerType": "Esri.WorldStreetMap",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              },
              {
                "label": "Mapnik",
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik",
                "referenceLayer": null
              }
            ],
            "imageSource": {
              "sourceType": "image",
              "url": "data:image/svg+xml;base64,PHN2ZyBpZD0ic3ZnMiIgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTAwIiB3aWR0aD0iMTAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgdmlld0JveD0iMCAwIDEwMCAxMDAiPgogPGcgaWQ9ImxheWVyMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtOTUyLjM2KSI+CiAgPHJlY3QgaWQ9InJlY3Q0Njg0IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBoZWlnaHQ9Ijk5LjAxIiB3aWR0aD0iOTkuMDEiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiB5PSI5NTIuODYiIHg9Ii40OTUwNSIgc3Ryb2tlLXdpZHRoPSIuOTkwMTAiIGZpbGw9IiNlZWUiLz4KICA8dGV4dCBpZD0idGV4dDQ2ODYiIHN0eWxlPSJ3b3JkLXNwYWNpbmc6MHB4O2xldHRlci1zcGFjaW5nOjBweDt0ZXh0LWFuY2hvcjptaWRkbGU7dGV4dC1hbGlnbjpjZW50ZXIiIGZvbnQtd2VpZ2h0PSJib2xkIiB4bWw6c3BhY2U9InByZXNlcnZlIiBmb250LXNpemU9IjEwcHgiIGxpbmUtaGVpZ2h0PSIxMjUlIiB5PSI5NzAuNzI4MDkiIHg9IjQ5LjM5NjQ3NyIgZm9udC1mYW1pbHk9IlJvYm90byIgZmlsbD0iIzY2NjY2NiI+PHRzcGFuIGlkPSJ0c3BhbjQ2OTAiIHg9IjUwLjY0NjQ3NyIgeT0iOTcwLjcyODA5Ij5JbWFnZSBiYWNrZ3JvdW5kIDwvdHNwYW4+PHRzcGFuIGlkPSJ0c3BhbjQ2OTIiIHg9IjQ5LjM5NjQ3NyIgeT0iOTgzLjIyODA5Ij5pcyBub3QgY29uZmlndXJlZDwvdHNwYW4+PC90ZXh0PgogIDxyZWN0IGlkPSJyZWN0NDY5NCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgaGVpZ2h0PSIxOS4zNiIgd2lkdGg9IjY5LjM2IiBzdHJva2U9IiMwMDAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgeT0iOTkyLjY4IiB4PSIxNS4zMiIgc3Ryb2tlLXdpZHRoPSIuNjM5ODYiIGZpbGw9Im5vbmUiLz4KIDwvZz4KPC9zdmc+Cg==",
              "entityAliasId": null,
              "entityKey": null
            },
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "8907f9ef-da96-cd36-f2e5-0f98562adab7",
                "dsFilterId": null,
                "additionalDataSources": null,
                "additionalDataKeys": [
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "Name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.3890802019614742
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "Label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.6506428260689836
                  },
                  {
                    "name": "outsideTemp",
                    "type": "timeseries",
                    "label": "outsideTemp",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.061018203645811564
                  },
                  {
                    "name": "outsideHumidity",
                    "type": "timeseries",
                    "label": "outsideHumidity",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.14346424147794512
                  },
                  {
                    "name": "pressure",
                    "type": "timeseries",
                    "label": "pressure",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.21722794916539556
                  },
                  {
                    "name": "street",
                    "type": "attribute",
                    "label": "street",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.14202418527186
                  },
                  {
                    "name": "plz",
                    "type": "attribute",
                    "label": "plz",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7210111223754787
                  },
                  {
                    "name": "city",
                    "type": "attribute",
                    "label": "city",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.22879739402131516
                  },
                  {
                    "name": "state",
                    "type": "attribute",
                    "label": "state",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8789045079501805,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  },
                  {
                    "name": "criticalAlarmsCount",
                    "type": "timeseries",
                    "label": "criticalAlarmsCount",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.6997334255361404
                  },
                  {
                    "name": "majorAlarmsCount",
                    "type": "timeseries",
                    "label": "majorAlarmsCount",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.2673117032699961
                  },
                  {
                    "name": "minorAlarmsCount",
                    "type": "timeseries",
                    "label": "minorAlarmsCount",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.31055745147746605
                  },
                  {
                    "name": "warningAlarmsCount",
                    "type": "timeseries",
                    "label": "warningAlarmsCount",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8800091644051905
                  },
                  {
                    "name": "service",
                    "type": "attribute",
                    "label": "service",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.1367887202873057
                  }
                ],
                "label": {
                  "show": true,
                  "type": "function",
                  "pattern": "${entityName}",
                  "patternFunction": {
                    "body": "var state = data.State;\n\nif (data.service === \"true\" || data.Service === \"true\") {\n    state = \"service\";\n}\n\nvar color = utils.getStatusColors(state).color;\n\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \n           '${entityName}' + \n        '</span>';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                    }
                  }
                },
                "tooltip": {
                  "show": true,
                  "type": "function",
                  "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} C<br/><small>See tooltip settings for details</small>",
                  "patternFunction": "const pressure = data.pressure;\nconst longitude = data.longitude;\nconst latitude = data.latitude;           \nconst temperature = data.outsideTemp;\nconst humidity = data.outsideHumidity;\nconst name = data.name;\nconst street = data.street;\nconst plz = data.plz;\nconst city = data.city;\n// Alarms\nconst criticalAlarms = data.criticalAlarmsCount;\nconst majorAlarms = data.majorAlarmsCount;\nconst minorAlarms = data.minorAlarmsCount;\nconst warningAlarms = data.warningAlarmsCount;\n\n// Farben fr Alarms\nconst criticalAlarmsColor = '#FF0000'; // Rot\nconst criticalAlarmsBgColor = 'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\n\nconst majorAlarmsColor = '#FF8C00'; // Orange\nconst majorAlarmsBgColor = 'rgba(255, 140, 0, 0.1)'; // Transparenter Orange\n\nconst minorAlarmsColor = '#FFD700'; // Gold\nconst minorAlarmsBgColor = 'rgba(255, 215, 0, 0.1)'; // Transparenter Gold\n\nconst warningAlarmsColor = '#000000'; // Schwarz\nconst warningAlarmsBgColor = 'rgba(128, 128, 128, 0.1)'; // Transparenter Grau\n\nreturn '<div style=\"display:flex;flex-direction:column;margin-bottom:8px;font-family:\\'Roboto\\';font-weight:500;font-size:16px;line-height:24px;letter-spacing:0.25px;color:#29313C\">' +\n            '<div>${entityLabel}</div>' +\n            '<div style=\"width: 100%;border-bottom:1px solid rgba(0, 0, 0, 0.12);margin:12px 0;\"></div>' +\n            \n            '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n                '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Address</div>' +\n                '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">'+ street + ', ' + plz + ' ' + city + '</div>' +\n            '</div>' +\n            '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n                '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Critical Alarms</div>' +\n                '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ criticalAlarmsColor +';background-color:'+ criticalAlarmsBgColor +'\">' + criticalAlarms + '</div>' +\n            '</div>' +            \n            '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n                '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Major Alarms</div>' +\n                '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ majorAlarmsColor +';background-color:'+ majorAlarmsBgColor +'\">' + majorAlarms + '</div>' +\n            '</div>' +\n            '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n                '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Minor Alarms</div>' +\n                '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ minorAlarmsColor +';background-color:'+ minorAlarmsBgColor +'\">' + minorAlarms + '</div>' +\n            '</div>' +\n            '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n                '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Warning Alarms</div>' +\n                '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ warningAlarmsColor +';background-color:'+ warningAlarmsBgColor +'\">' + warningAlarms + '</div>' +\n            '</div>' +\n            '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n                '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Temperature</div>' +\n                '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">'+ temperature + ' C</div>' +\n            '</div>' +\n            '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n                '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Humidity</div>' +\n                '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">'+ humidity + ' % r.H.</div>' +\n            '</div>' +\n            /*'<div style=\"display: flex; justify-content: space-between; margin-top: 16px;\">' +\n                '<div style=\"flex: 1; display: flex; justify-content: center;\">' +\n                    '<link-act name=\"location-devices\">Devices</link-act>' +\n                '</div>' +\n                '<div style=\"flex: 1; display: flex; justify-content: center;\">' +\n                    '<link-act name=\"location-areas\">Areas</link-act>' +\n                '</div>' +\n            '</div>' +*/\n            /*'<div style=\"text-align: center\">' +\n                 '<link-act name=\"location-details\">Location Devices</link-act>' +\n           '</div>'*/\n        '</div>';\n",
                  "trigger": "click",
                  "autoclose": true,
                  "offsetX": 0,
                  "offsetY": -1,
                  "tagActions": [
                    {
                      "name": "location-details",
                      "type": "openDashboardState",
                      "targetDashboardStateId": "All Devices",
                      "setEntityId": true,
                      "stateEntityParamName": null,
                      "openRightLayout": false,
                      "openInSeparateDialog": false,
                      "openInPopover": false
                    }
                  ]
                },
                "click": {
                  "type": "doNothing"
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "add",
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "icon",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "iconContainer": "iconContainer4",
                  "icon": "location_city",
                  "size": 48,
                  "color": {
                    "type": "function",
                    "color": "#307FE5",
                    "rangeKey": null,
                    "range": null,
                    "colorFunction": {
                      "body": "var state = data.State;\n\nif (data.service === \"true\" || data.Service === \"true\") {\n    state = \"service\";\n}\n\nvar color = utils.getStatusColors(state).color;\n\nreturn color;",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                      }
                    }
                  }
                },
                "markerImage": {
                  "type": "image",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": true,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedLocation",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8922625682987039,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": true,
                    "postFuncBody": "if (value) {\n    return true;\n} else {\n    return false;\n}"
                  }
                ],
                "dsEntityAliasId": "33721d14-df94-e23d-f1b0-a13735f4b9cb"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [],
            "dragModeButton": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "8px"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": true,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {},
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "be207049-e858-e316-a7a4-b55b6de2c24f"
      },
      "6ef3c5d8-20a5-10ec-fedf-0d0bfd021aa5": {
        "typeFullFqn": "system.single_switch",
        "type": "rpc",
        "sizeX": 3.5,
        "sizeY": 1,
        "config": {
          "showTitle": false,
          "backgroundColor": "#ffffff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "initialState": {
              "action": "GET_ATTRIBUTE",
              "defaultValue": false,
              "executeRpc": {
                "method": "getState",
                "requestTimeout": 5000,
                "requestPersistent": false,
                "persistentPollingInterval": 1000
              },
              "getAttribute": {
                "key": "service",
                "scope": "SERVER_SCOPE"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "getAlarmStatus": {
                "severityList": null,
                "typeList": null
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "onUpdateState": {
              "action": "SET_ATTRIBUTE",
              "executeRpc": {
                "method": "setState",
                "requestTimeout": 5000,
                "requestPersistent": false,
                "persistentPollingInterval": 1000
              },
              "setAttribute": {
                "key": "service",
                "scope": "SERVER_SCOPE"
              },
              "putTimeSeries": {
                "key": "state"
              },
              "valueToData": {
                "type": "CONSTANT",
                "constantValue": true,
                "valueToDataFunction": "/* Convert input boolean value to RPC parameters or attribute/time-series value */\nreturn value;"
              }
            },
            "offUpdateState": {
              "action": "SET_ATTRIBUTE",
              "executeRpc": {
                "method": "setState",
                "requestTimeout": 5000,
                "requestPersistent": false,
                "persistentPollingInterval": 1000
              },
              "setAttribute": {
                "key": "service",
                "scope": "SERVER_SCOPE"
              },
              "putTimeSeries": {
                "key": "state"
              },
              "valueToData": {
                "type": "CONSTANT",
                "constantValue": false,
                "valueToDataFunction": "/* Convert input boolean value to RPC parameters or attribute/time-series value */ \n return value;"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "getAlarmStatus": {
                "severityList": null,
                "typeList": null
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "layout": "centered",
            "autoScale": false,
            "showLabel": false,
            "label": "Service",
            "labelFont": {
              "family": "Roboto",
              "size": 14,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "14px"
            },
            "labelColor": "rgb(255, 255, 255)",
            "showIcon": true,
            "iconSize": 20,
            "iconSizeUnit": "px",
            "icon": "mdi:account-wrench",
            "iconColor": "rgb(255, 255, 255)",
            "switchColorOn": "var(--tb-accent-500)",
            "switchColorOff": "#FFFFFF",
            "switchColorDisabled": "#F2F2F2",
            "tumblerColorOn": "#fff",
            "tumblerColorOff": "var(--tb-primary-500)",
            "tumblerColorDisabled": "#fff",
            "showOnLabel": false,
            "onLabel": "On",
            "onLabelFont": {
              "family": "Roboto",
              "size": 16,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "24px"
            },
            "onLabelColor": "rgba(0, 0, 0, 0.38)",
            "showOffLabel": false,
            "offLabel": "Off",
            "offLabelFont": {
              "family": "Roboto",
              "size": 16,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "24px"
            },
            "offLabelColor": "rgba(0, 0, 0, 0.38)",
            "background": {
              "type": "color",
              "color": "var(--tb-primary-500)",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              },
              "imageUrl": null
            },
            "padding": "0"
          },
          "title": "Single Switch",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "actions": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "configMode": "advanced",
          "datasources": [],
          "targetDevice": {
            "type": "entity",
            "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40"
          },
          "borderRadius": "999px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "6ef3c5d8-20a5-10ec-fedf-0d0bfd021aa5"
      },
      "00dd510f-1508-1302-2609-99b23d7a1477": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e8f543a9-82ff-0b69-d012-8349ea363657",
              "dataKeys": [
                {
                  "name": "sim_data_volume",
                  "type": "timeseries",
                  "label": "Data Usage",
                  "color": "#4CAF50",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": false,
                    "dataHiddenByDefault": false,
                    "type": "bar",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 5,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7477477558060515,
                  "aggregationType": null,
                  "units": "MB",
                  "decimals": 2,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 86400000,
              "timewindowMs": 2592000000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "MAX",
              "limit": 100
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "MB",
                "decimals": 2,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 18,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgb(3, 0, 0)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 14,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.85)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "min": 0,
                "max": null,
                "ticksGenerator": null,
                "interval": null,
                "splitNumber": 2
              }
            },
            "thresholds": [
              {
                "type": "constant",
                "yAxisId": "default",
                "units": "MB",
                "decimals": 0,
                "lineColor": "rgba(255, 0, 0, 0.76)",
                "lineType": "solid",
                "lineWidth": 1,
                "startSymbol": "none",
                "startSymbolSize": 5,
                "endSymbol": "arrow",
                "endSymbolSize": 5,
                "showLabel": true,
                "labelPosition": "end",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.76)",
                "enableLabelBackground": false,
                "labelBackground": "rgba(255,255,255,0.56)",
                "value": 500
              }
            ],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 20,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgb(0, 0, 0)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 14,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.7)",
              "ticksFormat": {
                "day": "d"
              },
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 8,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": false,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "point",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": false,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#FAFAFA",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              },
              "imageUrl": null
            },
            "padding": "0px"
          },
          "title": "Data Usage",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": false,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 100,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "12px"
            },
            "color": "rgb(0, 0, 0)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "00dd510f-1508-1302-2609-99b23d7a1477"
      },
      "60d322ca-a6d3-24c1-86ac-0b012662d778": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.9967549141360346
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.5624884360658327
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8984113434164049
                },
                {
                  "name": "displayName",
                  "type": "attribute",
                  "label": "displayName",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.25180997441907293
                },
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "status_battery_level",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.22071149447668148
                },
                {
                  "name": "status_margin",
                  "type": "timeseries",
                  "label": "status_margin",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.9146292142531982
                },
                {
                  "name": "battery",
                  "type": "timeseries",
                  "label": "battery",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8061053402016021
                },
                {
                  "name": "vpnIp",
                  "type": "attribute",
                  "label": "vpnIp",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.049656195239825895
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "meterType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.8248093970853291
                },
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "service",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.43793392037516243
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.13086289102320703
                },
                {
                  "name": "lastActivityTime",
                  "type": "attribute",
                  "label": "lastActivityTime",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.22434944053371275,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": {
                    "body": "return utils.unixToIso(value);",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                    }
                  }
                },
                {
                  "name": "rssi",
                  "type": "timeseries",
                  "label": "rssi",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.028010026066390692
                },
                {
                  "name": "snr",
                  "type": "timeseries",
                  "label": "snr",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.9752331552707985
                },
                {
                  "name": "sim",
                  "type": "attribute",
                  "label": "sim",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.5048478617351604
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "entityName",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.0627942695322049,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "e8f543a9-82ff-0b69-d012-8349ea363657",
              "dataKeys": [
                {
                  "name": "sim_ip",
                  "type": "attribute",
                  "label": "sim_ip",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.2563743905893755
                },
                {
                  "name": "sim_status",
                  "type": "attribute",
                  "label": "sim_status",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.3596255622913921
                },
                {
                  "name": "sim_provider",
                  "type": "attribute",
                  "label": "sim_provider",
                  "color": "#ff5722",
                  "settings": {},
                  "_hash": 0.09768258511490857
                },
                {
                  "name": "sim_data_volume",
                  "type": "timeseries",
                  "label": "sim_data_volume",
                  "color": "#9e9e9e",
                  "settings": {},
                  "_hash": 0.19807213083104602
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1711476503570,
                "endTimeMs": 1711562903570
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "var name, label, type, displayName, active, batteryLevel, linkMargin;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    type = data[0]['Type'];\n    displayName = data[0]['displayName'];\n    active = data[0]['active'];\n    batteryLevel = data[0]['status_battery_level'];\n    linkMargin = data[0]['status_margin'];\n    if (active === 'false') {\n        state = 'disconnected';\n    } else state = 'connected';\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    displayName = 'N/A';\n    active = 'N/A';\n    batteryLevel = 'N/A';\n    linkMargin = 'N/A';\n}\n\nvar displayBatteryLevel = showBatteryLevel(type);\n\nvar typeSvg = getTypeSvg(type);\n    var encodedTypeSvg = encodeURIComponent(typeSvg);\n    var typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + label + '</div>' +\n                   '<div class=\"subtitle\">' + displayName + '</div>' +\n                '</div>' +\n//                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-day\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">dashboard</mat-icon><span>Day</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-full\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">device-dashboard</mat-icon><span>Dashboard</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"settings\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">settings</mat-icon><span>Settings</span></button></div>' +\n                '</div>';\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n          header +\n          '<div fxLayout=\"row\" class=\"params\">' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Type: </div>' +\n                '<div class=\"param\">'+ type +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Label: </div>' +\n                '<div class=\"param\">'+ label +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">State: </div>' +\n                '<div class=\"param\">'+ getStateHtml(state) +'</div>' +\n              '</div>' +\n              (displayBatteryLevel ? ('<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Battery level: </div>' +\n                '<div class=\"param\">'+ getBatteryLevelHtml(batteryLevel) +'</div>' +\n              '</div>') : '') +\n          '</div>' +\n       '<div>';\n\nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Enginko LW06485_EV':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Elsys ERS Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Milesight EM300-TH':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Elsys ERS CO2 Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Milesight AM300':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M360-480q17 0 28.5-11.5T400-520v-120q0-17-11.5-28.5T360-680q-17 0-28.5 11.5T320-640v120q0 17 11.5 28.5T360-480Zm40 240h160v-80q0-33-23.5-56.5T480-400q-33 0-56.5 23.5T400-320v80Zm200-240q17 0 28.5-11.5T640-520v-120q0-17-11.5-28.5T600-680q-17 0-28.5 11.5T560-640v120q0 17 11.5 28.5T600-480ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z\"/></svg>';\n            break;\n        case 'Milesight WS522':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Dragino CPL01':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Adeunis Pulse':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-160h80v160h160v80H160ZM80-640v-160q0-33 23.5-56.5T160-880h160v80H160v160H80Zm360 436q-92-14-157-79t-79-157h80q12 59 54.5 101.5T440-284v80ZM204-520q14-92 79-157.5T440-756v80q-59 12-101.5 54.5T284-520h-80Zm276 120q-33 0-56.5-23.5T400-480q0-34 23.5-57t56.5-23q34 0 57 23t23 57q0 33-23 56.5T480-400Zm40 196v-80q59-12 101.5-54.5T676-440h80q-13 92-78.5 157T520-204Zm156-316q-12-59-54.5-101.5T520-676v-80q92 14 157.5 79T756-520h-80ZM640-80v-80h160v-160h80v160q0 33-23.5 56.5T800-80H640Zm160-560v-160H640v-80h160q33 0 56.5 23.5T880-800v160h-80Z\"/></svg>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-520q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM240-280v-76q0-21 10.5-39.5T279-425q45-26 95-40.5T480-480q56 0 106 14.5t95 40.5q18 11 28.5 29.5T720-356v76H240Zm609-354q-31-73-86.5-128.5T634-849l31-74q88 36 154.5 103T923-665l-74 31Zm-738 0-74-31q37-88 103.5-154.5T295-923l31 74q-73 31-128.5 86.5T111-634ZM295-37q-88-36-154.5-103T37-295l74-31q31 73 86.5 128.5T326-111l-31 74Zm370 0-31-74q73-31 128.5-86.5T849-326l74 31q-36 88-103 154.5T665-37Z\"/></svg>';\n            break;\n        case 'Innotas Modularis':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M491-200q12-1 20.5-9.5T520-230q0-14-9-22.5t-23-7.5q-41 3-87-22.5T343-375q-2-11-10.5-18t-19.5-7q-14 0-23 10.5t-6 24.5q17 91 80 130t127 35ZM480-80q-137 0-228.5-94T160-408q0-100 79.5-217.5T480-880q161 137 240.5 254.5T800-408q0 140-91.5 234T480-80Zm0-80q104 0 172-70.5T720-408q0-73-60.5-165T480-774Q361-665 300.5-573T240-408q0 107 68 177.5T480-160Zm0-320Z\"/></svg>';\n            break;\n        case 'Fludia FM432g':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Fludia FM432e':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM310-UDL':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight WS301':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-DI':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-ZLD':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KWZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC WMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC ELZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC GZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC Device':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return typeSvg;\n} \n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n    '</span>';\n}\n\nfunction getBatteryLevelHtml(batteryLevel) {\n    var batteryLevelNumber = Number(batteryLevel);\n    var batteryLevelSvg = getBatteryLevelSvg(batteryLevelNumber);\n    var encodedBatteryLevelSvg = encodeURIComponent(batteryLevelSvg);\n    var batteryLevelSvgUrl = 'data:image/svg+xml,' + encodedBatteryLevelSvg;\n    return '<div>' +\n              '<img class=\"mat-icon\" src=\"'+ batteryLevelSvgUrl +'\">' +\n              '<span style=\"padding-left: 8px; padding-right: 8px;\">' + batteryLevelNumber.toFixed(0) + '%</span>' +\n              '<button id=\"battery-level\" matTooltip=\"Battery Level History\" type=\"button\" mat-flat-button color=\"primary\"><mat-icon>bar_chart</mat-icon></button>' +\n            '</div>';\n}\n\n\nfunction getStateSvg(state) {\n    switch (state) {\n/*        \n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>'; \n*/\n        case 'connected':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getBatteryLevelSvg(batteryLevel) {\n    var batteryLevelSvg;\n    if (batteryLevel <= 5) {\n        batteryLevelSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 35) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#E64A19\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 65) {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#D5C21B\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#D5C21B\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#D5C21B\"/>';\n    } else if (batteryLevel <= 95) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 11H14V13H6V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 8H6V10H14V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#1F8B4D\"/>';\n    } else {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 8H14V10H6V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 5H6V7H14V5Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#1F8B4D\"/>';\n    }\n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n              batteryLevelSvg +\n            '</svg>';\n}\n\n\nfunction getStateLabel(state) {\n    switch(state) {\n/*        \n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n*/\n        case 'connected':\n            return 'Connected';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n\nfunction showBatteryLevel(deviceType) {\n    switch(deviceType) {\n        case 'Innotas Modularis':\n            return true;\n        case 'Fludia FM432g':\n            return true;\n        case 'Fludia FM432e':\n            return true;        \n        case 'Milesight EM310-UDL':\n            return true;\n        case 'Milesight WS301':\n            return true;\n        case 'Milesight EM300-DI':\n            return true;\n        case 'Milesight EM300-TH':\n            return true;\n        case 'Milesight EM300-ZLD':\n            return true;\n        case 'Enginko LW06485_EV':\n            return false;\n        case 'Dragino CPL01':\n            return true;\n        case 'Elsys ERS Lite':\n            return true;\n        case 'Elsys ERS CO2 Lite':\n            return true;\n        case 'Milesight WS522':\n            return false;\n        case 'MUC':\n            return false;\n        case 'MUC KWZ':\n            return false;\n        case 'MUC KMZ':\n            return false;\n        case 'MUC WMZ':\n            return false;\n        case 'MUC ELZ':\n            return false;\n        case 'MUC GZ':\n            return false;\n        case 'MUC Device':\n            return true;\n        case 'Door Sensor':\n            return true;\n        case 'Motion Sensor':\n            return true;\n        case 'Occupancy Sensor':\n            return true;\n        default:\n            return false;\n    }\n}   \n",
            "markdownTextFunction": {
              "body": "// === SIM popover  centered rows (Carrier, ICCID) + centered \"SIM Data Used\" card ===\n\nconst d = data?.[0] || {};\nconst s = data?.[1] || {};\nconst p = ctx.stateParams || {};\n\nconst tryJson = (v) => { if (v == null) return null; if (typeof v === 'object') return v; try { return JSON.parse(String(v)); } catch { return null; } };\nconst present = (v) => { const str = String(v ?? '').trim(); return !!str && !['n/a','null','undefined'].includes(str.toLowerCase()); };\n\n// --- derive fields ---\nconst simStatusObjRaw = tryJson(s.sim_status) || tryJson(p.sim_status) || null;\nconst simStatusObj = (simStatusObjRaw && (simStatusObjRaw.id != null || simStatusObjRaw.label))\n  ? simStatusObjRaw\n  : (Number.isFinite(Number(s.simStatus)) ? { id: Number(s.simStatus), label: 'N/A' } : null);\n\nconst simStatusId    = Number(simStatusObj?.id);\nconst simStatusLabel = simStatusObj?.label ?? 'N/A';\n\nconst providerObj     = tryJson(s.sim_provider) || tryJson(p.sim_provider) || null;\nconst simCarrierLabel = providerObj?.label ?? (p.carrier ?? 'N/A');\nconst isTechPlus      = (p.isTechPlus === true) || simCarrierLabel === 'tech+';\n\nconst rawIp   = (p.simIp && String(p.simIp).trim()) || s.simIp || s.sim_ip || '';\nconst hasIp   = present(rawIp);\nconst simOnline = hasIp && !isTechPlus;\n\nconst normalizeUrl = (ip) => /^https?:\\/\\//i.test(ip) ? ip : ('http://' + ip);\nconst simUrl = simOnline ? normalizeUrl(rawIp) : '';\n\nconst esc = (v) =>\n  String(v ?? '')\n    .replace(/&/g,'&amp;')\n    .replace(/</g,'&lt;')\n    .replace(/>/g,'&gt;')\n    .replace(/\"/g,'&quot;')\n    .replace(/'/g,'&#39;');\n\nconst mkCopyInline = (label, value) => {\n  const safeVal = esc(value);\n  const safeLabel = esc(label);\n  return '' +\n    '<span class=\"copy-inline\" data-val=\"'+ safeVal +'\">' +\n      '<span class=\"copy-text\">'+ safeVal +'</span>' +\n      '<button type=\"button\" class=\"copy-ico\" title=\"Copy '+ safeLabel +'\" aria-label=\"Copy '+ safeLabel +'\" '+\n        'onclick=\"(function(btn){' +\n          'var wrap = btn.parentElement;' +\n          'if(!wrap) return;' +\n          'var val = wrap.getAttribute(\\'data-val\\') || \\'\\';' +\n          'var old = btn.innerHTML;' +\n          'function ok(){ btn.innerHTML = \\'<span class=&quot;material-icons&quot;>check</span>\\'; btn.style.opacity = 1; btn.style.color = \\'green\\'; setTimeout(function(){ btn.innerHTML = old; }, 1200); }' +\n          'function fail(){ btn.innerHTML = \\'<span class=&quot;material-icons&quot;>error</span>\\'; setTimeout(function(){ btn.innerHTML = old; }, 1200); }' +\n          'if (navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(val).then(ok, fail); }' +\n          'else {' +\n            'try {' +\n              'var ta = document.createElement(\\'textarea\\'); ta.value = val; ta.style.position = \\'fixed\\'; ta.style.opacity = 0; document.body.appendChild(ta);' +\n              'ta.focus(); ta.select(); var okCmd = document.execCommand && document.execCommand(\\'copy\\');' +\n              'document.body.removeChild(ta); okCmd ? ok() : fail();' +\n            '} catch(e){ fail(); }' +\n          '}' +\n        '})(this)\">' +\n        '<span class=\"material-icons\">content_copy</span>' +\n      '</button>' +\n    '</span>';\n};\n\nconst simIccid = present(s.simIccid) ? s.simIccid : ((tryJson(d.sim)?.iccid) ?? p.iccid ?? 'N/A');\n\n// colors\nconst COLOR_GREEN = '#4caf50';\nconst COLOR_BLUE  = '#3498db';\nconst COLOR_GREY  = '#9e9e9e';\nconst COLOR_RED   = '#ff0000';\n\nconst simDataVolume = p.sim_data_volume ?? s.sim_data_volume;\n\nconst statusColor = isTechPlus\n  ? COLOR_BLUE\n  : (simStatusId === 2 ? (simOnline ? COLOR_GREEN : COLOR_GREY)\n     : (simStatusId === 5 ? COLOR_RED : COLOR_BLUE));\n\n// Tooltip: only \"Open [IP]\" when enabled\nconst openTooltip = simOnline ? ('Open ' + rawIp) : '';\n\n// --- rows ---\nconst rows = [];\n\n// Row 1: Carrier + Status (centered row, compact columns)\nlet carrierStatusVal = '';\ncarrierStatusVal += (present(simCarrierLabel) ? '<span class=\"chip\">'+simCarrierLabel+'</span>' : '');\ncarrierStatusVal += '<span class=\"sep\"></span>';\ncarrierStatusVal += '<span class=\"field\">Status:</span> <span class=\"sim-badge\" style=\"background:'+statusColor+';\">'+simStatusLabel+'</span>';\nrows.push({ k: 'Carrier', vHtml: carrierStatusVal, cls: 'kv-row--center' });\n\nif (present(simIccid)) {\n  rows.push({\n    k: 'ICCID',\n    vHtml: mkCopyInline('ICCID', String(simIccid)),\n    cls: 'kv-row--center'\n  });\n}\n\n\n// --- buttons (outlined TB/Material look) ---\nconst showOpen = !isTechPlus;\nconst openDisabled = showOpen && !simOnline;\n\n// Use an <a> when enabled so middle-click / context menu Open Link just works.\n// Fall back to a disabled <button> when offline or no IP.\nconst openBtn = showOpen ? (\n  simOnline\n    ? '<a id=\"sim-open-ui\" data-action=\"sim-open\" ' +\n        'href=\"'+simUrl.replace(/\"/g,'&quot;')+'\" target=\"_blank\" rel=\"noopener noreferrer\" ' +\n        'mat-stroked-button class=\"tb-btn tb-outline lg link-btn\" ' +\n        (openTooltip ? ('matTooltip=\"'+openTooltip.replace(/\"/g,'&quot;')+'\" matTooltipClass=\"sim-tooltip\" matTooltipPosition=\"below\" ') : '') +\n      '>' +\n        '<mat-icon>open_in_new</mat-icon><span>Web</span>' +\n      '</a>'\n    : '<button id=\"sim-open-ui\" type=\"button\" mat-stroked-button class=\"tb-btn tb-outline lg disabled\" disabled>' +\n        '<mat-icon>open_in_new</mat-icon><span>Web</span>' +\n      '</button>'\n) : '';\n\n\nconst configBtn =\n  '<button id=\"sim-config\" type=\"button\" mat-stroked-button class=\"tb-btn tb-outline\">' +\n    '<mat-icon>tune</mat-icon><span class=\"btn-label\">Config</span>' +\n  '</button>';\n\nconst refreshBtn =\n  '<button id=\"sim-refresh\" type=\"button\" mat-stroked-button class=\"tb-btn tb-outline\">' +\n    '<mat-icon>refresh</mat-icon><span class=\"btn-label\">Refresh</span>' +\n  '</button>';\n\n// assemble rows html\nlet infoHtml = '';\nfor (const r of rows) {\n  const val = r.vHtml ?? (r.v != null ? String(r.v) : '');\n  infoHtml += '<div class=\"kv-row ' + (r.cls || '') + '\"><div class=\"k\">'+r.k+'</div><div class=\"v\">'+val+'</div></div>';\n}\n\n// Chart card (centered, slightly narrower to avoid clipping)\nconst chartCard =\n  '<div class=\"usage-card\">' +\n    '<div class=\"usage-label\"><span class=\"usage-key\">Data Used:</span>' +\n      (present(simDataVolume) ? ' <span class=\"usage-val\">'+simDataVolume+' MB</span>' : '') +\n    '</div>' +\n    '<div class=\"usage-embed\">' +\n      '<tb-dashboard-state ' +\n        'style=\"display:block;width:96%;height:140px;border:0;outline:none;overflow:hidden;box-sizing:border-box;margin:0 auto;\" ' +\n        '[ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"SIM Data Usage\">' +\n      '</tb-dashboard-state>' +\n    '</div>' +\n  '</div>';\n\n// actions\nconst actionsHtml =\n  '<div class=\"actions-row\">'+\n    '<div class=\"actions-slot left\">'   + (showOpen ? openBtn : '') + '</div>'+\n    '<div class=\"actions-slot center\">' + configBtn + '</div>'+\n    '<div class=\"actions-slot right\">'  + refreshBtn + '</div>'+\n  '</div>';\n\n// final html\nconst html =\n  '<div class=\"sim-wrap\">'+\n    '<div class=\"sim-panel\">'+\n      '<div class=\"kv-grid\">'+ infoHtml + '</div>'+\n      chartCard +\n      actionsHtml +\n    '</div>'+\n  '</div>'+\n  '<script>(function(){' +\n    'var b=document.getElementById(\"sim-open-ui\");' +\n    'if(b && !b.classList.contains(\"disabled\")){' +\n      'var u=b.getAttribute(\"data-url\");' +\n      'if(u){ b.addEventListener(\"click\", function(){ window.open(u, \"_blank\", \"noopener\"); }); }' +\n    '}' +\n  '})();</script>';\n\nreturn html;\n",
              "modules": {
                "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* === Layout containers === */\n.sim-wrap{ width:100%; display:flex; justify-content:center; }\n.sim-panel{ max-width:400px; padding:10px 12px; box-sizing:border-box; }\n\n/* === Key/Value grid === */\n.kv-grid{ display:grid; grid-template-columns:1fr; gap:8px; margin-bottom:10px; }\n.kv-row{\n  display:grid; grid-template-columns:140px 1fr; gap:10px; align-items:center;\n  padding:6px 8px; border:1px solid rgba(0,0,0,0.06); border-radius:99px; background:rgba(0,0,0,0.02);\n}\n.kv-row .k{ font-weight:600; opacity:.9; text-align:right; white-space:nowrap; }\n.kv-row .v{ display:inline-flex; gap:10px; align-items:center; flex-wrap:wrap; }\n\n/* Center the entire row & keep it compact (used for Carrier + ICCID) */\n.kv-row.kv-row--center{\n  grid-template-columns:max-content max-content;\n  justify-content:center;\n  gap:8px;\n}\n.kv-row.kv-row--center .k{ text-align:right; padding-right:6px; }\n.kv-row.kv-row--center .v{ display:inline-flex; align-items:center; gap:10px; }\n\n/* === Inline bits === */\n.field{ font-weight:600; opacity:.9; }\n.sep{ opacity:.4; }\n\n/* === Badges / chips === */\n.sim-badge{\n  display:inline-block; padding:3px 12px; color:#fff;\n  border-radius:999px; font-size:14px; line-height:20px;\n}\n.chip{\n  display:inline-block; padding:3px 10px; border-radius:999px;\n  font-size:14px; line-height:20px; background:rgba(0,0,0,0.08);\n}\n\n/* === Data Usage card (full-width like kv-row) === */\n.usage-card{\n  width:100%; margin:0 0 10px 0;\n  display:flex; flex-direction:column; gap:6px;\n  padding:6px 8px; border:1px solid rgba(0,0,0,0.06);\n  border-radius:20px; background:rgba(0,0,0,0.02); box-sizing:border-box;\n}\n.usage-label{ text-align:center; margin-bottom:0px; }\n.usage-key{ font-weight:600; margin-bottom:0px;  }\n.usage-val{ font-weight:400; }\n.usage-embed{ width:100%; height:140px; border-radius:6px; overflow:hidden; box-sizing:border-box; }\n\n/* === Actions row: 3 fixed slots; buttons fill; labels ellipsis; never overflow === */\n.actions-row{\n  width:100%;\n  min-width:0;              /* allow the grid to shrink within the panel */\n  overflow:hidden;          /* prevent spill outside panel */\n  display:grid;\n  grid-template-columns:1fr 1fr 1fr;\n  gap:10px;\n  align-items:stretch;\n}\n.actions-slot{ min-width:0; }  /* each slot may shrink */\n.actions-slot .tb-btn{\n  width:100%;\n  max-width:100%;\n  min-width:0;              /* critical for ellipsis */\n  overflow:hidden;          /* clip excess content */\n  box-sizing:border-box;\n  display:inline-flex;\n}\n.actions-slot.left  .tb-btn{ justify-content:flex-start; }\n.actions-slot.center .tb-btn{ justify-content:center; }\n.actions-slot.right .tb-btn{ justify-content:flex-end; }\n\n/* Buttons (TB/Material outlined look) */\n.tb-btn{\n  display:inline-flex; align-items:center; gap:8px;\n  padding:6px 14px; border-radius:99px; font:inherit; font-size:14px;\n}\n.tb-btn.lg{ padding:8px 16px; font-size:15px; }\n.tb-outline{ border:1px solid rgba(0,0,0,0.18); background:#fff; }\n.tb-outline:hover{ background:rgba(0,0,0,0.03); }\n.tb-btn.disabled, .tb-btn[disabled]{ opacity:.55; cursor:not-allowed; }\n\n/* Icons stay visible; label truncates with  */\n.tb-btn mat-icon,\n.tb-btn .mat-icon,\n.tb-btn .material-icons{ font-size:18px; line-height:18px; flex:0 0 auto; }\n\n.tb-btn .btn-label{\n  flex:1 1 auto;           /* take remaining space but allow shrinking */\n  min-width:0; max-width:100%;\n  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;\n}\n\n/* Tooltip text */\n.sim-tooltip{ white-space: pre-line; }\n\n/* Inline copy UI for ICCID */\n.copy-inline {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.copy-text {\n  max-width: 360px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.copy-ico {\n  border: 0;\n  background: transparent;\n  padding: 0 2px;\n  margin: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  line-height: 1;\n  cursor: pointer;\n  opacity: 0.7;\n  transition: opacity 0.15s ease;\n}\n\n.copy-ico:hover { opacity: 1; }\n\n/* keep copy icon as-is */\n.copy-ico .material-icons {        /* content_copy */\n  font-size: 16px;\n  line-height: 16px;\n  vertical-align: middle;\n  color: var(--tb-primary-500);\n}\n\n.copy-ico .material-icons.check {\n  font-size: 10px;\n  line-height: 10px;\n  transform: scale(0.8) translateY(1px);\n  color: green;\n}\n\n.copy-ico .material-icons.error {  /* error */\n  font-size: 12px;                 /* usually looks okay slightly larger than check */\n  line-height: 12px;\n  transform: translateY(1px);\n}\n\n\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "sim-config",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.simConfig(widgetContext);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a29bf98c-fecf-7b56-1201-d3ef48d5feef"
              },
              {
                "name": "sim-refresh",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.refreshSIM(widgetContext, entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d97040ed-7a26-ec61-a47f-425a7d1c65ad"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "60d322ca-a6d3-24c1-86ac-0b012662d778"
      },
      "f94afe58-8ca1-8b65-981d-f99db18957ae": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709567704757,
                "endTimeMs": 1709654104757
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": false,
          "backgroundColor": null,
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "entitiesTitle": "{i18n:custom.customer-table.titel}",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": false,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Entities table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b47c9356-4593-2971-f5f6-ffbccfa1c3e3",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "{i18n:custom.customer-table.name}",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.42288784682818004,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "eeProjectGuid",
                  "type": "attribute",
                  "label": "{i18n:custom.energyExpertGuid}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": false,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active !== '') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.7830527220898056,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "weatherAPIToken",
                  "type": "attribute",
                  "label": "Weather API",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.05349888764908273,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return \"true\";\n} else return \"false\";"
                },
                {
                  "name": "solarEdgeAPIToken",
                  "type": "attribute",
                  "label": "SolarEdge API",
                  "color": "#607d8b",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.3755621555560362,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return \"true\";\n} else return \"false\";"
                },
                {
                  "name": "froniusAPIToken",
                  "type": "attribute",
                  "label": "Fronius API",
                  "color": "#9c27b0",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.825358837312341,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return \"true\";\n} else return \"false\";"
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:custom.state}",
                  "color": "#9c27b0",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar bgColor;\r\nvar status;\r\nvar state = value;\r\n\r\nswitch (state) {\r\n  case 'normal':\r\n    color = '#27AE60'; // Grn\r\n    bgColor = 'rgba(39, 174, 96, 0.1)'; // Transparenter Grn\r\n    status = 'Normal';\r\n    break;\r\n  case 'critical':\r\n    color = '#FF0000'; // Rot\r\n    bgColor = 'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\r\n    status = 'Critical';\r\n    break;\r\n  case 'major':\r\n    color = '#FF8C00'; // Dunkelorange\r\n    bgColor = 'rgba(255, 140, 0, 0.1)'; // Transparenter Dunkelorange\r\n    status = 'Major';\r\n    break;\r\n  case 'minor':\r\n    color = '#FFD700'; // Dunkelgelb (Gold)\r\n    bgColor = 'rgba(255, 215, 0, 0.1)'; // Transparenter Dunkelgelb\r\n    status = 'Minor';\r\n    break;\r\n  default:\r\n    color = '#808080'; // Grau\r\n    bgColor = 'rgba(128, 128, 128, 0.1)'; // Transparenter Grau\r\n    status = 'N/A';\r\n    break;\r\n}\r\n\r\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\r\n            status + '</div>';\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.3181245783547073,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "{i18n:alarm.severity-critical}",
                  "color": "#8bc34a",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color = '#FF0000'; // Rot\nvar bgColor = 'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\n\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\n            value + '</div>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.44234654540187734,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "{i18n:alarm.severity-major}",
                  "color": "#3f51b5",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color = '#FF8C00'; // Rot\nvar bgColor = 'rgba(255, 140, 0, 0.1)'; // Transparenter Rot\n\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\n            value + '</div>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.514759868184639,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "timeseries",
                  "label": "{i18n:alarm.severity-minor}",
                  "color": "#e91e63",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color = '#FFD700'; // Rot\nvar bgColor = 'rgba(255, 215, 0, 0.1)'; // Transparenter Rot\n\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\n            value + '</div>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.3206122670836671,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "rowClick": [
              {
                "name": "Open Customer Locations Double Click",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Locations",
                "setEntityId": true,
                "stateEntityParamName": "selectedCustomer",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "22f6f300-70b6-afd3-87fc-6386e14c056e"
              }
            ],
            "actionCellButton": [
              {
                "name": "Open Customer Locations",
                "icon": "domain",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Locations",
                "setEntityId": true,
                "stateEntityParamName": "selectedCustomer",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "de0f3476-660b-0918-b2d8-418ee39a7cf2"
              },
              {
                "name": "Open Customer Devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Devices",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "dd654772-1054-b0f5-d0db-dba5e029ea2e"
              },
              {
                "name": "{i18n:custom.customer-table.edit-customer.titel}",
                "icon": "edit",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.editCustomer(widgetContext,entityId);\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "8c6f10e1-81e9-c5f5-9f46-78b3574e9b5e"
              },
              {
                "name": "{i18n:custom.changeEEProjectGuid.titel}",
                "icon": "mdi:card-account-details",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeEEProjectGuid(widgetContext,entityId,entityName);\r\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "07df3fee-e649-755b-f4cc-fba4e15138d5"
              },
              {
                "name": "Resend Data",
                "icon": "schedule_send",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.resendDataEntity(widgetContext, entityId);\n\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1114cd1e-2301-9559-3b41-f18243933d2d"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.customer-table.add-customer.titel}",
                "buttonType": "icon",
                "icon": "person_add_alt_1",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addCustomer(widgetContext);\r\n ",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c9bfa1cd-3803-e9a1-586d-cc42174ea185"
              }
            ],
            "rowDoubleClick": []
          },
          "showTitleIcon": true,
          "titleIcon": "people",
          "iconColor": null,
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "f94afe58-8ca1-8b65-981d-f99db18957ae"
      },
      "8c148321-ac09-da0f-ff74-cea71787d0cb": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1749125522312,
                "endTimeMs": 1749211922312
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": true,
            "entitiesTitle": null,
            "alarmsTitle": "Alarms"
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "b47c9356-4593-2971-f5f6-ffbccfa1c3e3",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "{i18n:alarm.created-time}",
                "color": "#2196f3",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "5%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var date = new Date(value); // value = 1761126400810\r\n\r\nvar dd   = String(date.getDate()).padStart(2, '0');\r\nvar mm   = String(date.getMonth() + 1).padStart(2, '0');\r\nvar yy   = String(date.getFullYear()).slice(-2);\r\n\r\nvar hh   = String(date.getHours()).padStart(2, '0');\r\nvar min  = String(date.getMinutes()).padStart(2, '0');\r\nvar ss   = String(date.getSeconds()).padStart(2, '0');\r\n\r\nvar formatted = dd + '/' + mm + '/' + yy + '<br>' + hh + ':' + min + ':' + ss;\r\n\r\nreturn formatted;\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.021092237451093787,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "40%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.2780007688856758,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var type = alarm.type || '';\r\nvar severity = alarm.severity;\r\n\r\nvar color;\r\nvar bgColor;\r\n\r\nswitch (severity) {\r\n  case 'CRITICAL':\r\n    color = '#FF0000';\r\n    bgColor = 'rgba(255, 0, 0, 0.1)';\r\n    break;\r\n  case 'MAJOR':\r\n    color = '#FF8C00';\r\n    bgColor = 'rgba(255, 140, 0, 0.1)';\r\n    break;\r\n  case 'MINOR':\r\n    color = '#FFD700';\r\n    bgColor = 'rgba(255, 215, 0, 0.1)';\r\n    break;\r\n  default:\r\n    color = '#666666'; // fallback for unknown severities\r\n    bgColor = 'rgba(0, 0, 0, 0.05)';\r\n}\r\n\r\nreturn (\r\n  '<div class=\"typeIcon\"' +\r\n  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;' +\r\n  ' padding:4px 8px; border-radius:8px; line-height:20px;' +\r\n  ' font-size:14px; font-weight:500; letter-spacing:0.25px;' +\r\n  ' color:' + color + '; background-color:' + bgColor + ';\">' +\r\n  '<span class=\"material-icons\" style=\"font-size:20px; vertical-align:middle;\"></span>' +\r\n  type +\r\n  '</div>'\r\n);\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.7323586880398418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "hidden",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.alarm-status}",
                "color": "#607d8b",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.6588418951443418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "{i18n:alarm.assigned}",
                "color": "#9c27b0",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "15%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.5008441077416634,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": true,
          "titleIcon": "warning",
          "iconColor": null,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {
            "headerButton": [
              {
                "name": "Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "warning",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "75f33890-1b6b-11f0-be11-edd54271a72a",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b0afe3a6-4db7-4798-f1bb-1f508d441f73"
              }
            ]
          },
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "CRITICAL",
              "MAJOR",
              "MINOR"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "8c148321-ac09-da0f-ff74-cea71787d0cb"
      },
      "176fbb8f-6463-2365-df92-c0020ebba277": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709568236338,
                "endTimeMs": 1709654636338
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "entitiesTitle": "{i18n:custom.location-table.titel}",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": null,
            "pageStepCount": 3,
            "pageStepIncrement": 12,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.location-table.titel}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "8907f9ef-da96-cd36-f2e5-0f98562adab7",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:custom.state}",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "10%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "var state = value;\r\n\r\nif (entity.service === \"true\" || entity.Service === \"true\") {\r\n    state = \"service\";\r\n} \r\n\r\nvar color = utils.getStatusColors(state).color;\r\nvar bgColor = utils.getStatusColors(state).bgColor;\r\nvar status = utils.getStatusColors(state).status;\r\n\r\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\r\n            status + '</div>';",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.36732457718012945,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "{i18n:custom.location-table.name}",
                  "color": "#2196f3",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "45%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.7428807538649616,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "{i18n:custom.location-table.label}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "45%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.658857827908051,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "service",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.06638380001590816,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "actionCellButton": [
              {
                "name": "Open Location Devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Devices",
                "setEntityId": true,
                "stateEntityParamName": "",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "13b88532-90c1-0715-e0a1-8b1a98e77f60"
              },
              {
                "name": "{i18n:custom.location-table.edit-location.titel}",
                "icon": "edit",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.editLocation(widgetContext,entityId,entityName,entityLabel);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "ce62ddd4-4697-2f5d-4ca5-665dae4c3be7"
              },
              {
                "name": "{i18n:custom.location-table.change-mode.titel}",
                "icon": "mdi:account-wrench",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeMode(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "410bc3e0-cbb4-3090-8e72-4a544ee3aa38"
              },
              {
                "name": "{i18n:custom.changeEEProjectGuid.titel}",
                "icon": "mdi:card-account-details",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeSpecificEEProjectGuid(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "41726d63-0fb7-5f85-c995-9f56433a5056"
              },
              {
                "name": "{i18n:custom.resendData.titel}",
                "icon": "schedule_send",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.resendDataEntity(widgetContext, entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f8dd3839-b697-6a65-2922-e08602c9612f"
              },
              {
                "name": "Export Data",
                "icon": "file_download",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "exportTelemetry(widgetContext, entityId);\r\nfunction exportTelemetry(widgetContext, entityId) {\r\n  // 1) CSS (ASCII-only, single \\n)\r\n  const cssStr =\r\n    '.export-telemetry .mdc-text-field--filled.mdc-text-field--disabled {\\n' +\r\n    '  background-color: rgba(244, 249, 254, 0.5) !important;\\n' +\r\n    '}\\n' +\r\n    '.export-telemetry .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\\n' +\r\n    '  background-color: rgba(244, 249, 254, 0.5) !important;\\n' +\r\n    '}\\n' +\r\n    '.export-telemetry .mdc-text-field--filled:not(.mdc-text-field--disabled) {\\n' +\r\n    '  background-color: #F4F9FE !important;\\n' +\r\n    '}\\n' +\r\n    '.export-telemetry .mat-mdc-form-field-focus-overlay {\\n' +\r\n    '  background-color: #F4F9FE !important;\\n' +\r\n    '}\\n' +\r\n    '.fieldset {\\n' +\r\n    '  border: 1px solid #e2e8f0;\\n' +\r\n    '  background: #ffffff;\\n' +\r\n    '  color: #334155;\\n' +\r\n    '  border-radius: 6px;\\n' +\r\n    '  padding: 8px 10px 12px;\\n' +\r\n    '}\\n' +\r\n    '.fieldset-legend {\\n' +\r\n    '  margin-bottom: 6px;\\n' +\r\n    '  color: #334155;\\n' +\r\n    '  background: #ffffff;\\n' +\r\n    '  font-weight: 500;\\n' +\r\n    '  border-radius: 6px;\\n' +\r\n    '  padding: 2px 6px;\\n' +\r\n    '}\\n' +\r\n    '.muted { color: #64748b; }\\n' +\r\n    '.w-900 { width: 900px; }\\n' +\r\n    '.review-card { margin-top: 10px; }\\n' +\r\n    '.review-grid { display: grid; grid-template-columns: 220px 1fr; grid-row-gap: 8px; grid-column-gap: 16px; }\\n' +\r\n    '.review-label { font-weight: 500; }\\n' +\r\n    '.chips { margin-top: 6px; }\\n' +\r\n    '/* General layout helpers */\\n' +\r\n    '.row { display: flex; align-items: flex-start; gap: 16px; width: 100%; }\\n' +\r\n    '.section-block { margin-bottom: 16px; }\\n' +\r\n    '.row .mat-mdc-form-field, .row .mat-form-field { flex: 0 0 auto; width: 260px; }\\n' +\r\n    '@media (max-width: 900px) { .row { flex-direction: column; } .row .mat-mdc-form-field { width: 100%; } }\\n' +\r\n    '/* Step 2: full-width responsive grid */\\n' +\r\n    '.step-two-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); grid-column-gap: 16px; grid-row-gap: 16px; width: 100%; }\\n' +\r\n    '.step-two-grid .mat-mdc-form-field, .step-two-grid .mat-form-field { width: 100%; }\\n' +\r\n    '.span-2 { grid-column: 1 / -1; }\\n' +\r\n    '@media (max-width: 900px) { .step-two-grid { grid-template-columns: 1fr; } .span-2 { grid-column: 1 / -1; } }\\n' +\r\n    '/* Make long mat-hints wrap and never cut */\\n' +\r\n    '.hint-wrap .mat-mdc-form-field-subscript-wrapper { white-space: normal; overflow: visible; text-overflow: clip; }\\n' +\r\n    '.hint-wrap .mat-mdc-form-field-hint { white-space: normal; }\\n' +\r\n    '/* Preview box: full width, wraps and never juts out */\\n' +\r\n    '.format-preview { width: 100%; box-sizing: border-box; background: #F8FAFC; border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px; min-height: 96px; max-height: 240px; overflow-y: auto; overflow-x: hidden; margin-top: 8px; }\\n' +\r\n    '.format-preview pre { margin: 0; white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; font-size: 12px; line-height: 1.35; }\\n' +\r\n    '.below-note { color: #6b7280; font-size: 12px; margin: 4px 0 10px; }\\n';\r\n\r\n  const cssParser = new cssjs();\r\n  cssParser.testMode = false;\r\n  cssParser.cssPreviewNamespace = 'export-telemetry';\r\n  cssParser.createStyleElement('export-telemetry', cssStr, 'nonamespace');\r\n\r\n  // 2) HTML (ASCII-only)\r\n  const htmlTemplate =\r\n`<form #exportForm=\"ngForm\" class=\"export-telemetry max-w-3xl mx-auto w-900\">\r\n  <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n    <h2 class=\"text-lg font-semibold\">Export Telemetry</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n  <div mat-dialog-content class=\"flex flex-col w-900\">\r\n    <form [formGroup]=\"mainForm\" (ngSubmit)=\"exportData()\">\r\n\r\n      <mat-horizontal-stepper [linear]=\"true\" #stepper>\r\n\r\n        <!-- Step 1: Select datapoints grouped by device profile -->\r\n        <mat-step [stepControl]=\"timeseriesFormGroup\">\r\n          <ng-template matStepLabel><b>Select datapoints</b></ng-template>\r\n          <form [formGroup]=\"timeseriesFormGroup\">\r\n            <div class=\"flex w-full justify-end items-center\" style=\"margin-bottom: 8px;\">\r\n              <span>\r\n                <button mat-stroked-button type=\"button\" (click)=\"toggleSelectAll(true)\">Select all</button>\r\n                <button mat-button type=\"button\" (click)=\"toggleSelectAll(false)\">Clear</button>\r\n              </span>\r\n            </div>\r\n\r\n            <mat-accordion multi=\"true\">\r\n              <mat-expansion-panel *ngFor=\"let p of profileNames\" [expanded]=\"true\">\r\n                <mat-expansion-panel-header>\r\n                  <mat-panel-title>\r\n                    {{ p }} ({{ profileKeysMap[p]?.length || 0 }})\r\n                  </mat-panel-title>\r\n                </mat-expansion-panel-header>\r\n\r\n                <div *ngIf=\"profileKeysMap[p]?.length\">\r\n                  <div class=\"flex flex-row gap-2\" style=\"margin: 4px 0 10px 0;\">\r\n                    <button mat-stroked-button type=\"button\" (click)=\"selectAllInProfile(p)\">Select all</button>\r\n                    <button mat-button type=\"button\" (click)=\"clearAllInProfile(p)\">Clear</button>\r\n                  </div>\r\n\r\n                  <div *ngFor=\"let k of profileKeysMap[p]\" style=\"margin-bottom: 8px;\">\r\n                    <mat-checkbox [formControlName]=\"controlName(p, k)\">{{ k }}</mat-checkbox>\r\n                  </div>\r\n                </div>\r\n                <div *ngIf=\"!profileKeysMap[p]?.length\" style=\"padding: 8px; color: #64748b;\">\r\n                  No Timeseries\r\n                </div>\r\n              </mat-expansion-panel>\r\n            </mat-accordion>\r\n\r\n            <div class=\"flex w-full justify-between gap-2\" style=\"margin-top: 12px;\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <div class=\"flex gap-2\">\r\n                <button mat-button matStepperNext [disabled]=\"!hasSelectedTimeseries()\">Next</button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <!-- Step 2: Time window, interval, timestamp format -->\r\n        <mat-step [stepControl]=\"timeForm\">\r\n          <ng-template matStepLabel><b>Select period</b></ng-template>\r\n          <form [formGroup]=\"timeForm\">\r\n            <section class=\"section-block\">\r\n              <div class=\"step-two-grid\">\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Date From</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Time From</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Date To</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Time To</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Sending interval (min)</mat-label>\r\n                  <input matInput type=\"number\" formControlName=\"intervalMin\" min=\"0\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Timestamp format</mat-label>\r\n                  <mat-select formControlName=\"tsFormat\" (selectionChange)=\"onTsFormatChange()\">\r\n                    <mat-option value=\"yy/MM/dd HH:mm:ss\">yy/MM/dd HH:mm:ss</mat-option>\r\n                    <mat-option value=\"dd/MM/yy HH:mm:ss\">dd/MM/yy HH:mm:ss</mat-option>\r\n                    <mat-option value=\"dd/MM/yyyy HH:mm:ss\">dd/MM/yyyy HH:mm:ss</mat-option>\r\n                    <mat-option value=\"yyyy/MM/dd HH:mm:ss\">yyyy/MM/dd HH:mm:ss</mat-option>\r\n                    <mat-option value=\"yyyy-MM-dd HH:mm:ss\">yyyy-MM-dd HH:mm:ss</mat-option>\r\n                    <mat-option value=\"custom\">custom</mat-option>\r\n                    <mat-option value=\"none\">none</mat-option>\r\n                  </mat-select>\r\n                  <mat-hint>Presets or choose custom with tokens below.</mat-hint>\r\n                </mat-form-field>\r\n              </div>\r\n            </section>\r\n\r\n            <section class=\"section-block\" *ngIf=\"timeForm.get('tsFormat').value === 'custom'\">\r\n              <div class=\"step-two-grid\">\r\n                <mat-form-field class=\"hint-wrap span-2\" appearance=\"fill\">\r\n                  <mat-label>Custom format pattern</mat-label>\r\n                  <input matInput formControlName=\"customFormat\" (input)=\"validateCustomFormat()\">\r\n                  <mat-hint>\r\n                    Tokens supported: yyyy, yy, MM, dd, HH, mm, ss, SSS. You can mix with literals like space, -, :, /, ., T, Z, _. Example: yyyy/MM/dd HH:mm:ss\r\n                  </mat-hint>\r\n                  <mat-error *ngIf=\"customFormatInvalid\">{{ customFormatError }}</mat-error>\r\n                </mat-form-field>\r\n                <mat-form-field class=\"span-2\" appearance=\"fill\">\r\n                  <mat-label>Preview</mat-label>\r\n                  <input matInput [value]=\"customPreview\" disabled>\r\n                </mat-form-field>\r\n              </div>\r\n            </section>\r\n\r\n            <div class=\"flex w-full justify-between gap-2\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <div class=\"flex gap-2\">\r\n                <button mat-button matStepperPrevious>Back</button>\r\n                <button mat-button matStepperNext (click)=\"prepareReview()\" [disabled]=\"timeForm.get('tsFormat').value === 'custom' && customFormatInvalid\">Next</button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <!-- Step 3: Review and Export -->\r\n        <mat-step>\r\n          <ng-template matStepLabel><b>Review and export</b></ng-template>\r\n\r\n          <mat-card class=\"review-card\">\r\n            <mat-card-header>\r\n              <mat-card-title>Selection summary</mat-card-title>\r\n            </mat-card-header>\r\n            <mat-card-content>\r\n              <div class=\"review-grid\">\r\n                <div class=\"review-label\">Devices</div>\r\n                <div class=\"muted\">{{ deviceList.length }}</div>\r\n\r\n                <div class=\"review-label\">Selected pairs</div>\r\n                <div class=\"muted\">{{ reviewSelectedList.length }}</div>\r\n\r\n                <div class=\"review-label\">Start</div>\r\n                <div class=\"muted\">{{ startTs | date:'medium' }}</div>\r\n\r\n                <div class=\"review-label\">End</div>\r\n                <div class=\"muted\">{{ endTs | date:'medium' }}</div>\r\n\r\n                <div class=\"review-label\">Sending interval</div>\r\n                <div class=\"muted\">{{ intervalMin || 0 }} min</div>\r\n\r\n                <div class=\"review-label\">Timestamp format</div>\r\n                <div class=\"muted\">{{ tsFormatLabel }}</div>\r\n\r\n                <div class=\"review-label\">Export mode</div>\r\n                <div>\r\n                  <div class=\"row\">\r\n                    <mat-form-field appearance=\"fill\">\r\n                      <mat-label>Export mode</mat-label>\r\n                      <mat-select [(value)]=\"exportMode\" (selectionChange)=\"onExportModeChange()\">\r\n                        <mat-option value=\"per-device\">One file per device</mat-option>\r\n                        <mat-option value=\"single-file\">All devices in one file</mat-option>\r\n                      </mat-select>\r\n                    </mat-form-field>\r\n                  </div>\r\n                  <div class=\"below-note\">Per device: separate CSVs. Single file: one CSV with 2-line header.</div>\r\n                  <div class=\"format-preview\">\r\n                    <pre>{{ exportModePreview }}</pre>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"chips\" *ngIf=\"reviewSelectedList.length\">\r\n                <mat-chip-list>\r\n                  <mat-chip *ngFor=\"let line of reviewSelectedList\" color=\"primary\" selected=\"true\" class=\"mat-elevation-z1\">{{ line }}</mat-chip>\r\n                </mat-chip-list>\r\n              </div>\r\n\r\n              <div style=\"margin-top: 16px;\" *ngIf=\"exportTotal > 0\">\r\n                <mat-progress-bar mode=\"determinate\" [value]=\"exportProgress\"></mat-progress-bar>\r\n                <div style=\"margin-top: 6px; font-size: 12px;\" class=\"muted\">\r\n                  {{ exported }} / {{ exportTotal }} ({{ exportProgress | number:'1.0-0' }}%)\r\n                </div>\r\n              </div>\r\n            </mat-card-content>\r\n          </mat-card>\r\n\r\n          <div class=\"flex w-full justify-between gap-2\" style=\"margin-top: 12px;\">\r\n            <button mat-stroked-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n            <div class=\"flex gap-2\">\r\n              <button mat-button matStepperPrevious>Back</button>\r\n              <button mat-raised-button color=\"primary\" type=\"submit\">Export CSV</button>\r\n            </div>\r\n          </div>\r\n        </mat-step>\r\n\r\n      </mat-horizontal-stepper>\r\n    </form>\r\n  </div>\r\n</form>`;\r\n\r\n  // 3) Services\r\n  const $inj = widgetContext.$scope.$injector;\r\n  const customDialog = $inj.get(widgetContext.servicesMap.get('customDialog'));\r\n  const attributeService = $inj.get(widgetContext.servicesMap.get('attributeService'));\r\n  const entityRelationService = $inj.get(widgetContext.servicesMap.get('entityRelationService'));\r\n  const deviceService = $inj.get(widgetContext.servicesMap.get('deviceService'));\r\n\r\n  // 4) Open dialog\r\n  customDialog.customDialog(htmlTemplate, Controller).subscribe();\r\n\r\n  // 5) Controller\r\n  function Controller(instance) {\r\n    const vm = instance;\r\n\r\n    // Constants\r\n    const EXCLUDE_KEYS = new Set([\r\n      'criticalAlarmsCount',\r\n      'majorAlarmsCount',\r\n      'minorAlarmsCount',\r\n      'warningAlarmsCount',\r\n      'f_cnt',\r\n      'dr',\r\n      'status_battery_level',\r\n      'status_margin',\r\n      'battery',\r\n      'snr',\r\n      'rssi',\r\n      'margin',\r\n      'error',\r\n      'baseVolume',\r\n      'pulseStart',\r\n      'pulseTotal',\r\n      'dataIncrement',\r\n      'input1'\r\n    ]);\r\n    const FETCH_CONCURRENCY_DEVICES = 6;\r\n    const FETCH_CONCURRENCY_KEYS    = 4;\r\n    const PAGE_LIMIT = 1000;\r\n    const AGG_NONE = 'NONE';\r\n    const ORDER_ASC = 'ASC';\r\n    const DELIMITER = ';';\r\n\r\n    // Preview constraints (tightened to avoid wide preview)\r\n    const PREVIEW_MAX_COLS_PER_DEVICE = 6;\r\n    const PREVIEW_MAX_COLS_SINGLEFILE = 8;\r\n    const PREVIEW_MAX_LINE_CHARS = 100;\r\n    const PREVIEW_TOKEN_MAX_LEN = 28;\r\n\r\n    // Reactive state\r\n    vm.isLoading$ = widgetContext.rxjs.of(true);\r\n    vm.cancel = () => vm.dialogRef.close(null);\r\n    vm.exportMode = 'per-device';\r\n    vm.exportModePreview = 'Select mode to preview...';\r\n\r\n    // Forms\r\n    vm.timeseriesFormGroup = vm.fb.group({});\r\n    vm.timeForm = vm.fb.group({\r\n      startDate: [null, vm.validators.required],\r\n      startTime: [null, vm.validators.required],\r\n      endDate:   [null, vm.validators.required],\r\n      endTime:   [null, vm.validators.required],\r\n      intervalMin: [0],\r\n      tsFormat: ['none'],\r\n      customFormat: ['']\r\n    });\r\n    vm.mainForm = vm.fb.group({\r\n      timeseriesForm: vm.timeseriesFormGroup,\r\n      timeForm: vm.timeForm\r\n    });\r\n\r\n    // Data slots\r\n    vm.deviceList = []; // {id, name, profile}\r\n    vm.deviceTelemetryMap = new Map(); // did -> Set(keys)\r\n    vm.profileNames = [];\r\n    vm.profileKeysMap = {}; // profile -> [keys]\r\n    vm.reviewSelectedList = [];\r\n\r\n    vm.exportTotal = 0;\r\n    vm.exported = 0;\r\n    vm.customPreview = '';\r\n    vm.customFormatInvalid = false;\r\n    vm.customFormatError = '';\r\n    vm.tsFormatLabel = 'none';\r\n\r\n    Object.defineProperty(vm, 'exportProgress', {\r\n      get() { return vm.exportTotal > 0 ? (vm.exported / vm.exportTotal) * 100 : 0; }\r\n    });\r\n\r\n    // Helpers\r\n    function runThrottled(items, worker, concurrency) {\r\n      return new Promise((resolve, reject) => {\r\n        let nextIndex = 0;\r\n        let running = 0;\r\n        const total = items.length;\r\n        const results = new Array(total);\r\n        let done = 0, failed = false;\r\n        function startNext() {\r\n          while (running < concurrency && nextIndex < total) {\r\n            const i = nextIndex++;\r\n            running++;\r\n            Promise.resolve(worker(items[i], i))\r\n              .then((res) => { results[i] = res; running--; done++; if (done === total) resolve(results); else startNext(); })\r\n              .catch((err) => { if (!failed) { failed = true; reject(err); } });\r\n          }\r\n          if (total === 0) resolve(results);\r\n        }\r\n        startNext();\r\n      });\r\n    }\r\n\r\n    function combineDateAndTime(date, time) {\r\n      if (!date || !time) return null;\r\n      const t = new Date(time);\r\n      const d = new Date(date);\r\n      d.setHours(t.getHours());\r\n      d.setMinutes(t.getMinutes());\r\n      d.setSeconds(0);\r\n      d.setMilliseconds(0);\r\n      return d.getTime();\r\n    }\r\n\r\n    function pad2(n) { return n < 10 ? '0' + n : '' + n; }\r\n    function pad3(n) { return n < 10 ? '00' + n : (n < 100 ? '0' + n : '' + n); }\r\n    function pad4(n) { const s = '' + n; return s.length >= 4 ? s : ('0000' + s).slice(-4); }\r\n\r\n    function formatWithPattern(ts, pattern) {\r\n      const d = new Date(ts);\r\n      const map = {\r\n        'yyyy': pad4(d.getFullYear()),\r\n        'yy': pad2(d.getFullYear() % 100),\r\n        'MM': pad2(d.getMonth() + 1),\r\n        'dd': pad2(d.getDate()),\r\n        'HH': pad2(d.getHours()),\r\n        'mm': pad2(d.getMinutes()),\r\n        'ss': pad2(d.getSeconds()),\r\n        'SSS': pad3(d.getMilliseconds())\r\n      };\r\n      return pattern\r\n        .replace(/yyyy/g, map.yyyy)\r\n        .replace(/yy/g, map.yy)\r\n        .replace(/MM/g, map.MM)\r\n        .replace(/dd/g, map.dd)\r\n        .replace(/HH/g, map.HH)\r\n        .replace(/mm/g, map.mm)\r\n        .replace(/ss/g, map.ss)\r\n        .replace(/SSS/g, map.SSS);\r\n    }\r\n\r\n    function validateCustomPatternSimple(pattern) {\r\n      if (!pattern || typeof pattern !== 'string') {\r\n        return { ok: false, msg: 'Enter a format pattern.' };\r\n      }\r\n      const tokens = ['yyyy','yy','MM','dd','HH','mm','ss','SSS'];\r\n      let rest = pattern;\r\n      let hasToken = false;\r\n      tokens.forEach(t => {\r\n        if (rest.indexOf(t) !== -1) hasToken = true;\r\n        rest = rest.split(t).join('');\r\n      });\r\n      if (!hasToken) return { ok: false, msg: 'Pattern must include at least one token (e.g., yyyy or HH).' };\r\n      const illegal = rest.replace(/[ \\-:\\/\\._TZ]/g, '');\r\n      if (illegal.length > 0) return { ok: false, msg: 'Unsupported characters. Allowed: space - : / . _ T Z.' };\r\n      return { ok: true, msg: '' };\r\n    }\r\n\r\n    function uniqSorted(arr) { return Array.from(new Set(arr)).sort((a,b)=>a-b); }\r\n\r\n    function csvEscape(val) {\r\n      if (val === null || val === undefined) return '';\r\n      const s = String(val);\r\n      const needsQuote = s.indexOf('\"') !== -1 || s.indexOf('\\n') !== -1 || s.indexOf(DELIMITER) !== -1;\r\n      if (needsQuote) return '\"' + s.replace(/\"/g, '\"\"') + '\"';\r\n      return s;\r\n    }\r\n\r\n    function downloadCSV(filename, csvText) {\r\n      try {\r\n        const blob = new Blob([csvText], { type: 'text/csv;charset=utf-8;' });\r\n        const url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = filename;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        setTimeout(() => {\r\n          document.body.removeChild(a);\r\n          (window.URL || window.webkitURL).revokeObjectURL(url);\r\n        }, 0);\r\n      } catch (e) { console.error('Download failed', e); }\r\n    }\r\n\r\n    // API wrappers\r\n    function apiFindRelationsDevices(rootAssetId) {\r\n      const query = {\r\n        parameters: {\r\n          rootId: rootAssetId,\r\n          rootType: 'ASSET',\r\n          direction: 'FROM',\r\n          relationTypeGroup: 'COMMON',\r\n          maxLevel: 1,\r\n          fetchLastLevelOnly: true\r\n        },\r\n        filters: [\r\n          { relationType: 'Contains', entityTypes: ['DEVICE'], negate: true }\r\n        ]\r\n      };\r\n      return new Promise((resolve, reject) => {\r\n        entityRelationService.findByQuery(query).subscribe(\r\n          (rels) => resolve(Array.isArray(rels) ? rels : []),\r\n          (err) => reject(err)\r\n        );\r\n      });\r\n    }\r\n\r\n    function apiLatestKeysForDevice(deviceId) {\r\n      return new Promise((resolve) => {\r\n        attributeService.getEntityTimeseriesLatest({ entityType: 'DEVICE', id: deviceId }).subscribe(\r\n          (data) => resolve(Object.keys(data || {})),\r\n          () => resolve([])\r\n        );\r\n      });\r\n    }\r\n\r\n    function apiTimeseriesPage(entityRef, keys, startTs, endTs, limit, agg, interval, orderBy, useStrict) {\r\n      return new Promise((resolve, reject) => {\r\n        attributeService.getEntityTimeseries(entityRef, keys, startTs, endTs, limit, agg, interval, orderBy, useStrict).subscribe(\r\n          (data) => resolve(data || {}),\r\n          (err) => reject(err)\r\n        );\r\n      });\r\n    }\r\n\r\n    function apiGetDevice(deviceId) {\r\n      return new Promise((resolve) => {\r\n        deviceService.getDevice(deviceId).subscribe(\r\n          (dev) => resolve(dev || { id: deviceId }),\r\n          () => resolve({ id: deviceId })\r\n        );\r\n      });\r\n    }\r\n\r\n    // Pagination for a single key\r\n    async function fetchAllForKey(deviceRef, key, startTs, endTs, intervalMs) {\r\n      const records = [];\r\n      let cursor = startTs;\r\n      while (cursor <= endTs) {\r\n        let page;\r\n        try {\r\n          page = await apiTimeseriesPage(\r\n            deviceRef, [key], cursor, endTs, PAGE_LIMIT, AGG_NONE,\r\n            intervalMs > 0 ? intervalMs : undefined, ORDER_ASC, false\r\n          );\r\n        } catch (e) {\r\n          console.error('Timeseries page error', deviceRef, key, e);\r\n          break;\r\n        }\r\n        const series = (page && page[key]) ? page[key] : [];\r\n        if (!series.length) break;\r\n        for (let i = 0; i < series.length; i++) {\r\n          records.push({ ts: series[i].ts, value: series[i].value });\r\n        }\r\n        if (series.length < PAGE_LIMIT) break;\r\n        const lastTs = series[series.length - 1].ts;\r\n        const next = (typeof lastTs === 'number' ? lastTs : parseInt(lastTs, 10)) + 1;\r\n        if (!(next > cursor)) break;\r\n        cursor = next;\r\n      }\r\n      return records;\r\n    }\r\n\r\n    function buildDeviceCSV(keyDataMap, tsFormat, customPattern) {\r\n      const allTs = uniqSorted([].concat(...Array.from(keyDataMap.values()).map(arr => arr.map(x => x.ts))));\r\n      const keys = Array.from(keyDataMap.keys());\r\n      const header = ['timestamp'].concat(keys).join(DELIMITER);\r\n      const perKeyMaps = {};\r\n      keys.forEach(k => {\r\n        const m = new Map();\r\n        (keyDataMap.get(k) || []).forEach(x => m.set(x.ts, x.value));\r\n        perKeyMaps[k] = m;\r\n      });\r\n      const lines = [header];\r\n      for (let i = 0; i < allTs.length; i++) {\r\n        const ts = allTs[i];\r\n        let tsOut;\r\n        if (tsFormat === 'none') tsOut = ts;\r\n        else if (tsFormat === 'custom' && customPattern) tsOut = formatWithPattern(ts, customPattern);\r\n        else tsOut = formatWithPattern(ts, tsFormat);\r\n        const row = [csvEscape(tsOut)];\r\n        for (let j = 0; j < keys.length; j++) {\r\n          const k = keys[j];\r\n          const v = perKeyMaps[k].has(ts) ? perKeyMaps[k].get(ts) : '';\r\n          row.push(csvEscape(v));\r\n        }\r\n        lines.push(row.join(DELIMITER));\r\n      }\r\n      return lines.join('\\n');\r\n    }\r\n\r\n    // Control name helpers for grouped form\r\n    vm.controlName = controlName;\r\n    function controlName(profile, key) { return profile + '::' + key; }\r\n    function splitControlName(name) {\r\n      const i = name.indexOf('::');\r\n      if (i === -1) return [name, ''];\r\n      return [name.slice(0, i), name.slice(i + 2)];\r\n    }\r\n\r\n    // ----- Export mode preview (bounded and token-shortened) -----\r\n    vm.onExportModeChange = function() { vm.updateExportModePreview(); };\r\n    function truncateLine(s, limit) { if (!s) return ''; return s.length <= limit ? s : s.slice(0, Math.max(0, limit - 5)) + ' ...'; }\r\n    function shortenToken(s, maxLen) { if (!s) return ''; const str = String(s); if (str.length <= maxLen) return str; const half = Math.floor(maxLen / 2); return str.slice(0, half) + '...' + str.slice(-half); }\r\n\r\n    vm.updateExportModePreview = function() {\r\n      try {\r\n        const tw = vm.timeForm.value || {};\r\n        const tsFormat = tw.tsFormat || 'none';\r\n        const customPattern = tw.customFormat || '';\r\n        const sampleTs = vm.startTs || Date.now();\r\n        let tsOut = '';\r\n        if (tsFormat === 'none') tsOut = String(sampleTs);\r\n        else if (tsFormat === 'custom' && customPattern) tsOut = formatWithPattern(sampleTs, customPattern);\r\n        else tsOut = formatWithPattern(sampleTs, tsFormat);\r\n\r\n        const selectedPairs = [];\r\n        const v = vm.timeseriesFormGroup.value || {};\r\n        Object.keys(v).forEach(name => { if (v[name]) { const [profile,key] = splitControlName(name); selectedPairs.push({ profile, key }); } });\r\n\r\n        if (!vm.deviceList.length || !selectedPairs.length) {\r\n          vm.exportModePreview = 'Select devices and datapoints to see a preview.';\r\n          return;\r\n        }\r\n\r\n        if (vm.exportMode === 'per-device') {\r\n          let dev = null;\r\n          let keysForDevice = [];\r\n          for (let i = 0; i < vm.deviceList.length; i++) {\r\n            const d = vm.deviceList[i];\r\n            const devKeys = vm.deviceTelemetryMap.get(d.id) || new Set();\r\n            const kfd = selectedPairs.filter(sp => sp.profile === d.profile && devKeys.has(sp.key)).map(sp => sp.key);\r\n            if (kfd.length) { dev = d; keysForDevice = kfd; break; }\r\n          }\r\n          if (!dev || !keysForDevice.length) {\r\n            vm.exportModePreview = 'No matching keys found on devices.';\r\n            return;\r\n          }\r\n          const slice = keysForDevice.slice(0, PREVIEW_MAX_COLS_PER_DEVICE).map(k => shortenToken(k, PREVIEW_TOKEN_MAX_LEN));\r\n          const extra = keysForDevice.length - slice.length;\r\n          let header = ['timestamp'].concat(slice).join(DELIMITER);\r\n          let row = [tsOut].concat(slice.map(() => '...')).join(DELIMITER);\r\n          header = truncateLine(header, PREVIEW_MAX_LINE_CHARS);\r\n          row = truncateLine(row, PREVIEW_MAX_LINE_CHARS);\r\n          vm.exportModePreview = header + '\\n' + row + (extra > 0 ? '\\n... (+ ' + extra + ' more columns)' : '');\r\n          return;\r\n        }\r\n\r\n        // single-file preview (Device Name: and Datapoint Name: headers)\r\n        const devicesSorted = vm.deviceList.slice().sort((a,b)=>a.name.localeCompare(b.name));\r\n        const devKeyOrder = [];\r\n        devicesSorted.forEach(d => {\r\n          const devKeys = vm.deviceTelemetryMap.get(d.id) || new Set();\r\n          const keys = selectedPairs\r\n            .filter(sp => sp.profile === d.profile && devKeys.has(sp.key))\r\n            .map(sp => sp.key)\r\n            .sort((a,b)=>a.localeCompare(b));\r\n          keys.forEach(k => devKeyOrder.push({ dev: d, key: k }));\r\n        });\r\n        if (!devKeyOrder.length) {\r\n          vm.exportModePreview = 'No matching keys across devices for preview.';\r\n          return;\r\n        }\r\n        const slice = devKeyOrder.slice(0, PREVIEW_MAX_COLS_SINGLEFILE);\r\n        const extra = devKeyOrder.length - slice.length;\r\n        let header1 = ['Device Name:'].concat(slice.map(x => shortenToken(x.dev.name || x.dev.id, PREVIEW_TOKEN_MAX_LEN))).join(DELIMITER);\r\n        let header2 = ['Datapoint Name:'].concat(slice.map(x => shortenToken(((x.dev.name || x.dev.id) + '_' + x.key).replace(/[^a-zA-Z0-9._-]/g, '_'), PREVIEW_TOKEN_MAX_LEN))).join(DELIMITER);\r\n        let row = [tsOut].concat(slice.map(() => '...')).join(DELIMITER);\r\n        header1 = truncateLine(header1, PREVIEW_MAX_LINE_CHARS);\r\n        header2 = truncateLine(header2, PREVIEW_MAX_LINE_CHARS);\r\n        row = truncateLine(row, PREVIEW_MAX_LINE_CHARS);\r\n        vm.exportModePreview = header1 + '\\n' + header2 + '\\n' + row + (extra > 0 ? '\\n... (+ ' + extra + ' more columns)' : '');\r\n      } catch (e) {\r\n        vm.exportModePreview = 'Preview unavailable.';\r\n      }\r\n    };\r\n\r\n    // Bootstrap\r\n    (async function bootstrap() {\r\n      try {\r\n        const rootIdValue = (entityId && typeof entityId === 'object' && entityId.id) ? entityId.id : entityId;\r\n        const rels = await apiFindRelationsDevices(rootIdValue);\r\n        const deviceIds = [];\r\n        for (let i = 0; i < rels.length; i++) {\r\n          const r = rels[i];\r\n          if (r && r.to && r.to.entityType === 'DEVICE' && r.to.id) {\r\n            deviceIds.push(r.to.id);\r\n          }\r\n        }\r\n        const uniqueIds = Array.from(new Set(deviceIds));\r\n\r\n        // Fetch device info (name, profile)\r\n        const devices = await runThrottled(uniqueIds, async (did) => {\r\n          const dev = await apiGetDevice(did);\r\n          const name = dev && dev.name ? dev.name : did;\r\n          const profile = dev && (dev.deviceProfileName || dev.type) ? (dev.deviceProfileName || dev.type) : 'Unknown';\r\n          return { id: did, name: name, profile: profile };\r\n        }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n        vm.deviceList = devices;\r\n\r\n        // For each device, get latest keys and group by profile\r\n        const profileKeyMap = new Map(); // profile -> Set(keys)\r\n        await runThrottled(vm.deviceList, async (dev) => {\r\n          const keys = (await apiLatestKeysForDevice(dev.id)).filter(k => !EXCLUDE_KEYS.has(k));\r\n          vm.deviceTelemetryMap.set(dev.id, new Set(keys));\r\n          if (!profileKeyMap.has(dev.profile)) profileKeyMap.set(dev.profile, new Set());\r\n          const s = profileKeyMap.get(dev.profile);\r\n          keys.forEach(k => s.add(k));\r\n        }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n        vm.profileNames = Array.from(profileKeyMap.keys()).sort((a,b)=>a.localeCompare(b));\r\n        vm.profileKeysMap = {};\r\n        vm.profileNames.forEach(p => {\r\n          vm.profileKeysMap[p] = Array.from(profileKeyMap.get(p)).sort((a,b)=>a.localeCompare(b));\r\n        });\r\n\r\n        // Build form controls per profile/key\r\n        vm.profileNames.forEach(p => {\r\n          const keys = vm.profileKeysMap[p] || [];\r\n          keys.forEach(k => {\r\n            vm.timeseriesFormGroup.addControl(controlName(p, k), vm.fb.control(false));\r\n          });\r\n        });\r\n\r\n        vm.isLoading$ = widgetContext.rxjs.of(false);\r\n      } catch (e) {\r\n        console.error('Bootstrap failed', e);\r\n        vm.isLoading$ = widgetContext.rxjs.of(false);\r\n        widgetContext.showErrorToast('Failed to prepare Export Telemetry dialog', 4000, 'top', 'center');\r\n      }\r\n    })();\r\n\r\n    // Step 1 handlers\r\n    vm.toggleSelectAll = function(checked) {\r\n      Object.keys(vm.timeseriesFormGroup.controls).forEach(name => {\r\n        vm.timeseriesFormGroup.get(name).setValue(checked, { emitEvent: false });\r\n      });\r\n    };\r\n    vm.selectAllInProfile = function(profile) {\r\n      const keys = vm.profileKeysMap[profile] || [];\r\n      keys.forEach(k => {\r\n        const cn = controlName(profile, k);\r\n        if (vm.timeseriesFormGroup.contains(cn)) vm.timeseriesFormGroup.get(cn).setValue(true, { emitEvent: false });\r\n      });\r\n    };\r\n    vm.clearAllInProfile = function(profile) {\r\n      const keys = vm.profileKeysMap[profile] || [];\r\n      keys.forEach(k => {\r\n        const cn = controlName(profile, k);\r\n        if (vm.timeseriesFormGroup.contains(cn)) vm.timeseriesFormGroup.get(cn).setValue(false, { emitEvent: false });\r\n      });\r\n    };\r\n    vm.hasSelectedTimeseries = function() {\r\n      const v = vm.timeseriesFormGroup.value || {};\r\n      return Object.keys(v).some(n => !!v[n]);\r\n    };\r\n\r\n    // Timestamp format interactions\r\n    vm.onTsFormatChange = function() { vm.validateCustomFormat(); vm.updateExportModePreview(); };\r\n    vm.validateCustomFormat = function() {\r\n      const fmt = vm.timeForm.get('customFormat').value || '';\r\n      const sel = vm.timeForm.get('tsFormat').value;\r\n      if (sel !== 'custom') { vm.customFormatInvalid = false; vm.customPreview = ''; vm.customFormatError = ''; return; }\r\n      const sampleTs = Date.UTC(2000, 0, 2, 3, 4, 5, 6);\r\n      vm.customPreview = fmt ? formatWithPattern(sampleTs, fmt) : '';\r\n      const res = validateCustomPatternSimple(fmt);\r\n      vm.customFormatInvalid = !res.ok;\r\n      vm.customFormatError = res.msg || 'Invalid format.';\r\n    };\r\n\r\n    // Build review view\r\n    vm.prepareReview = function() {\r\n      const v = vm.timeseriesFormGroup.value || {};\r\n      const lines = [];\r\n      Object.keys(v).forEach(name => { if (v[name]) { const spl = splitControlName(name); lines.push(spl[0] + ':' + spl[1]); } });\r\n      vm.reviewSelectedList = lines.sort((a,b)=>a.localeCompare(b));\r\n\r\n      const tw = vm.timeForm.value || {};\r\n      vm.startTs = combineDateAndTime(tw.startDate, tw.startTime);\r\n      vm.endTs   = combineDateAndTime(tw.endDate, tw.endTime);\r\n      vm.intervalMin = typeof tw.intervalMin === 'number' ? tw.intervalMin : parseInt(tw.intervalMin || '0', 10);\r\n      vm.tsFormatLabel = tw.tsFormat === 'custom' ? ('custom: ' + (tw.customFormat || '')) : (tw.tsFormat || 'none');\r\n\r\n      if (!vm.startTs || !vm.endTs || vm.startTs >= vm.endTs) {\r\n        widgetContext.showWarningToast('Please select a valid time window', 3000, 'top', 'center');\r\n      }\r\n\r\n      vm.updateExportModePreview();\r\n    };\r\n\r\n    // Export action\r\n    vm.exportData = async function() {\r\n      if (!vm.hasSelectedTimeseries()) {\r\n        widgetContext.showWarningToast('No datapoints selected', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n      const tw = vm.timeForm.value || {};\r\n      const startTs = combineDateAndTime(tw.startDate, tw.startTime);\r\n      const endTs   = combineDateAndTime(tw.endDate, tw.endTime);\r\n      if (!startTs || !endTs || startTs >= endTs) {\r\n        widgetContext.showWarningToast('Please select a valid time window', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n      if (tw.tsFormat === 'custom' && vm.customFormatInvalid) {\r\n        widgetContext.showWarningToast('Custom timestamp format has errors. Please fix it before continuing.', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n      const intervalMin = typeof tw.intervalMin === 'number' ? tw.intervalMin : parseInt(tw.intervalMin || '0', 10);\r\n      const intervalMs = intervalMin > 0 ? intervalMin * 60 * 1000 : 0;\r\n\r\n      const selectedPairs = [];\r\n      const v = vm.timeseriesFormGroup.value || {};\r\n      Object.keys(v).forEach(name => {\r\n        if (v[name]) {\r\n          const [profile, key] = splitControlName(name);\r\n          selectedPairs.push({ profile, key });\r\n        }\r\n      });\r\n      if (!selectedPairs.length) {\r\n        widgetContext.showWarningToast('No datapoints selected', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n\r\n      if (vm.exportMode === 'per-device') {\r\n        vm.exportTotal = vm.deviceList.length;\r\n        vm.exported = 0;\r\n\r\n        try {\r\n          await runThrottled(vm.deviceList, async (dev) => {\r\n            const deviceRef = { entityType: 'DEVICE', id: dev.id };\r\n            const devKeys = vm.deviceTelemetryMap.get(dev.id) || new Set();\r\n            const keysForDevice = selectedPairs\r\n              .filter(sp => sp.profile === dev.profile && devKeys.has(sp.key))\r\n              .map(sp => sp.key);\r\n\r\n            const batches = [];\r\n            for (let i = 0; i < keysForDevice.length; i += FETCH_CONCURRENCY_KEYS) {\r\n              batches.push(keysForDevice.slice(i, i + FETCH_CONCURRENCY_KEYS));\r\n            }\r\n            const keyDataMap = new Map();\r\n            for (let b = 0; b < batches.length; b++) {\r\n              const batch = batches[b];\r\n              const results = await Promise.all(batch.map(k => fetchAllForKey(\r\n                deviceRef, k, startTs, endTs, intervalMs > 0 ? intervalMs : undefined\r\n              )));\r\n              for (let j = 0; j < batch.length; j++) {\r\n                keyDataMap.set(batch[j], results[j]);\r\n              }\r\n            }\r\n\r\n            const nameSafe = (dev.name && String(dev.name).trim().length ? dev.name : dev.id).replace(/[^a-zA-Z0-9._-]/g, '_');\r\n            const csv = buildDeviceCSV(keyDataMap, tw.tsFormat, tw.customFormat);\r\n            downloadCSV(nameSafe + '.csv', csv);\r\n\r\n            vm.exported++;\r\n          }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n          vm.dialogRef.close({\r\n            mode: 'per-device',\r\n            exportedDevices: vm.deviceList.length,\r\n            selectedPairs: vm.reviewSelectedList.slice(),\r\n            startTs: startTs,\r\n            endTs: endTs,\r\n            intervalMinutes: intervalMin || 0,\r\n            tsFormat: tw.tsFormat,\r\n            customFormat: tw.customFormat || ''\r\n          });\r\n        } catch (e) {\r\n          console.error('Export failed', e);\r\n          widgetContext.showErrorToast('Export failed for some devices. See console for details.', 4000, 'top', 'center');\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Single-file CSV for all devices\r\n      try {\r\n        const tasks = [];\r\n        const devKeyOrder = [];\r\n        const devicesSorted = vm.deviceList.slice().sort((a,b)=>a.name.localeCompare(b.name));\r\n        devicesSorted.forEach(dev => {\r\n          const devKeys = vm.deviceTelemetryMap.get(dev.id) || new Set();\r\n          const keysForDevice = selectedPairs\r\n            .filter(sp => sp.profile === dev.profile && devKeys.has(sp.key))\r\n            .map(sp => sp.key)\r\n            .sort((a,b)=>a.localeCompare(b));\r\n          keysForDevice.forEach(k => {\r\n            tasks.push({ dev, key: k });\r\n            devKeyOrder.push({ dev, key: k });\r\n          });\r\n        });\r\n\r\n        const pairResults = {};\r\n        await runThrottled(tasks, async (t) => {\r\n          const deviceRef = { entityType: 'DEVICE', id: t.dev.id };\r\n          const data = await fetchAllForKey(deviceRef, t.key, startTs, endTs, intervalMs > 0 ? intervalMs : undefined);\r\n          pairResults[t.dev.id + '|' + t.key] = data;\r\n        }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n        const tsUnion = [];\r\n        const tsSet = new Set();\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const arr = pairResults[dev.id + '|' + key] || [];\r\n          arr.forEach(x => { if (!tsSet.has(x.ts)) { tsSet.add(x.ts); tsUnion.push(x.ts); } });\r\n        });\r\n        tsUnion.sort((a,b)=>a-b);\r\n\r\n        const lookup = {};\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const map = new Map();\r\n          const arr = pairResults[dev.id + '|' + key] || [];\r\n          arr.forEach(x => map.set(x.ts, x.value));\r\n          lookup[dev.id + '|' + key] = map;\r\n        });\r\n\r\n        const header1 = ['Device Name:'];\r\n        const header2 = ['Datapoint Name:'];\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const name = dev.name || dev.id;\r\n          header1.push(name);\r\n          header2.push((name + '_' + key).replace(/[^a-zA-Z0-9._-]/g, '_'));\r\n        });\r\n\r\n        const lines = [];\r\n        lines.push(header1.join(DELIMITER));\r\n        lines.push(header2.join(DELIMITER));\r\n\r\n        const tsFormat = vm.timeForm.get('tsFormat').value;\r\n        const customPattern = vm.timeForm.get('customFormat').value || '';\r\n        for (let i = 0; i < tsUnion.length; i++) {\r\n          const ts = tsUnion[i];\r\n          let tsOut;\r\n          if (tsFormat === 'none') tsOut = ts;\r\n          else if (tsFormat === 'custom' && customPattern) tsOut = formatWithPattern(ts, customPattern);\r\n          else tsOut = formatWithPattern(ts, tsFormat);\r\n\r\n        const row = [csvEscape(tsOut)];\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const m = lookup[dev.id + '|' + key];\r\n          const v = m && m.has(ts) ? m.get(ts) : '';\r\n          row.push(csvEscape(v));\r\n        });\r\n        lines.push(row.join(DELIMITER));\r\n        }\r\n\r\n        const csvAll = lines.join('\\n');\r\n        downloadCSV('all_devices.csv', csvAll);\r\n\r\n        vm.dialogRef.close({\r\n          mode: 'single-file',\r\n          deviceCount: devicesSorted.length,\r\n          columnCount: devKeyOrder.length,\r\n          startTs: startTs,\r\n          endTs: endTs\r\n        });\r\n      } catch (e) {\r\n        console.error('Aggregate export failed', e);\r\n        widgetContext.showErrorToast('Aggregate export failed. See console for details.', 4000, 'top', 'center');\r\n      }\r\n    };\r\n  }\r\n}\r\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1d849014-0fd1-1cba-a117-3d83a6c78431"
              },
              {
                "name": "getHistoricalDataCancom",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.getHistoricalDataCancom(widgetContext,entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a83139e4-d301-9e18-ae90-dd6cf251d7fc"
              }
            ],
            "rowClick": [
              {
                "name": "Open Location Devices Double Click",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Devices",
                "setEntityId": true,
                "stateEntityParamName": "selectedLocation",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d6c6677-6196-87b1-4d1b-192b6b6e669c"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.location-table.add-location.titel}",
                "buttonType": "icon",
                "icon": "domain_add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addLocation(widgetContext,entityId,entityName,entityLabel,\"Locations\");\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0503a2f0-ee63-219c-2690-69d592f013e4"
              }
            ],
            "rowDoubleClick": []
          },
          "showTitleIcon": true,
          "titleIcon": "domain",
          "iconColor": null,
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "176fbb8f-6463-2365-df92-c0020ebba277"
      },
      "f7e39953-8e8c-5b27-e7b4-caf73e5f325c": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709568236338,
                "endTimeMs": 1709654636338
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "entitiesTitle": "{i18n:custom.location-table.titel}",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 12,
            "pageStepCount": 3,
            "pageStepIncrement": 12,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.location-table.titel}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "f43647ee-facf-120f-2a6d-ab2f78572da8",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:custom.state}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "var state = value;\r\n\r\nif (entity.service === \"true\" || entity.Service === \"true\") {\r\n    state = \"service\";\r\n} \r\n\r\nvar color = utils.getStatusColors(state).color;\r\nvar bgColor = utils.getStatusColors(state).bgColor;\r\nvar status = utils.getStatusColors(state).status;\r\n\r\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\r\n            status + '</div>';",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.7610052250934878,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "{i18n:custom.location-table.name}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "45%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.4517433821938447,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "{i18n:custom.location-table.label}",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "45%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.2093830609657238,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "service",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.06638380001590816,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "actionCellButton": [
              {
                "name": "Open Location Devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Devices",
                "setEntityId": true,
                "stateEntityParamName": "",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "13b88532-90c1-0715-e0a1-8b1a98e77f60"
              },
              {
                "name": "{i18n:custom.location-table.edit-location.titel}",
                "icon": "edit",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.editLocation(widgetContext,entityId,entityName,entityLabel);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "ce62ddd4-4697-2f5d-4ca5-665dae4c3be7"
              },
              {
                "name": "{i18n:custom.location-table.change-mode.titel}",
                "icon": "mdi:account-wrench",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeMode(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "410bc3e0-cbb4-3090-8e72-4a544ee3aa38"
              },
              {
                "name": "{i18n:custom.changeEEProjectGuid.titel}",
                "icon": "mdi:card-account-details",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeSpecificEEProjectGuid(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "41726d63-0fb7-5f85-c995-9f56433a5056"
              },
              {
                "name": "{i18n:custom.resendData.titel}",
                "icon": "schedule_send",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.resendDataEntity(widgetContext, entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f8dd3839-b697-6a65-2922-e08602c9612f"
              },
              {
                "name": "Export Data",
                "icon": "file_download",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "exportTelemetry(widgetContext, entityId);\r\nfunction exportTelemetry(widgetContext, entityId) {\r\n  // 1) CSS (ASCII-only, single \\n)\r\n  const cssStr =\r\n    '.export-telemetry .mdc-text-field--filled.mdc-text-field--disabled {\\n' +\r\n    '  background-color: rgba(244, 249, 254, 0.5) !important;\\n' +\r\n    '}\\n' +\r\n    '.export-telemetry .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\\n' +\r\n    '  background-color: rgba(244, 249, 254, 0.5) !important;\\n' +\r\n    '}\\n' +\r\n    '.export-telemetry .mdc-text-field--filled:not(.mdc-text-field--disabled) {\\n' +\r\n    '  background-color: #F4F9FE !important;\\n' +\r\n    '}\\n' +\r\n    '.export-telemetry .mat-mdc-form-field-focus-overlay {\\n' +\r\n    '  background-color: #F4F9FE !important;\\n' +\r\n    '}\\n' +\r\n    '.fieldset {\\n' +\r\n    '  border: 1px solid #e2e8f0;\\n' +\r\n    '  background: #ffffff;\\n' +\r\n    '  color: #334155;\\n' +\r\n    '  border-radius: 6px;\\n' +\r\n    '  padding: 8px 10px 12px;\\n' +\r\n    '}\\n' +\r\n    '.fieldset-legend {\\n' +\r\n    '  margin-bottom: 6px;\\n' +\r\n    '  color: #334155;\\n' +\r\n    '  background: #ffffff;\\n' +\r\n    '  font-weight: 500;\\n' +\r\n    '  border-radius: 6px;\\n' +\r\n    '  padding: 2px 6px;\\n' +\r\n    '}\\n' +\r\n    '.muted { color: #64748b; }\\n' +\r\n    '.w-900 { width: 900px; }\\n' +\r\n    '.review-card { margin-top: 10px; }\\n' +\r\n    '.review-grid { display: grid; grid-template-columns: 220px 1fr; grid-row-gap: 8px; grid-column-gap: 16px; }\\n' +\r\n    '.review-label { font-weight: 500; }\\n' +\r\n    '.chips { margin-top: 6px; }\\n' +\r\n    '/* General layout helpers */\\n' +\r\n    '.row { display: flex; align-items: flex-start; gap: 16px; width: 100%; }\\n' +\r\n    '.section-block { margin-bottom: 16px; }\\n' +\r\n    '.row .mat-mdc-form-field, .row .mat-form-field { flex: 0 0 auto; width: 260px; }\\n' +\r\n    '@media (max-width: 900px) { .row { flex-direction: column; } .row .mat-mdc-form-field { width: 100%; } }\\n' +\r\n    '/* Step 2: full-width responsive grid */\\n' +\r\n    '.step-two-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); grid-column-gap: 16px; grid-row-gap: 16px; width: 100%; }\\n' +\r\n    '.step-two-grid .mat-mdc-form-field, .step-two-grid .mat-form-field { width: 100%; }\\n' +\r\n    '.span-2 { grid-column: 1 / -1; }\\n' +\r\n    '@media (max-width: 900px) { .step-two-grid { grid-template-columns: 1fr; } .span-2 { grid-column: 1 / -1; } }\\n' +\r\n    '/* Make long mat-hints wrap and never cut */\\n' +\r\n    '.hint-wrap .mat-mdc-form-field-subscript-wrapper { white-space: normal; overflow: visible; text-overflow: clip; }\\n' +\r\n    '.hint-wrap .mat-mdc-form-field-hint { white-space: normal; }\\n' +\r\n    '/* Preview box: full width, wraps and never juts out */\\n' +\r\n    '.format-preview { width: 100%; box-sizing: border-box; background: #F8FAFC; border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px; min-height: 96px; max-height: 240px; overflow-y: auto; overflow-x: hidden; margin-top: 8px; }\\n' +\r\n    '.format-preview pre { margin: 0; white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace; font-size: 12px; line-height: 1.35; }\\n' +\r\n    '.below-note { color: #6b7280; font-size: 12px; margin: 4px 0 10px; }\\n';\r\n\r\n  const cssParser = new cssjs();\r\n  cssParser.testMode = false;\r\n  cssParser.cssPreviewNamespace = 'export-telemetry';\r\n  cssParser.createStyleElement('export-telemetry', cssStr, 'nonamespace');\r\n\r\n  // 2) HTML (ASCII-only)\r\n  const htmlTemplate =\r\n`<form #exportForm=\"ngForm\" class=\"export-telemetry max-w-3xl mx-auto w-900\">\r\n  <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n    <h2 class=\"text-lg font-semibold\">Export Telemetry</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n  <div mat-dialog-content class=\"flex flex-col w-900\">\r\n    <form [formGroup]=\"mainForm\" (ngSubmit)=\"exportData()\">\r\n\r\n      <mat-horizontal-stepper [linear]=\"true\" #stepper>\r\n\r\n        <!-- Step 1: Select datapoints grouped by device profile -->\r\n        <mat-step [stepControl]=\"timeseriesFormGroup\">\r\n          <ng-template matStepLabel><b>Select datapoints</b></ng-template>\r\n          <form [formGroup]=\"timeseriesFormGroup\">\r\n            <div class=\"flex w-full justify-end items-center\" style=\"margin-bottom: 8px;\">\r\n              <span>\r\n                <button mat-stroked-button type=\"button\" (click)=\"toggleSelectAll(true)\">Select all</button>\r\n                <button mat-button type=\"button\" (click)=\"toggleSelectAll(false)\">Clear</button>\r\n              </span>\r\n            </div>\r\n\r\n            <mat-accordion multi=\"true\">\r\n              <mat-expansion-panel *ngFor=\"let p of profileNames\" [expanded]=\"true\">\r\n                <mat-expansion-panel-header>\r\n                  <mat-panel-title>\r\n                    {{ p }} ({{ profileKeysMap[p]?.length || 0 }})\r\n                  </mat-panel-title>\r\n                </mat-expansion-panel-header>\r\n\r\n                <div *ngIf=\"profileKeysMap[p]?.length\">\r\n                  <div class=\"flex flex-row gap-2\" style=\"margin: 4px 0 10px 0;\">\r\n                    <button mat-stroked-button type=\"button\" (click)=\"selectAllInProfile(p)\">Select all</button>\r\n                    <button mat-button type=\"button\" (click)=\"clearAllInProfile(p)\">Clear</button>\r\n                  </div>\r\n\r\n                  <div *ngFor=\"let k of profileKeysMap[p]\" style=\"margin-bottom: 8px;\">\r\n                    <mat-checkbox [formControlName]=\"controlName(p, k)\">{{ k }}</mat-checkbox>\r\n                  </div>\r\n                </div>\r\n                <div *ngIf=\"!profileKeysMap[p]?.length\" style=\"padding: 8px; color: #64748b;\">\r\n                  No Timeseries\r\n                </div>\r\n              </mat-expansion-panel>\r\n            </mat-accordion>\r\n\r\n            <div class=\"flex w-full justify-between gap-2\" style=\"margin-top: 12px;\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <div class=\"flex gap-2\">\r\n                <button mat-button matStepperNext [disabled]=\"!hasSelectedTimeseries()\">Next</button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <!-- Step 2: Time window, interval, timestamp format -->\r\n        <mat-step [stepControl]=\"timeForm\">\r\n          <ng-template matStepLabel><b>Select period</b></ng-template>\r\n          <form [formGroup]=\"timeForm\">\r\n            <section class=\"section-block\">\r\n              <div class=\"step-two-grid\">\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Date From</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Time From</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Date To</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Time To</mat-label>\r\n                  <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n                  <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n                  <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Sending interval (min)</mat-label>\r\n                  <input matInput type=\"number\" formControlName=\"intervalMin\" min=\"0\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\">\r\n                  <mat-label>Timestamp format</mat-label>\r\n                  <mat-select formControlName=\"tsFormat\" (selectionChange)=\"onTsFormatChange()\">\r\n                    <mat-option value=\"yy/MM/dd HH:mm:ss\">yy/MM/dd HH:mm:ss</mat-option>\r\n                    <mat-option value=\"dd/MM/yy HH:mm:ss\">dd/MM/yy HH:mm:ss</mat-option>\r\n                    <mat-option value=\"dd/MM/yyyy HH:mm:ss\">dd/MM/yyyy HH:mm:ss</mat-option>\r\n                    <mat-option value=\"yyyy/MM/dd HH:mm:ss\">yyyy/MM/dd HH:mm:ss</mat-option>\r\n                    <mat-option value=\"yyyy-MM-dd HH:mm:ss\">yyyy-MM-dd HH:mm:ss</mat-option>\r\n                    <mat-option value=\"custom\">custom</mat-option>\r\n                    <mat-option value=\"none\">none</mat-option>\r\n                  </mat-select>\r\n                  <mat-hint>Presets or choose custom with tokens below.</mat-hint>\r\n                </mat-form-field>\r\n              </div>\r\n            </section>\r\n\r\n            <section class=\"section-block\" *ngIf=\"timeForm.get('tsFormat').value === 'custom'\">\r\n              <div class=\"step-two-grid\">\r\n                <mat-form-field class=\"hint-wrap span-2\" appearance=\"fill\">\r\n                  <mat-label>Custom format pattern</mat-label>\r\n                  <input matInput formControlName=\"customFormat\" (input)=\"validateCustomFormat()\">\r\n                  <mat-hint>\r\n                    Tokens supported: yyyy, yy, MM, dd, HH, mm, ss, SSS. You can mix with literals like space, -, :, /, ., T, Z, _. Example: yyyy/MM/dd HH:mm:ss\r\n                  </mat-hint>\r\n                  <mat-error *ngIf=\"customFormatInvalid\">{{ customFormatError }}</mat-error>\r\n                </mat-form-field>\r\n                <mat-form-field class=\"span-2\" appearance=\"fill\">\r\n                  <mat-label>Preview</mat-label>\r\n                  <input matInput [value]=\"customPreview\" disabled>\r\n                </mat-form-field>\r\n              </div>\r\n            </section>\r\n\r\n            <div class=\"flex w-full justify-between gap-2\">\r\n              <button mat-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n              <div class=\"flex gap-2\">\r\n                <button mat-button matStepperPrevious>Back</button>\r\n                <button mat-button matStepperNext (click)=\"prepareReview()\" [disabled]=\"timeForm.get('tsFormat').value === 'custom' && customFormatInvalid\">Next</button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </mat-step>\r\n\r\n        <!-- Step 3: Review and Export -->\r\n        <mat-step>\r\n          <ng-template matStepLabel><b>Review and export</b></ng-template>\r\n\r\n          <mat-card class=\"review-card\">\r\n            <mat-card-header>\r\n              <mat-card-title>Selection summary</mat-card-title>\r\n            </mat-card-header>\r\n            <mat-card-content>\r\n              <div class=\"review-grid\">\r\n                <div class=\"review-label\">Devices</div>\r\n                <div class=\"muted\">{{ deviceList.length }}</div>\r\n\r\n                <div class=\"review-label\">Selected pairs</div>\r\n                <div class=\"muted\">{{ reviewSelectedList.length }}</div>\r\n\r\n                <div class=\"review-label\">Start</div>\r\n                <div class=\"muted\">{{ startTs | date:'medium' }}</div>\r\n\r\n                <div class=\"review-label\">End</div>\r\n                <div class=\"muted\">{{ endTs | date:'medium' }}</div>\r\n\r\n                <div class=\"review-label\">Sending interval</div>\r\n                <div class=\"muted\">{{ intervalMin || 0 }} min</div>\r\n\r\n                <div class=\"review-label\">Timestamp format</div>\r\n                <div class=\"muted\">{{ tsFormatLabel }}</div>\r\n\r\n                <div class=\"review-label\">Export mode</div>\r\n                <div>\r\n                  <div class=\"row\">\r\n                    <mat-form-field appearance=\"fill\">\r\n                      <mat-label>Export mode</mat-label>\r\n                      <mat-select [(value)]=\"exportMode\" (selectionChange)=\"onExportModeChange()\">\r\n                        <mat-option value=\"per-device\">One file per device</mat-option>\r\n                        <mat-option value=\"single-file\">All devices in one file</mat-option>\r\n                      </mat-select>\r\n                    </mat-form-field>\r\n                  </div>\r\n                  <div class=\"below-note\">Per device: separate CSVs. Single file: one CSV with 2-line header.</div>\r\n                  <div class=\"format-preview\">\r\n                    <pre>{{ exportModePreview }}</pre>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"chips\" *ngIf=\"reviewSelectedList.length\">\r\n                <mat-chip-list>\r\n                  <mat-chip *ngFor=\"let line of reviewSelectedList\" color=\"primary\" selected=\"true\" class=\"mat-elevation-z1\">{{ line }}</mat-chip>\r\n                </mat-chip-list>\r\n              </div>\r\n\r\n              <div style=\"margin-top: 16px;\" *ngIf=\"exportTotal > 0\">\r\n                <mat-progress-bar mode=\"determinate\" [value]=\"exportProgress\"></mat-progress-bar>\r\n                <div style=\"margin-top: 6px; font-size: 12px;\" class=\"muted\">\r\n                  {{ exported }} / {{ exportTotal }} ({{ exportProgress | number:'1.0-0' }}%)\r\n                </div>\r\n              </div>\r\n            </mat-card-content>\r\n          </mat-card>\r\n\r\n          <div class=\"flex w-full justify-between gap-2\" style=\"margin-top: 12px;\">\r\n            <button mat-stroked-button type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n            <div class=\"flex gap-2\">\r\n              <button mat-button matStepperPrevious>Back</button>\r\n              <button mat-raised-button color=\"primary\" type=\"submit\">Export CSV</button>\r\n            </div>\r\n          </div>\r\n        </mat-step>\r\n\r\n      </mat-horizontal-stepper>\r\n    </form>\r\n  </div>\r\n</form>`;\r\n\r\n  // 3) Services\r\n  const $inj = widgetContext.$scope.$injector;\r\n  const customDialog = $inj.get(widgetContext.servicesMap.get('customDialog'));\r\n  const attributeService = $inj.get(widgetContext.servicesMap.get('attributeService'));\r\n  const entityRelationService = $inj.get(widgetContext.servicesMap.get('entityRelationService'));\r\n  const deviceService = $inj.get(widgetContext.servicesMap.get('deviceService'));\r\n\r\n  // 4) Open dialog\r\n  customDialog.customDialog(htmlTemplate, Controller).subscribe();\r\n\r\n  // 5) Controller\r\n  function Controller(instance) {\r\n    const vm = instance;\r\n\r\n    // Constants\r\n    const EXCLUDE_KEYS = new Set([\r\n      'criticalAlarmsCount',\r\n      'majorAlarmsCount',\r\n      'minorAlarmsCount',\r\n      'warningAlarmsCount',\r\n      'f_cnt',\r\n      'dr',\r\n      'status_battery_level',\r\n      'status_margin',\r\n      'battery',\r\n      'snr',\r\n      'rssi',\r\n      'margin',\r\n      'error',\r\n      'baseVolume',\r\n      'pulseStart',\r\n      'pulseTotal',\r\n      'dataIncrement',\r\n      'input1'\r\n    ]);\r\n    const FETCH_CONCURRENCY_DEVICES = 6;\r\n    const FETCH_CONCURRENCY_KEYS    = 4;\r\n    const PAGE_LIMIT = 1000;\r\n    const AGG_NONE = 'NONE';\r\n    const ORDER_ASC = 'ASC';\r\n    const DELIMITER = ';';\r\n\r\n    // Preview constraints (tightened to avoid wide preview)\r\n    const PREVIEW_MAX_COLS_PER_DEVICE = 6;\r\n    const PREVIEW_MAX_COLS_SINGLEFILE = 8;\r\n    const PREVIEW_MAX_LINE_CHARS = 100;\r\n    const PREVIEW_TOKEN_MAX_LEN = 28;\r\n\r\n    // Reactive state\r\n    vm.isLoading$ = widgetContext.rxjs.of(true);\r\n    vm.cancel = () => vm.dialogRef.close(null);\r\n    vm.exportMode = 'per-device';\r\n    vm.exportModePreview = 'Select mode to preview...';\r\n\r\n    // Forms\r\n    vm.timeseriesFormGroup = vm.fb.group({});\r\n    vm.timeForm = vm.fb.group({\r\n      startDate: [null, vm.validators.required],\r\n      startTime: [null, vm.validators.required],\r\n      endDate:   [null, vm.validators.required],\r\n      endTime:   [null, vm.validators.required],\r\n      intervalMin: [0],\r\n      tsFormat: ['none'],\r\n      customFormat: ['']\r\n    });\r\n    vm.mainForm = vm.fb.group({\r\n      timeseriesForm: vm.timeseriesFormGroup,\r\n      timeForm: vm.timeForm\r\n    });\r\n\r\n    // Data slots\r\n    vm.deviceList = []; // {id, name, profile}\r\n    vm.deviceTelemetryMap = new Map(); // did -> Set(keys)\r\n    vm.profileNames = [];\r\n    vm.profileKeysMap = {}; // profile -> [keys]\r\n    vm.reviewSelectedList = [];\r\n\r\n    vm.exportTotal = 0;\r\n    vm.exported = 0;\r\n    vm.customPreview = '';\r\n    vm.customFormatInvalid = false;\r\n    vm.customFormatError = '';\r\n    vm.tsFormatLabel = 'none';\r\n\r\n    Object.defineProperty(vm, 'exportProgress', {\r\n      get() { return vm.exportTotal > 0 ? (vm.exported / vm.exportTotal) * 100 : 0; }\r\n    });\r\n\r\n    // Helpers\r\n    function runThrottled(items, worker, concurrency) {\r\n      return new Promise((resolve, reject) => {\r\n        let nextIndex = 0;\r\n        let running = 0;\r\n        const total = items.length;\r\n        const results = new Array(total);\r\n        let done = 0, failed = false;\r\n        function startNext() {\r\n          while (running < concurrency && nextIndex < total) {\r\n            const i = nextIndex++;\r\n            running++;\r\n            Promise.resolve(worker(items[i], i))\r\n              .then((res) => { results[i] = res; running--; done++; if (done === total) resolve(results); else startNext(); })\r\n              .catch((err) => { if (!failed) { failed = true; reject(err); } });\r\n          }\r\n          if (total === 0) resolve(results);\r\n        }\r\n        startNext();\r\n      });\r\n    }\r\n\r\n    function combineDateAndTime(date, time) {\r\n      if (!date || !time) return null;\r\n      const t = new Date(time);\r\n      const d = new Date(date);\r\n      d.setHours(t.getHours());\r\n      d.setMinutes(t.getMinutes());\r\n      d.setSeconds(0);\r\n      d.setMilliseconds(0);\r\n      return d.getTime();\r\n    }\r\n\r\n    function pad2(n) { return n < 10 ? '0' + n : '' + n; }\r\n    function pad3(n) { return n < 10 ? '00' + n : (n < 100 ? '0' + n : '' + n); }\r\n    function pad4(n) { const s = '' + n; return s.length >= 4 ? s : ('0000' + s).slice(-4); }\r\n\r\n    function formatWithPattern(ts, pattern) {\r\n      const d = new Date(ts);\r\n      const map = {\r\n        'yyyy': pad4(d.getFullYear()),\r\n        'yy': pad2(d.getFullYear() % 100),\r\n        'MM': pad2(d.getMonth() + 1),\r\n        'dd': pad2(d.getDate()),\r\n        'HH': pad2(d.getHours()),\r\n        'mm': pad2(d.getMinutes()),\r\n        'ss': pad2(d.getSeconds()),\r\n        'SSS': pad3(d.getMilliseconds())\r\n      };\r\n      return pattern\r\n        .replace(/yyyy/g, map.yyyy)\r\n        .replace(/yy/g, map.yy)\r\n        .replace(/MM/g, map.MM)\r\n        .replace(/dd/g, map.dd)\r\n        .replace(/HH/g, map.HH)\r\n        .replace(/mm/g, map.mm)\r\n        .replace(/ss/g, map.ss)\r\n        .replace(/SSS/g, map.SSS);\r\n    }\r\n\r\n    function validateCustomPatternSimple(pattern) {\r\n      if (!pattern || typeof pattern !== 'string') {\r\n        return { ok: false, msg: 'Enter a format pattern.' };\r\n      }\r\n      const tokens = ['yyyy','yy','MM','dd','HH','mm','ss','SSS'];\r\n      let rest = pattern;\r\n      let hasToken = false;\r\n      tokens.forEach(t => {\r\n        if (rest.indexOf(t) !== -1) hasToken = true;\r\n        rest = rest.split(t).join('');\r\n      });\r\n      if (!hasToken) return { ok: false, msg: 'Pattern must include at least one token (e.g., yyyy or HH).' };\r\n      const illegal = rest.replace(/[ \\-:\\/\\._TZ]/g, '');\r\n      if (illegal.length > 0) return { ok: false, msg: 'Unsupported characters. Allowed: space - : / . _ T Z.' };\r\n      return { ok: true, msg: '' };\r\n    }\r\n\r\n    function uniqSorted(arr) { return Array.from(new Set(arr)).sort((a,b)=>a-b); }\r\n\r\n    function csvEscape(val) {\r\n      if (val === null || val === undefined) return '';\r\n      const s = String(val);\r\n      const needsQuote = s.indexOf('\"') !== -1 || s.indexOf('\\n') !== -1 || s.indexOf(DELIMITER) !== -1;\r\n      if (needsQuote) return '\"' + s.replace(/\"/g, '\"\"') + '\"';\r\n      return s;\r\n    }\r\n\r\n    function downloadCSV(filename, csvText) {\r\n      try {\r\n        const blob = new Blob([csvText], { type: 'text/csv;charset=utf-8;' });\r\n        const url = (window.URL || window.webkitURL).createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = filename;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        setTimeout(() => {\r\n          document.body.removeChild(a);\r\n          (window.URL || window.webkitURL).revokeObjectURL(url);\r\n        }, 0);\r\n      } catch (e) { console.error('Download failed', e); }\r\n    }\r\n\r\n    // API wrappers\r\n    function apiFindRelationsDevices(rootAssetId) {\r\n      const query = {\r\n        parameters: {\r\n          rootId: rootAssetId,\r\n          rootType: 'ASSET',\r\n          direction: 'FROM',\r\n          relationTypeGroup: 'COMMON',\r\n          maxLevel: 1,\r\n          fetchLastLevelOnly: true\r\n        },\r\n        filters: [\r\n          { relationType: 'Contains', entityTypes: ['DEVICE'], negate: true }\r\n        ]\r\n      };\r\n      return new Promise((resolve, reject) => {\r\n        entityRelationService.findByQuery(query).subscribe(\r\n          (rels) => resolve(Array.isArray(rels) ? rels : []),\r\n          (err) => reject(err)\r\n        );\r\n      });\r\n    }\r\n\r\n    function apiLatestKeysForDevice(deviceId) {\r\n      return new Promise((resolve) => {\r\n        attributeService.getEntityTimeseriesLatest({ entityType: 'DEVICE', id: deviceId }).subscribe(\r\n          (data) => resolve(Object.keys(data || {})),\r\n          () => resolve([])\r\n        );\r\n      });\r\n    }\r\n\r\n    function apiTimeseriesPage(entityRef, keys, startTs, endTs, limit, agg, interval, orderBy, useStrict) {\r\n      return new Promise((resolve, reject) => {\r\n        attributeService.getEntityTimeseries(entityRef, keys, startTs, endTs, limit, agg, interval, orderBy, useStrict).subscribe(\r\n          (data) => resolve(data || {}),\r\n          (err) => reject(err)\r\n        );\r\n      });\r\n    }\r\n\r\n    function apiGetDevice(deviceId) {\r\n      return new Promise((resolve) => {\r\n        deviceService.getDevice(deviceId).subscribe(\r\n          (dev) => resolve(dev || { id: deviceId }),\r\n          () => resolve({ id: deviceId })\r\n        );\r\n      });\r\n    }\r\n\r\n    // Pagination for a single key\r\n    async function fetchAllForKey(deviceRef, key, startTs, endTs, intervalMs) {\r\n      const records = [];\r\n      let cursor = startTs;\r\n      while (cursor <= endTs) {\r\n        let page;\r\n        try {\r\n          page = await apiTimeseriesPage(\r\n            deviceRef, [key], cursor, endTs, PAGE_LIMIT, AGG_NONE,\r\n            intervalMs > 0 ? intervalMs : undefined, ORDER_ASC, false\r\n          );\r\n        } catch (e) {\r\n          console.error('Timeseries page error', deviceRef, key, e);\r\n          break;\r\n        }\r\n        const series = (page && page[key]) ? page[key] : [];\r\n        if (!series.length) break;\r\n        for (let i = 0; i < series.length; i++) {\r\n          records.push({ ts: series[i].ts, value: series[i].value });\r\n        }\r\n        if (series.length < PAGE_LIMIT) break;\r\n        const lastTs = series[series.length - 1].ts;\r\n        const next = (typeof lastTs === 'number' ? lastTs : parseInt(lastTs, 10)) + 1;\r\n        if (!(next > cursor)) break;\r\n        cursor = next;\r\n      }\r\n      return records;\r\n    }\r\n\r\n    function buildDeviceCSV(keyDataMap, tsFormat, customPattern) {\r\n      const allTs = uniqSorted([].concat(...Array.from(keyDataMap.values()).map(arr => arr.map(x => x.ts))));\r\n      const keys = Array.from(keyDataMap.keys());\r\n      const header = ['timestamp'].concat(keys).join(DELIMITER);\r\n      const perKeyMaps = {};\r\n      keys.forEach(k => {\r\n        const m = new Map();\r\n        (keyDataMap.get(k) || []).forEach(x => m.set(x.ts, x.value));\r\n        perKeyMaps[k] = m;\r\n      });\r\n      const lines = [header];\r\n      for (let i = 0; i < allTs.length; i++) {\r\n        const ts = allTs[i];\r\n        let tsOut;\r\n        if (tsFormat === 'none') tsOut = ts;\r\n        else if (tsFormat === 'custom' && customPattern) tsOut = formatWithPattern(ts, customPattern);\r\n        else tsOut = formatWithPattern(ts, tsFormat);\r\n        const row = [csvEscape(tsOut)];\r\n        for (let j = 0; j < keys.length; j++) {\r\n          const k = keys[j];\r\n          const v = perKeyMaps[k].has(ts) ? perKeyMaps[k].get(ts) : '';\r\n          row.push(csvEscape(v));\r\n        }\r\n        lines.push(row.join(DELIMITER));\r\n      }\r\n      return lines.join('\\n');\r\n    }\r\n\r\n    // Control name helpers for grouped form\r\n    vm.controlName = controlName;\r\n    function controlName(profile, key) { return profile + '::' + key; }\r\n    function splitControlName(name) {\r\n      const i = name.indexOf('::');\r\n      if (i === -1) return [name, ''];\r\n      return [name.slice(0, i), name.slice(i + 2)];\r\n    }\r\n\r\n    // ----- Export mode preview (bounded and token-shortened) -----\r\n    vm.onExportModeChange = function() { vm.updateExportModePreview(); };\r\n    function truncateLine(s, limit) { if (!s) return ''; return s.length <= limit ? s : s.slice(0, Math.max(0, limit - 5)) + ' ...'; }\r\n    function shortenToken(s, maxLen) { if (!s) return ''; const str = String(s); if (str.length <= maxLen) return str; const half = Math.floor(maxLen / 2); return str.slice(0, half) + '...' + str.slice(-half); }\r\n\r\n    vm.updateExportModePreview = function() {\r\n      try {\r\n        const tw = vm.timeForm.value || {};\r\n        const tsFormat = tw.tsFormat || 'none';\r\n        const customPattern = tw.customFormat || '';\r\n        const sampleTs = vm.startTs || Date.now();\r\n        let tsOut = '';\r\n        if (tsFormat === 'none') tsOut = String(sampleTs);\r\n        else if (tsFormat === 'custom' && customPattern) tsOut = formatWithPattern(sampleTs, customPattern);\r\n        else tsOut = formatWithPattern(sampleTs, tsFormat);\r\n\r\n        const selectedPairs = [];\r\n        const v = vm.timeseriesFormGroup.value || {};\r\n        Object.keys(v).forEach(name => { if (v[name]) { const [profile,key] = splitControlName(name); selectedPairs.push({ profile, key }); } });\r\n\r\n        if (!vm.deviceList.length || !selectedPairs.length) {\r\n          vm.exportModePreview = 'Select devices and datapoints to see a preview.';\r\n          return;\r\n        }\r\n\r\n        if (vm.exportMode === 'per-device') {\r\n          let dev = null;\r\n          let keysForDevice = [];\r\n          for (let i = 0; i < vm.deviceList.length; i++) {\r\n            const d = vm.deviceList[i];\r\n            const devKeys = vm.deviceTelemetryMap.get(d.id) || new Set();\r\n            const kfd = selectedPairs.filter(sp => sp.profile === d.profile && devKeys.has(sp.key)).map(sp => sp.key);\r\n            if (kfd.length) { dev = d; keysForDevice = kfd; break; }\r\n          }\r\n          if (!dev || !keysForDevice.length) {\r\n            vm.exportModePreview = 'No matching keys found on devices.';\r\n            return;\r\n          }\r\n          const slice = keysForDevice.slice(0, PREVIEW_MAX_COLS_PER_DEVICE).map(k => shortenToken(k, PREVIEW_TOKEN_MAX_LEN));\r\n          const extra = keysForDevice.length - slice.length;\r\n          let header = ['timestamp'].concat(slice).join(DELIMITER);\r\n          let row = [tsOut].concat(slice.map(() => '...')).join(DELIMITER);\r\n          header = truncateLine(header, PREVIEW_MAX_LINE_CHARS);\r\n          row = truncateLine(row, PREVIEW_MAX_LINE_CHARS);\r\n          vm.exportModePreview = header + '\\n' + row + (extra > 0 ? '\\n... (+ ' + extra + ' more columns)' : '');\r\n          return;\r\n        }\r\n\r\n        // single-file preview (Device Name: and Datapoint Name: headers)\r\n        const devicesSorted = vm.deviceList.slice().sort((a,b)=>a.name.localeCompare(b.name));\r\n        const devKeyOrder = [];\r\n        devicesSorted.forEach(d => {\r\n          const devKeys = vm.deviceTelemetryMap.get(d.id) || new Set();\r\n          const keys = selectedPairs\r\n            .filter(sp => sp.profile === d.profile && devKeys.has(sp.key))\r\n            .map(sp => sp.key)\r\n            .sort((a,b)=>a.localeCompare(b));\r\n          keys.forEach(k => devKeyOrder.push({ dev: d, key: k }));\r\n        });\r\n        if (!devKeyOrder.length) {\r\n          vm.exportModePreview = 'No matching keys across devices for preview.';\r\n          return;\r\n        }\r\n        const slice = devKeyOrder.slice(0, PREVIEW_MAX_COLS_SINGLEFILE);\r\n        const extra = devKeyOrder.length - slice.length;\r\n        let header1 = ['Device Name:'].concat(slice.map(x => shortenToken(x.dev.name || x.dev.id, PREVIEW_TOKEN_MAX_LEN))).join(DELIMITER);\r\n        let header2 = ['Datapoint Name:'].concat(slice.map(x => shortenToken(((x.dev.name || x.dev.id) + '_' + x.key).replace(/[^a-zA-Z0-9._-]/g, '_'), PREVIEW_TOKEN_MAX_LEN))).join(DELIMITER);\r\n        let row = [tsOut].concat(slice.map(() => '...')).join(DELIMITER);\r\n        header1 = truncateLine(header1, PREVIEW_MAX_LINE_CHARS);\r\n        header2 = truncateLine(header2, PREVIEW_MAX_LINE_CHARS);\r\n        row = truncateLine(row, PREVIEW_MAX_LINE_CHARS);\r\n        vm.exportModePreview = header1 + '\\n' + header2 + '\\n' + row + (extra > 0 ? '\\n... (+ ' + extra + ' more columns)' : '');\r\n      } catch (e) {\r\n        vm.exportModePreview = 'Preview unavailable.';\r\n      }\r\n    };\r\n\r\n    // Bootstrap\r\n    (async function bootstrap() {\r\n      try {\r\n        const rootIdValue = (entityId && typeof entityId === 'object' && entityId.id) ? entityId.id : entityId;\r\n        const rels = await apiFindRelationsDevices(rootIdValue);\r\n        const deviceIds = [];\r\n        for (let i = 0; i < rels.length; i++) {\r\n          const r = rels[i];\r\n          if (r && r.to && r.to.entityType === 'DEVICE' && r.to.id) {\r\n            deviceIds.push(r.to.id);\r\n          }\r\n        }\r\n        const uniqueIds = Array.from(new Set(deviceIds));\r\n\r\n        // Fetch device info (name, profile)\r\n        const devices = await runThrottled(uniqueIds, async (did) => {\r\n          const dev = await apiGetDevice(did);\r\n          const name = dev && dev.name ? dev.name : did;\r\n          const profile = dev && (dev.deviceProfileName || dev.type) ? (dev.deviceProfileName || dev.type) : 'Unknown';\r\n          return { id: did, name: name, profile: profile };\r\n        }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n        vm.deviceList = devices;\r\n\r\n        // For each device, get latest keys and group by profile\r\n        const profileKeyMap = new Map(); // profile -> Set(keys)\r\n        await runThrottled(vm.deviceList, async (dev) => {\r\n          const keys = (await apiLatestKeysForDevice(dev.id)).filter(k => !EXCLUDE_KEYS.has(k));\r\n          vm.deviceTelemetryMap.set(dev.id, new Set(keys));\r\n          if (!profileKeyMap.has(dev.profile)) profileKeyMap.set(dev.profile, new Set());\r\n          const s = profileKeyMap.get(dev.profile);\r\n          keys.forEach(k => s.add(k));\r\n        }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n        vm.profileNames = Array.from(profileKeyMap.keys()).sort((a,b)=>a.localeCompare(b));\r\n        vm.profileKeysMap = {};\r\n        vm.profileNames.forEach(p => {\r\n          vm.profileKeysMap[p] = Array.from(profileKeyMap.get(p)).sort((a,b)=>a.localeCompare(b));\r\n        });\r\n\r\n        // Build form controls per profile/key\r\n        vm.profileNames.forEach(p => {\r\n          const keys = vm.profileKeysMap[p] || [];\r\n          keys.forEach(k => {\r\n            vm.timeseriesFormGroup.addControl(controlName(p, k), vm.fb.control(false));\r\n          });\r\n        });\r\n\r\n        vm.isLoading$ = widgetContext.rxjs.of(false);\r\n      } catch (e) {\r\n        console.error('Bootstrap failed', e);\r\n        vm.isLoading$ = widgetContext.rxjs.of(false);\r\n        widgetContext.showErrorToast('Failed to prepare Export Telemetry dialog', 4000, 'top', 'center');\r\n      }\r\n    })();\r\n\r\n    // Step 1 handlers\r\n    vm.toggleSelectAll = function(checked) {\r\n      Object.keys(vm.timeseriesFormGroup.controls).forEach(name => {\r\n        vm.timeseriesFormGroup.get(name).setValue(checked, { emitEvent: false });\r\n      });\r\n    };\r\n    vm.selectAllInProfile = function(profile) {\r\n      const keys = vm.profileKeysMap[profile] || [];\r\n      keys.forEach(k => {\r\n        const cn = controlName(profile, k);\r\n        if (vm.timeseriesFormGroup.contains(cn)) vm.timeseriesFormGroup.get(cn).setValue(true, { emitEvent: false });\r\n      });\r\n    };\r\n    vm.clearAllInProfile = function(profile) {\r\n      const keys = vm.profileKeysMap[profile] || [];\r\n      keys.forEach(k => {\r\n        const cn = controlName(profile, k);\r\n        if (vm.timeseriesFormGroup.contains(cn)) vm.timeseriesFormGroup.get(cn).setValue(false, { emitEvent: false });\r\n      });\r\n    };\r\n    vm.hasSelectedTimeseries = function() {\r\n      const v = vm.timeseriesFormGroup.value || {};\r\n      return Object.keys(v).some(n => !!v[n]);\r\n    };\r\n\r\n    // Timestamp format interactions\r\n    vm.onTsFormatChange = function() { vm.validateCustomFormat(); vm.updateExportModePreview(); };\r\n    vm.validateCustomFormat = function() {\r\n      const fmt = vm.timeForm.get('customFormat').value || '';\r\n      const sel = vm.timeForm.get('tsFormat').value;\r\n      if (sel !== 'custom') { vm.customFormatInvalid = false; vm.customPreview = ''; vm.customFormatError = ''; return; }\r\n      const sampleTs = Date.UTC(2000, 0, 2, 3, 4, 5, 6);\r\n      vm.customPreview = fmt ? formatWithPattern(sampleTs, fmt) : '';\r\n      const res = validateCustomPatternSimple(fmt);\r\n      vm.customFormatInvalid = !res.ok;\r\n      vm.customFormatError = res.msg || 'Invalid format.';\r\n    };\r\n\r\n    // Build review view\r\n    vm.prepareReview = function() {\r\n      const v = vm.timeseriesFormGroup.value || {};\r\n      const lines = [];\r\n      Object.keys(v).forEach(name => { if (v[name]) { const spl = splitControlName(name); lines.push(spl[0] + ':' + spl[1]); } });\r\n      vm.reviewSelectedList = lines.sort((a,b)=>a.localeCompare(b));\r\n\r\n      const tw = vm.timeForm.value || {};\r\n      vm.startTs = combineDateAndTime(tw.startDate, tw.startTime);\r\n      vm.endTs   = combineDateAndTime(tw.endDate, tw.endTime);\r\n      vm.intervalMin = typeof tw.intervalMin === 'number' ? tw.intervalMin : parseInt(tw.intervalMin || '0', 10);\r\n      vm.tsFormatLabel = tw.tsFormat === 'custom' ? ('custom: ' + (tw.customFormat || '')) : (tw.tsFormat || 'none');\r\n\r\n      if (!vm.startTs || !vm.endTs || vm.startTs >= vm.endTs) {\r\n        widgetContext.showWarningToast('Please select a valid time window', 3000, 'top', 'center');\r\n      }\r\n\r\n      vm.updateExportModePreview();\r\n    };\r\n\r\n    // Export action\r\n    vm.exportData = async function() {\r\n      if (!vm.hasSelectedTimeseries()) {\r\n        widgetContext.showWarningToast('No datapoints selected', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n      const tw = vm.timeForm.value || {};\r\n      const startTs = combineDateAndTime(tw.startDate, tw.startTime);\r\n      const endTs   = combineDateAndTime(tw.endDate, tw.endTime);\r\n      if (!startTs || !endTs || startTs >= endTs) {\r\n        widgetContext.showWarningToast('Please select a valid time window', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n      if (tw.tsFormat === 'custom' && vm.customFormatInvalid) {\r\n        widgetContext.showWarningToast('Custom timestamp format has errors. Please fix it before continuing.', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n      const intervalMin = typeof tw.intervalMin === 'number' ? tw.intervalMin : parseInt(tw.intervalMin || '0', 10);\r\n      const intervalMs = intervalMin > 0 ? intervalMin * 60 * 1000 : 0;\r\n\r\n      const selectedPairs = [];\r\n      const v = vm.timeseriesFormGroup.value || {};\r\n      Object.keys(v).forEach(name => {\r\n        if (v[name]) {\r\n          const [profile, key] = splitControlName(name);\r\n          selectedPairs.push({ profile, key });\r\n        }\r\n      });\r\n      if (!selectedPairs.length) {\r\n        widgetContext.showWarningToast('No datapoints selected', 3000, 'top', 'center');\r\n        return;\r\n      }\r\n\r\n      if (vm.exportMode === 'per-device') {\r\n        vm.exportTotal = vm.deviceList.length;\r\n        vm.exported = 0;\r\n\r\n        try {\r\n          await runThrottled(vm.deviceList, async (dev) => {\r\n            const deviceRef = { entityType: 'DEVICE', id: dev.id };\r\n            const devKeys = vm.deviceTelemetryMap.get(dev.id) || new Set();\r\n            const keysForDevice = selectedPairs\r\n              .filter(sp => sp.profile === dev.profile && devKeys.has(sp.key))\r\n              .map(sp => sp.key);\r\n\r\n            const batches = [];\r\n            for (let i = 0; i < keysForDevice.length; i += FETCH_CONCURRENCY_KEYS) {\r\n              batches.push(keysForDevice.slice(i, i + FETCH_CONCURRENCY_KEYS));\r\n            }\r\n            const keyDataMap = new Map();\r\n            for (let b = 0; b < batches.length; b++) {\r\n              const batch = batches[b];\r\n              const results = await Promise.all(batch.map(k => fetchAllForKey(\r\n                deviceRef, k, startTs, endTs, intervalMs > 0 ? intervalMs : undefined\r\n              )));\r\n              for (let j = 0; j < batch.length; j++) {\r\n                keyDataMap.set(batch[j], results[j]);\r\n              }\r\n            }\r\n\r\n            const nameSafe = (dev.name && String(dev.name).trim().length ? dev.name : dev.id).replace(/[^a-zA-Z0-9._-]/g, '_');\r\n            const csv = buildDeviceCSV(keyDataMap, tw.tsFormat, tw.customFormat);\r\n            downloadCSV(nameSafe + '.csv', csv);\r\n\r\n            vm.exported++;\r\n          }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n          vm.dialogRef.close({\r\n            mode: 'per-device',\r\n            exportedDevices: vm.deviceList.length,\r\n            selectedPairs: vm.reviewSelectedList.slice(),\r\n            startTs: startTs,\r\n            endTs: endTs,\r\n            intervalMinutes: intervalMin || 0,\r\n            tsFormat: tw.tsFormat,\r\n            customFormat: tw.customFormat || ''\r\n          });\r\n        } catch (e) {\r\n          console.error('Export failed', e);\r\n          widgetContext.showErrorToast('Export failed for some devices. See console for details.', 4000, 'top', 'center');\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Single-file CSV for all devices\r\n      try {\r\n        const tasks = [];\r\n        const devKeyOrder = [];\r\n        const devicesSorted = vm.deviceList.slice().sort((a,b)=>a.name.localeCompare(b.name));\r\n        devicesSorted.forEach(dev => {\r\n          const devKeys = vm.deviceTelemetryMap.get(dev.id) || new Set();\r\n          const keysForDevice = selectedPairs\r\n            .filter(sp => sp.profile === dev.profile && devKeys.has(sp.key))\r\n            .map(sp => sp.key)\r\n            .sort((a,b)=>a.localeCompare(b));\r\n          keysForDevice.forEach(k => {\r\n            tasks.push({ dev, key: k });\r\n            devKeyOrder.push({ dev, key: k });\r\n          });\r\n        });\r\n\r\n        const pairResults = {};\r\n        await runThrottled(tasks, async (t) => {\r\n          const deviceRef = { entityType: 'DEVICE', id: t.dev.id };\r\n          const data = await fetchAllForKey(deviceRef, t.key, startTs, endTs, intervalMs > 0 ? intervalMs : undefined);\r\n          pairResults[t.dev.id + '|' + t.key] = data;\r\n        }, FETCH_CONCURRENCY_DEVICES);\r\n\r\n        const tsUnion = [];\r\n        const tsSet = new Set();\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const arr = pairResults[dev.id + '|' + key] || [];\r\n          arr.forEach(x => { if (!tsSet.has(x.ts)) { tsSet.add(x.ts); tsUnion.push(x.ts); } });\r\n        });\r\n        tsUnion.sort((a,b)=>a-b);\r\n\r\n        const lookup = {};\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const map = new Map();\r\n          const arr = pairResults[dev.id + '|' + key] || [];\r\n          arr.forEach(x => map.set(x.ts, x.value));\r\n          lookup[dev.id + '|' + key] = map;\r\n        });\r\n\r\n        const header1 = ['Device Name:'];\r\n        const header2 = ['Datapoint Name:'];\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const name = dev.name || dev.id;\r\n          header1.push(name);\r\n          header2.push((name + '_' + key).replace(/[^a-zA-Z0-9._-]/g, '_'));\r\n        });\r\n\r\n        const lines = [];\r\n        lines.push(header1.join(DELIMITER));\r\n        lines.push(header2.join(DELIMITER));\r\n\r\n        const tsFormat = vm.timeForm.get('tsFormat').value;\r\n        const customPattern = vm.timeForm.get('customFormat').value || '';\r\n        for (let i = 0; i < tsUnion.length; i++) {\r\n          const ts = tsUnion[i];\r\n          let tsOut;\r\n          if (tsFormat === 'none') tsOut = ts;\r\n          else if (tsFormat === 'custom' && customPattern) tsOut = formatWithPattern(ts, customPattern);\r\n          else tsOut = formatWithPattern(ts, tsFormat);\r\n\r\n        const row = [csvEscape(tsOut)];\r\n        devKeyOrder.forEach(({dev, key}) => {\r\n          const m = lookup[dev.id + '|' + key];\r\n          const v = m && m.has(ts) ? m.get(ts) : '';\r\n          row.push(csvEscape(v));\r\n        });\r\n        lines.push(row.join(DELIMITER));\r\n        }\r\n\r\n        const csvAll = lines.join('\\n');\r\n        downloadCSV('all_devices.csv', csvAll);\r\n\r\n        vm.dialogRef.close({\r\n          mode: 'single-file',\r\n          deviceCount: devicesSorted.length,\r\n          columnCount: devKeyOrder.length,\r\n          startTs: startTs,\r\n          endTs: endTs\r\n        });\r\n      } catch (e) {\r\n        console.error('Aggregate export failed', e);\r\n        widgetContext.showErrorToast('Aggregate export failed. See console for details.', 4000, 'top', 'center');\r\n      }\r\n    };\r\n  }\r\n}\r\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1d849014-0fd1-1cba-a117-3d83a6c78431"
              },
              {
                "name": "getHistoricalDataCancom",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.getHistoricalDataCancom(widgetContext,entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a83139e4-d301-9e18-ae90-dd6cf251d7fc"
              }
            ],
            "rowClick": [
              {
                "name": "Show Location Attributes",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedLocation",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a8645ee4-3f50-7594-5eb1-83b0e5a45cae"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.location-table.add-location.titel}",
                "buttonType": "icon",
                "icon": "domain_add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addLocation(widgetContext,entityId,entityName,entityLabel,\"Locations\");\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0503a2f0-ee63-219c-2690-69d592f013e4"
              }
            ],
            "rowDoubleClick": [
              {
                "name": "Open Location Devices Double Click",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Devices",
                "setEntityId": true,
                "stateEntityParamName": "",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d6c6677-6196-87b1-4d1b-192b6b6e669c"
              }
            ]
          },
          "showTitleIcon": true,
          "titleIcon": "domain",
          "iconColor": null,
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "f7e39953-8e8c-5b27-e7b4-caf73e5f325c"
      },
      "3129dfb9-e858-a56f-349e-89db306a65a8": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "59c9369c-da56-a2ff-23b6-a614bece0be0",
              "dataKeys": [
                {
                  "name": "title",
                  "type": "entityField",
                  "label": "Title",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.6231912076992963,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "90b53ba0-4ef8-c53d-09f2-cfa630c2eb44",
              "dataKeys": [
                {
                  "name": "email",
                  "type": "entityField",
                  "label": "Email",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.26772310785005327
                },
                {
                  "name": "userRole",
                  "type": "attribute",
                  "label": "userRole",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.5138309401814326
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#E0E0E0",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "/*let owner, userRole, customer, currentUser, userName, userId, userLabel;\r\n\r\nif (data[0] && data[0].$datasource.entity.id.entityType !== \"TENANT\" && data[0].$datasource.entity.id.entityType !== \"CUSTOMER\") {\r\n  owner = data[1].$datasource.entity;\r\n  userRole = data[0].userRole || '';\r\n  currentUser = data[0].Email || '';\r\n  userName = data[0].entityName;\r\n  userId = { entityType: data[0].entityType, id: data[0].entityId };\r\n  userLabel = data[0].entityLabel;\r\n} else {\r\n  owner = data[0].$datasource.entity;\r\n  userRole = data[1].userRole || '';\r\n  currentUser = data[1].Email || '';\r\n  userName = data[1].entityName;\r\n  userId = { entityType: data[1].entityType, id: data[1].entityId };\r\n  userLabel = data[1].entityLabel;\r\n}\r\n\r\n\r\nconst stateParams      = ctx.stateController.getStateParams() || {};\r\nconst injector         = ctx.$scope.$injector;\r\nconst attributeService = injector.get(ctx.servicesMap.get('attributeService'));*/\r\n\r\nconst headerHtml =\r\n  '<div class=\"header\">' +\r\n    '<div class=\"header-left\">' +\r\n      '<div class=\"title\">Energiemanagement Administration</div>' +\r\n    '</div>' +\r\n    '<div class=\"header-right\">' +\r\n      '<button id=\"add-customer-button\" type=\"button\" class=\"header-btn primary-btn\" matTooltip=\"Add Customer\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">add</mat-icon>' + '<span>Add Customer</span>' +\r\n      '</button>' +\r\n      '<button id=\"alarm-dashboard-button\" type=\"button\" class=\"header-btn accent-btn\" matTooltip=\"Open Alarm Dashboard\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">notification_important</mat-icon>' + '<span>Alarm Dashboard</span>' +\r\n      '</button>' +\r\n    '</div>' +\r\n  '</div>';\r\n\r\nvar layoutHtml =\r\n  '<div class=\"main-layout flex flex-col w-full h-full\">' +\r\n    headerHtml +\r\n    '<tb-dashboard-state ' +\r\n      'class=\"flex-1\" ' +\r\n      '[ctx]=\"ctx\" ' +\r\n      '[syncParentStateParams]=\"true\" ' +\r\n      'stateId=\"Home Dashboard Widgets\">' +\r\n    '</tb-dashboard-state>' +\r\n  '</div>';\r\n\r\nreturn layoutHtml;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* ===============================\r\n   Buttons (unchanged)\r\n=================================*/\r\n.header-btn {\r\n  padding: 0 18px;\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;\r\n  cursor: pointer;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;\r\n}\r\n.blue-btn { background-color: var(--tb-primary-500); }\r\n.green-btn { background-color: var(--tb-accent-500); }\r\n.green-btn:hover { background-color: var(--tb-accent-600); }\r\n.purple-btn { background-color: #8E24AA; }\r\n.purple-btn:hover { background-color: #7B1FA2; }\r\n.header-btn mat-icon { font-size: 18px; color: #fff; }\r\n\r\n/* ===============================\r\n   Layout\r\n=================================*/\r\n.main-layout {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n/* ===============================\r\n   HEADER (20px radius that actually shows)\r\n   - clip children to radius\r\n   - left inset\r\n   - tight gap to dashboard\r\n=================================*/\r\n.main-layout .header {\r\n  height: 75px;\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  background: #fff;\r\n  padding: 0 16px 0 24px !important;  /* left inset */\r\n  margin-bottom: 10px !important;       /* smaller gap to dashboard */\r\n\r\n  border-radius: 20px !important;       /* force the 20px radius */\r\n  overflow: hidden;                     /*  clip children to the rounded corners */\r\n}\r\n\r\n/* Remove flex-gap margins so padding controls left edge precisely */\r\n.main-layout .header > * {\r\n  margin-left: 0 !important;\r\n  margin-right: 0 !important;\r\n}\r\n\r\n/* Some builds wrap inner row; reset any spacing/background there too */\r\n.main-layout .header > [fxlayout],\r\n.main-layout .header > [fxlayout] > * {\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  background: transparent !important;   /* ensure no inner block paints square corners */\r\n}\r\n\r\n/* Title styling */\r\n.main-layout .header .title {\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n  color: #28232D;\r\n  font-family: 'Roboto', sans-serif;\r\n  letter-spacing: 0.5px;\r\n  margin-left: 0 !important;\r\n}\r\n\r\n/* Optional logo rule */\r\n.main-layout .header .logo {\r\n  max-height: 60px;\r\n  width: auto;\r\n  margin-right: 12px;\r\n}\r\n\r\n/* ===============================\r\n   DASHBOARD STATE\r\n   - keep 20px radius\r\n   - remove top spacing\r\n=================================*/\r\n.main-layout tb-dashboard-state {\r\n  display: block;\r\n  background: #fff;\r\n  border-radius: 20px;\r\n  overflow: hidden;\r\n  box-shadow: none;\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n/* If the first child inside the state adds spacing, remove it */\r\n.main-layout tb-dashboard-state > *:first-child {\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n\r\n\r\n.header-btn {\r\n  padding: 0 18px;                  /*  horizontal breathing room */\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;            /* full pill shape */\r\n  cursor: pointer;\r\n  display: inline-flex;             /* inline sizing */\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;                         /* spacing between icon & text */\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;              /* prevent wrapping */\r\n}\r\n\r\n/* make the header actually behave like the fxLayout you intended */\r\n.main-layout .header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between; /* < important */\r\n}\r\n\r\n/* ensure the button has a visible background even if the CSS var is missing */\r\n.primary-btn {\r\n  background-color: var(--tb-primary-500, #0084D6); /* fallback color */\r\n}\r\n\r\n.accent-btn {\r\n  background-color: var(--tb-accent-500, #0084D6); /* fallback color */\r\n}\r\n\r\n/* Purple variant */\r\n.purple-btn {\r\n  background-color: #8E24AA; /* base purple */\r\n}\r\n\r\n/* optional: make sure the right side lays out correctly even without fxLayout */\r\n.header-right {\r\n  display: inline-flex;\r\n  align-items: center;\r\n}"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "change-customer",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeCustomer(widgetContext);\r\n/*// 1) Injector & Services\r\nconst ctx              = widgetContext;\r\nconst injector         = ctx.$scope.$injector;\r\nconst customDialog     = injector.get(ctx.servicesMap.get('customDialog'));\r\nconst customerService  = injector.get(ctx.servicesMap.get('customerService'));\r\nconst tenantService    = injector.get(ctx.servicesMap.get('tenantService')); // NEW\r\nconst currentUser      = ctx.currentUser; // NEW\r\n\r\n// Determine the owner entity of the currently logged-in user (TENANT or CUSTOMER)\r\nconst ownerRef = (currentUser && currentUser.authority === 'TENANT_ADMIN')\r\n  ? { entityType: 'TENANT',   id: currentUser.tenantId }\r\n  : { entityType: 'CUSTOMER', id: currentUser.customerId };\r\n\r\n// 2) Storage for loaded customers\r\nlet customers = [];\r\n\r\n// 3) Load all customers, map & sort, then also fetch and prepend the Owner option\r\nconst pageLink = ctx.pageLink(1000, 0, null, null, null);\r\ncustomerService.getUserCustomers(pageLink).subscribe(pageData => {\r\n  customers = (pageData.data || [])\r\n    .map(c => ({\r\n      entityId:    c.id,      // c.id is typically { id: string, entityType: 'CUSTOMER' }\r\n      entityName:  c.name,    // for display\r\n      entityLabel: c.title    // optional label\r\n    }))\r\n    .sort((a, b) => (a.entityName || '').localeCompare(b.entityName || ''));\r\n\r\n  // After customers are in place, fetch the actual owner's display name and prepend as an option\r\n  addOwnerOptionAndOpen();\r\n}, err => {\r\n  // Even if fetching customers fails, try to show dialog with just Owner option\r\n  console.error('Failed to fetch customers', err);\r\n  customers = [];\r\n  addOwnerOptionAndOpen();\r\n});\r\n\r\n// Helper: fetch owner (tenant/customer) display info and prepend to list, then open dialog\r\nfunction addOwnerOptionAndOpen() {\r\n  if (!ownerRef || !ownerRef.id) {\r\n    // No owner info; just open with whatever we have\r\n    openChangeCustomerDialog();\r\n    return;\r\n  }\r\n\r\n  if (ownerRef.entityType === 'TENANT') {\r\n    // Fetch tenant name/title\r\n    tenantService.getTenant(ownerRef.id).subscribe(tenant => {\r\n      const ownerOption = {\r\n        entityId:    { id: tenant.id.id, entityType: 'TENANT' },\r\n        entityName:  tenant.title || 'Tenant',\r\n        entityLabel: tenant.title || 'Tenant'\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch tenant owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  } else {\r\n    // Fetch customer name/title\r\n    customerService.getCustomer(ownerRef.id).subscribe(cust => {\r\n      const ownerOption = {\r\n        entityId:    { id: cust.id.id, entityType: 'CUSTOMER' },\r\n        entityName:  (cust.title || cust.name || 'Customer'),\r\n        entityLabel: (cust.title || cust.name || 'Customer')\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch customer owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  }\r\n}\r\n\r\n// 4) Open dialog once customers (and owner) are ready\r\nfunction openChangeCustomerDialog() {\r\n  customDialog\r\n    .customDialog(htmlTemplate, ChangeCustomerController)\r\n    .subscribe();\r\n}\r\n\r\n// 5) Dialog controller\r\nfunction ChangeCustomerController(instance) {\r\n  const vm = instance;\r\n\r\n  // No prefill from state  start empty\r\n  vm.customers         = customers;\r\n  vm.filteredCustomers = vm.customers.slice();\r\n  vm.isLoading$        = ctx.rxjs.of(false);\r\n\r\n  // Empty form (no preselected value, empty input)\r\n  vm.form = vm.fb.group({\r\n    selected:      [ null ],\r\n    customerInput: [ '' ]\r\n  });\r\n\r\n  // Render name in input/options\r\n  vm.displayCustomer = (c) => c ? (c.entityLabel || c.entityName || '') : '';\r\n\r\n  // Filter logic for type-ahead\r\n  function applyCustomerFilter() {\r\n    const raw  = vm.form.get('customerInput').value;\r\n    const term = (typeof raw === 'string' ? raw : vm.displayCustomer(raw))\r\n      .toString()\r\n      .toLowerCase()\r\n      .trim();\r\n\r\n    vm.filteredCustomers = !term\r\n      ? vm.customers.slice()\r\n      : vm.customers.filter(c => (\r\n          (c.entityName  || '').toLowerCase().includes(term) ||\r\n          (c.entityLabel || '').toLowerCase().includes(term)\r\n        ));\r\n  }\r\n\r\n  // When typing, clear selection and filter list\r\n  vm.form.get('customerInput').valueChanges.subscribe(val => {\r\n    if (typeof val === 'string') {\r\n      vm.form.patchValue({ selected: null }, { emitEvent: false });\r\n    }\r\n    applyCustomerFilter();\r\n  });\r\n\r\n  // When a customer is picked from autocomplete, sync both controls\r\n  vm.onCustomerSelected = function(sel) {\r\n    vm.form.patchValue({\r\n      selected:      sel,\r\n      customerInput: sel\r\n    });\r\n  };\r\n\r\n  vm.cancel = () => vm.dialogRef.close(null);\r\n\r\n  vm.ok = () => {\r\n    const sel = vm.form.value.selected;\r\n    if (sel) {\r\n      const stateParams = ctx.stateController.getStateParams() || {};\r\n      stateParams.selectedCustomer = {\r\n        entityId:    sel.entityId,\r\n        entityName:  sel.entityName,\r\n        entityLabel: sel.entityLabel\r\n      };\r\n      stateParams.targetEntityParamName = 'selectedCustomer';\r\n      ctx.stateController.updateState(null, stateParams);\r\n      ctx.updateAliases();\r\n    }\r\n    vm.dialogRef.close(null);\r\n  };\r\n}\r\n\r\n// 6) HTML template (searchable customer/owner with mat-autocomplete; no prefill)\r\nconst htmlTemplate = '\\\r\n<form #changeForm=\"ngForm\" [formGroup]=\"form\"\\\r\n      (ngSubmit)=\"ok()\"\\\r\n      class=\"add-entity-form max-w-3xl mx-auto\" style=\"width:600px;\">\\\r\n\\\r\n  <mat-toolbar color=\"primary\" class=\"flex items-center bg-primary text-white px-4\">\\\r\n    <h2 class=\"text-lg font-semibold\">Change Customer / Owner</h2>\\\r\n    <span class=\"flex-1\"></span>\\\r\n    <button mat-icon-button type=\"button\" (click)=\"cancel()\">\\\r\n      <mat-icon>close</mat-icon>\\\r\n    </button>\\\r\n  </mat-toolbar>\\\r\n\\\r\n  <mat-progress-bar *ngIf=\"isLoading$ | async\"\\\r\n                    mode=\"indeterminate\" color=\"warn\">\\\r\n  </mat-progress-bar>\\\r\n  <div style=\"height:4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\\\r\n\\\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\\\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\\r\n      <mat-label>Select Customer or Owner</mat-label>\\\r\n\\\r\n      <input type=\"text\"\\\r\n             matInput\\\r\n             placeholder=\"Type to search customers or owner\"\\\r\n             [matAutocomplete]=\"custAuto\"\\\r\n             formControlName=\"customerInput\">\\\r\n\\\r\n      <mat-autocomplete\\\r\n        #custAuto=\"matAutocomplete\"\\\r\n        [displayWith]=\"displayCustomer\"\\\r\n        (optionSelected)=\"onCustomerSelected($event.option.value)\">\\\r\n\\\r\n        <mat-option *ngFor=\"let c of filteredCustomers\" [value]=\"c\">\\\r\n          {{ c.entityName }}\\\r\n        </mat-option>\\\r\n      </mat-autocomplete> \\\r\n    </mat-form-field> \\\r\n  </div> \\\r\n\\\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2\">\\\r\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"\\\r\n            [disabled]=\"(isLoading$ | async)\">\\\r\n      Cancel\\\r\n    </button>\\\r\n    <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\\r\n            [disabled]=\"(isLoading$ | async) || !form.value.selected\">\\\r\n      OK\\\r\n    </button>\\\r\n  </div>\\\r\n</form>';\r\n*/",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fd0d775f-d04e-1c4c-b592-da2b6d5f5be3"
              },
              {
                "name": "user-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "user_management_all",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e41e5cf8-f901-bdad-77d0-6b9feb7d22e3"
              },
              {
                "name": "customer-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "retail_companies",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2529050e-4b2f-53b4-2568-5782da1d9434"
              },
              {
                "name": "mobile-qr",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "mobile_app",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "25vw",
                "popoverHeight": "25vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2122aec7-4926-fef5-74e0-faa8f42a6fac"
              },
              {
                "name": "add-customer-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addCustomer(widgetContext);\r\n ",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f142b6d9-723c-1d85-e775-4eb671269515"
              },
              {
                "name": "alarm-dashboard-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "64ff6030-b3f6-11f0-a397-f7986a67a112",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c9306f09-1a4b-36d3-7f65-b26590a372bc"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "3129dfb9-e858-a56f-349e-89db306a65a8"
      },
      "292acb9f-d7c9-c75c-34b5-2803e6cdf30e": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "1920dc6c-9713-2417-6ae6-6344562e09e0",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1760428267158,
                "endTimeMs": 1760514667158
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "const params = ctx.stateController.getStateParams() || {};\r\nconst userRole = params.currentUser?.userRole || '';\r\n\r\nlet mode;\r\n\r\nif (params.homeWidgetMode?.entityName) {\r\n  mode = params.homeWidgetMode.entityName;\r\n} else {\r\n  mode = 'customers';\r\n  params.homeWidgetMode = { entityName: mode };\r\n  ctx.stateController.updateState(null, params);\r\n}\r\n\r\nvar vm = this;\r\nvm.mode = mode;\r\n\r\nvm.updateMode = function(newMode) {\r\n  const p = vm.ctx.stateController.getStateParams() || {};\r\n  p.homeWidgetMode = { entityName: newMode };\r\n  vm.ctx.stateController.updateState(null, p);\r\n};\r\n\r\nconst btnDefaultStyle = `\r\n  background: transparent;\r\n  color: var(--tb-primary-500);\r\n  border: 0;\r\n  border-radius: 9999px;\r\n  padding: 8px 16px;\r\n  line-height: 1;\r\n  margin: 0;\r\n  flex: 1 1 0;\r\n  text-align: center;\r\n`;\r\n\r\nconst btnActiveStyle = `\r\n  background: var(--tb-primary-500);\r\n  color: #FFF;\r\n  border: 0;\r\n  border-radius: 9999px;\r\n  padding: 8px 16px;\r\n  line-height: 1;\r\n  margin: 0;\r\n  flex: 1 1 0;\r\n  text-align: center;\r\n`;\r\n\r\nfunction btnStyleFor(entity) {\r\n  return mode === entity ? btnActiveStyle : btnDefaultStyle;\r\n}\r\n\r\nconst wrapperStyle = 'padding:8px 8px 0 8px; background:#fff;';\r\nconst trackStyle = [\r\n  'display:flex',\r\n  'align-items:center',\r\n  'width:100%',\r\n  'gap:8px',\r\n  'border-radius:9999px',\r\n  'overflow:hidden',\r\n  'box-sizing:border-box',\r\n  'padding:0',\r\n  'background: rgba(0,0,0,0.03)'\r\n].join(';') + ';';\r\n\r\nlet buttonsHtml =\r\n  '<div style=\"' + wrapperStyle + '\">'\r\n+ '  <div style=\"' + trackStyle + '\">'\r\n+ '    <button id=\"customers-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('customers') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'customers\\')\"><span>Customers</span></button>'\r\n+ '    <button id=\"alarms-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('alarms') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'alarms\\')\"><span>Alarms</span></button>'\r\n+ '  </div>'\r\n+ '</div>';\r\n\r\nlet stateHtml = '';\r\nif (mode === 'customers') {\r\n  stateHtml =\r\n    '<tb-dashboard-state class=\"w-full\" style=\"margin:0; padding:0\" [ctx]=\"ctx\" ' +\r\n    '[syncParentStateParams]=\"true\" stateId=\"Customers Card\"></tb-dashboard-state>';\r\n} else if (mode === 'alarms') {\r\n  stateHtml =\r\n    '<tb-dashboard-state class=\"w-full\" style=\"margin:0; padding:0\" [ctx]=\"ctx\" ' +\r\n    '[syncParentStateParams]=\"true\" stateId=\"Alarms Card\"></tb-dashboard-state>';\r\n}\r\n\r\nreturn ''\r\n+ '<div class=\"main-layout w-full h-full flex flex-col\" style=\"margin:0; padding:0;\">'\r\n+   buttonsHtml\r\n+   '<div class=\"flex-1 w-full overflow-hidden\" style=\"margin:0; padding:0;\">'\r\n+     stateHtml\r\n+   '</div>'\r\n+ '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ""
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "customers-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"customers\";\nlet params = widgetContext.stateController.getStateParams();\nparams['homeWidgetMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6cccc5\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"homeWidgetMode\";\nparams['selectedDevice'] = null;\nparams['selectedLocation'] = null;\nparams['selectedArea'] = null;\nparams['locMode'] = null;\nparams['tabMode'] = null;\nparams['deviceMode'] = null;\nparams['datapoints'] = null;\nparams['mainDatapoint'] = null;\nparams['gatewaysMode'] = null;\nparams['alarmsMode'] = null;\n//params['locationMode'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0f8b27e5-6bda-e394-1212-14352bbb4a0f"
              },
              {
                "name": "alarms-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"alarms\";\nlet params = widgetContext.stateController.getStateParams();\nparams['homeWidgetMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6cccc7\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"homeWidgetMode\";\nparams['selectedDevice'] = null;\nparams['selectedLocation'] = null;\nparams['selectedArea'] = null;\nparams['locMode'] = null;\nparams['tabMode'] = null;\nparams['deviceMode'] = null;\nparams['datapoints'] = null;\nparams['mainDatapoint'] = null;\nparams['gatewaysMode'] = null;\nparams['alarmsMode'] = null;\n//params['locationMode'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d7019ee7-f0e4-8036-ec85-203e581da625"
              }
            ]
          },
          "enableDataExport": false,
          "borderRadius": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "292acb9f-d7c9-c75c-34b5-2803e6cdf30e"
      },
      "593c9923-4417-a309-c857-d3d1aa863653": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"location-layout flex flex-col p-4\" style=\"width: 100%; height: 100%; padding: 0;\">\n     <div class=\"alarm-badges-layout\">\n         <tb-dashboard-state class=\"alarm-badges\" *ngIf=\"!ctx.stateController.getStateParams().selectedLocation\" [ctx]=\"ctx\" stateId=\"Locations Map Alarm Badges\"></tb-dashboard-state>\n         <tb-dashboard-state class=\"alarm-badges\" *ngIf=\"ctx.stateController.getStateParams().selectedLocation\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Locations Map Alarm Badges\"></tb-dashboard-state>\n     </div>\n     <div *ngIf=\"!ctx.stateController.getStateParams().selectedLocation\" class=\"flex flex-col p-4\" style=\"width: 100%; height: 50px;\">\n        <!--<h5 class=\"location-title\">Locations</h5>-->\n<!--        <h5 class=\"state-filter-title\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"alarm_state_filter\"></tb-dashboard-state>-->\n        <!--<mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>-->\n     </div>\n     <div *ngIf=\"ctx.stateController.getStateParams().selectedLocation\" class=\"flex flex-col p-4\" style=\"width: 100%; height: 50px;\">\n        <!--<h5 class=\"location-title\">Locations</h5>-->\n<!--        <h5 class=\"state-filter-title\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"alarm_state_filter\"></tb-dashboard-state>-->\n        <!--<mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>-->\n     </div>\n<!--     <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedLocation\" style=\"height: 170px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"supermarket_card_header\"></tb-dashboard-state>-->\n    <div class=\"flex-1 flex flex-col\" style=\"position: relative;\">\n        <tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Locations Map\"></tb-dashboard-state>\n    </div>\n</div>",
            "markdownTextFunction": "return '# Some title\\\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.location-layout {\n    position: relative;\n}\n\n.location-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n.state-filter-title {\n    padding-bottom: 15px;\n    padding-left: 10px;\n}\n\n.location-layout .alarm-badges-layout {\n    position: absolute;\n    height: 50px;\n    top: 0;\n    left: 0;\n    right: 0;\n    z-index: 2;\n    display: flex;\n    justify-content: center;\n    pointer-events: none;\n}\n\n.location-layout .alarm-badges-layout .alarm-badges {\n    height: 60px;\n    width: 500px;\n    pointer-events: all;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 4px !important;\n    margin-bottom: 4px !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mdc-form-field > label {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "593c9923-4417-a309-c857-d3d1aa863653",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "507dbe87-a5d9-1deb-b009-743fabb573dc": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "11c3ee82-3f40-99af-3060-cf8cb4b87f6a",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1760428267158,
                "endTimeMs": 1760514667158
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "const params = ctx.stateController.getStateParams() || {};\r\nconst userRole = params.currentUser?.userRole || '';\r\n\r\nlet mode;\r\n\r\nif (params.locationsMode?.entityName) {\r\n  mode = params.locationsMode.entityName;\r\n} else {\r\n  mode = 'locations';\r\n  params.locationsMode = { entityName: mode };\r\n  ctx.stateController.updateState(null, params);\r\n}\r\n\r\nvar vm = this;\r\nvm.mode = mode;\r\n\r\nvm.updateMode = function(newMode) {\r\n  const p = vm.ctx.stateController.getStateParams() || {};\r\n  p.locationsMode = { entityName: newMode };\r\n  vm.ctx.stateController.updateState(null, p);\r\n};\r\n\r\nconst btnDefaultStyle = `\r\n  background: transparent;\r\n  color: var(--tb-primary-500);\r\n  border: 0;\r\n  border-radius: 9999px;\r\n  padding: 8px 16px;\r\n  line-height: 1;\r\n  margin: 0;\r\n  flex: 1 1 0;\r\n  text-align: center;\r\n`;\r\n\r\nconst btnActiveStyle = `\r\n  background: var(--tb-primary-500);\r\n  color: #FFF;\r\n  border: 0;\r\n  border-radius: 9999px;\r\n  padding: 8px 16px;\r\n  line-height: 1;\r\n  margin: 0;\r\n  flex: 1 1 0;\r\n  text-align: center;\r\n`;\r\n\r\nfunction btnStyleFor(entity) {\r\n  return mode === entity ? btnActiveStyle : btnDefaultStyle;\r\n}\r\n\r\nconst wrapperStyle = 'padding:8px 8px 0 8px; background:#fff;';\r\nconst trackStyle = [\r\n  'display:flex',\r\n  'align-items:center',\r\n  'width:100%',\r\n  'gap:8px',\r\n  'border-radius:9999px',\r\n  'overflow:hidden',\r\n  'box-sizing:border-box',\r\n  'padding:0',\r\n  'background: rgba(0,0,0,0.03)'\r\n].join(';') + ';';\r\n\r\nlet buttonsHtml =\r\n  '<div style=\"' + wrapperStyle + '\">'\r\n+ '  <div style=\"' + trackStyle + '\">'\r\n+ '    <button id=\"locations-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('locations') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'locations\\')\"><span>Locations</span></button>'\r\n+ '    <button id=\"warehouses-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('warehouses') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'warehouses\\')\"><span>Warehouses</span></button>'\r\n+ '  </div>'\r\n+ '</div>';\r\n\r\nlet stateHtml = '';\r\nif (mode === 'locations') {\r\n  stateHtml =\r\n    '<tb-dashboard-state class=\"w-full\" style=\"margin:0; padding:0\" [ctx]=\"ctx\" ' +\r\n    '[syncParentStateParams]=\"true\" stateId=\"Locations Card\"></tb-dashboard-state>';\r\n} else if (mode === 'warehouses') {\r\n  stateHtml =\r\n    '<tb-dashboard-state class=\"w-full\" style=\"margin:0; padding:0\" [ctx]=\"ctx\" ' +\r\n    '[syncParentStateParams]=\"true\" stateId=\"Warehouses Card\"></tb-dashboard-state>';\r\n}\r\n\r\nreturn ''\r\n+ '<div class=\"main-layout w-full h-full flex flex-col\" style=\"margin:0; padding:0;\">'\r\n+   buttonsHtml\r\n+   '<div class=\"flex-1 w-full overflow-hidden\" style=\"margin:0; padding:0;\">'\r\n+     stateHtml\r\n+   '</div>'\r\n+ '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ""
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "locations-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"locations\";\nlet params = widgetContext.stateController.getStateParams();\nparams['locationsMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6cccc8\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"locationsMode\";\nparams['selectedDevice'] = null;\nparams['selectedLocation'] = null;\nparams['selectedArea'] = null;\nparams['locMode'] = null;\nparams['tabMode'] = null;\nparams['deviceMode'] = null;\nparams['datapoints'] = null;\nparams['mainDatapoint'] = null;\nparams['gatewaysMode'] = null;\nparams['alarmsMode'] = null;\n//params['locationMode'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0f8b27e5-6bda-e394-1212-14352bbb4a0f"
              },
              {
                "name": "warehouses-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"warehouses\";\nlet params = widgetContext.stateController.getStateParams();\nparams['locationsMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6cccc9\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"locationMode\";\nparams['selectedDevice'] = null;\nparams['selectedLocation'] = null;\nparams['selectedArea'] = null;\nparams['locMode'] = null;\nparams['tabMode'] = null;\nparams['deviceMode'] = null;\nparams['datapoints'] = null;\nparams['mainDatapoint'] = null;\nparams['gatewaysMode'] = null;\nparams['alarmsMode'] = null;\n//params['locationMode'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d7019ee7-f0e4-8036-ec85-203e581da625"
              }
            ]
          },
          "enableDataExport": false,
          "borderRadius": "20px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "507dbe87-a5d9-1deb-b009-743fabb573dc"
      },
      "4c4c16bd-b345-80ec-2c6e-f64abf64c611": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "33721d14-df94-e23d-f1b0-a13735f4b9cb",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8127492370282982
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.34111965517376475
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#E0E0E0",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var params = ctx.stateController.getStateParams();\r\nvar customer = params.selectedCustomer.entityName;\r\n\r\nconst headerHtml =\r\n  '<div class=\"header\">' +\r\n    '<div class=\"header-left\">' +\r\n      '<button id=\"back-button\" class=\"header-btn gray-btn round-btn\" type=\"button\" matTooltip=\"Back\">' +\r\n        '<mat-icon class=\"tb-mat-18\">arrow_back</mat-icon>' +\r\n      '</button>' +\r\n      '<div class=\"title\">' + customer + '  Locations</div>' +\r\n    '</div>' +\r\n    '<div class=\"header-right\">' +\r\n      '<button id=\"add-location-button\" type=\"button\" class=\"header-btn primary-btn\" matTooltip=\"Add Location\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">add</mat-icon>' + '<span>Add Location</span>' +\r\n      '</button>' +\r\n      '<button id=\"add-warehouse-button\" type=\"button\" class=\"header-btn accent-btn\" matTooltip=\"Add Warehouse\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">add</mat-icon>' + '<span>Add Warehouse</span>' +\r\n      '</button>' +\r\n    '</div>' +\r\n  '</div>';\r\n\r\n\r\nvar layoutHtml =\r\n  '<div class=\"main-layout flex flex-col w-full h-full\">' +\r\n    headerHtml +\r\n    '<tb-dashboard-state ' +\r\n      'class=\"flex-1\" ' +\r\n      '[ctx]=\"ctx\" ' +\r\n      '[syncParentStateParams]=\"true\" ' +\r\n      'stateId=\"Locations Widgets\">' +\r\n    '</tb-dashboard-state>' +\r\n  '</div>';\r\n\r\nreturn layoutHtml;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* ===============================\r\n   Buttons (unchanged)\r\n=================================*/\r\n.header-btn {\r\n  padding: 0 18px;\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;\r\n  cursor: pointer;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;\r\n}\r\n.blue-btn { background-color: var(--tb-primary-500); }\r\n.green-btn { background-color: var(--tb-accent-500); }\r\n.green-btn:hover { background-color: var(--tb-accent-600); }\r\n.purple-btn { background-color: #8E24AA; }\r\n.purple-btn:hover { background-color: #7B1FA2; }\r\n.header-btn mat-icon { font-size: 18px; color: #fff; }\r\n\r\n/* ===============================\r\n   Layout\r\n=================================*/\r\n.main-layout {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n/* ===============================\r\n   HEADER (20px radius that actually shows)\r\n   - clip children to radius\r\n   - left inset\r\n   - tight gap to dashboard\r\n=================================*/\r\n.main-layout .header {\r\n  height: 75px;\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  background: #fff;\r\n  padding: 0 16px 0 10px !important;  /*  reduce left inset from 24px to 10px */\r\n  margin-bottom: 10px !important;\r\n\r\n  border-radius: 20px !important;\r\n  overflow: hidden;\r\n  justify-content: space-between; /* keep title/buttons layout intact */\r\n}\r\n\r\n\r\n/* Remove flex-gap margins so padding controls left edge precisely */\r\n.main-layout .header > * {\r\n  margin-left: 0 !important;\r\n  margin-right: 0 !important;\r\n}\r\n\r\n/* Some builds wrap inner row; reset any spacing/background there too */\r\n.main-layout .header > [fxlayout],\r\n.main-layout .header > [fxlayout] > * {\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  background: transparent !important;   /* ensure no inner block paints square corners */\r\n}\r\n\r\n/* Title styling */\r\n.main-layout .header .title {\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n  color: #28232D;\r\n  font-family: 'Roboto', sans-serif;\r\n  letter-spacing: 0.5px;\r\n  margin-left: 0 !important;\r\n}\r\n\r\n/* Optional logo rule */\r\n.main-layout .header .logo {\r\n  max-height: 60px;\r\n  width: auto;\r\n  margin-right: 12px;\r\n}\r\n\r\n/* ===============================\r\n   DASHBOARD STATE\r\n   - keep 20px radius\r\n   - remove top spacing\r\n=================================*/\r\n.main-layout tb-dashboard-state {\r\n  display: block;\r\n  background: #fff;\r\n  border-radius: 20px;\r\n  overflow: hidden;\r\n  box-shadow: none;\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n/* If the first child inside the state adds spacing, remove it */\r\n.main-layout tb-dashboard-state > *:first-child {\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n.header-btn {\r\n  padding: 0 18px;                  /*  horizontal breathing room */\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;            /* full pill shape */\r\n  cursor: pointer;\r\n  display: inline-flex;             /* inline sizing */\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;                         /* spacing between icon & text */\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;              /* prevent wrapping */\r\n}\r\n\r\n/* make the header actually behave like the fxLayout you intended */\r\n.main-layout .header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between; /* < important */\r\n}\r\n\r\n/* ensure the button has a visible background even if the CSS var is missing */\r\n.primary-btn {\r\n  background-color: var(--tb-primary-500, #0084D6); /* fallback color */\r\n}\r\n\r\n.accent-btn {\r\n  background-color: var(--tb-accent-500, #0084D6); /* fallback color */\r\n}\r\n\r\n.gray-btn {\r\n  background-color: #D0D0D0; /* fallback color */\r\n}\r\n\r\n\r\n/* Purple variant */\r\n.purple-btn {\r\n  background-color: #8E24AA; /* base purple */\r\n}\r\n\r\n/* optional: make sure the right side lays out correctly even without fxLayout */\r\n.header-right {\r\n  display: inline-flex;\r\n  align-items: center;\r\n}\r\n\r\n/* Make header-left elements align tightly side-by-side */\r\n.header-left {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 10px; /* spacing between back button and title */\r\n}\r\n\r\n/* Round back button */\r\n.round-btn {\r\n  width: 40px;               /* same height/width for perfect circle */\r\n  height: 40px;\r\n  padding: 0;\r\n  border-radius: 50%;\r\n  min-width: 40px;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Ensure icon is same size as others */\r\n.round-btn mat-icon {\r\n  font-size: 18px;           /* same as others */\r\n  color: #fff;\r\n}\r\n\r\n\r\n\r\n\r\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "change-customer",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeCustomer(widgetContext);\r\n/*// 1) Injector & Services\r\nconst ctx              = widgetContext;\r\nconst injector         = ctx.$scope.$injector;\r\nconst customDialog     = injector.get(ctx.servicesMap.get('customDialog'));\r\nconst customerService  = injector.get(ctx.servicesMap.get('customerService'));\r\nconst tenantService    = injector.get(ctx.servicesMap.get('tenantService')); // NEW\r\nconst currentUser      = ctx.currentUser; // NEW\r\n\r\n// Determine the owner entity of the currently logged-in user (TENANT or CUSTOMER)\r\nconst ownerRef = (currentUser && currentUser.authority === 'TENANT_ADMIN')\r\n  ? { entityType: 'TENANT',   id: currentUser.tenantId }\r\n  : { entityType: 'CUSTOMER', id: currentUser.customerId };\r\n\r\n// 2) Storage for loaded customers\r\nlet customers = [];\r\n\r\n// 3) Load all customers, map & sort, then also fetch and prepend the Owner option\r\nconst pageLink = ctx.pageLink(1000, 0, null, null, null);\r\ncustomerService.getUserCustomers(pageLink).subscribe(pageData => {\r\n  customers = (pageData.data || [])\r\n    .map(c => ({\r\n      entityId:    c.id,      // c.id is typically { id: string, entityType: 'CUSTOMER' }\r\n      entityName:  c.name,    // for display\r\n      entityLabel: c.title    // optional label\r\n    }))\r\n    .sort((a, b) => (a.entityName || '').localeCompare(b.entityName || ''));\r\n\r\n  // After customers are in place, fetch the actual owner's display name and prepend as an option\r\n  addOwnerOptionAndOpen();\r\n}, err => {\r\n  // Even if fetching customers fails, try to show dialog with just Owner option\r\n  console.error('Failed to fetch customers', err);\r\n  customers = [];\r\n  addOwnerOptionAndOpen();\r\n});\r\n\r\n// Helper: fetch owner (tenant/customer) display info and prepend to list, then open dialog\r\nfunction addOwnerOptionAndOpen() {\r\n  if (!ownerRef || !ownerRef.id) {\r\n    // No owner info; just open with whatever we have\r\n    openChangeCustomerDialog();\r\n    return;\r\n  }\r\n\r\n  if (ownerRef.entityType === 'TENANT') {\r\n    // Fetch tenant name/title\r\n    tenantService.getTenant(ownerRef.id).subscribe(tenant => {\r\n      const ownerOption = {\r\n        entityId:    { id: tenant.id.id, entityType: 'TENANT' },\r\n        entityName:  tenant.title || 'Tenant',\r\n        entityLabel: tenant.title || 'Tenant'\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch tenant owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  } else {\r\n    // Fetch customer name/title\r\n    customerService.getCustomer(ownerRef.id).subscribe(cust => {\r\n      const ownerOption = {\r\n        entityId:    { id: cust.id.id, entityType: 'CUSTOMER' },\r\n        entityName:  (cust.title || cust.name || 'Customer'),\r\n        entityLabel: (cust.title || cust.name || 'Customer')\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch customer owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  }\r\n}\r\n\r\n// 4) Open dialog once customers (and owner) are ready\r\nfunction openChangeCustomerDialog() {\r\n  customDialog\r\n    .customDialog(htmlTemplate, ChangeCustomerController)\r\n    .subscribe();\r\n}\r\n\r\n// 5) Dialog controller\r\nfunction ChangeCustomerController(instance) {\r\n  const vm = instance;\r\n\r\n  // No prefill from state  start empty\r\n  vm.customers         = customers;\r\n  vm.filteredCustomers = vm.customers.slice();\r\n  vm.isLoading$        = ctx.rxjs.of(false);\r\n\r\n  // Empty form (no preselected value, empty input)\r\n  vm.form = vm.fb.group({\r\n    selected:      [ null ],\r\n    customerInput: [ '' ]\r\n  });\r\n\r\n  // Render name in input/options\r\n  vm.displayCustomer = (c) => c ? (c.entityLabel || c.entityName || '') : '';\r\n\r\n  // Filter logic for type-ahead\r\n  function applyCustomerFilter() {\r\n    const raw  = vm.form.get('customerInput').value;\r\n    const term = (typeof raw === 'string' ? raw : vm.displayCustomer(raw))\r\n      .toString()\r\n      .toLowerCase()\r\n      .trim();\r\n\r\n    vm.filteredCustomers = !term\r\n      ? vm.customers.slice()\r\n      : vm.customers.filter(c => (\r\n          (c.entityName  || '').toLowerCase().includes(term) ||\r\n          (c.entityLabel || '').toLowerCase().includes(term)\r\n        ));\r\n  }\r\n\r\n  // When typing, clear selection and filter list\r\n  vm.form.get('customerInput').valueChanges.subscribe(val => {\r\n    if (typeof val === 'string') {\r\n      vm.form.patchValue({ selected: null }, { emitEvent: false });\r\n    }\r\n    applyCustomerFilter();\r\n  });\r\n\r\n  // When a customer is picked from autocomplete, sync both controls\r\n  vm.onCustomerSelected = function(sel) {\r\n    vm.form.patchValue({\r\n      selected:      sel,\r\n      customerInput: sel\r\n    });\r\n  };\r\n\r\n  vm.cancel = () => vm.dialogRef.close(null);\r\n\r\n  vm.ok = () => {\r\n    const sel = vm.form.value.selected;\r\n    if (sel) {\r\n      const stateParams = ctx.stateController.getStateParams() || {};\r\n      stateParams.selectedCustomer = {\r\n        entityId:    sel.entityId,\r\n        entityName:  sel.entityName,\r\n        entityLabel: sel.entityLabel\r\n      };\r\n      stateParams.targetEntityParamName = 'selectedCustomer';\r\n      ctx.stateController.updateState(null, stateParams);\r\n      ctx.updateAliases();\r\n    }\r\n    vm.dialogRef.close(null);\r\n  };\r\n}\r\n\r\n// 6) HTML template (searchable customer/owner with mat-autocomplete; no prefill)\r\nconst htmlTemplate = '\\\r\n<form #changeForm=\"ngForm\" [formGroup]=\"form\"\\\r\n      (ngSubmit)=\"ok()\"\\\r\n      class=\"add-entity-form max-w-3xl mx-auto\" style=\"width:600px;\">\\\r\n\\\r\n  <mat-toolbar color=\"primary\" class=\"flex items-center bg-primary text-white px-4\">\\\r\n    <h2 class=\"text-lg font-semibold\">Change Customer / Owner</h2>\\\r\n    <span class=\"flex-1\"></span>\\\r\n    <button mat-icon-button type=\"button\" (click)=\"cancel()\">\\\r\n      <mat-icon>close</mat-icon>\\\r\n    </button>\\\r\n  </mat-toolbar>\\\r\n\\\r\n  <mat-progress-bar *ngIf=\"isLoading$ | async\"\\\r\n                    mode=\"indeterminate\" color=\"warn\">\\\r\n  </mat-progress-bar>\\\r\n  <div style=\"height:4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\\\r\n\\\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\\\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\\r\n      <mat-label>Select Customer or Owner</mat-label>\\\r\n\\\r\n      <input type=\"text\"\\\r\n             matInput\\\r\n             placeholder=\"Type to search customers or owner\"\\\r\n             [matAutocomplete]=\"custAuto\"\\\r\n             formControlName=\"customerInput\">\\\r\n\\\r\n      <mat-autocomplete\\\r\n        #custAuto=\"matAutocomplete\"\\\r\n        [displayWith]=\"displayCustomer\"\\\r\n        (optionSelected)=\"onCustomerSelected($event.option.value)\">\\\r\n\\\r\n        <mat-option *ngFor=\"let c of filteredCustomers\" [value]=\"c\">\\\r\n          {{ c.entityName }}\\\r\n        </mat-option>\\\r\n      </mat-autocomplete> \\\r\n    </mat-form-field> \\\r\n  </div> \\\r\n\\\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2\">\\\r\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"\\\r\n            [disabled]=\"(isLoading$ | async)\">\\\r\n      Cancel\\\r\n    </button>\\\r\n    <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\\r\n            [disabled]=\"(isLoading$ | async) || !form.value.selected\">\\\r\n      OK\\\r\n    </button>\\\r\n  </div>\\\r\n</form>';\r\n*/",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fd0d775f-d04e-1c4c-b592-da2b6d5f5be3"
              },
              {
                "name": "user-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "user_management_all",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e41e5cf8-f901-bdad-77d0-6b9feb7d22e3"
              },
              {
                "name": "customer-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "retail_companies",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2529050e-4b2f-53b4-2568-5782da1d9434"
              },
              {
                "name": "mobile-qr",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "mobile_app",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "25vw",
                "popoverHeight": "25vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2122aec7-4926-fef5-74e0-faa8f42a6fac"
              },
              {
                "name": "add-location-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addLocation(widgetContext,entityId,entityName,entityLabel,\"Locations\");\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1f52b78f-068e-8392-adfe-9a37706f2c7c"
              },
              {
                "name": "add-warehouse-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addLocation(widgetContext,entityId,entityName,entityLabel,\"Locations\");\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4d554ea2-fcaa-849a-fb14-07f61e6f7217"
              },
              {
                "name": "back-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "//var params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\n//widgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);\n\n\n\n//params['targetEntityParamName'] = \"homeWidgetMode\";\n//params['selectedDevice'] = null;\n//params['selectedLocation'] = null;\n//params['tabMode'] = null;\n//params['deviceMode'] = null;\n//params['datapoints'] = null;\n//params['mainDatapoint'] = null;\n//params['gatewaysMode'] = null;\n//params['alarmsMode'] = null;\n//params['locationMode'] = null;",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "ed63b836-f192-271a-5c6e-6f8ac63e8b85"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "4c4c16bd-b345-80ec-2c6e-f64abf64c611"
      },
      "4ef0f252-9c28-33d4-7f08-5ccc56be1b80": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "33721d14-df94-e23d-f1b0-a13735f4b9cb",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8127492370282982
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.34111965517376475
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#E0E0E0",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var params = ctx.stateController.getStateParams();\r\nvar customer = params.selectedCustomer.entityName;\r\nvar name = data[0]['Name'] || 'unknown';\r\n\r\nconst headerHtml =\r\n  '<div class=\"header\">' +\r\n    '<div class=\"header-left\">' +\r\n       '<button id=\"back-button\" class=\"header-btn gray-btn round-btn\" type=\"button\" matTooltip=\"Back\">' +\r\n        '<mat-icon class=\"tb-mat-18\">arrow_back</mat-icon>' +\r\n      '</button>' +\r\n      '<div class=\"title\">' + customer + '  ' + name + '  Devices' + '</div>' +\r\n    '</div>' +\r\n    '<div class=\"header-right\">' +\r\n      '<button id=\"add-device-button\" type=\"button\" class=\"header-btn primary-btn\" matTooltip=\"Add Device\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">add</mat-icon>' + '<span>Add Device</span>' +\r\n      '</button>' +\r\n      '<button id=\"import-devices-button\" type=\"button\" class=\"header-btn accent-btn\" matTooltip=\"Import Devices\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">sim_card_download</mat-icon>' + '<span>Import Devices</span>' +\r\n      '</button>' +\r\n      '<button id=\"all-devices-button\" type=\"button\" class=\"header-btn purple-btn\" matTooltip=\"All Devices\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">devices</mat-icon>' + '<span>All Devices</span>' +\r\n      '</button>' +\r\n    '</div>' +\r\n  '</div>';\r\n\r\n\r\n\r\nvar layoutHtml =\r\n  '<div class=\"main-layout flex flex-col w-full h-full\">' +\r\n    headerHtml +\r\n    '<tb-dashboard-state ' +\r\n      'class=\"flex-1\" ' +\r\n      '[ctx]=\"ctx\" ' +\r\n      '[syncParentStateParams]=\"true\" ' +\r\n      'stateId=\"Devices Widgets\">' +\r\n    '</tb-dashboard-state>' +\r\n  '</div>';\r\n\r\nreturn layoutHtml;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* ===============================\r\n   Buttons (unchanged)\r\n=================================*/\r\n.header-btn {\r\n  padding: 0 18px;\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;\r\n  cursor: pointer;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;\r\n}\r\n.blue-btn { background-color: var(--tb-primary-500); }\r\n.green-btn { background-color: var(--tb-accent-500); }\r\n.green-btn:hover { background-color: var(--tb-accent-600); }\r\n.purple-btn { background-color: #8E24AA; }\r\n.purple-btn:hover { background-color: #7B1FA2; }\r\n.header-btn mat-icon { font-size: 18px; color: #fff; }\r\n\r\n/* ===============================\r\n   Layout\r\n=================================*/\r\n.main-layout {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n/* ===============================\r\n   HEADER (20px radius that actually shows)\r\n   - clip children to radius\r\n   - left inset\r\n   - tight gap to dashboard\r\n=================================*/\r\n.main-layout .header {\r\n  height: 75px;\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  background: #fff;\r\n  padding: 0 16px 0 10px !important;  /*  reduce left inset from 24px to 10px */\r\n  margin-bottom: 10px !important;\r\n\r\n  border-radius: 20px !important;\r\n  overflow: hidden;\r\n  justify-content: space-between; /* keep title/buttons layout intact */\r\n}\r\n\r\n\r\n/* Remove flex-gap margins so padding controls left edge precisely */\r\n.main-layout .header > * {\r\n  margin-left: 0 !important;\r\n  margin-right: 0 !important;\r\n}\r\n\r\n/* Some builds wrap inner row; reset any spacing/background there too */\r\n.main-layout .header > [fxlayout],\r\n.main-layout .header > [fxlayout] > * {\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  background: transparent !important;   /* ensure no inner block paints square corners */\r\n}\r\n\r\n/* Title styling */\r\n.main-layout .header .title {\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n  color: #28232D;\r\n  font-family: 'Roboto', sans-serif;\r\n  letter-spacing: 0.5px;\r\n  margin-left: 0 !important;\r\n}\r\n\r\n/* Optional logo rule */\r\n.main-layout .header .logo {\r\n  max-height: 60px;\r\n  width: auto;\r\n  margin-right: 12px;\r\n}\r\n\r\n/* ===============================\r\n   DASHBOARD STATE\r\n   - keep 20px radius\r\n   - remove top spacing\r\n=================================*/\r\n.main-layout tb-dashboard-state {\r\n  display: block;\r\n  background: #fff;\r\n  border-radius: 20px;\r\n  overflow: hidden;\r\n  box-shadow: none;\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n/* If the first child inside the state adds spacing, remove it */\r\n.main-layout tb-dashboard-state > *:first-child {\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n.header-btn {\r\n  padding: 0 18px;                  /*  horizontal breathing room */\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;            /* full pill shape */\r\n  cursor: pointer;\r\n  display: inline-flex;             /* inline sizing */\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;                         /* spacing between icon & text */\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;              /* prevent wrapping */\r\n}\r\n\r\n/* make the header actually behave like the fxLayout you intended */\r\n.main-layout .header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between; /* < important */\r\n}\r\n\r\n/* ensure the button has a visible background even if the CSS var is missing */\r\n.primary-btn {\r\n  background-color: var(--tb-primary-500, #0084D6); /* fallback color */\r\n}\r\n\r\n.accent-btn {\r\n  background-color: var(--tb-accent-500, #0084D6); /* fallback color */\r\n}\r\n\r\n.gray-btn {\r\n  background-color: #D0D0D0; /* fallback color */\r\n}\r\n\r\n\r\n/* Purple variant */\r\n.purple-btn {\r\n  background-color: #8E24AA; /* base purple */\r\n}\r\n\r\n/* optional: make sure the right side lays out correctly even without fxLayout */\r\n.header-right {\r\n  display: inline-flex;\r\n  align-items: center;\r\n}\r\n\r\n/* Make header-left elements align tightly side-by-side */\r\n.header-left {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 10px; /* spacing between back button and title */\r\n}\r\n\r\n/* Round back button */\r\n.round-btn {\r\n  width: 40px;               /* same height/width for perfect circle */\r\n  height: 40px;\r\n  padding: 0;\r\n  border-radius: 50%;\r\n  min-width: 40px;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Ensure icon is same size as others */\r\n.round-btn mat-icon {\r\n  font-size: 18px;           /* same as others */\r\n  color: #fff;\r\n}\r\n\r\n\r\n\r\n\r\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "change-customer",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeCustomer(widgetContext);\r\n/*// 1) Injector & Services\r\nconst ctx              = widgetContext;\r\nconst injector         = ctx.$scope.$injector;\r\nconst customDialog     = injector.get(ctx.servicesMap.get('customDialog'));\r\nconst customerService  = injector.get(ctx.servicesMap.get('customerService'));\r\nconst tenantService    = injector.get(ctx.servicesMap.get('tenantService')); // NEW\r\nconst currentUser      = ctx.currentUser; // NEW\r\n\r\n// Determine the owner entity of the currently logged-in user (TENANT or CUSTOMER)\r\nconst ownerRef = (currentUser && currentUser.authority === 'TENANT_ADMIN')\r\n  ? { entityType: 'TENANT',   id: currentUser.tenantId }\r\n  : { entityType: 'CUSTOMER', id: currentUser.customerId };\r\n\r\n// 2) Storage for loaded customers\r\nlet customers = [];\r\n\r\n// 3) Load all customers, map & sort, then also fetch and prepend the Owner option\r\nconst pageLink = ctx.pageLink(1000, 0, null, null, null);\r\ncustomerService.getUserCustomers(pageLink).subscribe(pageData => {\r\n  customers = (pageData.data || [])\r\n    .map(c => ({\r\n      entityId:    c.id,      // c.id is typically { id: string, entityType: 'CUSTOMER' }\r\n      entityName:  c.name,    // for display\r\n      entityLabel: c.title    // optional label\r\n    }))\r\n    .sort((a, b) => (a.entityName || '').localeCompare(b.entityName || ''));\r\n\r\n  // After customers are in place, fetch the actual owner's display name and prepend as an option\r\n  addOwnerOptionAndOpen();\r\n}, err => {\r\n  // Even if fetching customers fails, try to show dialog with just Owner option\r\n  console.error('Failed to fetch customers', err);\r\n  customers = [];\r\n  addOwnerOptionAndOpen();\r\n});\r\n\r\n// Helper: fetch owner (tenant/customer) display info and prepend to list, then open dialog\r\nfunction addOwnerOptionAndOpen() {\r\n  if (!ownerRef || !ownerRef.id) {\r\n    // No owner info; just open with whatever we have\r\n    openChangeCustomerDialog();\r\n    return;\r\n  }\r\n\r\n  if (ownerRef.entityType === 'TENANT') {\r\n    // Fetch tenant name/title\r\n    tenantService.getTenant(ownerRef.id).subscribe(tenant => {\r\n      const ownerOption = {\r\n        entityId:    { id: tenant.id.id, entityType: 'TENANT' },\r\n        entityName:  tenant.title || 'Tenant',\r\n        entityLabel: tenant.title || 'Tenant'\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch tenant owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  } else {\r\n    // Fetch customer name/title\r\n    customerService.getCustomer(ownerRef.id).subscribe(cust => {\r\n      const ownerOption = {\r\n        entityId:    { id: cust.id.id, entityType: 'CUSTOMER' },\r\n        entityName:  (cust.title || cust.name || 'Customer'),\r\n        entityLabel: (cust.title || cust.name || 'Customer')\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch customer owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  }\r\n}\r\n\r\n// 4) Open dialog once customers (and owner) are ready\r\nfunction openChangeCustomerDialog() {\r\n  customDialog\r\n    .customDialog(htmlTemplate, ChangeCustomerController)\r\n    .subscribe();\r\n}\r\n\r\n// 5) Dialog controller\r\nfunction ChangeCustomerController(instance) {\r\n  const vm = instance;\r\n\r\n  // No prefill from state  start empty\r\n  vm.customers         = customers;\r\n  vm.filteredCustomers = vm.customers.slice();\r\n  vm.isLoading$        = ctx.rxjs.of(false);\r\n\r\n  // Empty form (no preselected value, empty input)\r\n  vm.form = vm.fb.group({\r\n    selected:      [ null ],\r\n    customerInput: [ '' ]\r\n  });\r\n\r\n  // Render name in input/options\r\n  vm.displayCustomer = (c) => c ? (c.entityLabel || c.entityName || '') : '';\r\n\r\n  // Filter logic for type-ahead\r\n  function applyCustomerFilter() {\r\n    const raw  = vm.form.get('customerInput').value;\r\n    const term = (typeof raw === 'string' ? raw : vm.displayCustomer(raw))\r\n      .toString()\r\n      .toLowerCase()\r\n      .trim();\r\n\r\n    vm.filteredCustomers = !term\r\n      ? vm.customers.slice()\r\n      : vm.customers.filter(c => (\r\n          (c.entityName  || '').toLowerCase().includes(term) ||\r\n          (c.entityLabel || '').toLowerCase().includes(term)\r\n        ));\r\n  }\r\n\r\n  // When typing, clear selection and filter list\r\n  vm.form.get('customerInput').valueChanges.subscribe(val => {\r\n    if (typeof val === 'string') {\r\n      vm.form.patchValue({ selected: null }, { emitEvent: false });\r\n    }\r\n    applyCustomerFilter();\r\n  });\r\n\r\n  // When a customer is picked from autocomplete, sync both controls\r\n  vm.onCustomerSelected = function(sel) {\r\n    vm.form.patchValue({\r\n      selected:      sel,\r\n      customerInput: sel\r\n    });\r\n  };\r\n\r\n  vm.cancel = () => vm.dialogRef.close(null);\r\n\r\n  vm.ok = () => {\r\n    const sel = vm.form.value.selected;\r\n    if (sel) {\r\n      const stateParams = ctx.stateController.getStateParams() || {};\r\n      stateParams.selectedCustomer = {\r\n        entityId:    sel.entityId,\r\n        entityName:  sel.entityName,\r\n        entityLabel: sel.entityLabel\r\n      };\r\n      stateParams.targetEntityParamName = 'selectedCustomer';\r\n      ctx.stateController.updateState(null, stateParams);\r\n      ctx.updateAliases();\r\n    }\r\n    vm.dialogRef.close(null);\r\n  };\r\n}\r\n\r\n// 6) HTML template (searchable customer/owner with mat-autocomplete; no prefill)\r\nconst htmlTemplate = '\\\r\n<form #changeForm=\"ngForm\" [formGroup]=\"form\"\\\r\n      (ngSubmit)=\"ok()\"\\\r\n      class=\"add-entity-form max-w-3xl mx-auto\" style=\"width:600px;\">\\\r\n\\\r\n  <mat-toolbar color=\"primary\" class=\"flex items-center bg-primary text-white px-4\">\\\r\n    <h2 class=\"text-lg font-semibold\">Change Customer / Owner</h2>\\\r\n    <span class=\"flex-1\"></span>\\\r\n    <button mat-icon-button type=\"button\" (click)=\"cancel()\">\\\r\n      <mat-icon>close</mat-icon>\\\r\n    </button>\\\r\n  </mat-toolbar>\\\r\n\\\r\n  <mat-progress-bar *ngIf=\"isLoading$ | async\"\\\r\n                    mode=\"indeterminate\" color=\"warn\">\\\r\n  </mat-progress-bar>\\\r\n  <div style=\"height:4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\\\r\n\\\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\\\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\\r\n      <mat-label>Select Customer or Owner</mat-label>\\\r\n\\\r\n      <input type=\"text\"\\\r\n             matInput\\\r\n             placeholder=\"Type to search customers or owner\"\\\r\n             [matAutocomplete]=\"custAuto\"\\\r\n             formControlName=\"customerInput\">\\\r\n\\\r\n      <mat-autocomplete\\\r\n        #custAuto=\"matAutocomplete\"\\\r\n        [displayWith]=\"displayCustomer\"\\\r\n        (optionSelected)=\"onCustomerSelected($event.option.value)\">\\\r\n\\\r\n        <mat-option *ngFor=\"let c of filteredCustomers\" [value]=\"c\">\\\r\n          {{ c.entityName }}\\\r\n        </mat-option>\\\r\n      </mat-autocomplete> \\\r\n    </mat-form-field> \\\r\n  </div> \\\r\n\\\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2\">\\\r\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"\\\r\n            [disabled]=\"(isLoading$ | async)\">\\\r\n      Cancel\\\r\n    </button>\\\r\n    <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\\r\n            [disabled]=\"(isLoading$ | async) || !form.value.selected\">\\\r\n      OK\\\r\n    </button>\\\r\n  </div>\\\r\n</form>';\r\n*/",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fd0d775f-d04e-1c4c-b592-da2b6d5f5be3"
              },
              {
                "name": "user-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "user_management_all",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e41e5cf8-f901-bdad-77d0-6b9feb7d22e3"
              },
              {
                "name": "customer-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "retail_companies",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2529050e-4b2f-53b4-2568-5782da1d9434"
              },
              {
                "name": "mobile-qr",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "mobile_app",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "25vw",
                "popoverHeight": "25vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2122aec7-4926-fef5-74e0-faa8f42a6fac"
              },
              {
                "name": "all-devices-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openURL",
                "openNewBrowserTab": true,
                "url": "https://cloud.pke-iot.expert/entities/devices/all",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4a37e797-523b-cfe5-634d-abd84a5f5d27"
              },
              {
                "name": "add-device-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "let desiredMode = \"Both\"\nutils.addDevice(widgetContext,entityId,entityName,entityLabel,desiredMode);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/aleks device management.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d03b0a4c-f8ca-4365-d791-c7f7c1bf8751"
              },
              {
                "name": "import-devices-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.importDevices(widgetContext);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Import Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "93939acc-5c20-003a-137e-d804fb77a479"
              },
              {
                "name": "back-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "//var params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\n//widgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);\n\n\n\n//params['targetEntityParamName'] = \"homeWidgetMode\";\n//params['selectedDevice'] = null;\n//params['selectedLocation'] = null;\n//params['tabMode'] = null;\n//params['deviceMode'] = null;\n//params['datapoints'] = null;\n//params['mainDatapoint'] = null;\n//params['gatewaysMode'] = null;\n//params['alarmsMode'] = null;\n//params['locationMode'] = null;",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c5c34a18-1416-c9fd-12d3-f1d0e568ac16"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "4ef0f252-9c28-33d4-7f08-5ccc56be1b80"
      },
      "c26723ce-f68c-b0cf-d010-c3bfd5bd7b3f": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "isLoRaWANDevice",
                  "type": "attribute",
                  "label": "isLoRaWANDevice",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.5726202978649466
                },
                {
                  "name": "devEui",
                  "type": "attribute",
                  "label": "devEui",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.885610377905286
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1711475697339,
                "endTimeMs": 1711562097339
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var deviceState = data && data.length && data[0]['entityId'] ? true : false;\r\nvar lora = data && data.length && data[0]['devEui'] ? true : false;\r\n\r\nconst params = ctx.stateController.getStateParams() || {};\r\nlet mode;\r\nif (params.tabMode) {\r\n  mode = params.tabMode;\r\n} else {\r\n  mode = 'attributes';\r\n  params.tabMode = mode;\r\n  ctx.stateController.updateState(null, params);\r\n}\r\n\r\nvar vm = this;\r\nvm.mode = mode;\r\n\r\nvm.onInit = function () {};\r\n\r\nvm.updateMode = function (newMode) {\r\n  const p = vm.ctx.stateController.getStateParams() || {};\r\n  p.tabMode = newMode;\r\n  vm.mode = newMode; // reflect immediately\r\n  vm.ctx.stateController.updateState(null, p);\r\n};\r\n\r\nconst btnDefaultStyle = `\r\n  background: transparent;\r\n  color: var(--tb-primary-500);\r\n  border: 0;\r\n  border-radius: 9999px;\r\n  padding: 8px 16px;\r\n  line-height: 1;\r\n  margin: 0;\r\n  flex: 1 1 0;\r\n  text-align: center;\r\n`;\r\n\r\nconst btnActiveStyle = `\r\n  background: var(--tb-primary-500);\r\n  color: #FFF;\r\n  border: 0;\r\n  border-radius: 9999px;\r\n  padding: 8px 16px;\r\n  line-height: 1;\r\n  margin: 0;\r\n  flex: 1 1 0;\r\n  text-align: center;\r\n`;\r\n\r\nfunction btnStyleFor(entity) {\r\n  return mode === entity ? btnActiveStyle : btnDefaultStyle;\r\n}\r\n\r\nconst wrapperStyle = 'padding:0px 8px 0 8px; background:#fff;';\r\nconst trackStyle = [\r\n  'display:flex',\r\n  'align-items:center',\r\n  'width:100%',\r\n  'gap:8px',\r\n  'border-radius:9999px',\r\n  'overflow:hidden',\r\n  'box-sizing:border-box',\r\n  'padding:0',\r\n  'background: rgba(0,0,0,0.03)'\r\n].join(';') + ';';\r\n\r\nlet buttonsHtml =\r\n  '<div style=\"' + wrapperStyle + '\">'\r\n+ '  <div style=\"' + trackStyle + '\">'\r\n+ '    <button id=\"attributes-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('attributes') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'attributes\\')\"><span>Attributes</span></button>'\r\n+ '    <button id=\"config-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('config') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'config\\')\"><span>Configuration</span></button>'\r\n+ '    <button id=\"data-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('data') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'data\\')\"><span>Data</span></button>'\r\n+ '    <button id=\"alarms-button\" type=\"button\" mat-button'\r\n+ '      style=\"' + btnStyleFor('alarms') + '\"'\r\n+ '      ng-click=\"vm.updateMode(\\'alarms\\')\"><span>Alarms</span></button>'\r\n+ '  </div>'\r\n+ '</div>';\r\n\r\nlet stateAreaHtml = '';\r\nif (mode === 'attributes') {\r\n  stateAreaHtml =\r\n    '<tb-dashboard-state style=\"flex: 2; overflow: hidden;\" ' +\r\n    ' [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Device Attributes Tab\"></tb-dashboard-state>';\r\n} else if (mode === 'config') {\r\n  stateAreaHtml =\r\n    '<tb-dashboard-state style=\"flex: 2; overflow: hidden;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Device Configuration Tab\"></tb-dashboard-state>';\r\n} else if (mode === 'data') {\r\n  /*stateAreaHtml =\r\n    '<tb-dashboard-state style=\"flex: 2; overflow: hidden;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Device Data\"></tb-dashboard-state>';*/\r\n    stateAreaHtml =\r\n    '<tb-dashboard-state style=\"flex: 2; overflow: hidden;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Device Data Tab\"></tb-dashboard-state>';\r\n} else if (mode === 'alarms') {\r\n  stateAreaHtml =\r\n    '<tb-dashboard-state style=\"flex: 2; overflow: hidden;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Device Alarms Tab\"></tb-dashboard-state>';\r\n}\r\n\r\nvar htmlContent = ''\r\n+ '<div class=\"main-layout w-full h-full flex flex-col\" style=\"width:100%; height:100%; margin:0; padding:0;\">';\r\n\r\nif (deviceState) {\r\n  htmlContent +=\r\n    '<tb-dashboard-state style=\"height: 170px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Device Header\"></tb-dashboard-state>'\r\n  + buttonsHtml\r\n  + '<div class=\"flex-1 w-full overflow-hidden\" style=\"margin:0; padding:0;\">'\r\n  +   stateAreaHtml\r\n  + '</div>';\r\n} else {\r\n  htmlContent +=\r\n    '<tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"Location Alarms Card\"></tb-dashboard-state>';\r\n}\r\n\r\nhtmlContent += '</div>';\r\nreturn htmlContent;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".main-layout .header {\n    height: 60px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 8px;\n    margin-bottom: 0px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 0 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "attributes-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['tabMode'] = 'attributes'; \n/*console.log(params);*/\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "77766dfd-58db-3c96-2cfb-678fd679160b"
              },
              {
                "name": "config-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['tabMode'] = 'config'; \n/*console.log(params);*/\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "76752190-cf15-732a-1f5f-54255e039e14"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "(async function runCustomAction() {\n \n  // 1. Grab core services & context\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = entityId;                // provided by the action trigger\n  const MODE_NAME        = 'data';\n \n  try {\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext,deviceIdObj.id);\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n \n    const formattedDatapoints = \n      await utils.getLatestTimeseriesInfos(widgetContext,params.selectedDevice.entityId, datapointDefinitions);\n      \n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n \n    params.datapoints            = filteredDatapoints;\n    params.mainDatapoint         = mainDatapoint;\n    /*params.tabMode            = {\n      entityId: {\n        entityType: 'DEVICE',\n        id:         '6503e900-0c65-11ef-842a-1fe8cd665c77'\n      },\n      entityName:  MODE_NAME,\n      entityLabel: MODE_NAME\n    };\n    params.targetEntityParamName = 'tabMode';\n    */\n    params['tabMode'] = 'data'; \n\n    widgetContext.updateAliases();\n    stateController.updateState(null, params);\n    //console.log(\"dp\", params.datapoints);\n \n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n \n})();\n\n\n/*var params = widgetContext.stateController.getStateParams();\n\nparams['tabMode'] = 'data'; \nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState(null, params);*/",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "883e9037-ed16-b5d5-d94d-06479e5c194d"
              },
              {
                "name": "alarms-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['tabMode'] = 'alarms'; \n/*console.log(params);*/\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f33747fc-83fa-d671-0635-e3eaed3cac98"
              }
            ]
          },
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "c26723ce-f68c-b0cf-d010-c3bfd5bd7b3f"
      },
      "094be4c3-bfea-7cbd-b7a4-17c8f99b0b54": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709727301752,
                "endTimeMs": 1709813701752
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "Devices",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": false,
            "defaultPageSize": 15,
            "pageStepCount": 3,
            "pageStepIncrement": 15,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Entities table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "db00267a-cd38-fbf2-8799-ef280789c15b",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "{i18n:custom.devices-table.type}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "30%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "//console.log(entity);\r\n// pull in entity fields\r\nvar deviceType = entity.Type || '';\r\nvar state      = entity.State;\r\nvar active     = entity.active;\r\nvar service    = entity.Service;\r\n\r\n// override state when inactive or in service\r\nif (active === \"false\")  state = 'disconnected';\r\nif (service === \"true\")  state = 'service';\r\n\r\n// get icon + colors as before\r\nvar icon   = utils.getDeviceIcon(deviceType);\r\nvar color  = utils.getStatusColors(state).color;\r\nvar bgColor= utils.getStatusColors(state).bgColor;\r\n\r\n// create a generic pulse animation (no colors)\r\nvar pulseCSS = `\r\n@keyframes pulse-opacity {\r\n  0%   { opacity: 1; }\r\n  50%  { opacity: 0.5; }\r\n  100% { opacity: 1; }\r\n}\r\n.pulse {\r\n animation: pulse-opacity 1s cubic-bezier(.4,0,.6,1) infinite alternate;\r\n}\r\n`;\r\n\r\n// inject it\r\nconst cssParser = new cssjs();\r\ncssParser.testMode = false;\r\ncssParser.cssPreviewNamespace = 'typeIcon';\r\ncssParser.createStyleElement('typeIcon', pulseCSS, 'nonamespace');\r\n\r\n// decide whether to pulse\r\nvar pulseClass = (state === 'critical' || state === 'major' || state === 'minor')\r\n               ? ' pulse'\r\n               : '';\r\n\r\n// return the div, with pulse class if needed\r\nreturn '<div class=\"typeIcon' + pulseClass + '\"'\r\n     +  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;'\r\n     +      ' padding:4px 8px; border-radius:8px; line-height:20px;'\r\n     +      ' font-size:14px; font-weight:500; letter-spacing:0.25px;'\r\n     +      ' color:' + color + '; background-color:' + bgColor + ';\">'\r\n     +    '<span class=\"material-icons\"'\r\n     +         ' style=\"font-size:20px; vertical-align:middle;\">'\r\n     +         icon +\r\n       '</span>'\r\n     +    deviceType +\r\n       '</div>';\r\n",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.030226428292950303,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "{i18n:custom.devices-table.label}",
                  "color": "#607d8b",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "35%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var label = value;\r\nvar name  = entity.entityName;\r\n\r\nvar copyButton =\r\n  '<span ' +\r\n    'class=\"material-icons copy-btn\" ' +\r\n    'style=\"cursor:pointer; font-size:16px; vertical-align:middle; margin-left:4px;\" ' +\r\n    'title=\"Copy name\" ' +\r\n    'onclick=\"(function(btn){' +\r\n      'navigator.clipboard.writeText(\\'' + name.replace(/\\'/g, \"\\\\'\") + '\\');' +\r\n      'btn.textContent = \\'check\\';' +\r\n      'btn.style.color = \\'green\\';' +\r\n      'setTimeout(function(){ btn.textContent = \\'content_copy\\'; btn.style.color = \\'\\'; }, 5000);' +\r\n    '})(this)\">' +\r\n    'content_copy' +\r\n  '</span>';\r\n\r\nreturn (\r\n  label +\r\n  '<br>' +\r\n  '<b style=\"color: var(--tb-primary-500);\">' + name + '</b>' + copyButton\r\n);\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.7974416431319673,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "{i18n:custom.devices-table.name}",
                  "color": "#2196f3",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "10%",
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "var color;\r\nvar service = entity.service;\r\nif (service === \"true\"){\r\n    color = 'rgba(52, 152, 219, 0.2)'\r\n} else{\r\n    color = '#fffff'\r\n}\r\n\r\nreturn {\r\n  backgroundColor: color,\r\n  color:'rgb(0, 132, 214)',\r\n  fontWeight: 600\r\n}\r\n",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "disabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.8610127613292287,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:custom.state}",
                  "color": "#e91e63",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "var state = value;\r\n\r\nif (entity.Service === \"true\" || entity.service === \"true\") {\r\n    state = \"service\";\r\n} \r\n\r\nvar color = utils.getStatusColors(state).color;\r\nvar bgColor = utils.getStatusColors(state).bgColor;\r\nvar status = utils.getStatusColors(state).status;\r\n\r\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\r\n            status + '</div>';",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                      }
                    },
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.49592504846647745,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "{i18n:custom.devices-table.active}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.2774262550056772,
                  "units": null,
                  "decimals": 0,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "lastActivityTime",
                  "type": "attribute",
                  "label": "{i18n:custom.devices-table.last-activity}",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "25%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.lastActivityHtml(entity.active, value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.582323668338151,
                  "decimals": 0,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "units": null
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "{i18n:custom.devices-table.meterType}",
                  "color": "#9c27b0",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "10%",
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "return {\r\n  //color: 'rgb(0, 132, 214)',\r\n  fontWeight: 600,\r\n  textAlign: 'center'\r\n};\r\n",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.7022512558748519,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "meterId",
                  "type": "attribute",
                  "label": "{i18n:custom.devices-table.meterId}",
                  "color": "#8bc34a",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.06696925761646577,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "{i18n:custom.service}",
                  "color": "#ff9800",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.9472209160352536,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "devEui",
                  "type": "attribute",
                  "label": "{i18n:custom.devices-table.devEui}",
                  "color": "#03a9f4",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.12688347213580342,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "appKey",
                  "type": "attribute",
                  "label": "{i18n:custom.devices-table.appKey}",
                  "color": "#ff9800",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.43966760942325056,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "nonExistingDevices",
                  "type": "attribute",
                  "label": "nonExistingDevices",
                  "color": "#673ab7",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.3279280094360453,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#cddc39",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "disabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.6208596248793634,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "actionCellButton": [
              {
                "name": "Data Dashboard",
                "icon": "insert_chart_outlined",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "(async function runCustomAction() {\r\n  const injector         = widgetContext.$scope.$injector;\r\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\r\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\r\n  const stateController  = widgetContext.stateController;\r\n  const params           = stateController.getStateParams();\r\n  const deviceIdObj      = entityId; // provided by the action trigger\r\n\r\n  try {\r\n    // --- Part from your first snippet: get deviceProfileId and dashboard from ASSET attribute ---\r\n    const device = await new Promise((resolve, reject) => {\r\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\r\n    });\r\n\r\n    const deviceProfileId = device.deviceProfileId.id;\r\n    console.log('deviceProfileId', deviceProfileId);\r\n\r\n    const assetId = {\r\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3', // your hardcoded ASSET id\r\n      entityType: 'ASSET'\r\n    };\r\n\r\n    const attrs = await new Promise((resolve, reject) => {\r\n      attributeService\r\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\r\n        .subscribe(resolve, reject);\r\n    });\r\n\r\n    console.log('attrs', attrs);\r\n\r\n    let dashboard;\r\n    if (attrs && attrs.length && attrs[0].value) {\r\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\r\n      console.log('dashboard:', dashboard);\r\n    }\r\n\r\n    // --- Original logic from your second snippet ---\r\n    const { mainDatapoint, datapointDefinitions } =\r\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\r\n\r\n    await new Promise((resolve, reject) => {\r\n      attributeService\r\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\r\n          { key: 'selectedDatapoint', value: mainDatapoint }\r\n        ])\r\n        .subscribe(resolve, reject);\r\n    });\r\n\r\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\r\n      widgetContext,\r\n      params.selectedDevice?.entityId || deviceIdObj,\r\n      datapointDefinitions\r\n    );\r\n\r\n    const filteredDatapoints = Object.fromEntries(\r\n      Object.entries(formattedDatapoints).filter(\r\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\r\n      )\r\n    );\r\n\r\n    const selectedDevice = {\r\n      entityId: {\r\n        id: entityId.id,\r\n        entityType: entityId.entityType\r\n      },\r\n      entityName: entityName,\r\n      entityLabel: entityLabel\r\n    };\r\n\r\n    const newParams = {\r\n      ...params,\r\n      selectedDevice,\r\n      datapoints: filteredDatapoints,\r\n      mainDatapoint,\r\n      // from first snippet:\r\n      dashboard,\r\n      dataMode: {\r\n        entityId: {\r\n          entityType: 'DEVICE',\r\n          id: deviceIdObj.id\r\n        },\r\n        entityName: 'charts',\r\n        entityLabel: 'charts',\r\n        dashboard: dashboard\r\n      },\r\n      targetEntityParamName: 'dataMode'\r\n    };\r\n\r\n    // you can keep using openState, now with the extra params (dashboard, dataMode, etc.)\r\n    stateController.openState('Device Data Dashboard', newParams);\r\n\r\n    console.log('Opening data_dashboard with device:', selectedDevice);\r\n    console.log('dp', newParams.datapoints);\r\n  } catch (error) {\r\n    console.error('Custom action failed:', error);\r\n  }\r\n})();\r\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6874703e-dfaa-2c01-7b8e-728cdd3abf0a"
              },
              {
                "name": "non existing devices",
                "icon": "construction",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "if (data.nonExistingDevices.length ===0){\n    return false;\n}else{\n    return true;\n}\n",
                "type": "openDashboardState",
                "targetDashboardStateId": "non_existing_devices",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "dialogTitle": "",
                "dialogHideDashboardToolbar": true,
                "dialogWidth": 50,
                "dialogHeight": 50,
                "openInSeparateDialog": true,
                "openInPopover": false,
                "id": "e0e714e3-eae5-de4b-84a7-f7916b263634"
              },
              {
                "name": "Open Device Dashboard",
                "icon": "dashboard",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#device-dashboard', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = widgetContext.stateController.getStateParams();\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\n// widgetContext.actionsApi.openDashboardStateInSeparateDialog(stateId, params, entityName, false, '1280', '1024');\nwidgetContext.stateController.openState(stateId, params);\n// widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px');\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            return 'wassergeraete_volumess_wmz';\n        case 'Elsys ERS Lite':            \n            return 'elsys_ers_lite';\n        case 'Elsys ERS CO2 Lite':            \n            return 'elsys_ersco2_lite';                      \n        case 'Dragino CPL01':\n            return 'dragino_cpl01';\n        case 'Innotas Modularis':            \n            return 'innotas_modularis';\n        case 'Fludia FM432g':            \n            return 'fludia_fm432g';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'Milesight WS301':            \n            return 'milesight_ws301';\n        case 'Milesight EM300-DI':            \n            return 'milesight_em300_di';                      \n        case 'Milesight EM300-TH':\n            return 'milesight_em300_th';\n        case 'Milesight EM300-ZLD':            \n            return 'milesight_em300_zld';\n        case 'Milesight AM300':            \n            return 'milesight_am300';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'MUC':            \n            return 'muc';                      \n        case 'MUC KWZ':\n            return 'muc_kwz';\n        case 'MUC KMZ':            \n            return 'muc_kmz';\n        case 'MUC WMZ':            \n            return 'muc_wmz';                      \n        case 'MUC ELZ':\n            return 'muc_elz';\n        case 'MUC GZ':\n            return 'muc_gz';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_full';\n        default:\n            return 'unknown_settings';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2ff2ef60-bc18-c856-1b79-e199ae779f10"
              },
              {
                "name": "Edit Gateway",
                "icon": "settings",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "/*return data[\"Type\"] === 'Gateway' || data[\"Type\"] === 'LoRaWAN Gateway' || data[\"Type\"] === 'AS Gateway' || data[\"Type\"] === 'MUC' || data[\"Type\"] === 'Beckhoff Gateway' || data[\"Type\"] === 'Type' || data[\"Type\"] === 'MUC.one' || data[\"Type\"] === 'IoT Gateway' || data[\"Type\"] === 'MUC';*/\nreturn false",
                "type": "customPretty",
                "customHtml": "<!-- HTML Template (Angular) -->\r\n<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form max-w-3xl mx-auto\">\r\n    <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n        <h2 class=\"text-lg font-semibold\">Edit gateway</h2>\r\n        <span class=\"flex-1\"></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    \r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n        <mat-stepper #stepper [linear]=\"true\" animationDuration=\"500ms\" style=\"flex-grow: 1;\">\r\n            <!-- GATEWAY DETAILS STEP -->\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('general')\">\r\n                <ng-template matStepLabel>Gateway details</ng-template>\r\n                <div class=\"flex flex-col items-start self-stretch grow\" [formGroup]=\"editEntityFormGroup.get('general')\">\r\n                    <div class=\"flex w-full gap-2\">\r\n                        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                            <mat-label>Entity ID</mat-label>\r\n                            <input matInput formControlName=\"id\" required readonly>\r\n                            <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Entity ID\" (click)=\"copyToClipboard($event, 'general.id')\">\r\n                                <mat-icon>content_copy</mat-icon>\r\n                            </button>\r\n                            <mat-error *ngIf=\"editEntityFormGroup.get('general').get('id').hasError('required')\">\r\n                                Entity ID is required.\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div class=\"flex w-full gap-2\">\r\n                        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                            <mat-label>Name</mat-label>\r\n                            <input matInput formControlName=\"name\" required readonly>\r\n                            <mat-error *ngIf=\"editEntityFormGroup.get('general').get('name').hasError('required')\">\r\n                                Entity name is required.\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div class=\"flex w-full gap-2\">\r\n                        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                            <mat-label>Type</mat-label>\r\n                            <input matInput formControlName=\"type\" required readonly>\r\n                            <mat-error *ngIf=\"editEntityFormGroup.get('general').get('type').hasError('required')\">\r\n                                Entity Type is required.\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                            <mat-label>Label</mat-label>\r\n                            <input matInput formControlName=\"label\" readonly>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div formGroupName=\"attributes\" class=\"flex flex-col w-full\">\r\n                        <div class=\"flex w-full gap-2\">\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Display Name</mat-label>\r\n                                <input matInput formControlName=\"displayName\">\r\n                            </mat-form-field>\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Inactivity Timeout (minutes)</mat-label>\r\n                                <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div class=\"flex w-full gap-2\">\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Customer</mat-label>\r\n                                <input matInput formControlName=\"customer\" required>\r\n                            </mat-form-field>\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Location</mat-label>\r\n                                <input matInput formControlName=\"location\">\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div class=\"flex w-full gap-2\">\r\n                            <div *ngIf=\"editEntityFormGroup.get('general').get('type').value === 'Gateway'\" class=\"w-full mb-4\">\r\n                                <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                                    <mat-label>Gateway ID</mat-label>\r\n                                    <input matInput formControlName=\"gatewayID\" required pattern=\"[a-zA-Z0-9]{16}\">\r\n                                    <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Gateway ID\" (click)=\"copyToClipboard($event, 'general.attributes.gatewayID')\">\r\n                                        <mat-icon>content_copy</mat-icon>\r\n                                    </button>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n                    <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\r\n                        Cancel\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" matStepperNext type=\"button\">\r\n                        Next\r\n                    </button>\r\n                </div>\r\n            </mat-step>\r\n\r\n            <!-- CREDENTIALS STEP -->\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('credentialsDetails')\">\r\n                <ng-template matStepLabel>Credentials</ng-template>\r\n                <div class=\"flex flex-col items-start self-stretch w-full h-full\" [formGroup]=\"editEntityFormGroup.get('credentialsDetails')\">\r\n                    <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                        <mat-label>Credentials Type</mat-label>\r\n                        <input matInput formControlName=\"credentialsType\" readonly>\r\n                    </mat-form-field>\r\n            \r\n                    <!-- MQTT_BASIC Fields -->\r\n                    <div *ngIf=\"editEntityFormGroup.get('credentialsDetails').get('credentialsType').value === 'MQTT_BASIC'\">\r\n                        <div class=\"flex flex-col justify-evenly items-stretch w-full h-full\">\r\n                            <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                                <mat-label>Client ID</mat-label>\r\n                                <input matInput formControlName=\"clientId\" required>\r\n                                <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Client ID\" (click)=\"copyToClipboard($event, 'credentialsDetails.clientId')\">\r\n                                    <mat-icon>content_copy</mat-icon>\r\n                                </button>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('credentialsDetails').get('clientId').hasError('required')\">\r\n                                    Client ID is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n\r\n                            <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                                <mat-label>User Name</mat-label>\r\n                                <input matInput formControlName=\"userName\" required>\r\n                                <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy User Name\" (click)=\"copyToClipboard($event, 'credentialsDetails.userName')\">\r\n                                    <mat-icon>content_copy</mat-icon>\r\n                                </button>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('credentialsDetails').get('userName').hasError('required')\">\r\n                                    User Name is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n\r\n                            <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                                <mat-label>Password</mat-label>\r\n                                <input matInput [type]=\"hidePassword ? 'password' : 'text'\" formControlName=\"password\" required>\r\n                                <button mat-icon-button type=\"button\" matSuffix matTooltip=\"{{ hidePassword ? 'Show Password' : 'Hide Password' }}\" (click)=\"togglePasswordVisibility()\">\r\n                                    <mat-icon>{{ hidePassword ? 'visibility' : 'visibility_off' }}</mat-icon>\r\n                                </button>\r\n                                <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Password\" (click)=\"copyToClipboard($event, 'credentialsDetails.password')\">\r\n                                    <mat-icon>content_copy</mat-icon>\r\n                                </button>\r\n                                <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Generate new Password\" (click)=\"generatePassword()\">\r\n                                    <mat-icon>autorenew</mat-icon>\r\n                                </button>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('credentialsDetails').get('password').hasError('required')\">\r\n                                    Password is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                        </div>\r\n                    </div>\r\n            \r\n                    <!-- ACCESS_TOKEN Fields -->\r\n                    <div class=\"flex flex-col w-full\" *ngIf=\"editEntityFormGroup.get('credentialsDetails').get('credentialsType').value === 'ACCESS_TOKEN'\">\r\n                      <div class=\"flex w-full\">\r\n                        <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                          <mat-label>Credentials ID</mat-label>\r\n                          <input matInput formControlName=\"credentialsId\">\r\n\r\n                          <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Credentials ID\"\r\n                                  (click)=\"copyToClipboard($event, 'credentialsDetails.credentialsId')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                          </button>\r\n                        </mat-form-field>\r\n                      </div>\r\n                     </div>\r\n                </div>\r\n                \r\n                <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n                    <button mat-button matStepperPrevious type=\"button\">Back</button>\r\n                    <button mat-button mat-raised-button color=\"primary\" type=\"submit\">\r\n                        Save\r\n                    </button>\r\n                </div>\r\n                \r\n            </mat-step>\r\n        </mat-stepper>\r\n    </div>\r\n</form>\r\n",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\r\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\r\n  background-color: rgba(244, 249, 254, 0.5) !important;\r\n}\r\n\r\n/* make sure the disabled focus-overlay is tinted the same */\r\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\r\n  background-color: rgba(244, 249, 254, 0.5) !important;\r\n}\r\n\r\n.add-entity-form\r\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\r\n  background-color: #F4F9FE !important;\r\n}\r\n\r\n.add-entity-form\r\n  .mat-mdc-form-field-focus-overlay {\r\n  background-color: #F4F9FE !important;\r\n}\r\n\r\n\r\nmat-icon {\r\n    vertical-align: middle; /* or baseline, top, bottom */\r\n    margin-right: 4px; /* space between icon and text */\r\n}\r\n\r\n.fieldset {\r\n    border: 1px solid #e2e8f0;\r\n    background: #ffffff;\r\n    color: #334155;\r\n    border-radius: 6px;\r\n    padding-bottom: 1px;\r\n    padding-top: 1px;\r\n    padding-left: 10px;\r\n    padding-right: 10px;\r\n}\r\n.fieldset-legend {\r\n    margin-bottom: 0.375rem;\r\n    color: #334155;\r\n    background: #ffffff;\r\n    font-weight: 300;\r\n    border-radius: 6px;\r\n    padding: 2px;\r\n}\r\n.fieldset-container{\r\n    padding-bottom: 10px;\r\n}\r\n\r\n.disabled-checkbox {\r\n  pointer-events: none;\r\n  opacity: 0.5; /* To make it visually look disabled */\r\n}\r\n\r\n.disabled-fields {\r\n  pointer-events: none;   /* Prevents interaction */\r\n  opacity: 0.5;           /* Makes it look disabled */\r\n}\r\n\r\n/*.mat-form-field input[disabled] {\r\n  background-color: #f5f5f5;\r\n  cursor: not-allowed; \r\n  color: #9e9e9e;\r\n  \r\n}*/",
                "customFunction": "\r\n\r\nlet $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nconst rxjs = widgetContext.rxjs;\r\n\r\nopenEditEntityDialog();\r\n\r\nfunction openEditEntityDialog() {\r\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\r\n}\r\n\r\nfunction generateRandomPassword(length = 20) {\r\n    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\r\n    let password = '';\r\n    for (let i = 0; i < length; i++) {\r\n        password += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return password;\r\n}\r\n\r\nfunction EditEntityDialogController(instance) {\r\n    let vm = instance;\r\n    \r\n    vm.hidePassword = true;\r\n\r\n    vm.editEntityFormGroup = vm.fb.group({\r\n        general: vm.fb.group({\r\n            type: ['', [vm.validators.required]],\r\n            id: ['', [vm.validators.required]],\r\n            name: ['', [vm.validators.required]],\r\n            label: [''],\r\n            attributes: vm.fb.group({\r\n                gatewayID: [''],\r\n                inactivityTimeout: [''],\r\n                displayName: [''],\r\n                location: [''],\r\n                customer: ['']\r\n            })\r\n        }),\r\n        credentialsDetails: vm.fb.group({\r\n            credentialsType: [''],\r\n            clientId: [''],\r\n            userName: [''],\r\n            password: [''],\r\n            credentialsId: ['']\r\n        }),\r\n        relations: vm.fb.array([])\r\n    });\r\n\r\n    getDevice();\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.relations = function () {\r\n        return vm.editEntityFormGroup.get('relations');\r\n    };\r\n\r\n    vm.save = function () {\r\n        vm.editEntityFormGroup.markAsPristine();\r\n        \r\n        rxjs.forkJoin([\r\n            saveAttributes(entityId),\r\n            updateCredentials(entityId),\r\n            saveRelations(entityId)\r\n        ]).subscribe(\r\n            function () {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            function (error) {\r\n                widgetContext.showErrorToast(`Failed to save: ${error.message}`, 4000, 'top', 'center');\r\n            }\r\n        );\r\n    };\r\n\r\n    vm.copyToClipboard = function (event, controlName) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const path = controlName.split('.');\r\n        const value = vm.editEntityFormGroup.get(path).value;\r\n        navigator.clipboard.writeText(value).then(() => {\r\n            widgetContext.showSuccessToast('Copied to clipboard!', 2000, 'top', 'center');\r\n        }).catch(err => {\r\n            widgetContext.showErrorToast('Failed to copy to clipboard.', 2000, 'top', 'center');\r\n        });\r\n    };\r\n\r\n    vm.togglePasswordVisibility = function() {\r\n        vm.hidePassword = !vm.hidePassword;\r\n    };\r\n\r\n    vm.generatePassword = function() {\r\n        const newPassword = generateRandomPassword();\r\n        vm.editEntityFormGroup.get('credentialsDetails.password').setValue(newPassword);\r\n        vm.editEntityFormGroup.get('credentialsDetails').markAsDirty();\r\n    };\r\n\r\n    function getDevice() {\r\n        rxjs.forkJoin([\r\n            deviceService.getDevice(entityId.id),\r\n            deviceService.getDeviceCredentials(entityId.id),\r\n            attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE')\r\n        ]).subscribe(\r\n            ([device, credentials, attrs]) => {\r\n\r\n                let deviceAttributesObject = {};\r\n                attrs.forEach(attr => {\r\n                    deviceAttributesObject[attr.key] = attr.value;\r\n                });\r\n\r\n                let credentialsPatch = {\r\n                    credentialsType: credentials.credentialsType,\r\n                    clientId: '',\r\n                    userName: '',\r\n                    password: '',\r\n                    credentialsId: ''\r\n                };\r\n    \r\n                /*// Debug logs\r\n                console.log('device:', device);\r\n                console.log('credentials:', credentials);\r\n                console.log('credentialsType:', credentials.credentialsType);\r\n                console.log('credentialsValue:', credentials.credentialsValue);*/\r\n    \r\n                if (credentials.credentialsType === 'MQTT_BASIC') {\r\n\r\n                    let parsed = JSON.parse(credentials.credentialsValue || '{}');\r\n                    credentialsPatch.clientId = parsed.clientId || '';\r\n                    credentialsPatch.userName = parsed.userName || '';\r\n                    credentialsPatch.password = parsed.password || '';\r\n    \r\n                } else if (credentials.credentialsType === 'ACCESS_TOKEN') {\r\n                    credentialsPatch.credentialsId = credentials.credentialsId || '';\r\n                }\r\n\r\n                let connectivity = deviceAttributesObject.connectivity || {};\r\n    \r\n                vm.editEntityFormGroup.patchValue({\r\n                    general: {\r\n                        type: device.type,\r\n                        id: entityId.id,\r\n                        name: device.name,\r\n                        label: device.label,\r\n                        attributes: {\r\n                            gatewayID: deviceAttributesObject.gatewayID || '',\r\n                            inactivityTimeout: (deviceAttributesObject.inactivityTimeout || 0) / 60000,\r\n                            displayName: deviceAttributesObject.displayName || '',\r\n                            location: deviceAttributesObject.location || '',\r\n                            customer: deviceAttributesObject.customer || ''\r\n                        }\r\n                    },\r\n                    credentialsDetails: credentialsPatch\r\n                }, { emitEvent: false });\r\n            },\r\n            error => {\r\n                widgetContext.showErrorToast(`Failed to fetch device or attributes: ${error.message}`, 4000, 'top', 'center');\r\n            }\r\n        );\r\n    }\r\n\r\n    function updateCredentials(entityId) {\r\n        return deviceService.getDeviceCredentials(entityId.id).pipe(\r\n            rxjs.mergeMap(existingCredentials => {\r\n                let credentials = vm.editEntityFormGroup.get('credentialsDetails').value;\r\n                let deviceCredentials = {\r\n                    id: existingCredentials.id,\r\n                    deviceId: existingCredentials.deviceId,\r\n                    credentialsType: credentials.credentialsType\r\n                };\r\n    \r\n                if (credentials.credentialsType === 'MQTT_BASIC') {\r\n                    deviceCredentials.credentialsValue = JSON.stringify({\r\n                        clientId: credentials.clientId,\r\n                        userName: credentials.userName,\r\n                        password: credentials.password\r\n                    });\r\n                } else if (credentials.credentialsType === 'ACCESS_TOKEN') {\r\n\r\n                    deviceCredentials.credentialsValue = JSON.stringify({\r\n                        credentialsId: credentials.credentialsId\r\n                    });\r\n\r\n                }\r\n    \r\n                return deviceService.saveDeviceCredentials(deviceCredentials);\r\n            }),\r\n            rxjs.catchError(error => {\r\n                widgetContext.showErrorToast(`Failed to update credentials: ${error.message}`, 4000, 'top', 'center');\r\n                return rxjs.throwError(error);\r\n            })\r\n        );\r\n    }\r\n\r\n\r\n    function saveAttributes(entityId) {\r\n        let generalAttrs = vm.editEntityFormGroup.get('general').get('attributes').value;\r\n\r\n        generalAttrs.inactivityTimeout = Number(generalAttrs.inactivityTimeout) * 60000;\r\n\r\n        let simAttrs = vm.editEntityFormGroup.get('simDetails').value;\r\n\r\n        let attributesArray = [];\r\n        for (let key in generalAttrs) {\r\n            if (generalAttrs[key] !== null && generalAttrs[key] !== undefined) {\r\n                attributesArray.push({\r\n                    key: key,\r\n                    value: generalAttrs[key]\r\n                });\r\n            }\r\n        }\r\n\r\n        attributesArray.push({\r\n            key: 'connectivity',\r\n            value: connectivity\r\n        });\r\n\r\n        if (attributesArray.length > 0) {\r\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n        }\r\n        return rxjs.of([]);\r\n    }\r\n\r\n    function saveRelations(entityId) {\r\n        let relations = vm.editEntityFormGroup.get('relations').value;\r\n        let tasks = [];\r\n        for (let i = 0; i < relations.length; i++) {\r\n            let relation = {\r\n                type: relations[i].relationType,\r\n                typeGroup: 'COMMON'\r\n            };\r\n            if (relations[i].direction == 'FROM') {\r\n                relation.to = relations[i].relatedEntity;\r\n                relation.from = entityId;\r\n            } else {\r\n                relation.to = entityId;\r\n                relation.from = relations[i].relatedEntity;\r\n            }\r\n            tasks.push(entityRelationService.saveRelation(relation));\r\n        }\r\n        if (tasks.length > 0) {\r\n            return rxjs.forkJoin(tasks);\r\n        }\r\n        return rxjs.of([]);\r\n    }\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fc1adedf-0631-03f0-193f-b0311b41e8d7"
              },
              {
                "name": "Edit Device",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.editDeviceOrGateway(widgetContext, entityId, entityName, entityLabel);\n\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bc940333-2047-fe88-1342-a59bbbda6001"
              },
              {
                "name": "Edit Config",
                "icon": "edit",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Device Config",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "30vw",
                "popoverHeight": "20vw",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "12fd442b-8d17-ce06-ceb3-5d8fc6b53a1d"
              },
              {
                "name": "Delete device",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenDeleteDeviceDialog();\n\nfunction openDeleteDeviceDialog() {\n  var title = 'Are you sure you want to delete the device ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the device and all related data will become unrecoverable!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteDevice();\n      }\n    }\n  );\n}\n\nfunction deleteDevice() {\n  deviceService.deleteDevice(entityId.id).subscribe(\n    function() {\n      widgetContext.updateAliases();\n    }\n  );\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3efc1d52-ce08-82ae-e513-ec81ec27b6df"
              }
            ],
            "rowClick": [
              {
                "name": "Open Device Attributes",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let injector = widgetContext.$scope.$injector;\nlet attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\nlet alarmService = injector.get(widgetContext.servicesMap.get('alarmService'));\n\nattributeService\n  .getEntityTimeseriesLatest(entityId)\n  .subscribe(datapoints => {\n    const {\n      criticalAlarmsCount,\n      majorAlarmsCount,\n      minorAlarmsCount,\n      warningAlarmsCount,\n      f_cnt,\n      dr,\n      status_battery_level,\n      status_margin,\n      ...filtered\n    } = datapoints;\n\n    \n    var params = widgetContext.stateController.getStateParams();\n\n    params['selectedDevice'] = {\n      \"entityId\" : entityId,\n      \"entityName\" : entityName,\n      \"entityLabel\" : entityLabel\n    }\n    \n    params['tabMode'] = \"attributes\";\n    \n    widgetContext.stateController.updateState(null, params);\n});",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4e7ccb08-6d65-fbf7-c455-7cb47565a2ac"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.devices-table.add-device.titel}",
                "buttonType": "icon",
                "icon": "add_box",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "let desiredMode = \"Both\"\nutils.addDevice(widgetContext,entityId,entityName,entityLabel,desiredMode);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "521af4c4-8ad4-e5b4-b160-9c8d8d84dd51"
              },
              {
                "name": "Import Devices from CSV",
                "buttonType": "icon",
                "icon": "mdi:file-delimited-outline",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.importDevices(widgetContext);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Import Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6a0d3bfe-50b8-6934-8909-7c42f8a500a1"
              },
              {
                "name": "All Devices",
                "buttonType": "icon",
                "icon": "devices_other",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openURL",
                "openNewBrowserTab": true,
                "url": "https://cloud.pke-iot.expert/entities/devices/all",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "36a976ca-f9ce-d1ec-dc73-fd01c8882713"
              },
              {
                "name": "Location Alarms",
                "buttonType": "icon",
                "icon": "notifications",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedDevice'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "ebb86dba-a1e2-13ed-7e40-1a94f6c72084"
              },
              {
                "name": "Add Gateway",
                "buttonType": "icon",
                "icon": "add_circle_outline",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form max-w-3xl mx-auto\">\r\n    <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n        <h2 class=\"text-lg font-semibold\">Add gateway</h2>\r\n        <span class=\"flex-1\"></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n        <mat-stepper *ngIf=\"editEntityFormGroup\" #stepper [linear]=\"true\" (selectionChange)=\"onStepChange($event)\" animationDuration=\"500ms\" style=\"flex-grow: 1;\">\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('general')\">\r\n                <ng-template matStepLabel>Gateway details</ng-template>\r\n                <div class=\"flex flex-col items-start justify-stretch\" style=\"flex-grow: 1;\" [formGroup]=\"editEntityFormGroup.get('general')\">\r\n                    <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                        <mat-label>Device Type</mat-label>\r\n                        <mat-select formControlName=\"type\" placeholder=\"Select Type\">\r\n                            <mat-option value=\"MUC\">MUC.easy</mat-option>\r\n                            <mat-option value=\"MUC.one\">MUC.one</mat-option>\r\n                            <mat-option value=\"Beckhoff Gateway\">Beckhoff Gateway</mat-option>\r\n                            <mat-option value=\"Wago Gateway\">Wago Gateway</mat-option>\r\n                            <mat-option value=\"AS Gateway\">AS Gateway</mat-option>\r\n                            <mat-option value=\"Gateway\">LoRaWAN Gateway</mat-option>\r\n                        </mat-select>\r\n                    </mat-form-field>\r\n                    <!-- Fields for MUC -->\r\n                    <div *ngIf=\"editEntityFormGroup.get('general').get('type').value !== 'Gateway'\">\r\n                        <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Name</mat-label>\r\n                                <input matInput formControlName=\"entityName\" required>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('entityName').hasError('required')\">\r\n                                    Entity name is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Label</mat-label>\r\n                                <input matInput formControlName=\"entityLabel\">\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div formGroupName=\"attributes\" fxLayout=\"column\">\r\n                            <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>Display Name</mat-label>\r\n                                    <input matInput formControlName=\"displayName\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>Customer</mat-label>\r\n                                    <input matInput formControlName=\"customer\" required>\r\n                                </mat-form-field>\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>Location</mat-label>\r\n                                    <input matInput formControlName=\"location\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>MUC ID</mat-label>\r\n                                    <input matInput formControlName=\"mucId\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>Inactivity Timeout</mat-label>\r\n                                    <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <!-- Fields for LoRaWAN Gateway -->\r\n                    <div *ngIf=\"editEntityFormGroup.get('general').get('type').value === 'Gateway'\">\r\n                        <!-- LoRaWAN Gateway fields here -->\r\n                        <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Name</mat-label>\r\n                                <input matInput formControlName=\"entityName\" required>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('entityName').hasError('required')\">\r\n                                    Entity name is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                <mat-label>Label</mat-label>\r\n                                <input matInput formControlName=\"entityLabel\">\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div formGroupName=\"attributes\" fxLayout=\"column\">\r\n                            <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>Display Name</mat-label>\r\n                                    <input matInput formControlName=\"displayName\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>Gateway ID</mat-label>\r\n                                    <input matInput formControlName=\"gatewayID\" required pattern=\"[a-zA-Z0-9]{16}\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                                    <mat-label>Inactivity Timeout</mat-label>\r\n                                    <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- Activate SIM -->\r\n                    <fieldset class=\"fieldset w-full\" style=\"margin-bottom: 15px;\">\r\n                      <legend>Select further Actions</legend>\r\n                      <div style=\"display: flex; flex-direction: column; align-items: flex-start; margin-top: 5px; margin-bottom: 15px;\">\r\n                        <mat-checkbox formControlName=\"activateSIM\" style=\"margin-top:10px;\">Activate SIM</mat-checkbox>\r\n    \r\n                        <!-- Conditional Connectivity Fields -->\r\n                        <div *ngIf=\"editEntityFormGroup.get('general').get('activateSIM').value\" formGroupName=\"connectivity\" style=\"margin-top:10px;\">\r\n                          <mat-form-field class=\"flex-1 block\" style=\"width: 100%;\">\r\n                            <mat-label>ICCID</mat-label>\r\n                            <input matInput formControlName=\"ICCID\" required/>\r\n                            <mat-error *ngIf=\"editEntityFormGroup.get('general').get('connectivity').get('ICCID').hasError('required')\">\r\n                              ICCID is required.\r\n                            </mat-error>\r\n                          </mat-form-field>\r\n                          <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\r\n                            <mat-form-field class=\"w-1/2\">\r\n                              <mat-label>Carrier</mat-label>\r\n                              <mat-select formControlName=\"carrierSIM\" placeholder=\"Select Carrier\" required>\r\n                                <mat-option value=\"tech+\">wherever SIM tech+</mat-option>\r\n                                <mat-option value=\"link+\">wherever SIM link+</mat-option>\r\n                              </mat-select>\r\n                              <mat-error *ngIf=\"editEntityFormGroup.get('general').get('connectivity').get('carrierSIM').hasError('required')\">\r\n                                Carrier is required.\r\n                              </mat-error>\r\n                            </mat-form-field>\r\n    \r\n                            <mat-form-field class=\"w-1/2\">\r\n                              <mat-label>SIM Status</mat-label>\r\n                              <mat-select formControlName=\"statusSIM\" placeholder=\"Select SIM-Status\" required>\r\n                                <mat-option value=\"ACTIVATED\">Activate</mat-option>\r\n                                <mat-option value=\"DEACTIVATED\">Deactivate</mat-option>\r\n                              </mat-select>\r\n                              <mat-error *ngIf=\"editEntityFormGroup.get('general').get('connectivity').get('statusSIM').hasError('required')\">\r\n                                Status is required.\r\n                              </mat-error>\r\n                            </mat-form-field>\r\n                          </div>\r\n                        </div>\r\n                    </div>\r\n                    </fieldset>\r\n                </div>\r\n                <div class=\"flex flex-row gap-2 justify-end items-center\" style=\"margin-top: auto;\">\r\n                    <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\r\n                        Cancel\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" matStepperNext type=\"button\" *ngIf=\"editEntityFormGroup.get('general').get('type').value !== 'Gateway'\">\r\n                        Next\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" type=\"submit\" *ngIf=\"editEntityFormGroup.get('general').get('type').value === 'Gateway'\"\r\n                        [disabled]=\"(isLoading$ | async) || editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\r\n                        Create\r\n                    </button>\r\n                </div>\r\n            </mat-step>\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('credentials')\" *ngIf=\"editEntityFormGroup.get('general').get('type').value !== 'Gateway'\">\r\n                <ng-template matStepLabel>Credentials</ng-template>\r\n                <div class=\"flex flex-col items-start justify-stretch\" style=\"margin-top: 30px;\" [formGroup]=\"editEntityFormGroup.get('credentials')\">\r\n                    <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                        <mat-label>Credentials Type</mat-label>\r\n                        <input matInput formControlName=\"credentialsType\" readonly>\r\n                    </mat-form-field>\r\n                    <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                        <mat-label>Client ID</mat-label>\r\n                        <input matInput formControlName=\"clientId\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Client ID\" (click)=\"copyToClipboard($event, 'credentials.clientId')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('clientId').hasError('required')\">\r\n                            Client ID is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                    <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                        <mat-label>User Name</mat-label>\r\n                        <input matInput formControlName=\"userName\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy User Name\" (click)=\"copyToClipboard($event, 'credentials.userName')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('userName').hasError('required')\">\r\n                            User Name is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                    <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n                        <mat-label>Password</mat-label>\r\n                        <input matInput [type]=\"hidePassword ? 'password' : 'text'\" formControlName=\"password\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"{{ hidePassword ? 'Show Password' : 'Hide Password' }}\" (click)=\"togglePasswordVisibility()\">\r\n                            <mat-icon>{{ hidePassword ? 'visibility' : 'visibility_off' }}</mat-icon>\r\n                        </button>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Password\" (click)=\"copyToClipboard($event, 'credentials.password')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('password').hasError('required')\">\r\n                            Password is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                </div>\r\n                <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n                    <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\">\r\n                        Cancel\r\n                    </button>\r\n                    <button mat-button mat-raised-button color=\"primary\" type=\"submit\">\r\n                        Create\r\n                    </button>\r\n                </div>\r\n            </mat-step>\r\n        </mat-stepper>\r\n    </div>\r\n</form>\r\n",
                "customCss": "\r\n.device-item {\r\n    line-height: 24px;\r\n    width: 100%;\r\n    padding-top: 8px;\r\n    padding-bottom: 8px;\r\n}\r\n\r\n.device-item .device-name {\r\n    font-size: 12px;\r\n    opacity: 0.7;\r\n}\r\n\r\n.device-item .device-type {\r\n    font-size: 14px;\r\n    opacity: 0.7;\r\n}\r\n\r\nmat-option {\r\n    height: auto !important;\r\n    white-space: normal !important;\r\n}\r\n\r\n.mat-select-value-text {\r\n    display: block;\r\n    width: 100%;\r\n}\r\n\r\n/*========================================================================*/\r\n/*=========================  Add entity example  =========================*/\r\n/*========================================================================*/\r\n\r\n.add-entity-form {\r\n    width: 100%;\r\n}\r\n\r\n.add-entity-form .boolean-value-input {\r\n    padding-left: 5px;\r\n}\r\n\r\n.add-entity-form .boolean-value-input .checkbox-label {\r\n    color: rgba(0,0,0,0.54);\r\n    font-size: 12px;\r\n}\r\n\r\n.relations-list .header {\r\n    padding-right: 5px;\r\n    padding-bottom: 5px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.relations-list .header .cell {\r\n    padding-right: 5px;\r\n    padding-left: 5px;\r\n    font-size: 12px;\r\n    font-weight: 700;\r\n    color: rgba(0, 0, 0, .54);\r\n    white-space: nowrap;\r\n}\r\n\r\n.relations-list .mat-form-field-infix {\r\n    width: auto !important;\r\n}\r\n\r\n.relations-list .body {\r\n    padding-right: 5px;\r\n    padding-bottom: 15px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.relations-list .body .row {\r\n    padding-top: 5px;\r\n}\r\n\r\n.relations-list .body .cell {\r\n    padding-right: 5px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.relations-list .body .md-button {\r\n    margin: 0;\r\n}\r\n\r\n.full-width-container {\r\n    width: 100%;\r\n    padding-right: 5px;\r\n    padding-bottom: 5px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.full-width-container mat-form-field {\r\n    width: 100%;\r\n}\r\n\r\n.mat-mdc-icon-button .mat-mdc-button-touch-target {\r\n    position: absolute;\r\n    top: 50%;\r\n    height: 48px;\r\n    left: 50%;\r\n    width: 48px;\r\n    transform: translate(-50%, -50%);\r\n}\r\n.tb-default .mat-mdc-icon-button {\r\n    --mat-mdc-button-persistent-ripple-color: #000;\r\n    --mat-mdc-button-ripple-color: rgba(0, 0, 0, .1);\r\n}\r\n\r\n.tb-default .mat-toolbar.mat-primary {\r\n    background: #0094d0;\r\n    color: var(--tb-primary-contrast-500);\r\n}\r\n\r\n/* apply a half-opaque blue to disabled filled text-fields */\r\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\r\n  background-color: rgba(244, 249, 254, 0.5) !important;\r\n}\r\n\r\n/* make sure the disabled focus-overlay is tinted the same */\r\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\r\n  background-color: rgba(244, 249, 254, 0.5) !important;\r\n}\r\n\r\n.add-entity-form\r\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\r\n  background-color: #F4F9FE !important;\r\n}\r\n\r\n.add-entity-form\r\n  .mat-mdc-form-field-focus-overlay {\r\n  background-color: #F4F9FE !important;\r\n}\r\n\r\n\r\nmat-icon {\r\n    vertical-align: middle; /* or baseline, top, bottom */\r\n    margin-right: 4px; /* space between icon and text */\r\n}\r\n\r\n.fieldset {\r\n    border: 1px solid #e2e8f0;\r\n    background: #ffffff;\r\n    color: #334155;\r\n    border-radius: 6px;\r\n    padding-bottom: 1px;\r\n    padding-top: 1px;\r\n    padding-left: 10px;\r\n    padding-right: 10px;\r\n}\r\n.fieldset-legend {\r\n    margin-bottom: 0.375rem;\r\n    color: #334155;\r\n    background: #ffffff;\r\n    font-weight: 300;\r\n    border-radius: 6px;\r\n    padding: 2px;\r\n}\r\n.fieldset-container{\r\n    padding-bottom: 10px;\r\n}\r\n\r\n.disabled-checkbox {\r\n  pointer-events: none;\r\n  opacity: 0.5; /* To make it visually look disabled */\r\n}\r\n\r\n.disabled-fields {\r\n  pointer-events: none;   /* Prevents interaction */\r\n  opacity: 0.5;           /* Makes it look disabled */\r\n}\r\n\r\n/*.mat-form-field input[disabled] {\r\n  background-color: #f5f5f5;\r\n  cursor: not-allowed; \r\n  color: #9e9e9e;\r\n  \r\n}*/\r\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\n\r\nopenAddEntityDialog();\r\n\r\nfunction openAddEntityDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction getSelectedCustomerId() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    return stateParams.selectedCustomer.entityId.id;\r\n}\r\n\r\nfunction getSelectedCustomerName() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    try {\r\n        return stateParams.selectedCustomer.entityName;\r\n    } catch (error) {\r\n        return stateParams.entityName;\r\n    }\r\n}\r\n\r\nfunction getSelectedLocationName() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    try {\r\n        return stateParams.selectedLocation;\r\n    } catch (error) {\r\n        const hasAssetEntity = stateParams.entityId.entityType === 'ASSET';\r\n        if (hasAssetEntity) {\r\n            return stateParams.entityName;\r\n        } else {\r\n            return '';\r\n        }\r\n    }\r\n}\r\n\r\nfunction generateRandomPassword() {\r\n    const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';\r\n    let password = '';\r\n    for (let i = 0; i < 20; i++) {\r\n        password += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return password;\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\r\n    vm.entitySearchDirection = {\r\n        from: \"FROM\",\r\n        to: \"TO\"\r\n    }\r\n\r\n    vm.editEntityFormGroup = vm.fb.group({\r\n        general: vm.fb.group({\r\n            type: ['MUC', [vm.validators.required]], // Default to MUC\r\n            entityName: [getSelectedLocationName().entityName + \"_\", [vm.validators.required]],\r\n            entityLabel: [getSelectedLocationName().entityLabel],\r\n            attributes: vm.fb.group({\r\n                isGateway: [true],\r\n                gatewayID: [''],\r\n                mucId: [''],\r\n                inactivityTimeout: ['60'],\r\n                street: [''],\r\n                displayName: [''],\r\n                city: [''],\r\n                plz: [''],\r\n                location: [getSelectedLocationName().entityName],\r\n                customer: [getSelectedCustomerName()]\r\n            }),\r\n            activateSIM: [false] \r\n        }),\r\n        credentials: vm.fb.group({\r\n            credentialsType: ['MQTT_BASIC'],\r\n            // Initialize clientId with entityName so that it's always linked\r\n            clientId: [getSelectedLocationName().entityName + \"_\", [vm.validators.required]],\r\n            userName: ['pke', [vm.validators.required]],\r\n            password: [generateRandomPassword(), [vm.validators.required]]\r\n        }),\r\n        relations: vm.fb.array([])\r\n    });\r\n\r\n    // Dynamically add/remove connectivity group when activateSIM changes\r\n    vm.editEntityFormGroup.get('general').get('activateSIM').valueChanges.subscribe(activate => {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        if (activate) {\r\n            // If activateSIM is true and connectivity is not yet there, add it\r\n            if (!generalGroup.get('connectivity')) {\r\n                generalGroup.addControl('connectivity', vm.fb.group({\r\n                    ICCID: ['', [vm.validators.required]],\r\n                    carrierSIM: ['', [vm.validators.required]],\r\n                    statusSIM: ['', [vm.validators.required]]\r\n                }));\r\n            }\r\n        } else {\r\n            // If activateSIM is false and connectivity exists, remove it\r\n            if (generalGroup.get('connectivity')) {\r\n                generalGroup.removeControl('connectivity');\r\n            }\r\n        }\r\n    });\r\n\r\n    // Update clientId whenever entityName changes\r\n    vm.editEntityFormGroup.get('general').get('entityName').valueChanges.subscribe(value => {\r\n        vm.editEntityFormGroup.get('credentials').patchValue({\r\n            clientId: value\r\n        });\r\n    });\r\n\r\n    vm.editEntityFormGroup.get('general').get('type').valueChanges.subscribe(type => {\r\n        if (type === 'Gateway') {\r\n            vm.editEntityFormGroup.get('credentials').disable();\r\n        } else {\r\n            vm.editEntityFormGroup.get('credentials').enable();\r\n        }\r\n    });\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.relations = function () {\r\n        return vm.editEntityFormGroup.get('relations');\r\n    };\r\n\r\n    vm.save = function () {\r\n        vm.editEntityFormGroup.markAsPristine();\r\n        saveEntityObservable().subscribe(\r\n            function (entity) {\r\n                widgetContext.rxjs.forkJoin([\r\n                    saveAttributes(entity.id),\r\n                    updateCredentials(entity.id),\r\n                    saveRelations(entity.id)\r\n                ]).subscribe(\r\n                    function () {\r\n                        widgetContext.updateAliases();\r\n                        vm.dialogRef.close(null);\r\n                        updateState();\r\n                    }\r\n                );\r\n            }\r\n        );\r\n    };\r\n\r\n    vm.copyToClipboard = function (event, controlName) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const value = vm.editEntityFormGroup.get(controlName.split('.')).value;\r\n        navigator.clipboard.writeText(value).then(() => {\r\n            widgetContext.showSuccessToast('Copied to clipboard!', 2000, 'top', 'center');\r\n        }).catch(err => {\r\n            widgetContext.showErrorToast('Failed to copy to clipboard.', 2000, 'top', 'center');\r\n        });\r\n    };\r\n    \r\n    vm.onDeviceTypeChange = function(stepper) {\r\n        const type = vm.editEntityFormGroup.get('general').get('type').value;\r\n        if (type === 'Gateway') {\r\n            vm.editEntityFormGroup.get('credentials').disable();\r\n            stepper.selectedIndex = 0; \r\n        } else {\r\n            vm.editEntityFormGroup.get('credentials').enable();\r\n            if (stepper.selectedIndex === 0) {\r\n                stepper.selectedIndex = 1; \r\n            }\r\n        }\r\n    };\r\n    \r\n    vm.hidePassword = true; \r\n\r\n    vm.togglePasswordVisibility = function() {\r\n        vm.hidePassword = !vm.hidePassword;\r\n    };\r\n\r\n    function saveEntityObservable() {\r\n        const formValues = vm.editEntityFormGroup.get('general').value;\r\n        let entity = {\r\n            name: formValues.entityName,\r\n            type: formValues.type,\r\n            label: formValues.entityLabel\r\n        };\r\n        return deviceService.saveDevice(entity);\r\n    }\r\n\r\n    function updateCredentials(entityId) {\r\n        return deviceService.getDeviceCredentials(entityId.id).pipe(\r\n            widgetContext.rxjs.mergeMap(existingCredentials => {\r\n                let credentials = vm.editEntityFormGroup.get('credentials').value;\r\n                let deviceCredentials = {\r\n                    id: existingCredentials.id,\r\n                    deviceId: existingCredentials.deviceId,\r\n                    credentialsType: credentials.credentialsType,\r\n                    credentialsValue: JSON.stringify({\r\n                        clientId: credentials.clientId,\r\n                        userName: credentials.userName,\r\n                        password: credentials.password\r\n                    })\r\n                };\r\n                return deviceService.saveDeviceCredentials(deviceCredentials);\r\n            }),\r\n            widgetContext.rxjs.catchError(error => {\r\n                widgetContext.showErrorToast(`Failed to update credentials: ${error.message}`, 4000, 'top', 'center');\r\n                return widgetContext.rxjs.throwError(error);\r\n            })\r\n        );\r\n    }\r\n    \r\n    function saveAttributes(entityId) {\r\n        let attributes = vm.editEntityFormGroup.get('general').get('attributes').value;\r\n        attributes.inactivityTimeout *= 60000; // inactivityTimeout in ms\r\n        attributes.state = \"normal\";\r\n        let attributesArray = [];\r\n        for (let key in attributes) {\r\n            if (attributes[key] !== null) {\r\n                attributesArray.push({\r\n                    key: key,\r\n                    value: attributes[key]\r\n                });\r\n            }\r\n        }\r\n\r\n        // If SIM activated, add connectivity attributes\r\n        if (vm.editEntityFormGroup.get('general').get('activateSIM').value && vm.editEntityFormGroup.get('general').get('connectivity')) {\r\n            const connectivityValues = vm.editEntityFormGroup.get('general').get('connectivity').value;\r\n            attributesArray.push({\r\n                key: 'connectivity',\r\n                value: {\r\n                    carrier: connectivityValues.carrierSIM,\r\n                    ICCID: connectivityValues.ICCID,\r\n                    simStatus: connectivityValues.statusSIM\r\n                }\r\n            });\r\n        }\r\n\r\n        if (attributesArray.length > 0) {\r\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n\r\n    function saveRelations(entityId) {\r\n        let relations = vm.editEntityFormGroup.get('relations').value;\r\n        let tasks = [];\r\n        if (relations && relations.length > 0) {\r\n            for (let i = 0; i < relations.length; i++) {\r\n                let relation = {\r\n                    type: relations[i].relationType,\r\n                    typeGroup: 'COMMON'\r\n                };\r\n                if (relations[i].direction == 'FROM') {\r\n                    relation.to = relations[i].relatedEntity;\r\n                    relation.from = entityId;\r\n                } else {\r\n                    relation.to = entityId;\r\n                    relation.from = relations[i].relatedEntity;\r\n                }\r\n                tasks.push(entityRelationService.saveRelation(relation));\r\n            }\r\n        }\r\n        if (tasks.length > 0) {\r\n            return widgetContext.rxjs.forkJoin(tasks);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n    function updateState() {\r\n        var params = widgetContext.stateController.getStateParams();\r\n        var timewindow = widgetContext.timeWindow;\r\n        widgetContext.dashboard.dashboardTimewindowChangedSubject.next(timewindow);\r\n        widgetContext.stateController.updateState(null, params);\r\n    }\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d721a0b9-a7e1-d175-14d6-0d45d219d5df"
              },
              {
                "name": "Add Device old",
                "icon": "add_box",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"edit-entity-form\">\r\n    <mat-toolbar class=\"tb-default mat-primary\" fxLayout=\"row\" style=\"border-bottom: solid 1px #0000001f;\">\r\n        <h2>Add Device</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    \r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <div mat-dialog-content style=\"height: 100%; display: flex; flex-direction: column; justify-content: space-between;\">\r\n        <mat-stepper *ngIf=\"editEntityFormGroup\" #stepper [linear]=\"true\" (selectionChange)=\"onStepChange($event)\" animationDuration=\"500ms\" style=\"flex-grow: 1;\">\r\n            \r\n            <!-- STEP 1: GENERAL -->\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('general')\">\r\n                <ng-template matStepLabel>General</ng-template>\r\n                <div fxLayout=\"column\" fxLayoutAlign=\"start stretch\" style=\"flex-grow: 1;\" [formGroup]=\"editEntityFormGroup.get('general')\">\r\n\r\n                    <!-- Device Profile Selection -->\r\n                    <mat-form-field class=\"mat-block\">\r\n                        <mat-label>Device Profile</mat-label>\r\n                        <mat-select formControlName=\"type\" (selectionChange)=\"updateDeviceProfile()\">\r\n                            <mat-option *ngFor=\"let profile of deviceProfiles\" [value]=\"profile\">\r\n                                {{ profile.name }}\r\n                            </mat-option>\r\n                        </mat-select>\r\n                    </mat-form-field>\r\n\r\n                    <!-- Default Fields -->\r\n                    <div>\r\n                        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n                            <mat-form-field fxFlex>\r\n                                <mat-label>Name</mat-label>\r\n                                <input matInput formControlName=\"entityName\" required>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('entityName').hasError('required')\">\r\n                                    Entity name is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            <mat-form-field fxFlex>\r\n                                <mat-label>Label</mat-label>\r\n                                <input matInput formControlName=\"entityLabel\">\r\n                            </mat-form-field>\r\n                        </div>\r\n\r\n                        <div formGroupName=\"attributes\" fxLayout=\"column\">\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                                <mat-form-field fxFlex>\r\n                                    <mat-label>Display Name</mat-label>\r\n                                    <input matInput formControlName=\"displayName\">\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                                <mat-form-field fxFlex>\r\n                                    <mat-label>Customer</mat-label>\r\n                                    <input matInput formControlName=\"customer\" required>\r\n                                    <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('customer').hasError('required')\">\r\n                                        Customer is required.\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                                <mat-form-field fxFlex>\r\n                                    <mat-label>Location</mat-label>\r\n                                    <input matInput formControlName=\"location\" required>\r\n                                    <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('location').hasError('required')\">\r\n                                        Location is required.\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                                <mat-form-field fxFlex>\r\n                                    <mat-label>Inactivity Timeout (min)</mat-label>\r\n                                    <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\r\n                                    <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('inactivityTimeout').hasError('required')\">\r\n                                        Inactivity Timeout is required.\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                                <mat-form-field fxFlex>\r\n                                <mat-label>Forward To</mat-label>\r\n                                <mat-select formControlName=\"forwardTo\" required>\r\n                                  <mat-option [value]=\"'Energy Expert API'\">Energy Expert API</mat-option>\r\n                                  <mat-option [value]=\"'Energy Expert Forward'\">Energy Expert Forward</mat-option>\r\n                                  <mat-option [value]=\"'Energy Expert'\">Energy Expert</mat-option>\r\n                                  <mat-option [value]=\"'None'\">None</mat-option>\r\n                                </mat-select>\r\n                            \r\n                                <!-- Update the error message as necessary -->\r\n                                <mat-error\r\n                                  *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('forwardTo').hasError('required')\"\r\n                                >\r\n                                  Forward To is required.\r\n                                </mat-error>\r\n                              </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- LoRaWAN Fields: Nur sichtbar, wenn deviceProfileType 'LoRaWAN' -->\r\n                    <div *ngIf=\"deviceProfileType === 'LoRaWAN'\">\r\n                        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                            <mat-form-field fxFlex [formGroupName]=\"'attributes'\">\r\n                                <mat-label>DevEUI</mat-label>\r\n                                <!-- devEui liegt jetzt in attributes -->\r\n                                <input matInput formControlName=\"devEui\" required pattern=\"^[0-9A-Fa-f]{16}$\">\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('devEui')?.hasError('required')\">\r\n                                    DevEUI is required.\r\n                                </mat-error>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('devEui')?.hasError('pattern')\">\r\n                                    DevEUI must be 16 hex characters (0-9, A-F).\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                    \r\n                            <mat-form-field fxFlex [formGroupName]=\"'attributes'\">\r\n                                <mat-label>App Key</mat-label>\r\n                                <!-- appKey liegt jetzt in attributes -->\r\n                                <input matInput formControlName=\"appKey\" required pattern=\"^[0-9A-Fa-f]{32}$\">\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('appKey')?.hasError('required')\">\r\n                                    App Key is required.\r\n                                </mat-error>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('appKey')?.hasError('pattern')\">\r\n                                    App Key must be 32 hex characters (0-9, A-F).\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- LoRaWAN Gateway Fields: Nur sichtbar, wenn deviceProfileType 'Gateway' und name === 'Gateway' -->\r\n                    <div *ngIf=\"deviceProfileType === 'Gateway' && editEntityFormGroup.get('general').get('type').value?.name === 'Gateway'\">\r\n                        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                            <mat-form-field fxFlex>\r\n                                <mat-label>Gateway ID</mat-label>\r\n                                <input matInput formControlName=\"gatewayID\" required pattern=\"[a-zA-Z0-9]{16}\">\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('attributes').get('gatewayID')?.hasError('required')\">\r\n                                    Gateway ID is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- SIM: Nur wenn deviceProfileType 'Gateway' -->\r\n                    <div *ngIf=\"deviceProfileType === 'Gateway'\">\r\n                        <mat-checkbox formControlName=\"activateSIM\" style=\"margin-top:10px;\">Activate SIM</mat-checkbox>\r\n                        <div *ngIf=\"editEntityFormGroup.get('general').get('activateSIM').value\" formGroupName=\"connectivity\" style=\"margin-top:10px;\">\r\n                            <mat-form-field fxFlex>\r\n                                <mat-label>ICCID</mat-label>\r\n                                <input matInput formControlName=\"ICCID\" required/>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('connectivity').get('ICCID')?.hasError('required')\">\r\n                                    ICCID is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                                <mat-form-field style=\"width:50%;\">\r\n                                    <mat-label>Carrier</mat-label>\r\n                                    <mat-select formControlName=\"carrierSIM\" required>\r\n                                        <mat-option value=\"tech+\">Tech+</mat-option>\r\n                                        <mat-option value=\"link+\">Link+</mat-option>\r\n                                    </mat-select>\r\n                                    <mat-error *ngIf=\"editEntityFormGroup.get('general').get('connectivity').get('carrierSIM')?.hasError('required')\">\r\n                                        Carrier is required.\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n\r\n                                <mat-form-field style=\"width:50%;\">\r\n                                    <mat-label>SIM Status</mat-label>\r\n                                    <mat-select formControlName=\"statusSIM\" required>\r\n                                        <mat-option value=\"ACTIVATED\">Activated</mat-option>\r\n                                        <mat-option value=\"DEACTIVATED\">Deactivated</mat-option>\r\n                                    </mat-select>\r\n                                    <mat-error *ngIf=\"editEntityFormGroup.get('general').get('connectivity').get('statusSIM')?.hasError('required')\">\r\n                                        Status is required.\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- API: Nur wenn deviceProfileType 'API' -->\r\n                    <div *ngIf=\"deviceProfileType === 'API'\">\r\n                        <mat-checkbox formControlName=\"activateAPI\" style=\"margin-top:10px;\">Activate API</mat-checkbox>\r\n                        <div *ngIf=\"editEntityFormGroup.get('general').get('activateAPI').value\" formGroupName=\"api\" style=\"margin-top:10px;\">\r\n                            <!-- API URL -->\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>API URL</mat-label>\r\n                                <input matInput formControlName=\"apiUrl\" required/>\r\n                                <mat-error *ngIf=\"editEntityFormGroup.get('general').get('api').get('apiUrl')?.hasError('required')\">\r\n                                    API URL is required.\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                            \r\n                            <!-- API User / Password -->\r\n                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\">\r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>API User</mat-label>\r\n                                    <input matInput formControlName=\"apiUser\"/>\r\n                                </mat-form-field>\r\n                            \r\n                                <mat-form-field fxFlex class=\"mat-block\">\r\n                                    <mat-label>API Password</mat-label>\r\n                                    <input matInput formControlName=\"apiPassword\" password/>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            \r\n                            <!-- API Token -->\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>API Token</mat-label>\r\n                                <input matInput formControlName=\"apiToken\"/>\r\n                            </mat-form-field>\r\n                            <!-- Site ID -->\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>API Site</mat-label>\r\n                                <input matInput formControlName=\"apiSiteId\"/>\r\n                            </mat-form-field>\r\n                           <!-- Serial Number -->\r\n                            <mat-form-field fxFlex class=\"mat-block\">\r\n                                <mat-label>Serial Number</mat-label>\r\n                                <input matInput formControlName=\"apiSerial\"/>\r\n                            </mat-form-field>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Buttons for Step 1 -->\r\n                <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayoutAlign=\"end center\" style=\"margin-top: auto;\">\r\n                    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n                    <!-- Wenn Gateway mit Credentials (d.h. deviceProfileType='Gateway' und type.name != 'Gateway'): Next-Button -->\r\n                    <button mat-button mat-raised-button color=\"primary\" matStepperNext type=\"button\"\r\n                            *ngIf=\"deviceProfileType === 'Gateway' && editEntityFormGroup.get('general').get('type').value?.name !== 'Gateway'\">\r\n                        Next\r\n                    </button>\r\n                    <!-- In allen anderen Fllen: Create-Button direkt -->\r\n                    <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\r\n                            *ngIf=\"!(deviceProfileType === 'Gateway' && editEntityFormGroup.get('general').get('type').value?.name !== 'Gateway')\"\r\n                            [disabled]=\"editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\r\n                        Create\r\n                    </button>\r\n                </div>\r\n            </mat-step>\r\n\r\n            <!-- STEP 2: CREDENTIALS nur wenn deviceProfileType='Gateway' und type.name != 'Gateway' -->\r\n            <mat-step [stepControl]=\"editEntityFormGroup.get('credentials')\" \r\n                      *ngIf=\"deviceProfileType === 'Gateway' && editEntityFormGroup.get('general').get('type').value?.name !== 'Gateway'\">\r\n                <ng-template matStepLabel>Credentials</ng-template>\r\n                <div fxLayout=\"column\" fxLayoutAlign=\"start stretch\" style=\"margin-top: 30px;\" [formGroup]=\"editEntityFormGroup.get('credentials')\">\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>Credentials Type</mat-label>\r\n                        <input matInput formControlName=\"credentialsType\" readonly>\r\n                    </mat-form-field>\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>Client ID</mat-label>\r\n                        <input matInput formControlName=\"clientId\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Client ID\" (click)=\"copyToClipboard($event, 'credentials.clientId')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('clientId')?.hasError('required')\">\r\n                            Client ID is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>User Name</mat-label>\r\n                        <input matInput formControlName=\"userName\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy User Name\" (click)=\"copyToClipboard($event, 'credentials.userName')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('userName')?.hasError('required')\">\r\n                            User Name is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                    <mat-form-field class=\"full-width\">\r\n                        <mat-label>Password</mat-label>\r\n                        <input matInput [type]=\"hidePassword ? 'password' : 'text'\" formControlName=\"password\" required>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"{{ hidePassword ? 'Show Password' : 'Hide Password' }}\" (click)=\"togglePasswordVisibility()\">\r\n                            <mat-icon>{{ hidePassword ? 'visibility' : 'visibility_off' }}</mat-icon>\r\n                        </button>\r\n                        <button mat-icon-button type=\"button\" matSuffix matTooltip=\"Copy Password\" (click)=\"copyToClipboard($event, 'credentials.password')\">\r\n                            <mat-icon>content_copy</mat-icon>\r\n                        </button>\r\n                        <mat-error *ngIf=\"editEntityFormGroup.get('credentials').get('password')?.hasError('required')\">\r\n                            Password is required.\r\n                        </mat-error>\r\n                    </mat-form-field>\r\n                </div>\r\n                <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayoutAlign=\"end center\" style=\"margin-top: auto;\">\r\n                    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n                    <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\r\n                            [disabled]=\"editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\r\n                        Create\r\n                    </button>\r\n                </div>\r\n            </mat-step>\r\n        </mat-stepper>\r\n    </div>\r\n</form>\r\n",
                "customCss": ".fieldset {\r\n    border: 1px solid #e2e8f0;\r\n    background: #ffffff;\r\n    color: #334155;\r\n    border-radius: 6px;\r\n    padding-bottom: 1px;\r\n    padding-top: 1px;\r\n    padding-left: 10px;\r\n    padding-right: 10px;\r\n}\r\n.device-item {\r\n    line-height: 24px;\r\n    width: 100%;\r\n    padding-top: 8px;\r\n    padding-bottom: 8px;\r\n}\r\n\r\n.device-item .device-name {\r\n    font-size: 12px;\r\n    opacity: 0.7;\r\n}\r\n\r\n.device-item .device-type {\r\n    font-size: 14px;\r\n    opacity: 0.7;\r\n}\r\n\r\nmat-option {\r\n    height: auto !important;\r\n    white-space: normal !important;\r\n}\r\n\r\n.mat-select-value-text {\r\n    display: block;\r\n    width: 100%;\r\n}\r\n\r\n/*========================================================================*/\r\n/*=========================  Add entity example  =========================*/\r\n/*========================================================================*/\r\n\r\n.add-entity-form {\r\n    width: 100%;\r\n}\r\n\r\n.add-entity-form .boolean-value-input {\r\n    padding-left: 5px;\r\n}\r\n\r\n.add-entity-form .boolean-value-input .checkbox-label {\r\n    color: rgba(0,0,0,0.54);\r\n    font-size: 12px;\r\n}\r\n\r\n.relations-list .header {\r\n    padding-right: 5px;\r\n    padding-bottom: 5px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.relations-list .header .cell {\r\n    padding-right: 5px;\r\n    padding-left: 5px;\r\n    font-size: 12px;\r\n    font-weight: 700;\r\n    color: rgba(0, 0, 0, .54);\r\n    white-space: nowrap;\r\n}\r\n\r\n.relations-list .mat-form-field-infix {\r\n    width: auto !important;\r\n}\r\n\r\n.relations-list .body {\r\n    padding-right: 5px;\r\n    padding-bottom: 15px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.relations-list .body .row {\r\n    padding-top: 5px;\r\n}\r\n\r\n.relations-list .body .cell {\r\n    padding-right: 5px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.relations-list .body .md-button {\r\n    margin: 0;\r\n}\r\n\r\n.full-width-container {\r\n    width: 100%;\r\n    padding-right: 5px;\r\n    padding-bottom: 5px;\r\n    padding-left: 5px;\r\n}\r\n\r\n.full-width-container mat-form-field {\r\n    width: 100%;\r\n}\r\n\r\n.mat-mdc-icon-button .mat-mdc-button-touch-target {\r\n    position: absolute;\r\n    top: 50%;\r\n    height: 48px;\r\n    left: 50%;\r\n    width: 48px;\r\n    transform: translate(-50%, -50%);\r\n}\r\n.tb-default .mat-mdc-icon-button {\r\n    --mat-mdc-button-persistent-ripple-color: #000;\r\n    --mat-mdc-button-ripple-color: rgba(0, 0, 0, .1);\r\n}\r\n\r\n.tb-default .mat-toolbar.mat-primary {\r\n    background: #0094d0;\r\n    color: var(--tb-primary-contrast-500);\r\n}\r\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet deviceProfileService = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\r\n\r\nlet deviceProfiles;\r\n\r\ndeviceProfileService.getDeviceProfileNames(false).subscribe(response => {\r\n    deviceProfiles = response;\r\n    console.log(\"Device Profiles:\", deviceProfiles);\r\n    openAddEntityDialog();\r\n});\r\n\r\nfunction openAddEntityDialog() {\r\n    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction getSelectedCustomerName() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    try {\r\n        return stateParams.selectedCustomer.entityName;\r\n    } catch (error) {\r\n        return stateParams.entityName || '';\r\n    }\r\n}\r\n\r\nfunction getSelectedLocationName() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    try {\r\n        // Angenommen stateParams.selectedLocation ist ein Objekt mit property \"entityName\"\r\n        return stateParams.selectedLocation;\r\n    } catch (error) {\r\n        const hasAssetEntity = stateParams.entityId && stateParams.entityId.entityType === 'ASSET';\r\n        if (hasAssetEntity) {\r\n            return { entityName: stateParams.entityName || '' };\r\n        } else {\r\n            return { entityName: '' };\r\n        }\r\n    }\r\n}\r\n\r\nfunction generateRandomPassword() {\r\n    const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';\r\n    let password = '';\r\n    for (let i = 0; i < 20; i++) {\r\n        password += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return password;\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n    let vm = instance;\r\n    vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\r\n    vm.deviceProfiles = deviceProfiles;\r\n    vm.selectedDeviceProfile = null;\r\n    vm.deviceProfileType = null;\r\n    vm.hidePassword = true;\r\n\r\n    const fb = vm.fb;\r\n    const validators = vm.validators;\r\n\r\n    vm.editEntityFormGroup = fb.group({\r\n        general: fb.group({\r\n            type: [null, [validators.required]],\r\n            entityName: [getSelectedLocationName().entityName + \"_\", [validators.required]],\r\n            entityLabel: [getSelectedLocationName().entityLabel || ''],\r\n            attributes: fb.group({\r\n                displayName: [''],\r\n                customer: [getSelectedCustomerName(), [validators.required]],\r\n                location: [getSelectedLocationName().entityName, [validators.required]],\r\n                inactivityTimeout: ['60', [validators.required]],\r\n                forwardTo: ['Energy Expert API', [validators.required]],\r\n                devEui: [null],\r\n                appKey: [null],\r\n                gatewayID: [null]\r\n            }),\r\n            activateSIM: [false],\r\n            connectivity: fb.group({\r\n                ICCID: [null],\r\n                carrierSIM: [null],\r\n                statusSIM: [null]\r\n            }),\r\n            activateAPI: [false],\r\n            api: fb.group({\r\n                apiUrl: [null],\r\n                apiUser: [null],\r\n                apiPassword: [null],\r\n                apiToken: [null],\r\n                apiSiteId: [null],\r\n                apiSerial: [null]\r\n            })\r\n        }),\r\n        credentials: fb.group({\r\n            credentialsType: ['MQTT_BASIC'],\r\n            clientId: [getSelectedLocationName().entityName + \"_\", [validators.required]],\r\n            userName: ['pke', [validators.required]],\r\n            password: [generateRandomPassword(), [validators.required]]\r\n        }),\r\n        relations: fb.array([])\r\n    });\r\n\r\n    vm.updateDeviceProfile = function() {\r\n        const selectedDeviceProfileId = vm.editEntityFormGroup.get('general').get('type').value.id.id;\r\n/*        console.log(\"Selected Device Profile ID:\", selectedDeviceProfileId);*/\r\n\r\n        const selectedProfile = vm.deviceProfiles.find(profile => profile.id.id === selectedDeviceProfileId);\r\n        if (selectedProfile) {\r\n            vm.selectedDeviceProfile = selectedProfile;\r\n        }\r\n\r\n        deviceProfileService.getDeviceProfile(selectedDeviceProfileId).subscribe(profile => {\r\n/*            console.log(\"Device Profile Info:\", profile);*/\r\n            parseDeviceProfileDescription(profile.description);\r\n            applyValidatorsForDeviceProfile();\r\n        });\r\n    };\r\n\r\n    function parseDeviceProfileDescription(description) {\r\n        let parsedDescription = {};\r\n        if (description && typeof description === 'string' &&\r\n            (description.trim().startsWith('{') || description.trim().startsWith('['))) {\r\n            try {\r\n                parsedDescription = JSON.parse(description);\r\n            } catch (e) {\r\n                console.error(\"Error parsing device profile description:\", e);\r\n                parsedDescription = {};\r\n            }\r\n        }\r\n\r\n        let defaultInfo = parsedDescription.General || {};\r\n        vm.deviceProfileType = defaultInfo.deviceProfileType || null;\r\n/*        console.log(\"Parsed Device Profile Type:\", vm.deviceProfileType);\r\n        console.log('General valid:', vm.editEntityFormGroup.get('general').valid);\r\n        console.log('General errors:', vm.editEntityFormGroup.get('general').errors);\r\n        console.log('General value:', vm.editEntityFormGroup.get('general').value);*/\r\n    }\r\n\r\n    function applyValidatorsForDeviceProfile() {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        const devEuiControl = generalGroup.get('devEui');\r\n        const appKeyControl = generalGroup.get('appKey');\r\n        const gatewayIDControl = generalGroup.get('gatewayID');\r\n\r\n        // Alle Validatoren entfernen\r\n        devEuiControl.clearValidators();\r\n        appKeyControl.clearValidators();\r\n        gatewayIDControl.clearValidators();\r\n\r\n        const selectedType = generalGroup.get('type').value;\r\n        const profileName = selectedType?.name || '';\r\n\r\n        // Logik je nach deviceProfileType\r\n        if (vm.deviceProfileType === 'LoRaWAN') {\r\n            // LoRaWAN: devEui & appKey required\r\n            devEuiControl.setValidators([validators.required]);\r\n            appKeyControl.setValidators([validators.required]);\r\n        } else if (vm.deviceProfileType === 'Gateway') {\r\n            // Wenn Gateway UND name === \"Gateway\", dann gatewayID required\r\n            if (profileName === 'Gateway') {\r\n                gatewayIDControl.setValidators([validators.required, validators.pattern('[a-zA-Z0-9]{16}')]);\r\n            } else {\r\n                // Gateway aber nicht \"Gateway\" -> keine Validatoren fr gatewayID\r\n            }\r\n\r\n            // Credentials fr Gateway deaktivieren\r\n            vm.editEntityFormGroup.get('credentials').disable();\r\n        } else {\r\n            // Weder LoRaWAN noch Gateway -> Credentials aktivieren\r\n            vm.editEntityFormGroup.get('credentials').enable();\r\n        }\r\n\r\n        // Validatoren aktualisieren\r\n        devEuiControl.updateValueAndValidity();\r\n        appKeyControl.updateValueAndValidity();\r\n        gatewayIDControl.updateValueAndValidity();\r\n    }\r\n\r\n    // Dynamische SIM-Validatoren\r\n    vm.editEntityFormGroup.get('general').get('activateSIM').valueChanges.subscribe(value => {\r\n        const connectivity = vm.editEntityFormGroup.get('general').get('connectivity');\r\n        if (value) {\r\n            connectivity.get('ICCID').setValidators([validators.required]);\r\n            connectivity.get('carrierSIM').setValidators([validators.required]);\r\n            connectivity.get('statusSIM').setValidators([validators.required]);\r\n        } else {\r\n            connectivity.get('ICCID').clearValidators();\r\n            connectivity.get('carrierSIM').clearValidators();\r\n            connectivity.get('statusSIM').clearValidators();\r\n        }\r\n        connectivity.get('ICCID').updateValueAndValidity();\r\n        connectivity.get('carrierSIM').updateValueAndValidity();\r\n        connectivity.get('statusSIM').updateValueAndValidity();\r\n    });\r\n\r\n    // Dynamische API-Validatoren\r\n    vm.editEntityFormGroup.get('general').get('activateAPI').valueChanges.subscribe(value => {\r\n        const apiGroup = vm.editEntityFormGroup.get('general').get('api');\r\n        const selectedType = vm.editEntityFormGroup.get('general').get('type').value;\r\n        \r\n/*        if (value) {\r\n            apiGroup.get('apiUrl').setValidators([validators.required]);\r\n        } else {\r\n            apiGroup.get('apiUrl').clearValidators();\r\n        }\r\n        apiGroup.get('apiUrl').updateValueAndValidity();*/\r\n        if (value && selectedType && selectedType.name === 'Fronius Solar Web') {\r\n            apiGroup.patchValue({\r\n                apiUrl: 'https://api.solarweb.com/swqapi',\r\n                createPVSystem: true // Checkbox wird sichtbar\r\n            });\r\n        } else {\r\n            apiGroup.patchValue({\r\n                apiUrl: null,\r\n                createPVSystem: false // Checkbox wird versteckt\r\n            });\r\n        }\r\n        \r\n        apiGroup.get('apiUrl').updateValueAndValidity();\r\n        apiGroup.get('apiSiteId').updateValueAndValidity();\r\n    });\r\n\r\n    // entityName ndert clientId\r\n    vm.editEntityFormGroup.get('general').get('entityName').valueChanges.subscribe(value => {\r\n        vm.editEntityFormGroup.get('credentials').patchValue({\r\n            clientId: value\r\n        });\r\n    });\r\n    \r\n    // LoRaWAN Validatoren\r\n    if (vm.deviceProfileType === 'LoRaWAN') {\r\n        vm.editEntityFormGroup.get('general').get('devEui')\r\n            .setValidators([validators.required, validators.pattern('^[0-9A-Fa-f]{16}$')]);\r\n        vm.editEntityFormGroup.get('general').get('appKey')\r\n            .setValidators([validators.required, validators.pattern('^[0-9A-Fa-f]{32}$')]);\r\n    }\r\n\r\n    vm.cancel = function() {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function() {\r\n        vm.editEntityFormGroup.markAsPristine();\r\n        saveEntityObservable().subscribe(entity => {\r\n            widgetContext.rxjs.forkJoin([\r\n                saveAttributes(entity.id),\r\n                saveCredentials(entity.id),\r\n                saveRelations(entity.id)\r\n            ]).subscribe(() => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            });\r\n        });\r\n    };\r\n\r\n    vm.copyToClipboard = function(event, controlName) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const value = vm.editEntityFormGroup.get(controlName.split('.')).value;\r\n        navigator.clipboard.writeText(value).then(() => {\r\n            widgetContext.showSuccessToast('Copied to clipboard!', 2000, 'top', 'center');\r\n        }).catch(err => {\r\n            widgetContext.showErrorToast('Failed to copy to clipboard.', 2000, 'top', 'center');\r\n        });\r\n    };\r\n\r\n    vm.togglePasswordVisibility = function() {\r\n        vm.hidePassword = !vm.hidePassword;\r\n    };\r\n\r\n    function saveEntityObservable() {\r\n        const gVal = vm.editEntityFormGroup.get('general').value;\r\n        let entity = {\r\n            name: gVal.entityName,\r\n            type: gVal.type.name,\r\n            label: gVal.entityLabel\r\n        };\r\n        return deviceService.saveDevice(entity);\r\n    }\r\n\r\n    function saveAttributes(entityId) {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        const attributes = generalGroup.get('attributes').value;\r\n        attributes.inactivityTimeout = parseInt(attributes.inactivityTimeout, 10) * 60000;\r\n        attributes.state = \"normal\";\r\n    \r\n        const generalValue = generalGroup.value;\r\n    \r\n        // Hilfsfunktion zum Hinzufgen von Attributen, nur wenn sie nicht null sind\r\n        function pushAttr(array, key, value) {\r\n            if (value !== null) {\r\n                array.push({ key: key, value: value });\r\n            }\r\n        }\r\n    \r\n        let attributesArray = [];\r\n    \r\n        // Standard-Attribute aus attributes-Gruppe\r\n        for (let key in attributes) {\r\n            if (attributes[key] !== null) {\r\n                attributesArray.push({ key: key, value: attributes[key] });\r\n            }\r\n        }\r\n    \r\n        // LoRaWAN- und Gateway-spezifische Felder\r\n        pushAttr(attributesArray, 'devEui', generalValue.devEui);\r\n        pushAttr(attributesArray, 'appKey', generalValue.appKey);\r\n        pushAttr(attributesArray, 'gatewayID', generalValue.gatewayID);\r\n    \r\n        // SIM-Felder, falls aktiviert\r\n        if (generalValue.activateSIM) {\r\n            const connectivityValues = generalGroup.get('connectivity').value;\r\n            pushAttr(attributesArray, 'ICCID', connectivityValues.ICCID);\r\n            pushAttr(attributesArray, 'carrierSIM', connectivityValues.carrierSIM);\r\n            pushAttr(attributesArray, 'statusSIM', connectivityValues.statusSIM);\r\n        }\r\n    \r\n        // API-Felder, falls aktiviert\r\n        if (generalValue.activateAPI) {\r\n            const apiValues = generalGroup.get('api').value;\r\n            pushAttr(attributesArray, 'apiUrl', apiValues.apiUrl);\r\n            pushAttr(attributesArray, 'apiUser', apiValues.apiUser);\r\n            pushAttr(attributesArray, 'apiPassword', apiValues.apiPassword);\r\n            pushAttr(attributesArray, 'apiToken', apiValues.apiToken);\r\n            pushAttr(attributesArray, 'apiSiteId', apiValues.apiSiteId);\r\n            pushAttr(attributesArray, 'apiSerial', apiValues.apiSerial);\r\n            \r\n            const selectedType = generalGroup.get('type').value;\r\n            if (selectedType && selectedType.name === 'Fronius Solar Web') {\r\n                pushAttr(attributesArray, 'froniusApiCreate', 'system');\r\n            }\r\n        }\r\n    \r\n        if (attributesArray.length > 0) {\r\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n        }\r\n    \r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n\r\n/*    function saveCredentials(entityId) {\r\n        if (vm.deviceProfileType === 'Gateway') {\r\n            // Fr Gateways keine Credentials aktualisieren\r\n            return widgetContext.rxjs.of([]);\r\n        }\r\n\r\n        return deviceService.getDeviceCredentials(entityId).pipe(\r\n            widgetContext.rxjs.mergeMap(existingCredentials => {\r\n                const cVal = vm.editEntityFormGroup.get('credentials').value;\r\n                existingCredentials.credentialsValue = JSON.stringify({\r\n                    clientId: cVal.clientId,\r\n                    userName: cVal.userName,\r\n                    password: cVal.password\r\n                });\r\n                return deviceService.saveDeviceCredentials(existingCredentials);\r\n            }),\r\n            widgetContext.rxjs.catchError(error => {\r\n                widgetContext.showErrorToast(`Failed to update credentials: ${error.message}`, 4000, 'top', 'center');\r\n                return widgetContext.rxjs.throwError(error);\r\n            })\r\n        );\r\n    }\r\n*/\r\n\r\n    function saveCredentials(entityId) {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        const selectedType = generalGroup.get('type').value;\r\n        const profileName = selectedType?.name || '';\r\n    \r\n        // Wenn Gateway und name !== 'Gateway', dann Credentials speichern\r\n        if (vm.deviceProfileType === 'Gateway' && profileName !== 'Gateway') {\r\n            return deviceService.getDeviceCredentials(entityId.id).pipe(\r\n                widgetContext.rxjs.mergeMap(existingCredentials => {\r\n                    let credentials = vm.editEntityFormGroup.get('credentials').value;\r\n                    let deviceCredentials = {\r\n                        id: existingCredentials.id,\r\n                        deviceId: existingCredentials.deviceId,\r\n                        credentialsType: credentials.credentialsType,\r\n                        credentialsValue: JSON.stringify({\r\n                            clientId: credentials.clientId,\r\n                            userName: credentials.userName,\r\n                            password: credentials.password\r\n                        })\r\n                    };\r\n                    return deviceService.saveDeviceCredentials(deviceCredentials);\r\n                }),\r\n                widgetContext.rxjs.catchError(error => {\r\n                    widgetContext.showErrorToast(`Failed to update credentials: ${error.message}`, 4000, 'top', 'center');\r\n                    return widgetContext.rxjs.throwError(error);\r\n                })\r\n            );\r\n        } else {\r\n            return widgetContext.rxjs.of([]);\r\n        }\r\n    }\r\n\r\n    function saveRelations(entityId) {\r\n        let relations = vm.editEntityFormGroup.get('relations').value;\r\n        if (!relations || relations.length === 0) {\r\n            return widgetContext.rxjs.of([]);\r\n        }\r\n        let tasks = [];\r\n        for (let i = 0; i < relations.length; i++) {\r\n            let relation = {\r\n                type: relations[i].relationType,\r\n                typeGroup: 'COMMON'\r\n            };\r\n            if (relations[i].direction === 'FROM') {\r\n                relation.to = relations[i].relatedEntity;\r\n                relation.from = entityId;\r\n            } else {\r\n                relation.to = entityId;\r\n                relation.from = relations[i].relatedEntity;\r\n            }\r\n            tasks.push(entityRelationService.saveRelation(relation));\r\n        }\r\n        if (tasks.length > 0) {\r\n            return widgetContext.rxjs.forkJoin(tasks);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f3db8f9c-e21e-ecb5-c6a8-cb1c6f830a25"
              },
              {
                "name": "Test",
                "buttonType": "icon",
                "icon": "more_horiz",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": "const $injector               = widgetContext.$scope.$injector;\r\n  const customDialog            = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\n  const assetService            = $injector.get(widgetContext.servicesMap.get('assetService'));\r\n  const deviceService           = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\n  const attributeService        = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n  const entityRelationService   = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\n  const deviceProfileService    = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\r\n  const entityGroupService      = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\n  let   deviceProfiles;\r\nconst addDeviceHtmlTemplate = '<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form max-w-3xl mx-auto\" style=\"width:575px;\">\\n' +\r\n' <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\\n' +\r\n'    <h2 class=\"text-lg font-semibold\">{{ \\'custom.devices-table.add-device.titel\\' | translate }}</h2>\\n' +\r\n'    <span class=\"flex-1\"></span>\\n' +\r\n'    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\\n' +\r\n'      <mat-icon class=\"material-icons\">close</mat-icon>\\n' +\r\n'    </button>\\n' +\r\n'  </mat-toolbar>\\n' +\r\n'  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\\n' +\r\n'  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\\n' +\r\n'  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\\n' +\r\n'    <mat-stepper *ngIf=\"editEntityFormGroup\" #stepper [linear]=\"true\" animationDuration=\"500ms\" style=\"flex-grow: 1;\">\\n' +\r\n'      \\n' +\r\n'      <mat-step [stepControl]=\"editEntityFormGroup.get(\\'general\\')\">\\n' +\r\n'        <ng-template matStepLabel>General</ng-template>\\n' +\r\n'        <div class=\"flex flex-col items-start justify-stretch flex-grow\" [formGroup]=\"editEntityFormGroup.get(\\'general\\')\">\\n' +\r\n'            <div class=\"w-full\">\\n' +\r\n'                <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'                  <mat-label>{{ \\'custom.devices-table.type\\'| translate }}</mat-label>\\n' +\r\n'                  <input type=\"text\"\\n' +\r\n'                              matInput\\n' +\r\n'                              formControlName=\"type\"\\n' +\r\n'                              [matAutocomplete]=\"auto\"\\n' +\r\n'                              (keyup)=\"filterProfiles()\"\\n' +\r\n'                              (focus)=\"resetFilter()\"\\n' +\r\n'                              required>\\n' +\r\n'                  <mat-autocomplete #auto=\"matAutocomplete\" [displayWith]=\"displayProfile\">\\n' +\r\n'                    <mat-option *ngFor=\"let profile of filteredProfiles\" [value]=\"profile\">\\n' +\r\n'                      {{ profile.name }}\\n' +\r\n'                    </mat-option>\\n' +\r\n'                  </mat-autocomplete>\\n' +\r\n'                  <mat-error *ngIf=\"editEntityFormGroup.get(\\'general.type\\').hasError(\\'required\\')\">\\n' +\r\n'                    Device profile is required.\\n' +\r\n'                  </mat-error>\\n' +\r\n'                  <mat-error *ngIf=\"editEntityFormGroup.get(\\'general.type\\').hasError(\\'invalidDevice\\')\">\\n' +\r\n'                    Please select a valid device profile from the list.\\n' +\r\n'                  </mat-error>\\n' +\r\n'                </mat-form-field>\\n' +\r\n'              \\n' +\r\n'              <div>\\n' +\r\n'                <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.name\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"entityName\" required>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'entityName\\').hasError(\\'required\\')\">\\n' +\r\n'                      Entity name is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.label\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"entityLabel\">\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'                <div formGroupName=\"attributes\" fxLayout=\"column\">\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.display-name\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"displayName\">\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.customer\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"customer\" required>\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'customer\\').hasError(\\'required\\')\">\\n' +\r\n'                        Customer is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.location\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"location\">\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'location\\').hasError(\\'required\\')\">\\n' +\r\n'                        Location is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.inactivityTimeout\\'| translate }}</mat-label>\\n' +\r\n'                      <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'inactivityTimeout\\').hasError(\\'required\\')\">\\n' +\r\n'                        Inactivity Timeout is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.forwardTo\\'| translate }}</mat-label>\\n' +\r\n'                      <mat-select formControlName=\"forwardTo\" required>\\n' +\r\n'                        <mat-option [value]=\"\\'Energy Expert API\\'\">Energy Expert API</mat-option>\\n' +\r\n'                        <mat-option [value]=\"\\'Energy Expert Forward\\'\">Energy Expert Forward</mat-option>\\n' +\r\n'                        <mat-option [value]=\"\\'Energy Expert\\'\">Energy Expert</mat-option>\\n' +\r\n'                        <mat-option [value]=\"\\'None\\'\">None</mat-option>\\n' +\r\n'                      </mat-select>\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'forwardTo\\').hasError(\\'required\\')\">\\n' +\r\n'                        Forward To is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'              \\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'LoRaWAN\\'\">\\n' +\r\n'                <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\" [formGroupName]=\"\\'attributes\\'\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.devEui\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"devEui\" required pattern=\"^[0-9A-Fa-f]{16}$\">\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'devEui\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      DevEUI is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'devEui\\')?.hasError(\\'pattern\\')\">\\n' +\r\n'                      DevEUI must be 16 hex characters (0-9, A-F).\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\" [formGroupName]=\"\\'attributes\\'\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.appKey\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"appKey\" required pattern=\"^[0-9A-Fa-f]{32}$\">\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'appKey\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      App Key is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'appKey\\')?.hasError(\\'pattern\\')\">\\n' +\r\n'                      App Key must be 32 hex characters (0-9, A-F).\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'              \\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'Gateway\\' && editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Gateway\\'\">\\n' +\r\n'                <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.gatewayId\\'| translate}}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"gatewayID\" required pattern=\"[a-zA-Z0-9]{16}\">\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'gatewayID\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      Gateway ID is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'              \\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'Gateway\\'\">\\n' +\r\n'                <mat-checkbox formControlName=\"activateSIM\" style=\"margin-top:10px;\">{{\\'custom.devices-table.add-device.activateSim\\'| translate }}</mat-checkbox>\\n' +\r\n'                <div *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'activateSIM\\').value\" formGroupName=\"connectivity\" style=\"margin-top:10px;\">\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.add-device.iccid\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"ICCID\" required/>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'connectivity\\').get(\\'ICCID\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      ICCID is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field class=\"w-1/2\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.add-device.carrier\\'| translate }}</mat-label>\\n' +\r\n'                      <mat-select formControlName=\"carrierSIM\" required>\\n' +\r\n'                        <mat-option value=\"tech+\">Tech+</mat-option>\\n' +\r\n'                        <mat-option value=\"link+\">Link+</mat-option>\\n' +\r\n'                      </mat-select>\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'connectivity\\').get(\\'carrierSIM\\')?.hasError(\\'required\\')\">\\n' +\r\n'                        Carrier is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                    <mat-form-field class=\"w-1/2\">\\n' +\r\n'                      <mat-label>{{\\'custom.devices-table.add-device.simStatus\\'| translate }}</mat-label>\\n' +\r\n'                      <mat-select formControlName=\"statusSIM\" required>\\n' +\r\n'                        <mat-option value=\"ACTIVATED\">{{ \\'custom.devices-table.add-device.simStatus-activated\\'| translate }}</mat-option>\\n' +\r\n'                        <mat-option value=\"DEACTIVATED\">{{ \\'custom.devices-table.add-device.simStatus-deactivated\\'| translate }}</mat-option>\\n' +\r\n'                      </mat-select>\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'connectivity\\').get(\\'statusSIM\\')?.hasError(\\'required\\')\">\\n' +\r\n'                        Status is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'              \\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'API\\'\">\\n' +\r\n'                  <div class=\"flex flex-row justify-between items-center flex-1\" style=\"margin-top: 5px; margin-bottom: 15px;\">\\n' +\r\n'                <mat-checkbox formControlName=\"activateAPI\" style=\"flex: 0 0 50%;\">{{ \\'custom.devices-table.add-device.activateApi\\'| translate }}</mat-checkbox>\\n' +\r\n'                <mat-checkbox formControlName=\"addInverters\" style=\"flex: 0 0 50%;\">{{ \\'custom.devices-table.add-device.addInverters\\'| translate }}</mat-checkbox>\\n' +\r\n'                </div>\\n' +\r\n'                <div *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'activateAPI\\').value\" formGroupName=\"api\" style=\"margin-top:10px;\">\\n' +\r\n'                  \\n' +\r\n'                  <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.add-device.apiUrl\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"apiUrl\" required/>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').get(\\'apiUrl\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      API URL is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  \\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <ng-container *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').contains(\\'apiUser\\')\">\\n' +\r\n'                      <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                        <mat-label>{{\\'custom.devices-table.add-device.apiUser\\'| translate }}</mat-label>\\n' +\r\n'                        <input matInput formControlName=\"apiUser\"/>\\n' +\r\n'                      </mat-form-field>\\n' +\r\n'                    </ng-container>\\n' +\r\n'                    <ng-container *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').contains(\\'apiPassword\\')\">\\n' +\r\n'                      <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                        <mat-label>{{\\'custom.devices-table.add-device.apiPwd\\'| translate }}</mat-label>\\n' +\r\n'                        <input matInput formControlName=\"apiPassword\" password/>\\n' +\r\n'                      </mat-form-field>\\n' +\r\n'                    </ng-container>\\n' +\r\n'                  </div>\\n' +\r\n'                  \\n' +\r\n'                  <ng-container *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').contains(\\'apiToken\\')\">\\n' +\r\n'                    <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                      <mat-label>{{\\'custom.devices-table.add-device.apiToken\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"apiToken\"/>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </ng-container>\\n' +\r\n'                  \\n' +\r\n'                  <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.add-device.apiSite\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"apiSiteId\" required/>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'               <fieldset class=\"fieldset\" *ngIf=\"datapoints?.length\" style=\"margin-bottom:15px;\">\\n' +\r\n'                 <legend>{{\\'custom.devices-table.add-device.activateDatapoints\\'| translate }}</legend>\\n' +\r\n'                  <div formGroupName=\"datapoints\"\\n' +\r\n'                       class=\"flex flex-row flex-wrap gap-4\">\\n' +\r\n'                    <mat-checkbox\\n' +\r\n'                      *ngFor=\"let dp of datapoints\"\\n' +\r\n'                      class=\"flex-none basis-[45%]\"\\n' +\r\n'                      [formControlName]=\"dp.key\">\\n' +\r\n'                      {{ dp.key }}\\n' +\r\n'                    </mat-checkbox>\\n' +\r\n'                  </div>\\n' +\r\n'                </fieldset>\\n' +\r\n'            </div>\\n' +\r\n'        </div>\\n' +\r\n'        \\n' +\r\n'        \\n' +\r\n'        <div class=\"flex flex-row gap-2 justify-end items-center\" style=\"margin-top: auto;\">\\n' +\r\n'          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ \\'action.cancel\\' | translate }}</button>\\n' +\r\n'          <button mat-button mat-raised-button color=\"primary\" type=\"button\"\\n' +\r\n'          *ngIf=\"(editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Fronius Solar Web\\' ||\\n' +\r\n'                     editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Huawei Fusion Solar\\') &&\\n' +\r\n'                    editEntityFormGroup.get(\\'general\\').get(\\'addInverters\\').value\"\\n' +\r\n'          [disabled]=\"!editEntityFormGroup.get(\\'general\\').get(\\'api\\').get(\\'apiSiteId\\').value\"\\n' +\r\n'          (click)=\"stepper.next()\">\\n' +\r\n'          {{\\'action.next\\' | translate }}\\n' +\r\n'        </button>\\n' +\r\n'          \\n' +\r\n'          <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\n' +\r\n'            *ngIf=\"!((editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Fronius Solar Web\\' ||\\n' +\r\n'                       editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Huawei Fusion Solar\\') &&\\n' +\r\n'                     editEntityFormGroup.get(\\'general\\').get(\\'addInverters\\').value)\"\\n' +\r\n'            [disabled]=\"editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\\n' +\r\n'            {{\\'custom.devices-table.add-device.save\\' | translate }}\\n' +\r\n'          </button>\\n' +\r\n'        </div>\\n' +\r\n'      </mat-step>\\n' +\r\n'        <mat-step label=\"Inverters\"\\n' +\r\n'          *ngIf=\"(editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Fronius Solar Web\\' ||\\n' +\r\n'        editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Huawei Fusion Solar\\') &&\\n' +\r\n'        editEntityFormGroup.get(\\'general\\').get(\\'addInverters\\').value\">\\n' +\r\n'          <ng-template matStepLabel>Inverters</ng-template>\\n' +\r\n'          <div formArrayName=\"inverters\">\\n' +\r\n'            \\n' +\r\n'            <div class=\"flex flex-row gap-2\" style=\"margin-bottom: 10px;\">\\n' +\r\n'              <button mat-stroked-button type=\"button\" (click)=\"addInverter()\"\\n' +\r\n'                            style=\"flex: 1; background-color: #f0f0f0; color: black;\">\\n' +\r\n'                {{\\'custom.devices-table.add-device.addInverters\\'| translate }}\\n' +\r\n'              </button>\\n' +\r\n'              <button mat-stroked-button type=\"button\" (click)=\"removeInverter()\"\\n' +\r\n'                            style=\"flex: 1; background-color: #f0f0f0; color: black;\">\\n' +\r\n'                {{\\'custom.devices-table.add-device.removeInverter\\'| translate }}\\n' +\r\n'              </button>\\n' +\r\n'            </div>\\n' +\r\n'            <fieldset class=\"fieldset\" style=\"margin-bottom: 16px;\" *ngIf=\"editEntityFormGroup.get(\\'inverters\\').controls.length > 0\">\\n' +\r\n'              <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'                <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                  <mat-icon>info</mat-icon>\\n' +\r\n'                </div>\\n' +\r\n'                <div class=\"flex-1\">\\n' +\r\n'                  <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                    For each inverter, at least one value must be provided for either apiSerial or deviceId.<br>All provided values must be unique.\\n' +\r\n'                  </p>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'            </fieldset>\\n' +\r\n'            <fieldset class=\"fieldset\" style=\"margin-bottom: 16px; background-color: #FFE5E5;\" *ngIf=\"editEntityFormGroup.errors?.duplicateNames\">\\n' +\r\n'              <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'                <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                  <mat-icon>error</mat-icon>\\n' +\r\n'                </div>\\n' +\r\n'                <div class=\"flex-1\">\\n' +\r\n'                  <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                    Duplicate names were detected. Please check again!\\n' +\r\n'                  </p>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'            </fieldset>\\n' +\r\n'            <fieldset class=\"fieldset\" style=\"margin-bottom: 16px; background-color: #FFE5E5;\" *ngIf=\"editEntityFormGroup.errors?.duplicateApiSerial\">\\n' +\r\n'              <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'                <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                  <mat-icon>error</mat-icon>\\n' +\r\n'                </div>\\n' +\r\n'                <div class=\"flex-1\">\\n' +\r\n'                  <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                    Duplicate apiSerial values were detected. Please check again!\\n' +\r\n'                  </p>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'            </fieldset>\\n' +\r\n'            <fieldset class=\"fieldset\" style=\"margin-bottom: 16px; background-color: #FFE5E5;\" *ngIf=\"editEntityFormGroup.errors?.duplicateDeviceId\">\\n' +\r\n'              <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'                <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                  <mat-icon>error</mat-icon>\\n' +\r\n'                </div>\\n' +\r\n'                <div class=\"flex-1\">\\n' +\r\n'                  <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                    Duplicate deviceId values were detected. Please check again!\\n' +\r\n'                  </p>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'            </fieldset>\\n' +\r\n'            \\n' +\r\n'            <div *ngFor=\"let inverter of editEntityFormGroup.get(\\'inverters\\').controls; let i = index\" [formGroupName]=\"i\">\\n' +\r\n'              <fieldset class=\"fieldset\">\\n' +\r\n'                  <legend>Inverter {{ i + 1 }}</legend>\\n' +\r\n'                  \\n' +\r\n'                  <div class=\"flex flex-row gap-2\">\\n' +\r\n'                    <mat-form-field class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.name\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"name\" required>\\n' +\r\n'                      <mat-error *ngIf=\"inverter.get(\\'name\\').hasError(\\'required\\')\">Name is required.</mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                    <mat-form-field class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.label\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"label\">\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  \\n' +\r\n'                  <div class=\"flex flex-row gap-2\">\\n' +\r\n'                    <mat-form-field class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.display-name\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"displayName\">\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                    <mat-form-field class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.add-device.apiSite\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"apiSiteId\" required>\\n' +\r\n'                      <mat-error *ngIf=\"inverter.get(\\'apiSiteId\\').hasError(\\'required\\')\">API Site Id is required.</mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  \\n' +\r\n'                  <div class=\"flex flex-row gap-2\">\\n' +\r\n'                    <mat-form-field class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.add-device.apiSerial\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"apiSerial\">\\n' +\r\n'                      <mat-error *ngIf=\"inverter.get(\\'apiSerial\\').hasError(\\'required\\')\">\\n' +\r\n'                        Value for either API Serial or Device Id is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                    <mat-form-field class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.add-device.deviceId\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"deviceId\">\\n' +\r\n'                      <mat-error *ngIf=\"inverter.get(\\'deviceId\\').hasError(\\'required\\')\">\\n' +\r\n'                        Either API Serial or Device Id is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                </fieldset>\\n' +\r\n'            </div>\\n' +\r\n'          </div>\\n' +\r\n'          \\n' +\r\n'          <div class=\"flex flex-row gap-2 justify-end items-center\" style=\"margin-top: auto;\">\\n' +\r\n'            <button mat-button color=\"primary\" type=\"button\" (click)=\"stepper.previous()\">{{ \\'action.back\\' | translate }}</button>\\n' +\r\n'            <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\n' +\r\n'                      [disabled]=\"!areInvertersValid() ||\\n' +\r\n'              editEntityFormGroup.errors?.duplicateNames ||\\n' +\r\n'              editEntityFormGroup.errors?.duplicateApiSerial ||\\n' +\r\n'              editEntityFormGroup.errors?.duplicateDeviceId\">\\n' +\r\n'              {{ \\'custom.devices-table.add-device.save\\'| translate }}\\n' +\r\n'            </button>\\n' +\r\n'          </div>\\n' +\r\n'        </mat-step>\\n' +\r\n'      \\n' +\r\n'      <mat-step [stepControl]=\"editEntityFormGroup.get(\\'credentials\\')\"\\n' +\r\n'                *ngIf=\"deviceProfileType === \\'Gateway\\' && editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name !== \\'Gateway\\'\">\\n' +\r\n'        <ng-template matStepLabel>{{ \\'custom.devices-table.add-device.credentials\\'| translate }}</ng-template>\\n' +\r\n'        <div class=\"flex flex-col items-start justify-stretch\" style=\"margin-top: 30px;\" [formGroup]=\"editEntityFormGroup.get(\\'credentials\\')\">\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.credentialsType\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput formControlName=\"credentialsType\" readonly>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.clientId\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput formControlName=\"clientId\" required>\\n' +\r\n'            <button\\n' +\r\n'              mat-icon-button\\n' +\r\n'              type=\"button\"\\n' +\r\n'              matSuffix\\n' +\r\n'              [matTooltip]=\"\\'custom.devices-table.add-device.copyClientId\\' | translate\"\\n' +\r\n'              (click)=\"copyToClipboard($event, \\'credentials.clientId\\')\">\\n' +\r\n'              <mat-icon>content_copy</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <mat-error *ngIf=\"editEntityFormGroup.get(\\'credentials\\').get(\\'clientId\\')?.hasError(\\'required\\')\">\\n' +\r\n'              Client ID is required.\\n' +\r\n'            </mat-error>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.userName\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput formControlName=\"userName\" required>\\n' +\r\n'            <button\\n' +\r\n'              mat-icon-button\\n' +\r\n'              type=\"button\"\\n' +\r\n'              matSuffix\\n' +\r\n'              [matTooltip]=\"\\'custom.devices-table.add-device.copyUserName\\' | translate\"\\n' +\r\n'              (click)=\"copyToClipboard($event, \\'credentials.userName\\')\">\\n' +\r\n'              <mat-icon>content_copy</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <mat-error *ngIf=\"editEntityFormGroup.get(\\'credentials\\').get(\\'userName\\')?.hasError(\\'required\\')\">\\n' +\r\n'              User Name is required.\\n' +\r\n'            </mat-error>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.pwd\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput [type]=\"hidePassword ? \\'password\\' : \\'text\\'\" formControlName=\"password\" required>\\n' +\r\n'            <button mat-icon-button type=\"button\" matSuffix matTooltip=\"{{ hidePassword ? ( \\'custom.devices-table.add-device.showPwd\\'| translate) : (\\'custom.devices-table.add-device.hidePwd\\' | translate) }}\" (click)=\"togglePasswordVisibility()\">\\n' +\r\n'              <mat-icon>{{ hidePassword ? \\'visibility\\' : \\'visibility_off\\' }}</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <button mat-icon-button type=\"button\" matSuffix\\n' +\r\n'              [matTooltip]=\"\\'custom.devices-table.add-device.copyPwd\\' | translate\"\\n' +\r\n'              (click)=\"copyToClipboard($event, \\'credentials.password\\')\">\\n' +\r\n'              <mat-icon>content_copy</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <mat-error *ngIf=\"editEntityFormGroup.get(\\'credentials\\').get(\\'password\\')?.hasError(\\'required\\')\">\\n' +\r\n'              Password is required.\\n' +\r\n'            </mat-error>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'        </div>\\n' +\r\n'        <div class=\"flex flex-row gap-2 justify-end items-center\" style=\"margin-top: auto;\">\\n' +\r\n'          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ \\'action.cancel\\' | translate }}</button>\\n' +\r\n'          <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\n' +\r\n'                    [disabled]=\"editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\\n' +\r\n'            {{ \\'custom.devices-table.add-device.save\\'| translate }}\\n' +\r\n'          </button>\\n' +\r\n'        </div>\\n' +\r\n'      </mat-step>\\n' +\r\n'    </mat-stepper>\\n' +\r\n'  </div>\\n' +\r\n'</form>\\n';\r\nconst addDeviceCSS =\r\n  '.device-item {\\\\n' +\r\n  '    line-height: 24px;\\\\n' +\r\n  '    width: 100%;\\\\n' +\r\n  '    padding-top: 8px;\\\\n' +\r\n  '    padding-bottom: 8px;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.device-item .device-name {\\\\n' +\r\n  '    font-size: 12px;\\\\n' +\r\n  '    opacity: 0.7;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.device-item .device-type {\\\\n' +\r\n  '    font-size: 14px;\\\\n' +\r\n  '    opacity: 0.7;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  'mat-option {\\\\n' +\r\n  '    height: auto !important;\\\\n' +\r\n  '    white-space: normal !important;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.mat-select-value-text {\\\\n' +\r\n  '    display: block;\\\\n' +\r\n  '    width: 100%;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '/* apply a half-opaque blue to disabled filled text-fields */\\\\n' +\r\n  '.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\\\\n' +\r\n  '    background-color: rgba(244, 249, 254, 0.5) !important;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '/* make sure the disabled focus-overlay is tinted the same */\\\\n' +\r\n  '.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\\\\n' +\r\n  '    background-color: rgba(244, 249, 254, 0.5) !important;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.add-entity-form .mdc-text-field--filled:not(.mdc-text-field--disabled) {\\\\n' +\r\n  '    background-color: #F4F9FE !important;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.add-entity-form .mat-mdc-form-field-focus-overlay {\\\\n' +\r\n  '    background-color: #F4F9FE !important;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  'mat-icon {\\\\n' +\r\n  '    vertical-align: middle; /* or baseline, top, bottom */\\\\n' +\r\n  '    margin-right: 4px; /* space between icon and text */\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.fieldset {\\\\n' +\r\n  '    border: 1px solid #e2e8f0;\\\\n' +\r\n  '    background: #ffffff;\\\\n' +\r\n  '    color: #334155;\\\\n' +\r\n  '    border-radius: 6px;\\\\n' +\r\n  '    padding-bottom: 1px;\\\\n' +\r\n  '    padding-top: 1px;\\\\n' +\r\n  '    padding-left: 10px;\\\\n' +\r\n  '    padding-right: 10px;\\\\n' +\r\n  '}\\\\n' +\r\n  '.fieldset-legend {\\\\n' +\r\n  '    margin-bottom: 0.375rem;\\\\n' +\r\n  '    color: #334155;\\\\n' +\r\n  '    background: #ffffff;\\\\n' +\r\n  '    font-weight: 300;\\\\n' +\r\n  '    border-radius: 6px;\\\\n' +\r\n  '    padding: 2px;\\\\n' +\r\n  '}\\\\n' +\r\n  '.fieldset-container {\\\\n' +\r\n  '    padding-bottom: 10px;\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.disabled-checkbox {\\\\n' +\r\n  '    pointer-events: none;\\\\n' +\r\n  '    opacity: 0.5; /* To make it visually look disabled */\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '.disabled-fields {\\\\n' +\r\n  '    pointer-events: none;   /* Prevents interaction */\\\\n' +\r\n  '    opacity: 0.5;           /* Makes it look disabled */\\\\n' +\r\n  '}\\\\n' +\r\n  '\\\\n' +\r\n  '/* .mat-form-field input[disabled] {\\\\n' +\r\n  '  background-color: #f5f5f5;\\\\n' +\r\n  '  cursor: not-allowed; \\\\n' +\r\n  '  color: #9e9e9e;\\\\n' +\r\n  '} */';\r\n\r\n\r\nconst cssParser = new cssjs();\r\n      cssParser.testMode = false;                                 // actually add the <style> to the DOM\r\n      cssParser.cssPreviewNamespace = 'add-device-dialog'; // used to scope selectors\r\n      cssParser.createStyleElement(\r\n        'add-device-dialog',  // the namespace key / <style> element ID\r\n        addDeviceCSS,                      // your giant CSS string\r\n        'nonamespace'                      // mode: here nonamespace means use it as-is\r\n      );\r\n\r\ndeviceProfileService.getDeviceProfileNames(false).subscribe(response => {\r\n    deviceProfiles = response;\r\n    openAddEntityDialog();\r\n});\r\n\r\nfunction openAddEntityDialog() {\r\n    customDialog.customDialog(addDeviceHtmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction getSelectedCustomerName() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    try {\r\n        return stateParams.selectedCustomer.entityName;\r\n    } catch (error) {\r\n    }\r\n}\r\n\r\nfunction getSelectedLocationName() {\r\n    let stateParams = widgetContext.stateController.getStateParams();\r\n    try {\r\n        return stateParams.selectedLocation;\r\n    } catch (error) {\r\n        const hasAssetEntity = stateParams.entityId && stateParams.entityId.entityType === 'ASSET';\r\n        if (hasAssetEntity) {\r\n            return { entityName: stateParams.entityName || '' };\r\n        } else {\r\n            return { entityName: '' };\r\n        }\r\n    }\r\n}\r\n\r\nfunction generateRandomPassword() {\r\n    const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';\r\n    let password = '';\r\n    for (let i = 0; i < 20; i++) {\r\n        password += chars.charAt(Math.floor(Math.random() * Math.floor(chars.length)));\r\n    }\r\n    return password;\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n    let vm = instance;\r\n    vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\r\n    vm.deviceProfiles = deviceProfiles;\r\n    vm.selectedDeviceProfile = null;\r\n    vm.deviceProfileType = null;\r\n    vm.hidePassword = true;\r\n    vm.datapoints = [];\r\n    vm.rawDatapoints = {};\r\n    vm.datapointsArray = [];\r\n\r\n    const fb = vm.fb;\r\n    const validators = vm.validators;\r\n\r\n    vm.editEntityFormGroup = fb.group({\r\n        general: fb.group({\r\n            type: [null, [validators.required, profileSelectionValidator]],\r\n            entityName: [getSelectedLocationName().entityName + \"_\", [validators.required]],\r\n            entityLabel: [getSelectedLocationName().entityLabel || ''],\r\n            attributes: fb.group({\r\n                displayName: [''],\r\n                customer: [getSelectedCustomerName(), [validators.required]],\r\n                location: [getSelectedLocationName().entityName, [validators.required]],\r\n                inactivityTimeout: ['60', [validators.required]],\r\n                forwardTo: ['Energy Expert API', [validators.required]],\r\n                devEui: [null],\r\n                appKey: [null],\r\n                gatewayID: [null]\r\n            }),\r\n            activateSIM: [false],\r\n            connectivity: fb.group({\r\n                ICCID: [null],\r\n                carrierSIM: [null],\r\n                statusSIM: [null]\r\n            }),\r\n            activateAPI: [false],\r\n            addInverters: [false],\r\n            api: fb.group({\r\n                apiUrl: [null],\r\n                apiUser: [null],\r\n                apiPassword: [null],\r\n                apiToken: [null],\r\n                apiSiteId: [null],\r\n                apiSerial: [null]\r\n            }),\r\n            datapoints: fb.group({})\r\n        }),\r\n        credentials: fb.group({\r\n            credentialsType: ['MQTT_BASIC'],\r\n            clientId: [getSelectedLocationName().entityName + \"_\", [validators.required]],\r\n            userName: ['pke', [validators.required]],\r\n            password: [generateRandomPassword(), [validators.required]]\r\n        }),\r\n        inverters: fb.array([]),\r\n        relations: fb.array([])\r\n    }, { validators: uniqueInverterValidator });\r\n\r\n    vm.filterProfiles = function () {\r\n        const searchValue = vm.editEntityFormGroup.get('general.type').value;\r\n        const filterValue = (typeof searchValue === 'string' ? searchValue.toLowerCase() : '');\r\n\r\n        if (!filterValue) {\r\n            vm.filteredProfiles = vm.deviceProfiles.slice();\r\n            return;\r\n        }\r\n\r\n        vm.filteredProfiles = vm.deviceProfiles.filter(profile =>\r\n            profile.name.toLowerCase().includes(filterValue)\r\n        );\r\n    };\r\n\r\n    vm.resetFilter = function () {\r\n        vm.filteredProfiles = vm.deviceProfiles.slice();\r\n    };\r\n\r\n    vm.updateDeviceProfile = function() {\r\n        const selectedDeviceProfileId = vm.editEntityFormGroup.get('general').get('type').value.id.id;\r\n        const selectedProfile = vm.deviceProfiles.find(p => p.id.id === selectedDeviceProfileId);\r\n        if (selectedProfile) {\r\n            vm.selectedDeviceProfile = selectedProfile;\r\n        }\r\n\r\n        deviceProfileService.getDeviceProfile(selectedDeviceProfileId).subscribe(profile => {\r\n            let desc = profile.description;\r\n            if (typeof desc === 'string') {\r\n                try {\r\n                    desc = JSON.parse(desc.trim());\r\n                } catch (e) {\r\n                    console.error('Error parsing profile.description JSON', e);\r\n                    desc = {};\r\n                }\r\n            }\r\n            vm.rawDatapoints = desc.datapoints || desc.DataPoints || {};\r\n            vm.datapointsArray = Object.entries(vm.rawDatapoints).map(\r\n                ([key, meta]) => Object.assign({ key }, meta)\r\n            );\r\n            parseDeviceProfileDescription(desc);\r\n            applyValidatorsForDeviceProfile();\r\n        });\r\n    };\r\n\r\n    vm.displayProfile = function(profile) {\r\n        return profile && typeof profile === 'object' ? profile.name : profile;\r\n    };\r\n\r\n    vm.areInvertersValid = function() {\r\n        const invertersArray = vm.editEntityFormGroup.get('inverters');\r\n        for (let i = 0; i < invertersArray.length; i++) {\r\n            const group = invertersArray.at(i);\r\n            const name = group.get('name').value;\r\n            const apiUrl = group.get('apiUrl').value;\r\n            const apiSiteId = group.get('apiSiteId').value;\r\n            const apiSerial = group.get('apiSerial').value;\r\n            const deviceId = group.get('deviceId').value;\r\n\r\n            if (!((name && apiSiteId && apiUrl && (apiSerial || deviceId)))) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n\r\n    function profileSelectionValidator(control) {\r\n        if (!control.value) {\r\n            return null;\r\n        }\r\n        return (typeof control.value === 'object' && control.value !== null)\r\n            ? null\r\n            : { invalidDevice: true };\r\n    }\r\n\r\n    function uniqueInverterValidator(formGroup) {\r\n        const typeControl = formGroup.get('general').get('type');\r\n        if (!typeControl || !typeControl.value || typeof typeControl.value !== 'object' || !typeControl.value.name) {\r\n            return null;\r\n        }\r\n\r\n        const selectedName = typeControl.value.name.trim().toLowerCase();\r\n        if (selectedName !== 'fronius solar web' && selectedName !== 'huawei fusion solar') {\r\n            return null;\r\n        }\r\n\r\n        const errors = {};\r\n        const generalName = formGroup.get('general').get('entityName').value;\r\n        const names = [];\r\n        if (generalName) {\r\n            names.push(generalName.trim());\r\n        }\r\n        const invertersArray = formGroup.get('inverters');\r\n        if (invertersArray && invertersArray.controls) {\r\n            invertersArray.controls.forEach(ctrl => {\r\n                const inverterName = ctrl.get('name').value;\r\n                if (inverterName) {\r\n                    names.push(inverterName.trim());\r\n                }\r\n            });\r\n        }\r\n        if (new Set(names).size !== names.length) {\r\n            errors.duplicateNames = true;\r\n        }\r\n        return Object.keys(errors).length > 0 ? errors : null;\r\n    }\r\n\r\n    function parseDeviceProfileDescription(parsedDescription) {\r\n        const gen = parsedDescription.General || parsedDescription.general || {};\r\n        vm.deviceProfileType = gen.deviceProfileType || null;\r\n\r\n        const dpSection = parsedDescription.datapoints\r\n            || parsedDescription.DataPoints\r\n            || (parsedDescription.General && parsedDescription.General.datapoints)\r\n            || {};\r\n\r\n        vm.datapoints = Object.keys(dpSection).map(key => ({ key }));\r\n        rebuildDatapointsControls();\r\n    }\r\n\r\n    function rebuildDatapointsControls() {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        if (generalGroup.contains('datapoints')) {\r\n            generalGroup.removeControl('datapoints');\r\n        }\r\n        const dpGroup = fb.group({});\r\n        vm.datapoints.forEach(dp => {\r\n            dpGroup.addControl(dp.key, fb.control(false));\r\n        });\r\n        generalGroup.addControl('datapoints', dpGroup);\r\n    }\r\n\r\n    function applyValidatorsForDeviceProfile() {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        const attributesGroup = generalGroup.get('attributes');\r\n        const devEuiControl = attributesGroup.get('devEui');\r\n        const appKeyControl = attributesGroup.get('appKey');\r\n        const gatewayIDControl = attributesGroup.get('gatewayID');\r\n\r\n        devEuiControl.clearValidators();\r\n        appKeyControl.clearValidators();\r\n        gatewayIDControl.clearValidators();\r\n\r\n        const selectedType = generalGroup.get('type').value;\r\n        const profileName = selectedType?.name || '';\r\n\r\n        if (vm.deviceProfileType === 'LoRaWAN') {\r\n            devEuiControl.setValidators([validators.required]);\r\n            appKeyControl.setValidators([validators.required]);\r\n        } else if (vm.deviceProfileType === 'Gateway') {\r\n            if (profileName === 'Gateway') {\r\n                gatewayIDControl.setValidators([validators.required, validators.pattern('[a-zA-Z0-9]{16}')]);\r\n            }\r\n            vm.editEntityFormGroup.get('credentials').disable();\r\n        } else {\r\n            vm.editEntityFormGroup.get('credentials').enable();\r\n        }\r\n\r\n        devEuiControl.updateValueAndValidity();\r\n        appKeyControl.updateValueAndValidity();\r\n        gatewayIDControl.updateValueAndValidity();\r\n    }\r\n\r\n    vm.editEntityFormGroup.get('general').get('activateSIM').valueChanges.subscribe(value => {\r\n        const connectivity = vm.editEntityFormGroup.get('general').get('connectivity');\r\n        if (value) {\r\n            connectivity.get('ICCID').setValidators([validators.required]);\r\n            connectivity.get('carrierSIM').setValidators([validators.required]);\r\n            connectivity.get('statusSIM').setValidators([validators.required]);\r\n        } else {\r\n            connectivity.get('ICCID').clearValidators();\r\n            connectivity.get('carrierSIM').clearValidators();\r\n            connectivity.get('statusSIM').clearValidators();\r\n        }\r\n        connectivity.get('ICCID').updateValueAndValidity();\r\n        connectivity.get('carrierSIM').updateValueAndValidity();\r\n        connectivity.get('statusSIM').updateValueAndValidity();\r\n    });\r\n\r\n    vm.editEntityFormGroup.get('general').get('type').valueChanges.subscribe(selectedType => {\r\n        if (selectedType && typeof selectedType === 'object') {\r\n            vm.updateDeviceProfile();\r\n        }\r\n\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        const apiGroup = generalGroup.get('api');\r\n\r\n        if (selectedType.name !== 'Fronius Solar Web' || selectedType.name !== 'Huawei Fusion Solar') {\r\n            vm.editEntityFormGroup.setControl('inverters', fb.array([]));\r\n        }\r\n\r\n        const defaultEntityName = getSelectedLocationName().entityName + \"_\";\r\n        vm.editEntityFormGroup.get('general').patchValue({ entityName: defaultEntityName });\r\n\r\n        if (selectedType) {\r\n            if (selectedType.name === 'Huawei Fusion Solar') {\r\n                generalGroup.patchValue({\r\n                    activateAPI: true,\r\n                    addInverters: false\r\n                });\r\n                if (!apiGroup.contains('apiUser')) {\r\n                    apiGroup.addControl('apiUser', fb.control(''));\r\n                } else {\r\n                    apiGroup.get('apiUser').setValue('');\r\n                }\r\n                if (!apiGroup.contains('apiPassword')) {\r\n                    apiGroup.addControl('apiPassword', fb.control(''));\r\n                } else {\r\n                    apiGroup.get('apiPassword').setValue('');\r\n                }\r\n                if (apiGroup.contains('apiToken')) {\r\n                    apiGroup.removeControl('apiToken');\r\n                }\r\n                apiGroup.patchValue({\r\n                    apiUrl: 'eu5.fusionsolar.huawei.com',\r\n                    apiSiteId: '',\r\n                    createPVSystem: true\r\n                });\r\n            } else if (selectedType.name === 'Fronius Solar Web') {\r\n                generalGroup.patchValue({\r\n                    activateAPI: true,\r\n                    addInverters: false\r\n                });\r\n                if (apiGroup.contains('apiUser')) {\r\n                    apiGroup.removeControl('apiUser');\r\n                }\r\n                if (apiGroup.contains('apiPassword')) {\r\n                    apiGroup.removeControl('apiPassword');\r\n                }\r\n                if (apiGroup.contains('apiToken')) {\r\n                    apiGroup.removeControl('apiToken');\r\n                }\r\n                apiGroup.patchValue({\r\n                    apiUrl: 'https://api.solarweb.com/swqapi',\r\n                    apiSiteId: '',\r\n                    createPVSystem: true\r\n                });\r\n            } else {\r\n                if (!apiGroup.contains('apiUser')) {\r\n                    apiGroup.addControl('apiUser', fb.control(null, []));\r\n                }\r\n                if (!apiGroup.contains('apiPassword')) {\r\n                    apiGroup.addControl('apiPassword', fb.control(null, []));\r\n                }\r\n                if (!apiGroup.contains('apiToken')) {\r\n                    apiGroup.addControl('apiToken', fb.control(null, []));\r\n                }\r\n                generalGroup.patchValue({\r\n                    activateAPI: false,\r\n                    addInverters: false\r\n                });\r\n                apiGroup.patchValue({\r\n                    apiUrl: null,\r\n                    apiSiteId: '',\r\n                    createPVSystem: false\r\n                });\r\n            }\r\n\r\n            if (vm.deviceProfileType === 'LoRaWAN') {\r\n                const attrs = generalGroup.get('attributes');\r\n                attrs.get('devEui').reset();\r\n                attrs.get('appKey').reset();\r\n                attrs.get('devEui').markAsPristine();\r\n                attrs.get('devEui').markAsUntouched();\r\n                attrs.get('appKey').markAsPristine();\r\n                attrs.get('appKey').markAsUntouched();\r\n            }\r\n\r\n            if (apiGroup.get('apiUrl')) {\r\n                apiGroup.get('apiUrl').updateValueAndValidity();\r\n            }\r\n            if (apiGroup.get('apiSiteId')) {\r\n                apiGroup.get('apiSiteId').updateValueAndValidity();\r\n            }\r\n        }\r\n    });\r\n\r\n    vm.editEntityFormGroup.get('general').get('entityName').valueChanges.subscribe(newName => {\r\n        vm.editEntityFormGroup.get('credentials').patchValue({\r\n            clientId: newName\r\n        });\r\n\r\n        const inverters = vm.editEntityFormGroup.get('inverters');\r\n        inverters.controls.forEach((inverterGroup, index) => {\r\n            inverterGroup.get('name').setValue(`${newName}`, { emitEvent: false });\r\n        });\r\n    });\r\n\r\n    vm.editEntityFormGroup.get('general').get('api').get('apiSiteId').valueChanges.subscribe(newValue => {\r\n        const inverters = vm.editEntityFormGroup.get('inverters');\r\n        inverters.controls.forEach(inverterGroup => {\r\n            inverterGroup.get('apiSiteId').patchValue(newValue, { emitEvent: false });\r\n        });\r\n    });\r\n\r\n    vm.cancel = function() {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    function saveInverters() {\r\n        const selectedType = vm.editEntityFormGroup.get('general').get('type').value;\r\n        const invertersArray = vm.editEntityFormGroup.get('inverters').value;\r\n        if (!invertersArray || invertersArray.length === 0) {\r\n            return widgetContext.rxjs.of([]);\r\n        }\r\n\r\n        const mainAttributes = vm.editEntityFormGroup.get('general').get('attributes').value;\r\n        const inactivityTimeout = parseInt(mainAttributes.inactivityTimeout, 10);\r\n        const forwardTo = mainAttributes.forwardTo;\r\n        const location = mainAttributes.location;\r\n        const customer = mainAttributes.customer;\r\n        let customerId = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n\r\n        let inverterObservables = invertersArray.map(inverter => {\r\n            let inverterEntity;\r\n            if (selectedType && selectedType.name === 'Fronius Solar Web') {\r\n                inverterEntity = {\r\n                    name: inverter.name,\r\n                    type: 'Fronius Solar Web',\r\n                    label: inverter.label,\r\n                    customerId: customerId\r\n                };\r\n            } else if (selectedType && selectedType.name === 'Huawei Fusion Solar') {\r\n                inverterEntity = {\r\n                    name: inverter.name,\r\n                    type: 'Huawei Fusion Solar',\r\n                    label: inverter.label,\r\n                    customerId: customerId\r\n                };\r\n            }\r\n            return deviceService.saveDevice(inverterEntity).pipe(\r\n                widgetContext.rxjs.tap(savedInverter => {\r\n                }),\r\n                widgetContext.rxjs.catchError(error => {\r\n                    return widgetContext.rxjs.throwError(error);\r\n                }),\r\n                widgetContext.rxjs.switchMap(savedInverter => {\r\n                    let inverterAttributes = [];\r\n                    function pushAttr(key, value) {\r\n                        if (value !== null && value !== undefined && value !== '') {\r\n                            inverterAttributes.push({ key, value });\r\n                        }\r\n                    }\r\n                    pushAttr(\"apiSiteId\", inverter.apiSiteId);\r\n                    pushAttr(\"apiSerial\", inverter.apiSerial);\r\n                    pushAttr(\"deviceId\", inverter.deviceId);\r\n                    pushAttr(\"apiUrl\", inverter.apiUrl);\r\n                    pushAttr(\"inactivityTimeout\", inactivityTimeout);\r\n                    pushAttr(\"forwardTo\", forwardTo);\r\n                    pushAttr(\"location\", location);\r\n                    pushAttr(\"customer\", customer);\r\n                    pushAttr(\"froniusApiCreate\", \"system\");\r\n\r\n                    return attributeService.saveEntityAttributes(savedInverter.id, \"SERVER_SCOPE\", inverterAttributes).pipe(\r\n                        widgetContext.rxjs.map(() => savedInverter)\r\n                    );\r\n                })\r\n            );\r\n        });\r\n        return widgetContext.rxjs.forkJoin(inverterObservables);\r\n    }\r\n\r\n    vm.save = function() {\r\n        vm.editEntityFormGroup.markAsPristine();\r\n        const selectedType = vm.editEntityFormGroup.get('general').get('type').value;\r\n\r\n        if (selectedType && selectedType.name === 'Fronius Solar Web' || selectedType && selectedType.name === 'Huawei Fusion Solar') {\r\n            saveEntityObservable().subscribe(entity => {\r\n                widgetContext.rxjs.forkJoin([\r\n                    saveAttributes(entity.id),\r\n                    saveCredentials(entity.id),\r\n                    saveRelations(entity.id)\r\n                ]).subscribe(() => {\r\n                    saveInverters().subscribe(savedInverters => {\r\n                        let groupObs;\r\n                        const customerId = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n                        if (selectedType && selectedType.name === 'Fronius Solar Web') {\r\n                            groupObs = getOrCreateFroniusGroup(customerId).pipe(\r\n                                widgetContext.rxjs.switchMap((group) => {\r\n                                    let obs = [];\r\n                                    obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, entity.id.id));\r\n                                    savedInverters.forEach(inv => {\r\n                                        obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, inv.id.id));\r\n                                    });\r\n                                    return widgetContext.rxjs.forkJoin(obs);\r\n                                })\r\n                            );\r\n                        } else {\r\n                            groupObs = getOrCreateHuaweiGroup(customerId).pipe(\r\n                                widgetContext.rxjs.switchMap((group) => {\r\n                                    let obs = [];\r\n                                    obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, entity.id.id));\r\n                                    savedInverters.forEach(inv => {\r\n                                        obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, inv.id.id));\r\n                                    });\r\n                                    return widgetContext.rxjs.forkJoin(obs);\r\n                                })\r\n                            );\r\n                        }\r\n                        // Now assign to Unassigned Devices group as well\r\n                        groupObs.pipe(\r\n                            widgetContext.rxjs.switchMap(() => getOrCreateUnassignedDevices(customerId)),\r\n                            widgetContext.rxjs.switchMap((unassignedGroup) => {\r\n                                let obs2 = [];\r\n                                obs2.push(entityGroupService.addEntityToEntityGroup(unassignedGroup.id.id, entity.id.id));\r\n                                savedInverters.forEach(inv => {\r\n                                    obs2.push(entityGroupService.addEntityToEntityGroup(unassignedGroup.id.id, inv.id.id));\r\n                                });\r\n                                return widgetContext.rxjs.forkJoin(obs2);\r\n                            })\r\n                        ).subscribe(() => {\r\n                            widgetContext.updateAliases();\r\n                            vm.dialogRef.close(null);\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        } else {\r\n            vm.editEntityFormGroup.markAsPristine();\r\n            saveEntityObservable().subscribe(entity => {\r\n                widgetContext.rxjs.forkJoin([\r\n                    saveAttributes(entity.id),\r\n                    saveCredentials(entity.id),\r\n                    saveRelations(entity.id)\r\n                ]).subscribe(() => {\r\n                    // Assign to Unassigned Devices group\r\n                    const customerId = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n                    getOrCreateUnassignedDevices(customerId).pipe(\r\n                        widgetContext.rxjs.switchMap((unassignedGroup) => {\r\n                            return widgetContext.rxjs.forkJoin([\r\n                                entityGroupService.addEntityToEntityGroup(unassignedGroup.id.id, entity.id.id)\r\n                            ]);\r\n                        })\r\n                    ).subscribe(() => {\r\n                        widgetContext.updateAliases();\r\n                        vm.dialogRef.close(null);\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    };\r\n\r\n    vm.copyToClipboard = function(event, controlName) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        const value = vm.editEntityFormGroup.get(controlName.split('.')).value;\r\n        navigator.clipboard.writeText(value).then(() => {\r\n            widgetContext.showSuccessToast('Copied to clipboard!', 2000, 'top', 'center');\r\n        }).catch(err => {\r\n            widgetContext.showErrorToast('Failed to copy to clipboard.', 2000, 'top', 'center');\r\n        });\r\n    };\r\n\r\n    vm.togglePasswordVisibility = function() {\r\n        vm.hidePassword = !vm.hidePassword;\r\n    };\r\n\r\n    vm.addInverter = function() {\r\n        const generalName = vm.editEntityFormGroup.get('general').get('entityName').value;\r\n        const generalApiSiteId = vm.editEntityFormGroup.get('general').get('api').get('apiSiteId').value;\r\n        const generalApiUrl = vm.editEntityFormGroup.get('general').get('api').get('apiUrl').value;\r\n        const inverterCount = vm.editEntityFormGroup.get('inverters').length;\r\n        const inverterName = `${generalName}`;\r\n        const inverterGroup = fb.group({\r\n            name: [inverterName, [validators.required]],\r\n            label: [''],\r\n            displayName: [''],\r\n            apiSerial: [''],\r\n            apiSiteId: [generalApiSiteId, [validators.required]],\r\n            apiUrl : [generalApiUrl],\r\n            deviceId: ['']\r\n        }, { validators: inverterGroupValidator });\r\n\r\n        vm.editEntityFormGroup.get('inverters').push(inverterGroup);\r\n        vm.editEntityFormGroup.updateValueAndValidity();\r\n    };\r\n\r\n    function inverterGroupValidator(group) {\r\n        const apiSerial = group.get('apiSerial');\r\n        const deviceId = group.get('deviceId');\r\n        if (!apiSerial.value && !deviceId.value) {\r\n            return { inverterRequired: 'Either API Serial or Device Id is required.' };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    function getOrCreateHuaweiGroup(customerId) {\r\n        return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n            widgetContext.rxjs.switchMap((groups) => {\r\n                let group = groups.find(g => g.name === 'Huawei Fusion Solar API');\r\n                if (group) {\r\n                    return widgetContext.rxjs.of(group);\r\n                } else {\r\n                    group = {\r\n                        type: 'DEVICE',\r\n                        name: 'Huawei Fusion Solar API',\r\n                        ownerId: customerId\r\n                    };\r\n                    return entityGroupService.saveEntityGroup(group);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    function getOrCreateFroniusGroup(customerId) {\r\n        return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n            widgetContext.rxjs.switchMap((groups) => {\r\n                let group = groups.find(g => g.name === 'Fronius Solar Web API');\r\n                if (group) {\r\n                    return widgetContext.rxjs.of(group);\r\n                } else {\r\n                    group = {\r\n                        type: 'DEVICE',\r\n                        name: 'Fronius Solar Web API',\r\n                        ownerId: customerId\r\n                    };\r\n                    return entityGroupService.saveEntityGroup(group);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    function getOrCreateUnassignedDevices(customerId) {\r\n        return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n            widgetContext.rxjs.switchMap((groups) => {\r\n                let group = groups.find(g => g.name === 'Unassigned Devices');\r\n                if (group) {\r\n                    return widgetContext.rxjs.of(group);\r\n                } else {\r\n                    group = {\r\n                        type: 'DEVICE',\r\n                        name: 'Unassigned Devices',\r\n                        ownerId: customerId\r\n                    };\r\n                    return entityGroupService.saveEntityGroup(group);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    function requiredIfEmpty(siblingControlName) {\r\n        return function (control) {\r\n            if (!control.parent) return null;\r\n\r\n            const sibling = control.parent.get(siblingControlName);\r\n            if (!control.value && (!sibling || !sibling.value)) {\r\n                return { required: true };\r\n            }\r\n            return null;\r\n        };\r\n    }\r\n\r\n    vm.removeInverter = function() {\r\n        const invertersArray = vm.editEntityFormGroup.get('inverters');\r\n        if (invertersArray && invertersArray.length > 0) {\r\n            invertersArray.removeAt(invertersArray.length - 1);\r\n        }\r\n        vm.editEntityFormGroup.updateValueAndValidity();\r\n    };\r\n\r\n    function saveEntityObservable() {\r\n        const gVal = vm.editEntityFormGroup.get('general').value;\r\n        const customerId = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n        let entity = {\r\n            name: gVal.entityName,\r\n            type: gVal.type.name,\r\n            label: gVal.entityLabel,\r\n            customerId: customerId\r\n        };\r\n        return deviceService.saveDevice(entity);\r\n    }\r\n\r\n    function saveAttributes(entityId) {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        const attributes = generalGroup.get('attributes').value;\r\n        attributes.inactivityTimeout = parseInt(attributes.inactivityTimeout, 10) * 60000;\r\n        attributes.state = \"normal\";\r\n\r\n        const generalValue = generalGroup.value;\r\n\r\n        function pushAttr(array, key, value) {\r\n            if (value !== null) {\r\n                array.push({ key: key, value: value });\r\n            }\r\n        }\r\n\r\n        let attributesArray = [];\r\n\r\n        for (let key in attributes) {\r\n            if (attributes[key] !== null) {\r\n                attributesArray.push({ key: key, value: attributes[key] });\r\n            }\r\n        }\r\n\r\n        pushAttr(attributesArray, 'devEui', generalValue.devEui);\r\n        pushAttr(attributesArray, 'appKey', generalValue.appKey);\r\n        pushAttr(attributesArray, 'gatewayID', generalValue.gatewayID);\r\n\r\n        if (vm.deviceProfileType === 'Gateway') {\r\n            attributesArray.push({ key: 'meterType', value: 'Gateway' });\r\n        }\r\n\r\n        if (generalValue.activateSIM) {\r\n            const connectivityValues = generalGroup.get('connectivity').value;\r\n            pushAttr(attributesArray, 'ICCID', connectivityValues.ICCID);\r\n            pushAttr(attributesArray, 'carrierSIM', connectivityValues.carrierSIM);\r\n            pushAttr(attributesArray, 'statusSIM', connectivityValues.statusSIM);\r\n        }\r\n\r\n        if (generalValue.activateAPI) {\r\n            const apiValues = generalGroup.get('api').value;\r\n            pushAttr(attributesArray, 'apiUrl', apiValues.apiUrl);\r\n            pushAttr(attributesArray, 'apiUser', apiValues.apiUser);\r\n            pushAttr(attributesArray, 'apiPassword', apiValues.apiPassword);\r\n            pushAttr(attributesArray, 'apiToken', apiValues.apiToken);\r\n            pushAttr(attributesArray, 'apiSiteId', apiValues.apiSiteId);\r\n            pushAttr(attributesArray, 'apiSerial', apiValues.apiSerial);\r\n\r\n            const selectedType = generalGroup.get('type').value;\r\n            if (selectedType && selectedType.name === 'Fronius Solar Web') {\r\n                pushAttr(attributesArray, 'froniusApiCreate', 'system');\r\n            }\r\n        }\r\n\r\n        if (generalGroup.contains('datapoints')) {\r\n            const dpValues = generalGroup.get('datapoints').value;\r\n            const active = Object.keys(dpValues).filter(k => dpValues[k]);\r\n            if (active.length) {\r\n                attributesArray.push({\r\n                    key: 'cfg_activeDatapoints',\r\n                    value: JSON.stringify({ datapoints: active })\r\n                });\r\n            }\r\n        }\r\n\r\n        if (attributesArray.length > 0) {\r\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n        }\r\n\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n\r\n    function saveCredentials(entityId) {\r\n        const generalGroup = vm.editEntityFormGroup.get('general');\r\n        const selectedType = generalGroup.get('type').value;\r\n        const profileName = selectedType?.name || '';\r\n\r\n        if (vm.deviceProfileType === 'Gateway' && profileName !== 'Gateway') {\r\n            return deviceService.getDeviceCredentials(entityId.id).pipe(\r\n                widgetContext.rxjs.mergeMap(existingCredentials => {\r\n                    let credentials = vm.editEntityFormGroup.get('credentials').value;\r\n                    let deviceCredentials = {\r\n                        id: existingCredentials.id,\r\n                        deviceId: existingCredentials.deviceId,\r\n                        credentialsType: credentials.credentialsType,\r\n                        credentialsValue: JSON.stringify({\r\n                            clientId: credentials.clientId,\r\n                            userName: credentials.userName,\r\n                            password: credentials.password\r\n                        })\r\n                    };\r\n                    return deviceService.saveDeviceCredentials(deviceCredentials);\r\n                }),\r\n                widgetContext.rxjs.catchError(error => {\r\n                    widgetContext.showErrorToast(`Failed to update credentials: ${error.message}`, 4000, 'top', 'center');\r\n                    return widgetContext.rxjs.throwError(error);\r\n                })\r\n            );\r\n        } else {\r\n            return widgetContext.rxjs.of([]);\r\n        }\r\n    }\r\n\r\n    function saveRelations(entityId) {\r\n        let relations = vm.editEntityFormGroup.get('relations').value;\r\n        if (!relations || relations.length === 0) {\r\n            return widgetContext.rxjs.of([]);\r\n        }\r\n        let tasks = [];\r\n        for (let i = 0; i < relations.length; i++) {\r\n            let relation = {\r\n                type: relations[i].relationType,\r\n                typeGroup: 'COMMON'\r\n            };\r\n            if (relations[i].direction === 'FROM') {\r\n                relation.to = relations[i].relatedEntity;\r\n                relation.from = entityId;\r\n            } else {\r\n                relation.to = entityId;\r\n                relation.from = relations[i].relatedEntity;\r\n            }\r\n            tasks.push(entityRelationService.saveRelation(relation));\r\n        }\r\n        if (tasks.length > 0) {\r\n            return widgetContext.rxjs.forkJoin(tasks);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n}\r\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b3930ab5-51e7-43e3-b27d-10141e5f9730"
              },
              {
                "name": "Test2",
                "buttonType": "icon",
                "icon": "more_horiz",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addDevice(widgetContext,entityId,entityName,entityLabel);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7d11d6ff-19ae-87a4-c8ef-0b7f150f10ea"
              },
              {
                "name": "Add Device GW Relation",
                "buttonType": "icon",
                "icon": "more_horiz",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": "/*fetchAllGateways(widgetContext);\r\n*/\r\nlet desiredMode = \"Both\";\r\nconst TENANT_USER = 'pke.at.api@pke-iot.expert';\r\nconst TENANT_PW   = 'Z8MThw69CYS3RYW';\r\nconst API_BASE    = '/api'; // ggf. anpassen, falls dein ThingsBoard unter einem anderen Pfad luft\r\n\r\n\r\nfunction pageLink(pageSize, page = 0, textSearch = '', sort = { property: 'name', direction: 'ASC' }) {\r\n  return {\r\n    pageSize, page, textSearch, sortOrder: sort,\r\n    toQuery() {\r\n      const qs = new URLSearchParams();\r\n      qs.set('pageSize', String(this.pageSize));\r\n      qs.set('page', String(this.page));\r\n      if (this.textSearch) qs.set('textSearch', this.textSearch);\r\n      if (this.sortOrder?.property)  qs.set('sortProperty', this.sortOrder.property);\r\n      if (this.sortOrder?.direction) qs.set('sortOrder',  this.sortOrder.direction);\r\n      return `?${qs.toString()}`;\r\n    }\r\n  };\r\n}\r\n\r\nfunction onIccidSelected(vm, event, deps) {\r\n  const { widgetContext, attributeService, entityRelationService, deviceService } = deps;\r\n  const rx = widgetContext.rxjs;\r\n  const { of, forkJoin } = rx;\r\n  const { map, switchMap, catchError } = rx;\r\n\r\n  function getConnectivityGroup() {\r\n    if (vm.editEntityFormGroup) {\r\n      return vm.editEntityFormGroup.get('general')?.get('connectivity') || null;\r\n    }\r\n    if (vm.simConfigFormGroup) {\r\n      return vm.simConfigFormGroup.get('connectivity') || null;\r\n    }\r\n    return null;\r\n  }\r\n  function safeDigest() { widgetContext.$scope.$digest && widgetContext.$scope.$digest(); }\r\n\r\n  const asset = event && event.option ? event.option.value : null;\r\n\r\n  vm.iccidDeviceName = 'Loading...';\r\n  vm.iccidSimStatusLabel = 'Loading...';\r\n  vm.iccidCanActivate = false;\r\n  vm.iccidDeviceAssigned = false;\r\n  vm.iccidAssignedDeviceId = null;\r\n  vm.iccidSimStatusId = null;\r\n\r\n  if (!asset || !asset.id || !asset.id.id) { safeDigest(); return; }\r\n\r\n  const conn = getConnectivityGroup();\r\n  if (conn) conn.get('ICCID').setValue(asset);\r\n\r\n  vm.disableSave = true;\r\n  safeDigest();\r\n\r\n  const token = `${Date.now()}:${asset.id.id}`;\r\n  vm._iccidReqToken = token;\r\n\r\n  const assetId = asset.id;\r\n\r\n  const shared$ = attributeService.getEntityAttributes(assetId, 'SHARED_SCOPE', ['sim_status']).pipe(catchError(() => of([])));\r\n  const server$ = attributeService.getEntityAttributes(assetId, 'SERVER_SCOPE', ['sim_status']).pipe(catchError(() => of([])));\r\n  const rels$   = entityRelationService.findByToAndType(assetId, 'Contains').pipe(catchError(() => of([])));\r\n\r\n  forkJoin([shared$, server$, rels$]).pipe(\r\n    map(([sharedAttrs, serverAttrs, rels]) => {\r\n      const shared = Array.isArray(sharedAttrs) ? sharedAttrs : [];\r\n      const server = Array.isArray(serverAttrs) ? serverAttrs : [];\r\n      const relArr = Array.isArray(rels) ? rels : [];\r\n      const simAttr = shared.find(a => a?.key === 'sim_status') || server.find(a => a?.key === 'sim_status') || null;\r\n      const deviceRel = relArr.find(r => r?.from?.entityType === 'DEVICE') || null;\r\n\r\n      let simLabel = 'Unknown';\r\n      let simId = null;\r\n      if (simAttr && simAttr.value) {\r\n        if (typeof simAttr.value === 'object') {\r\n          simLabel = simAttr.value.label || 'Unknown';\r\n          simId = simAttr.value.id ?? null;\r\n        } else {\r\n          simLabel = String(simAttr.value);\r\n          simId = null;\r\n        }\r\n      }\r\n      return { simLabel, simId, deviceRel };\r\n    }),\r\n    switchMap(({ simLabel, simId, deviceRel }) => {\r\n      if (deviceRel?.from?.id) {\r\n        return deviceService.getDeviceInfo(deviceRel.from.id).pipe(\r\n          map(dev => ({\r\n            simLabel, simId,\r\n            assigned: true,\r\n            assignedDeviceId: deviceRel.from.id,\r\n            assignedDeviceName: (dev && dev.name) ? dev.name : deviceRel.from.id\r\n          })),\r\n          catchError(() => of({\r\n            simLabel, simId,\r\n            assigned: true,\r\n            assignedDeviceId: deviceRel.from.id,\r\n            assignedDeviceName: deviceRel.from.id\r\n          }))\r\n        );\r\n      }\r\n      return of({ simLabel, simId, assigned: false, assignedDeviceId: null, assignedDeviceName: 'Not assigned' });\r\n    })\r\n  )\r\n  .subscribe(result => {\r\n    if (vm._iccidReqToken !== token) return;\r\n\r\n    vm.iccidSimStatusLabel  = result.simLabel;\r\n    vm.iccidSimStatusId     = result.simId;\r\n    vm.iccidDeviceAssigned  = !!result.assigned;\r\n    vm.iccidAssignedDeviceId= result.assignedDeviceId;\r\n    vm.iccidDeviceName      = result.assignedDeviceName;\r\n\r\n    if (!vm.iccidDeviceAssigned && vm.iccidSimStatusId !== null) {\r\n      vm.iccidCanActivate =\r\n        vm.iccidSimStatusId === 2 ||\r\n        (Array.isArray(SIM_STATUS_TRANSITIONS)\r\n          ? SIM_STATUS_TRANSITIONS.some(t => t.from === vm.iccidSimStatusId && t.to === 2)\r\n          : true);\r\n    } else {\r\n      vm.iccidCanActivate = false;\r\n    }\r\n\r\n    vm.disableSave = false;\r\n    safeDigest();\r\n  }, _err => {\r\n    if (vm._iccidReqToken !== token) return;\r\n    vm.iccidDeviceName = 'Not assigned';\r\n    vm.iccidCanActivate = false;\r\n    vm.disableSave = false;\r\n    safeDigest();\r\n  });\r\n}\r\n\r\nfunction displayIccidAsset(asset) {\r\n  return asset && asset.name ? asset.name.replace(/^wsim_/, '') : '';\r\n}\r\n\r\nfunction filterIccidAssets(vm, deps) {\r\n  const { widgetContext, entityGroupService, pageLink } = deps;\r\n  if (!vm.iccidEntityGroupId) return;\r\n\r\n  const conn =\r\n    vm.editEntityFormGroup?.get('general')?.get('connectivity') ||\r\n    vm.simForm?.get('connectivity') ||\r\n    null;\r\n  if (!conn) return;\r\n\r\n  const iccidCtrl = conn.get('ICCID');\r\n  if (!iccidCtrl) return;\r\n\r\n  if (vm._iccidSearchTimeout) clearTimeout(vm._iccidSearchTimeout);\r\n  vm._iccidSearchTimeout = setTimeout(() => {\r\n    const rawVal = iccidCtrl.value;\r\n    const search =\r\n      typeof rawVal === 'string'\r\n        ? rawVal\r\n        : (rawVal && rawVal.name ? displayIccidAsset(rawVal) : '');\r\n\r\n    if (!search) {\r\n      vm.filteredIccidAssets = [];\r\n      vm.iccidNoResults = false;\r\n      vm.isIccidLoading = false;\r\n      widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n      return;\r\n    }\r\n\r\n    if (vm._lastIccidSearchTerm === search) return;\r\n    vm._lastIccidSearchTerm = search;\r\n\r\n    vm.isIccidLoading = true;\r\n    vm.iccidNoResults = false;\r\n\r\n    const pl = pageLink(5, 0, search, { property: 'name', direction: 'ASC' });\r\n\r\n    if (vm._iccidSub?.unsubscribe) vm._iccidSub.unsubscribe();\r\n    vm._iccidSub = entityGroupService\r\n      .getEntityGroupEntities(vm.iccidEntityGroupId, pl, 'ASSET')\r\n      .subscribe(\r\n        (pageData) => {\r\n          const items = (pageData && pageData.data) ? pageData.data : [];\r\n          vm.filteredIccidAssets = items;\r\n          vm.iccidNoResults = items.length === 0;\r\n          vm.isIccidLoading = false;\r\n          widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n        },\r\n        () => {\r\n          vm.filteredIccidAssets = [];\r\n          vm.isIccidLoading = false;\r\n          vm.iccidNoResults = true;\r\n          widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n        }\r\n      );\r\n  }, 120);\r\n}\r\n\r\nfunction resetIccidFilter(vm) {\r\n  vm.filteredIccidAssets = [];\r\n  vm.iccidNoResults = false;\r\n}\r\n\r\nfunction openIccidAssignedDialog(widgetContext, vm) {\r\n  const $inj = widgetContext.$scope.$injector;\r\n  const customDialog     = $inj.get(widgetContext.servicesMap.get('customDialog'));\r\n  const attributeService = $inj.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\n  const toPromise = (obs) => obs && typeof obs.toPromise === 'function'\r\n    ? obs.toPromise() : new Promise((res, rej) => obs.subscribe(res, rej));\r\n\r\n  function getIccidCtrl() {\r\n    if (vm?.editEntityFormGroup) {\r\n      return vm.editEntityFormGroup.get('general')?.get('connectivity')?.get('ICCID') || null;\r\n    }\r\n    if (vm?.simConfigFormGroup) {\r\n      return vm.simConfigFormGroup.get('ICCID') || null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  const iccidCtrl          = getIccidCtrl();\r\n  const iccidAsset         = iccidCtrl ? iccidCtrl.value : null;\r\n  const assignedSimName    = displayIccidAsset(iccidAsset);\r\n  const assignedDeviceName = vm?.iccidDeviceName || 'Unknown device';\r\n  const assignedDeviceId   = vm?.iccidAssignedDeviceId || null;\r\n\r\n  const dialogHtml =\r\n    '<form class=\"add-entity-form\" style=\"width:420px;max-width:100%;\">' +\r\n      '<mat-toolbar color=\"warn\">' +\r\n        '<mat-icon style=\"margin-right:8px;\">warning</mat-icon>' +\r\n        '<span class=\"text-lg font-semibold flex-1\">SIM Already Assigned</span>' +\r\n        '<button mat-icon-button type=\"button\" (click)=\"dialogRef.close(false)\">' +\r\n          '<mat-icon>close</mat-icon>' +\r\n        '</button>' +\r\n      '</mat-toolbar>' +\r\n      '<div class=\"p-4\">' +\r\n        '<div class=\"fieldset mb-4\" style=\"text-align:center;\">' +\r\n          '<div><mat-icon>devices</mat-icon><span title=\"' + assignedDeviceName + '\">' + assignedDeviceName + '</span></div>' +\r\n          '<div><mat-icon color=\"primary\">swap_vert</mat-icon></div>' +\r\n          '<div><mat-icon>sim_card</mat-icon><span title=\"' + assignedSimName + '\">' + assignedSimName + '</span></div>' +\r\n        '</div>' +\r\n        '<div class=\"mb-4\">This SIM is already assigned to another device.<br>Do you want to unassign it?</div>' +\r\n        '<div class=\"flex justify-end gap-2\">' +\r\n          '<button mat-button type=\"button\" (click)=\"dialogRef.close(false)\">{{\"action.cancel\" | translate}}</button>' +\r\n          '<button mat-button color=\"warn\" type=\"button\" ' + (assignedDeviceId ? '' : 'disabled') + ' (click)=\"unassignSim()\">{{\"action.unassign\" | translate}}</button>' +\r\n        '</div>' +\r\n      '</div>' +\r\n    '</form>';\r\n\r\n  function DialogController(instance) {\r\n    const dlg = instance;\r\n\r\n    dlg.unassignSim = async function() {\r\n      try {\r\n        if (!assignedDeviceId) {\r\n          dlg.dialogRef.close(false);\r\n          return;\r\n        }\r\n        const deviceEntityId = { entityType: 'DEVICE', id: assignedDeviceId };\r\n        await toPromise(\r\n          attributeService.deleteEntityAttributes(\r\n            deviceEntityId,\r\n            'SERVER_SCOPE',\r\n            [{ key: 'sim' }]\r\n          )\r\n        );\r\n\r\n        // Update calling VM (works for addDevice flow vars)\r\n        if (vm) {\r\n          if ('iccidDeviceAssigned' in vm) vm.iccidDeviceAssigned = false;\r\n          if ('iccidDeviceName' in vm)     vm.iccidDeviceName = 'Not assigned';\r\n          if ('iccidAssignedDeviceId' in vm) vm.iccidAssignedDeviceId = null;\r\n          if ('iccidCanActivate' in vm)    vm.iccidCanActivate = true;\r\n\r\n          const form = vm.editEntityFormGroup || vm.simConfigFormGroup || null;\r\n          if (form?.markAsDirty) {\r\n            form.markAsDirty();\r\n            form.updateValueAndValidity({ onlySelf: false, emitEvent: true });\r\n          }\r\n        }\r\n\r\n        dlg.dialogRef.close(true);\r\n      } catch (e) {\r\n        if (widgetContext?.showErrorToast) {\r\n          widgetContext.showErrorToast('Failed to unassign SIM. ' + (e?.message || ''), 3000, 'top', 'center');\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  customDialog.customDialog(dialogHtml, DialogController).subscribe();\r\n}\r\n\r\nconst simControlsHtml = `\r\n<mat-checkbox formControlName=\"activateSIM\" style=\"margin-top: 10px;\">\r\n  {{'custom.devices-table.add-device.activateSim'| translate }}\r\n</mat-checkbox>\r\n\r\n<div *ngIf=\"editEntityFormGroup.get('general').get('activateSIM').value\"\r\n     formGroupName=\"connectivity\" style=\"margin-top: 10px;\">\r\n\r\n  <div class=\"flex flex-row gap-2 sm:flex-col\">\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n      <mat-label>{{ 'custom.devices-table.add-device.carrier'| translate }}</mat-label>\r\n      <mat-select formControlName=\"carrierSIM\" required (selectionChange)=\"onCarrierChanged()\">\r\n        <mat-option *ngFor=\"let carrier of carrierKeys\" [value]=\"carrier\">\r\n          {{ carrier }}\r\n        </mat-option>\r\n      </mat-select>\r\n      <mat-error *ngIf=\"editEntityFormGroup.get('general').get('connectivity').get('carrierSIM')?.hasError('required')\">\r\n        Carrier is required.\r\n      </mat-error>\r\n      <mat-error *ngIf=\"carrierError\">{{ carrierError }}</mat-error>\r\n    </mat-form-field>\r\n\r\n    <!-- Unified ICCID autocomplete for ALL carriers (Tech+ & Link+) -->\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n      <mat-label>ICCID</mat-label>\r\n      <input\r\n        type=\"text\"\r\n        matInput\r\n        formControlName=\"ICCID\"\r\n        [matAutocomplete]=\"autoIccid\"\r\n        (keyup)=\"filterIccidAssets()\"\r\n        (focus)=\"resetIccidFilter()\"\r\n        [matAutocompleteDisabled]=\"isIccidLoading\"\r\n        required\r\n        autocomplete=\"off\" />\r\n      <mat-autocomplete\r\n        #autoIccid=\"matAutocomplete\"\r\n        [displayWith]=\"displayIccidAsset\"\r\n        (optionSelected)=\"onIccidSelected($event)\">\r\n        <mat-option *ngFor=\"let asset of filteredIccidAssets\" [value]=\"asset\">\r\n          {{ asset.name.startsWith('wsim_') ? asset.name.substring(5) : asset.name }}\r\n        </mat-option>\r\n        <mat-option *ngIf=\"!isIccidLoading && iccidNoResults\" disabled>\r\n          No ICCID assets found\r\n        </mat-option>\r\n        <mat-option *ngIf=\"isIccidLoading\" class=\"text-gray-400\" disabled>\r\n          Loading...\r\n        </mat-option>\r\n      </mat-autocomplete>\r\n      <mat-error *ngIf=\"editEntityFormGroup.get('general.connectivity.ICCID').hasError('required')\">\r\n        ICCID is required.\r\n      </mat-error>\r\n      <mat-error *ngIf=\"editEntityFormGroup.get('general.connectivity.ICCID').hasError('invalidSelection')\">\r\n        Choose a valid ICCID.\r\n      </mat-error>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <!-- Unified read-only info for ALL carriers -->\r\n  <div class=\"flex flex-row gap-2 w-full sm:flex-col\">\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n      <mat-label>Assigned Device</mat-label>\r\n      <input matInput [value]=\"iccidDeviceName\" [disabled]=\"true\" [matTooltip]=\"iccidDeviceName\" />\r\n      <mat-hint *ngIf=\"iccidDeviceAssigned\">Already assigned to device.</mat-hint>\r\n    </mat-form-field>\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n      <mat-label>SIM Status</mat-label>\r\n      <input matInput [value]=\"iccidSimStatusLabel\" [disabled]=\"true\" />\r\n      <mat-hint *ngIf=\"!iccidDeviceAssigned && iccidCanActivate && iccidSimStatusId !== null && iccidSimStatusId !== 2\">\r\n        SIM will be activated.\r\n      </mat-hint>\r\n      <mat-hint *ngIf=\"!iccidDeviceAssigned && !iccidCanActivate && iccidSimStatusId !== null && iccidSimStatusId !== 2\">\r\n        SIM cannot be activated!\r\n      </mat-hint>\r\n    </mat-form-field>\r\n  </div>\r\n</div>\r\n`;\r\n\r\nasync function fetchDeviceProfileById(deviceProfileId) {\r\n  try {\r\n    const token = await getJwtToken();\r\n    const response = await fetch(`${API_BASE}/deviceProfile/${deviceProfileId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Authorization': `Bearer ${token}`\r\n      }\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`API error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    const profile = await response.json();\r\n    return profile;\r\n  } catch (error) {\r\n    console.error('Failed to load DeviceProfile via REST API:', error);\r\n    return null;\r\n  }\r\n}\r\nfunction pageLink(pageSize, page = 0, textSearch = '', sort = { property: 'name', direction: 'ASC' }) {\r\n  return {\r\n    pageSize, page, textSearch, sortOrder: sort,\r\n    toQuery() {\r\n      const qs = new URLSearchParams();\r\n      qs.set('pageSize', String(this.pageSize));\r\n      qs.set('page', String(this.page));\r\n      if (this.textSearch) qs.set('textSearch', this.textSearch);\r\n      if (this.sortOrder?.property)  qs.set('sortProperty', this.sortOrder.property);\r\n      if (this.sortOrder?.direction) qs.set('sortOrder',  this.sortOrder.direction);\r\n      return `?${qs.toString()}`;\r\n    }\r\n  };\r\n}\r\n\r\nfunction onIccidSelected(vm, event, deps) {\r\n  const { widgetContext, attributeService, entityRelationService, deviceService } = deps;\r\n  const rx = widgetContext.rxjs;\r\n  const { of, forkJoin } = rx;\r\n  const { map, switchMap, catchError } = rx;\r\n\r\n  function getConnectivityGroup() {\r\n    if (vm.editEntityFormGroup) {\r\n      return vm.editEntityFormGroup.get('general')?.get('connectivity') || null;\r\n    }\r\n    if (vm.simConfigFormGroup) {\r\n      return vm.simConfigFormGroup.get('connectivity') || null;\r\n    }\r\n    return null;\r\n  }\r\n  function safeDigest() { widgetContext.$scope.$digest && widgetContext.$scope.$digest(); }\r\n\r\n  const asset = event && event.option ? event.option.value : null;\r\n\r\n  vm.iccidDeviceName = 'Loading...';\r\n  vm.iccidSimStatusLabel = 'Loading...';\r\n  vm.iccidCanActivate = false;\r\n  vm.iccidDeviceAssigned = false;\r\n  vm.iccidAssignedDeviceId = null;\r\n  vm.iccidSimStatusId = null;\r\n\r\n  if (!asset || !asset.id || !asset.id.id) { safeDigest(); return; }\r\n\r\n  const conn = getConnectivityGroup();\r\n  if (conn) conn.get('ICCID').setValue(asset);\r\n\r\n  vm.disableSave = true;\r\n  safeDigest();\r\n\r\n  const token = `${Date.now()}:${asset.id.id}`;\r\n  vm._iccidReqToken = token;\r\n\r\n  const assetId = asset.id;\r\n\r\n  const shared$ = attributeService.getEntityAttributes(assetId, 'SHARED_SCOPE', ['sim_status']).pipe(catchError(() => of([])));\r\n  const server$ = attributeService.getEntityAttributes(assetId, 'SERVER_SCOPE', ['sim_status']).pipe(catchError(() => of([])));\r\n  const rels$   = entityRelationService.findByToAndType(assetId, 'Contains').pipe(catchError(() => of([])));\r\n\r\n  forkJoin([shared$, server$, rels$]).pipe(\r\n    map(([sharedAttrs, serverAttrs, rels]) => {\r\n      const shared = Array.isArray(sharedAttrs) ? sharedAttrs : [];\r\n      const server = Array.isArray(serverAttrs) ? serverAttrs : [];\r\n      const relArr = Array.isArray(rels) ? rels : [];\r\n      const simAttr = shared.find(a => a?.key === 'sim_status') || server.find(a => a?.key === 'sim_status') || null;\r\n      const deviceRel = relArr.find(r => r?.from?.entityType === 'DEVICE') || null;\r\n\r\n      let simLabel = 'Unknown';\r\n      let simId = null;\r\n      if (simAttr && simAttr.value) {\r\n        if (typeof simAttr.value === 'object') {\r\n          simLabel = simAttr.value.label || 'Unknown';\r\n          simId = simAttr.value.id ?? null;\r\n        } else {\r\n          simLabel = String(simAttr.value);\r\n          simId = null;\r\n        }\r\n      }\r\n      return { simLabel, simId, deviceRel };\r\n    }),\r\n    switchMap(({ simLabel, simId, deviceRel }) => {\r\n      if (deviceRel?.from?.id) {\r\n        return deviceService.getDeviceInfo(deviceRel.from.id).pipe(\r\n          map(dev => ({\r\n            simLabel, simId,\r\n            assigned: true,\r\n            assignedDeviceId: deviceRel.from.id,\r\n            assignedDeviceName: (dev && dev.name) ? dev.name : deviceRel.from.id\r\n          })),\r\n          catchError(() => of({\r\n            simLabel, simId,\r\n            assigned: true,\r\n            assignedDeviceId: deviceRel.from.id,\r\n            assignedDeviceName: deviceRel.from.id\r\n          }))\r\n        );\r\n      }\r\n      return of({ simLabel, simId, assigned: false, assignedDeviceId: null, assignedDeviceName: 'Not assigned' });\r\n    })\r\n  )\r\n  .subscribe(result => {\r\n    if (vm._iccidReqToken !== token) return;\r\n\r\n    vm.iccidSimStatusLabel  = result.simLabel;\r\n    vm.iccidSimStatusId     = result.simId;\r\n    vm.iccidDeviceAssigned  = !!result.assigned;\r\n    vm.iccidAssignedDeviceId= result.assignedDeviceId;\r\n    vm.iccidDeviceName      = result.assignedDeviceName;\r\n\r\n    if (!vm.iccidDeviceAssigned && vm.iccidSimStatusId !== null) {\r\n      vm.iccidCanActivate =\r\n        vm.iccidSimStatusId === 2 ||\r\n        (Array.isArray(SIM_STATUS_TRANSITIONS)\r\n          ? SIM_STATUS_TRANSITIONS.some(t => t.from === vm.iccidSimStatusId && t.to === 2)\r\n          : true);\r\n    } else {\r\n      vm.iccidCanActivate = false;\r\n    }\r\n\r\n    vm.disableSave = false;\r\n    safeDigest();\r\n  }, _err => {\r\n    if (vm._iccidReqToken !== token) return;\r\n    vm.iccidDeviceName = 'Not assigned';\r\n    vm.iccidCanActivate = false;\r\n    vm.disableSave = false;\r\n    safeDigest();\r\n  });\r\n}\r\n\r\nfunction displayIccidAsset(asset) {\r\n  return asset && asset.name ? asset.name.replace(/^wsim_/, '') : '';\r\n}\r\n\r\nfunction filterIccidAssets(vm, deps) {\r\n  const { widgetContext, entityGroupService, pageLink } = deps;\r\n  if (!vm.iccidEntityGroupId) return;\r\n\r\n  const conn =\r\n    vm.editEntityFormGroup?.get('general')?.get('connectivity') ||\r\n    vm.simForm?.get('connectivity') ||\r\n    null;\r\n  if (!conn) return;\r\n\r\n  const iccidCtrl = conn.get('ICCID');\r\n  if (!iccidCtrl) return;\r\n\r\n  if (vm._iccidSearchTimeout) clearTimeout(vm._iccidSearchTimeout);\r\n  vm._iccidSearchTimeout = setTimeout(() => {\r\n    const rawVal = iccidCtrl.value;\r\n    const search =\r\n      typeof rawVal === 'string'\r\n        ? rawVal\r\n        : (rawVal && rawVal.name ? displayIccidAsset(rawVal) : '');\r\n\r\n    if (!search) {\r\n      vm.filteredIccidAssets = [];\r\n      vm.iccidNoResults = false;\r\n      vm.isIccidLoading = false;\r\n      widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n      return;\r\n    }\r\n\r\n    if (vm._lastIccidSearchTerm === search) return;\r\n    vm._lastIccidSearchTerm = search;\r\n\r\n    vm.isIccidLoading = true;\r\n    vm.iccidNoResults = false;\r\n\r\n    const pl = pageLink(5, 0, search, { property: 'name', direction: 'ASC' });\r\n\r\n    if (vm._iccidSub?.unsubscribe) vm._iccidSub.unsubscribe();\r\n    vm._iccidSub = entityGroupService\r\n      .getEntityGroupEntities(vm.iccidEntityGroupId, pl, 'ASSET')\r\n      .subscribe(\r\n        (pageData) => {\r\n          const items = (pageData && pageData.data) ? pageData.data : [];\r\n          vm.filteredIccidAssets = items;\r\n          vm.iccidNoResults = items.length === 0;\r\n          vm.isIccidLoading = false;\r\n          widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n        },\r\n        () => {\r\n          vm.filteredIccidAssets = [];\r\n          vm.isIccidLoading = false;\r\n          vm.iccidNoResults = true;\r\n          widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n        }\r\n      );\r\n  }, 120);\r\n}\r\n\r\nfunction resetIccidFilter(vm) {\r\n  vm.filteredIccidAssets = [];\r\n  vm.iccidNoResults = false;\r\n}\r\nconst CARRIER_GROUPS = {\r\n  // \"Name\": \"Asset Entity Group Name\"\r\n  \"Tech+\": \"WhereverSIM tech+\",\r\n  \"Link+\": \"WhereverSIM link+\"\r\n};\r\n\r\nconst SIM_STATUS_TRANSITIONS = [\r\n  { from: 2, to: 5 },\r\n  { from: 8, to: 2 },\r\n  { from: 5, to: 2 },\r\n  { from: 6, to: 2 },\r\n  { from: 20, to: 2 },\r\n  { from: 3, to: 2 }\r\n];\r\n\r\nasync function getJwtToken() {\r\n  const resp = await fetch(`${API_BASE}/auth/login`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ username: TENANT_USER, password: TENANT_PW })\r\n  });\r\n  if (!resp.ok) {\r\n    throw new Error(`Login fehlgeschlagen: ${resp.status} ${resp.statusText}`);\r\n  }\r\n  const { token } = await resp.json();\r\n  return token;\r\n}\r\nasync function getAllDeviceProfilesWithDescription() {\r\n  const token = await getJwtToken(); // dein TENANT_ADMIN Service-Token\r\n  const profilesResp = await fetch(`${API_BASE}/deviceProfiles?pageSize=1000&page=0`, {\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-Authorization': `Bearer ${token}`\r\n    }\r\n  });\r\n\r\n  if (!profilesResp.ok) {\r\n    throw new Error(`Failed to fetch profile list: ${profilesResp.status}`);\r\n  }\r\n\r\n  const pageData = await profilesResp.json();\r\n  const profileIds = pageData.data.map(p => p.id.id);\r\n\r\n  const profileDetailCalls = profileIds.map(id =>\r\n    fetch(`${API_BASE}/deviceProfile/${id}`, {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Authorization': `Bearer ${token}`\r\n      }\r\n    }).then(resp => resp.ok ? resp.json() : null)\r\n  );\r\n\r\n  return Promise.all(profileDetailCalls).then(results => results.filter(p => !!p));\r\n}\r\nasync function fetchAllGateways(widgetContext) {\r\n  // Fetch all devices that have server attribute meterType == \"Gateway\"\r\n  // Returns a Promise resolving to an array of { entityId, name, type, label }\r\n  const $inj = widgetContext.$scope.$injector;\r\n  const entityService = $inj.get(widgetContext.servicesMap.get('entityService'));\r\n\r\n  // Base query as provided, with label included in entityFields\r\n  const baseQuery = {\r\n    entityFilter: {\r\n      type: 'entityType',\r\n      entityType: 'DEVICE'\r\n    },\r\n    keyFilters: [\r\n      {\r\n        key: {\r\n          type: 'SERVER_ATTRIBUTE',\r\n          key: 'meterType'\r\n        },\r\n        valueType: 'STRING',\r\n        predicate: {\r\n          type: 'STRING',\r\n          operation: 'EQUAL',\r\n          value: {\r\n            defaultValue: 'Gateway',\r\n            dynamicValue: null\r\n          }\r\n        }\r\n      }\r\n    ],\r\n    pageLink: {\r\n      pageSize: 100,\r\n      page: 0,\r\n      dynamic: true\r\n    },\r\n    entityFields: [\r\n      { type: 'ENTITY_FIELD', key: 'name' },\r\n      { type: 'ENTITY_FIELD', key: 'type' },\r\n      { type: 'ENTITY_FIELD', key: 'label' }\r\n    ],\r\n    latestValues: [\r\n      { type: 'ATTRIBUTE', key: 'meterType' }\r\n    ]\r\n  };\r\n\r\n  function mapRowToGateway(row) {\r\n    // Preserve the full entityId object (with entityType + id)\r\n    const entityId = row && row.entityId ? row.entityId : {};\r\n    const latestFields = row && row.latest && row.latest.ENTITY_FIELD ? row.latest.ENTITY_FIELD : null;\r\n\r\n    const name =\r\n      (latestFields && latestFields.name && latestFields.name.value) ||\r\n      row.entityName ||\r\n      row.name ||\r\n      '';\r\n    const type =\r\n      (latestFields && latestFields.type && latestFields.type.value) ||\r\n      row.entityType ||\r\n      row.type ||\r\n      '';\r\n    const label =\r\n      (latestFields && latestFields.label && latestFields.label.value) ||\r\n      row.label ||\r\n      '';\r\n\r\n    return { entityId, name, type, label };\r\n  }\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const all = [];\r\n\r\n    function fetchPage(page) {\r\n      const query = {\r\n        ...baseQuery,\r\n        pageLink: {\r\n          ...baseQuery.pageLink,\r\n          page: page\r\n        }\r\n      };\r\n      entityService.findEntityDataByQuery(query).subscribe({\r\n        next: (data) => {\r\n          const rows = Array.isArray(data && data.data) ? data.data : [];\r\n          for (let i = 0; i < rows.length; i++) {\r\n            all.push(mapRowToGateway(rows[i]));\r\n          }\r\n          if (data && data.hasNext) {\r\n            fetchPage(page + 1);\r\n          } else {\r\n            console.log('Gateways list:', all);\r\n            resolve(all);\r\n          }\r\n        },\r\n        error: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    }\r\n\r\n    fetchPage(0);\r\n  });\r\n}\r\n\r\n\r\naddDevice(widgetContext, entityId, entityName, entityLabel, desiredMode);\r\n\r\nexport function addDevice(widgetContext, entityId, entityName, entityLabel, desiredMode){\r\nconst $injector               = widgetContext.$scope.$injector;\r\nconst customDialog            = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nconst assetService            = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nconst deviceService           = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nconst attributeService        = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nconst entityRelationService   = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nconst deviceProfileService    = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\r\nconst entityGroupService      = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nconst entityService           = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet   deviceProfiles;\r\n\r\n// --- Helper: fetch all Gateways (meterType == \"Gateway\") without any UI ---\r\nfunction fetchAllGateways() {\r\n  const baseQuery = {\r\n    entityFilter: { type: 'entityType', entityType: 'DEVICE' },\r\n    keyFilters: [{\r\n      key: { type: 'SERVER_ATTRIBUTE', key: 'meterType' },\r\n      valueType: 'STRING',\r\n      predicate: { type: 'STRING', operation: 'EQUAL', value: { defaultValue: 'Gateway', dynamicValue: null } }\r\n    }],\r\n    pageLink: { pageSize: 100, page: 0, dynamic: true },\r\n    entityFields: [\r\n      { type: 'ENTITY_FIELD', key: 'name' },\r\n      { type: 'ENTITY_FIELD', key: 'type' },\r\n      { type: 'ENTITY_FIELD', key: 'label' }\r\n    ],\r\n    latestValues: [{ type: 'ATTRIBUTE', key: 'meterType' }]\r\n  };\r\n\r\n  function mapRow(row) {\r\n    const latestFields = row && row.latest && row.latest.ENTITY_FIELD ? row.latest.ENTITY_FIELD : null;\r\n    const entityIdFull = row && row.entityId ? row.entityId : {};\r\n    const name  = (latestFields && latestFields.name && latestFields.name.value) || row.entityName || row.name || '';\r\n    const type  = (latestFields && latestFields.type && latestFields.type.value) || row.entityType || row.type || '';\r\n    const label = (latestFields && latestFields.label && latestFields.label.value) || row.label || '';\r\n    return { entityId: entityIdFull, name, type, label };\r\n  }\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const all = [];\r\n    function getPage(page) {\r\n      const q = Object.assign({}, baseQuery, { pageLink: Object.assign({}, baseQuery.pageLink, { page }) });\r\n      entityService.findEntityDataByQuery(q).subscribe({\r\n        next: (data) => {\r\n          const rows = Array.isArray(data && data.data) ? data.data : [];\r\n          rows.forEach(r => all.push(mapRow(r)));\r\n          if (data && data.hasNext) {\r\n            getPage(page + 1);\r\n          } else {\r\n            console.log('Gateways list:', all);\r\n            resolve(all);\r\n          }\r\n        },\r\n        error: (err) => reject(err)\r\n      });\r\n    }\r\n    getPage(0);\r\n  });\r\n}\r\n\r\nconst addDeviceHtmlTemplate = '<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form max-w-3xl mx-auto\" style=\"width:575px;\">\\n' +\r\n' <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\\n' +\r\n'    <h2 class=\"text-lg font-semibold\">{{ headerKey | translate }}</h2>\\n' +\r\n'    <span class=\"flex-1\"></span>\\n' +\r\n'    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\\n' +\r\n'      <mat-icon class=\"material-icons\">close</mat-icon>\\n' +\r\n'    </button>\\n' +\r\n'  </mat-toolbar>\\n' +\r\n'  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\\n' +\r\n'  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\\n' +\r\n'  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\\n' +\r\n'    <mat-stepper *ngIf=\"editEntityFormGroup\" #stepper [linear]=\"true\" animationDuration=\"500ms\" style=\"flex-grow: 1;\">\\n' +\r\n'      \\n' +\r\n'      <mat-step [stepControl]=\"editEntityFormGroup.get(\\'general\\')\">\\n' +\r\n'        <ng-template matStepLabel>General</ng-template>\\n' +\r\n'        <div class=\"flex flex-col items-start justify-stretch flex-grow\" [formGroup]=\"editEntityFormGroup.get(\\'general\\')\">\\n' +\r\n'            <div class=\"w-full\">\\n' +\r\n'                <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'                  <mat-label>{{ \\'custom.devices-table.type\\'| translate }}</mat-label>\\n' +\r\n'                  <input type=\"text\"\\n' +\r\n'                              matInput\\n' +\r\n'                              formControlName=\"type\"\\n' +\r\n'                              [matAutocomplete]=\"autoType\"\\n' +\r\n'                              (keyup)=\"filterProfiles()\"\\n' +\r\n'                              (focus)=\"resetFilter()\"\\n' +\r\n'                              required>\\n' +\r\n'                  <mat-autocomplete #autoType=\"matAutocomplete\" [displayWith]=\"displayProfile\">\\n' +\r\n'                    <mat-option *ngFor=\"let profile of filteredProfiles\" [value]=\"profile\">\\n' +\r\n'                      {{ profile.name }}\\n' +\r\n'                    </mat-option>\\n' +\r\n'                  </mat-autocomplete>\\n' +\r\n'                  <mat-error *ngIf=\"editEntityFormGroup.get(\\'general.type\\').hasError(\\'required\\')\">\\n' +\r\n'                    Device profile is required.\\n' +\r\n'                  </mat-error>\\n' +\r\n'                  <mat-error *ngIf=\"editEntityFormGroup.get(\\'general.type\\').hasError(\\'invalidSelection\\')\">\\n' +\r\n'                    Please select a valid device profile from the list.\\n' +\r\n'                  </mat-error>\\n' +\r\n'                </mat-form-field>\\n' +\r\n'              \\n' +\r\n'              <div>\\n' +\r\n'                <div class=\"flex flex-row gap-2 sm:flex-col sm:gap-0\">\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.name\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"entityName\" required>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'entityName\\').hasError(\\'required\\')\">\\n' +\r\n'                      Entity name is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.label\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"entityLabel\">\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'                <div formGroupName=\"attributes\" fxLayout=\"column\">\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.display-name\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"displayName\">\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.customer\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"customer\" required>\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'customer\\').hasError(\\'required\\')\">\\n' +\r\n'                        Customer is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.devices-table.location\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"location\">\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'location\\').hasError(\\'required\\')\">\\n' +\r\n'                        Location is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  <!-- Serial Number: only for deviceProfileType === \"Default\" -->\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\" *ngIf=\"deviceProfileType === \\'Default\\'\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>Serial Number</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"serialNumber\">\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  <!-- Filterable Gateway autocomplete ABOVE inactivityTimeout for Default/General-like profiles -->\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\" *ngIf=\"isGeneralLike(deviceProfileType)\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>Gateway</mat-label>\\n' +\r\n'                      <input type=\"text\"\\n' +\r\n'                             matInput\\n' +\r\n'                             formControlName=\"gatewaySelection\"\\n' +\r\n'                             [matAutocomplete]=\"autoGateway\"\\n' +\r\n'                             (keyup)=\"filterGateways()\"\\n' +\r\n'                             (focus)=\"resetGatewayFilter()\"\\n' +\r\n'                             [disabled]=\"gatewaysLoading\">\\n' +\r\n'                      <mat-autocomplete #autoGateway=\"matAutocomplete\" [displayWith]=\"displayGateway\">\\n' +\r\n'                        <mat-option *ngIf=\"gatewaysLoading\" [disabled]=\"true\">Loading gateways...</mat-option>\\n' +\r\n'                        <mat-option *ngFor=\"let gw of filteredGateways\" [value]=\"gw\">\\n' +\r\n'                          {{ gw.name }} <span *ngIf=\"gw.label\">({{ gw.label }})</span>\\n' +\r\n'                        </mat-option>\\n' +\r\n'                      </mat-autocomplete>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                      <mat-label>{{ \\'custom.inactivityTimeout\\'| translate }}</mat-label>\\n' +\r\n'                      <input type=\"number\" matInput formControlName=\"inactivityTimeout\" required>\\n' +\r\n'                      <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'inactivityTimeout\\').hasError(\\'required\\')\">\\n' +\r\n'                        Inactivity Timeout is required.\\n' +\r\n'                      </mat-error>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </div>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'\\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'Gateway\\' && editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Gateway\\'\">\\n' +\r\n'                <div formGroupName=\"attributes\" class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.gatewayId\\'| translate}}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"gatewayID\" required pattern=\"^[a-zA-Z0-9]{16}$\">\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'gatewayID\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      Gateway ID is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'gatewayID\\')?.hasError(\\'pattern\\')\">\\n' +\r\n'                      Gateway ID must be exactly 16 letters or digits.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'              \\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'Gateway\\'\">\\n' +\r\n                simControlsHtml +\r\n'              </div>\\n' +\r\n'\\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'API\\'\">\\n' +\r\n'                  <div class=\"flex flex-row justify-between items-center flex-1\" style=\"margin-top: 5px; margin-bottom: 15px;\">\\n' +\r\n'                <mat-checkbox formControlName=\"activateAPI\" style=\"flex: 0 0 50%;\">{{ \\'custom.devices-table.add-device.activateApi\\'| translate }}</mat-checkbox>\\n' +\r\n'                <mat-checkbox formControlName=\"addInverters\" style=\"flex: 0 0 50%;\">{{ \\'custom.devices-table.add-device.addInverters\\'| translate }}</mat-checkbox>\\n' +\r\n'                </div>\\n' +\r\n'                <div *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'activateAPI\\').value\" formGroupName=\"api\" style=\"margin-top:10px;\">\\n' +\r\n'                  <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.add-device.apiUrl\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"apiUrl\" required/>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').get(\\'apiUrl\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      API URL is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                    <ng-container *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').contains(\\'apiUser\\')\">\\n' +\r\n'                      <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                        <mat-label>{{\\'custom.devices-table.add-device.apiUser\\'| translate }}</mat-label>\\n' +\r\n'                        <input matInput formControlName=\"apiUser\"/>\\n' +\r\n'                      </mat-form-field>\\n' +\r\n'                    </ng-container>\\n' +\r\n'                    <ng-container *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').contains(\\'apiPassword\\')\">\\n' +\r\n'                      <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                        <mat-label>{{\\'custom.devices-table.add-device.apiPwd\\'| translate }}</mat-label>\\n' +\r\n'                        <input matInput formControlName=\"apiPassword\" password/>\\n' +\r\n'                      </mat-form-field>\\n' +\r\n'                    </ng-container>\\n' +\r\n'                  </div>\\n' +\r\n'                  <ng-container *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'api\\').contains(\\'apiToken\\')\">\\n' +\r\n'                    <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                      <mat-label>{{\\'custom.devices-table.add-device.apiToken\\'| translate }}</mat-label>\\n' +\r\n'                      <input matInput formControlName=\"apiToken\"/>\\n' +\r\n'                    </mat-form-field>\\n' +\r\n'                  </ng-container>\\n' +\r\n'                  <mat-form-field class=\"flex-1 block\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.add-device.apiSite\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"apiSiteId\" required/>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'\\n' +\r\n'              <div *ngIf=\"deviceProfileType === \\'LoRaWAN\\'\">\\n' +\r\n'                <div class=\"flex flex-row gap-2 sm:flex-col\">\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\" [formGroupName]=\"\\'attributes\\'\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.devEui\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"devEui\" required pattern=\"^[0-9A-Fa-f]{16}$\">\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'devEui\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      DevEUI is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'devEui\\')?.hasError(\\'pattern\\')\">\\n' +\r\n'                      DevEUI must be 16 hex characters (0-9, A-F).\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <mat-form-field appearance=\"fill\" class=\"flex-1\" [formGroupName]=\"\\'attributes\\'\">\\n' +\r\n'                    <mat-label>{{\\'custom.devices-table.appKey\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"appKey\" required pattern=\"^[0-9A-Fa-f]{32}$\">\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'appKey\\')?.hasError(\\'required\\')\">\\n' +\r\n'                      App Key is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                    <mat-error *ngIf=\"editEntityFormGroup.get(\\'general\\').get(\\'attributes\\').get(\\'appKey\\')?.hasError(\\'pattern\\')\">\\n' +\r\n'                      App Key must be 32 hex characters (0-9, A-F).\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'              </div>\\n' +\r\n'\\n' +\r\n'              <div class=\"fieldset-container\" *ngIf=\"thirdPartySystems?.length\">\\n' +\r\n'                <fieldset class=\"fieldset\">\\n' +\r\n'                  <legend>{{ \\'custom.add-customer.third-party-systems\\' | translate }}</legend>\\n' +\r\n'                  <div class=\"tp-grid\">\\n' +\r\n'                    <span class=\"tp-item\" *ngFor=\"let s of thirdPartySystems\"\\n' +\r\n'                          [ngClass]=\"{\\'is-disabled\\': s.disabled}\"\\n' +\r\n'                          [matTooltip]=\"tooltipFor(s)\"\\n' +\r\n'                          matTooltipPosition=\"above\"\\n' +\r\n'                          [matTooltipClass]=\"\\'tp-tooltip\\'\">\\n' +\r\n'                      <mat-checkbox class=\"tp-checkbox\"\\n' +\r\n'                                    [disabled]=\"s.disabled\"\\n' +\r\n'                                    [checked]=\"isSystemSelected(s.key)\"\\n' +\r\n'                                    (change)=\"toggleSystemSelection($event.checked, s)\">\\n' +\r\n'                        {{ s.label }}\\n' +\r\n'                      </mat-checkbox>\\n' +\r\n'                    </span>\\n' +\r\n'                  </div>\\n' +\r\n'                </fieldset>\\n' +\r\n'              </div>\\n' +\r\n'\\n' +\r\n'               <fieldset class=\"fieldset\" *ngIf=\"datapoints?.length\" style=\"margin-bottom:15px;\">\\n' +\r\n'                 <legend>{{\\'custom.devices-table.add-device.activateDatapoints\\'| translate }}</legend>\\n' +\r\n'                  <div formGroupName=\"datapoints\"\\n' +\r\n'                       class=\"flex flex-row flex-wrap gap-4\">\\n' +\r\n'                    <mat-checkbox\\n' +\r\n'                      *ngFor=\"let dp of datapoints\"\\n' +\r\n'                      class=\"flex-none basis-[45%]\"\\n' +\r\n'                      [formControlName]=\"dp.key\">\\n' +\r\n'                      {{ dp.key }}\\n' +\r\n'                    </mat-checkbox>\\n' +\r\n'                  </div>\\n' +\r\n'                </fieldset>\\n' +\r\n'            </div>\\n' +\r\n'        </div>\\n' +\r\n'        \\n' +\r\n'        <div class=\"flex flex-row gap-2 justify-end items-center\" style=\"margin-top: auto;\">\\n' +\r\n'          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ \\'action.cancel\\' | translate }}</button>\\n' +\r\n'          <button mat-button mat-raised-button color=\"primary\" type=\"button\"\\n' +\r\n'          *ngIf=\"(editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Fronius Solar Web\\' ||\\n' +\r\n'                     editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Huawei Fusion Solar\\') &&\\n' +\r\n'                    editEntityFormGroup.get(\\'general\\').get(\\'addInverters\\').value\"\\n' +\r\n'          [disabled]=\"!editEntityFormGroup.get(\\'general\\').get(\\'api\\').get(\\'apiSiteId\\').value\"\\n' +\r\n'          (click)=\"stepper.next()\">\\n' +\r\n'          {{\\'action.next\\' | translate }}\\n' +\r\n'        </button>\\n' +\r\n'          \\n' +\r\n'          <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\n' +\r\n'            *ngIf=\"!((editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Fronius Solar Web\\' ||\\n' +\r\n'                       editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Huawei Fusion Solar\\') &&\\n' +\r\n'                     editEntityFormGroup.get(\\'general\\').get(\\'addInverters\\').value)\"\\n' +\r\n'            [disabled]=\"editEntityFormGroup.invalid || !editEntityFormGroup.dirty ||  \\n' +\r\n'              (editEntityFormGroup.get(\\'general\\').get(\\'activateSIM\\').value &&  \\n' +\r\n'              editEntityFormGroup.get(\\'general\\').get(\\'connectivity\\').get(\\'carrierSIM\\').value !== \\'Tech+\\' &&  \\n' +\r\n'              (disableSave || (!iccidDeviceAssigned && !iccidCanActivate && iccidSimStatusId !== null && iccidSimStatusId !== 2)))\"> \\n' +\r\n'            {{\\'custom.devices-table.add-device.save\\' | translate }}\\n' +\r\n'          </button>\\n' +\r\n'        </div>\\n' +\r\n'      </mat-step>\\n' +\r\n'\\n' +\r\n'      <mat-step label=\"Inverters\"\\n' +\r\n'        *ngIf=\"(editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Fronius Solar Web\\' ||\\n' +\r\n'      editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name === \\'Huawei Fusion Solar\\') &&\\n' +\r\n'      editEntityFormGroup.get(\\'general\\').get(\\'addInverters\\').value\">\\n' +\r\n'        <ng-template matStepLabel>Inverters</ng-template>\\n' +\r\n'        <div formArrayName=\"inverters\">\\n' +\r\n'          \\n' +\r\n'          <div class=\"flex flex-row gap-2\" style=\"margin-bottom: 10px;\">\\n' +\r\n'            <button mat-stroked-button type=\"button\" (click)=\"addInverter()\"\\n' +\r\n'                          style=\"flex: 1; background-color: #f0f0f0; color: black;\">\\n' +\r\n'              {{\\'custom.devices-table.add-device.addInverters\\'| translate }}\\n' +\r\n'            </button>\\n' +\r\n'            <button mat-stroked-button type=\"button\" (click)=\"removeInverter()\"\\n' +\r\n'                          style=\"flex: 1; background-color: #f0f0f0; color: black;\">\\n' +\r\n'              {{\\'custom.devices-table.add-device.removeInverter\\'| translate }}\\n' +\r\n'            </button>\\n' +\r\n'          </div>\\n' +\r\n'          <fieldset class=\"fieldset\" style=\"margin-bottom: 16px;\" *ngIf=\"editEntityFormGroup.get(\\'inverters\\').controls.length > 0\">\\n' +\r\n'            <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'              <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                <mat-icon>info</mat-icon>\\n' +\r\n'              </div>\\n' +\r\n'              <div class=\"flex-1\">\\n' +\r\n'                <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                  For each inverter, at least one value must be provided for either apiSerial or deviceId.<br>All provided values must be unique.\\n' +\r\n'                </p>\\n' +\r\n'              </div>\\n' +\r\n'            </div>\\n' +\r\n'          </fieldset>\\n' +\r\n'          <fieldset class=\"fieldset\" style=\"margin-bottom: 16px; background-color: #FFE5E5;\" *ngIf=\"editEntityFormGroup.errors?.duplicateNames\">\\n' +\r\n'            <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'              <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                <mat-icon>error</mat-icon>\\n' +\r\n'              </div>\\n' +\r\n'              <div class=\"flex-1\">\\n' +\r\n'                <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                  Duplicate names were detected. Please check again!\\n' +\r\n'                </p>\\n' +\r\n'              </div>\\n' +\r\n'            </div>\\n' +\r\n'          </fieldset>\\n' +\r\n'          <fieldset class=\"fieldset\" style=\"margin-bottom: 16px; background-color: #FFE5E5;\" *ngIf=\"editEntityFormGroup.errors?.duplicateApiSerial\">\\n' +\r\n'            <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'              <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                <mat-icon>error</mat-icon>\\n' +\r\n'              </div>\\n' +\r\n'              <div class=\"flex-1\">\\n' +\r\n'                <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                  Duplicate apiSerial values were detected. Please check again!\\n' +\r\n'                </p>\\n' +\r\n'              </div>\\n' +\r\n'            </div>\\n' +\r\n'          </fieldset>\\n' +\r\n'          <fieldset class=\"fieldset\" style=\"margin-bottom: 16px; background-color: #FFE5E5;\" *ngIf=\"editEntityFormGroup.errors?.duplicateDeviceId\">\\n' +\r\n'            <div class=\"flex flex-row justify-start items-center\" style=\"padding: 10px 0;\">\\n' +\r\n'              <div style=\"width: 40px; display: flex; justify-content: center; align-items: center;\">\\n' +\r\n'                <mat-icon>error</mat-icon>\\n' +\r\n'              </div>\\n' +\r\n'              <div class=\"flex-1\">\\n' +\r\n'                <p style=\"font-size: 15px; margin: 0;\">\\n' +\r\n'                  Duplicate deviceId values were detected. Please check again!\\n' +\r\n'                </p>\\n' +\r\n'              </div>\\n' +\r\n'            </div>\\n' +\r\n'          </fieldset>\\n' +\r\n'          \\n' +\r\n'          <div *ngFor=\"let inverter of editEntityFormGroup.get(\\'inverters\\').controls; let i = index\" [formGroupName]=\"i\">\\n' +\r\n'            <fieldset class=\"fieldset\">\\n' +\r\n'                <legend>Inverter {{ i + 1 }}</legend>\\n' +\r\n'                \\n' +\r\n'                <div class=\"flex flex-row gap-2\">\\n' +\r\n'                  <mat-form-field class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.name\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"name\" required>\\n' +\r\n'                    <mat-error *ngIf=\"inverter.get(\\'name\\').hasError(\\'required\\')\">Name is required.</mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <mat-form-field class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.label\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"label\">\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'                \\n' +\r\n'                <div class=\"flex flex-row gap-2\">\\n' +\r\n'                  <mat-form-field class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.display-name\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"displayName\">\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <mat-form-field class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.add-device.apiSite\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"apiSiteId\" required>\\n' +\r\n'                    <mat-error *ngIf=\"inverter.get(\\'apiSiteId\\').hasError(\\'required\\')\">API Site Id is required.</mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'                \\n' +\r\n'                <div class=\"flex flex-row gap-2\">\\n' +\r\n'                  <mat-form-field class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.add-device.apiSerial\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"apiSerial\">\\n' +\r\n'                    <mat-error *ngIf=\"inverter.get(\\'apiSerial\\').hasError(\\'required\\')\">\\n' +\r\n'                      Value for either API Serial or Device Id is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                  <mat-form-field class=\"flex-1\">\\n' +\r\n'                    <mat-label>{{ \\'custom.devices-table.add-device.deviceId\\'| translate }}</mat-label>\\n' +\r\n'                    <input matInput formControlName=\"deviceId\">\\n' +\r\n'                    <mat-error *ngIf=\"inverter.get(\\'deviceId\\').hasError(\\'required\\')\">\\n' +\r\n'                      Either API Serial or Device Id is required.\\n' +\r\n'                    </mat-error>\\n' +\r\n'                  </mat-form-field>\\n' +\r\n'                </div>\\n' +\r\n'              </fieldset>\\n' +\r\n'          </div>\\n' +\r\n'        </div>\\n' +\r\n'        \\n' +\r\n'        <div class=\"flex flex-row gap-2 justify-end items-center\" style=\"margin-top: auto;\">\\n' +\r\n'          <button mat-button color=\"primary\" type=\"button\" (click)=\"stepper.previous()\">{{ \\'action.back\\' | translate }}</button>\\n' +\r\n'          <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\n' +\r\n'                    [disabled]=\"!areInvertersValid() ||\\n' +\r\n'            editEntityFormGroup.errors?.duplicateNames ||\\n' +\r\n'            editEntityFormGroup.errors?.duplicateApiSerial ||\\n' +\r\n'            editEntityFormGroup.errors?.duplicateDeviceId\">\\n' +\r\n'            {{ \\'custom.devices-table.add-device.save\\'| translate }}\\n' +\r\n'          </button>\\n' +\r\n'        </div>\\n' +\r\n'      </mat-step>\\n' +\r\n'\\n' +\r\n'      <mat-step [stepControl]=\"editEntityFormGroup.get(\\'credentials\\')\"\\n' +\r\n'                *ngIf=\"deviceProfileType === \\'Gateway\\' && editEntityFormGroup.get(\\'general\\').get(\\'type\\').value?.name !== \\'Gateway\\'\">\\n' +\r\n'        <ng-template matStepLabel>{{ \\'custom.devices-table.add-device.credentials\\'| translate }}</ng-template>\\n' +\r\n'        <div class=\"flex flex-col items-start justify-stretch\" style=\"margin-top: 30px;\" [formGroup]=\"editEntityFormGroup.get(\\'credentials\\')\">\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.credentialsType\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput formControlName=\"credentialsType\" readonly>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.clientId\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput formControlName=\"clientId\" required>\\n' +\r\n'            <button\\n' +\r\n'              mat-icon-button\\n' +\r\n'              type=\"button\"\\n' +\r\n'              matSuffix\\n' +\r\n'              [matTooltip]=\"\\'custom.devices-table.add-device.copyClientId\\' | translate\"\\n' +\r\n'              (click)=\"copyToClipboard($event, \\'credentials.clientId\\')\">\\n' +\r\n'              <mat-icon>content_copy</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <mat-error *ngIf=\"editEntityFormGroup.get(\\'credentials\\').get(\\'clientId\\')?.hasError(\\'required\\')\">\\n' +\r\n'              Client ID is required.\\n' +\r\n'            </mat-error>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.userName\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput formControlName=\"userName\" required>\\n' +\r\n'            <button\\n' +\r\n'              mat-icon-button\\n' +\r\n'              type=\"button\"\\n' +\r\n'              matSuffix\\n' +\r\n'              [matTooltip]=\"\\'custom.devices-table.add-device.copyUserName\\' | translate\"\\n' +\r\n'              (click)=\"copyToClipboard($event, \\'credentials.userName\\')\">\\n' +\r\n'              <mat-icon>content_copy</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <mat-error *ngIf=\"editEntityFormGroup.get(\\'credentials\\').get(\\'userName\\')?.hasError(\\'required\\')\">\\n' +\r\n'              User Name is required.\\n' +\r\n'            </mat-error>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'          <mat-form-field appearance=\"fill\" class=\"w-full\">\\n' +\r\n'            <mat-label>{{ \\'custom.devices-table.add-device.pwd\\'| translate }}</mat-label>\\n' +\r\n'            <input matInput [type]=\"hidePassword ? \\'password\\' : \\'text\\'\" formControlName=\"password\" required>\\n' +\r\n'            <button mat-icon-button type=\"button\" matSuffix matTooltip=\"{{ hidePassword ? ( \\'custom.devices-table.add-device.showPwd\\'| translate) : (\\'custom.devices-table.add-device.hidePwd\\' | translate) }}\" (click)=\"togglePasswordVisibility()\">\\n' +\r\n'              <mat-icon>{{ hidePassword ? \\'visibility\\' : \\'visibility_off\\' }}</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <button mat-icon-button type=\"button\" matSuffix\\n' +\r\n'              [matTooltip]=\"\\'custom.devices-table.add-device.copyPwd\\' | translate\"\\n' +\r\n'              (click)=\"copyToClipboard($event, \\'credentials.password\\')\">\\n' +\r\n'              <mat-icon>content_copy</mat-icon>\\n' +\r\n'            </button>\\n' +\r\n'            <mat-error *ngIf=\"editEntityFormGroup.get(\\'credentials\\').get(\\'password\\')?.hasError(\\'required\\')\">\\n' +\r\n'              Password is required.\\n' +\r\n'            </mat-error>\\n' +\r\n'          </mat-form-field>\\n' +\r\n'        </div>\\n' +\r\n'        <div class=\"flex flex-row gap-2 justify-end items-center\" style=\"margin-top: auto;\">\\n' +\r\n'          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ \\'action.cancel\\' | translate }}</button>\\n' +\r\n'          <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\n' +\r\n'                    [disabled]=\"editEntityFormGroup.invalid || !editEntityFormGroup.dirty\">\\n' +\r\n'            {{ \\'custom.devices-table.add-device.save\\'| translate }}\\n' +\r\n'          </button>\\n' +\r\n'        </div>\\n' +\r\n'      </mat-step>\\n' +\r\n'    </mat-stepper>\\n' +\r\n'  </div>\\n' +\r\n'</form>\\n';\r\n\r\nconst addDeviceCSS =\r\n  '.device-item {\\n' +\r\n  '    line-height: 24px;\\n' +\r\n  '    width: 100%;\\n' +\r\n  '    padding-top: 8px;\\n' +\r\n  '    padding-bottom: 8px;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.device-item .device-name {\\n' +\r\n  '    font-size: 12px;\\n' +\r\n  '    opacity: 0.7;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.device-item .device-type {\\n' +\r\n  '    font-size: 14px;\\n' +\r\n  '    opacity: 0.7;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  'mat-option {\\n' +\r\n  '    height: auto !important;\\n' +\r\n  '    white-space: normal !important;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.mat-select-value-text {\\n' +\r\n  '    display: block;\\n' +\r\n  '    width: 100%;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\\n' +\r\n  '    background-color: rgba(244, 249, 254, 0.5) !important;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.add-entity-form .mat-mdc-form-field-focus-overlay {\\n' +\r\n  '    background-color: #F4F9FE !important;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.add-entity-form .mdc-text-field--filled:not(.mdc-text-field--disabled) {\\n' +\r\n  '    background-color: #F4F9FE !important;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.add-entity-form .mat-mdc-form-field-focus-overlay {\\n' +\r\n  '    background-color: #F4F9FE !important;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  'mat-icon {\\n' +\r\n  '    vertical-align: middle;\\n' +\r\n  '    margin-right: 4px;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.fieldset {\\n' +\r\n  '    border: 1px solid #e2e8f0;\\n' +\r\n  '    background: #ffffff;\\n' +\r\n  '    color: #334155;\\n' +\r\n  '    border-radius: 6px;\\n' +\r\n  '    padding-bottom: 1px;\\n' +\r\n  '    padding-top: 1px;\\n' +\r\n  '    padding-left: 10px;\\n' +\r\n  '    padding-right: 10px;\\n' +\r\n  '}\\n' +\r\n  '.fieldset-legend {\\n' +\r\n  '    margin-bottom: 0.375rem;\\n' +\r\n  '    color: #334155;\\n' +\r\n  '    background: #ffffff;\\n' +\r\n  '    font-weight: 300;\\n' +\r\n  '    border-radius: 6px;\\n' +\r\n  '    padding: 2px;\\n' +\r\n  '}\\n' +\r\n  '.fieldset-container {\\n' +\r\n  '    padding-bottom: 10px;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.disabled-checkbox {\\n' +\r\n  '    pointer-events: none;\\n' +\r\n  '    opacity: 0.5;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.disabled-fields {\\n' +\r\n  '    pointer-events: none;\\n' +\r\n  '    opacity: 0.5;\\n' +\r\n  '}\\n' +\r\n  '\\n' +\r\n  '.tp-grid {\\n' +\r\n  '    display: flex;\\n' +\r\n  '    flex-wrap: wrap;\\n' +\r\n  '    gap: 8px 16px;\\n' +\r\n  '    align-items: flex-start;\\n' +\r\n  '}\\n' +\r\n  '.tp-item {\\n' +\r\n  '    display: inline-flex;\\n' +\r\n  '    align-items: center;\\n' +\r\n  '    flex: 0 0 45%;\\n' +\r\n  '}\\n' +\r\n  '@media (max-width: 640px) {\\n' +\r\n  '  .tp-item { flex-basis: 100%; }\\n' +\r\n  '}\\n' +\r\n  '.tp-item.is-disabled {\\n' +\r\n  '    opacity: 0.6;\\n' +\r\n  '    pointer-events: none;\\n' +\r\n  '}\\n' +\r\n  '.tp-checkbox {\\n' +\r\n  '    line-height: 20px;\\n' +\r\n  '}\\n' +\r\n  '/* Ensure long labels wrap nicely */\\n' +\r\n  '.tp-item .mdc-form-field,\\n' +\r\n  '.tp-item .mat-mdc-checkbox .mdc-form-field,\\n' +\r\n  '.tp-item .mat-checkbox-layout {\\n' +\r\n  '    white-space: normal;\\n' +\r\n  '}\\n' +\r\n  '.tp-tooltip {\\n' +\r\n  '    max-width: 360px;\\n' +\r\n  '    white-space: normal;\\n' +\r\n  '    line-height: 1.25;\\n' +\r\n  '    font-size: 12px;\\n' +\r\n  '    text-align: left;\\n' +\r\n  '}\\n';\r\n\r\nconst cssParser = new cssjs();\r\ncssParser.testMode = false; \r\ncssParser.cssPreviewNamespace = 'add-device-dialog';\r\ncssParser.createStyleElement('add-device-dialog', addDeviceCSS,'nonamespace');\r\n\r\ngetAllDeviceProfilesWithDescription().then(function(fullProfiles) {\r\n  deviceProfiles = fullProfiles.filter(function(profile) {\r\n    var desc;\r\n    try {\r\n      desc = JSON.parse(profile.description || '{}');\r\n    } catch (e) {\r\n      return desiredMode === 'Both';\r\n    }\r\n    var tp = (desc.general  && desc.general.deviceProfileType)\r\n      || (desc.General  && desc.General.deviceProfileType)\r\n      || desc.deviceProfileType\r\n      || '';\r\n    if (desiredMode === 'Gateway') return tp === 'Gateway';\r\n    if (desiredMode === 'Device')  return tp !== 'Gateway';\r\n    return true;\r\n  });\r\n  openAddEntityDialog();\r\n});\r\n\r\nlet user = widgetContext.currentUser;\r\nlet ownerRef;\r\nownerRef = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n\r\nfunction openAddEntityDialog() {\r\n  customDialog.customDialog(addDeviceHtmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction getSelectedCustomerName() {\r\n  let stateParams = widgetContext.stateController.getStateParams();\r\n  try {\r\n    return stateParams.selectedCustomer?.entityName || '';\r\n  } catch (error) {\r\n    return '';\r\n  }\r\n}\r\n\r\nfunction getSelectedLocationName() {\r\n  let stateParams = widgetContext.stateController.getStateParams();\r\n  try {\r\n    const loc = stateParams.selectedLocation;\r\n    return loc ? {\r\n      entityName: loc.entityName || '',\r\n      entityLabel: loc.entityLabel || ''\r\n    } : { entityName: '', entityLabel: '' };\r\n  } catch (error) {\r\n    const hasAssetEntity = stateParams.entityId && stateParams.entityId.entityType === 'ASSET';\r\n    if (hasAssetEntity) {\r\n      return { entityName: stateParams.entityName || '', entityLabel: '' };\r\n    } else {\r\n      return { entityName: '', entityLabel: '' };\r\n    }\r\n  }\r\n}\r\n\r\nfunction generateRandomPassword() {\r\n  const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';\r\n  let password = '';\r\n  for (let i = 0; i < 20; i++) {\r\n    password += chars.charAt(Math.floor(Math.random() * Math.floor(chars.length)));\r\n  }\r\n  return password;\r\n}\r\n\r\nfunction getAttrValue(attrList, key) {\r\n  if (!attrList || !attrList.length) return null;\r\n  const found = attrList.find(function(a) { return a.key === key; });\r\n  return found ? found.value : null;\r\n}\r\n\r\nfunction parseForwardToArray(val) {\r\n  if (!val) return [];\r\n  if (typeof val === 'string') {\r\n    try { val = JSON.parse(val); } catch (e) { return []; }\r\n  }\r\n  return Array.isArray(val) ? val : [];\r\n}\r\n\r\n// -----------------------------------------------------\r\n\r\nfunction AddEntityDialogController(instance) {\r\n  let vm = instance;\r\n  vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\r\n  vm.deviceProfiles = deviceProfiles;\r\n  vm.filteredProfiles = deviceProfiles ? deviceProfiles.slice() : [];\r\n  vm.selectedDeviceProfile = null;\r\n  vm.deviceProfileType = null;\r\n  vm.hidePassword = true;\r\n  vm.datapoints = [];\r\n  vm.rawDatapoints = {};\r\n  vm.datapointsArray = [];\r\n\r\n  // Gateways data + filtering\r\n  vm.gateways = [];\r\n  vm.filteredGateways = [];\r\n  vm.gatewaysLoading = false;\r\n\r\n  vm.iccidAssets = [];\r\n  vm.filteredIccidAssets = [];\r\n  vm.isIccidLoading = false;\r\n  vm.iccidNoResults = false;\r\n  let iccidSearchTimeout = null;\r\n  vm.iccidEntityGroupId = null;\r\n  vm.carrierError = null;\r\n  vm.carrierKeys = Object.keys(CARRIER_GROUPS);\r\n  vm.iccidDeviceName = null;\r\n  vm.iccidSimStatusLabel = null;\r\n  vm.iccidDeviceAssigned = false;\r\n  vm.iccidAssignedDeviceId = null;\r\n  vm.iccidSimStatusId = null;\r\n  vm.iccidCanActivate = false;\r\n  vm.disableSave = false;\r\n\r\n  vm.thirdPartySystems = []; \r\n\r\n  vm.desiredMode = desiredMode;\r\n\r\n  vm.headerKey = (vm.desiredMode === 'Gateway'\r\n    ? 'custom.devices-table.add-gateway.titel'\r\n    : 'custom.devices-table.add-device.titel');\r\n\r\n  // Helper to treat \"Default\" like \"General\"\r\n  vm.isGeneralLike = function(t) {\r\n    const v = (t || '').toLowerCase();\r\n    return v === 'general' || v === 'default';\r\n  };\r\n\r\n  const fb = vm.fb;\r\n  const validators = vm.validators;\r\n  const selectedLocation = getSelectedLocationName();\r\n  const locName   = selectedLocation.entityName || null;\r\n  const initialDevName = locName || '';\r\n  const locLabel  = selectedLocation.entityLabel || '';\r\n  const custName  = getSelectedCustomerName();\r\n\r\n  vm.editEntityFormGroup = fb.group({\r\n    general: fb.group({\r\n      type:        [null, [validators.required, selectionObjectValidator]],\r\n      entityName:  [initialDevName, [validators.required]],\r\n      entityLabel: [locLabel],\r\n      attributes: fb.group({\r\n        displayName:      [''],\r\n        customer:         [custName, [validators.required]],\r\n        location:         [locName],\r\n        serialNumber:     [''],\r\n        gatewaySelection: [null],\r\n        gatewayName:      [''],\r\n        inactivityTimeout:['60', [validators.required]],\r\n        devEui:           [null],\r\n        appKey:           [null],\r\n        gatewayID:        [null]\r\n      }),\r\n      thirdPartySystems: fb.control([]),\r\n\r\n      activateSIM:  [false],\r\n      connectivity: fb.group({\r\n        ICCID:     [null],\r\n        carrierSIM:[null],\r\n        statusSIM: [null]\r\n      }),\r\n      activateAPI:  [false],\r\n      addInverters:[false],\r\n      api: fb.group({\r\n        apiUrl:     [null],\r\n        apiUser:    [null],\r\n        apiPassword:[null],\r\n        apiToken:   [null],\r\n        apiSiteId:  [null],\r\n        apiSerial:  [null]\r\n      }),\r\n      datapoints: fb.group({})\r\n    }),\r\n    credentials: fb.group({\r\n      credentialsType:['MQTT_BASIC'],\r\n      clientId:       [initialDevName, [validators.required]],\r\n      userName:       ['pke', [validators.required]],\r\n      password:       [generateRandomPassword(), [validators.required]]\r\n    }),\r\n    inverters: fb.array([]),\r\n    relations: fb.array([])\r\n  }, { validators: uniqueInverterValidator });\r\n\r\n  loadThirdPartySystems();\r\n\r\n  function loadThirdPartySystems() {\r\n    if (!ownerRef || !ownerRef.entityType || !ownerRef.id) {\r\n      vm.thirdPartySystems = [];\r\n      return;\r\n    }\r\n    attributeService.getEntityAttributes(\r\n      { entityType: ownerRef.entityType, id: ownerRef.id },\r\n      'SERVER_SCOPE',\r\n      ['forwardTo']\r\n    ).subscribe(function(attrList) {\r\n      const raw = getAttrValue(attrList, 'forwardTo');\r\n      const options = parseForwardToArray(raw);\r\n      const map = new Map();\r\n      (options || []).forEach(function(x) {\r\n        const key = x && (x['system key'] || x.key || x.system);\r\n        if (!key) return;\r\n        map.set(key, {\r\n          key: key,\r\n          label: x['system label'] || x.label || key,\r\n          note: x.note || '',\r\n          legacyOnly: !!x.legacyOnly\r\n        });\r\n      });\r\n\r\n      const uiList = [];\r\n      map.forEach(function(v) {\r\n        if (!v.legacyOnly) {\r\n          uiList.push({ key: v.key, label: v.label, note: v.note, legacyOnly: v.legacyOnly, disabled: false });\r\n        }\r\n      });\r\n\r\n      vm.thirdPartySystems = uiList.sort(function(a, b) { return a.label.localeCompare(b.label); });\r\n\r\n      if (vm.thirdPartySystems.length === 1) {\r\n        vm.editEntityFormGroup.get('general').get('thirdPartySystems')\r\n          .setValue([vm.thirdPartySystems[0].key], { emitEvent: false });\r\n      }\r\n    });\r\n  }\r\n\r\n  vm.tooltipFor = function(s) {\r\n    const parts = [];\r\n    if (s.note) parts.push(s.note);\r\n    if (s.legacyOnly) parts.push('Legacy-only: kept for existing devices');\r\n    return parts.join(' \\\\u2022 ');\r\n  };\r\n\r\n  vm.isSystemSelected = function(systemKey) {\r\n    const selected = vm.editEntityFormGroup.get('general').get('thirdPartySystems').value || [];\r\n    return selected.indexOf(systemKey) !== -1;\r\n  };\r\n\r\n  vm.toggleSystemSelection = function(checked, sys) {\r\n    if (sys.disabled) return;\r\n    const ctrl = vm.editEntityFormGroup.get('general').get('thirdPartySystems');\r\n    var selected = (ctrl.value || []).slice();\r\n    if (checked) {\r\n      if (selected.indexOf(sys.key) === -1) selected.push(sys.key);\r\n    } else {\r\n      selected = selected.filter(function(k) { return k !== sys.key; });\r\n    }\r\n    ctrl.setValue(selected);\r\n    ctrl.markAsDirty();\r\n  };\r\n\r\n  // Gateways loader for Default/General-like device profile type\r\n  async function ensureGatewaysLoadedIfGeneralLike() {\r\n    if (vm.isGeneralLike(vm.deviceProfileType)) {\r\n      vm.gatewaysLoading = true;\r\n      widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n      try {\r\n        const list = await fetchAllGateways();\r\n        vm.gateways = Array.isArray(list) ? list : [];\r\n        vm.filteredGateways = vm.gateways.slice();\r\n      } catch (e) {\r\n        vm.gateways = [];\r\n        vm.filteredGateways = [];\r\n      } finally {\r\n        vm.gatewaysLoading = false;\r\n        widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n      }\r\n    }\r\n  }\r\n\r\n  // Gateway autocomplete helpers\r\n  vm.displayGateway = function(gw) {\r\n    return gw && typeof gw === 'object' ? (gw.name || '') : (gw || '');\r\n  };\r\n  vm.filterGateways = function () {\r\n    const raw = vm.editEntityFormGroup.get('general').get('attributes').get('gatewaySelection').value;\r\n    const q = (typeof raw === 'string' ? raw.toLowerCase() : '');\r\n    vm.filteredGateways = (vm.gateways || []).filter(function(gw) {\r\n      if (!q) return true;\r\n      const n = (gw.name || '').toLowerCase();\r\n      const l = (gw.label || '').toLowerCase();\r\n      const t = (gw.type || '').toLowerCase();\r\n      return n.indexOf(q) !== -1 || l.indexOf(q) !== -1 || t.indexOf(q) !== -1;\r\n    });\r\n  };\r\n  vm.resetGatewayFilter = function() {\r\n    vm.filteredGateways = (vm.gateways || []).slice();\r\n  };\r\n\r\n  // When a gateway is selected, keep gatewayName in attributes for persistence\r\n  vm.editEntityFormGroup.get('general').get('attributes').get('gatewaySelection').valueChanges.subscribe(function(val){\r\n    const name = (val && typeof val === 'object') ? (val.name || '') : (typeof val === 'string' ? val : '');\r\n    vm.editEntityFormGroup.get('general').get('attributes').get('gatewayName').setValue(name, { emitEvent: false });\r\n  });\r\n\r\n  // expose to template (SIM logic EXACT as original wiring)\r\n  vm.displayIccidAsset  = displayIccidAsset;\r\n  vm.filterIccidAssets  = () => filterIccidAssets(vm, { widgetContext, entityGroupService, pageLink });\r\n  vm.resetIccidFilter   = () => resetIccidFilter(vm);\r\n  vm.onIccidSelected = (event) => onIccidSelected(vm, event, {\r\n    widgetContext,\r\n    attributeService,\r\n    entityRelationService,\r\n    deviceService\r\n  });\r\n\r\n  vm.onCarrierChanged = async function () {\r\n    vm.carrierError = null;\r\n\r\n    const general = vm.editEntityFormGroup.get('general');\r\n    const connectivity = general?.get('connectivity');\r\n    if (!connectivity) return;\r\n\r\n    const carrierCtrl = connectivity.get('carrierSIM');\r\n    const iccidCtrl   = connectivity.get('ICCID');\r\n\r\n    const simActive = general.get('activateSIM')?.value === true;\r\n    const carrier   = carrierCtrl?.value || null;\r\n\r\n    const clear = (c) => { c.clearValidators(); c.setErrors(null); c.updateValueAndValidity({ emitEvent: false }); };\r\n\r\n    vm.iccidEntityGroupId = null;\r\n    vm.filteredIccidAssets = [];\r\n\r\n    if (!simActive) {\r\n      iccidCtrl.setValue(null,   { emitEvent: false });\r\n      [iccidCtrl, carrierCtrl].forEach(clear);\r\n      widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n      return;\r\n    }\r\n\r\n    carrierCtrl.setValidators([vm.validators.required]);\r\n    carrierCtrl.updateValueAndValidity({ emitEvent: false });\r\n\r\n    if (!carrier) {\r\n      clear(iccidCtrl);\r\n      widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n      return;\r\n    }\r\n\r\n    const iccidValidators = [vm.validators.required];\r\n    if (typeof selectionObjectValidator === 'function') iccidValidators.push(selectionObjectValidator);\r\n    iccidCtrl.setValidators(iccidValidators);\r\n    iccidCtrl.updateValueAndValidity({ emitEvent: false });\r\n\r\n    const groupName = CARRIER_GROUPS[carrier];\r\n    if (!groupName) {\r\n      vm.carrierError = 'Unsupported carrier: ' + carrier;\r\n      widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const groupsPL = pageLink(100, 0, '', { property: 'name', direction: 'ASC' });\r\n      const page = await entityGroupService.getEntityGroupsByPageLink(groupsPL, 'ASSET').toPromise();\r\n      const groups = (page && page.data) ? page.data : [];\r\n      const match = groups.find(g => g?.name === groupName);\r\n      if (!match?.id?.id) throw new Error('Entity group not found: ' + groupName);\r\n\r\n      vm.iccidEntityGroupId = match.id.id;\r\n      iccidCtrl.setValue('', { emitEvent: false }); // ready for typing/search\r\n      vm.filteredIccidAssets = [];\r\n    } catch (err) {\r\n      vm.iccidEntityGroupId = null;\r\n      vm.filteredIccidAssets = [];\r\n      vm.carrierError = err?.message || 'Failed to list group entities.';\r\n    }\r\n\r\n    widgetContext.$scope.$digest && widgetContext.$scope.$digest();\r\n  };\r\n\r\n  vm.editEntityFormGroup.get('general.type').valueChanges.subscribe(() => {\r\n    vm.editEntityFormGroup.get('general.activateSIM').setValue(false, { emitEvent: true });\r\n  });\r\n\r\n  vm.editEntityFormGroup.get('general').get('activateSIM').valueChanges.subscribe(value => {\r\n    const general = vm.editEntityFormGroup.get('general');\r\n    const conn    = general?.get('connectivity');\r\n    if (!conn) return;\r\n\r\n    const iccid   = conn.get('ICCID');\r\n    const carrier = conn.get('carrierSIM');\r\n\r\n    if (value === true) {\r\n      if (!carrier.value) carrier.setValue('Link+', { emitEvent: false }); // default selection\r\n    } else {\r\n      iccid.setValue(null,   { emitEvent: false });\r\n      carrier.setValue(null, { emitEvent: false });\r\n    }\r\n    vm.onCarrierChanged();\r\n  });\r\n\r\n  vm.filterProfiles = function () {\r\n    var raw = vm.editEntityFormGroup.get('general.type').value;\r\n    var searchValue = (typeof raw === 'string' ? raw.toLowerCase() : '');\r\n    vm.filteredProfiles = vm.deviceProfiles.filter(function(p) {\r\n      var name = (p.name || '').toLowerCase();\r\n      var nameMatch = !searchValue || name.indexOf(searchValue) !== -1;\r\n\r\n      var desc;\r\n      try {\r\n        desc = JSON.parse(p.description || '{}');\r\n      } catch (e) {\r\n        desc = {};\r\n      }\r\n      var tp = (desc.general && desc.general.deviceProfileType)\r\n               || (desc.General && desc.General.deviceProfileType)\r\n               || desc.deviceProfileType\r\n               || '';\r\n\r\n      if (desiredMode === 'Gateway') {\r\n        return nameMatch && tp === 'Gateway';\r\n      }\r\n      if (desiredMode === 'Device') {\r\n        return nameMatch && tp.toLowerCase() !== 'gateway';\r\n      }\r\n      return nameMatch;\r\n    });\r\n  };\r\n  vm.resetFilter = function () {\r\n    vm.filteredProfiles = vm.deviceProfiles.slice();\r\n  };\r\n\r\n  vm.updateDeviceProfile = async function() {\r\n    const selectedDeviceProfileId = vm.editEntityFormGroup.get('general').get('type').value.id.id;\r\n    const selectedProfile = vm.deviceProfiles.find(function(p) { return p.id.id === selectedDeviceProfileId; });\r\n    if (selectedProfile) {\r\n      vm.selectedDeviceProfile = selectedProfile;\r\n    }\r\n\r\n    const profile = await fetchDeviceProfileById(selectedDeviceProfileId);\r\n    if (profile) {\r\n      let desc = profile.description;\r\n      try {\r\n        desc = typeof desc === 'string' ? JSON.parse(desc.trim()) : desc;\r\n      } catch (e) {\r\n        console.error('Error parsing profile.description:', e);\r\n        desc = {};\r\n      }\r\n\r\n      vm.rawDatapoints = desc.datapoints || desc.DataPoints || {};\r\n      vm.datapointsArray = Object.entries(vm.rawDatapoints).map(function(entry) {\r\n        var key = entry[0], meta = entry[1];\r\n        return Object.assign({ key: key }, meta);\r\n      });\r\n      parseDeviceProfileDescription(desc);\r\n      applyValidatorsForDeviceProfile();\r\n      await ensureGatewaysLoadedIfGeneralLike();\r\n    }\r\n  };\r\n\r\n  vm.displayProfile = function(profile) {\r\n    return profile && typeof profile === 'object' ? profile.name : profile;\r\n  };\r\n\r\n  vm.areInvertersValid = function() {\r\n    const invertersArray = vm.editEntityFormGroup.get('inverters');\r\n    for (let i = 0; i < invertersArray.length; i++) {\r\n      const group = invertersArray.at(i);\r\n      const name = group.get('name').value;\r\n      const apiUrl = group.get('apiUrl').value;\r\n      const apiSiteId = group.get('apiSiteId').value;\r\n      const apiSerial = group.get('apiSerial').value;\r\n      const deviceId = group.get('deviceId').value;\r\n      if (!(name && apiSiteId && apiUrl && (apiSerial || deviceId))) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  function selectionObjectValidator(control) {\r\n    if (!control.value) {\r\n      return null;\r\n    }\r\n    return (typeof control.value === 'object' && control.value !== null)\r\n      ? null\r\n      : { invalidSelection: true };\r\n  }\r\n\r\n  function uniqueInverterValidator(formGroup) {\r\n    const typeControl = formGroup.get('general').get('type');\r\n    if (!typeControl || !typeControl.value || typeof typeControl.value !== 'object' || !typeControl.value.name) {\r\n      return null;\r\n    }\r\n\r\n    const selectedName = typeControl.value.name.trim().toLowerCase();\r\n    if (selectedName !== 'fronius solar web' && selectedName !== 'huawei fusion solar') {\r\n      return null;\r\n    }\r\n\r\n    const errors = {};\r\n    const generalName = formGroup.get('general').get('entityName').value;\r\n    const names = [];\r\n    if (generalName) {\r\n      names.push(generalName.trim());\r\n    }\r\n    const invertersArray = formGroup.get('inverters');\r\n    if (invertersArray && invertersArray.controls) {\r\n      invertersArray.controls.forEach(function(ctrl) {\r\n        const inverterName = ctrl.get('name').value;\r\n        if (inverterName) {\r\n          names.push(inverterName.trim());\r\n        }\r\n      });\r\n    }\r\n    if (new Set(names).size !== names.length) {\r\n      errors.duplicateNames = true;\r\n    }\r\n    return Object.keys(errors).length > 0 ? errors : null;\r\n  }\r\n\r\n  function parseDeviceProfileDescription(parsedDescription) {\r\n    const gen = parsedDescription.General || parsedDescription.general || {};\r\n    vm.deviceProfileType = gen.deviceProfileType || null;\r\n\r\n    const dpSection = parsedDescription.datapoints\r\n      || parsedDescription.DataPoints\r\n      || (parsedDescription.General && parsedDescription.General.datapoints)\r\n      || {};\r\n\r\n    vm.datapoints = Object.keys(dpSection).map(function(key) { return { key: key }; });\r\n    rebuildDatapointsControls();\r\n  }\r\n\r\n  function rebuildDatapointsControls() {\r\n    const generalGroup = vm.editEntityFormGroup.get('general');\r\n    if (generalGroup.contains('datapoints')) {\r\n      generalGroup.removeControl('datapoints');\r\n    }\r\n    const dpGroup = fb.group({});\r\n    vm.datapoints.forEach(function(dp) {\r\n      dpGroup.addControl(dp.key, fb.control(false));\r\n    });\r\n    generalGroup.addControl('datapoints', dpGroup);\r\n  }\r\n\r\n  function applyValidatorsForDeviceProfile() {\r\n    const generalGroup = vm.editEntityFormGroup.get('general');\r\n    const attributesGroup = generalGroup.get('attributes');\r\n    const devEuiControl = attributesGroup.get('devEui');\r\n    const appKeyControl = attributesGroup.get('appKey');\r\n    const gatewayIDControl = attributesGroup.get('gatewayID');\r\n\r\n    devEuiControl.clearValidators();\r\n    appKeyControl.clearValidators();\r\n    gatewayIDControl.clearValidators();\r\n\r\n    const selectedType = generalGroup.get('type').value;\r\n    const profileName = selectedType && selectedType.name ? selectedType.name : '';\r\n\r\n    if (vm.deviceProfileType === 'LoRaWAN') {\r\n      devEuiControl.setValidators([vm.validators.required]);\r\n      appKeyControl.setValidators([vm.validators.required]);\r\n    } else if (vm.deviceProfileType === 'Gateway') {\r\n      if (profileName === 'Gateway') {\r\n        gatewayIDControl.setValidators([vm.validators.required, vm.validators.pattern('[a-zA-Z0-9]{16}')]);\r\n      }\r\n      vm.editEntityFormGroup.get('credentials').disable();\r\n    } else {\r\n      vm.editEntityFormGroup.get('credentials').enable();\r\n    }\r\n\r\n    devEuiControl.updateValueAndValidity();\r\n    appKeyControl.updateValueAndValidity();\r\n    gatewayIDControl.updateValueAndValidity();\r\n  }\r\n\r\n  vm.editEntityFormGroup.get('general').get('activateSIM').valueChanges.subscribe(value => {\r\n    const general = vm.editEntityFormGroup.get('general');\r\n    const conn    = general?.get('connectivity');\r\n    if (!conn) return;\r\n\r\n    const iccid   = conn.get('ICCID');\r\n    const carrier = conn.get('carrierSIM');\r\n\r\n    if (value === true) {\r\n      if (!carrier.value) carrier.setValue('Link+', { emitEvent: false }); // default selection\r\n    } else {\r\n      iccid.setValue(null,   { emitEvent: false });\r\n      carrier.setValue(null, { emitEvent: false });\r\n    }\r\n    vm.onCarrierChanged();\r\n  });\r\n\r\n  vm.editEntityFormGroup.get('general').get('type').valueChanges.subscribe(async function(selectedType) {\r\n    if (selectedType && typeof selectedType === 'object') {\r\n      await vm.updateDeviceProfile();\r\n    }\r\n\r\n    const generalGroup = vm.editEntityFormGroup.get('general');\r\n    const apiGroup = generalGroup.get('api');\r\n\r\n    if (!selectedType || (selectedType.name !== 'Fronius Solar Web' && selectedType.name !== 'Huawei Fusion Solar')) {\r\n      vm.editEntityFormGroup.setControl('inverters', fb.array([]));\r\n    }\r\n\r\n    const currentLoc = getSelectedLocationName().entityName || '';\r\n    const trimmedLoc = currentLoc.trim();\r\n    if (trimmedLoc.length > 0) {\r\n      vm.editEntityFormGroup.get('general').patchValue({ entityName: trimmedLoc + '_' });\r\n    }\r\n\r\n    if (selectedType) {\r\n      if (selectedType.name === 'Huawei Fusion Solar') {\r\n        generalGroup.patchValue({ activateAPI: true, addInverters: false });\r\n        if (!apiGroup.contains('apiUser')) { apiGroup.addControl('apiUser', fb.control('')); } else { apiGroup.get('apiUser').setValue(''); }\r\n        if (!apiGroup.contains('apiPassword')) { apiGroup.addControl('apiPassword', fb.control('')); } else { apiGroup.get('apiPassword').setValue(''); }\r\n        if (apiGroup.contains('apiToken')) { apiGroup.removeControl('apiToken'); }\r\n        apiGroup.patchValue({ apiUrl: 'eu5.fusionsolar.huawei.com', apiSiteId: '', createPVSystem: true });\r\n      } else if (selectedType.name === 'Fronius Solar Web') {\r\n        generalGroup.patchValue({ activateAPI: true, addInverters: false });\r\n        if (apiGroup.contains('apiUser')) { apiGroup.removeControl('apiUser'); }\r\n        if (apiGroup.contains('apiPassword')) { apiGroup.removeControl('apiPassword'); }\r\n        if (apiGroup.contains('apiToken')) { apiGroup.removeControl('apiToken'); }\r\n        apiGroup.patchValue({ apiUrl: 'https://api.solarweb.com/swqapi', apiSiteId: '', createPVSystem: true });\r\n      } else {\r\n        if (!apiGroup.contains('apiUser')) { apiGroup.addControl('apiUser', fb.control(null, [])); }\r\n        if (!apiGroup.contains('apiPassword')) { apiGroup.addControl('apiPassword', fb.control(null, [])); }\r\n        if (!apiGroup.contains('apiToken')) { apiGroup.addControl('apiToken', fb.control(null, [])); }\r\n        generalGroup.patchValue({ activateAPI: false, addInverters: false });\r\n        apiGroup.patchValue({ apiUrl: null, apiSiteId: '', createPVSystem: false });\r\n      }\r\n\r\n      if (vm.deviceProfileType === 'LoRaWAN') {\r\n        const attrs = generalGroup.get('attributes');\r\n        attrs.get('devEui').reset();\r\n        attrs.get('appKey').reset();\r\n        attrs.get('devEui').markAsPristine();\r\n        attrs.get('devEui').markAsUntouched();\r\n        attrs.get('appKey').markAsPristine();\r\n        attrs.get('appKey').markAsUntouched();\r\n      }\r\n\r\n      if (apiGroup.get('apiUrl')) { apiGroup.get('apiUrl').updateValueAndValidity(); }\r\n      if (apiGroup.get('apiSiteId')) { apiGroup.get('apiSiteId').updateValueAndValidity(); }\r\n    }\r\n  });\r\n\r\n  vm.editEntityFormGroup.get('general').get('entityName').valueChanges.subscribe(function(newName) {\r\n    vm.editEntityFormGroup.get('credentials').patchValue({ clientId: newName });\r\n    const inverters = vm.editEntityFormGroup.get('inverters');\r\n    inverters.controls.forEach(function(inverterGroup) {\r\n      inverterGroup.get('name').setValue('' + newName, { emitEvent: false });\r\n    });\r\n  });\r\n\r\n  vm.editEntityFormGroup.get('general').get('api').get('apiSiteId').valueChanges.subscribe(function(newValue) {\r\n    const inverters = vm.editEntityFormGroup.get('inverters');\r\n    inverters.controls.forEach(function(inverterGroup) {\r\n      inverterGroup.get('apiSiteId').patchValue(newValue, { emitEvent: false });\r\n    });\r\n  });\r\n\r\n  vm.cancel = function() {\r\n    vm.dialogRef.close(null);\r\n  };\r\n\r\n  function saveInverters() {\r\n    const selectedType = vm.editEntityFormGroup.get('general').get('type').value;\r\n    const invertersArray = vm.editEntityFormGroup.get('inverters').value;\r\n    if (!invertersArray || invertersArray.length === 0) {\r\n      return widgetContext.rxjs.of([]);\r\n    }\r\n\r\n    const mainAttributes = vm.editEntityFormGroup.get('general').get('attributes').value;\r\n    const inactivityTimeout = parseInt(mainAttributes.inactivityTimeout, 10);\r\n    const selectedKeys = vm.editEntityFormGroup.get('general').get('thirdPartySystems').value || [];\r\n    const location = mainAttributes.location;\r\n    const customer = mainAttributes.customer;\r\n    let customerId = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n\r\n    let inverterObservables = invertersArray.map(function(inverter) {\r\n      let inverterEntity;\r\n      if (selectedType && selectedType.name === 'Fronius Solar Web') {\r\n        inverterEntity = { name: inverter.name, type: 'Fronius Solar Web', label: inverter.label, customerId: customerId };\r\n      } else if (selectedType && selectedType.name === 'Huawei Fusion Solar') {\r\n        inverterEntity = { name: inverter.name, type: 'Huawei Fusion Solar', label: inverter.label, customerId: customerId };\r\n      }\r\n      return deviceService.saveDevice(inverterEntity).pipe(\r\n        widgetContext.rxjs.catchError(function(error) { return widgetContext.rxjs.throwError(error); }),\r\n        widgetContext.rxjs.switchMap(function(savedInverter) {\r\n          let inverterAttributes = [];\r\n          function pushAttr(key, value) {\r\n            if (value !== null && value !== undefined && value !== '') {\r\n              inverterAttributes.push({ key: key, value: value });\r\n            }\r\n          }\r\n          pushAttr('apiSiteId', inverter.apiSiteId);\r\n          pushAttr('apiSerial', inverter.apiSerial);\r\n          pushAttr('deviceId', inverter.deviceId);\r\n          pushAttr('apiUrl', inverter.apiUrl);\r\n          pushAttr('inactivityTimeout', inactivityTimeout);\r\n          pushAttr('forwardTo', selectedKeys);\r\n          pushAttr('location', location);\r\n          pushAttr('customer', customer);\r\n          pushAttr('froniusApiCreate', 'system');\r\n\r\n          return attributeService.saveEntityAttributes(savedInverter.id, 'SERVER_SCOPE', inverterAttributes).pipe(\r\n            widgetContext.rxjs.map(function() { return savedInverter; })\r\n          );\r\n        })\r\n      );\r\n    });\r\n    return widgetContext.rxjs.forkJoin(inverterObservables);\r\n  }\r\n\r\n  vm.save = function() {\r\n    const carrierVal = vm.editEntityFormGroup\r\n      .get('general')?.get('connectivity')?.get('carrierSIM')?.value;\r\n\r\n    if (vm.iccidDeviceAssigned) {\r\n      openIccidAssignedDialog(widgetContext, vm);\r\n      return;\r\n    }\r\n    vm.editEntityFormGroup.markAsPristine();\r\n    const selectedType = vm.editEntityFormGroup.get('general').get('type').value;\r\n\r\n    const afterSaveCommon = function(entity) {\r\n      widgetContext.rxjs.forkJoin([\r\n        saveAttributes(entity.id),\r\n        saveCredentials(entity.id),\r\n        saveRelations(entity.id),\r\n        saveGatewayRelationIfSelected(entity.id) // create gateway relation (from GW -> to device)\r\n      ]).subscribe(function() {\r\n        widgetContext.updateAliases();\r\n        vm.dialogRef.close(null);\r\n      });\r\n    };\r\n\r\n    if ((selectedType && selectedType.name === 'Fronius Solar Web') || (selectedType && selectedType.name === 'Huawei Fusion Solar')) {\r\n      saveEntityObservable().subscribe(function(entity) {\r\n        widgetContext.rxjs.forkJoin([\r\n          saveAttributes(entity.id),\r\n          saveCredentials(entity.id),\r\n          saveRelations(entity.id)\r\n        ]).subscribe(function() {\r\n          saveInverters().subscribe(function(savedInverters) {\r\n            let groupObs;\r\n            const customerId = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n            if (selectedType && selectedType.name === 'Fronius Solar Web') {\r\n              groupObs = getOrCreateFroniusGroup(customerId).pipe(\r\n                widgetContext.rxjs.switchMap(function(group) {\r\n                  let obs = [];\r\n                  obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, entity.id.id));\r\n                  savedInverters.forEach(function(inv) {\r\n                    obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, inv.id.id));\r\n                  });\r\n                  return widgetContext.rxjs.forkJoin(obs);\r\n                })\r\n              );\r\n            } else {\r\n              groupObs = getOrCreateHuaweiGroup(customerId).pipe(\r\n                widgetContext.rxjs.switchMap(function(group) {\r\n                  let obs = [];\r\n                  obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, entity.id.id));\r\n                  savedInverters.forEach(function(inv) {\r\n                    obs.push(entityGroupService.addEntityToEntityGroup(group.id.id, inv.id.id));\r\n                  });\r\n                  return widgetContext.rxjs.forkJoin(obs);\r\n                })\r\n              );\r\n            }\r\n            saveGatewayRelationIfSelected(entity.id).subscribe(function() {\r\n              widgetContext.updateAliases();\r\n              vm.dialogRef.close(null);\r\n            });\r\n          });\r\n        });\r\n      });\r\n    } else {\r\n      saveEntityObservable().subscribe(afterSaveCommon);\r\n    }\r\n  };\r\n\r\n  vm.copyToClipboard = function(event, controlName) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    const value = vm.editEntityFormGroup.get(controlName.split('.')).value;\r\n    navigator.clipboard.writeText(value).then(function() {\r\n      widgetContext.showSuccessToast('Copied to clipboard!', 2000, 'top', 'center');\r\n    }).catch(function() {\r\n      widgetContext.showErrorToast('Failed to copy to clipboard.', 2000, 'top', 'center');\r\n    });\r\n  };\r\n\r\n  vm.togglePasswordVisibility = function() {\r\n    vm.hidePassword = !vm.hidePassword;\r\n  };\r\n\r\n  vm.addInverter = function() {\r\n    const generalName = vm.editEntityFormGroup.get('general').get('entityName').value;\r\n    const generalApiSiteId = vm.editEntityFormGroup.get('general').get('api').get('apiSiteId').value;\r\n    const generalApiUrl = vm.editEntityFormGroup.get('general').get('api').get('apiUrl').value;\r\n    const inverterName = '' + generalName;\r\n    const inverterGroup = fb.group({\r\n      name: [inverterName, [validators.required]],\r\n      label: [''],\r\n      displayName: [''],\r\n      apiSerial: [''],\r\n      apiSiteId: [generalApiSiteId, [validators.required]],\r\n      apiUrl : [generalApiUrl],\r\n      deviceId: ['']\r\n    }, { validators: inverterGroupValidator });\r\n\r\n    vm.editEntityFormGroup.get('inverters').push(inverterGroup);\r\n    vm.editEntityFormGroup.updateValueAndValidity();\r\n  };\r\n\r\n  function inverterGroupValidator(group) {\r\n    const apiSerial = group.get('apiSerial');\r\n    const deviceId = group.get('deviceId');\r\n    if (!apiSerial.value && !deviceId.value) {\r\n      return { inverterRequired: 'Either API Serial or Device Id is required.' };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  function getOrCreateHuaweiGroup(customerId) {\r\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n      widgetContext.rxjs.switchMap(function(groups) {\r\n        let group = groups.find(function(g) { return g.name === 'Huawei Fusion Solar API'; });\r\n        if (group) {\r\n          return widgetContext.rxjs.of(group);\r\n        } else {\r\n          group = { type: 'DEVICE', name: 'Huawei Fusion Solar API', ownerId: customerId };\r\n          return entityGroupService.saveEntityGroup(group);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  function getOrCreateFroniusGroup(customerId) {\r\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n      widgetContext.rxjs.switchMap(function(groups) {\r\n        let group = groups.find(function(g) { return g.name === 'Fronius Solar Web API'; });\r\n        if (group) {\r\n          return widgetContext.rxjs.of(group);\r\n        } else {\r\n          group = { type: 'DEVICE', name: 'Fronius Solar Web API', ownerId: customerId };\r\n          return entityGroupService.saveEntityGroup(group);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  function getOrCreateUnassignedDevices(customerId) {\r\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\r\n      widgetContext.rxjs.switchMap(function(groups) {\r\n        let group = groups.find(function(g) { return g.name === 'Unassigned Devices'; });\r\n        if (group) {\r\n          return widgetContext.rxjs.of(group);\r\n        } else {\r\n          group = { type: 'DEVICE', name: 'Unassigned Devices', ownerId: customerId };\r\n          return entityGroupService.saveEntityGroup(group);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  function requiredIfEmpty(siblingControlName) {\r\n    return function (control) {\r\n      if (!control.parent) return null;\r\n      const sibling = control.parent.get(siblingControlName);\r\n      if (!control.value && (!sibling || !sibling.value)) {\r\n        return { required: true };\r\n      }\r\n      return null;\r\n    };\r\n  }\r\n\r\n  vm.removeInverter = function() {\r\n    const invertersArray = vm.editEntityFormGroup.get('inverters');\r\n    if (invertersArray && invertersArray.length > 0) {\r\n      invertersArray.removeAt(invertersArray.length - 1);\r\n    }\r\n    vm.editEntityFormGroup.updateValueAndValidity();\r\n  };\r\n\r\n  function saveEntityObservable() {\r\n    const gVal = vm.editEntityFormGroup.get('general').value;\r\n    const customerId = widgetContext.stateController.getStateParams().selectedCustomer.entityId;\r\n    let entity = {\r\n      name: gVal.entityName,\r\n      type: gVal.type.name,\r\n      label: gVal.entityLabel,\r\n      customerId: customerId\r\n    };\r\n    return deviceService.saveDevice(entity);\r\n  }\r\n\r\n  function saveAttributes(entityId) {\r\n    const generalGroup = vm.editEntityFormGroup.get('general');\r\n    const attributes = generalGroup.get('attributes').value;\r\n    attributes.inactivityTimeout = parseInt(attributes.inactivityTimeout, 10) * 60000;\r\n    attributes.state = 'normal';\r\n\r\n    const selectedKeys = generalGroup.get('thirdPartySystems').value || [];\r\n\r\n    function pushAttr(array, key, value) {\r\n      if (value !== null && value !== undefined && value !== '') {\r\n        array.push({ key: key, value: value });\r\n      }\r\n    }\r\n\r\n    let attributesArray = [];\r\n\r\n    // Persist attributes except UI-only selection object\r\n    for (let key in attributes) {\r\n      if (key !== 'gatewaySelection' && attributes[key] !== null && attributes[key] !== undefined) {\r\n        attributesArray.push({ key: key, value: attributes[key] });\r\n      }\r\n    }\r\n\r\n    // Persist gateway attribute as NAME (not id)\r\n    const gwSel = attributes.gatewaySelection;\r\n    const gwName = attributes.gatewayName || (gwSel && typeof gwSel === 'object' ? (gwSel.name || '') : (typeof gwSel === 'string' ? gwSel : ''));\r\n    if (gwName) {\r\n      pushAttr(attributesArray, 'gateway', gwName);\r\n    }\r\n\r\n    if (vm.deviceProfileType === 'Gateway') {\r\n      attributesArray.push({ key: 'meterType', value: 'Gateway' });\r\n    }\r\n\r\n    if (generalGroup.value.activateSIM) {\r\n      const conn = generalGroup.get('connectivity');\r\n      const connectivityValues = conn ? conn.value : {};\r\n      const carrier = connectivityValues.carrierSIM;\r\n\r\n      let iccidStr = '';\r\n      const iccidVal = connectivityValues.ICCID;\r\n      if (iccidVal && typeof iccidVal === 'object' && iccidVal.name) {\r\n        iccidStr = iccidVal.name.replace(/^wsim_/, '');\r\n      } else if (typeof iccidVal === 'string') {\r\n        iccidStr = iccidVal.replace(/^wsim_/, '');\r\n      }\r\n\r\n      const carrierStr = carrier || '';\r\n      if (iccidStr || carrierStr) {\r\n        attributesArray.push({\r\n          key: 'sim',\r\n          value: JSON.stringify({ iccid: iccidStr, carrier: carrierStr })\r\n        });\r\n      }\r\n    }\r\n\r\n    if (generalGroup.value.activateAPI) {\r\n      const apiValues = generalGroup.get('api').value;\r\n      pushAttr(attributesArray, 'apiUrl', apiValues.apiUrl);\r\n      pushAttr(attributesArray, 'apiUser', apiValues.apiUser);\r\n      pushAttr(attributesArray, 'apiPassword', apiValues.apiPassword);\r\n      pushAttr(attributesArray, 'apiToken', apiValues.apiToken);\r\n      pushAttr(attributesArray, 'apiSiteId', apiValues.apiSiteId);\r\n      pushAttr(attributesArray, 'apiSerial', apiValues.apiSerial);\r\n\r\n      const selectedType = generalGroup.get('type').value;\r\n      if (selectedType && selectedType.name === 'Fronius Solar Web') {\r\n        pushAttr(attributesArray, 'froniusApiCreate', 'system');\r\n      }\r\n    }\r\n    pushAttr(attributesArray, 'forwardTo', selectedKeys);\r\n\r\n    if (generalGroup.contains('datapoints')) {\r\n      const dpValues = generalGroup.get('datapoints').value;\r\n      const active = Object.keys(dpValues).filter(function(k) { return dpValues[k]; });\r\n      if (active.length) {\r\n        attributesArray.push({\r\n          key: 'cfg_activeDatapoints',\r\n          value: JSON.stringify({ datapoints: active })\r\n        });\r\n      }\r\n    }\r\n\r\n    if (attributesArray.length > 0) {\r\n      return attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', attributesArray);\r\n    }\r\n    return widgetContext.rxjs.of([]);\r\n  }\r\n\r\n  function saveCredentials(entityId) {\r\n    const generalGroup = vm.editEntityFormGroup.get('general');\r\n    const selectedType = generalGroup.get('type').value;\r\n    const profileName = selectedType && selectedType.name ? selectedType.name : '';\r\n\r\n    if (vm.deviceProfileType === 'Gateway' && profileName !== 'Gateway') {\r\n      return deviceService.getDeviceCredentials(entityId.id).pipe(\r\n        widgetContext.rxjs.mergeMap(function(existingCredentials) {\r\n          let credentials = vm.editEntityFormGroup.get('credentials').value;\r\n          let deviceCredentials = {\r\n            id: existingCredentials.id,\r\n            deviceId: existingCredentials.deviceId,\r\n            credentialsType: credentials.credentialsType,\r\n            credentialsValue: JSON.stringify({\r\n              clientId: credentials.clientId,\r\n              userName: credentials.userName,\r\n              password: credentials.password\r\n            })\r\n          };\r\n          return deviceService.saveDeviceCredentials(deviceCredentials);\r\n        }),\r\n        widgetContext.rxjs.catchError(function(error) {\r\n          widgetContext.showErrorToast('Failed to update credentials: ' + error.message, 4000, 'top', 'center');\r\n          return widgetContext.rxjs.throwError(error);\r\n        })\r\n      );\r\n    } else {\r\n      return widgetContext.rxjs.of([]);\r\n    }\r\n  }\r\n\r\n  function saveRelations(entityId) {\r\n    let relations = vm.editEntityFormGroup.get('relations').value;\r\n    if (!relations || relations.length === 0) {\r\n      return widgetContext.rxjs.of([]);\r\n    }\r\n    let tasks = [];\r\n    for (let i = 0; i < relations.length; i++) {\r\n      let relation = { type: relations[i].relationType, typeGroup: 'COMMON' };\r\n      if (relations[i].direction === 'FROM') {\r\n        relation.to = relations[i].relatedEntity;\r\n        relation.from = entityId;\r\n      } else {\r\n        relation.to = entityId;\r\n        relation.from = relations[i].relatedEntity;\r\n      }\r\n      tasks.push(entityRelationService.saveRelation(relation));\r\n    }\r\n    if (tasks.length > 0) {\r\n      return widgetContext.rxjs.forkJoin(tasks);\r\n    }\r\n    return widgetContext.rxjs.of([]);\r\n  }\r\n\r\n  // Create relation FROM gateway TO device (reverse as requested earlier)\r\n  function saveGatewayRelationIfSelected(deviceEntityId) {\r\n    const attrs = vm.editEntityFormGroup.get('general').get('attributes').value || {};\r\n    const gwSel = attrs.gatewaySelection;\r\n    if (!gwSel || typeof gwSel !== 'object' || !gwSel.entityId || !gwSel.entityId.id) {\r\n      return widgetContext.rxjs.of(true);\r\n    }\r\n    const rel = {\r\n      from: { entityType: 'DEVICE', id: gwSel.entityId.id },\r\n      to: deviceEntityId,\r\n      type: 'Gateway',\r\n      typeGroup: 'COMMON',\r\n      additionalInfo: { note: 'Gateway -> Device relation', createdBy: 'addDevice' }\r\n    };\r\n    return entityRelationService.saveRelation(rel);\r\n  }\r\n}\r\n\r\nconst cssParser2 = new cssjs();\r\ncssParser2.testMode = false;\r\ncssParser2.cssPreviewNamespace = 'add-device-dialog-extra';\r\ncssParser2.createStyleElement('add-device-dialog-extra', '', 'nonamespace');\r\n\r\n}\r\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bed21c8c-24fb-e262-8c9a-934e224a25b2"
              }
            ]
          },
          "showTitleIcon": true,
          "titleIcon": "devices_other",
          "iconColor": null,
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {
            "padding-top": "35px"
          },
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "094be4c3-bfea-7cbd-b7a4-17c8f99b0b54"
      },
      "5b8e06cf-4c8f-a57b-ce35-78e30a417916": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.09503253117310118
                },
                {
                  "name": "ownerName",
                  "type": "entityField",
                  "label": "Owner Name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.5242730347124778,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.5889008085372874
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.13244631193263856
                },
                {
                  "name": "displayName",
                  "type": "attribute",
                  "label": "Display Name",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.6898516452355485,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "Meter Type",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.09720081536296665,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "forwardTo",
                  "type": "attribute",
                  "label": "Integration",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.526350043143889,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "inactivityTimeout",
                  "type": "attribute",
                  "label": "Inactivity Timeout",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.858169111387616,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "meterId",
                  "type": "attribute",
                  "label": "Meter ID",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.7913025131510614,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "mainDatapoint",
                  "type": "attribute",
                  "label": "Main Datapoint",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.4144620277076281,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "pulseMeter",
                  "type": "attribute",
                  "label": "Pulse Meter",
                  "color": "#9e9e9e",
                  "settings": {},
                  "_hash": 0.5267724540739636,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "offset",
                  "type": "attribute",
                  "label": "Offset",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.5676217591637229,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "counterFactor",
                  "type": "attribute",
                  "label": "Counter Factor",
                  "color": "#00c853",
                  "settings": {},
                  "_hash": 0.6986462647607202,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "4e0d3536-3894-3955-99c2-a40916175da9",
              "dataKeys": [
                {
                  "name": "isLoRaWANDevice",
                  "type": "attribute",
                  "label": "LoRaWAN Device",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.8751098958711107,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "isDisabled",
                  "type": "attribute",
                  "label": "Enable in CS",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.40162284324926956,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value === true) {\n    return false;\n} else return true;"
                },
                {
                  "name": "appKey",
                  "type": "attribute",
                  "label": "App Key",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.8253566977861285,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "devEui",
                  "type": "attribute",
                  "label": "Dev EUI",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.24320959462392922,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "deviceProfileId",
                  "type": "attribute",
                  "label": "Device Profile in CS",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.684813887942997,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "applicationId",
                  "type": "attribute",
                  "label": "Application in CS",
                  "color": "#ff5722",
                  "settings": {},
                  "_hash": 0.3896175560962274,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9557fc2a-5b75-2111-2686-e72cdbe60236",
              "dataKeys": [
                {
                  "name": "vpnIp",
                  "type": "attribute",
                  "label": "VPN IP",
                  "color": "#9e9e9e",
                  "settings": {},
                  "_hash": 0.061897509808503504,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "5b0de159-a631-e2d6-c153-a4c3b5dc60e4",
              "dataKeys": [
                {
                  "name": "forwardTo",
                  "type": "attribute",
                  "label": "Integration Options",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.9660563723798474,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1760449271454,
                "endTimeMs": 1760535671454
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "let deviceData = (data && data[0]) || {};\r\n\r\nlet html = '';\r\n\r\nconst getFirst = (obj, keys, fallback = '') =>\r\n  keys.reduce((v, k) => (v !== undefined ? v : obj[k]), undefined) ?? fallback;\r\n\r\nconst esc = (v) =>\r\n  String(v ?? '')\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#39;');\r\n\r\nconst hasAny = (obj, keys) => keys.some((k) => k in obj && obj[k] !== undefined);\r\nconst toBool = (v) => (typeof v === 'string' ? v.toLowerCase() === 'true' : !!v);\r\n\r\nconst mkCopyInput = (id, nameAttr, value, readOnly = false) => {\r\n  const v = esc(value);\r\n  const i = esc(id);\r\n  const n = esc(nameAttr);\r\n  const ro = readOnly ? ' readonly' : '';\r\n\r\n  return (\r\n    '<div class=\"input-wrapper\">' +\r\n      '<input type=\"text\" id=\"' + i + '\" name=\"' + n + '\" value=\"' + v + '\"' + ro + '/>' +\r\n      '<span class=\"material-icons copy-icon\" title=\"Copy\" ' +\r\n        'onclick=\"(function(btn){' +\r\n          'var inp = btn.previousElementSibling;' +\r\n          'if(!inp) return;' +\r\n          'var val = inp.value || \\'\\';' +\r\n          'function ok(){ btn.textContent = \\'check\\'; btn.style.color = \\'green\\'; setTimeout(function(){ btn.textContent = \\'content_copy\\'; btn.style.color = \\'\\'; }, 1500); }' +\r\n          'function fail(){ btn.textContent = \\'error\\'; btn.style.color = \\'\\'; setTimeout(function(){ btn.textContent = \\'content_copy\\'; }, 1500); }' +\r\n          'if (navigator.clipboard && navigator.clipboard.writeText) {' +\r\n            'navigator.clipboard.writeText(val).then(ok, fail);' +\r\n          '} else {' +\r\n            'try {' +\r\n              'inp.focus(); inp.select();' +\r\n              'var okCmd = document.execCommand && document.execCommand(\\'copy\\');' +\r\n              'okCmd ? ok() : fail();' +\r\n            '} catch(e) { fail(); }' +\r\n          '}' +\r\n        '})(this)\">' +\r\n        'content_copy' +\r\n      '</span>' +\r\n    '</div>'\r\n  );\r\n};\r\n\r\n\r\n\r\n\r\nif (deviceData && Object.keys(deviceData).length) {\r\n  const name = getFirst(deviceData, ['Name']);\r\n  const ownerName = getFirst(deviceData, ['Owner name', 'Owner Name', 'Owner']);\r\n  const label = getFirst(deviceData, ['Label']);\r\n  const type = getFirst(deviceData, ['Type']);\r\n  const displayName = getFirst(deviceData, ['Display Name', 'DisplayName']);\r\n  const meterType = getFirst(deviceData, ['Meter Type', 'MeterType', 'Meter']);\r\n  const integration = getFirst(deviceData, ['Integration']);\r\n  let inactivityRaw = getFirst(deviceData, ['Inactivity Timeout (min)', 'Inactivity Timeout', 'Timeout'], 60);\r\n  let inactivity = parseFloat(inactivityRaw);\r\n  if (!isNaN(inactivity)) {\r\n      inactivity = inactivity / 60 / 1000;  // convert before displaying\r\n  } else {\r\n      inactivity = 0;\r\n  }\r\n  const pulseMeter = getFirst(deviceData, ['Pulse Meter']);\r\n  const meterId = getFirst(deviceData, ['Meter ID']);\r\n  const mainDatapoint = getFirst(deviceData, ['Main Datapoint']);\r\n  const offset = getFirst(deviceData, ['Offset']);\r\n  const counterFactor = getFirst(deviceData, ['Counter Factor']);\r\n\r\n  const lorawanDevice = getFirst(deviceData, ['LoRaWAN Device']);\r\n  const enableInCS   = getFirst(deviceData, ['Enable in CS']);\r\n  const appKey       = getFirst(deviceData, ['App Key']);\r\n  const devEui       = getFirst(deviceData, ['Dev EUI']);\r\n  const deviceProfileCS = getFirst(deviceData, ['Device Profile in CS']);\r\n  const applicationCS   = getFirst(deviceData, ['Application in CS']);\r\n      \r\n    const integrationOptionsRaw = getFirst((data && data[1]) || {}, ['Integration Options'], '[]');\r\n    let integrationOptions = [];\r\n    try {\r\n      integrationOptions = typeof integrationOptionsRaw === 'string'\r\n        ? JSON.parse(integrationOptionsRaw)\r\n        : (Array.isArray(integrationOptionsRaw) ? integrationOptionsRaw : []);\r\n    } catch (e) {\r\n      integrationOptions = [];\r\n    }\r\n    \r\n    let selectedIntegrationKeys = new Set();\r\n    \r\n    let integrationValue = integration;\r\n    if (typeof integration === 'string') {\r\n      integrationValue = integration.trim();\r\n      if (integrationValue.startsWith('[') && integrationValue.endsWith(']')) {\r\n        try {\r\n          integrationValue = JSON.parse(integrationValue);\r\n        } catch (e) {\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (Array.isArray(integrationValue)) {\r\n      integrationValue.forEach(it => {\r\n        if (it && typeof it === 'string' && it.trim()) {\r\n          selectedIntegrationKeys.add(it.trim());\r\n        } else if (it && typeof it === 'object' && it['system key']) {\r\n          selectedIntegrationKeys.add(it['system key']);\r\n        }\r\n      });\r\n    } else if (integrationValue && typeof integrationValue === 'string' && integrationValue !== '[]' && integrationValue !== '') {\r\n      selectedIntegrationKeys.add(integrationValue);\r\n    } else if (integrationValue && typeof integrationValue === 'object' && integrationValue['system key']) {\r\n      selectedIntegrationKeys.add(integrationValue['system key']);\r\n    }\r\n    \r\n    let integrationCheckboxesHTML = integrationOptions.map(opt => {\r\n      const key = opt['system key'] ?? '';\r\n      const val = esc(key);\r\n      const lab = esc(opt['system label'] ?? key);\r\n      const checked = selectedIntegrationKeys.has(key) ? ' checked' : '';\r\n      return `\r\n        <label class=\"chk\">\r\n          <input type=\"checkbox\" name=\"integration[]\" value=\"${val}\"${checked} />\r\n          <span>${lab}</span>\r\n        </label>`;\r\n    }).join('');\r\n    \r\n    selectedIntegrationKeys.forEach(k => {\r\n      if (!integrationOptions.some(o => o['system key'] === k)) {\r\n        integrationCheckboxesHTML =\r\n          `<label class=\"chk\">\r\n             <input type=\"checkbox\" name=\"integration[]\" value=\"${esc(k)}\" checked />\r\n             <span>${esc(k)} (custom)</span>\r\n           </label>` + integrationCheckboxesHTML;\r\n      }\r\n    });\r\n    \r\n  const meterTypeOptions = [\r\n    { value: 'H',        label: 'WMZ' },\r\n    { value: 'C',        label: 'KMZ' },\r\n    { value: 'CHC',      label: 'HYZ' },\r\n    { value: 'W',        label: 'KWZ' },\r\n    { value: 'WW',       label: 'WWZ' },\r\n    { value: 'E',        label: 'ELZ' },\r\n    { value: 'G',        label: 'GAS' },\r\n    { value: 'S',        label: 'Sensor' },\r\n    { value: 'Other',    label: 'Other' },\r\n    { value: 'MUC',      label: 'MUC' },\r\n    { value: 'Gateway',  label: 'Gateway' },\r\n    { value: 'API',      label: 'API' },\r\n    { value: 'Converter',label: 'Converter' }\r\n  ];\r\n    \r\n  let meterTypeOptionsHTML = meterTypeOptions.map(opt => {\r\n    const val = esc(opt.value);\r\n    const lab = esc(opt.label);\r\n    const sel = (String(meterType) === opt.value) ? ' selected' : '';\r\n    return `<option value=\"${val}\"${sel}>${lab}</option>`;\r\n  }).join('');\r\n    \r\n  const meterTypeExists = meterTypeOptions.some(o => o.value === meterType);\r\n  if (meterType && !meterTypeExists) {\r\n    meterTypeOptionsHTML =\r\n      `<option value=\"${esc(String(meterType))}\" selected>${esc(String(meterType))} (custom)</option>` +\r\n      meterTypeOptionsHTML;\r\n  }\r\n    \r\n  const deviceProfileStatic = [\r\n    { value: '8020b2cd-f4a5-4697-824f-ae6ac0f7152a', label: 'Acrios M-Bus IoT converter' },\r\n    { value: '3cbe1ca7-a464-4667-b107-01bdf32af718', label: 'Adenuis Analog' },\r\n    { value: 'fd28688a-61f7-4773-9472-d46d17d37284', label: 'Dragino CPL01' },\r\n    { value: 'f4c684e5-accb-47b7-ac0d-c355135c1a84', label: 'Eastron SDM230' },\r\n    { value: 'c40c83d0-4157-4030-a995-7d0f73b7f796', label: 'Eastron SDM630MCT' },\r\n    { value: '9def6e68-ad33-48d5-bed9-14a1b22c2567', label: 'Elsys EMS Door' },\r\n    { value: '0901f567-63f3-48c0-830f-076195a68aaf', label: 'Elsys ERS CO2 Lite' },\r\n    { value: '52293c15-0219-48ab-8064-86dd198d11d2', label: 'Elsys ERS Lite' },\r\n    { value: '9148c483-ad3e-403e-b8ff-c06e9dfaf4f9', label: 'EMU Professional II LoRa' },\r\n    { value: 'ef257efa-a7d4-4cc6-86e2-deb9d628f77a', label: 'Enginko LW06485 Energy Valve' },\r\n    { value: '6df1dcb5-b330-4c7f-8ddd-84c4bf468335', label: 'Fludia FM4329' },\r\n    { value: '62c9b89b-1eda-45e7-864f-c7bbb84b92c2', label: 'Innotas Modularis' },\r\n    { value: 'a0e3fdcd-4ed4-4fc5-b909-3b54aa1d5be1', label: 'MClimate Multipurpose Button' },\r\n    { value: '02f861e1-1f95-45f8-90ff-bf9e4088c44e', label: 'Milesight AM300' },\r\n    { value: '9fbf95d7-e555-4ee3-9939-ed94046fcc10', label: 'Milesight EM300-DI' },\r\n    { value: '6d22439b-bb2c-4c2b-acb1-b2fc430f2c38', label: 'Milesight EM300-TH' },\r\n    { value: '8ba1ba84-97b9-4817-8a3b-28c9e8ac12d3', label: 'Milesight EM300-ZLD' },\r\n    { value: '0eac0920-5a07-4669-8918-882cddab5a51', label: 'Milesight EM310-UDL' },\r\n    { value: 'a0d5859c-96a0-4658-bc37-7cdb7c108631', label: 'Milesight UC100' },\r\n    { value: 'fa285287-1203-4b24-a762-b3b9186fc987', label: 'Milesight WS101' },\r\n    { value: '76f4af07-286b-4421-bc0a-82f0160ac120', label: 'Milesight WS301' },\r\n    { value: 'dc3d051f-a3a6-4b7b-91ee-6d5afd25ffbf', label: 'Milesight WS522' },\r\n    { value: 'e61d2c6a-e3e2-404b-9779-6926969463e6', label: 'Sontex Supercal 739' },\r\n    { value: 'bc262398-c81f-4460-bf89-6ed426eba080', label: 'Wassergeraete VoluMess VI-E' },\r\n    { value: 'null', label: 'No Selection' }\r\n  ];\r\n    \r\n  let deviceProfileOptionsHTML = deviceProfileStatic.map(opt => {\r\n    const val = esc(opt.value);\r\n    const lab = esc(opt.label);\r\n    const sel = (String(deviceProfileCS) === opt.value) ? ' selected' : '';\r\n    return `<option value=\"${val}\"${sel}>${lab}</option>`;\r\n  }).join('');\r\n    \r\n  if (deviceProfileCS && !deviceProfileStatic.some(o => String(o.value) === String(deviceProfileCS))) {\r\n    deviceProfileOptionsHTML = deviceProfileOptionsHTML.replace(\r\n      /(<option value=\"null\")/,\r\n      '$1 selected'\r\n    );\r\n  }\r\n\r\n  const applicationOptionsStatic = [\r\n    { value: 'f39aacae-3622-4e19-91a0-b1f8df30737c', label: 'AKBild' },\r\n    { value: '391b5688-6873-427f-847d-c7ecb3c0321b', label: 'Arealis' },\r\n    { value: '599aa47b-d9db-4ce1-88e6-8dbc9ac729fc', label: 'BAWAG' },\r\n    { value: '410c4c8a-b522-4a9d-9840-9c41a14f2ff3', label: 'Bilfinger' },\r\n    { value: '4143221b-ec1e-4aef-b9e2-379060b0d96c', label: 'Hotel Sacher Salzburg' },\r\n    { value: '2a3d5a98-a8dd-416d-869d-0a7c8a1fef44', label: 'Humanomed' },\r\n    { value: '2c427b51-3609-4932-b495-4293b02c7b88', label: 'ICON Vienna' },\r\n    { value: '58dea514-530c-45af-8aac-45f797ce3f13', label: 'IG Immobilien' },\r\n    { value: '4d4ed2d2-b9f5-4e49-b58e-02ff466b4c04', label: 'OSG' },\r\n    { value: '670669d0-6d51-4e55-9ef2-2af4129c451c', label: 'PKE Test' },\r\n    { value: '43729bf4-da49-4d37-8d5f-2b50bb2f70c5', label: 'PKE Deutschland' },\r\n    { value: '64dcb625-3826-458d-81c5-81c63714e0c9', label: 'PKE Oesterreich' },\r\n    { value: '73957256-89d6-45f1-bec0-ae1597ea258e', label: 'Real Estate Burgenland' },\r\n    { value: '2f2c8421-34dc-4728-9200-5c28d4c0bc78', label: 'Sturm Messdienste' },\r\n    { value: 'cb4ff58b-db7f-486d-be15-21d3de7768c5', label: 'Wiener Wohnen' },\r\n    { value: '61ba6f18-29f4-4f8a-99d9-ea056ac3b13e', label: 'Dockal' },\r\n    { value: 'e76f16e2-04c2-40be-87f2-b507334ed39e', label: 'Austria Real Estate' },\r\n    { value: 'e1608ddd-e4e7-47ec-b9f5-04e8c9bf5e7f', label: 'Erzbistum Wien' },\r\n    { value: '713d58ee-1f37-4f8d-ba3d-d4eb428a38ed', label: 'Green' },\r\n    { value: '4143221b-ec1e-4aef-b9e2-379060b0d96c', label: 'Hotel Sacher' },\r\n    { value: '0ec1c4a5-9609-4733-9148-a0e817774c97', label: 'Solid Campus' },\r\n    { value: 'null', label: 'No Selection' }\r\n  ];\r\n    \r\n  let applicationOptionsHTML = applicationOptionsStatic.map(opt => {\r\n    const val = esc(opt.value);\r\n    const lab = esc(opt.label);\r\n    const sel = (String(applicationCS) === opt.value) ? ' selected' : '';\r\n    return `<option value=\"${val}\"${sel}>${lab}</option>`;\r\n  }).join('');\r\n    \r\n  if (applicationCS && !applicationOptionsStatic.some(o => String(o.value) === String(applicationCS))) {\r\n    applicationOptionsHTML = applicationOptionsHTML.replace(\r\n      /(<option value=\"null\")/,\r\n      '$1 selected'\r\n    );\r\n  }\r\n \r\n \r\n let pulseMeterHtml = '';\r\n \r\n if(pulseMeter === true || pulseMeter === \"true\") {\r\n     pulseMeterHtml = '<div class=\"field\"><div class=\"label\">Offset</div>'\r\n      +       '<div class=\"control\"><input type=\"text\" id=\"offset\" name=\"offset\" value=\"' + esc(offset) + '\"/></div></div>'\r\n    \r\n      +     '<div class=\"field\"><div class=\"label\">Counter Factor</div>'\r\n      +       '<div class=\"control\"><input type=\"text\" id=\"counterFactor\" name=\"counterFactor\" value=\"' + esc(counterFactor) + '\"/></div></div>';\r\n }\r\n  html += ''\r\n  + '<div class=\"cards-grid\">' \r\n      + '<div class=\"card\">'\r\n    \r\n      +   '<form id=\"deviceForm\" class=\"form-grid\">'\r\n    \r\n      // Name (copy)\r\n      + '<div class=\"field\"><div class=\"label\">Name</div>'\r\n      +   '<div class=\"control\">' + mkCopyInput('name', 'name', name, true) + '</div></div>'\r\n\r\n    \r\n      // Owner Name (copy)\r\n      + '<div class=\"field\"><div class=\"label\">Owner Name</div>'\r\n      +   '<div class=\"control\">' + mkCopyInput('ownerName', 'ownerName', ownerName, true) + '</div></div>'\r\n\r\n\r\n    \r\n      // Label (copy)\r\n      +     '<div class=\"field\"><div class=\"label\">Label</div>'\r\n      +       '<div class=\"control\">' + mkCopyInput('label', 'label', label) + '</div></div>'\r\n    \r\n      + '<div class=\"field\"><div class=\"label\">Type</div>'\r\n      +   '<div class=\"control\"><input type=\"text\" id=\"type\" name=\"type\" value=\"' + esc(type) + '\" readonly/></div></div>'\r\n\r\n    \r\n      // Display Name (copy)\r\n      /*+     '<div class=\"field\"><div class=\"label\">Display Name</div>'\r\n      +       '<div class=\"control\">' + mkCopyInput('displayName', 'displayName', displayName) + '</div></div>'*/\r\n    \r\n      +     '<div class=\"field\"><div class=\"label\">Meter Type</div>'\r\n        +       '<div class=\"control\">'\r\n        +         '<div class=\"select-wrapper\">'\r\n        +           '<select id=\"meterType\" name=\"meterType\">'\r\n        +              meterTypeOptionsHTML\r\n        +           '</select>'\r\n        +           '<mat-icon class=\"tb-mat-24 select-arrow\">keyboard_arrow_down</mat-icon>'\r\n        +         '</div>'\r\n        +       '</div></div>'\r\n\r\n      +     '<div class=\"field\"><div class=\"label\">Inactivity Timeout (min)</div>'\r\n      +       '<div class=\"control\"><input type=\"number\" id=\"inactivity\" name=\"inactivity\" min=\"0\" step=\"1\" value=\"' + esc(inactivity) + '\"/></div></div>'\r\n    \r\n      // Meter ID (copy)\r\n      +     '<div class=\"field\"><div class=\"label\">Meter ID</div>'\r\n      +       '<div class=\"control\">' + mkCopyInput('meterId', 'meterId', meterId) + '</div></div>'\r\n    \r\n      +     '<div class=\"field\"><div class=\"label\">Main Datapoint</div>'\r\n      +       '<div class=\"control\"><input type=\"text\" id=\"mainDatapoint\" name=\"mainDatapoint\" value=\"' + esc(mainDatapoint) + '\"/></div></div>'\r\n    \r\n      +     pulseMeterHtml \r\n      \r\n      +     '<div class=\"field full\"><div class=\"label\">Integration</div>'\r\n        +       '<div class=\"control checkbox-list\">'\r\n        +          integrationCheckboxesHTML\r\n        +       '</div></div>'\r\n\r\n      /*+     (hasAny(deviceData, ['LoRaWAN Device']) ? (\r\n                  '<div class=\"field\"><div class=\"label\">LoRaWAN Device</div>'\r\n                +   '<div class=\"control\">'\r\n                +     '<label class=\"toggle\" aria-label=\"LoRaWAN Device\">'\r\n                +       '<input type=\"checkbox\" id=\"lorawanDevice\" name=\"lorawanDevice\"' + (toBool(lorawanDevice) ? ' checked' : '') + ' />'\r\n                +       '<span class=\"slider\" aria-hidden=\"true\"></span>'\r\n                +     '</label>'\r\n                +   '</div></div>'\r\n              ) : '')\r\n\r\n      +     (hasAny(deviceData, ['Enable in CS']) ? (\r\n                  '<div class=\"field\"><div class=\"label\">Enable in CS</div>'\r\n                +   '<div class=\"control\">'\r\n                +     '<label class=\"toggle\" aria-label=\"Enable in CS\">'\r\n                +       '<input type=\"checkbox\" id=\"enableInCS\" name=\"enableInCS\"' + (toBool(enableInCS) ? ' checked' : '') + ' />'\r\n                +       '<span class=\"slider\" aria-hidden=\"true\"></span>'\r\n                +     '</label>'\r\n                +   '</div></div>'\r\n              ) : '')\r\n*/\r\n      +     (hasAny(deviceData, ['App Key']) ? (\r\n                '<div class=\"field\"><div class=\"label\">App Key</div>'\r\n              +   '<div class=\"control\">' + mkCopyInput('appKey', 'appKey', appKey) + '</div></div>'\r\n            ) : '')\r\n\r\n      +     (hasAny(deviceData, ['Dev EUI']) ? (\r\n                '<div class=\"field\"><div class=\"label\">Dev EUI</div>'\r\n              +   '<div class=\"control\">' + mkCopyInput('devEui', 'devEui', devEui) + '</div></div>'\r\n            ) : '')\r\n    \r\n      /*+     (hasAny(deviceData, ['Device Profile in CS']) ? (\r\n              '<div class=\"field\"><div class=\"label\">Device Profile in CS</div>'\r\n            +   '<div class=\"control\">'\r\n            +     '<div class=\"select-wrapper\">'\r\n            +       '<select id=\"deviceProfileCS\" name=\"deviceProfileCS\">'\r\n            +          deviceProfileOptionsHTML\r\n            +       '</select>'\r\n            +       '<mat-icon class=\"tb-mat-24 select-arrow\">keyboard_arrow_down</mat-icon>'\r\n            +     '</div>'\r\n            +   '</div></div>'\r\n          ) : '')\r\n*/\r\n      /*  Keep hidden per your comment; leaving placeholder for later\r\n      +     (hasAny(deviceData, ['Application in CS']) ? (\r\n              '<div class=\"field\"><div class=\"label\">Application in CS</div>'\r\n            +   '<div class=\"control\">'\r\n            +     '<div class=\"select-wrapper\">'\r\n            +       '<select id=\"applicationCS\" name=\"applicationCS\">'\r\n            +          applicationOptionsHTML\r\n            +       '</select>'\r\n            +       '<mat-icon class=\"tb-mat-24 select-arrow\">keyboard_arrow_down</mat-icon>'\r\n            +     '</div>'\r\n            +   '</div></div>'\r\n          ) : '')\r\n      */\r\n\r\n      +   '</form>'\r\n    \r\n      +   '<div class=\"actions\">'\r\n      +     '<button id=\"save-button\" class=\"btn btn-primary\" type=\"submit\" form=\"deviceForm\">Save</button>'\r\n      +   '</div>'\r\n    \r\n      + '</div>'\r\n    + '</div>';   \r\n\r\n} else {\r\n  html += '<div>No device data found.</div>';\r\n}\r\n\r\nreturn html;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* === Buttons === */\r\n.btn {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-weight: 600;\r\n  font-size: 14px;\r\n  border-radius: 20px;\r\n  border: none;\r\n  padding: 10px 18px;\r\n  cursor: pointer;\r\n  transition: background-color 0.2s ease, box-shadow 0.2s ease;\r\n}\r\n\r\n.btn-primary {\r\n  background: var(--tb-primary-500, #2563eb);   /* blue default */\r\n  color: #fff;\r\n}\r\n\r\n.btn-primary:hover {\r\n  background: var(--tb-primary-700, #1d4ed8);\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.15);\r\n}\r\n\r\n.btn-primary:active {\r\n  background: var(--tb-primary-800, #1e40af);\r\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);\r\n}\r\n\r\n.actions {\r\n  grid-column: 1 / -1;\r\n  justify-self: end;\r\n  padding-top: 8px;\r\n}\r\n\r\n/* Card container */\r\n.card{\r\n  /* was: max-width: 860px; */\r\n  width: 100%;\r\n  max-width: 100%;\r\n  padding: 10px 10px;\r\n  margin: 0 0;\r\n  background: var(--tb-surface, #fff);\r\n  border: none;\r\n  border-radius: 12px;\r\n  font-family: system-ui, -apple-system, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\r\n  display: grid;\r\n  gap: 16px;\r\n  overflow-x: hidden;           /* prevent horizontal scroll from children */\r\n}\r\n\r\n/* Make the outer grid never exceed the widget width */\r\n.cards-grid{ width: 100%; max-width: 100%; overflow-x: hidden; }\r\n\r\n/* TWO columns inside the form */\r\n.form-grid{\r\n  display: grid;\r\n  /* use minmax(0,1fr) so long contents can shrink and wrap */\r\n  grid-template-columns: minmax(0,1fr) minmax(0,1fr);\r\n  gap: 16px;\r\n  align-items: start;\r\n}\r\n\r\n/* label above control inside each cell */\r\n.field{\r\n  display: grid;\r\n  grid-template-columns: 1fr;\r\n  row-gap: 6px;\r\n}\r\n.field.full{ grid-column: 1 / -1; }\r\n\r\n.label{\r\n  /*color: gray;*/\r\n  /*color: var(--tb-primary-500);*/\r\n  color: #323f5f;\r\n  font-weight: 600;\r\n  font-size: 14px;\r\n  text-align: left;\r\n}\r\n\r\n.control input,\r\n.control textarea,\r\n.control select{\r\n  width: 100%;\r\n  max-width: 100%;              /* never exceed column */\r\n  padding: 10px 12px;\r\n  background-color: color-mix(in srgb, var(--tb-primary-500) 5%, transparent);\r\n\r\n  /*border: 1px solid gray;*/\r\n  border: 0.5px solid color-mix(in srgb, var(--tb-primary-500) 10%, transparent);\r\n  border-radius: 99px;\r\n  font-size: 14px;\r\n  line-height: 1.45;\r\n  color: #111827;\r\n  outline: none;\r\n  transition: border-color .2s ease, box-shadow .2s ease;\r\n  box-sizing: border-box;       /* include padding in width calc */\r\n}\r\n.control textarea{ min-height: 88px; resize: vertical; }\r\n\r\n.control input:focus,\r\n.control textarea:focus,\r\n.control select:focus{\r\n  border-color: var(--tb-primary-600, #1e40af);\r\n  box-shadow: 0 0 0 3px rgba(37,99,235,.15);\r\n}\r\n\r\n/* actions footer aligned right, spanning both columns */\r\n.actions{ grid-column: 1 / -1; justify-self: end; }\r\n\r\n/* Responsive: stack to one column on small screens */\r\n@media (max-width: 640px){\r\n  .form-grid{ grid-template-columns: 1fr; }\r\n  .muted{ grid-column: 1; }\r\n}\r\n\r\n.toggle { position: relative; display: inline-block; width: 46px; height: 26px; }\r\n.toggle input { opacity: 0; width: 0; height: 0; }\r\n.toggle .slider {\r\n  position: absolute; cursor: pointer; inset: 0; background: #cbd5e1;\r\n  transition: .2s; border-radius: 9999px;\r\n}\r\n.toggle .slider::before {\r\n  content: \"\"; position: absolute; height: 22px; width: 22px; left: 2px; top: 2px;\r\n  background: #fff; transition: .2s; border-radius: 9999px; box-shadow: 0 1px 2px rgba(0,0,0,.25);\r\n}\r\n.toggle input:checked + .slider { background: #166534; }\r\n.toggle input:checked + .slider::before { transform: translateX(20px); }\r\n\r\n/* Integration checkbox grid: 2 columns, always fit */\r\n.checkbox-list{\r\n  display: grid;\r\n  grid-template-columns: repeat(2, minmax(0, 1fr));  /* 2  50%, shrinkable */\r\n  column-gap: 20px;\r\n  row-gap: 10px;\r\n  justify-items: start;\r\n  width: 100%;\r\n  max-width: 100%;\r\n  overflow-x: hidden;\r\n}\r\n\r\n.checkbox-list .chk{\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  justify-content: flex-start;\r\n  width: 100%;\r\n  text-align: left;\r\n}\r\n\r\n.checkbox-list .chk span{\r\n  word-break: break-word;        /* long labels wont cause overflow */\r\n}\r\n\r\n@media (max-width: 640px){\r\n  .checkbox-list{ grid-template-columns: 1fr; }\r\n}\r\n\r\n.checkbox-list input[type=\"checkbox\"] { width: 16px; height: 16px; }\r\n\r\n/* keep the label from stretching */\r\n.control label.toggle{\r\n  display: inline-flex !important;\r\n  width: 46px !important;\r\n  height: 26px !important;\r\n  align-items: center;\r\n  position: relative;\r\n}\r\n.control label.toggle .slider{ position: absolute; inset: 0; background: #cbd5e1; border-radius: 9999px; transition: .2s; }\r\n.control label.toggle .slider::before{\r\n  content: \"\";\r\n  position: absolute;\r\n  width: 22px; height: 22px; left: 2px; top: 2px;\r\n  background: #fff; border-radius: 9999px; transition: .2s;\r\n  box-shadow: 0 1px 2px rgba(0,0,0,.25);\r\n}\r\n.control label.toggle input{ opacity: 0; width: 0; height: 0; }\r\n.control label.toggle input:checked + .slider{ background: #22c55e; }\r\n.control label.toggle input:checked + .slider::before{ transform: translateX(20px); }\r\n\r\n\r\n\r\n\r\n\r\n/* Wraps select + icon together */\r\n.select-wrapper {\r\n  position: relative;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n/* Style the select itself */\r\n.select-wrapper select {\r\n  width: 100%;\r\n  padding-right: 42px; /* make room for the icon */\r\n  border-radius: 99px;\r\n  color: #111827;\r\n  background-color: color-mix(in srgb, var(--tb-primary-500) 5%, transparent);\r\n\r\n  /*border: 1px solid gray;*/\r\n  border: 0.5px solid color-mix(in srgb, var(--tb-primary-500) 10%, transparent);\r\n  font-size: 14px;\r\n  line-height: 1.45;\r\n  outline: none;\r\n  transition: border-color .2s ease, box-shadow .2s ease;\r\n}\r\n\r\n/* Show finger cursor on hover for all dropdowns */\r\n.select-wrapper select:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n\r\n/* Position + colorize the Material icon arrow */\r\n.select-wrapper .select-arrow {\r\n  position: absolute;\r\n  top: 50%;\r\n  right: 10px; /* adjust if its too far right */\r\n  transform: translateY(-50%);\r\n  color: var(--tb-primary-500);\r\n  pointer-events: none; /* dont block clicks */\r\n  font-size: 24px;\r\n}\r\n\r\n/* Hide native arrow */\r\n.select-wrapper select::-ms-expand { display: none; }\r\n.select-wrapper select {\r\n  -webkit-appearance: none;\r\n  -moz-appearance: none;\r\n  appearance: none;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* Wraps input + copy icon together (like select wrapper) */\r\n.input-wrapper {\r\n  position: relative;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n/* Make space for the icon on the right */\r\n.input-wrapper input {\r\n  padding-right: 42px; /* same as select */\r\n}\r\n\r\n/* Copy icon  smaller than select arrow */\r\n.copy-icon {\r\n  position: absolute;\r\n  top: 50%;\r\n  right: 10px;\r\n  transform: translateY(-50%);\r\n  color: var(--tb-primary-500);\r\n  font-size: 18px; /* smaller than 24px arrow */\r\n  cursor: pointer;\r\n  user-select: none;\r\n  line-height: 1;\r\n}\r\n\r\n.copy-icon:active {\r\n  transform: translateY(-50%) scale(0.95);\r\n}\r\n\r\n\r\n/* Visually de-emphasize read-only fields */\r\n.control input[readonly],\r\n.control textarea[readonly] {\r\n  opacity: 0.9;\r\n  background-color: color-mix(in srgb,\r\n    var(--tb-primary-500) 2%,\r\n    transparent\r\n  );\r\n  cursor: default;              /* no text-input cursor */\r\n}\r\n\r\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "0",
          "actions": {
            "elementClick": [
              {
                "name": "save-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "// Custom action: save-button\r\n// signature: f($event, widgetContext, entityId, entityName, additionalParams, entityLabel)\r\n\r\nif ($event && typeof $event.preventDefault === 'function') $event.preventDefault();\r\n\r\nconst form = document.getElementById('deviceForm');\r\nif (!form) {\r\n  widgetContext.showErrorToast('Form not found.');\r\n  return;\r\n}\r\n\r\n// ---------- helpers ----------\r\nconst getEl = (id) => form.querySelector('#' + id);\r\nconst getVal = (id) => (getEl(id) ? getEl(id).value.trim() : '');\r\nconst getNum = (id) => {\r\n  const v = getVal(id);\r\n  if (v === '') return null;\r\n  const n = Number(v);\r\n  return Number.isFinite(n) ? n : null;\r\n};\r\nconst getBool = (id) => {\r\n  const el = getEl(id);\r\n  return el ? !!el.checked : null;\r\n};\r\nconst nullIfEmpty = (v) => (v === '' ? null : v);\r\nconst normalize = (v) => {\r\n  if (v === undefined) return undefined;\r\n  if (v === null) return null;\r\n  if (Array.isArray(v)) return v.map(String).map((s) => s.trim()).sort();\r\n  if (typeof v === 'string') return v.trim();\r\n  if (typeof v === 'number') return Number.isFinite(v) ? v : null;\r\n  if (typeof v === 'boolean') return v;\r\n  return v;\r\n};\r\nconst isEqual = (a, b) => {\r\n  const A = normalize(a);\r\n  const B = normalize(b);\r\n  if (Array.isArray(A) && Array.isArray(B)) {\r\n    if (A.length !== B.length) return false;\r\n    for (let i = 0; i < A.length; i++) if (A[i] !== B[i]) return false;\r\n    return true;\r\n  }\r\n  return JSON.stringify(A) === JSON.stringify(B);\r\n};\r\n\r\n// collect Integration[] checkbox values\r\nconst integrationValues = Array.from(\r\n  form.querySelectorAll('input[name=\"integration[]\"]:checked') || []\r\n).map((el) => el.value).filter(Boolean);\r\n\r\n// inactivity shown in MIN; store as milliseconds on the server\r\nconst inactivityMin = getNum('inactivity');\r\nconst inactivityMs = inactivityMin != null ? (inactivityMin * 60 * 1000) : null;\r\n\r\n// desired entity-field values from the form\r\nconst desiredFields = {\r\n  name: getVal('name'),\r\n  type: getVal('type'),\r\n  label: getVal('label'),\r\n  ownerName: getVal('ownerName') // -> additionalInfo.ownerName\r\n};\r\n\r\n// attribute inputs from the form (canonical names)\r\nconst desiredCanon = {\r\n  displayName:          nullIfEmpty(getVal('displayName')),\r\n  meterType:            nullIfEmpty(getEl('meterType') ? getEl('meterType').value : ''),\r\n  meterId:              nullIfEmpty(getVal('meterId')),\r\n  mainDatapoint:        nullIfEmpty(getVal('mainDatapoint')),\r\n  inactivityTimeoutMs:  inactivityMs, // we will still store under the legacy key below\r\n  forwardTo:            integrationValues.length ? integrationValues : null,\r\n  lorawanDevice:        getEl('lorawanDevice') != null ? getBool('lorawanDevice') : undefined,\r\n  enableInCS:           getEl('enableInCS') != null ? getBool('enableInCS') : undefined,\r\n  appKey:               getEl('appKey') ? nullIfEmpty(getVal('appKey')) : undefined,\r\n  devEui:               getEl('devEui') ? nullIfEmpty(getVal('devEui')) : undefined,\r\n  deviceProfileCS:      getEl('deviceProfileCS') ? nullIfEmpty(getEl('deviceProfileCS').value) : undefined,\r\n  applicationCS:        getEl('applicationCS') ? nullIfEmpty(getEl('applicationCS').value) : undefined,\r\n  offset:               getEl('offset') ? nullIfEmpty(getVal('offset')) : undefined,\r\n  counterFactor:        getEl('counterFactor') ? nullIfEmpty(getVal('counterFactor')) : undefined\r\n};\r\n\r\n// === Attribute alias map ===\r\n// For each canonical key, list the possible existing TB attribute keys (ordered by preference).\r\nconst ATTR_ALIASES = {\r\n  displayName:         ['displayName', 'Display Name', 'DisplayName'],\r\n  meterType:           ['Meter Type', 'meterType'],\r\n  meterId:             ['Meter ID', 'meterId'],\r\n  mainDatapoint:       ['Main Datapoint', 'mainDatapoint'],\r\n  inactivityTimeoutMs: ['Inactivity Timeout (min)', 'inactivityTimeout', 'inactivityTimeoutMs'],\r\n  forwardTo:           ['forwardTo', 'Integration', 'integration'],\r\n  lorawanDevice:       ['LoRaWAN Device', 'lorawanDevice'],\r\n  enableInCS:          ['Enable in CS', 'enableInCS'],\r\n  appKey:              ['App Key', 'appKey'],\r\n  devEui:              ['Dev EUI', 'devEui'],\r\n  deviceProfileCS:     ['Device Profile in CS', 'deviceProfileCS'],\r\n  applicationCS:       ['Application in CS', 'applicationCS'],\r\n  offset:              ['Offset', 'offset'],\r\n  counterFactor:       ['Counter Factor', 'counterFactor']\r\n};\r\n\r\n// ---------- services ----------\r\nconst $injector        = widgetContext.$scope.$injector;\r\nconst deviceService    = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\n// 1) Load the device\r\ndeviceService.getDevice(entityId.id).subscribe({\r\n  next: (currentDevice) => {\r\n    // ---- Diff entity fields ----\r\n    const fieldDiffs = {};\r\n    if (!isEqual(desiredFields.name, currentDevice.name))  fieldDiffs.name  = desiredFields.name;\r\n    if (!isEqual(desiredFields.type, currentDevice.type))  fieldDiffs.type  = desiredFields.type;\r\n    if (!isEqual(desiredFields.label, currentDevice.label)) fieldDiffs.label = desiredFields.label;\r\n\r\n    const currOwner = currentDevice.additionalInfo && currentDevice.additionalInfo.ownerName;\r\n    if (!isEqual(desiredFields.ownerName, currOwner)) {\r\n      fieldDiffs.additionalInfo = Object.assign({}, currentDevice.additionalInfo || {}, {\r\n        ownerName: desiredFields.ownerName\r\n      });\r\n    }\r\n\r\n    const doSaveFields = Object.keys(fieldDiffs).length > 0;\r\n    const saveFields$ = doSaveFields\r\n      ? deviceService.saveDevice(Object.assign({}, currentDevice, fieldDiffs))\r\n      : { subscribe: (h) => { h?.next?.(); } };\r\n\r\n    saveFields$.subscribe({\r\n      next: () => {\r\n        if (doSaveFields) widgetContext.showSuccessToast('Device fields saved');\r\n\r\n        // 2) Resolve which attribute keys currently exist and fetch them\r\n        const allKeysToCheck = [];\r\n        Object.keys(ATTR_ALIASES).forEach(canon => {\r\n          const val = desiredCanon[canon];\r\n          if (val !== undefined) {\r\n            allKeysToCheck.push(...ATTR_ALIASES[canon]);\r\n          }\r\n        });\r\n\r\n        attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', allKeysToCheck).subscribe({\r\n          next: (attrArr) => {\r\n            const currentByKey = {};\r\n            (attrArr || []).forEach(a => { currentByKey[a.key] = a.value; });\r\n\r\n            // Determine the concrete key to write for each canonical key (prefer existing key)\r\n            const resolveKey = (canon) => {\r\n              const aliases = ATTR_ALIASES[canon] || [];\r\n              for (const k of aliases) {\r\n                if (k in currentByKey) return k; // found existing\r\n              }\r\n              return aliases[0] || canon; // fallback to preferred alias\r\n            };\r\n\r\n            const changes = [];\r\n\r\n            // Build minimal change-set (update only changed, null => delete)\r\n            Object.keys(desiredCanon).forEach(canon => {\r\n              const desiredVal = desiredCanon[canon];\r\n              if (desiredVal === undefined) return; // skip (field not present in UI)\r\n\r\n              const concreteKey = resolveKey(canon);\r\n\r\n              // Special-case: we store minutes->ms under the legacy key\r\n              const desiredForCompare = desiredVal;\r\n              const currentVal = currentByKey[concreteKey];\r\n\r\n              const changed = (desiredForCompare === null)\r\n                ? (currentVal !== undefined && currentVal !== null)\r\n                : !isEqual(desiredForCompare, currentVal);\r\n\r\n              if (changed) {\r\n                changes.push({ key: concreteKey, value: desiredVal });\r\n              }\r\n            });\r\n\r\n            if (!changes.length) {\r\n              if (!doSaveFields) widgetContext.showSuccessToast('No changes to save.');\r\n              return;\r\n            }\r\n\r\n            attributeService\r\n              .saveEntityAttributes(entityId, 'SERVER_SCOPE', changes)\r\n              .subscribe({\r\n                next: () => widgetContext.showSuccessToast('Attributes saved'),\r\n                error: (err) => widgetContext.showErrorToast('Failed to save attributes: ' + (err?.message || err))\r\n              });\r\n          },\r\n          error: (err) => widgetContext.showErrorToast('Failed to load attributes: ' + (err?.message || err))\r\n        });\r\n      },\r\n      error: (err) => widgetContext.showErrorToast('Failed to save device: ' + (err?.message || err))\r\n    });\r\n  },\r\n  error: (err) => widgetContext.showErrorToast('Failed to load device: ' + (err?.message || err))\r\n});\r\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fd27b6db-9ed4-dc86-5d52-5b541d875e40"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "5b8e06cf-4c8f-a57b-ce35-78e30a417916"
      },
      "b0019001-3c32-3726-1b5c-3cb73b51d62b": {
        "typeFullFqn": "system.digital_gauges.vertical_bar_justgage",
        "type": "latest",
        "sizeX": 2,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "snr",
                  "type": "timeseries",
                  "label": "snr",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8836771195629538
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1758009354928,
                "endTimeMs": 1758095754928
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#ffffff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "gaugeType": "horizontalBar",
            "donutStartAngle": 90,
            "showMinMax": true,
            "minValue": -20,
            "maxValue": 20,
            "minMaxFont": {
              "size": 13,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal",
              "color": "#666666"
            },
            "minMaxColor": "#666666",
            "showValue": true,
            "valueFont": {
              "size": 15,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal",
              "color": "#666666"
            },
            "valueColor": "#666666",
            "showTitle": true,
            "title": "SNR",
            "titleFont": {
              "size": 15,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal",
              "color": "#999999"
            },
            "titleColor": "#999999",
            "showUnitTitle": false,
            "unitTitle": null,
            "showTimestamp": false,
            "timestampFormat": "yyyy-MM-dd HH:mm:ss",
            "labelFont": {
              "family": "Roboto",
              "size": 8,
              "style": "normal",
              "weight": "500",
              "color": null
            },
            "labelColor": null,
            "gaugeWidthScale": 0.75,
            "neonGlowBrightness": 0,
            "dashThickness": 1.5,
            "roundedLineCap": false,
            "gaugeColor": "#eeeeee",
            "barColor": {
              "type": "range",
              "color": "#2196f3",
              "gradient": {
                "advancedMode": false,
                "gradient": [
                  "rgba(0, 255, 0, 1)",
                  "rgba(255, 0, 0, 1)"
                ],
                "gradientAdvanced": [
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(0, 255, 0, 1)"
                  },
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(255, 0, 0, 1)"
                  }
                ],
                "minValue": -20,
                "maxValue": 20
              },
              "rangeList": {
                "advancedMode": false,
                "range": [
                  {
                    "from": 0,
                    "to": null,
                    "color": "rgb(139, 195, 74)"
                  },
                  {
                    "from": -10,
                    "to": 0,
                    "color": "rgb(232, 150, 35)"
                  },
                  {
                    "from": null,
                    "to": -10,
                    "color": "rgb(244, 67, 54)"
                  }
                ],
                "rangeAdvanced": []
              },
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showTicks": false,
            "tickWidth": 4,
            "colorTicks": "#666",
            "ticksValue": [],
            "animation": true,
            "animationDuration": 500,
            "animationRule": "linear",
            "useFixedLevelColor": true,
            "fixedLevelColors": [
              {
                "from": 0,
                "to": null,
                "color": "rgb(139, 195, 74)"
              },
              {
                "from": -10,
                "to": 0,
                "color": "rgb(232, 150, 35)"
              },
              {
                "from": null,
                "to": -10,
                "color": "rgb(244, 67, 54)"
              }
            ],
            "levelColors": [
              "rgba(0, 255, 0, 1)",
              "rgba(255, 0, 0, 1)"
            ]
          },
          "title": "Vertical bar",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {},
          "enableDataExport": false,
          "borderRadius": "0",
          "units": null,
          "decimals": 0,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "b0019001-3c32-3726-1b5c-3cb73b51d62b"
      },
      "3f9e826e-adeb-19c3-e99e-afed8b69f26e": {
        "typeFullFqn": "system.digital_gauges.vertical_bar_justgage",
        "type": "latest",
        "sizeX": 2,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "rssi",
                  "type": "timeseries",
                  "label": "rssi",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8957027823665663
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1758009650963,
                "endTimeMs": 1758096050963
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#ffffff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "gaugeType": "horizontalBar",
            "donutStartAngle": 90,
            "showMinMax": true,
            "minValue": -120,
            "maxValue": -70,
            "minMaxFont": {
              "family": "Roboto",
              "size": 13,
              "style": "normal",
              "weight": "500",
              "color": "#666666",
              "sizeUnit": "px"
            },
            "minMaxColor": "#666666",
            "showValue": true,
            "valueFont": {
              "family": "Roboto",
              "size": 15,
              "style": "normal",
              "weight": "500",
              "color": "#666666",
              "sizeUnit": "px"
            },
            "valueColor": "#666666",
            "showTitle": true,
            "title": "RSSI",
            "titleFont": {
              "family": "Roboto",
              "size": 15,
              "style": "normal",
              "weight": "500",
              "color": "#999999",
              "sizeUnit": "px"
            },
            "titleColor": "#999999",
            "showUnitTitle": false,
            "unitTitle": null,
            "showTimestamp": false,
            "timestampFormat": "yyyy-MM-dd HH:mm:ss",
            "labelFont": {
              "family": "Roboto",
              "size": 8,
              "style": "normal",
              "weight": "500",
              "color": null
            },
            "labelColor": null,
            "gaugeWidthScale": 0.75,
            "neonGlowBrightness": 0,
            "dashThickness": 1.5,
            "roundedLineCap": false,
            "gaugeColor": "#eeeeee",
            "barColor": {
              "type": "range",
              "color": "#2196f3",
              "gradient": {
                "advancedMode": false,
                "gradient": [
                  "rgba(0, 255, 0, 1)",
                  "rgba(255, 0, 0, 1)"
                ],
                "gradientAdvanced": [
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(0, 255, 0, 1)"
                  },
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(255, 0, 0, 1)"
                  }
                ],
                "minValue": -120,
                "maxValue": -70
              },
              "rangeList": {
                "advancedMode": false,
                "range": [
                  {
                    "from": -80,
                    "to": null,
                    "color": "rgb(139, 195, 74)"
                  },
                  {
                    "from": -90,
                    "to": -80,
                    "color": "rgb(245, 221, 0)"
                  },
                  {
                    "from": -100,
                    "to": -90,
                    "color": "rgb(232, 150, 35)"
                  },
                  {
                    "from": -110,
                    "to": -100,
                    "color": "rgb(244, 67, 54)"
                  }
                ],
                "rangeAdvanced": []
              },
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showTicks": false,
            "tickWidth": 4,
            "colorTicks": "#666",
            "ticksValue": [],
            "animation": true,
            "animationDuration": 500,
            "animationRule": "linear",
            "useFixedLevelColor": true,
            "fixedLevelColors": [
              {
                "from": -80,
                "to": null,
                "color": "rgb(139, 195, 74)"
              },
              {
                "from": -90,
                "to": -80,
                "color": "rgb(245, 221, 0)"
              },
              {
                "from": -100,
                "to": -90,
                "color": "rgb(232, 150, 35)"
              },
              {
                "from": -110,
                "to": -100,
                "color": "rgb(244, 67, 54)"
              }
            ],
            "levelColors": [
              "rgba(0, 255, 0, 1)",
              "rgba(255, 0, 0, 1)"
            ]
          },
          "title": "Vertical bar",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {},
          "enableDataExport": false,
          "borderRadius": "0",
          "units": null,
          "decimals": 0,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "3f9e826e-adeb-19c3-e99e-afed8b69f26e"
      },
      "1f966663-99b5-e88b-0a3a-d52eefabf34f": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.1976082193038351
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.7365509554209076
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.36862824125049964
                },
                {
                  "name": "ownerName",
                  "type": "entityField",
                  "label": "Owner name",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5620998652689656
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.2548083739836403
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.6149578484243969
                },
                {
                  "name": "devEui",
                  "type": "attribute",
                  "label": "devEui",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.12104103093243201
                },
                {
                  "name": "lastActivityTime",
                  "type": "attribute",
                  "label": "lastActivityTime",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.5121276651172971,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "installationPlace",
                  "type": "attribute",
                  "label": "installationPlace",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.0657510060217319
                },
                {
                  "name": "comment",
                  "type": "attribute",
                  "label": "comment",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.468588441997866
                },
                {
                  "name": "assignedLocation",
                  "type": "attribute",
                  "label": "assignedLocation",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.7432643092667387
                },
                {
                  "name": "selectedDatapoint",
                  "type": "attribute",
                  "label": "selectedDatapoint",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.09710355494741507
                },
                {
                  "name": "mainDatapoint",
                  "type": "attribute",
                  "label": "mainDatapoint",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.9781643155856934
                },
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "service",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.5081058629269294
                },
                {
                  "name": "battery",
                  "type": "timeseries",
                  "label": "battery",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.9798206275174223
                },
                {
                  "name": "rssi",
                  "type": "timeseries",
                  "label": "rssi",
                  "color": "#ff5722",
                  "settings": {},
                  "_hash": 0.37411476998294935
                },
                {
                  "name": "snr",
                  "type": "timeseries",
                  "label": "snr",
                  "color": "#9e9e9e",
                  "settings": {},
                  "_hash": 0.511891859633471
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "meterType",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.4032935779268114
                },
                {
                  "name": "isLoRaWANDevice",
                  "type": "attribute",
                  "label": "isLoRaWANDevice",
                  "color": "#00c853",
                  "settings": {},
                  "_hash": 0.5383237690482761
                },
                {
                  "name": "assignedTo",
                  "type": "attribute",
                  "label": "assignedTo",
                  "color": "#d50000",
                  "settings": {},
                  "_hash": 0.5940377223645942
                },
                {
                  "name": "images",
                  "type": "attribute",
                  "label": "images",
                  "color": "#ffab00",
                  "settings": {},
                  "_hash": 0.818890881261392
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "90b53ba0-4ef8-c53d-09f2-cfa630c2eb44",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name 2",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.21015495759322678
                },
                {
                  "name": "email",
                  "type": "entityField",
                  "label": "Email",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.36258338029851833
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "597402e4-1533-a52d-cfde-d1c3130863bc",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "5f9afe01-220a-1b1d-b205-5732805a8871",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "187a4770-f71d-98f9-f36d-0fb1feec9895",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1748175217498,
                "endTimeMs": 1748261617498
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": {
              "body": "// --- Minimal DeviceData-only content (no header, no mode buttons) ---\r\n\r\n// Inputs\r\nlet mainDatapoint      = data?.[0]?.['mainDatapoint'];\r\nlet selectedDatapoint  = data?.[0]?.['selectedDatapoint'];\r\n\r\n// State\r\nconst params = ctx.stateController.getStateParams() || {};\r\nlet datapoints = params.datapoints || {};\r\n\r\n// Ensure chartMode defaults\r\nlet chartMode;\r\nif (params.chartMode?.entityName && params.chartMode?.entityLabel) {\r\n  chartMode = params.chartMode.entityName;\r\n} else {\r\n  chartMode = 'Live';\r\n  params.chartMode = { entityName: chartMode };\r\n}\r\n\r\n// Hidden helper for current selection (kept from original)\r\nlet hiddenDatapointDiv = '<div style=\"display:none;\">' + (selectedDatapoint || '') + '</div>';\r\n\r\n// Helpers\r\nfunction formatTimestamp(ms) {\r\n  const date = new Date(ms);\r\n  const day = String(date.getDate()).padStart(2, '0');\r\n  const month = String(date.getMonth() + 1).padStart(2, '0');\r\n  const year = date.getFullYear();\r\n  const hours = String(date.getHours()).padStart(2, '0');\r\n  const minutes = String(date.getMinutes()).padStart(2, '0');\r\n  return `${day}/${month}/${year} ${hours}:${minutes}`;\r\n}\r\n\r\nfunction normalizeKey(k) {\r\n  return String(k || '').toLowerCase();\r\n}\r\n\r\n// Map datapoint keys to state chart IDs (same logic as original)\r\nconst stateChartMap = new Map([\r\n  ['trapstate', 'ts_state_chart_trapState'],\r\n  ['output1', 'ts_state_chart_output1'],\r\n  ['input1', 'ts_state_chart_input1'],\r\n  ['leakage_status', 'ts_state_chart_leakageStatus'],\r\n  ['leakagestatus',  'ts_state_chart_leakageStatus'], // tolerate camel/snake\r\n  ['tamper_status',  'ts_state_chart_tamperStatus'],\r\n  ['tamperstatus',   'ts_state_chart_tamperStatus'],\r\n  ['magnet_status',  'ts_state_chart_magnetStatus'],\r\n  ['magnetstatus',   'ts_state_chart_magnetStatus'],\r\n  ['position',       'ts_state_chart_position'],\r\n  ['operatingstatus','ts_state_chart_operatingStatus'],\r\n]);\r\n\r\nfunction getStateChartId(key) {\r\n  if (!key) return 'ts_chart';\r\n  const norm = normalizeKey(key);\r\n  if (stateChartMap.has(norm)) return stateChartMap.get(norm);\r\n\r\n  const dp = datapoints[key] || {};\r\n  return dp.stateChart ? 'ts_state_chart' : 'ts_chart';\r\n}\r\n\r\n// Pagination + ordering (main datapoint first)\r\nconst itemsPerPage = 2;\r\nlet allKeys = Object.keys(datapoints);\r\nlet reorderedKeys = [];\r\nif (mainDatapoint && allKeys.includes(mainDatapoint)) reorderedKeys.push(mainDatapoint);\r\nallKeys.forEach(k => { if (k !== mainDatapoint) reorderedKeys.push(k); });\r\n\r\nconst totalPages = Math.max(1, Math.ceil(reorderedKeys.length / itemsPerPage));\r\nif (params.deviceMode == null) params.deviceMode = {};\r\nif (params.deviceMode.currentDataPage == null) params.deviceMode.currentDataPage = 1;\r\nlet currentPage = params.deviceMode.currentDataPage;\r\nif (currentPage < 1) currentPage = 1;\r\nif (currentPage > totalPages) currentPage = totalPages;\r\n\r\n// Build datapoint tabs row\r\nlet resultData = '<div style=\"display:flex; flex-direction:column; gap:4px; width:100%; padding:0 8px; flex:1 1 auto; min-height:0; margin-top:8px;\">';\r\n\r\nlet resultRow = '<div id=\"datapointTabsContainer\" class=\"bin-cards\" style=\"display:flex; align-items:center; gap:8px; width:100%; box-sizing:border-box; overflow-x:auto; overflow-y:hidden;\">';\r\n\r\nif (currentPage > 1) {\r\n  resultRow += `\r\n    <button id=\"previous-button\" type=\"button\"\r\n      (click)=\"ctx.actionsApi.elementClick($event)\" \r\n      data-value=\"page-${currentPage-1}\"\r\n      style=\"flex:0 0 auto; background:none; border:none; padding:4px; cursor:pointer;\" matTooltip=\"Previous\">\r\n      <mat-icon class=\"tb-mat-18\">chevron_left</mat-icon>\r\n    </button>`;\r\n}\r\n\r\nconst startIdx = (currentPage - 1) * itemsPerPage;\r\nconst pageKeys = reorderedKeys.slice(startIdx, startIdx + itemsPerPage);\r\n\r\npageKeys.forEach(keyName => {\r\n  const dp = datapoints[keyName];\r\n  const ts = dp?.ts ? formatTimestamp(dp.ts) : '';\r\n  const displayName = dp?.displayName ?? keyName;\r\n  const unit = dp?.unit ?? '';\r\n  const value = (dp?.value ?? '') + (unit || '');\r\n\r\n  const isSelected = (keyName === selectedDatapoint);\r\n  const cardClass = `bin-card${isSelected ? ' bin-card-selected' : ''}`;\r\n  resultRow += `\r\n    <div id=\"datapoint-button\"\r\n      class=\"${cardClass}\"\r\n      (click)=\"ctx.actionsApi.elementClick($event)\"\r\n      data-value=\"${keyName}\" matTooltip=\"Select datapoint\">\r\n      <div class=\"bin-card-content\">\r\n        <div class=\"bin-card-meta\">\r\n          <div class=\"bin-card-header\">${displayName}</div>\r\n          <div class=\"bin-card-ts\">${ts}</div>\r\n        </div>\r\n        <div class=\"bin-card-value\">${value}</div>\r\n      </div>\r\n    </div>`;\r\n});\r\n\r\nif (currentPage < totalPages) {\r\n  resultRow += `\r\n    <button id=\"next-button\" type=\"button\"\r\n      (click)=\"ctx.actionsApi.elementClick($event)\"\r\n      data-value=\"page-${currentPage+1}\"\r\n      style=\"flex:0 0 auto; background:none; border:none; padding:4px; cursor:pointer;\" matTooltip=\"Next\">\r\n      <mat-icon class=\"tb-mat-18\">chevron_right</mat-icon>\r\n    </button>`;\r\n}\r\n\r\nresultRow += '</div>';\r\nresultData += resultRow;\r\n\r\n// Select which chart to show\r\nconst selectedKey =\r\n  (selectedDatapoint && datapoints[selectedDatapoint]) ? selectedDatapoint :\r\n  (mainDatapoint && datapoints[mainDatapoint]) ? mainDatapoint :\r\n  reorderedKeys[0];\r\n\r\nconst chartStateId = (chartMode === 'Raw') ? 'ts_raw' : getStateChartId(selectedKey);\r\n\r\n// Chart area\r\nresultData +=\r\n  '<div style=\"flex:1 1 auto; min-height:0; display:flex;\">' +\r\n    '<tb-dashboard-state ' +\r\n      'style=\"display:block; height:100%; width:100%; margin:0; padding:0; overflow:hidden; box-sizing:border-box;\" ' +\r\n      '[ctx]=\"ctx\" stateId=\"' + chartStateId + '\">' +\r\n    '</tb-dashboard-state>' +\r\n  '</div>';\r\n\r\n// Final container (no header, no mode buttons)\r\nconst contentHtml =\r\n  '<div class=\"market-layout\" ' +\r\n    'style=\"display:flex; flex-direction:column; width:100%; height:100%; box-sizing:border-box; padding:4px 0 0 0; overflow:hidden;\">' +\r\n      '<div style=\"flex:1 1 auto; min-height:0; display:flex; flex-direction:column; overflow:hidden;\">' +\r\n        resultData +\r\n      '</div>' +\r\n  '</div>';\r\n\r\nreturn hiddenDatapointDiv + contentHtml;\r\n",
              "modules": {
                "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
              }
            },
            "applyDefaultMarkdownStyle": true,
            "markdownCss": "/* Pretty delete button  soft pill, subtle hover, focus ring */\r\n#delete-comment {\r\n  position: absolute;\r\n  bottom: 6px;\r\n  right: 12px;\r\n\r\n  width: 36px;\r\n  height: 36px;\r\n  border: 0;\r\n  border-radius: 9999px;\r\n\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n\r\n  background: transparent;\r\n  color: #ef4444;                 /* red-500 */\r\n  cursor: pointer;\r\n\r\n  transition: background .15s ease, transform .06s ease, box-shadow .15s ease;\r\n}\r\n\r\n#delete-comment:hover {\r\n  background: rgba(239, 68, 68, 0.10);  /* soft red hover */\r\n}\r\n\r\n#delete-comment:active {\r\n  transform: scale(0.96);\r\n}\r\n\r\n#delete-comment:focus-visible {\r\n  outline: none;\r\n  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.30); /* accessible focus */\r\n}\r\n\r\n#delete-comment .mat-icon {\r\n  margin: 0;\r\n  line-height: 1;\r\n  color: currentColor;            /* keep icon color in sync */\r\n}\r\n\r\n#chat-input:focus {\r\n  outline: none !important;\r\n  box-shadow: none !important;\r\n}\r\n@keyframes pulse-bg-red {\r\n  0%   { background-color: transparent; }\r\n  50%  { background-color: rgba(255, 0, 0, 0.2); }\r\n  100% { background-color: transparent; }\r\n}\r\n.pulse-bg-red {\r\n  animation: pulse-bg-red 1s ease-in-out 3;\r\n}\r\n\r\n@keyframes pulse-bg-orange {\r\n  0%   { background-color: transparent; }\r\n  50%  { background-color: rgba(255, 165, 0, 0.2); }\r\n  100% { background-color: transparent; }\r\n}\r\n.pulse-bg-orange {\r\n  animation: pulse-bg-orange 1s ease-in-out 3;\r\n}\r\n\r\n@keyframes pulse-bg-yellow {\r\n  0%   { background-color: transparent; }\r\n  50%  { background-color: rgba(255, 255, 0, 0.2); }\r\n  100% { background-color: transparent; }\r\n}\r\n.pulse-bg-yellow {\r\n  animation: pulse-bg-yellow 1s ease-in-out 3;\r\n}\r\n\r\n.comments-wrapper {\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: var(--tb-background);\r\n}\r\n\r\n.comments-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 12px 16px !important;\r\n  background-color: #FFFFFF;\r\n  border-bottom: 1px solid var(--tb-border);\r\n}\r\n\r\n.comments-title {\r\n  margin: 0;\r\n  padding: 10px;\r\n  font-size: 1rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.comments-list {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  padding: 10px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 4px;\r\n}\r\n\r\n.comment {\r\n  background-color: var(--tb-primary-50);\r\n  border-radius: 0.5rem;\r\n  box-shadow: none;\r\n  margin-left: 8px;\r\n  margin-right: 8px;\r\n}\r\n\r\n.comment:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.comment-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-size: 0.875rem;\r\n  color: var(--tb-secondary-text);\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.comment-text {\r\n  font-size: 0.9375rem;\r\n  color: var(--tb-primary-text);\r\n  line-height: 1.4;\r\n  overflow-wrap: break-word;\r\n  word-wrap: break-word;\r\n  hyphens: auto;\r\n}\r\n\r\n#edit-button {\r\n  padding: 0 !important;\r\n  min-width: 0;\r\n  width: 32px;\r\n  height: 32px;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n#edit-button .mat-button-wrapper {\r\n  display: inline-flex !important;\r\n  align-items: center !important;\r\n  justify-content: center !important;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 0 !important;\r\n}\r\n\r\n#edit-button mat-icon {\r\n  margin: 0 !important;\r\n  line-height: 1;\r\n  display: block;\r\n}\r\n\r\n\r\n/* ==================================================\r\n   History Tabs & Data Styles (with aggressive height overrides)\r\n   ================================================== */\r\n.history-container {\r\n  height: 100%;\r\n  width: 100%;\r\n  padding: 5px;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.history-container .history-tabs {\r\n  height: 100%;\r\n  width: 100%;\r\n  overflow: visible;\r\n  flex: 1;\r\n}\r\n\r\n/* If there is an explicit history-content wrapper inside. */\r\n.history-container .history-content {\r\n  height: 100%;\r\n  width: 100%;\r\n  overflow: auto;\r\n  flex: 1;\r\n}\r\n\r\n/* Color of the active MDC tab underline */\r\n.history-container .history-tabs .mat-mdc-tab .mdc-tab-indicator__content--underline {\r\n  border-color: var(--tb-primary-500);\r\n}\r\n\r\n\r\n/* ------------------------------------------\r\n   Generic (non-MDC) Angular Material overrides\r\n   ------------------------------------------ */\r\n\r\n/* Shrink the overall tab-header container */\r\n.history-tabs .mat-tab-header {\r\n  min-height: 32px !important;\r\n  height: 32px !important;\r\n  margin-bottom: 0 !important;\r\n}\r\n\r\n/* Shrink each tab label pill */\r\n.history-tabs .mat-tab-label {\r\n  min-height: 32px !important;\r\n  height: 32px !important;\r\n  line-height: 32px !important;\r\n  padding: 0 8px !important;       /* reduce horizontal padding */\r\n  font-size: 14px !important;     /* slightly smaller text */\r\n  margin: 0 !important;\r\n}\r\n\r\n/* Remove extra padding inside the label content */\r\n.history-tabs .mat-tab-label .mat-tab-label-content {\r\n  padding: 0 !important;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Shrink the ink-bar (active tab underline) thickness if desired */\r\n.history-tabs .mat-tab-header .mat-ink-bar {\r\n  height: 2px !important;\r\n  bottom: 0 !important;\r\n}\r\n\r\n/* If youre using mat-stretch-tabs or similar, ensure no extra height is forced */\r\n.history-tabs.mat-stretch-tabs .mat-tab-label {\r\n  flex: none !important;\r\n}\r\n\r\n/* ------------------------------------------\r\n   MDC-based Angular Material overrides\r\n   ------------------------------------------ */\r\n\r\n/* Shrink the MDC tab-bar container */\r\n.history-tabs .mat-mdc-tab-header {\r\n  min-height: 32px !important;\r\n  height: 32px !important;\r\n  margin-bottom: 0 !important;\r\n}\r\n\r\n/* Shrink each MDC tab */\r\n.history-tabs .mat-mdc-tab {\r\n  min-height: 32px !important;\r\n  height: 32px !important;\r\n  padding: 0 8px !important;       /* reduce horizontal padding */\r\n  margin: 0 !important;\r\n}\r\n\r\n.history-tabs .mat-mdc-tab .mdc-tab__content {\r\n  padding: 0 !important;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Thin out the MDC tab indicator underline */\r\n.history-tabs .mat-mdc-tab .mdc-tab-indicator__content--underline {\r\n  height: 2px !important;\r\n  bottom: 0 !important;\r\n}\r\n\r\n/* ==================================================\r\n   Data Point Display Styles (unchanged)\r\n   ================================================== */\r\n.data-point {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.data-point-name {\r\n  font-weight: 600;\r\n  font-size: 16px;\r\n  line-height: 18px;\r\n  margin-bottom: 2px;\r\n}\r\n\r\n.data-point-value {\r\n  font-weight: 500;\r\n  font-size: 16px;\r\n  line-height: 16px;\r\n  letter-spacing: 0.25px;\r\n  color: var(--tb-primary-500);\r\n}\r\n\r\n.device-tabs {\r\n  font-weight: 700;\r\n  font-size: 18px;\r\n  line-height: 20px;\r\n  padding: 10px;\r\n}\r\n\r\n\r\n/* ==================================================\r\n   (Optional) Reduce Gap Between Tabs & Content\r\n   ================================================== */\r\n\r\n/*\r\n  If your <tb-dashboard-state> elements have a large top margin,\r\n  reduce it or override it here. For example, to force any\r\n  <tb-dashboard-state> inside a .history-tabs to sit closer:\r\n\r\n  .history-tabs tb-dashboard-state {\r\n    margin-top: 8px !important;\r\n  }\r\n\r\n  Adjust 8px up/down to taste, or remove inline margins\r\n  in your JS-generated HTML instead.\r\n*/\r\n\r\n.mat-tab-header {\r\n  height: 5px !important;\r\n  min-height: 5px !important;\r\n}\r\n\r\n.mat-tab-label {\r\n  padding: 0 12px !important;\r\n  min-height: 5px !important;\r\n  line-height: 5px !important;\r\n}\r\n\r\n.mat-ink-bar {\r\n  height: 3px !important;\r\n}\r\n\r\n  \r\n/* Row: stay full-width and let cards stretch evenly */\r\n.bin-cards {\r\n  display: flex;\r\n  align-items: stretch;     /* equal height */\r\n  gap: 8px;\r\n  width: 100%;\r\n}\r\n\r\n\r\n/* Base bin card */\r\n.bin-card {\r\n  border: 1px solid #e5e7eb;   /* lighter subtle border */\r\n  border-radius: 9999px;\r\n  padding: 10px 16px;\r\n  background: #fff;\r\n  flex: 1 1 0;\r\n  min-width: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;\r\n}\r\n\r\n/* Hover */\r\n.bin-card:hover,\r\n.bin-card:focus-within {\r\n  background: #fafafa;\r\n  border-color: #d1d5db;       /* keep border slim but visible */\r\n}\r\n\r\n/* Selected  only thin border, no inset shadow */\r\n.bin-card.bin-card-selected {\r\n  border: 1.5px solid var(--tb-primary-500) !important; /* slightly stronger than base */\r\n  box-shadow: none;             /* remove inset thickness */\r\n}\r\n\r\n\r\n/* Layout inside card: left (name+ts) | right (value) */\r\n.bin-card-content {\r\n  display: grid;\r\n  grid-template-columns: 1fr auto;\r\n  align-items: center;\r\n  column-gap: 12px;\r\n  width: 100%;\r\n}\r\n\r\n/* Left stack kept compact so the pill doesn't look tall */\r\n/* Place timestamp under the header inside bin cards */\r\n.bin-card-meta {\r\n  display: flex;\r\n  flex-direction: column;     /* stack name + timestamp vertically */\r\n  align-items: flex-start;    /* align left */\r\n  gap: 2px;                   /* small space between them */\r\n}\r\n\r\n\r\n/* Display name  same size as headerCombined label */\r\n.bin-card-header {\r\n  font-size: 15px;\r\n  line-height: 1.4;\r\n  font-weight: 700;\r\n  color: #111827;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  max-width: 100%;\r\n}\r\n\r\n/* Timestamp  your requested size */\r\n.bin-card-ts {\r\n  font-size: 14px;\r\n  line-height: 1.4;\r\n  color: #6b7280;\r\n  font-weight: 400;\r\n  white-space: nowrap;\r\n}\r\n\r\n/* Value on the right  matches label size */\r\n.bin-card-value {\r\n  font-size: 15px;\r\n  line-height: 1.4;\r\n  font-weight: 700;\r\n  color: #111827;\r\n  white-space: nowrap;\r\n  margin-left: 8px;\r\n}\r\n\r\n/* Narrow screens: let ts wrap under name to avoid squish */\r\n@media (max-width: 640px) {\r\n  .bin-card-meta { flex-direction: column; align-items: flex-start; gap: 2px; }\r\n}\r\n\r\n\r\n\r\n.main-layout .header {\r\n    height: 60px;\r\n} \r\n\r\n.main-layout .header .mat-icon.title-icon {\r\n    width: 40px;\r\n    height: 40px;\r\n}\r\n\r\n.main-layout .header .title {\r\n    font-size: 18px;\r\n    font-weight: 500;\r\n    color: #28232D;\r\n}\r\n\r\n.main-layout .header .subtitle {\r\n    font-size: 13px;\r\n    font-weight: normal;\r\n    color: #757575;\r\n}\r\n\r\n.tb-markdown-view .params {\r\n    background-color: #FAFAFA;\r\n    border-radius: 4px;\r\n    padding: 16px;\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.tb-markdown-view .param-title {\r\n    font-size: 12px;\r\n    font-weight: normal;\r\n    color: #757575;\r\n}\r\n\r\n.tb-markdown-view .param {\r\n    font-size: 12px;\r\n    font-weight: 500;\r\n    color: #212121;\r\n    line-height: 24px;\r\n    height: 24px;\r\n}\r\n\r\n.tb-markdown-view .param img.mat-icon {\r\n    vertical-align: bottom;\r\n}\r\n\r\n.tb-markdown-view .param #battery-level {\r\n    width: 24px;\r\n    height: 24px;\r\n    line-height: 24px;\r\n    padding: 0 2px;\r\n    min-width: 28px;\r\n    vertical-align: baseline;\r\n    display: inline-block;\r\n}\r\n\r\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\r\n    height: 24px;\r\n}\r\n\r\n.tb-markdown-view .param #battery-level .mat-icon {\r\n    width: 24px;\r\n    height: 24px;\r\n    font-size: 24px;\r\n    margin: 0;    \r\n}\r\n\r\n/* keep the widget itself from scrolling; inner panels manage overflow */\r\n.market-layout { overflow: hidden; }\r\n\r\n/* Desktop proportions */\r\n.two-col { display: flex; }\r\n.col-left  { flex: 0 0 65%; min-width: 0; }\r\n.col-right { flex: 0 0 35%; min-width: 0; padding-right: 8px; }\r\n.section-top    { flex: 0 0 55%; min-height: 0; }   /* table */\r\n.section-bottom { flex: 0 0 45%; min-height: 0; }   /* comments */\r\n\r\n/* make embedded states fill their boxes */\r\n.col-right tb-dashboard-state,\r\n.section-top tb-dashboard-state,\r\n.section-bottom tb-dashboard-state { height: 100%; width: 100%; }\r\n\r\n/* Make just the table area scrollable */\r\n.table-scroll {\r\n  flex: 1 1 auto;\r\n  min-height: 0;               /* critical in flex layouts */\r\n  overflow: auto;              /* the scroll happens here */\r\n  -webkit-overflow-scrolling: touch;\r\n}\r\n\r\n/* Ensure the table itself fills width nicely */\r\n.table-scroll table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n}\r\n\r\n/* Laptop & smaller: limit the table section height so it can scroll,\r\n   while the rest of the widget remains fixed. Adjust values to taste. */\r\n@media (max-width: 1366px) {\r\n  .two-col { flex-direction: column; }\r\n\r\n  .section-top {\r\n    flex: 0 0 auto;\r\n    min-height: 280px;         /* guaranteed space for the table */\r\n    max-height: 50vh;          /* cap the section so inner scroll kicks in */\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n\r\n  .section-top .table-scroll {\r\n    height: 100%;              /* take the section-top height */\r\n    overflow: auto;            /* scroll only here */\r\n  }\r\n\r\n  /* Keep overall widget from scrolling vertically */\r\n  .market-layout {\r\n    overflow: hidden;\r\n  }\r\n}\r\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "margin": "0px",
          "borderRadius": "0px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "edit-label-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\"\r\n      (ngSubmit)=\"save()\"  class=\"edit-entity-form\" style=\"width:400px;\">\r\n    <mat-toolbar class=\"flex flex-row\" color=\"primary\">\r\n        <h2>Edit Label</h2>\r\n        <span class=\"flex-1\"></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n    </mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content class=\"flex flex-col\">\r\n        <div class=\"flex flex-row gap-2 xs:flex-col xs:gap-0\">\r\n            <mat-form-field class=\"mat-block flex-1\">\r\n                <mat-label>Entity Label</mat-label>\r\n                <input matInput formControlName=\"entityLabel\">\r\n            </mat-form-field>\r\n        </div>\r\n    </div>\r\n    <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\r\n        <button mat-button color=\"primary\"\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async)\"\r\n                (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n        </button>\r\n        <button mat-button mat-raised-button color=\"primary\"\r\n                type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">\r\n            Save\r\n        </button>\r\n    </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\n\r\nopenEditEntityDialog();\r\n\r\nfunction openEditEntityDialog() {\r\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\r\n}\r\n\r\nfunction EditEntityDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.entityName = entityName;\r\n    vm.entityType = entityId.entityType;\r\n\r\n    vm.entity = {};\r\n\r\n    vm.editEntityFormGroup = vm.fb.group({\r\n        entityLabel: [null]\r\n    });\r\n\r\n    getEntityInfo();\r\n\r\n    vm.cancel = function() {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function() {\r\n        vm.editEntityFormGroup.markAsPristine();\r\n        widgetContext.rxjs.forkJoin([\r\n            saveEntity()\r\n        ]).subscribe(function() {\r\n            widgetContext.updateAliases();\r\n            vm.dialogRef.close(null);\r\n        });\r\n    };\r\n\r\n    function getEntityInfo() {\r\n        widgetContext.rxjs.forkJoin([\r\n          attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE'),\r\n          entityService.getEntity(entityId.entityType, entityId.id)\r\n        ]).subscribe(([attributes, entity]) => {\r\n          vm.attributes = attributes;\r\n          vm.entity = entity;\r\n          vm.editEntityFormGroup.patchValue({\r\n            entityLabel: entity.label\r\n          }, { emitEvent: false });\r\n        });\r\n    }\r\n\r\n    function saveEntity() {\r\n        const newLabel = vm.editEntityFormGroup.get('entityLabel').value;\r\n        // only save if the label actually changed\r\n        if (newLabel && newLabel !== vm.entity.label) {\r\n            vm.entity.label = newLabel;\r\n            // pick the right save call based on the real entityType\r\n            if (vm.entityType === 'ASSET') {\r\n                return assetService.saveAsset(vm.entity);\r\n            } else if (vm.entityType === 'DEVICE') {\r\n                return deviceService.saveDevice(vm.entity);\r\n            }\r\n        }\r\n        // nothing changed, return a no-op observable\r\n        return widgetContext.rxjs.of(null);\r\n    }\r\n\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1706a4f-43df-cf57-5123-81e048896913"
              },
              {
                "name": "edit-devEui-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"edit-entity-form\">\r\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\r\n    <h2>Edit DevEui</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content class=\"flex flex-col\">\r\n    <div formGroupName=\"attributes\" class=\"flex flex-col\">\r\n      <div class=\"flex flex-row gap-2 xs:flex-col xs:gap-0\">\r\n        <mat-form-field class=\"mat-block flex-1\">\r\n          <mat-label>DevEui</mat-label>\r\n          <input matInput formControlName=\"devEui\">\r\n        </mat-form-field>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(isLoading$ | async)\"\r\n            (click)=\"cancel()\" cdkFocusInitial>\r\n      Cancel\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">\r\n      Save\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenEditEntityDialog();\n\nfunction openEditEntityDialog() {\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n}\n\nfunction EditEntityDialogController(instance) {\n    let vm = instance;\n\n    vm.entityName = entityName;\n    vm.entityType = entityId.entityType;\n    vm.entitySearchDirection = {\n        from: \"FROM\",\n        to: \"TO\"\n    };\n    vm.attributes = {};\n    vm.entity = {};\n\n    vm.editEntityFormGroup = vm.fb.group({\n        attributes: vm.fb.group({\n            devEui: [null]\n        }),\n    });\n\n    getEntityInfo();\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.save = function() {\n        vm.editEntityFormGroup.markAsPristine();\n        widgetContext.rxjs.forkJoin([\n            saveAttributes(entityId),\n            saveEntity()\n        ]).subscribe(function () {\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n        });\n    };\n\n    function getEntityAttributes(attributes) {\n        for (var i = 0; i < attributes.length; i++) {\n            vm.attributes[attributes[i].key] = attributes[i].value;\n        }\n    }\n\n    function getEntityInfo() {\n      widgetContext.rxjs.forkJoin([\n        // dont subscribe herejust hand forkJoin the Observable\n        attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['devEui']),\n        entityService.getEntity(entityId.entityType, entityId.id)\n      ]).subscribe(\n        ([ attributes, entity ]) => {\n          // attributes is an array of { key, value }\n          if (Array.isArray(attributes) && attributes.length) {\n            const devEuiAttr = attributes.find(a => a.key === 'devEui');\n            if (devEuiAttr) {\n              // patch just the devEui control\n              vm.editEntityFormGroup.get('attributes.devEui').setValue(devEuiAttr.value, { emitEvent: false });\n            }\n          }\n          // store entity if you need it later\n          vm.entity = entity;\n        },\n        err => console.error('Failed to fetch entity info:', err)\n      );\n    }\n\n\n    function saveEntity() {\n        const formValues = vm.editEntityFormGroup.value;\n        if (vm.entity.label !== formValues.entityLabel) {\n            vm.entity.label = formValues.entityLabel;\n            if (formValues.entityType === 'ASSET') {\n                return assetService.saveAsset(vm.entity);\n            } else if (formValues.entityType === 'DEVICE') {\n                return deviceService.saveDevice(vm.entity);\n            }\n        }\n        return widgetContext.rxjs.of([]);\n    }\n\n    function saveAttributes(entityId) {\n        let attributes = vm.editEntityFormGroup.get('attributes').value;\n        let attributesArray = [];\n        for (let key in attributes) {\n            if (attributes[key] !== vm.attributes[key]) {\n                attributesArray.push({ key: key, value: attributes[key] });\n            }\n        }\n        if (attributesArray.length > 0) {\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n        }\n        return widgetContext.rxjs.of([]);\n    }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e5ea75ef-bb27-365a-bda5-aa233a5aacd6"
              },
              {
                "name": "edit-installationPlace-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"edit-entity-form\" style=\"width: 400px;\">\r\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\r\n    <h2>Edit Installation Place</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content class=\"flex flex-col\">\r\n    <div formGroupName=\"attributes\" class=\"flex flex-col\">\r\n      <div class=\"flex flex-row gap-2 xs:flex-col xs:gap-0\">\r\n        <mat-form-field class=\"mat-block flex-1\">\r\n          <mat-label>Installation Place</mat-label>\r\n          <input matInput formControlName=\"installationPlace\">\r\n        </mat-form-field>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(isLoading$ | async)\"\r\n            (click)=\"cancel()\" cdkFocusInitial>\r\n      Cancel\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">\r\n      Save\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\n\r\nopenEditEntityDialog();\r\n\r\nfunction openEditEntityDialog() {\r\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\r\n}\r\n\r\nfunction EditEntityDialogController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.entityName = entityName;\r\n    vm.entityType = entityId.entityType;\r\n    vm.entitySearchDirection = {\r\n        from: \"FROM\",\r\n        to: \"TO\"\r\n    };\r\n    vm.attributes = {};\r\n    vm.entity = {};\r\n\r\n    vm.editEntityFormGroup = vm.fb.group({\r\n        attributes: vm.fb.group({\r\n            installationPlace: [null]\r\n        }),\r\n    });\r\n\r\n    getEntityInfo();\r\n\r\n    vm.cancel = function() {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function() {\r\n        vm.editEntityFormGroup.markAsPristine();\r\n        widgetContext.rxjs.forkJoin([\r\n            saveAttributes(entityId),\r\n            saveEntity()\r\n        ]).subscribe(function () {\r\n            widgetContext.updateAliases();\r\n            vm.dialogRef.close(null);\r\n        });\r\n    };\r\n\r\n    function getEntityAttributes(attributes) {\r\n        for (var i = 0; i < attributes.length; i++) {\r\n            vm.attributes[attributes[i].key] = attributes[i].value;\r\n        }\r\n    }\r\n\r\n    function getEntityInfo() {\r\n      widgetContext.rxjs.forkJoin([\r\n        // dont subscribe herejust hand forkJoin the Observable\r\n        attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['installationPlace']),\r\n        entityService.getEntity(entityId.entityType, entityId.id)\r\n      ]).subscribe(\r\n        ([ attributes, entity ]) => {\r\n          // attributes is an array of { key, value }\r\n          if (Array.isArray(attributes) && attributes.length) {\r\n            const installationPlaceAttr = attributes.find(a => a.key === 'installationPlace');\r\n            if (installationPlaceAttr) {\r\n              // patch just the installationPlace control\r\n              vm.editEntityFormGroup.get('attributes.installationPlace').setValue(installationPlaceAttr.value, { emitEvent: false });\r\n            }\r\n          }\r\n          // store entity if you need it later\r\n          vm.entity = entity;\r\n        },\r\n        err => console.error('Failed to fetch entity info:', err)\r\n      );\r\n    }\r\n\r\n\r\n    function saveEntity() {\r\n        const formValues = vm.editEntityFormGroup.value;\r\n        if (vm.entity.label !== formValues.entityLabel) {\r\n            vm.entity.label = formValues.entityLabel;\r\n            if (formValues.entityType === 'ASSET') {\r\n                return assetService.saveAsset(vm.entity);\r\n            } else if (formValues.entityType === 'DEVICE') {\r\n                return deviceService.saveDevice(vm.entity);\r\n            }\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n\r\n    function saveAttributes(entityId) {\r\n        let attributes = vm.editEntityFormGroup.get('attributes').value;\r\n        let attributesArray = [];\r\n        for (let key in attributes) {\r\n            if (attributes[key] !== vm.attributes[key]) {\r\n                attributesArray.push({ key: key, value: attributes[key] });\r\n            }\r\n        }\r\n        if (attributesArray.length > 0) {\r\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n        }\r\n        return widgetContext.rxjs.of([]);\r\n    }\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c739c829-cb7d-7206-7494-7cfc211a36a4"
              },
              {
                "name": "edit-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editForm\"\n      (ngSubmit)=\"save()\" class=\"edit-entity-form\">\n    <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n        <h2>Edit Comment</h2>\n        <span class=\"flex-1\"></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n    <div mat-dialog-content class=\"flex flex-col\">\n        <div class=\"flex flex-row gap-2 xs:flex-col xs:gap-0\">\n            <mat-form-field appearance=\"fill\" class=\"w-full\">\n              <mat-label>Comment</mat-label>\n              <textarea matInput formControlName=\"comment\" rows=\"4\"></textarea>\n            </mat-form-field>\n        </div>\n    </div>\n    <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n        <button mat-button color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"cancel()\" cdkFocusInitial>\n            Cancel\n        </button>\n        <button mat-button mat-raised-button color=\"primary\"\n                type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">\n            Save\n        </button>\n    </div>\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nconst userService      = $injector.get(widgetContext.servicesMap.get('userService'));\r\n\r\nlet currentUser = widgetContext.datasources[1].entityName;\r\nconst { mergeMap, of } = widgetContext.rxjs;\r\n\r\nopenEditCommentDialog();\r\n//console.log(widgetContext.stateController.getStateParams());\r\nfunction openEditCommentDialog() {\r\n  customDialog.customDialog(htmlTemplate, EditCommentDialogController).subscribe();\r\n}\r\n\r\nfunction EditCommentDialogController(instance) {\r\n  const vm = instance;\r\n  //console.log(widgetContext);\r\n  vm.editForm = vm.fb.group({\r\n    comment: ['']\r\n  });\r\n\r\n  vm.isLoading$ = widgetContext.rxjs.of(false);\r\n\r\n  attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['comment'])\r\n  .subscribe(\r\n    (attrs) => {\r\n      if (!attrs || !attrs.length) return;\r\n\r\n      // attrs[0].value might already be an object, or might be a JSON-string\r\n      const raw = attrs[0].value;\r\n      let payload;\r\n\r\n      if (typeof raw === 'string') {\r\n        // only parse if it's actually a string\r\n        try {\r\n          payload = JSON.parse(raw);\r\n        } catch (e) {\r\n          console.warn('Could not JSON.parse comment, falling back to raw value', e);\r\n          payload = { text: raw };\r\n        }\r\n      } else if (typeof raw === 'object' && raw !== null) {\r\n        // already an object\r\n        payload = raw;\r\n      } else {\r\n        // unexpectedtreat it as text\r\n        payload = { text: String(raw) };\r\n      }\r\n\r\n      // now safely grab `.text`\r\n      const savedText = payload.text || '';\r\n      vm.editForm.get('comment').setValue(savedText);\r\n    },\r\n    (err) => {\r\n      console.error('Failed to load comment attribute:', err);\r\n    }\r\n  );\r\n\r\n\r\n  vm.cancel = () => vm.dialogRef.close();\r\n\r\n  vm.save = () => {\r\n      if (vm.editForm.invalid) {\r\n        return;\r\n      }\r\n    \r\n      vm.isLoading$ = of(true);\r\n      const newText = vm.editForm.get('comment').value;\r\n      const newEntry = {\r\n        author:       currentUser,\r\n        creationTime: Date.now(),\r\n        text:         newText\r\n      };\r\n    \r\n      // 1) load existing comment attr  \r\n      attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['comment']).pipe(\r\n        mergeMap(attrs => {\r\n          let comments = [];\r\n    \r\n          if (attrs && attrs.length > 0) {\r\n            const raw = attrs[0].value;\r\n            try {\r\n              // Could be a single object or an array\r\n              const parsed = typeof raw === 'string' ? JSON.parse(raw) : raw;\r\n              comments = Array.isArray(parsed) ? parsed : [parsed];\r\n            } catch (e) {\r\n              console.warn('Could not parse existing comment JSON, starting fresh', e);\r\n            }\r\n          }\r\n    \r\n          // 2) append new comment\r\n          comments.push(newEntry);\r\n    \r\n          // 3) save back as JSON array\r\n          const attr = {\r\n            key:   'comment',\r\n            value: JSON.stringify(comments)\r\n          };\r\n          return attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', [attr]);\r\n        })\r\n      ).subscribe(\r\n        () => vm.dialogRef.close(),\r\n        err => {\r\n          console.error('Failed to save comment:', err);\r\n          widgetContext.showErrorToast(\r\n            'Failed to save comment: ' + err.message,\r\n            4000, 'top', 'center'\r\n          );\r\n        }\r\n      );\r\n    };\r\n\r\n\r\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e89c0c9b-6214-4c3c-04ca-2d1c27a14ef6"
              },
              {
                "name": "device-attributes-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"deviceAttributes\";\nlet params = widgetContext.stateController.getStateParams();\nparams['deviceMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd665c76\"\n    },\n    entityName: mode,\n    entityLabel: mode\n};\nparams['targetEntityParamName'] = \"deviceMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "eff2da81-4a37-ee70-904d-92d10a6884e3"
              },
              {
                "name": "device-data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "(async function runCustomAction() {\r\n \r\n  // 1. Grab core services & context\r\n  const injector         = widgetContext.$scope.$injector;\r\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\r\n  const stateController  = widgetContext.stateController;\r\n  const params           = stateController.getStateParams();\r\n  const deviceIdObj      = entityId;                // provided by the action trigger\r\n  const MODE_NAME        = 'deviceData';\r\n \r\n  try {\r\n    // 2. Load profile description + datapoint metadata\r\n    const { mainDatapoint, datapointDefinitions } =\r\n      await utils.getDeviceProfileDescription(widgetContext,deviceIdObj.id);\r\n    // 3. Persist the selectedDatapoint attribute on the device\r\n    await new Promise((resolve, reject) => {\r\n      attributeService\r\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\r\n          { key: 'selectedDatapoint', value: mainDatapoint }\r\n        ])\r\n        .subscribe(resolve, reject);\r\n    });\r\n \r\n    // 4. Fetch & format latest timeseries using the metadata\r\n    const formattedDatapoints = \r\n      await utils.getLatestTimeseriesInfos(widgetContext,params.selectedDevice.entityId, datapointDefinitions);\r\n \r\n    // 5. Update dashboard state parameters\r\n    params.datapoints            = formattedDatapoints;\r\n    params.mainDatapoint         = mainDatapoint;\r\n    params.deviceMode            = {\r\n      entityId: {\r\n        entityType: 'DEVICE',\r\n        id:         '6503e900-0c65-11ef-842a-1fe8cd665c77'\r\n      },\r\n      entityName:  MODE_NAME,\r\n      entityLabel: MODE_NAME\r\n    };\r\n    params.targetEntityParamName = 'deviceMode';\r\n \r\n    // push the new state\r\n    stateController.updateState(null, params);\r\n \r\n  } catch (error) {\r\n    // 6. Centralized error handling\r\n    console.error('Custom action failed:', error);\r\n  }\r\n \r\n})();\r\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1b735f5b-de95-ba68-8315-afcc16622fa1"
              },
              {
                "name": "device-alarms-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"deviceAlarms\";\nlet params = widgetContext.stateController.getStateParams();\nparams['deviceMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd665c79\"\n    },\n    entityName: mode,\n    entityLabel: mode\n};\nparams['targetEntityParamName'] = \"deviceMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d31f97d9-94b8-191a-7bc4-dd1dff21ba84"
              },
              {
                "name": "device-comments-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"deviceComments\";\nlet params = widgetContext.stateController.getStateParams();\nparams['deviceMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd665c78\"\n    },\n    entityName: mode,\n    entityLabel: mode\n};\nparams['targetEntityParamName'] = \"deviceMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b9362182-81c5-3572-8a98-1879c705ba0f"
              },
              {
                "name": "location-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet params = widgetContext.stateController.getStateParams();\n\nlet locationQuery = {\n  \"parameters\": {\n    \"rootId\": entityId.id,\n    \"rootType\": \"DEVICE\",\n    \"direction\": \"TO\",\n    \"relationTypeGroup\": \"COMMON\",\n    \"maxLevel\": 1,\n    \"fetchLastLevelOnly\": false\n  },\n  \"relationType\": \"Contains\",\n  \"assetTypes\": [\n    \"Location\"\n  ]\n};\n\nassetService.findByQuery(locationQuery).subscribe(location => {\n    //console.log(\"loc:\", location[0]);\n    params['homeWidgetMode'] = {\n        \"entityId\":{\n               \"entityType\":\"DEVICE\",\n               \"id\":\"6503e900-0c65-11ef-842a-1fe8cd6cccc8\"\n            },\n            \"entityName\":\"locations\",\n            \"entityLabel\":\"locations\"\n    }\n    params['selectedDevice'] = null;\n    params['deviceMode'] = null;\n    params['tabMode'] = null;\n    params['selectedLocation'] = { \n        entityId: location[0].id,\n        entityName: location[0].name,\n        entityLabel: location[0].label\n    };\n    \n    params['targetEntityParamName'] = \"selectedLocation\";\n    \n    //console.log(\"params:\", params);\n    widgetContext.stateController.updateState(null, params);\n});",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1467f41d-16ea-fffd-3133-42e1ee330ef8"
              },
              {
                "name": "datapointTabChange",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector     = widgetContext.$scope.$injector;\r\nlet attributeService  = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\nlet params = widgetContext.stateController.getStateParams();\r\n\r\nvar newValue;\r\n//console.log(\"$event:\", $event);\r\nif ($event) {\r\n    // If the event object is available, get data from the events target\r\n    newValue = $event.currentTarget.getAttribute('data-value');\r\n}\r\n\r\n//console.log(\"newValue:\", newValue);\r\n\r\nconst attributes = [{\r\n  key: \"selectedDatapoint\",\r\n  value: newValue\r\n}];\r\n\r\nparams['selectedDatapointTab'] = { \r\n        entityId: {\r\n            entityType: \"ASSET\",\r\n            id:\"6503e900-0c65-11ef-842a-1fe8cd665c95\"\r\n        },\r\n        entityName: newValue,\r\n        entityLabel: newValue\r\n    };\r\n    params['targetEntityParamName'] = \"selectedDatapointTab\";\r\n    \r\nattributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', attributes)\r\n  .subscribe( result => {\r\n      \r\n    widgetContext.stateController.updateState(null, params);\r\n\r\n    () => //console.log('Attribute saved successfully'),\r\n    err => console.error('failed to save attribute', err)\r\n  });\r\n  \r\n  ",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f7033359-c1a0-e5e0-47f2-ee1faf6097a0"
              },
              {
                "name": "previous-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\nlet params = widgetContext.stateController.getStateParams();\r\nconst val = event.currentTarget.getAttribute('data-value'); // z.B. \"page-2\"\r\n  if (val.startsWith('page-')) {\r\n    const nextPage = parseInt(val.split('-')[1], 10);\r\n    params.deviceMode.currentDataPage = nextPage;\r\n    widgetContext.stateController.updateState(null, params);\r\n  }\r\n  \r\n  attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['selectedDatapoint']).subscribe(response => {\r\n    attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'selectedDatapoint', value: response}]).subscribe();  \r\n})",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "cde4b9e0-13eb-74eb-ee21-740bbd16c402"
              },
              {
                "name": "next-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\n\r\n\r\nlet params = widgetContext.stateController.getStateParams();\r\n  const val = event.currentTarget.getAttribute('data-value'); // z.B. \"page-2\"\r\n\r\n  // 2) Wenn es eine Page-Anweisung ist, extrahiere die Zahl\r\n  if (val.startsWith('page-')) {\r\n    const nextPage = parseInt(val.split('-')[1], 10);\r\n    params.deviceMode.currentDataPage = nextPage;\r\n  }\r\n  \r\n  \r\n  // (Optional) else: Karten-Click, dann ist val der keyName\r\n\r\n  // 3) State updaten\r\n  widgetContext.stateController.updateState(null, params);\r\n  \r\n  attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['selectedDatapoint']).subscribe(response => {\r\n    attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'selectedDatapoint', value: response}]).subscribe();  \r\n})",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "243e798c-e97a-a5ab-7309-78aafeed7832"
              },
              {
                "name": "back-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n//var number = (widgetContext.stateController.getStateIndex())-1;\n\n//params['targetEntityParamName'] = \"homeWidgetMode\";\nparams['selectedDevice'] = null;\n//params['selectedLocation'] = null;\n//params['tabMode'] = null;\nparams['deviceMode'] = null;\nparams['datapoints'] = null;\nparams['mainDatapoint'] = null;\n//params['gatewaysMode'] = null;\n//params['alarmsMode'] = null;\n//params['locationMode'] = null;\n\nwidgetContext.stateController.updateState(null,params);\n//widgetContext.stateController.navigatePrevState(number);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c49af78f-d8c3-966e-d3a8-ae44d651c99a"
              },
              {
                "name": "datapoint-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector     = widgetContext.$scope.$injector;\r\nlet attributeService  = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\nlet params = widgetContext.stateController.getStateParams();\r\n\r\nvar newValue;\r\n//console.log(\"$event:\", $event);\r\nif ($event) {\r\n    // If the event object is available, get data from the events target\r\n    newValue = $event.currentTarget.getAttribute('data-value');\r\n}\r\n\r\n//console.log(\"newValue:\", newValue);\r\n\r\nconst attributes = [{\r\n  key: \"selectedDatapoint\",\r\n  value: newValue\r\n}];\r\n\r\nparams['selectedDatapointTab'] = { \r\n        entityId: {\r\n            entityType: \"ASSET\",\r\n            id:\"6503e900-0c65-11ef-842a-1fe8cd665c95\"\r\n        },\r\n        entityName: newValue,\r\n        entityLabel: newValue\r\n    };\r\n    params['targetEntityParamName'] = \"selectedDatapointTab\";\r\n    \r\nattributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', attributes)\r\n  .subscribe( result => {\r\n      \r\n    widgetContext.stateController.updateState(null, params);\r\n\r\n    () => //console.log('Attribute saved successfully'),\r\n    err => console.error('failed to save attribute', err)\r\n  });\r\n  \r\n  ",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d9d0691a-18fe-57a6-4b8a-6542c327b6a2"
              },
              {
                "name": "chat-submit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet currentUser = widgetContext.datasources[1].entityName;\r\nconst input = document.getElementById('chat-input');\r\nconst newText = input.value;\r\ninput.value = null;\r\nconst newEntry = {\r\n        author:       currentUser,\r\n        creationTime: Date.now(),\r\n        text:         newText\r\n      };\r\nattributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['comment'])\r\n  .subscribe(\r\n    (attrs) => {\r\n\tlet comments = [];\r\n\tif (attrs && attrs.length > 0) {\r\n            const raw = attrs[0].value;\r\n            try {\r\n              // Could be a single object or an array\r\n              const parsed = typeof raw === 'string' ? JSON.parse(raw) : raw;\r\n              comments = Array.isArray(parsed) ? parsed : [parsed];\r\n            } catch (e) {\r\n              console.warn('Could not parse existing comment JSON, starting fresh', e);\r\n            }\r\n          }\r\n\t  // 2) append new comment\r\n\t  comments.push(newEntry);\r\n\r\n\t  // 3) save back as JSON array\r\n\t  const attr = {\r\n\t\tkey:   'comment',\r\n\t\tvalue: JSON.stringify(comments)\r\n\t  };\r\n\t attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', [attr]).subscribe();\r\n\t \r\n});",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "86466c1c-a661-c98c-7054-8b5b0690523d"
              },
              {
                "name": "delete-comment",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector         = widgetContext.$scope.$injector;\r\nlet dialogs           = $injector.get(widgetContext.servicesMap.get('dialogs'));\r\nlet attributeService  = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\nconst rawVal = event.currentTarget.getAttribute('data-value');\r\nconst viewIndex = Number(rawVal); // ensure number\r\n\r\n// 1) Ask for confirmation first\r\ndialogs\r\n  .confirm(\r\n    'Delete comment?',\r\n    'Are you sure you want to delete this comment? The comment will be unrecoverable.',\r\n    'Cancel',\r\n    'Delete'\r\n  )\r\n  .subscribe(result => {\r\n    if (!result) return; // user cancelled\r\n    deleteCommentByIndex(viewIndex);\r\n  });\r\n\r\n// 2) Proceed only if confirmed\r\nfunction deleteCommentByIndex(vIndex) {\r\n  attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', ['comment'])\r\n    .subscribe(attrs => {\r\n      let comments = [];\r\n      if (attrs && attrs.length && attrs[0].value != null) {\r\n        try {\r\n          const raw = attrs[0].value;\r\n          const parsed = (typeof raw === 'string') ? JSON.parse(raw) : raw;\r\n          comments = Array.isArray(parsed) ? parsed : [parsed];\r\n        } catch (e) {\r\n          console.warn('Failed to parse existing comments; aborting delete.', e);\r\n          dialogs.alert('Delete failed', 'Could not parse existing comments. Please try again.', 'OK').subscribe();\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Your original mapping: UI index -> array index from the end\r\n      const idx = comments.length - 1 - vIndex;\r\n      if (idx < 0 || idx >= comments.length) {\r\n        dialogs.alert('Delete failed', 'Comment index is out of range.', 'OK').subscribe();\r\n        return;\r\n      }\r\n\r\n      comments.splice(idx, 1);\r\n\r\n      const attr = {\r\n        key:   'comment',\r\n        value: JSON.stringify(comments)\r\n      };\r\n\r\n      attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', [attr])\r\n        .subscribe(() => {\r\n          // Optional: refresh UI if needed\r\n          if (widgetContext.updateAliases) widgetContext.updateAliases();\r\n        });\r\n    });\r\n}\r\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "34aceb4d-2fa8-3f8d-5428-60b689816da2"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery-level",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "02b80b2c-9573-51d8-f289-25440cfc21ac"
              },
              {
                "name": "device-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "function openDeviceManagement() {\r\n  const id = entityId?.id;\r\n  if (!id) {\r\n    console.warn('No entityId found!');\r\n    return;\r\n  }\r\n\r\n  const url = `https://cloud.pke-iot.expert/entities/devices/all/${id}`;\r\n  window.open(url, '_blank', 'noopener,noreferrer');\r\n}\r\n\r\nopenDeviceManagement();",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "65b27697-c41c-009f-27d4-ba0033a09d65"
              },
              {
                "name": "snr-widget",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "snr_widget",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "300px",
                "popoverHeight": "150px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "9341e4dc-5781-64fa-96bd-7c0debe82d75"
              },
              {
                "name": "rssi-widget",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "rssi_widget",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "300px",
                "popoverHeight": "150px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "8b3853aa-4842-1ec1-c112-395b2c63b30f"
              },
              {
                "name": "transfer-device-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.transferDevice(widgetContext, entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3b34e226-5b5e-9223-60da-d42728abb1ba"
              },
              {
                "name": "claim-device-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.assignDeviceToUser(widgetContext, entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "033e4e4a-eb00-357f-5cef-4304d72323b6"
              },
              {
                "name": "add-image-button2",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\" (ngSubmit)=\"save()\" class=\"edit-entity-form\">\r\n  <mat-toolbar class=\"tb-toolbar\" color=\"primary\">\r\n    <div class=\"tb-title\">\r\n      <mat-icon>image</mat-icon>\r\n      <h2>Add image</h2>\r\n    </div>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\" aria-label=\"Close\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"accent\" mode=\"indeterminate\" *ngIf=\"isSaving\"></mat-progress-bar>\r\n  <div class=\"spacer-xxs\" *ngIf=\"!isSaving\"></div>\r\n\r\n  <div mat-dialog-content class=\"content\" style=\"padding-top:8px;\">\r\n    <div style=\"display:flex; align-items:center; gap:12px; width:100%;\">\r\n      <div style=\"position:relative; width:64px; height:64px; border:1px solid #e5e7eb; border-radius:4px; background:#fff; display:grid; place-items:center; flex:0 0 64px;\">\r\n        <ng-container *ngIf=\"selectedImage; else noThumb\">\r\n          <img [src]=\"selectedImage\" alt=\"\" style=\"max-width:100%; max-height:100%; object-fit:cover; display:block; border-radius:2px;\" />\r\n          <button type=\"button\" mat-icon-button (click)=\"clearSelected()\" aria-label=\"Remove\" style=\"position:absolute; top:-8px; right:-8px; background:#fff; border:1px solid #e5e7eb; width:24px; height:24px;\">\r\n            <mat-icon style=\"font-size:16px;\">close</mat-icon>\r\n          </button>\r\n        </ng-container>\r\n        <ng-template #noThumb>\r\n          <mat-icon style=\"opacity:.6;\">image</mat-icon>\r\n        </ng-template>\r\n      </div>\r\n\r\n      <div\r\n        [class.dragover]=\"isDragOver\"\r\n        (dragover)=\"onDragOver($event)\"\r\n        (dragleave)=\"onDragLeave($event)\"\r\n        (drop)=\"onDrop($event)\"\r\n        style=\"flex:1 1 auto; min-height:64px; border:1px dashed #d1d5db; border-radius:6px; display:flex; align-items:center; justify-content:center; gap:6px; background:#fff; transition:border-color .15s ease, background .15s ease; padding:8px;\"\r\n      >\r\n        <mat-icon style=\"opacity:.5;\">cloud_upload</mat-icon>\r\n        <div style=\"display:flex; align-items:center; gap:6px; flex-wrap:wrap;\">\r\n          <span style=\"color:#6b7280;\">Drag &amp; Drop</span>\r\n          <span style=\"color:#6b7280;\">or</span>\r\n          <a href=\"#\" (click)=\"$event.preventDefault(); browse(fileInput)\" style=\"color:#1976d2; text-decoration:none;\">Browse</a>\r\n        </div>\r\n        <input #fileInput type=\"file\" accept=\"image/*\" (change)=\"onFileInput($event)\" style=\"display:none;\" />\r\n      </div>\r\n\r\n      <div style=\"flex:0 0 auto; display:flex; align-items:center; gap:8px;\">\r\n        <button mat-icon-button type=\"submit\" [disabled]=\"isSaving || editEntityForm.invalid || !editEntityForm.dirty\" aria-label=\"Save\">\r\n          <mat-icon>check</mat-icon>\r\n        </button>\r\n        <button mat-icon-button type=\"button\" (click)=\"clearSelected()\" aria-label=\"Clear\">\r\n          <mat-icon>close</mat-icon>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2 p-4\">\r\n    <button mat-flat-button type=\"button\" (click)=\"cancel()\" [disabled]=\"isSaving\" cdkFocusInitial>Cancel</button>\r\n    <button mat-flat-button color=\"primary\" type=\"submit\" [disabled]=\"isSaving || editEntityForm.invalid || !editEntityForm.dirty\">Save</button>\r\n  </div>\r\n</form>\r\n",
                "customCss": ".custom-picture-dialog .dragover {\n  border-color: #90caf9 !important;\n  background: #f6fbff !important;\n}\n\n\n/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "const injector = widgetContext.$scope.$injector;\r\nconst attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\r\nconst customDialog = injector.get(widgetContext.servicesMap.get('customDialog'));\r\nconst actionsApi = widgetContext.actionsApi;\r\nconst imageService = (() => { try { return injector.get(widgetContext.servicesMap.get('imageService')); } catch (e) { return null; } })();\r\nconst http = (() => { try { return injector.get(widgetContext.servicesMap.get('http')); } catch (e) { return null; } })();\r\n\r\nopenPictureDialog();\r\n\r\nfunction openPictureDialog() {\r\n  const dialogOptions = { fullscreen: false, width: '490px', maxWidth: '95vw', height: 'auto', maxHeight: '90vh', autoFocus: false, panelClass: 'custom-picture-dialog' };\r\n  try { customDialog.customDialog(htmlTemplate, PictureDialogController, null, dialogOptions).subscribe(); }\r\n  catch (e) { customDialog.customDialog(htmlTemplate, PictureDialogController, dialogOptions).subscribe(); }\r\n}\r\n\r\nfunction isDataUrl(str) { return typeof str === 'string' && /^data:image\\//i.test(str); }\r\n\r\nfunction toAbsolute(url) {\r\n  if (!url) return url;\r\n  if (/^(?:https?:)?\\/\\//i.test(url) || url.startsWith('data:')) return url;\r\n  let base = (widgetContext.$rootScope?.ctx?.serverApiUrl) || (widgetContext.tbServer?.apiUrl) || (typeof location !== 'undefined' ? location.origin : '');\r\n  if (!base) return url;\r\n  base = base.replace(/\\/+$/, '');\r\n  if (base.toLowerCase().endsWith('/api')) base = base.slice(0, -4);\r\n  return base + '/' + url.replace(/^\\/+/, '');\r\n}\r\n\r\nfunction dataUrlToFile(dataUrl, filename) {\r\n  const [meta, b64] = (dataUrl || '').split(',');\r\n  const mime = (meta && meta.match(/:(.*?);/) || [, 'image/png'])[1];\r\n  const bin = atob(b64 || '');\r\n  const u8 = new Uint8Array(bin.length);\r\n  for (let i = 0; i < bin.length; i++) u8[i] = bin.charCodeAt(i);\r\n  return new File([u8], filename, { type: mime });\r\n}\r\n\r\nfunction tsStringLocal() {\r\n  const d = new Date(); const pad = n => String(n).padStart(2, '0');\r\n  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}-${pad(d.getHours())}-${pad(d.getMinutes())}-${pad(d.getSeconds())}`;\r\n}\r\n\r\nfunction uploadImageToGallery(dataUrl, title) {\r\n  const file = dataUrlToFile(dataUrl, (title || 'image') + '.png');\r\n  if (imageService?.uploadImage) return imageService.uploadImage(file, title);\r\n  if (!http) return widgetContext.rxjs.throwError('No imageService/http available.');\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n  formData.append('title', title || 'image');\r\n  formData.append('imageSubType', 'IMAGE');\r\n  return http.post('/api/image', formData);\r\n}\r\n\r\nfunction saveEntityAttribute(entityIdObj, key, value) {\r\n  const attrs = [{ key, value }];\r\n  return attributeService.saveEntityAttributes(entityIdObj, 'SERVER_SCOPE', attrs);\r\n}\r\n\r\nfunction PictureDialogController(instance) {\r\n  const vm = instance;\r\n  const raw = widgetContext.stateController.getStateParams();\r\n  const entityIdObj = raw?.selectedDevice?.entityId;\r\n  if (!entityIdObj || !entityIdObj.entityType) return;\r\n\r\n  vm.selectedImage = null;\r\n  vm.imageId = null;\r\n  vm.isSaving = false;\r\n  vm.isDragOver = false;\r\n\r\n  vm.editEntityFormGroup = vm.fb.group({ attributes: vm.fb.group({ image: [null] }) });\r\n\r\n  function getDeviceById(deviceId) { if (!http) return widgetContext.rxjs.throwError('No http client'); return http.get(`/api/device/${deviceId}`); }\r\n\r\n  function setPreview(url, markDirty = false) {\r\n    if (!url) return;\r\n    vm.selectedImage = toAbsolute(url);\r\n    const ctrl = vm.editEntityFormGroup.get('attributes.image');\r\n    ctrl.setValue(vm.selectedImage, { emitEvent: false });\r\n    if (markDirty) vm.editEntityFormGroup.markAsDirty();\r\n  }\r\n\r\n  vm.onFileInput = (event) => {\r\n    const file = event?.target?.files?.[0];\r\n    if (!file || !file.type.startsWith('image/')) { widgetContext.showWarnToast('Please select an image.'); return; }\r\n    const reader = new FileReader();\r\n    reader.onload = () => setPreview(reader.result, true);\r\n    reader.onerror = () => widgetContext.showWarnToast('Failed to read file.');\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  vm.onDragOver = (e) => { e.preventDefault(); e.stopPropagation(); vm.isDragOver = true; };\r\n  vm.onDragLeave = (e) => { e.preventDefault(); e.stopPropagation(); vm.isDragOver = false; };\r\n  vm.onDrop = (e) => {\r\n    e.preventDefault(); e.stopPropagation(); vm.isDragOver = false;\r\n    const file = e?.dataTransfer?.files?.[0];\r\n    if (!file || !file.type.startsWith('image/')) { widgetContext.showWarnToast('Please drop an image.'); return; }\r\n    const reader = new FileReader();\r\n    reader.onload = () => setPreview(reader.result, true);\r\n    reader.onerror = () => widgetContext.showWarnToast('Failed to read dropped file.');\r\n    reader.readAsDataURL(file);\r\n  };\r\n    \r\n    vm.clearSelected = () => {\r\n      vm.selectedImage = null;\r\n      const ctrl = vm.editEntityFormGroup.get('attributes.image');\r\n      ctrl.setValue(null, { emitEvent: false });\r\n      vm.editEntityFormGroup.markAsPristine();\r\n    };\r\n    \r\n    vm.browse = (inputEl) => {\r\n      if (inputEl && inputEl.click) inputEl.click();\r\n    };\r\n\r\n  vm.cancel = () => vm.dialogRef.close();\r\n\r\n  vm.save = () => {\r\n    const value = vm.editEntityFormGroup.get('attributes.image').value;\r\n    if (!value) { vm.dialogRef.close(); return; }\r\n    vm.isSaving = true;\r\n    const deviceId = entityIdObj.id;\r\n    const authorEmail = (widgetContext.stateController.getStateParams()?.currentUser?.email) || 'User';\r\n    widgetContext.rxjs.forkJoin([\r\n      getDeviceById(deviceId),\r\n      attributeService.getEntityAttributes(entityIdObj, 'SERVER_SCOPE', ['images'])\r\n    ]).subscribe(\r\n      ([device, attrs]) => {\r\n        const deviceName = device?.name || 'device';\r\n        const imagesAttr = attrs?.find(a => a.key === 'images');\r\n        let images = [];\r\n        if (imagesAttr) {\r\n          const v = imagesAttr.value;\r\n          if (Array.isArray(v)) images = v; else if (typeof v === 'string') { try { images = JSON.parse(v); } catch (e) {} }\r\n        }\r\n        const nextIndex = (Array.isArray(images) ? images.length : 0) + 1;\r\n        const tsNow = tsStringLocal();\r\n        const desiredName = `${deviceName}_${tsNow}_image${nextIndex}`;\r\n        const upload$ = isDataUrl(value) ? uploadImageToGallery(value, desiredName) : widgetContext.rxjs.of(null);\r\n        upload$.subscribe(\r\n          (imageInfo) => {\r\n            let finalUrl = toAbsolute(value);\r\n            let finalId = vm.imageId;\r\n            if (imageInfo) {\r\n              const id = imageInfo?.id?.id || imageInfo?.id || null;\r\n              const publicUrl = imageInfo?.publicLink ? toAbsolute(imageInfo.publicLink) : imageInfo?.publicResourceKey ? toAbsolute(`/api/images/public/${imageInfo.publicResourceKey}`) : id ? toAbsolute(`/api/image/${id}/download`) : finalUrl;\r\n              finalUrl = publicUrl;\r\n              finalId = id || finalId;\r\n              images = Array.isArray(images) ? images.slice() : [];\r\n              images.push({ name: desiredName, ts: tsNow, imageId: id, url: publicUrl, author: authorEmail });\r\n            }\r\n            const ops = [ saveEntityAttribute(entityIdObj, 'image', finalUrl) ];\r\n            if (finalId) ops.push(saveEntityAttribute(entityIdObj, 'imageId', finalId));\r\n            if (imageInfo) ops.push(saveEntityAttribute(entityIdObj, 'images', images));\r\n            widgetContext.rxjs.forkJoin(ops).subscribe(\r\n              () => { vm.isSaving = false; widgetContext.showSuccessToast('Image saved.'); vm.dialogRef.close(); },\r\n              (error) => { vm.isSaving = false; alert('Image save failed ' + JSON.stringify(error)); }\r\n            );\r\n          },\r\n          (err) => { vm.isSaving = false; widgetContext.dialogs.alert('Upload failed', JSON.stringify(err)); }\r\n        );\r\n      },\r\n      (err) => { vm.isSaving = false; widgetContext.dialogs.alert('Device fetch failed', JSON.stringify(err)); }\r\n    );\r\n  };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a6512a0d-85ee-aa45-3c5e-3e01b2f465bc"
              },
              {
                "name": "add-image-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\"\r\n      (ngSubmit)=\"save()\"  class=\"edit-entity-form\" style=\"width:600px;\">\r\n    <mat-toolbar class=\"flex flex-row\" color=\"primary\">\r\n        <h2>Add image</h2>\r\n        <span class=\"flex-1\"></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n    </mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n    <div mat-dialog-content class=\"flex flex-col\">\r\n    \r\n     <!-- DROP ZONE/UPLOAD-->\r\n    <div class=\"pz-uploader\"\r\n         [class.drag-over]=\"isDragOver\">\r\n    \r\n      <!-- Left: thumbnail (or empty placeholder) -->\r\n      <div class=\"pz-thumb\" *ngIf=\"selectedImage; else pzEmptyThumb\">\r\n        <img [src]=\"selectedImage\" alt=\"preview\">\r\n        <button type=\"button\" class=\"pz-thumb-remove\" (click)=\"clearSelected()\">\r\n          <mat-icon>close</mat-icon>\r\n        </button>\r\n      </div>\r\n      <ng-template #pzEmptyThumb>\r\n        <div class=\"pz-thumb pz-thumb-empty\">\r\n          <mat-icon>image</mat-icon>\r\n        </div>\r\n      </ng-template>\r\n    \r\n      <!-- Middle: big dashed drop area -->\r\n      <div class=\"pz-droparea\"\r\n           (dragover)=\"onDragOver($event)\"\r\n           (dragleave)=\"onDragLeave($event)\"\r\n           (drop)=\"onDrop($event)\">\r\n    \r\n        <div class=\"pz-prompt\">\r\n          <span>Drag & Drop</span>\r\n          <span class=\"pz-or\">or</span>\r\n          <a href=\"\" (click)=\"$event.preventDefault(); browse(fileInput)\">Browse</a>\r\n        </div>\r\n    \r\n        <input #fileInput type=\"file\" accept=\"image/*\" (change)=\"onFileInput($event)\" hidden>\r\n      </div>\r\n    \r\n      <!-- Right: action icons -->\r\n      <div class=\"pz-actions\">\r\n        <button mat-icon-button\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\"\r\n                (click)=\"save()\">\r\n          <mat-icon>check</mat-icon>\r\n        </button>\r\n        <button mat-icon-button type=\"button\" (click)=\"clearSelected()\">\r\n          <mat-icon>close</mat-icon>\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n\r\n\r\n    </div>\r\n    <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\r\n        <button mat-button color=\"primary\"\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async)\"\r\n                (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n        </button>\r\n        <button mat-button mat-raised-button color=\"primary\"\r\n                type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">\r\n            Save\r\n        </button>\r\n    </div>\r\n</form>\r\n",
                "customCss": "/* Layout container */\n.pz-uploader{\n  display:flex;\n  align-items:center;\n  gap:12px;\n  padding:8px 10px;\n}\n\n/* Thumbnail box */\n.pz-thumb{\n  width:76px;          /* visually matches the screenshot */\n  height:72px;\n  border:1px solid #e5e7eb;\n  border-radius:6px;\n  background:#f7f7f9;\n  position:relative;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  overflow:hidden;\n}\n.pz-thumb img{ width:100%; height:100%; object-fit:cover; }\n.pz-thumb-empty mat-icon{ font-size:28px; width:28px; height:28px; color:#6b7280; }\n\n.pz-thumb-remove{\n  position:absolute; top:4px; right:4px;\n  width:24px; height:24px; border:none; background:rgba(255,255,255,.9);\n  border-radius:4px; line-height:0; cursor:pointer;\n}\n\n/* Big dashed area */\n.pz-droparea{\n  flex:1;\n  min-height:72px;\n  border:1px dashed #cbd5e1;\n  border-radius:6px;\n  background:#fff;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  text-align:center;\n}\n.pz-uploader.drag-over .pz-droparea{\n  border-color:#3f51b5;            /* Angular Material primary */\n  background:#eef2ff;\n}\n\n.pz-prompt {\n  color: #6b7280;\n  font-weight: 400; /* make all normal by default */\n}\n.pz-prompt .pz-or{ margin:0 6px; color: #6b7280; }\n.pz-prompt a {\n  color: var(--tb-primary-500);\n  font-weight: 600;\n  text-decoration: none;   /* removes underline */\n}\n\n.pz-prompt a:hover {\n  text-decoration: none;   /* keep underline off on hover too */\n  color: var(--tb-primary-500);          /* optional: darker shade on hover */\n}\n\n\n/* Right-side action buttons */\n.pz-actions {\n  display: flex;\n  flex-direction: row;   /* side by side */\n  gap: 8px;\n}\n\n.pz-actions .mat-icon{ font-size:20px; width:20px; height:20px; }\n\n\n\n/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "const injector = widgetContext.$scope.$injector;\r\nconst attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\r\nconst customDialog = injector.get(widgetContext.servicesMap.get('customDialog'));\r\nconst actionsApi = widgetContext.actionsApi;\r\nconst imageService = (() => { try { return injector.get(widgetContext.servicesMap.get('imageService')); } catch (e) { return null; } })();\r\nconst http = (() => { try { return injector.get(widgetContext.servicesMap.get('http')); } catch (e) { return null; } })();\r\n\r\nopenPictureDialog();\r\n\r\nfunction openPictureDialog() {\r\n  try {\r\n    customDialog.customDialog(htmlTemplate, PictureDialogController).subscribe();\r\n  } catch (e) {\r\n    customDialog.customDialog(htmlTemplate, PictureDialogController).subscribe();\r\n  }\r\n}\r\n\r\n\r\nfunction isDataUrl(str) { return typeof str === 'string' && /^data:image\\//i.test(str); }\r\n\r\nfunction toAbsolute(url) {\r\n  if (!url) return url;\r\n  if (/^(?:https?:)?\\/\\//i.test(url) || url.startsWith('data:')) return url;\r\n  let base = (widgetContext.$rootScope?.ctx?.serverApiUrl) || (widgetContext.tbServer?.apiUrl) || (typeof location !== 'undefined' ? location.origin : '');\r\n  if (!base) return url;\r\n  base = base.replace(/\\/+$/, '');\r\n  if (base.toLowerCase().endsWith('/api')) base = base.slice(0, -4);\r\n  return base + '/' + url.replace(/^\\/+/, '');\r\n}\r\n\r\nfunction dataUrlToFile(dataUrl, filename) {\r\n  const [meta, b64] = (dataUrl || '').split(',');\r\n  const mime = (meta && meta.match(/:(.*?);/) || [, 'image/png'])[1];\r\n  const bin = atob(b64 || '');\r\n  const u8 = new Uint8Array(bin.length);\r\n  for (let i = 0; i < bin.length; i++) u8[i] = bin.charCodeAt(i);\r\n  return new File([u8], filename, { type: mime });\r\n}\r\n\r\nfunction tsStringLocal() {\r\n  const d = new Date(); const pad = n => String(n).padStart(2, '0');\r\n  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}-${pad(d.getHours())}-${pad(d.getMinutes())}-${pad(d.getSeconds())}`;\r\n}\r\n\r\nfunction uploadImageToGallery(dataUrl, title) {\r\n  const file = dataUrlToFile(dataUrl, (title || 'image') + '.png');\r\n  if (imageService?.uploadImage) return imageService.uploadImage(file, title);\r\n  if (!http) return widgetContext.rxjs.throwError('No imageService/http available.');\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n  formData.append('title', title || 'image');\r\n  formData.append('imageSubType', 'IMAGE');\r\n  return http.post('/api/image', formData);\r\n}\r\n\r\nfunction saveEntityAttribute(entityIdObj, key, value) {\r\n  const attrs = [{ key, value }];\r\n  return attributeService.saveEntityAttributes(entityIdObj, 'SERVER_SCOPE', attrs);\r\n}\r\n\r\nfunction PictureDialogController(instance) {\r\n  const vm = instance;\r\n  const raw = widgetContext.stateController.getStateParams();\r\n  const entityIdObj = raw?.selectedDevice?.entityId;\r\n  if (!entityIdObj || !entityIdObj.entityType) return;\r\n\r\n  vm.selectedImage = null;\r\n  vm.imageId = null;\r\n  vm.isSaving = false;\r\n  vm.isDragOver = false;\r\n\r\n  vm.editEntityFormGroup = vm.fb.group({ attributes: vm.fb.group({ image: [null] }) });\r\n\r\n  function getDeviceById(deviceId) { if (!http) return widgetContext.rxjs.throwError('No http client'); return http.get(`/api/device/${deviceId}`); }\r\n\r\n  function setPreview(url, markDirty = false) {\r\n    if (!url) return;\r\n    vm.selectedImage = toAbsolute(url);\r\n    const ctrl = vm.editEntityFormGroup.get('attributes.image');\r\n    ctrl.setValue(vm.selectedImage, { emitEvent: false });\r\n    if (markDirty) vm.editEntityFormGroup.markAsDirty();\r\n  }\r\n\r\n  vm.onFileInput = (event) => {\r\n    const file = event?.target?.files?.[0];\r\n    if (!file || !file.type.startsWith('image/')) { widgetContext.showWarnToast('Please select an image.'); return; }\r\n    const reader = new FileReader();\r\n    reader.onload = () => setPreview(reader.result, true);\r\n    reader.onerror = () => widgetContext.showWarnToast('Failed to read file.');\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  vm.onDragOver = (e) => { e.preventDefault(); e.stopPropagation(); vm.isDragOver = true; };\r\n  vm.onDragLeave = (e) => { e.preventDefault(); e.stopPropagation(); vm.isDragOver = false; };\r\n  vm.onDrop = (e) => {\r\n    e.preventDefault(); e.stopPropagation(); vm.isDragOver = false;\r\n    const file = e?.dataTransfer?.files?.[0];\r\n    if (!file || !file.type.startsWith('image/')) { widgetContext.showWarnToast('Please drop an image.'); return; }\r\n    const reader = new FileReader();\r\n    reader.onload = () => setPreview(reader.result, true);\r\n    reader.onerror = () => widgetContext.showWarnToast('Failed to read dropped file.');\r\n    reader.readAsDataURL(file);\r\n  };\r\n    \r\n    vm.clearSelected = () => {\r\n      vm.selectedImage = null;\r\n      const ctrl = vm.editEntityFormGroup.get('attributes.image');\r\n      ctrl.setValue(null, { emitEvent: false });\r\n      vm.editEntityFormGroup.markAsPristine();\r\n    };\r\n    \r\n    vm.browse = (inputEl) => {\r\n      if (inputEl && inputEl.click) inputEl.click();\r\n    };\r\n\r\n  vm.cancel = () => vm.dialogRef.close();\r\n\r\n  vm.save = () => {\r\n    const value = vm.editEntityFormGroup.get('attributes.image').value;\r\n    if (!value) { vm.dialogRef.close(); return; }\r\n    vm.isSaving = true;\r\n    const deviceId = entityIdObj.id;\r\n    const authorEmail = (widgetContext.stateController.getStateParams()?.currentUser?.email) || 'User';\r\n    widgetContext.rxjs.forkJoin([\r\n      getDeviceById(deviceId),\r\n      attributeService.getEntityAttributes(entityIdObj, 'SERVER_SCOPE', ['images'])\r\n    ]).subscribe(\r\n      ([device, attrs]) => {\r\n        const deviceName = device?.name || 'device';\r\n        const imagesAttr = attrs?.find(a => a.key === 'images');\r\n        let images = [];\r\n        if (imagesAttr) {\r\n          const v = imagesAttr.value;\r\n          if (Array.isArray(v)) images = v; else if (typeof v === 'string') { try { images = JSON.parse(v); } catch (e) {} }\r\n        }\r\n        const nextIndex = (Array.isArray(images) ? images.length : 0) + 1;\r\n        const tsNow = tsStringLocal();\r\n        const desiredName = `${deviceName}_${tsNow}_image${nextIndex}`;\r\n        const upload$ = isDataUrl(value) ? uploadImageToGallery(value, desiredName) : widgetContext.rxjs.of(null);\r\n        upload$.subscribe(\r\n          (imageInfo) => {\r\n            let finalUrl = toAbsolute(value);\r\n            let finalId = vm.imageId;\r\n            if (imageInfo) {\r\n              const id = imageInfo?.id?.id || imageInfo?.id || null;\r\n              const publicUrl = imageInfo?.publicLink ? toAbsolute(imageInfo.publicLink) : imageInfo?.publicResourceKey ? toAbsolute(`/api/images/public/${imageInfo.publicResourceKey}`) : id ? toAbsolute(`/api/image/${id}/download`) : finalUrl;\r\n              finalUrl = publicUrl;\r\n              finalId = id || finalId;\r\n              images = Array.isArray(images) ? images.slice() : [];\r\n              images.push({ name: desiredName, ts: tsNow, imageId: id, url: publicUrl, author: authorEmail });\r\n            }\r\n            const ops = [ saveEntityAttribute(entityIdObj, 'image', finalUrl) ];\r\n            if (finalId) ops.push(saveEntityAttribute(entityIdObj, 'imageId', finalId));\r\n            if (imageInfo) ops.push(saveEntityAttribute(entityIdObj, 'images', images));\r\n            widgetContext.rxjs.forkJoin(ops).subscribe(\r\n              () => { vm.isSaving = false; widgetContext.showSuccessToast('Image saved.'); vm.dialogRef.close(); },\r\n              (error) => { vm.isSaving = false; alert('Image save failed ' + JSON.stringify(error)); }\r\n            );\r\n          },\r\n          (err) => { vm.isSaving = false; widgetContext.dialogs.alert('Upload failed', JSON.stringify(err)); }\r\n        );\r\n      },\r\n      (err) => { vm.isSaving = false; widgetContext.dialogs.alert('Device fetch failed', JSON.stringify(err)); }\r\n    );\r\n  };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "db65d643-2982-187c-609d-1ccab0cb3409"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "1f966663-99b5-e88b-0a3a-d52eefabf34f"
      },
      "12302e54-bb40-6438-ac8c-cb97bf6f1d1b": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "ea91e55a-e08d-c8d7-0338-be6820020421",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature}",
                  "color": "#F44336",
                  "settings": {
                    "yAxisId": "axis16",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.48616183662960966,
                  "units": "C",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "cafb1d2f-4003-9265-70a2-22696983affc",
              "dataKeys": [
                {
                  "name": "H_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#f44336",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.13992019272617628,
                  "aggregationType": null,
                  "units": "kWh",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": null
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9967871d-c4ef-3000-886a-b13b4b3c81e6",
              "dataKeys": [
                {
                  "name": "H_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#048AD3",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.25009552047824957,
                  "aggregationType": null,
                  "units": "m",
                  "decimals": 4,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": null
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2a2e0a13-5252-affc-5a36-75a49e7e60fd",
              "dataKeys": [
                {
                  "name": "H_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#ffc107",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7277653036541712,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "50d5b14a-abc7-7116-329b-f65fe2acc5de",
              "dataKeys": [
                {
                  "name": "H_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#607d8b",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.49275852259360187,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0577bde9-3645-d0bf-050c-67c7ce0e0b63",
              "dataKeys": [
                {
                  "name": "H_S_Power",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.power}",
                  "color": "#9c27b0",
                  "settings": {
                    "yAxisId": "axis4",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.19712006585479258,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "e3303d40-3d7d-01ae-8f0e-0a46a1137943",
              "dataKeys": [
                {
                  "name": "H_S_TemperatureDifference",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-difference}",
                  "color": "#8bc34a",
                  "settings": {
                    "yAxisId": "axis16",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3378267410024579,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "cc4dc9d0-691b-13e8-67cd-f8ea38776832",
              "dataKeys": [
                {
                  "name": "H_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-flow}",
                  "color": "#3f51b5",
                  "settings": {
                    "yAxisId": "axis16",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.13115456962042948,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "f0b5835b-4f12-9f13-65c4-8104c53a4f00",
              "dataKeys": [
                {
                  "name": "H_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-return}",
                  "color": "#e91e63",
                  "settings": {
                    "yAxisId": "axis16",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4992508926195236,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8ae3ff45-8e6c-43eb-7762-700f3d5aeaec",
              "dataKeys": [
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.status-battery-level}",
                  "color": "#ffeb3b",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.25308393030734777,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8e36be62-0961-36dd-68c9-69fba66c5873",
              "dataKeys": [
                {
                  "name": "status_margin",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.status-margin}",
                  "color": "#03a9f4",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.2093323757238308,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "5742c9f4-75fa-492c-b545-79336aaa0eef",
              "dataKeys": [
                {
                  "name": "CHC_C_Energy_Cooling",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-cooling}",
                  "color": "#ff9800",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.0807389477115652,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "eb6c7f0e-6636-6dc4-f1a0-3b636fbc4978",
              "dataKeys": [
                {
                  "name": "CHC_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#673ab7",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6333270683465538,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "55f1b3cd-c6aa-6a26-0eef-5e8901626fe7",
              "dataKeys": [
                {
                  "name": "CHC_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#cddc39",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.051829902364416536,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "79cecde4-530a-07f8-f2bb-71d2153abeb4",
              "dataKeys": [
                {
                  "name": "CHC_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#009688",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6832320697378389,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "4b545559-7375-c1ec-08ad-d3a9dfd1c3f9",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureDifference",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-difference}",
                  "color": "#795548",
                  "settings": {
                    "yAxisId": "axis16",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.017753678910862658,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "73fd7085-a759-acfc-fa70-74816ef20e00",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-flow}",
                  "color": "#00bcd4",
                  "settings": {
                    "yAxisId": "axis16",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.20794732839488894,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6c714abd-5ff4-0fb6-35c9-db1d4053230c",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-return}",
                  "color": "#ff5722",
                  "settings": {
                    "yAxisId": "axis16",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.49100569450294695,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "4a85d9f6-cd03-84ef-d9c6-ad1e3b3249e2",
              "dataKeys": [
                {
                  "name": "CHC_M_Energy_Cooling",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-cooling}",
                  "color": "#9e9e9e",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.06980149136532032,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2cea00f3-86b3-24d0-8093-b3b275d7471d",
              "dataKeys": [
                {
                  "name": "CHC_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#2962ff",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9148874908463048,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "812b76c8-e734-39dc-b5c8-c70d37dfca3f",
              "dataKeys": [
                {
                  "name": "W_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#00c853",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.8854938863211448,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "508674ca-2148-03c5-8bb8-d963ec72c48a",
              "dataKeys": [
                {
                  "name": "W_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#d50000",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9269862053176361,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "56384545-c6b3-baab-c6b8-1742280937c7",
              "dataKeys": [
                {
                  "name": "G_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#ffab00",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.31694535853261063,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8d66239d-21ef-7029-01cd-1d0e1589a557",
              "dataKeys": [
                {
                  "name": "G_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#455a64",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7860224793352709,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "85607e7a-15b5-2edb-dc2f-ee4a5ab2d759",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotal",
                  "type": "timeseries",
                  "label": "Active Energy Total",
                  "color": "#aa00ff",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4201236905480922,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0dac35fa-bcdf-b785-14f0-8f5438ebd59b",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotal",
                  "type": "timeseries",
                  "label": "Active Energy Total",
                  "color": "#64dd17",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7052996262121409,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "75e0b5b7-2179-2966-615c-c6cd8ba07344",
              "dataKeys": [
                {
                  "name": "E_S_ActivePowerTotal",
                  "type": "timeseries",
                  "label": "Active Power Total",
                  "color": "#304ffe",
                  "settings": {
                    "yAxisId": "axis4",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6684355084385384,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8f083904-acc7-fdb9-39de-165e643066c1",
              "dataKeys": [
                {
                  "name": "E_S_ApparentPowerTotal",
                  "type": "timeseries",
                  "label": "Apparent Power Total",
                  "color": "#c51162",
                  "settings": {
                    "yAxisId": "axis4",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.2728754702461029,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c556bee0-e768-d158-90f0-b503e8ad5d91",
              "dataKeys": [
                {
                  "name": "E_S_Frequency",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.frequency}",
                  "color": "#ffd600",
                  "settings": {
                    "yAxisId": "axis7",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7313245935326728,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "33fefda7-5731-0cea-1c97-7209426b699d",
              "dataKeys": [
                {
                  "name": "E_S_Voltage",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.voltage}",
                  "color": "#0091ea",
                  "settings": {
                    "yAxisId": "axis12",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.24792835191232676,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6156c3f5-c22b-c8dd-c515-81d122a1f0f1",
              "dataKeys": [
                {
                  "name": "E_S_Current",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.current}",
                  "color": "#ff6d00",
                  "settings": {
                    "yAxisId": "axis13",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9707306012308264,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "371471a8-27c9-b5c1-52e1-0aa142dacf1b",
              "dataKeys": [
                {
                  "name": "E_S_ReactivePowerTotal",
                  "type": "timeseries",
                  "label": "Reactive Power Total",
                  "color": "#6200ea",
                  "settings": {
                    "yAxisId": "axis4",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7556891471855117,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "1e032db7-da62-ad49-5bf1-c3e7cbd71fc1",
              "dataKeys": [
                {
                  "name": "E_S_CurrentTotal",
                  "type": "timeseries",
                  "label": "Current Total",
                  "color": "#aeea00",
                  "settings": {
                    "yAxisId": "axis13",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7965614731046731,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9937e98e-bb40-37ea-5526-ef0f2e6d9e7a",
              "dataKeys": [
                {
                  "name": "energy",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy}",
                  "color": "#00bfa5",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.28213611368434544,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "726154e3-ffd6-07c6-53b7-6a4c0ab4283d",
              "dataKeys": [
                {
                  "name": "power",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.power}",
                  "color": "#5d4037",
                  "settings": {
                    "yAxisId": "axis4",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4952318654807426,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "e61104e4-6f4f-48e4-f382-22c2551eced5",
              "dataKeys": [
                {
                  "name": "volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#00b8d4",
                  "settings": {
                    "yAxisId": "axis2",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4855710615882496,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "67da0000-d889-afea-eba4-2f94669bc547",
              "dataKeys": [
                {
                  "name": "voltage",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.voltage}",
                  "color": "#dd2c00",
                  "settings": {
                    "yAxisId": "axis12",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.32008616042874793,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8cec3b0c-c0dd-9db4-74a3-60d03eb178c1",
              "dataKeys": [
                {
                  "name": "current",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.current}",
                  "color": "#616161",
                  "settings": {
                    "yAxisId": "axis13",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9991822030664917,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "866e38ef-ed00-8bed-bdc6-38fc0ff34a2d",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#43a047",
                  "settings": {
                    "yAxisId": "axis9",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.12625804584390432,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6c09fae4-76a8-9a1b-ac3a-eadd0348c15f",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.humidity}",
                  "color": "#43a047",
                  "settings": {
                    "yAxisId": "axis8",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.30864317690543197,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "f92d840b-43bc-15f5-45e4-2e9f460a032c",
              "dataKeys": [
                {
                  "name": "voc",
                  "type": "timeseries",
                  "label": "VOC",
                  "color": "#e53935",
                  "settings": {
                    "yAxisId": "axis10",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.0908735357552709,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "65767d0d-a596-1fc8-136a-a47b32dbcc54",
              "dataKeys": [
                {
                  "name": "o3",
                  "type": "timeseries",
                  "label": "O3",
                  "color": "#ffb300",
                  "settings": {
                    "yAxisId": "axis11",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6141597824908349,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "84474c6f-9da5-ec93-bba6-8e0cd5b8dfe5",
              "dataKeys": [
                {
                  "name": "pulse",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.pulse}",
                  "color": "#546e7a",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.05624705744525971,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "022eebf4-1668-1d9f-4295-93f99bf575e2",
              "dataKeys": [
                {
                  "name": "digital",
                  "type": "timeseries",
                  "label": "Digital",
                  "color": "#8e24aa",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7042739573310238,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "7995609f-e7dc-211d-4be2-07bdc87dc380",
              "dataKeys": [
                {
                  "name": "light",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.light}",
                  "color": "#7cb342",
                  "settings": {
                    "yAxisId": "axis15",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9615697022605537,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9e33b1be-e920-f47c-cc3e-7635e8b86eff",
              "dataKeys": [
                {
                  "name": "motion",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.motion}",
                  "color": "#3949ab",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7426863891354438,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "61ba0e6a-ec00-58ec-1d56-74855780c5a0",
              "dataKeys": [
                {
                  "name": "leakage_status",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.leakage-status}",
                  "color": "#d81b60",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9322666705720338,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2fd3d495-911c-c865-3807-4450a9623881",
              "dataKeys": [
                {
                  "name": "distance",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.distance}",
                  "color": "#fdd835",
                  "settings": {
                    "yAxisId": "axis14",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.02906815333810464,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "375b7317-e0ca-4d46-4617-cfe2a1a70f50",
              "dataKeys": [
                {
                  "name": "position",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.position}",
                  "color": "#039be5",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6248962237173421,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0d979a95-c133-6334-9dfc-78e603609f26",
              "dataKeys": [
                {
                  "name": "trapState",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.trap-state}",
                  "color": "#fb8c00",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4186218919397914,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "58a7dd30-b589-8b0f-3c0d-6ffa6bdbb44f",
              "dataKeys": [
                {
                  "name": "magnet_status",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.magnet-status}",
                  "color": "#5e35b1",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5207129053868982,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c0bbf064-c46d-f3d5-2897-bbc8b1a2eaf4",
              "dataKeys": [
                {
                  "name": "tamper_status",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.tamper-status}",
                  "color": "#c0ca33",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6816034946914522,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "1cc9e33f-68a6-372d-9dc9-7a4aee15d2be",
              "dataKeys": [
                {
                  "name": "output1",
                  "type": "timeseries",
                  "label": "Output 1",
                  "color": "#00897b",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.1662193244387642,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "f255ffff-70d7-3ddc-e075-0c76098333ca",
              "dataKeys": [
                {
                  "name": "input1",
                  "type": "timeseries",
                  "label": "Input 1",
                  "color": "#6d4c41",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7341137226292922,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "d6c85bea-72c2-9688-c25e-ab74af461bc3",
              "dataKeys": [
                {
                  "name": "rxPackets_rx_count",
                  "type": "timeseries",
                  "label": "RX Count",
                  "color": "#00acc1",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5182247263320596,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "30ac3a73-2e87-23c4-48b8-23ee95d513a4",
              "dataKeys": [
                {
                  "name": "txPackets_tx_count",
                  "type": "timeseries",
                  "label": "TX Count",
                  "color": "#f4511e",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9207514323984646,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "fc83d74f-9f91-205c-c2f3-9b721b3172c0",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_0",
                  "type": "timeseries",
                  "label": "RX Packets Per Dr 0",
                  "color": "#757575",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9023341582566583,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "1dec2f53-027c-3496-b8b0-14a03d191542",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_1",
                  "type": "timeseries",
                  "label": "RX Packets Per Dr 1",
                  "color": "#1976d2",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6293440667608755,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "65cb050e-8f02-bcb2-7931-146a57dc38cd",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_2",
                  "type": "timeseries",
                  "label": "RX Packets Per Dr 2",
                  "color": "#388e3c",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9374599047561301,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "20a26cee-70a6-74e9-6254-878e8c9524c4",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_3",
                  "type": "timeseries",
                  "label": "RX Packets Per Dr 3",
                  "color": "#d32f2f",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7077878694114809,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "957bf4b3-9318-0d14-51d5-9c9ec0ecb983",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_4",
                  "type": "timeseries",
                  "label": "RX Packets Per Dr 4",
                  "color": "#ffa000",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3624286679637967,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "55698fec-1700-4738-6db2-5ce624ac7730",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_5",
                  "type": "timeseries",
                  "label": "RX Packets Per Dr 5",
                  "color": "#455a64",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7663742517049406,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "66bab4e0-bb1c-de48-8d25-1b8f48f54c44",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_OK",
                  "type": "timeseries",
                  "label": "TX Packets Per Status OK",
                  "color": "#7b1fa2",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.12538620497839337,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6dc7ed86-ad7a-30e4-b100-d8cc2d2495aa",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_COLLISION_PACKET",
                  "type": "timeseries",
                  "label": "TX Packets Per Status COLLISION PACKET",
                  "color": "#689f38",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3147755510818112,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "175ac413-4977-8ffc-9f3f-32c9d0a32f62",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_TOO_EARLY",
                  "type": "timeseries",
                  "label": "TX Packets Per Status TOO EARLY",
                  "color": "#303f9f",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5612049098841233,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "318120fd-4355-ac8a-2df3-8c0358ef710f",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_TOO_LATE",
                  "type": "timeseries",
                  "label": "TX Packets Per Status TOO LATE",
                  "color": "#c2185b",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.24258755200644733,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "bca9a962-2cdf-5055-5288-50babb4d6ced",
              "dataKeys": [
                {
                  "name": "dewPoint",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.dewpoint}",
                  "color": "#fbc02d",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4443227947018855,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "e970c08b-d38d-646f-59e0-b3ad3e11c308",
              "dataKeys": [
                {
                  "name": "rssi",
                  "type": "timeseries",
                  "label": "RSSI",
                  "color": "#afb42b",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.8787511772840959,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "a5862eb5-ced3-7781-f986-18e0a4f3d7fd",
              "dataKeys": [
                {
                  "name": "snr",
                  "type": "timeseries",
                  "label": "SNR",
                  "color": "#afb42b",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7530285236147649,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "4a31d619-3971-a165-af51-569ddd43b5c4",
              "dataKeys": [
                {
                  "name": "E_S_PowerFactor",
                  "type": "timeseries",
                  "label": "Power Factor",
                  "color": "#512da8",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.569636389285669,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "832209eb-da83-6949-c03b-8164548e62fc",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergy_EnergyC",
                  "type": "timeseries",
                  "label": "Active Energy Consumption",
                  "color": "#afb42b",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5800214590015351,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "87d006fb-4af5-c488-e6ab-6be0459d95b4",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergy_EnergyP",
                  "type": "timeseries",
                  "label": "Active Energy Production",
                  "color": "#00796b",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4686572082264556,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "459a8a0e-4a5d-8651-ed9c-a9f247f6f61b",
              "dataKeys": [
                {
                  "name": "E_M_ReactiveEnergyTotal",
                  "type": "timeseries",
                  "label": "Reactive Energy Total",
                  "color": "#5d4037",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5450373949215545,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "d563b314-2643-dedd-4211-98c982136f74",
              "dataKeys": [
                {
                  "name": "E_S_ActivePowerTotalMax",
                  "type": "timeseries",
                  "label": "Active Power Total Max",
                  "color": "#0097a7",
                  "settings": {
                    "yAxisId": "axis4",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.500504044682871,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2b506455-4098-63d2-d122-30fa77e4b21b",
              "dataKeys": [
                {
                  "name": "E_S_CurrentL1",
                  "type": "timeseries",
                  "label": "Current L1",
                  "color": "#e64a19",
                  "settings": {
                    "yAxisId": "axis13",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.8766774915772829,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "886e1dce-a188-83c8-4d2d-6a5d84dfb944",
              "dataKeys": [
                {
                  "name": "E_S_CurrentL2",
                  "type": "timeseries",
                  "label": "Current L2",
                  "color": "#616161",
                  "settings": {
                    "yAxisId": "axis13",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.8951217287819243,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "468b606e-8884-05ba-97d6-c4366f27305d",
              "dataKeys": [
                {
                  "name": "E_S_CurrentL3",
                  "type": "timeseries",
                  "label": "Current L3",
                  "color": "#1565c0",
                  "settings": {
                    "yAxisId": "axis13",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.753351116385168,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "83710796-a086-6b8c-413f-c610c15f97c3",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotalL1",
                  "type": "timeseries",
                  "label": "Active Energy Total L1",
                  "color": "#2e7d32",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.639091121443998,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c501c9ba-6243-e6c3-4209-c0e6721f17a0",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotalL2",
                  "type": "timeseries",
                  "label": "Active Energy Total L2",
                  "color": "#c62828",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.8237188713655712,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "502ec6ce-6b66-16b0-c24f-28e743cc4bf2",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotalL3",
                  "type": "timeseries",
                  "label": "Active Energy Total L3",
                  "color": "#ff8f00",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.830956456555247,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "a3c44398-d1f9-af8d-9edc-2b432fa84323",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergy_EnergyC",
                  "type": "timeseries",
                  "label": "Active Energy Consumption",
                  "color": "#37474f",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.8406968827159617,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "bcde5be2-5c45-53a4-cf8f-c7ed4e0fb042",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergy_EnergyP",
                  "type": "timeseries",
                  "label": "Active Energy Production",
                  "color": "#6a1b9a",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5831698813038422,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "ca3c0662-8f66-15d1-f68e-077b520a695d",
              "dataKeys": [
                {
                  "name": "E_C_ReactiveEnergyTotal",
                  "type": "timeseries",
                  "label": "Reactive Energy Total",
                  "color": "#558b2f",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.919199343582364,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "09b0e568-de2e-5e11-83f9-6fc8faad88d6",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotalL1",
                  "type": "timeseries",
                  "label": "Active Energy Total L1",
                  "color": "#283593",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9146213867061491,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "5a891689-29f6-5911-c4ef-c34a64077c26",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotalL2",
                  "type": "timeseries",
                  "label": "Active Energy Total L2",
                  "color": "#ad1457",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.900998612864284,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "b08e4297-d946-1f09-2bae-19fd870cf982",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotalL3",
                  "type": "timeseries",
                  "label": "Active Energy Total L3",
                  "color": "#f9a825",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.23233024697919047,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "83a3761a-1f70-1538-f7ac-8da5d8650bf5",
              "dataKeys": [
                {
                  "name": "E_S_CurrentN",
                  "type": "timeseries",
                  "label": "Current N",
                  "color": "#0277bd",
                  "settings": {
                    "yAxisId": "axis13",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.32895930278440744,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": true,
            "hideTimezone": true,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 86400000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false,
              "advancedParams": {
                "allowedLastIntervals": [
                  86400000,
                  604800000,
                  2592000000
                ],
                "lastAggIntervalsConfig": {
                  "604800000": {
                    "defaultAggInterval": 86400000
                  },
                  "2592000000": {
                    "defaultAggInterval": 604800000
                  }
                }
              }
            },
            "history": {
              "historyType": 0,
              "interval": 86400000,
              "timewindowMs": 2592000000,
              "fixedTimewindow": {
                "startTimeMs": 1749121372010,
                "endTimeMs": 1749207772010
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              },
              "axis1": {
                "units": "kWh",
                "decimals": 3,
                "show": true,
                "label": "Energy",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis1",
                "order": 1
              },
              "axis2": {
                "units": "m",
                "decimals": 3,
                "show": true,
                "label": "Volume",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis2",
                "order": 2
              },
              "axis3": {
                "units": "m/hr",
                "decimals": 3,
                "show": true,
                "label": "Volume Flow",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis3",
                "order": 3
              },
              "axis4": {
                "units": "W",
                "decimals": 1,
                "show": true,
                "label": "Power",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis4",
                "order": 4
              },
              "axis7": {
                "units": "Hz",
                "decimals": 1,
                "show": true,
                "label": "Frequency",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis7",
                "order": 5
              },
              "axis8": {
                "units": "%",
                "decimals": 1,
                "show": true,
                "label": "Humidity",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis8",
                "order": 6
              },
              "axis9": {
                "units": "ppm",
                "decimals": 1,
                "show": true,
                "label": "CO2",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis9",
                "order": 7
              },
              "axis10": {
                "units": "ppb",
                "decimals": 1,
                "show": true,
                "label": "VOC",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis10",
                "order": 8
              },
              "axis11": {
                "units": "ppb",
                "decimals": 1,
                "show": true,
                "label": "O3",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis11",
                "order": 9
              },
              "axis12": {
                "units": "V",
                "decimals": 1,
                "show": true,
                "label": "Voltage",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis12",
                "order": 10
              },
              "axis13": {
                "units": "A",
                "decimals": 1,
                "show": true,
                "label": "Current",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis13",
                "order": 11
              },
              "axis14": {
                "units": "m",
                "decimals": 1,
                "show": true,
                "label": "Distance",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis14",
                "order": 12
              },
              "axis15": {
                "units": "lx",
                "decimals": 1,
                "show": true,
                "label": "Light",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis15",
                "order": 13
              },
              "axis16": {
                "units": "C",
                "decimals": 1,
                "show": true,
                "label": "Temperature",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis16",
                "order": 14
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "Time series chart",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "{i18n:custom.device.data.table}",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5fb38be5-ba56-ffc6-60b1-c446fa9c9c88"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7ba5fdf5-be08-5c9e-de85-a37ef8073ba0"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "No data to display",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "12302e54-bb40-6438-ac8c-cb97bf6f1d1b"
      },
      "5340f194-224a-b7aa-3606-78d59412eb65": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709567704757,
                "endTimeMs": 1709654104757
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": false,
          "backgroundColor": null,
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "entitiesTitle": "{i18n:custom.customer-table.titel}",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": false,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Entities table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b47c9356-4593-2971-f5f6-ffbccfa1c3e3",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "{i18n:custom.customer-table.name}",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.42288784682818004,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "eeProjectGuid",
                  "type": "attribute",
                  "label": "{i18n:custom.energyExpertGuid}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": false,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active !== '') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.7830527220898056,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "weatherAPIToken",
                  "type": "attribute",
                  "label": "Weather API",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.05349888764908273,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return \"true\";\n} else return \"false\";"
                },
                {
                  "name": "solarEdgeAPIToken",
                  "type": "attribute",
                  "label": "SolarEdge API",
                  "color": "#607d8b",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.3755621555560362,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return \"true\";\n} else return \"false\";"
                },
                {
                  "name": "froniusAPIToken",
                  "type": "attribute",
                  "label": "Fronius API",
                  "color": "#9c27b0",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.825358837312341,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return \"true\";\n} else return \"false\";"
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:custom.state}",
                  "color": "#9c27b0",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar bgColor;\r\nvar status;\r\nvar state = value;\r\n\r\nswitch (state) {\r\n  case 'normal':\r\n    color = '#27AE60'; // Grn\r\n    bgColor = 'rgba(39, 174, 96, 0.1)'; // Transparenter Grn\r\n    status = 'Normal';\r\n    break;\r\n  case 'critical':\r\n    color = '#FF0000'; // Rot\r\n    bgColor = 'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\r\n    status = 'Critical';\r\n    break;\r\n  case 'major':\r\n    color = '#FF8C00'; // Dunkelorange\r\n    bgColor = 'rgba(255, 140, 0, 0.1)'; // Transparenter Dunkelorange\r\n    status = 'Major';\r\n    break;\r\n  case 'minor':\r\n    color = '#FFD700'; // Dunkelgelb (Gold)\r\n    bgColor = 'rgba(255, 215, 0, 0.1)'; // Transparenter Dunkelgelb\r\n    status = 'Minor';\r\n    break;\r\n  default:\r\n    color = '#808080'; // Grau\r\n    bgColor = 'rgba(128, 128, 128, 0.1)'; // Transparenter Grau\r\n    status = 'N/A';\r\n    break;\r\n}\r\n\r\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\r\n            status + '</div>';\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.3181245783547073,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "{i18n:alarm.severity-critical}",
                  "color": "#8bc34a",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color = '#FF0000'; // Rot\nvar bgColor = 'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\n\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\n            value + '</div>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.44234654540187734,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "{i18n:alarm.severity-major}",
                  "color": "#3f51b5",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color = '#FF8C00'; // Rot\nvar bgColor = 'rgba(255, 140, 0, 0.1)'; // Transparenter Rot\n\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\n            value + '</div>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.514759868184639,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "timeseries",
                  "label": "{i18n:alarm.severity-minor}",
                  "color": "#e91e63",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color = '#FFD700'; // Rot\nvar bgColor = 'rgba(255, 215, 0, 0.1)'; // Transparenter Rot\n\nreturn '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:'+ color +';background-color:'+ bgColor +'\">' +\n            value + '</div>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.3206122670836671,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "rowClick": [
              {
                "name": "Open Customer Locations Double Click",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Locations",
                "setEntityId": true,
                "stateEntityParamName": "selectedCustomer",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "22f6f300-70b6-afd3-87fc-6386e14c056e"
              }
            ],
            "actionCellButton": [
              {
                "name": "Open Customer Locations",
                "icon": "domain",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Locations",
                "setEntityId": true,
                "stateEntityParamName": "selectedCustomer",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "de0f3476-660b-0918-b2d8-418ee39a7cf2"
              },
              {
                "name": "Open Customer Devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "All Devices",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "dd654772-1054-b0f5-d0db-dba5e029ea2e"
              },
              {
                "name": "{i18n:custom.customer-table.edit-customer.titel}",
                "icon": "edit",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.editCustomer(widgetContext,entityId);\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "8c6f10e1-81e9-c5f5-9f46-78b3574e9b5e"
              },
              {
                "name": "{i18n:custom.changeEEProjectGuid.titel}",
                "icon": "mdi:card-account-details",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeEEProjectGuid(widgetContext,entityId,entityName);\r\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "07df3fee-e649-755b-f4cc-fba4e15138d5"
              },
              {
                "name": "Resend Data",
                "icon": "schedule_send",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.resendDataEntity(widgetContext, entityId);\n\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1114cd1e-2301-9559-3b41-f18243933d2d"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.customer-table.add-customer.titel}",
                "buttonType": "icon",
                "icon": "person_add_alt_1",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.addCustomer(widgetContext);\r\n ",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c9bfa1cd-3803-e9a1-586d-cc42174ea185"
              }
            ],
            "rowDoubleClick": []
          },
          "showTitleIcon": true,
          "titleIcon": "people",
          "iconColor": null,
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "5340f194-224a-b7aa-3606-78d59412eb65"
      },
      "377431dd-e25b-469f-c259-9deea117efa9": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1749125522312,
                "endTimeMs": 1749211922312
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": true,
            "entitiesTitle": null,
            "alarmsTitle": "Alarms"
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "b47c9356-4593-2971-f5f6-ffbccfa1c3e3",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "{i18n:alarm.created-time}",
                "color": "#2196f3",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "5%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var date = new Date(value); // value = 1761126400810\r\n\r\nvar dd   = String(date.getDate()).padStart(2, '0');\r\nvar mm   = String(date.getMonth() + 1).padStart(2, '0');\r\nvar yy   = String(date.getFullYear()).slice(-2);\r\n\r\nvar hh   = String(date.getHours()).padStart(2, '0');\r\nvar min  = String(date.getMinutes()).padStart(2, '0');\r\nvar ss   = String(date.getSeconds()).padStart(2, '0');\r\n\r\nvar formatted = dd + '/' + mm + '/' + yy + '<br>' + hh + ':' + min + ':' + ss;\r\n\r\nreturn formatted;\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.021092237451093787,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "10%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.2780007688856758,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var type = alarm.type || '';\r\nvar severity = alarm.severity;\r\n\r\nvar color;\r\nvar bgColor;\r\n\r\nswitch (severity) {\r\n  case 'CRITICAL':\r\n    color = '#FF0000';\r\n    bgColor = 'rgba(255, 0, 0, 0.1)';\r\n    break;\r\n  case 'MAJOR':\r\n    color = '#FF8C00';\r\n    bgColor = 'rgba(255, 140, 0, 0.1)';\r\n    break;\r\n  case 'MINOR':\r\n    color = '#FFD700';\r\n    bgColor = 'rgba(255, 215, 0, 0.1)';\r\n    break;\r\n  default:\r\n    color = '#666666'; // fallback for unknown severities\r\n    bgColor = 'rgba(0, 0, 0, 0.05)';\r\n}\r\n\r\nreturn (\r\n  '<div class=\"typeIcon\"' +\r\n  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;' +\r\n  ' padding:4px 8px; border-radius:8px; line-height:20px;' +\r\n  ' font-size:14px; font-weight:500; letter-spacing:0.25px;' +\r\n  ' color:' + color + '; background-color:' + bgColor + ';\">' +\r\n  '<span class=\"material-icons\" style=\"font-size:20px; vertical-align:middle;\"></span>' +\r\n  type +\r\n  '</div>'\r\n);\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.7323586880398418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "hidden",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.alarm-status}",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "{i18n:alarm.assigned}",
                "color": "#9c27b0",
                "settings": {},
                "_hash": 0.5008441077416634,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": true,
          "titleIcon": "warning",
          "iconColor": null,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {
            "headerButton": [
              {
                "name": "Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "warning",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "75f33890-1b6b-11f0-be11-edd54271a72a",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b0afe3a6-4db7-4798-f1bb-1f508d441f73"
              }
            ]
          },
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "CRITICAL",
              "MAJOR",
              "MINOR"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "377431dd-e25b-469f-c259-9deea117efa9"
      },
      "ca6dac05-ea13-1264-3989-c172a8332167": {
        "typeFullFqn": "system.cards.timeseries_table",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 6.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "ea91e55a-e08d-c8d7-0338-be6820020421",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature}",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.679006059924298,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0d979a95-c133-6334-9dfc-78e603609f26",
              "dataKeys": [
                {
                  "name": "trapState",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.trap-state}",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.21394671265029697,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "cafb1d2f-4003-9265-70a2-22696983affc",
              "dataKeys": [
                {
                  "name": "H_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.1359583388862623,
                  "aggregationType": null,
                  "units": "kWh",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": null
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9967871d-c4ef-3000-886a-b13b4b3c81e6",
              "dataKeys": [
                {
                  "name": "H_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.4625210416195442,
                  "aggregationType": null,
                  "units": "m",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": null
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2a2e0a13-5252-affc-5a36-75a49e7e60fd",
              "dataKeys": [
                {
                  "name": "H_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.5846270751880948,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "50d5b14a-abc7-7116-329b-f65fe2acc5de",
              "dataKeys": [
                {
                  "name": "H_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.362255868688545,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0577bde9-3645-d0bf-050c-67c7ce0e0b63",
              "dataKeys": [
                {
                  "name": "H_S_Power",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.power}",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.20956280326917331,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "e3303d40-3d7d-01ae-8f0e-0a46a1137943",
              "dataKeys": [
                {
                  "name": "H_S_TemperatureDifference",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-difference}",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.7342210738631542,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "cc4dc9d0-691b-13e8-67cd-f8ea38776832",
              "dataKeys": [
                {
                  "name": "H_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-flow}",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.8593622280821835,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "f0b5835b-4f12-9f13-65c4-8104c53a4f00",
              "dataKeys": [
                {
                  "name": "H_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-return}",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.2051121280614432,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8ae3ff45-8e6c-43eb-7762-700f3d5aeaec",
              "dataKeys": [
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.status-battery-level}",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.5714907846837681,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8e36be62-0961-36dd-68c9-69fba66c5873",
              "dataKeys": [
                {
                  "name": "status_margin",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.status-margin}",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.8895488943668963,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "5742c9f4-75fa-492c-b545-79336aaa0eef",
              "dataKeys": [
                {
                  "name": "CHC_C_Energy_Cooling",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-cooling}",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.45590995755569197,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "eb6c7f0e-6636-6dc4-f1a0-3b636fbc4978",
              "dataKeys": [
                {
                  "name": "CHC_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.5245448453330789,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "55f1b3cd-c6aa-6a26-0eef-5e8901626fe7",
              "dataKeys": [
                {
                  "name": "CHC_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.697686467743754,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "79cecde4-530a-07f8-f2bb-71d2153abeb4",
              "dataKeys": [
                {
                  "name": "CHC_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.043736691112624126,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "4b545559-7375-c1ec-08ad-d3a9dfd1c3f9",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureDifference",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-difference}",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.7523626668517174,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "73fd7085-a759-acfc-fa70-74816ef20e00",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-flow}",
                  "color": "#ff5722",
                  "settings": {},
                  "_hash": 0.6704592182641271,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6c714abd-5ff4-0fb6-35c9-db1d4053230c",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.temperature-return}",
                  "color": "#9e9e9e",
                  "settings": {},
                  "_hash": 0.21213136431532742,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "4a85d9f6-cd03-84ef-d9c6-ad1e3b3249e2",
              "dataKeys": [
                {
                  "name": "CHC_M_Energy_Cooling",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-cooling}",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.7395017902639758,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2cea00f3-86b3-24d0-8093-b3b275d7471d",
              "dataKeys": [
                {
                  "name": "CHC_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy-heating}",
                  "color": "#00c853",
                  "settings": {},
                  "_hash": 0.41393635223238245,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "812b76c8-e734-39dc-b5c8-c70d37dfca3f",
              "dataKeys": [
                {
                  "name": "W_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#d50000",
                  "settings": {},
                  "_hash": 0.4584419117592272,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "508674ca-2148-03c5-8bb8-d963ec72c48a",
              "dataKeys": [
                {
                  "name": "W_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#ffab00",
                  "settings": {},
                  "_hash": 0.48575896388870854,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "56384545-c6b3-baab-c6b8-1742280937c7",
              "dataKeys": [
                {
                  "name": "G_M_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#455a64",
                  "settings": {},
                  "_hash": 0.6728480087720539,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8d66239d-21ef-7029-01cd-1d0e1589a557",
              "dataKeys": [
                {
                  "name": "G_C_Volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#aa00ff",
                  "settings": {},
                  "_hash": 0.15924376202470014,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "85607e7a-15b5-2edb-dc2f-ee4a5ab2d759",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotal",
                  "type": "timeseries",
                  "label": "E_C_ActiveEnergyTotal",
                  "color": "#64dd17",
                  "settings": {},
                  "_hash": 0.8114748603832649
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0dac35fa-bcdf-b785-14f0-8f5438ebd59b",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotal",
                  "type": "timeseries",
                  "label": "E_M_ActiveEnergyTotal",
                  "color": "#304ffe",
                  "settings": {},
                  "_hash": 0.7983277763860448
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "75e0b5b7-2179-2966-615c-c6cd8ba07344",
              "dataKeys": [
                {
                  "name": "E_S_ActivePowerTotal",
                  "type": "timeseries",
                  "label": "E_S_ActivePowerTotal",
                  "color": "#c51162",
                  "settings": {},
                  "_hash": 0.6436121500114915
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8f083904-acc7-fdb9-39de-165e643066c1",
              "dataKeys": [
                {
                  "name": "E_S_ApparentPowerTotal",
                  "type": "timeseries",
                  "label": "E_S_ApparentPowerTotal",
                  "color": "#ffd600",
                  "settings": {},
                  "_hash": 0.9938424694605942
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c556bee0-e768-d158-90f0-b503e8ad5d91",
              "dataKeys": [
                {
                  "name": "E_S_Frequency",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.frequency}",
                  "color": "#0091ea",
                  "settings": {},
                  "_hash": 0.1824540018686166,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "33fefda7-5731-0cea-1c97-7209426b699d",
              "dataKeys": [
                {
                  "name": "E_S_Voltage",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.voltage}",
                  "color": "#ff6d00",
                  "settings": {},
                  "_hash": 0.9901932322151031,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6156c3f5-c22b-c8dd-c515-81d122a1f0f1",
              "dataKeys": [
                {
                  "name": "E_S_Current",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.current}",
                  "color": "#6200ea",
                  "settings": {},
                  "_hash": 0.25033309416997895,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "371471a8-27c9-b5c1-52e1-0aa142dacf1b",
              "dataKeys": [
                {
                  "name": "E_S_ReactivePowerTotal",
                  "type": "timeseries",
                  "label": "E_S_ReactivePowerTotal",
                  "color": "#aeea00",
                  "settings": {},
                  "_hash": 0.7929938609840858
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "1e032db7-da62-ad49-5bf1-c3e7cbd71fc1",
              "dataKeys": [
                {
                  "name": "E_S_CurrentTotal",
                  "type": "timeseries",
                  "label": "E_S_CurrentTotal",
                  "color": "#00bfa5",
                  "settings": {},
                  "_hash": 0.8697673137711126
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9937e98e-bb40-37ea-5526-ef0f2e6d9e7a",
              "dataKeys": [
                {
                  "name": "energy",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.energy}",
                  "color": "#5d4037",
                  "settings": {},
                  "_hash": 0.6707825158733076,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "726154e3-ffd6-07c6-53b7-6a4c0ab4283d",
              "dataKeys": [
                {
                  "name": "power",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.power}",
                  "color": "#00b8d4",
                  "settings": {},
                  "_hash": 0.5374531116908089,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "e61104e4-6f4f-48e4-f382-22c2551eced5",
              "dataKeys": [
                {
                  "name": "volume",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.volume}",
                  "color": "#dd2c00",
                  "settings": {},
                  "_hash": 0.9750472944174138,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "67da0000-d889-afea-eba4-2f94669bc547",
              "dataKeys": [
                {
                  "name": "voltage",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.voltage}",
                  "color": "#616161",
                  "settings": {},
                  "_hash": 0.3021416511389666,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "8cec3b0c-c0dd-9db4-74a3-60d03eb178c1",
              "dataKeys": [
                {
                  "name": "current",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.current}",
                  "color": "#1e88e5",
                  "settings": {},
                  "_hash": 0.6780193477372212,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6c09fae4-76a8-9a1b-ac3a-eadd0348c15f",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.humidity}",
                  "color": "#e53935",
                  "settings": {},
                  "_hash": 0.3333727947541375,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "866e38ef-ed00-8bed-bdc6-38fc0ff34a2d",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "co2",
                  "color": "#ffb300",
                  "settings": {},
                  "_hash": 0.03512903337092288
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "f92d840b-43bc-15f5-45e4-2e9f460a032c",
              "dataKeys": [
                {
                  "name": "voc",
                  "type": "timeseries",
                  "label": "voc",
                  "color": "#546e7a",
                  "settings": {},
                  "_hash": 0.5802613601344325
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "65767d0d-a596-1fc8-136a-a47b32dbcc54",
              "dataKeys": [
                {
                  "name": "o3",
                  "type": "timeseries",
                  "label": "o3",
                  "color": "#8e24aa",
                  "settings": {},
                  "_hash": 0.9894677737049308
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "84474c6f-9da5-ec93-bba6-8e0cd5b8dfe5",
              "dataKeys": [
                {
                  "name": "pulse",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.pulse}",
                  "color": "#7cb342",
                  "settings": {},
                  "_hash": 0.24116570748708677,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "022eebf4-1668-1d9f-4295-93f99bf575e2",
              "dataKeys": [
                {
                  "name": "digital",
                  "type": "timeseries",
                  "label": "Digital",
                  "color": "#3949ab",
                  "settings": {},
                  "_hash": 0.34684488912698896,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "7995609f-e7dc-211d-4be2-07bdc87dc380",
              "dataKeys": [
                {
                  "name": "light",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.light}",
                  "color": "#d81b60",
                  "settings": {},
                  "_hash": 0.9815010971387785,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "9e33b1be-e920-f47c-cc3e-7635e8b86eff",
              "dataKeys": [
                {
                  "name": "motion",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.motion}",
                  "color": "#fdd835",
                  "settings": {},
                  "_hash": 0.810708879788705,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "61ba0e6a-ec00-58ec-1d56-74855780c5a0",
              "dataKeys": [
                {
                  "name": "leakage_status",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.leakage-status}",
                  "color": "#039be5",
                  "settings": {},
                  "_hash": 0.6262329189623314,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2fd3d495-911c-c865-3807-4450a9623881",
              "dataKeys": [
                {
                  "name": "distance",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.distance}",
                  "color": "#fb8c00",
                  "settings": {},
                  "_hash": 0.14235232011437626,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "375b7317-e0ca-4d46-4617-cfe2a1a70f50",
              "dataKeys": [
                {
                  "name": "position",
                  "type": "timeseries",
                  "label": "position",
                  "color": "#5e35b1",
                  "settings": {},
                  "_hash": 0.5565755339183741
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": null
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "58a7dd30-b589-8b0f-3c0d-6ffa6bdbb44f",
              "dataKeys": [
                {
                  "name": "magnet_status",
                  "type": "timeseries",
                  "label": "magnet_status",
                  "color": "#00897b",
                  "settings": {},
                  "_hash": 0.8578056564244774
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c0bbf064-c46d-f3d5-2897-bbc8b1a2eaf4",
              "dataKeys": [
                {
                  "name": "tamper_status",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.tamper-status}",
                  "color": "#6d4c41",
                  "settings": {},
                  "_hash": 0.8726474402229184,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "1cc9e33f-68a6-372d-9dc9-7a4aee15d2be",
              "dataKeys": [
                {
                  "name": "output1",
                  "type": "timeseries",
                  "label": "output1",
                  "color": "#00acc1",
                  "settings": {},
                  "_hash": 0.8504165806709632
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "f255ffff-70d7-3ddc-e075-0c76098333ca",
              "dataKeys": [
                {
                  "name": "input1",
                  "type": "timeseries",
                  "label": "input1",
                  "color": "#f4511e",
                  "settings": {},
                  "_hash": 0.7327552219466178
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "d6c85bea-72c2-9688-c25e-ab74af461bc3",
              "dataKeys": [
                {
                  "name": "rxPackets_rx_count",
                  "type": "timeseries",
                  "label": "rxPackets_rx_count",
                  "color": "#757575",
                  "settings": {},
                  "_hash": 0.33461004759334934
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "30ac3a73-2e87-23c4-48b8-23ee95d513a4",
              "dataKeys": [
                {
                  "name": "txPackets_tx_count",
                  "type": "timeseries",
                  "label": "txPackets_tx_count",
                  "color": "#1976d2",
                  "settings": {},
                  "_hash": 0.9916082030965995
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "fc83d74f-9f91-205c-c2f3-9b721b3172c0",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_0",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_0",
                  "color": "#388e3c",
                  "settings": {},
                  "_hash": 0.2485498492960827
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "1dec2f53-027c-3496-b8b0-14a03d191542",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_1",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_1",
                  "color": "#d32f2f",
                  "settings": {},
                  "_hash": 0.899276471748358
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "65cb050e-8f02-bcb2-7931-146a57dc38cd",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_2",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_2",
                  "color": "#ffa000",
                  "settings": {},
                  "_hash": 0.26327810983602207
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "20a26cee-70a6-74e9-6254-878e8c9524c4",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_3",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_3",
                  "color": "#455a64",
                  "settings": {},
                  "_hash": 0.2744942348115298
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "957bf4b3-9318-0d14-51d5-9c9ec0ecb983",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_4",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_4",
                  "color": "#7b1fa2",
                  "settings": {},
                  "_hash": 0.0438617936517951
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "55698fec-1700-4738-6db2-5ce624ac7730",
              "dataKeys": [
                {
                  "name": "rxPacketsPerDr_5",
                  "type": "timeseries",
                  "label": "rxPacketsPerDr_5",
                  "color": "#689f38",
                  "settings": {},
                  "_hash": 0.08023183849232474
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "66bab4e0-bb1c-de48-8d25-1b8f48f54c44",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_OK",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_OK",
                  "color": "#303f9f",
                  "settings": {},
                  "_hash": 0.8857975525016683
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "6dc7ed86-ad7a-30e4-b100-d8cc2d2495aa",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_COLLISION_PACKET",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_COLLISION_PACKET",
                  "color": "#c2185b",
                  "settings": {},
                  "_hash": 0.6503059356377969
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "175ac413-4977-8ffc-9f3f-32c9d0a32f62",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_TOO_EARLY",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_TOO_EARLY",
                  "color": "#fbc02d",
                  "settings": {},
                  "_hash": 0.09658140276085814
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "318120fd-4355-ac8a-2df3-8c0358ef710f",
              "dataKeys": [
                {
                  "name": "txPacketsPerStatus_TOO_LATE",
                  "type": "timeseries",
                  "label": "txPacketsPerStatus_TOO_LATE",
                  "color": "#0288d1",
                  "settings": {},
                  "_hash": 0.5588921140759591
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "bca9a962-2cdf-5055-5288-50babb4d6ced",
              "dataKeys": [
                {
                  "name": "dewPoint",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.dewpoint}",
                  "color": "#f57c00",
                  "settings": {},
                  "_hash": 0.9481689562900643,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "832209eb-da83-6949-c03b-8164548e62fc",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergy_EnergyC",
                  "type": "timeseries",
                  "label": "Active Energy Consumption",
                  "color": "#0288d1",
                  "settings": {},
                  "_hash": 0.08349767900593352,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "a3c44398-d1f9-af8d-9edc-2b432fa84323",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergy_EnergyC",
                  "type": "timeseries",
                  "label": "Active Energy Consumption",
                  "color": "#f57c00",
                  "settings": {},
                  "_hash": 0.22219523747958259,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "87d006fb-4af5-c488-e6ab-6be0459d95b4",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergy_EnergyP",
                  "type": "timeseries",
                  "label": "Active Energy Production",
                  "color": "#512da8",
                  "settings": {},
                  "_hash": 0.4342555521975815,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "bcde5be2-5c45-53a4-cf8f-c7ed4e0fb042",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergy_EnergyP",
                  "type": "timeseries",
                  "label": "Active Energy Production",
                  "color": "#afb42b",
                  "settings": {},
                  "_hash": 0.5425173300319525,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "459a8a0e-4a5d-8651-ed9c-a9f247f6f61b",
              "dataKeys": [
                {
                  "name": "E_M_ReactiveEnergyTotal",
                  "type": "timeseries",
                  "label": "Reactive Energy Total",
                  "color": "#00796b",
                  "settings": {},
                  "_hash": 0.5263081360270115,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "ca3c0662-8f66-15d1-f68e-077b520a695d",
              "dataKeys": [
                {
                  "name": "E_C_ReactiveEnergyTotal",
                  "type": "timeseries",
                  "label": "Reactive Energy Total",
                  "color": "#5d4037",
                  "settings": {},
                  "_hash": 0.9005717687112914,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "d563b314-2643-dedd-4211-98c982136f74",
              "dataKeys": [
                {
                  "name": "E_S_ActivePowerTotalMax",
                  "type": "timeseries",
                  "label": "Active Power Total Max",
                  "color": "#0097a7",
                  "settings": {},
                  "_hash": 0.35981570069075597,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "2b506455-4098-63d2-d122-30fa77e4b21b",
              "dataKeys": [
                {
                  "name": "E_S_CurrentL1",
                  "type": "timeseries",
                  "label": "Current L1",
                  "color": "#e64a19",
                  "settings": {},
                  "_hash": 0.6174829075402599,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "886e1dce-a188-83c8-4d2d-6a5d84dfb944",
              "dataKeys": [
                {
                  "name": "E_S_CurrentL2",
                  "type": "timeseries",
                  "label": "Current L2",
                  "color": "#616161",
                  "settings": {},
                  "_hash": 0.9909298641474634,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "468b606e-8884-05ba-97d6-c4366f27305d",
              "dataKeys": [
                {
                  "name": "E_S_CurrentL3",
                  "type": "timeseries",
                  "label": "Current L3",
                  "color": "#1565c0",
                  "settings": {},
                  "_hash": 0.4391787653477838,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "83a3761a-1f70-1538-f7ac-8da5d8650bf5",
              "dataKeys": [
                {
                  "name": "E_S_CurrentN",
                  "type": "timeseries",
                  "label": "Current N",
                  "color": "#2e7d32",
                  "settings": {},
                  "_hash": 0.40719673945415313,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "83710796-a086-6b8c-413f-c610c15f97c3",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotalL1",
                  "type": "timeseries",
                  "label": "Active Energy Total L1",
                  "color": "#c62828",
                  "settings": {},
                  "_hash": 0.6575430531786883,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "09b0e568-de2e-5e11-83f9-6fc8faad88d6",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotalL1",
                  "type": "timeseries",
                  "label": "Active Energy Total L1",
                  "color": "#ff8f00",
                  "settings": {},
                  "_hash": 0.3559640151711133,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c501c9ba-6243-e6c3-4209-c0e6721f17a0",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotalL2",
                  "type": "timeseries",
                  "label": "Active Energy Total L2",
                  "color": "#37474f",
                  "settings": {},
                  "_hash": 0.6320988629378653,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "5a891689-29f6-5911-c4ef-c34a64077c26",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotalL2",
                  "type": "timeseries",
                  "label": "Active Energy Total L2",
                  "color": "#558b2f",
                  "settings": {},
                  "_hash": 0.24907353827389955,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "502ec6ce-6b66-16b0-c24f-28e743cc4bf2",
              "dataKeys": [
                {
                  "name": "E_M_ActiveEnergyTotalL3",
                  "type": "timeseries",
                  "label": "Active Energy Total L3",
                  "color": "#558b2f",
                  "settings": {},
                  "_hash": 0.10528506308215213,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "502ec6ce-6b66-16b0-c24f-28e743cc4bf2",
              "dataKeys": [
                {
                  "name": "E_C_ActiveEnergyTotalL3",
                  "type": "timeseries",
                  "label": "Active Energy Total L3",
                  "color": "#283593",
                  "settings": {},
                  "_hash": 0.5410145665876995,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1749639450158,
                "endTimeMs": 1749725850158
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 7980
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "enableSearch": false,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "showTimestamp": true,
            "dateFormat": {
              "format": "yyyy-MM-dd HH:mm:ss"
            },
            "timestampExportOption": "onlyVisible",
            "displayPagination": false,
            "useEntityLabel": false,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 5,
            "hideEmptyLines": false,
            "disableStickyHeader": false,
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Timeseries table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "actionCellButton": [
              {
                "name": "{i18n:custom.device.data.delete-timeseries}",
                "icon": "remove_circle_outline",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "/*let params = widgetContext.stateController.getStateParams();\nlet userRole = params.currentUser.userRole;\n\nif (userRole === 'Administrator' || userRole === 'Administrator' || userRole === '') {\n    return true;\n} else {\n    return false;\n}*/\nreturn true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.deleteMultipleTimeseries(widgetContext,additionalParams);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "171a90a6-570b-b2e2-ce53-a6952f70e342"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.device.data.chart}",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "show_chart",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Live\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc97\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5c42f5f6-580a-c64f-5abc-63a679c5ba6f"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5a45cb4c-3c84-362e-9080-cadcf21ca5cd"
              }
            ]
          },
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "displayTimewindow": true,
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "titleIcon": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "ca6dac05-ea13-1264-3989-c172a8332167"
      },
      "2017ae6d-c56c-720a-d4fa-afc09444f26e": {
        "typeFullFqn": "system.state_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0d979a95-c133-6334-9dfc-78e603609f26",
              "dataKeys": [
                {
                  "name": "trapState",
                  "type": "timeseries",
                  "label": "Trap State",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6404735551948322,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "1cc9e33f-68a6-372d-9dc9-7a4aee15d2be",
              "dataKeys": [
                {
                  "name": "output1",
                  "type": "timeseries",
                  "label": "Output 1",
                  "color": "#4caf50",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7844027101257419,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "f255ffff-70d7-3ddc-e075-0c76098333ca",
              "dataKeys": [
                {
                  "name": "input1",
                  "type": "timeseries",
                  "label": "Input 1",
                  "color": "#f44336",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3440724481597487,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "61ba0e6a-ec00-58ec-1d56-74855780c5a0",
              "dataKeys": [
                {
                  "name": "leakage_status",
                  "type": "timeseries",
                  "label": "Leakage Status",
                  "color": "#ffc107",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.7409385147934732,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c0bbf064-c46d-f3d5-2897-bbc8b1a2eaf4",
              "dataKeys": [
                {
                  "name": "tamper_status",
                  "type": "timeseries",
                  "label": "Tamper Status",
                  "color": "#607d8b",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5638222069479716,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "58a7dd30-b589-8b0f-3c0d-6ffa6bdbb44f",
              "dataKeys": [
                {
                  "name": "magnet_status",
                  "type": "timeseries",
                  "label": "Magnet Status",
                  "color": "#9c27b0",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.12953113649874237,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "375b7317-e0ca-4d46-4617-cfe2a1a70f50",
              "dataKeys": [
                {
                  "name": "position",
                  "type": "timeseries",
                  "label": "Position",
                  "color": "#8bc34a",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6505206788535637,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "eccbdbe2-46ce-8075-a04d-a2ac165e5b88",
              "dataKeys": [
                {
                  "name": "operatingStatus",
                  "type": "timeseries",
                  "label": "Operating Status",
                  "color": "#3f51b5",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4092167395544293,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": "",
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "interval": null,
                "splitNumber": null,
                "min": null,
                "max": null,
                "ticksGenerator": ""
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "position": "left",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": "",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {
                "millisecond": "MMM dd yyyy HH:mm:ss"
              }
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px",
            "states": [
              {
                "label": "Normal",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": "normal"
              },
              {
                "label": "Trapped",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": "trapped"
              },
              {
                "label": "Failed",
                "value": 2,
                "sourceType": "constant",
                "sourceValue": "failed"
              },
              {
                "label": "Open",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": "open"
              },
              {
                "label": "Close",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": "close"
              },
              {
                "label": "0",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": 0
              },
              {
                "label": "1",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": 1
              }
            ]
          },
          "title": "State chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "mobileHeight": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "Table",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "610a7eea-9d86-870d-9905-fc243ea3a20b"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f730845c-fc9c-6b75-5710-49401cdc7124"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "2017ae6d-c56c-720a-d4fa-afc09444f26e"
      },
      "7d7cf959-25a9-a557-0b5f-60530f21ae47": {
        "typeFullFqn": "system.state_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "58a7dd30-b589-8b0f-3c0d-6ffa6bdbb44f",
              "dataKeys": [
                {
                  "name": "magnet_status",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.magnet-status}",
                  "color": "#9c27b0",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.12953113649874237,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": "",
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "interval": null,
                "splitNumber": null,
                "min": null,
                "max": null,
                "ticksGenerator": ""
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "left",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": "",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {
                "millisecond": "MMM dd yyyy HH:mm:ss"
              }
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px",
            "states": [
              {
                "label": "Open",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": "{i18n:custom.device.data.open}"
              },
              {
                "label": "Close",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": "{i18n:custom.device.data.close}"
              }
            ]
          },
          "title": "State chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "mobileHeight": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "Table",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fd37a552-7cc3-e67a-ca7b-ac9a45b7a987"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c6ecdfd1-396a-72bc-8f4a-41d28100ecf6"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "7d7cf959-25a9-a557-0b5f-60530f21ae47"
      },
      "6c036989-6331-91b7-e5f4-68d52a3f98e2": {
        "typeFullFqn": "system.state_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "eccbdbe2-46ce-8075-a04d-a2ac165e5b88",
              "dataKeys": [
                {
                  "name": "operatingStatus",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.operating-status}",
                  "color": "#3f51b5",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.4092167395544293,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": "",
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "interval": null,
                "splitNumber": null,
                "min": null,
                "max": null,
                "ticksGenerator": ""
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "position": "left",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": "",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {
                "millisecond": "MMM dd yyyy HH:mm:ss"
              }
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px",
            "states": [
              {
                "label": "0",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": 0
              },
              {
                "label": "1",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": 1
              }
            ]
          },
          "title": "State chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "mobileHeight": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "Table",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "626ca054-c227-74c4-846e-662572ee1ea4"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2b02c07b-e1f2-6b82-7cf3-a3a3f8f68efa"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "6c036989-6331-91b7-e5f4-68d52a3f98e2"
      },
      "f16b624c-d898-07a0-76a3-748cd985a72f": {
        "typeFullFqn": "system.state_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "output1",
                  "type": "timeseries",
                  "label": "Output 1",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9478335815697972,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": "",
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "interval": null,
                "splitNumber": null,
                "min": null,
                "max": null,
                "ticksGenerator": ""
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "left",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": "",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {
                "millisecond": "MMM dd yyyy HH:mm:ss"
              }
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px",
            "states": [
              {
                "label": "Open",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": 0
              },
              {
                "label": "Closed",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": 1
              }
            ]
          },
          "title": "State chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "mobileHeight": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "Table",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "dc8b9b86-fd8a-7ba1-262a-ac3320edfbee"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "34d77e8f-54a4-ce03-8b47-913f16b309b2"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "f16b624c-d898-07a0-76a3-748cd985a72f"
      },
      "3f106d48-fec3-51c2-886b-d934a76dbbe7": {
        "typeFullFqn": "system.state_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "375b7317-e0ca-4d46-4617-cfe2a1a70f50",
              "dataKeys": [
                {
                  "name": "position",
                  "type": "timeseries",
                  "label": "Position",
                  "color": "#8bc34a",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6505206788535637,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": "",
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "interval": null,
                "splitNumber": null,
                "min": null,
                "max": null,
                "ticksGenerator": ""
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "left",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": "",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {
                "millisecond": "MMM dd yyyy HH:mm:ss"
              }
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px",
            "states": [
              {
                "label": "Normal",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": "normal"
              },
              {
                "label": "{i18n:custom.device.data.trapped}",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": "trapped"
              },
              {
                "label": "{i18n:custom.device.data.failed}",
                "value": 2,
                "sourceType": "constant",
                "sourceValue": "failed"
              },
              {
                "label": "{i18n:custom.device.data.open}",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": "open"
              },
              {
                "label": "{i18n:custom.device.data.close}",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": "close"
              },
              {
                "label": "0",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": 0
              },
              {
                "label": "1",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": 1
              }
            ]
          },
          "title": "State chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "mobileHeight": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "Table",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "82d00bf6-631d-de0b-564a-1c6b710b0783"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f944e16f-2fdb-2768-e31d-844885ceed4c"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "3f106d48-fec3-51c2-886b-d934a76dbbe7"
      },
      "4767060e-eda8-0ab2-443e-c4fb99edbda8": {
        "typeFullFqn": "system.state_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "c0bbf064-c46d-f3d5-2897-bbc8b1a2eaf4",
              "dataKeys": [
                {
                  "name": "tamper_status",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.tamper-status}",
                  "color": "#607d8b",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5638222069479716,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": "",
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "interval": null,
                "splitNumber": null,
                "min": null,
                "max": null,
                "ticksGenerator": ""
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "left",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": "",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {
                "millisecond": "MMM dd yyyy HH:mm:ss"
              }
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px",
            "states": [
              {
                "label": "{i18n:custom.device.data.installed}",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": "installed"
              },
              {
                "label": "{i18n:custom.device.data.deinstalled}",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": "uninstalled"
              }
            ]
          },
          "title": "State chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "mobileHeight": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "Table",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "51a33ac1-43a4-e72c-68c2-b0494048e9c6"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "96c30f66-25fc-b2f5-6803-16acb8e21d0f"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "4767060e-eda8-0ab2-443e-c4fb99edbda8"
      },
      "35af56ba-0d6b-16a3-d2c4-c3806183f826": {
        "typeFullFqn": "system.state_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "filterId": "0d979a95-c133-6334-9dfc-78e603609f26",
              "dataKeys": [
                {
                  "name": "trapState",
                  "type": "timeseries",
                  "label": "{i18n:custom.device.data.trap-state}",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": true,
                      "stepType": "end",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "circle",
                      "pointSize": 12,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6404735551948322,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 1,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": "",
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "interval": null,
                "splitNumber": null,
                "min": null,
                "max": null,
                "ticksGenerator": ""
              }
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "position": "top",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false,
              "showLatest": false
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": "",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {
                "millisecond": "MMM dd yyyy HH:mm:ss"
              }
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px",
            "states": [
              {
                "label": "Normal",
                "value": 0,
                "sourceType": "constant",
                "sourceValue": "normal"
              },
              {
                "label": "{i18n:custom.device.data.trapped}",
                "value": 1,
                "sourceType": "constant",
                "sourceValue": "trapped"
              },
              {
                "label": "{i18n:custom.device.data.failed}",
                "value": 2,
                "sourceType": "constant",
                "sourceValue": "failed"
              }
            ]
          },
          "title": "State chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "mobileHeight": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": [
              {
                "name": "Table",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "mdi:file-table-outline",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {
                  "border-radius": "9999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"Raw\";\nlet params = widgetContext.stateController.getStateParams();\nparams['chartMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6ccc96\"\n    },\n    entityName: mode,\n    entityLabel:mode\n};\nparams['targetEntityParamName'] = \"chartMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "34a4fbe9-bf2f-ec29-ef86-f33ea8015615"
              },
              {
                "name": "Data Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "more_horiz",
                "buttonColor": "#ffffff",
                "buttonFillColor": "#F44336",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "/*let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('Device Data Dashboard', params);*/\n\n\n(async function runCustomAction() {\n  const injector         = widgetContext.$scope.$injector;\n  const attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\n  const deviceService    = injector.get(widgetContext.servicesMap.get('deviceService'));\n  const stateController  = widgetContext.stateController;\n  const params           = stateController.getStateParams();\n  const deviceIdObj      = params.selectedDevice.entityId;\n  \n  //console.log(\"sel dev\", params.selectedDevice);\n  //console.log(\"sel dev id\", params.selectedDevice.entityId);\n  \n  try {\n    const device = await new Promise((resolve, reject) => {\n      deviceService.getDevice(deviceIdObj.id).subscribe(resolve, reject);\n    });\n\n    const deviceProfileId = device.deviceProfileId.id;\n    //console.log('deviceProfileId', deviceProfileId);\n\n    const assetId = {\n      id: '3410d9e0-7e6d-11f0-aa11-9f4ae9766ac3',\n      entityType: 'ASSET'\n    };\n\n    const attrs = await new Promise((resolve, reject) => {\n      attributeService\n        .getEntityAttributes(assetId, 'SERVER_SCOPE', [String(deviceProfileId)])\n        .subscribe(resolve, reject);\n    });\n\n    //console.log('attrs', attrs);\n\n    let dashboard;\n    if (attrs && attrs.length && attrs[0].value) {\n      dashboard = JSON.parse(attrs[0].value).General.dashboard;\n      //console.log('dashboard:', dashboard);\n    }\n\n    const { mainDatapoint, datapointDefinitions } =\n      await utils.getDeviceProfileDescription(widgetContext, deviceIdObj.id);\n\n    await new Promise((resolve, reject) => {\n      attributeService\n        .saveEntityAttributes(deviceIdObj, 'SERVER_SCOPE', [\n          { key: 'selectedDatapoint', value: mainDatapoint }\n        ])\n        .subscribe(resolve, reject);\n    });\n\n    const formattedDatapoints = await utils.getLatestTimeseriesInfos(\n      widgetContext,\n      params.selectedDevice?.entityId || deviceIdObj,\n      datapointDefinitions\n    );\n\n    const filteredDatapoints = Object.fromEntries(\n      Object.entries(formattedDatapoints).filter(\n        ([key]) => key !== 'calc_fCntLoss' && key !== 'fCnt'\n      )\n    );\n\n    const selectedDevice = {\n      entityId: {\n        id: entityId.id,\n        entityType: entityId.entityType\n      },\n      entityName: entityName,\n      entityLabel: entityLabel\n    };\n\n    const newParams = {\n      ...params,\n      selectedDevice,\n      datapoints: filteredDatapoints,\n      mainDatapoint,\n      dashboard,\n      dataMode: {\n        entityId: {\n          entityType: 'DEVICE',\n          id: deviceIdObj.id\n        },\n        entityName: 'charts',\n        entityLabel: 'charts',\n        dashboard: dashboard\n      },\n      targetEntityParamName: 'dataMode'\n    };\n\n    stateController.openState('Device Data Dashboard', newParams);\n\n    //console.log('Opening data_dashboard with device:', selectedDevice);\n    //console.log('dp', newParams.datapoints);\n  } catch (error) {\n    console.error('Custom action failed:', error);\n  }\n})();\n",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f821a45b-403e-7261-d88a-b95fc0200cdc"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "35af56ba-0d6b-16a3-d2c4-c3806183f826"
      },
      "a4d91f69-6265-d266-eff2-cac617dfad96": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8127492370282982
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.34111965517376475
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "meterType",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.38704245708372653
                },
                {
                  "name": "vpnIp",
                  "type": "attribute",
                  "label": "vpnIp",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.658820120126539
                },
                {
                  "name": "sim",
                  "type": "attribute",
                  "label": "sim",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.6566570034502475
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "e8f543a9-82ff-0b69-d012-8349ea363657",
              "dataKeys": [
                {
                  "name": "sim_status",
                  "type": "attribute",
                  "label": "sim_status",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.22615414037590287
                },
                {
                  "name": "sim_provider",
                  "type": "attribute",
                  "label": "sim_provider",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.026958123535025247
                },
                {
                  "name": "sim_ip",
                  "type": "attribute",
                  "label": "sim_ip",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.7429134255144881
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "374fa6d5-8e45-0054-78db-fcfc1b0b033e",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#E0E0E0",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var params = (ctx && ctx.stateController) ? ctx.stateController.getStateParams() : {};\r\nvar selectedCustomer = (params && params.selectedCustomer) || {};\r\nvar selectedDevice   = (params && params.selectedDevice) || {};\r\nvar selectedLocation = (params && params.selectedLocation) || {};\r\n\r\nvar customer   = selectedCustomer.entityName || 'Unknown customer';\r\nvar device     = selectedDevice.entityName   || 'Unknown device';\r\nvar location   = selectedLocation.entityName || 'Unknown location';\r\nvar datapoints = params?.datapoints; // <-- will be forwarded to the iframe\r\n\r\nvar d = (Array.isArray(data) && data[0]) ? data[0] : {};\r\nvar s = (Array.isArray(data) && data[1]) ? data[1] : {};\r\n\r\nvar name  = d['Name']  || 'unknown';\r\nvar label = d['Label'] || 'N/A';\r\n\r\nlet meterType = d.meterType ?? 'N/A';\r\nlet vpnIp     = d.vpnIp ?? 'N/A';\r\n\r\nlet simIp = s.simIp ?? s.sim_ip ?? 'N/A';\r\nlet simStatus = s.simStatus ?? 'N/A';\r\nconst _simStatusObj = (() => {\r\n  try { return s.sim_status ? JSON.parse(s.sim_status) : null; } catch { return null; }\r\n})();\r\nconst simStatusIdRaw = _simStatusObj?.id ?? simStatus;\r\nconst simStatusId = Number(simStatusIdRaw);\r\nconst simCarrierLabel = (() => {\r\n  try { return s.sim_provider ? (JSON.parse(s.sim_provider).label ?? 'N/A') : 'N/A'; }\r\n  catch { return 'N/A'; }\r\n})();\r\nconst simOnline = simIp && simIp !== 'N/A';\r\nconst displaySim = (() => {\r\n  try {\r\n    const sim = d.sim ? JSON.parse(d.sim) : null;\r\n    const iccid = sim?.iccid;\r\n    if (iccid == null) return false;\r\n    const str = String(iccid).trim().toLowerCase();\r\n    return str && str !== 'n/a' && str !== 'null' && str !== 'undefined';\r\n  } catch { return false; }\r\n})();\r\n\r\nconst getCss = (name, fallback) =>\r\n  getComputedStyle(document.documentElement).getPropertyValue(name)?.trim() || fallback;\r\nconst colorPrimary   = getCss('--tb-primary-500', '#0094d0');\r\nconst colorSecondary = getCss('--tb-accent-500',  '#4caf50');\r\nconst colorError     = 'red';\r\nconst colorGrey      = 'gray';\r\n\r\nlet simStatusColor = simStatusId === 2\r\n  ? (simOnline ? colorSecondary : colorGrey)\r\n  : (simStatusId == 5 ? colorError : colorPrimary);\r\n  \r\nlet mode = (params?.dataMode?.entityName) || 'charts';\r\n\r\nconst dashboardStateId = params?.dashboard;\r\n\r\nlet stateId;\r\nif (dashboardStateId && typeof dashboardStateId === 'string' && mode === 'charts') {\r\n  stateId = dashboardStateId;\r\n} else {\r\n  stateId = (mode === 'table')\r\n    ? 'Data Table Card'\r\n    : 'Data Charts Card';\r\n}\r\n\r\nlet stateHtml = [\r\n  {\r\n    id: stateId,\r\n    params: {\r\n      selectedDevice: selectedDevice\r\n    }\r\n  }\r\n];\r\n\r\n//console.log(\"stateht:\", stateHtml);\r\n\r\nvar vm = this;\r\nvm.mode = mode;\r\n\r\nvm.updateMode = function(newMode) {\r\n  const p = vm.ctx.stateController.getStateParams() || {};\r\n  p.dataMode = { entityName: newMode };\r\n  vm.mode = newMode;\r\n  vm.ctx.stateController.updateState(null, p);\r\n  const iframe = document.getElementById(iframeId);\r\n  if (iframe) postEmbedContextToIframe(iframe, vm.ctx.stateController.getStateParams());\r\n};\r\n\r\nlet changeModeButtonHtml = '';\r\nif (mode === 'charts') {\r\n  changeModeButtonHtml = '<button id=\"table-button\" type=\"button\" class=\"header-btn purple-btn\" matTooltip=\"View Table\">' +\r\n    '<mat-icon class=\"tb-mat-18 mr-1\">list</mat-icon><span>Table</span>' +\r\n  '</button>';\r\n} else if (mode === 'table') {\r\n  changeModeButtonHtml = '<button id=\"charts-button\" type=\"button\" class=\"header-btn purple-btn\" matTooltip=\"View Charts\">' +\r\n    '<mat-icon class=\"tb-mat-18 mr-1\">bar_chart</mat-icon><span>Charts</span>' +\r\n  '</button>';\r\n}\r\n\r\n\r\nconst headerHtml =\r\n  '<div class=\"header\">' +\r\n    '<div class=\"header-left\">' +\r\n      '<button id=\"back-button\" class=\"header-btn gray-btn round-btn\" type=\"button\" matTooltip=\"Back\">' +\r\n        '<mat-icon class=\"tb-mat-18\">arrow_back</mat-icon>' +\r\n      '</button>' +\r\n      '<div class=\"title\">' + customer + '  ' + location + '  ' + device + '</div>' +\r\n    '</div>' +\r\n    '<div class=\"header-right\">' +\r\n        changeModeButtonHtml +\r\n      '<button id=\"device-button\" type=\"button\" class=\"header-btn accent-btn\" matTooltip=\"Device\">' +\r\n        '<mat-icon class=\"tb-mat-18 mr-1\">devices</mat-icon><span>Device</span>' +\r\n      '</button>' +\r\n\r\n      ((meterType === \"Gateway\" && vpnIp !== 'N/A') ?\r\n        ('<a id=\"webserver-button\" ' +\r\n           'class=\"header-btn purple-btn header-btn-link\" ' +\r\n           'href=\"http://' + vpnIp + '\" target=\"_blank\" rel=\"noopener\" ' +\r\n           'matTooltip=\"Web Server\">' +\r\n             '<mat-icon class=\"tb-mat-18 mr-1\">language</mat-icon>' +\r\n             '<span>Web Server</span>' +\r\n         '</a>') : '') +\r\n\r\n      (displaySim ?\r\n        ('<button id=\"sim-menu\" data-action=\"sim-menu\" type=\"button\" class=\"header-btn\" matTooltip=\"SIM Menu\" style=\"background-color:' + simStatusColor + ';color:#fff\">' +\r\n          '<mat-icon class=\"tb-mat-18\">sim_card</mat-icon><span>SIM Card</span>' +\r\n        '</button>') : '') +\r\n\r\n      '<div class=\"service-item\" matTooltip=\"Service\">' +\r\n        '<tb-dashboard-state style=\"width:100px;border-radius:12px;overflow:hidden;\" ' +\r\n          '[ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Service Attribute\">' +\r\n        '</tb-dashboard-state>' +\r\n      '</div>' +\r\n\r\n    '</div>' +\r\n  '</div>';\r\n\r\nconst targetDashboardId = 'c75426e0-af54-11f0-a397-f7986a67a112';\r\nconst targetDashboardUrl =\r\n  window.location.origin + '/dashboards/' + targetDashboardId;\r\n\r\nconst cropTop = 65; // pixels to crop from top\r\n\r\nconst viewportStyle =\r\n  'position:relative;overflow:hidden;border-radius:12px;min-height:200px;height:100%;width:100%;';\r\n\r\nconst iframeStyle =\r\n  'position:absolute;top:0;left:0;border:0;' +\r\n  'width:calc(100% + 0px);' +\r\n  'height:calc(100% + ' + cropTop + 'px);' +\r\n  'transform:translateY(-' + cropTop + 'px);' +\r\n  'transform-origin: top left;' +\r\n  'display:block;';\r\n\r\nconst iframeId = 'tb-embed-iframe-' + targetDashboardId;\r\nconst stateConverted = \"?state=\" + jsonToBase64(stateHtml);\r\nconst iframeHtml =\r\n  '<iframe id=\"' + iframeId + '\" ' +\r\n    'src=\"' + targetDashboardUrl + stateConverted + '\" ' +\r\n    'style=\"' + iframeStyle + '\" ' +\r\n    'loading=\"lazy\" referrerpolicy=\"no-referrer-when-downgrade\" allowfullscreen>' +\r\n  '</iframe>';\r\n\r\nvar layoutHtml =\r\n  '<div class=\"main-layout flex flex-col w-full h-full\">' +\r\n    headerHtml +\r\n    '<div class=\"flex-1\" style=\"min-height:0;\">' +\r\n      '<div class=\"iframe-viewport\" style=\"' + viewportStyle + '\">' +\r\n        iframeHtml +\r\n      '</div>' +\r\n    '</div>' +\r\n  '</div>';\r\n\r\n\r\nfunction toDatapointArray(dpMap) {\r\n  if (!dpMap || typeof dpMap !== 'object') return [];\r\n  return Object.entries(dpMap).map(([key, raw]) => ({\r\n    key,\r\n    value: raw?.value ?? null,\r\n    displayName: raw?.displayName ?? null,\r\n    unit: raw?.unit ?? null,\r\n    ts: raw?.ts ?? null,\r\n    aggregation: raw?.aggregation ?? null,\r\n    stateChart: raw?.stateChart ?? null\r\n  }));\r\n}\r\n\r\nfunction buildDatapointsMessage(dpMap) {\r\n  return {\r\n    type: 'TB_DATAPOINTS',\r\n    version: 1,\r\n    from: 'parent-dashboard',\r\n    datapoints: toDatapointArray(dpMap)\r\n  };\r\n}\r\n\r\nfunction postDatapointsToIframe(iframeEl, dpMap) {\r\n  if (!iframeEl?.contentWindow) return;\r\n  const payload = buildDatapointsMessage(dpMap);\r\n  iframeEl.contentWindow.postMessage(payload, window.location.origin);\r\n}\r\n\r\n\r\nsetTimeout(() => {\r\n  const iframe = document.getElementById(iframeId);\r\n  if (!iframe) return;\r\n\r\n  const sendNow = () => postDatapointsToIframe(iframe, datapoints);\r\n\r\n  iframe.addEventListener('load', () => {\r\n    try {\r\n      const doc = iframe.contentDocument || iframe.contentWindow.document;\r\n      const styleEl = doc.createElement('style');\r\n      styleEl.type = 'text/css';\r\n      styleEl.appendChild(doc.createTextNode(`\r\n        .tb-dashboard-toolbar { display:none !important; }\r\n        .mat-drawer.mat-drawer-side, [tb-main-menu] { display:none !important; }\r\n        .mat-drawer-content, .tb-content, .tb-dashboard-content { margin-left:0 !important; }\r\n      `));\r\n      doc.head.appendChild(styleEl);\r\n    } catch (e) {\r\n      console.warn('Cannot inject CSS into iframe (likely cross-origin):', e);\r\n    }\r\n\r\n    sendNow();\r\n\r\n    let tries = 0;\r\n    const t = setInterval(() => {\r\n      tries++;\r\n      postDatapointsToIframe(iframe, datapoints);\r\n      if (tries >= 10) clearInterval(t);\r\n    }, 1000);\r\n  });\r\n\r\n  window.addEventListener('message', (evt) => {\r\n    if (evt.origin !== window.location.origin) return;\r\n    const data = evt.data || {};\r\n    if (data.type === 'TB_DATAPOINTS_REQUEST' && data.version === 1) {\r\n      postDatapointsToIframe(iframe, datapoints);\r\n    }\r\n  });\r\n\r\n  try {\r\n    if (ctx && ctx.stateController && typeof ctx.stateController.subscribeOnChanges === 'function') {\r\n      ctx.stateController.subscribeOnChanges((newParams) => {\r\n        datapoints = newParams?.datapoints; // update our reference\r\n        postDatapointsToIframe(iframe, datapoints);\r\n      });\r\n    }\r\n  } catch (e) {\r\n    console.warn('State subscription not available:', e);\r\n  }\r\n}, 0);\r\n\r\nfunction jsonToBase64(jsonObj) {\r\n\r\n  const jsonString = JSON.stringify(jsonObj);\r\n \r\n  const base64String = btoa(jsonString);\r\n //console.log(base64String);\r\n  return base64String;\r\n\r\n}\r\n\r\nreturn layoutHtml;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* ===============================\r\n   Buttons (unchanged)\r\n=================================*/\r\n.header-btn {\r\n  padding: 0 18px;\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;\r\n  cursor: pointer;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;\r\n}\r\n.blue-btn { background-color: var(--tb-primary-500); }\r\n.green-btn { background-color: var(--tb-accent-500); }\r\n.green-btn:hover { background-color: var(--tb-accent-600); }\r\n.purple-btn { background-color: #8E24AA; }\r\n.purple-btn:hover { background-color: #7B1FA2; }\r\n.header-btn mat-icon { font-size: 18px; color: #fff; }\r\n\r\n/* ===============================\r\n   Layout\r\n=================================*/\r\n.main-layout {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n/* ===============================\r\n   HEADER (20px radius that actually shows)\r\n   - clip children to radius\r\n   - left inset\r\n   - tight gap to dashboard\r\n=================================*/\r\n.main-layout .header {\r\n  height: 75px;\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  background: #fff;\r\n  padding: 0 16px 0 10px !important;  /*  reduce left inset from 24px to 10px */\r\n  margin-bottom: 10px !important;\r\n\r\n  border-radius: 20px !important;\r\n  overflow: hidden;\r\n  justify-content: space-between; /* keep title/buttons layout intact */\r\n}\r\n\r\n\r\n/* Remove flex-gap margins so padding controls left edge precisely */\r\n.main-layout .header > * {\r\n  margin-left: 0 !important;\r\n  margin-right: 0 !important;\r\n}\r\n\r\n/* Some builds wrap inner row; reset any spacing/background there too */\r\n.main-layout .header > [fxlayout],\r\n.main-layout .header > [fxlayout] > * {\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  background: transparent !important;   /* ensure no inner block paints square corners */\r\n}\r\n\r\n/* Title styling */\r\n.main-layout .header .title {\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n  color: #28232D;\r\n  font-family: 'Roboto', sans-serif;\r\n  letter-spacing: 0.5px;\r\n  margin-left: 0 !important;\r\n}\r\n\r\n/* Optional logo rule */\r\n.main-layout .header .logo {\r\n  max-height: 60px;\r\n  width: auto;\r\n  margin-right: 12px;\r\n}\r\n\r\n/* ===============================\r\n   DASHBOARD STATE\r\n   - keep 20px radius\r\n   - remove top spacing\r\n=================================*/\r\n.main-layout tb-dashboard-state {\r\n  display: block;\r\n  background: #fff;\r\n  border-radius: 20px;\r\n  overflow: hidden;\r\n  box-shadow: none;\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n/* If the first child inside the state adds spacing, remove it */\r\n.main-layout tb-dashboard-state > *:first-child {\r\n  margin-top: 0 !important;\r\n  padding-top: 0 !important;\r\n}\r\n\r\n.header-btn {\r\n  padding: 0 18px;                  /*  horizontal breathing room */\r\n  height: 40px;\r\n  margin-left: 10px;\r\n  font-size: 14px;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-weight: 500;\r\n  border: none;\r\n  border-radius: 9999px;            /* full pill shape */\r\n  cursor: pointer;\r\n  display: inline-flex;             /* inline sizing */\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 6px;                         /* spacing between icon & text */\r\n  color: #fff;\r\n  transition: background-color 0.3s ease;\r\n  white-space: nowrap;              /* prevent wrapping */\r\n}\r\n\r\n/* make the header actually behave like the fxLayout you intended */\r\n.main-layout .header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between; /* < important */\r\n}\r\n\r\n/* ensure the button has a visible background even if the CSS var is missing */\r\n.primary-btn {\r\n  background-color: var(--tb-primary-500, #0084D6); /* fallback color */\r\n}\r\n\r\n.accent-btn {\r\n  background-color: var(--tb-accent-500, #0084D6); /* fallback color */\r\n}\r\n\r\n.gray-btn {\r\n  background-color: #D0D0D0; /* fallback color */\r\n}\r\n\r\n\r\n/* Purple variant */\r\n.purple-btn {\r\n  background-color: #8E24AA; /* base purple */\r\n}\r\n\r\n/* optional: make sure the right side lays out correctly even without fxLayout */\r\n.header-right {\r\n  display: inline-flex;\r\n  align-items: center;\r\n}\r\n\r\n/* Make header-left elements align tightly side-by-side */\r\n.header-left {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 10px; /* spacing between back button and title */\r\n}\r\n\r\n/* Round back button */\r\n.round-btn {\r\n  width: 40px;               /* same height/width for perfect circle */\r\n  height: 40px;\r\n  padding: 0;\r\n  border-radius: 50%;\r\n  min-width: 40px;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Ensure icon is same size as others */\r\n.round-btn mat-icon {\r\n  font-size: 18px;           /* same as others */\r\n  color: #fff;\r\n}\r\n\r\n\r\n/* Make round icon pills match your 40px spec */\r\n.header-right .round-btn {\r\n  width: 40px;\r\n  height: 40px;\r\n  min-width: 40px;\r\n  min-height: 40px;\r\n  padding: 0;\r\n  border-radius: 50%;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Keep icons tidy inside pills */\r\n.header-right .round-btn .tb-mat-18,\r\n.header-right .round-btn mat-icon {\r\n  font-size: 18px;\r\n  line-height: 1;\r\n}\r\n\r\n/* Service state size alignment with buttons */\r\n.service-item tb-dashboard-state{\r\n  height: 40px;\r\n  display: block;\r\n  margin-left: 10px; /* ensures consistent offset even if gap collapses */\r\n}\r\n\r\n\r\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "change-customer",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.changeCustomer(widgetContext);\r\n/*// 1) Injector & Services\r\nconst ctx              = widgetContext;\r\nconst injector         = ctx.$scope.$injector;\r\nconst customDialog     = injector.get(ctx.servicesMap.get('customDialog'));\r\nconst customerService  = injector.get(ctx.servicesMap.get('customerService'));\r\nconst tenantService    = injector.get(ctx.servicesMap.get('tenantService')); // NEW\r\nconst currentUser      = ctx.currentUser; // NEW\r\n\r\n// Determine the owner entity of the currently logged-in user (TENANT or CUSTOMER)\r\nconst ownerRef = (currentUser && currentUser.authority === 'TENANT_ADMIN')\r\n  ? { entityType: 'TENANT',   id: currentUser.tenantId }\r\n  : { entityType: 'CUSTOMER', id: currentUser.customerId };\r\n\r\n// 2) Storage for loaded customers\r\nlet customers = [];\r\n\r\n// 3) Load all customers, map & sort, then also fetch and prepend the Owner option\r\nconst pageLink = ctx.pageLink(1000, 0, null, null, null);\r\ncustomerService.getUserCustomers(pageLink).subscribe(pageData => {\r\n  customers = (pageData.data || [])\r\n    .map(c => ({\r\n      entityId:    c.id,      // c.id is typically { id: string, entityType: 'CUSTOMER' }\r\n      entityName:  c.name,    // for display\r\n      entityLabel: c.title    // optional label\r\n    }))\r\n    .sort((a, b) => (a.entityName || '').localeCompare(b.entityName || ''));\r\n\r\n  // After customers are in place, fetch the actual owner's display name and prepend as an option\r\n  addOwnerOptionAndOpen();\r\n}, err => {\r\n  // Even if fetching customers fails, try to show dialog with just Owner option\r\n  console.error('Failed to fetch customers', err);\r\n  customers = [];\r\n  addOwnerOptionAndOpen();\r\n});\r\n\r\n// Helper: fetch owner (tenant/customer) display info and prepend to list, then open dialog\r\nfunction addOwnerOptionAndOpen() {\r\n  if (!ownerRef || !ownerRef.id) {\r\n    // No owner info; just open with whatever we have\r\n    openChangeCustomerDialog();\r\n    return;\r\n  }\r\n\r\n  if (ownerRef.entityType === 'TENANT') {\r\n    // Fetch tenant name/title\r\n    tenantService.getTenant(ownerRef.id).subscribe(tenant => {\r\n      const ownerOption = {\r\n        entityId:    { id: tenant.id.id, entityType: 'TENANT' },\r\n        entityName:  tenant.title || 'Tenant',\r\n        entityLabel: tenant.title || 'Tenant'\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch tenant owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  } else {\r\n    // Fetch customer name/title\r\n    customerService.getCustomer(ownerRef.id).subscribe(cust => {\r\n      const ownerOption = {\r\n        entityId:    { id: cust.id.id, entityType: 'CUSTOMER' },\r\n        entityName:  (cust.title || cust.name || 'Customer'),\r\n        entityLabel: (cust.title || cust.name || 'Customer')\r\n      };\r\n      // Prepend owner if not already present\r\n      if (!customers.some(c => (c.entityId && c.entityId.id) === ownerOption.entityId.id &&\r\n                               (c.entityId && c.entityId.entityType) === ownerOption.entityId.entityType)) {\r\n        customers.unshift(ownerOption);\r\n      }\r\n      openChangeCustomerDialog();\r\n    }, err => {\r\n      console.error('Failed to fetch customer owner', err);\r\n      openChangeCustomerDialog();\r\n    });\r\n  }\r\n}\r\n\r\n// 4) Open dialog once customers (and owner) are ready\r\nfunction openChangeCustomerDialog() {\r\n  customDialog\r\n    .customDialog(htmlTemplate, ChangeCustomerController)\r\n    .subscribe();\r\n}\r\n\r\n// 5) Dialog controller\r\nfunction ChangeCustomerController(instance) {\r\n  const vm = instance;\r\n\r\n  // No prefill from state  start empty\r\n  vm.customers         = customers;\r\n  vm.filteredCustomers = vm.customers.slice();\r\n  vm.isLoading$        = ctx.rxjs.of(false);\r\n\r\n  // Empty form (no preselected value, empty input)\r\n  vm.form = vm.fb.group({\r\n    selected:      [ null ],\r\n    customerInput: [ '' ]\r\n  });\r\n\r\n  // Render name in input/options\r\n  vm.displayCustomer = (c) => c ? (c.entityLabel || c.entityName || '') : '';\r\n\r\n  // Filter logic for type-ahead\r\n  function applyCustomerFilter() {\r\n    const raw  = vm.form.get('customerInput').value;\r\n    const term = (typeof raw === 'string' ? raw : vm.displayCustomer(raw))\r\n      .toString()\r\n      .toLowerCase()\r\n      .trim();\r\n\r\n    vm.filteredCustomers = !term\r\n      ? vm.customers.slice()\r\n      : vm.customers.filter(c => (\r\n          (c.entityName  || '').toLowerCase().includes(term) ||\r\n          (c.entityLabel || '').toLowerCase().includes(term)\r\n        ));\r\n  }\r\n\r\n  // When typing, clear selection and filter list\r\n  vm.form.get('customerInput').valueChanges.subscribe(val => {\r\n    if (typeof val === 'string') {\r\n      vm.form.patchValue({ selected: null }, { emitEvent: false });\r\n    }\r\n    applyCustomerFilter();\r\n  });\r\n\r\n  // When a customer is picked from autocomplete, sync both controls\r\n  vm.onCustomerSelected = function(sel) {\r\n    vm.form.patchValue({\r\n      selected:      sel,\r\n      customerInput: sel\r\n    });\r\n  };\r\n\r\n  vm.cancel = () => vm.dialogRef.close(null);\r\n\r\n  vm.ok = () => {\r\n    const sel = vm.form.value.selected;\r\n    if (sel) {\r\n      const stateParams = ctx.stateController.getStateParams() || {};\r\n      stateParams.selectedCustomer = {\r\n        entityId:    sel.entityId,\r\n        entityName:  sel.entityName,\r\n        entityLabel: sel.entityLabel\r\n      };\r\n      stateParams.targetEntityParamName = 'selectedCustomer';\r\n      ctx.stateController.updateState(null, stateParams);\r\n      ctx.updateAliases();\r\n    }\r\n    vm.dialogRef.close(null);\r\n  };\r\n}\r\n\r\n// 6) HTML template (searchable customer/owner with mat-autocomplete; no prefill)\r\nconst htmlTemplate = '\\\r\n<form #changeForm=\"ngForm\" [formGroup]=\"form\"\\\r\n      (ngSubmit)=\"ok()\"\\\r\n      class=\"add-entity-form max-w-3xl mx-auto\" style=\"width:600px;\">\\\r\n\\\r\n  <mat-toolbar color=\"primary\" class=\"flex items-center bg-primary text-white px-4\">\\\r\n    <h2 class=\"text-lg font-semibold\">Change Customer / Owner</h2>\\\r\n    <span class=\"flex-1\"></span>\\\r\n    <button mat-icon-button type=\"button\" (click)=\"cancel()\">\\\r\n      <mat-icon>close</mat-icon>\\\r\n    </button>\\\r\n  </mat-toolbar>\\\r\n\\\r\n  <mat-progress-bar *ngIf=\"isLoading$ | async\"\\\r\n                    mode=\"indeterminate\" color=\"warn\">\\\r\n  </mat-progress-bar>\\\r\n  <div style=\"height:4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\\\r\n\\\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\\\r\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\\\r\n      <mat-label>Select Customer or Owner</mat-label>\\\r\n\\\r\n      <input type=\"text\"\\\r\n             matInput\\\r\n             placeholder=\"Type to search customers or owner\"\\\r\n             [matAutocomplete]=\"custAuto\"\\\r\n             formControlName=\"customerInput\">\\\r\n\\\r\n      <mat-autocomplete\\\r\n        #custAuto=\"matAutocomplete\"\\\r\n        [displayWith]=\"displayCustomer\"\\\r\n        (optionSelected)=\"onCustomerSelected($event.option.value)\">\\\r\n\\\r\n        <mat-option *ngFor=\"let c of filteredCustomers\" [value]=\"c\">\\\r\n          {{ c.entityName }}\\\r\n        </mat-option>\\\r\n      </mat-autocomplete> \\\r\n    </mat-form-field> \\\r\n  </div> \\\r\n\\\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2\">\\\r\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"\\\r\n            [disabled]=\"(isLoading$ | async)\">\\\r\n      Cancel\\\r\n    </button>\\\r\n    <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\\\r\n            [disabled]=\"(isLoading$ | async) || !form.value.selected\">\\\r\n      OK\\\r\n    </button>\\\r\n  </div>\\\r\n</form>';\r\n*/",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Entity Management JS Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fd0d775f-d04e-1c4c-b592-da2b6d5f5be3"
              },
              {
                "name": "user-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "user_management_all",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e41e5cf8-f901-bdad-77d0-6b9feb7d22e3"
              },
              {
                "name": "customer-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "retail_companies",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2529050e-4b2f-53b4-2568-5782da1d9434"
              },
              {
                "name": "mobile-qr",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "mobile_app",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "25vw",
                "popoverHeight": "25vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2122aec7-4926-fef5-74e0-faa8f42a6fac"
              },
              {
                "name": "all-devices-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openURL",
                "openNewBrowserTab": true,
                "url": "https://cloud.pke-iot.expert/entities/devices/all",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4a37e797-523b-cfe5-634d-abd84a5f5d27"
              },
              {
                "name": "add-device-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "let desiredMode = \"Both\"\nutils.addDevice(widgetContext,entityId,entityName,entityLabel,desiredMode);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/aleks device management.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d03b0a4c-f8ca-4365-d791-c7f7c1bf8751"
              },
              {
                "name": "import-devices-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.importDevices(widgetContext);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/Import Utils.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "93939acc-5c20-003a-137e-d804fb77a479"
              },
              {
                "name": "back-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "//var params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\n//widgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);\n\n\n\n//params['targetEntityParamName'] = \"homeWidgetMode\";\n//params['selectedDevice'] = null;\n//params['selectedLocation'] = null;\n//params['tabMode'] = null;\n//params['deviceMode'] = null;\n//params['datapoints'] = null;\n//params['mainDatapoint'] = null;\n//params['gatewaysMode'] = null;\n//params['alarmsMode'] = null;\n//params['locationMode'] = null;",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c5c34a18-1416-c9fd-12d3-f1d0e568ac16"
              },
              {
                "name": "sim-menu",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "SIM Menu",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "380px",
                "popoverHeight": "375px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "d23195cf-ba44-f0f8-da66-0886376e1936"
              },
              {
                "name": "device-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "function openDeviceManagement() {\r\n  const id = entityId?.id;\r\n  if (!id) {\r\n    console.warn('No entityId found!');\r\n    return;\r\n  }\r\n\r\n  const url = `https://cloud.pke-iot.expert/entities/devices/all/${id}`;\r\n  window.open(url, '_blank', 'noopener,noreferrer');\r\n}\r\n\r\nopenDeviceManagement();",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b181d37a-bb96-c290-1aea-f67b92d8879d"
              },
              {
                "name": "table-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"table\";\nlet params = widgetContext.stateController.getStateParams();\nlet dashboard = params.dashboard;\n\nparams['dataMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6cccc9\"\n    },\n    entityName: mode,\n    entityLabel: mode,\n    dashboard: dashboard\n};\nparams['targetEntityParamName'] = \"dataMode\";\nwidgetContext.stateController.updateState(null, params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "98a8742c-9680-3de5-e82c-d21cf5c10c8e"
              },
              {
                "name": "charts-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let mode = \"charts\";\nlet params = widgetContext.stateController.getStateParams();\nlet dashboard = params.dashboard;\n\nparams['dataMode'] = { \n    entityId: {\n        entityType: \"DEVICE\",\n        id:\"6503e900-0c65-11ef-842a-1fe8cd6cccc2\"\n    },\n    entityName: mode,\n    entityLabel: mode,\n    dashboard: dashboard\n};\nparams['targetEntityParamName'] = \"dataMode\";\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "93d72ae5-eb71-544d-b9f2-c3125bc416b7"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "a4d91f69-6265-d266-eff2-cac617dfad96"
      },
      "f4bffa7d-f9c6-30c9-afeb-230ef7bd71a4": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "07d00b0b-d600-91ed-97f6-42171effae40",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.9967549141360346
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.5624884360658327
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8984113434164049
                },
                {
                  "name": "displayName",
                  "type": "attribute",
                  "label": "displayName",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.25180997441907293
                },
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "status_battery_level",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.22071149447668148
                },
                {
                  "name": "status_margin",
                  "type": "timeseries",
                  "label": "status_margin",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.9146292142531982
                },
                {
                  "name": "battery",
                  "type": "timeseries",
                  "label": "battery",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8061053402016021
                },
                {
                  "name": "vpnIp",
                  "type": "attribute",
                  "label": "vpnIp",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.049656195239825895
                },
                {
                  "name": "meterType",
                  "type": "attribute",
                  "label": "meterType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.8248093970853291
                },
                {
                  "name": "service",
                  "type": "attribute",
                  "label": "service",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.43793392037516243
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.13086289102320703
                },
                {
                  "name": "lastActivityTime",
                  "type": "attribute",
                  "label": "lastActivityTime",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.22434944053371275,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": {
                    "body": "//return utils.unixToIso(value);\n\nif (value) {\n  return moment(value).format(\"DD/MM/YY HH:mm\");\n}\nreturn '{i18n:custom.activity.never-seen}';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
                    }
                  }
                },
                {
                  "name": "rssi",
                  "type": "timeseries",
                  "label": "rssi",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.028010026066390692
                },
                {
                  "name": "snr",
                  "type": "timeseries",
                  "label": "snr",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.9752331552707985
                },
                {
                  "name": "sim",
                  "type": "attribute",
                  "label": "sim",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.5048478617351604
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "entityName",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.0627942695322049,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "e8f543a9-82ff-0b69-d012-8349ea363657",
              "dataKeys": [
                {
                  "name": "sim_ip",
                  "type": "attribute",
                  "label": "sim_ip",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.2563743905893755
                },
                {
                  "name": "sim_status",
                  "type": "attribute",
                  "label": "sim_status",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.3596255622913921
                },
                {
                  "name": "sim_provider",
                  "type": "attribute",
                  "label": "sim_provider",
                  "color": "#ff5722",
                  "settings": {},
                  "_hash": 0.09768258511490857
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1711476503570,
                "endTimeMs": 1711562903570
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FAFAFA",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "var name, label, type, displayName, active, batteryLevel, linkMargin;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    type = data[0]['Type'];\n    displayName = data[0]['displayName'];\n    active = data[0]['active'];\n    batteryLevel = data[0]['status_battery_level'];\n    linkMargin = data[0]['status_margin'];\n    if (active === 'false') {\n        state = 'disconnected';\n    } else state = 'connected';\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    displayName = 'N/A';\n    active = 'N/A';\n    batteryLevel = 'N/A';\n    linkMargin = 'N/A';\n}\n\nvar displayBatteryLevel = showBatteryLevel(type);\n\nvar typeSvg = getTypeSvg(type);\n    var encodedTypeSvg = encodeURIComponent(typeSvg);\n    var typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + label + '</div>' +\n                   '<div class=\"subtitle\">' + displayName + '</div>' +\n                '</div>' +\n//                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-day\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">dashboard</mat-icon><span>Day</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"details-full\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">device-dashboard</mat-icon><span>Dashboard</span></button></div>' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"settings\" data-device-type=' + encodeURIComponent(type) + ' type=\"button\" mat-button color=\"primary\"><mat-icon class=\"tb-mat-18\">settings</mat-icon><span>Settings</span></button></div>' +\n                '</div>';\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n          header +\n          '<div fxLayout=\"row\" class=\"params\">' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Type: </div>' +\n                '<div class=\"param\">'+ type +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Label: </div>' +\n                '<div class=\"param\">'+ label +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">State: </div>' +\n                '<div class=\"param\">'+ getStateHtml(state) +'</div>' +\n              '</div>' +\n              (displayBatteryLevel ? ('<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Battery level: </div>' +\n                '<div class=\"param\">'+ getBatteryLevelHtml(batteryLevel) +'</div>' +\n              '</div>') : '') +\n          '</div>' +\n       '<div>';\n\nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Enginko LW06485_EV':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-480h320v-80H320v80Zm160 320q42 0 71-28.5t29-69.5q0-33-19-56.5T480-490q-63 72-81.5 96T380-338q0 41 29 69.5t71 28.5Z\"/></svg>';\n            break;\n        case 'Elsys ERS Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Milesight EM300-TH':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/></svg>';\n            break;\n        case 'Elsys ERS CO2 Lite':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Milesight AM300':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M360-480q17 0 28.5-11.5T400-520v-120q0-17-11.5-28.5T360-680q-17 0-28.5 11.5T320-640v120q0 17 11.5 28.5T360-480Zm40 240h160v-80q0-33-23.5-56.5T480-400q-33 0-56.5 23.5T400-320v80Zm200-240q17 0 28.5-11.5T640-520v-120q0-17-11.5-28.5T600-680q-17 0-28.5 11.5T560-640v120q0 17 11.5 28.5T600-480ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z\"/></svg>';\n            break;\n        case 'Milesight WS522':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/></svg>';\n            break;\n        case 'Dragino CPL01':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Adeunis Pulse':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-160h80v160h160v80H160ZM80-640v-160q0-33 23.5-56.5T160-880h160v80H160v160H80Zm360 436q-92-14-157-79t-79-157h80q12 59 54.5 101.5T440-284v80ZM204-520q14-92 79-157.5T440-756v80q-59 12-101.5 54.5T284-520h-80Zm276 120q-33 0-56.5-23.5T400-480q0-34 23.5-57t56.5-23q34 0 57 23t23 57q0 33-23 56.5T480-400Zm40 196v-80q59-12 101.5-54.5T676-440h80q-13 92-78.5 157T520-204Zm156-316q-12-59-54.5-101.5T520-676v-80q92 14 157.5 79T756-520h-80ZM640-80v-80h160v-160h80v160q0 33-23.5 56.5T800-80H640Zm160-560v-160H640v-80h160q33 0 56.5 23.5T880-800v160h-80Z\"/></svg>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M480-520q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM240-280v-76q0-21 10.5-39.5T279-425q45-26 95-40.5T480-480q56 0 106 14.5t95 40.5q18 11 28.5 29.5T720-356v76H240Zm609-354q-31-73-86.5-128.5T634-849l31-74q88 36 154.5 103T923-665l-74 31Zm-738 0-74-31q37-88 103.5-154.5T295-923l31 74q-73 31-128.5 86.5T111-634ZM295-37q-88-36-154.5-103T37-295l74-31q31 73 86.5 128.5T326-111l-31 74Zm370 0-31-74q73-31 128.5-86.5T849-326l74 31q-36 88-103 154.5T665-37Z\"/></svg>';\n            break;\n        case 'Innotas Modularis':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M491-200q12-1 20.5-9.5T520-230q0-14-9-22.5t-23-7.5q-41 3-87-22.5T343-375q-2-11-10.5-18t-19.5-7q-14 0-23 10.5t-6 24.5q17 91 80 130t127 35ZM480-80q-137 0-228.5-94T160-408q0-100 79.5-217.5T480-880q161 137 240.5 254.5T800-408q0 140-91.5 234T480-80Zm0-80q104 0 172-70.5T720-408q0-73-60.5-165T480-774Q361-665 300.5-573T240-408q0 107 68 177.5T480-160Zm0-320Z\"/></svg>';\n            break;\n        case 'Fludia FM432g':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Fludia FM432e':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM310-UDL':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight WS301':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-DI':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'Milesight EM300-ZLD':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KWZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC KMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC WMZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC ELZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC GZ':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        case 'MUC Device':\n            typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z\"/></svg>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return typeSvg;\n} \n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n    '</span>';\n}\n\nfunction getBatteryLevelHtml(batteryLevel) {\n    var batteryLevelNumber = Number(batteryLevel);\n    var batteryLevelSvg = getBatteryLevelSvg(batteryLevelNumber);\n    var encodedBatteryLevelSvg = encodeURIComponent(batteryLevelSvg);\n    var batteryLevelSvgUrl = 'data:image/svg+xml,' + encodedBatteryLevelSvg;\n    return '<div>' +\n              '<img class=\"mat-icon\" src=\"'+ batteryLevelSvgUrl +'\">' +\n              '<span style=\"padding-left: 8px; padding-right: 8px;\">' + batteryLevelNumber.toFixed(0) + '%</span>' +\n              '<button id=\"battery-level\" matTooltip=\"Battery Level History\" type=\"button\" mat-flat-button color=\"primary\"><mat-icon>bar_chart</mat-icon></button>' +\n            '</div>';\n}\n\n\nfunction getStateSvg(state) {\n    switch (state) {\n/*        \n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>'; \n*/\n        case 'connected':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getBatteryLevelSvg(batteryLevel) {\n    var batteryLevelSvg;\n    if (batteryLevel <= 5) {\n        batteryLevelSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 35) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#E64A19\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#E64A19\"/>';\n    } else if (batteryLevel <= 65) {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#D5C21B\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#D5C21B\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#D5C21B\"/>';\n    } else if (batteryLevel <= 95) {\n        batteryLevelSvg = '<path d=\"M14 14H6V16H14V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 11H14V13H6V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 8H6V10H14V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5 3H7V2C7 1.44772 7.44772 1 8 1H12C12.5523 1 13 1.44772 13 2V3H15C15.5523 3 16 3.44772 16 4V17C16 17.5523 15.5523 18 15 18H5C4.44772 18 4 17.5523 4 17V4C4 3.44772 4.44772 3 5 3ZM5 4H8V2H12V4H15V17H5V4Z\" fill=\"#1F8B4D\"/>';\n    } else {\n        batteryLevelSvg = '<path d=\"M6 14H14V16H6V14Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 11H6V13H14V11Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M6 8H14V10H6V8Z\" fill=\"#1F8B4D\"/>' +\n                         '<path d=\"M14 5H6V7H14V5Z\" fill=\"#1F8B4D\"/>' +\n                         '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7 3H5C4.44772 3 4 3.44772 4 4V17C4 17.5523 4.44772 18 5 18H15C15.5523 18 16 17.5523 16 17V4C16 3.44772 15.5523 3 15 3H13V2C13 1.44772 12.5523 1 12 1H8C7.44772 1 7 1.44772 7 2V3ZM8 4H5V17H15V4H12V2H8V4Z\" fill=\"#1F8B4D\"/>';\n    }\n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n              batteryLevelSvg +\n            '</svg>';\n}\n\n\nfunction getStateLabel(state) {\n    switch(state) {\n/*        \n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n*/\n        case 'connected':\n            return 'Connected';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n\nfunction showBatteryLevel(deviceType) {\n    switch(deviceType) {\n        case 'Innotas Modularis':\n            return true;\n        case 'Fludia FM432g':\n            return true;\n        case 'Fludia FM432e':\n            return true;        \n        case 'Milesight EM310-UDL':\n            return true;\n        case 'Milesight WS301':\n            return true;\n        case 'Milesight EM300-DI':\n            return true;\n        case 'Milesight EM300-TH':\n            return true;\n        case 'Milesight EM300-ZLD':\n            return true;\n        case 'Enginko LW06485_EV':\n            return false;\n        case 'Dragino CPL01':\n            return true;\n        case 'Elsys ERS Lite':\n            return true;\n        case 'Elsys ERS CO2 Lite':\n            return true;\n        case 'Milesight WS522':\n            return false;\n        case 'MUC':\n            return false;\n        case 'MUC KWZ':\n            return false;\n        case 'MUC KMZ':\n            return false;\n        case 'MUC WMZ':\n            return false;\n        case 'MUC ELZ':\n            return false;\n        case 'MUC GZ':\n            return false;\n        case 'MUC Device':\n            return true;\n        case 'Door Sensor':\n            return true;\n        case 'Motion Sensor':\n            return true;\n        case 'Occupancy Sensor':\n            return true;\n        default:\n            return false;\n    }\n}   \n",
            "markdownTextFunction": {
              "body": "const d = data?.[0] || {};\r\nconst s = data?.[1] || {};\r\n\r\n// === Base device data ===\r\nlet label = d.Label ?? 'N/A';\r\nlet type = d.Type ?? 'N/A';\r\nlet entityName = d.entityName ?? 'N/A';\r\nlet displayName = d.displayName ?? 'N/A';\r\nlet active = d.active ?? 'N/A';\r\nlet service = d.service ?? d.Service ?? 'N/A';\r\nlet state = d.state ?? d.State ?? 'N/A';\r\nlet batteryLevel = d.battery ?? 'N/A';\r\nlet rssi = d.rssi ?? 'N/A';\r\nlet snr = d.snr ?? 'N/A';\r\nlet linkMargin = d.status_margin ?? 'N/A';\r\nlet meterType = d.meterType ?? 'N/A';\r\nlet vpnIp = d.vpnIp ?? 'N/A';\r\nlet lastActivityTime = d.lastActivityTime ?? 'N/A';\r\n\r\n// === Display name logic ===\r\nconst _dn = String(displayName ?? '').trim();\r\nconst _hasDisplayName = _dn && _dn !== 'N/A';\r\nconst _titleText = _hasDisplayName ? displayName : entityName;\r\nconst _subtitleText = _hasDisplayName ? entityName : '';\r\n\r\n// === SIM info ===\r\nlet simIp = s.simIp ?? s.sim_ip ?? 'N/A';\r\nlet simStatus = s.simStatus ?? 'N/A';\r\nconst _simStatusObj = (() => {\r\n  try {\r\n    return s.sim_status ? JSON.parse(s.sim_status) : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n})();\r\nconst simStatusIdRaw = _simStatusObj?.id ?? simStatus;\r\nconst simStatusId = Number(simStatusIdRaw);\r\nconst simCarrierLabel = (() => {\r\n  try {\r\n    return s.sim_provider ? (JSON.parse(s.sim_provider).label ?? 'N/A') : 'N/A';\r\n  } catch {\r\n    return 'N/A';\r\n  }\r\n})();\r\nconst simOnline = simIp && simIp !== 'N/A';\r\nconst displaySim = (() => {\r\n  try {\r\n    const sim = d.sim ? JSON.parse(d.sim) : null;\r\n    const iccid = sim?.iccid;\r\n    if (iccid == null) return false;\r\n    const str = String(iccid).trim().toLowerCase();\r\n    return str && str !== 'n/a' && str !== 'null' && str !== 'undefined';\r\n  } catch {\r\n    return false;\r\n  }\r\n})();\r\n\r\n// === Colors ===\r\nconst getCss = (name, fallback) =>\r\n  getComputedStyle(document.documentElement).getPropertyValue(name)?.trim() || fallback;\r\nconst colorPrimary = getCss('--tb-primary-500', '#0094d0');\r\nconst colorSecondary = getCss('--tb-accent-500', '#4caf50');\r\nconst colorError = 'red';\r\nconst colorGrey = 'gray';\r\nlet simStatusColor = simStatusId === 2\r\n  ? (simOnline ? colorSecondary : colorGrey)\r\n  : (simStatusId == 5 ? colorError : colorPrimary);\r\n\r\n// === Utility-generated HTML ===\r\nconst icon = utils.getDeviceIcon(type);\r\nconst stateHtml = utils.getStateHtml(state, service);\r\nconst batteryLevelHtml = utils.getBatteryLevelHtml(batteryLevel);\r\nconst rssiLevelHtml = utils.getRssiHtml(rssi);\r\nconst snrLevelHtml = utils.getSnrHtml(snr);\r\n\r\n// === Active status ===\r\nconst isActive = active === 'true';\r\nconst color = isActive ? '#27AE60' : '#FF0000';\r\nconst bgColor = isActive ? 'rgba(39, 174, 96, 0.1)' : 'rgba(255, 0, 0, 0.1)';\r\nconst activeHtml =\r\n  '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\r\n  color +\r\n  ';background-color:' +\r\n  bgColor +\r\n  '\">' +\r\n  lastActivityTime +\r\n  '</div>';\r\n\r\n// === Metric card helper ===\r\nconst metricLabelStyle =\r\n  'font-size:14px; font-weight:700; color:#334155; letter-spacing:.01em;';\r\nconst metricValueWrap = 'display:inline-block; transform:scale(.90); transform-origin:left top;';\r\nconst metricValueRow = [\r\n  'display:flex',\r\n  'align-items:center',\r\n  'white-space:nowrap',\r\n  'overflow:hidden',\r\n  'text-overflow:ellipsis'\r\n].join(';') + ';';\r\n\r\nfunction metricCard(label, valueHtml, opts = {}) {\r\n  const base = 'metric-card';\r\n  const isButton = !!(opts.id || opts.dataValue);\r\n  const attrId = opts.id ? ` id=\"${opts.id}\"` : '';\r\n  const attrData = opts.dataValue ? ` data-value=\"${opts.dataValue}\" (click)=\"ctx.actionsApi.elementClick($event)\"` : '';\r\n  const tt = opts.tooltip ? ` matTooltip=\"${opts.tooltip}\" matTooltipPosition=\"below\"` : '';\r\n  const inner =\r\n    `<div class=\"metric-label\" style=\"${metricLabelStyle}\">${label}</div>` +\r\n    `<div style=\"${metricValueRow}\"><div style=\"${metricValueWrap}\">${valueHtml}</div></div>`;\r\n  return isButton\r\n    ? `<button type=\"button\"${attrId}${attrData}${tt} class=\"${base} metric-card--button\" aria-label=\"${label}\">${inner}</button>`\r\n    : `<div class=\"${base}\">${inner}</div>`;\r\n}\r\n\r\n// === Inline metrics section ===\r\nconst paramsInline =\r\n  '<div class=\"metric-row\">' +\r\n    metricCard('State',    stateHtml) +\r\n    metricCard('Activity', activeHtml) +\r\n    (batteryLevel !== 'N/A' ? metricCard('Battery', batteryLevelHtml, { id: 'battery-level', dataValue: 'battery-level', tooltip: 'Battery Level History' }) : '') +\r\n    (rssi !== 'N/A'        ? metricCard('RSSI',    rssiLevelHtml,    { id: 'rssi-widget',    dataValue: 'rssi-widget',    tooltip: 'RSSI Details' }) : '') +\r\n    (snr !== 'N/A'         ? metricCard('SNR',     snrLevelHtml,     { id: 'snr-widget',     dataValue: 'snr-widget',     tooltip: 'SNR Details' }) : '') +\r\n  '</div>';\r\n\r\n// === Header (metrics between title and buttons) ===\r\nlet header =\r\n  '<div class=\"header\" role=\"group\">' +\r\n    '<div class=\"header__info\">' +\r\n      '<div class=\"title\" title=\"' + _titleText + '\">' +\r\n        '<span class=\"title-text\">' + _titleText + '</span>' +\r\n        '<span class=\"material-icons title-icon\">' + icon + '</span>' +\r\n      '</div>' +\r\n      (_subtitleText ? '<div class=\"subtitle\" title=\"' + _subtitleText + '\">' + _subtitleText + '</div>' : '') +\r\n    '</div>' +\r\n    '<div class=\"header__metrics\">' + paramsInline + '</div>' +\r\n    '<div class=\"header__actions\">' +\r\n      /*'<button id=\"device-management\" mat-flat-button color=\"accent\" class=\"icon-btn\" matTooltip=\"Open Device\" matTooltipPosition=\"below\">' +\r\n        '<mat-icon>devices_other</mat-icon>' +\r\n      '</button>' +*/\r\n      /*(meterType === \"Gateway\" && vpnIp !== 'N/A' ?\r\n        '<a mat-flat-button color=\"primary\" class=\"icon-btn\" href=\"http://' + vpnIp + '\" target=\"_blank\" rel=\"noopener\" matTooltip=\"Webserver\" matTooltipPosition=\"below\">' +\r\n          '<mat-icon>language</mat-icon>' +\r\n        '</a>' : '') +\r\n      (displaySim ?\r\n        ('<button id=\"sim-menu\" data-action=\"sim-menu\" type=\"button\" mat-flat-button class=\"icon-btn\" style=\"background-color:' + simStatusColor + ';color:#fff\" matTooltip=\"Open SIM Menu\" matTooltipPosition=\"below\">' +\r\n          '<mat-icon>sim_card</mat-icon>' +\r\n        '</button>') : '') +\r\n      '<div class=\"service-item\" matTooltip=\"Service\">' +\r\n        '<tb-dashboard-state style=\"width:100px;border-radius:8px;overflow:hidden;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Service Attribute\"></tb-dashboard-state>' +\r\n      '</div>' +*/\r\n    '</div>' +\r\n  '</div>';\r\n\r\n// === Final markup ===\r\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">' + header + '<div>';\r\n",
              "modules": {
                "utils": "tb-resource;/api/resource/js_module/tenant/Device Management JS Utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "/* --- Make header same height as inspo and center everything --- */\r\n.main-layout .header{\r\n  /* target the inspo feel */\r\n  min-height: 72px;            /* same visual height as inspo */\r\n  padding: 12px 16px;          /* inspo-like padding */\r\n  align-items: center;         /* center title + metrics + buttons vertically */\r\n  gap: 12px;                   /* a touch more breathing room */\r\n}\r\n\r\n/* Left column: vertically center title/subtitle block */\r\n.header__info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;     /* center the block in the header */\r\n  min-height: 0;\r\n}\r\n\r\n/* Title row: center icon with text (was flex-start) */\r\n.header__info .title{\r\n  align-items: center;\r\n}\r\n\r\n/* Subtitle: remove extra lift */\r\n.header__info .subtitle{\r\n  margin: 2px 0 0 0;\r\n  line-height: 1.2;\r\n}\r\n\r\n/* Middle column (metrics): center the row itself */\r\n.header__metrics{\r\n  align-self: center;          /* ensure the metrics block doesnt shift the header */\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* Keep metric cards compact like the inspo (72px tall) */\r\n.header__metrics .metric-card,\r\n.header__metrics .metric-card--button{\r\n  height: 72px;                /* matches inspo cards */\r\n}\r\n\r\n/* Right column (buttons): center vertically */\r\n.header__actions{\r\n  align-items: center;         /* was flex-start */\r\n}\r\n\r\n/* Buttons & mini-state: match inspo 44px round pills */\r\n.icon-btn{\r\n  width: 44px;\r\n  height: 44px;\r\n  border-radius: 9999px;\r\n}\r\n.service-item tb-dashboard-state{\r\n  height: 44px;\r\n}\r\n\r\n/* Optional: keep the icon visually centered inside 44px pill */\r\n.icon-btn .mat-icon{\r\n  font-size: 20px;\r\n  width: 20px;\r\n  height: 20px;\r\n  line-height: 1;\r\n}\r\n\r\n/* 1) Make the header a 3-column grid and center vertically */\r\n.main-layout .header{\r\n  display: grid !important;\r\n  grid-template-columns: auto 1fr auto;  /* left | middle | right */\r\n  align-items: center;                   /* vertical centering */\r\n  column-gap: 16px;\r\n  padding: 12px 16px;\r\n  min-height: 96px;                      /* match inspo feel */\r\n  background: #FAFAFA;\r\n}\r\n\r\n/* 2) Keep each column from forcing wraps */\r\n.header__info{ min-width: 240px; display:flex; flex-direction:column; justify-content:center; }\r\n.header__info .title{ align-items:center; }       /* icon aligned with title */\r\n.header__actions{ align-items:center; display:flex; gap:8px; }\r\n\r\n/* 3) Metrics stay centered, on a single line */\r\n.header__metrics{ justify-self:center; display:flex; align-items:center; }\r\n.header__metrics .metric-row{\r\n  display:flex; align-items:center; justify-content:center;\r\n  gap:4px; flex-wrap:nowrap; white-space:nowrap;   /* prevent second line */\r\n}\r\n.header__metrics .metric-card,\r\n.header__metrics .metric-card--button{\r\n  flex:0 0 130px; width:130px; height:72px;        /* compact like inspo */\r\n}\r\n\r\n/* 4) Buttons/pills same size as inspo */\r\n.icon-btn{ width:44px; height:44px; border-radius:9999px; }\r\n.service-item tb-dashboard-state{ height:44px; }\r\n\r\n/* (Optional) ensure nothing else collapses the middle column */\r\n.main-layout .header > * { min-width:0; }\r\n\r\n/* ===== HEADER LAYOUT (one line, centered) ===== */\r\n.main-layout .header{\r\n  display: grid !important;\r\n  grid-template-columns: auto 1fr auto;  /* left | middle | right */\r\n  align-items: center;\r\n  column-gap: 16px;\r\n  padding: 8px 8px;\r\n  min-height: 84px;                      /* compact like inspo */\r\n  background: #FAFAFA;\r\n}\r\n\r\n/* ===== LEFT: Title / Subtitle (restore styling) ===== */\r\n.main-layout .header .header__info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  min-width: 0;\r\n}\r\n.main-layout .header .header__info .title{\r\n  display: inline-flex;\r\n  align-items: center;                   /* icon aligned with text */\r\n  gap: 8px;\r\n  font-size: 18px !important;\r\n  font-weight: 700 !important;\r\n  color: #0f172a !important;\r\n  line-height: 1.2;\r\n  margin: 0;\r\n}\r\n.main-layout .header .header__info .title .title-icon{\r\n  font-size: 20px;\r\n  line-height: 1;\r\n  opacity: .9;\r\n}\r\n.main-layout .header .header__info .subtitle{\r\n  font-size: 13px !important;\r\n  color: #757575 !important;\r\n  margin-top: 2px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n}\r\n\r\n/* ===== MIDDLE: Metric row (restore pill styling) ===== */\r\n.main-layout .header .header__metrics{\r\n  justify-self: center;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.main-layout .header .header__metrics .metric-row{\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 4px;\r\n  flex-wrap: nowrap;                     /* prevent wrapping */\r\n  white-space: nowrap;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n/* Stronger selector so app-level `.metric-card` doesnt override */\r\n.main-layout .header .header__metrics .metric-card,\r\n.main-layout .header .header__metrics .metric-card--button{\r\n  flex: 0 0 130px;\r\n  width: 130px;\r\n  height: 72px;\r\n  border-radius: 15px !important;\r\n  background: #FAFAFA !important;\r\n  border: 1px solid #e5e7eb !important;\r\n  display: grid;\r\n  grid-template-rows: auto 1fr;\r\n  align-items: center;\r\n  row-gap: 6px;\r\n  padding: 8px 10px !important;\r\n  text-align: left;\r\n  transition: background .15s ease, border-color .15s ease;\r\n}\r\n.main-layout .header .header__metrics .metric-card--button:hover,\r\n.main-layout .header .header__metrics .metric-card--button:focus{\r\n  background: #f0f0f0 !important;\r\n  border-color: #d1d5db !important;\r\n}\r\n\r\n/* Label/value inside cards (same look as before) */\r\n.main-layout .header .header__metrics .metric-label{\r\n  font-size: 14px;\r\n  font-weight: 700;\r\n  color: #334155;\r\n  letter-spacing: .01em;\r\n}\r\n\r\n/* ===== RIGHT: Action pills ===== */\r\n.main-layout .header .header__actions{\r\n  display: flex;\r\n  align-items: center;                   /* vertical center */\r\n  gap: 8px;\r\n}\r\n.main-layout .header .icon-btn{\r\n  width: 44px;\r\n  height: 44px;\r\n  border-radius: 9999px;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 0;\r\n}\r\n.main-layout .header .icon-btn .mat-icon{\r\n  font-size: 20px;\r\n  width: 20px;\r\n  height: 20px;\r\n  line-height: 1;\r\n}\r\n.main-layout .header .service-item tb-dashboard-state{\r\n  height: 44px;\r\n  display: block;\r\n}\r\n\r\n/* Safety: prevent any child from stretching the grid cells */\r\n.main-layout .header > *{ min-width: 0; }\r\n\r\n\r\n/* === Fix: restore perfect round device button === */\r\n.icon-btn,\r\n#device-management {\r\n  width: 44px !important;       /* fixed width */\r\n  height: 44px !important;      /* fixed height */\r\n  min-width: 44px !important;   /* override mat-button min width */\r\n  min-height: 44px !important;\r\n  padding: 0 !important;        /* remove default Material padding */\r\n  border-radius: 50% !important;/* perfect circle */\r\n  display: inline-flex !important;\r\n  align-items: center;\r\n  justify-content: center;\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* ensure the icon itself stays centered */\r\n.icon-btn .mat-icon,\r\n#device-management .mat-icon {\r\n  margin: 0 !important;\r\n  font-size: 20px !important;\r\n  line-height: 1;\r\n}\r\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "device-settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#device-settings', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = widgetContext.stateController.getStateParams();\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\n// widgetContext.actionsApi.openDashboardStateInSeparateDialog(stateId, params, entityName, false, '1280', '1024');\n// widgetContext.stateController.openState(stateId, params);\n// widgetContext.actionsApi.handleWidgetAction($event, stateId, params);\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '600px', '800px');\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            return 'wassergeraete_volumess_wmz_settings';\n        case 'Elsys ERS Lite':            \n            return 'elsys_ers_lite_settings';\n        case 'Elsys ERS CO2 Lite':            \n            return 'elsys_ers_co2_lite_settings';                      \n        case 'Dragino CPL01':\n            return 'dragino_cpl01_settings';\n        case 'Innotas Modularis':            \n            return 'innotas_modularis_settings';\n        case 'Fludia FM432g':            \n            return 'fludia_fm432g_settings';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl_settings';\n        case 'Milesight WS301':            \n            return 'milesight_ws301_settings';\n        case 'Milesight EM300-DI':            \n            return 'milesight_em300_di_settings';                      \n        case 'Milesight EM300-TH':\n            return 'milesight_em300_th_settings';\n        case 'Milesight EM300-ZLD':            \n            return 'milesight_em300_zld_settings';\n        case 'Milesight AM300':            \n            return 'milesight_am300_settings';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl_settings';\n        case 'MUC':            \n            return 'muc_settings';                      \n        case 'MUC KWZ':\n            return 'muc_kwz_settings';\n        case 'MUC KMZ':            \n            return 'muc_kmz_settings';\n        case 'MUC WMZ':            \n            return 'muc_wmz_settings';                      \n        case 'MUC ELZ':\n            return 'muc_elz_settings';\n        case 'MUC GZ':\n            return 'muc_gz_settings';\n        case 'Beckhoff RT':\n            return 'beckhoff_rt_settings';\n        case 'Beckhoff EV':\n            return 'beckhoff_ev_settings';\n        case 'Beckhoff ELZ':\n            return 'beckhoff_ev_settings';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_full';\n        default:\n            return 'unknown_settings';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2ad18dd5-c734-2c7a-44c8-c903d49c2a60"
              },
              {
                "name": "device-dashboard",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#device-dashboard', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = widgetContext.stateController.getStateParams();\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\n// widgetContext.actionsApi.openDashboardStateInSeparateDialog(stateId, params, entityName, false, '1280', '1024');\nwidgetContext.stateController.openState(stateId, params);\n// widgetContext.actionsApi.handleWidgetAction($event, stateId, params);\n// widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px');\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'Wassergeraete VoluMess VI-E':\n            return 'wassergeraete_volumess_wmz'; \n        case 'Sontex Supercal 739':\n            return 'sontex_supercal_739';\n        case 'Elsys ERS Lite':            \n            return 'elsys_ers_lite';\n        case 'Elsys ERS CO2 Lite':            \n            return 'elsys_ersco2_lite';                      \n        case 'Dragino CPL01':\n            return 'dragino_cpl01';\n        case 'Innotas Modularis':            \n            return 'innotas_modularis';\n        case 'Fludia FM432g':            \n            return 'fludia_fm432g';  \n        case 'MClimate Multipurpose Button':            \n            return 'mclimate_multipurpose_button';   \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'Milesight WS301':            \n            return 'milesight_ws301';\n        case 'Milesight EM300-DI':            \n            return 'milesight_em300_di';                      \n        case 'Milesight EM300-TH':\n            return 'milesight_em300_th';\n        case 'Milesight EM300-ZLD':            \n            return 'milesight_em300_zld';\n        case 'Milesight AM300':            \n            return 'milesight_am300';                      \n        case 'Milesight EM310-UDL':\n            return 'milesight_em310_udl';\n        case 'MUC':            \n            return 'muc';                      \n        case 'MUC KWZ':\n            return 'muc_kwz';\n        case 'MUC KMZ':            \n            return 'muc_kmz';\n        case 'MUC WMZ':            \n            return 'muc_wmz';                      \n        case 'MUC ELZ':\n            return 'muc_elz';\n        case 'MUC GZ':\n            return 'muc_gz';\n        case 'Acrios KWZ':\n            return 'acrios_kwz';\n        case 'Acrios KMZ':            \n            return 'acrios_kmz';\n        case 'Acrios WMZ':            \n            return 'acrios_wmz';                      \n        case 'Acrios ELZ':\n            return 'acrios_elz';\n        case 'Acrios GZ':\n            return 'acrios_gz';    \n        case 'Enginko LW06485_EV':\n            return 'enginko_lw06485_ev';\n        case 'Beckhoff RT':\n            return 'beckhoff_rt';\n        case 'Beckhoff EV':\n            return 'beckhoff_ev';\n        case 'Beckhoff ELZ':\n            return 'beckhoff_elz';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Eastron SDM230':\n            return 'eastron_sdm230';\n        case 'Eastron SDM630':\n            return 'eastron_sdm630';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_full';\n        case 'Zenner Zelsius C5 ISF':\n            return 'zenner_zelsius_C5_isf'; \n        case 'Zenner Minomess A':\n            return 'minomess';\n        case 'Huawei Fusion Solar':\n            return 'pv';\n        case 'Fronius Fusion Solar':\n            return 'pv';\n        default:\n            return 'unknown_type';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "12591466-cb13-8a32-ea68-0fe8f6ae1a1c"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery-level",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2189eb1f-7e2b-dfd4-252f-0ae6cdc82a6c"
              },
              {
                "name": "datapoints-config",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" class=\"add-entity-form\" style=\"width: 350px;\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Device Configuration</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <mat-tab-group>\r\n    <mat-tab label=\"Datapoint Config\">\r\n      <div mat-dialog-content fxLayout=\"column\">\r\n        <form [formGroup]=\"changeDatapointConfigFormGroup\" (ngSubmit)=\"saveDatapointConfig()\">\r\n          <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n            <mat-form-field fxFlex class=\"mat-block\">\r\n              <mat-label>Datapoint</mat-label>\r\n              <mat-select formControlName=\"datapoint\" (selectionChange)=\"onDatapointChange($event.value)\">\r\n                <mat-option *ngFor=\"let attribute of cfgAttributes\" [value]=\"attribute.key\">{{ attribute.key }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('datapoint').hasError('required')\">Datapoint is required</mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n\r\n          <div *ngIf=\"selectedAttribute\">\r\n            <!-- Datapoint Config Fields -->\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('unit').hasError('required')\">Unit is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Archive</mat-label>\r\n             <mat-select formControlName=\"archive\">\r\n                <mat-option [value]=11>11-SmartMeterUni</mat-option>\r\n                <mat-option [value]=21>21-SmartMeasureUni</mat-option>\r\n                <mat-option [value]=31>31-SmartSensorUni</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('archive').hasError('required')\">Archive is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Aggregation</mat-label>\r\n              <mat-select formControlName=\"aggregation\">\r\n                <mat-option [value]=0>0-Sum</mat-option>\r\n                <mat-option [value]=1>1-Average</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('aggregation').hasError('required')\">Aggregation is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Display Name</mat-label>\r\n              <input matInput formControlName=\"displayName\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('displayName').hasError('required')\">Display Name is required</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Scale</mat-label>\r\n              <input matInput formControlName=\"scale\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('scale').hasError('required')\">Scale is required</mat-error>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('scale').hasError('pattern')\">Invalid scale format</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Decimal Points</mat-label>\r\n              <input matInput formControlName=\"decimalPoints\">\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('decimalPoints').hasError('required')\">Decimal Points are required</mat-error>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('decimalPoints').hasError('pattern')\">Decimal Points must be between 0 and 5</mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Active</mat-label>\r\n              <mat-select formControlName=\"active\">\r\n                <mat-option [value]=\"true\">Yes</mat-option>\r\n                <mat-option [value]=\"false\">No</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"changeDatapointConfigFormGroup.get('active').hasError('required')\">Active status is required</mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n\r\n          <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n            <button mat-button color=\"primary\" type=\"button\" [disabled]=\"isLoading$ | async\" (click)=\"cancel()\" cdkFocusInitial>Cancel</button>\r\n            <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || changeDatapointConfigFormGroup.invalid || !changeDatapointConfigFormGroup.dirty\">Save Config</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </mat-tab>\r\n    <mat-tab label=\"Alarm Config\">\r\n  <div mat-dialog-content fxLayout=\"column\" style=\"width: 350px;\">\r\n    <form [formGroup]=\"changeAlarmConfigFormGroup\" (ngSubmit)=\"saveAlarmConfig()\">\r\n      <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\" fxLayoutGap.xs=\"0\">\r\n        <mat-form-field fxFlex class=\"mat-block\">\r\n          <mat-label>Alarm Type</mat-label>\r\n          <mat-select formControlName=\"alarmType\" (selectionChange)=\"onAlarmTypeChange($event.value)\">\r\n            <mat-option *ngFor=\"let alarm of alarms\" [value]=\"alarm.alarmType\">\r\n              {{ alarm.alarmType }} ({{ alarmStatus[alarm.alarmType]?.active ? 'active' : 'inactive' }})\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"changeAlarmConfigFormGroup.get('alarmType').hasError('required')\">Alarm Type is required</mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <!-- Create Rules -->\r\n      <div *ngFor=\"let rule of createRuleFields\">\r\n        <div class=\"severity-text\">{{ rule.name }} Alarm</div>\r\n        <div *ngFor=\"let condition of rule.conditions\">\r\n          <mat-form-field fxFlex class=\"mat-block\">\r\n            <mat-label>{{ condition.label }}</mat-label>\r\n            <input matInput [formControl]=\"condition.control\">\r\n            <span *ngIf=\"condition.duration\" class=\"duration-unit\">{{ condition.duration.unit }}</span>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Clear Rule -->\r\n      <div *ngIf=\"clearRuleFields.length > 0\">\r\n        <div class=\"severity-text\">Clear Rule</div>\r\n        <div *ngFor=\"let condition of clearRuleFields\">\r\n          <mat-form-field fxFlex class=\"mat-block\">\r\n            <mat-label>{{ condition.label }}</mat-label>\r\n            <input matInput [formControl]=\"condition.control\">\r\n            <span *ngIf=\"condition.duration\" class=\"duration-unit\">{{ condition.duration.unit }}</span>\r\n          </mat-form-field>\r\n        </div>\r\n      </div>\r\n\r\n      <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"isLoading$ | async\" (click)=\"cancel()\" cdkFocusInitial>Cancel</button>\r\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"(isLoading$ | async) || changeAlarmConfigFormGroup.invalid || !changeAlarmConfigFormGroup.dirty\">Save Config</button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</mat-tab>\r\n  </mat-tab-group>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet deviceProfileService = $injector.get(widgetContext.servicesMap.get('deviceProfileService'));\r\nlet deviceID = widgetContext.stateController.getStateParams().selectedDevice.entityId.id;\r\nlet cfgAttributes = [];\r\nlet deviceProfileId;\r\nlet alarms = [];\r\nlet attributesList = [];\r\nlet alarmStatus = {};\r\n\r\nattributeService.getEntityAttributes({ entityType: 'DEVICE', id: deviceID }, 'SERVER_SCOPE').subscribe(attributes => {\r\n    attributesList = attributes;\r\n\r\n    deviceService.getDevice(deviceID).subscribe((deviceInfo) => {\r\n        deviceProfileId = deviceInfo.deviceProfileId.id;\r\n        deviceProfileService.getDeviceProfile(deviceProfileId).subscribe((response) => {\r\n            alarms = response.profileData.alarms;\r\n\r\n           \r\n\r\n            // Function to extract source attributes from a condition\r\n            function getSourceAttributesFromCondition(condition) {\r\n                let sourceAttributes = [];\r\n                if (condition.condition && Array.isArray(condition.condition)) {\r\n                    condition.condition.forEach(cond => {\r\n                        if (cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue) {\r\n                            sourceAttributes.push(cond.predicate.value.dynamicValue.sourceAttribute);\r\n                        }\r\n                    });\r\n                }\r\n                if (condition.spec && condition.spec.predicate && condition.spec.predicate.dynamicValue) {\r\n                    sourceAttributes.push(condition.spec.predicate.dynamicValue.sourceAttribute);\r\n                }\r\n                return sourceAttributes;\r\n            }\r\n\r\n            // Loop through each alarm to check for sourceAttributes\r\n            alarms.forEach(alarm => {\r\n                let sourceAttributes = [];\r\n\r\n                // Initialize alarmType status\r\n                if (!alarmStatus[alarm.alarmType]) {\r\n                    alarmStatus[alarm.alarmType] = { active: true };\r\n                }\r\n\r\n                // Check createRules\r\n                Object.keys(alarm.createRules).forEach(ruleKey => {\r\n                    const rule = alarm.createRules[ruleKey];\r\n                    if (rule.condition) {\r\n                        sourceAttributes = sourceAttributes.concat(getSourceAttributesFromCondition(rule.condition));\r\n                    }\r\n                });\r\n\r\n                // Check clearRule\r\n                if (alarm.clearRule && alarm.clearRule.condition) {\r\n                    sourceAttributes = sourceAttributes.concat(getSourceAttributesFromCondition(alarm.clearRule.condition));\r\n                }\r\n\r\n                // Check if each sourceAttribute is in attributesList\r\n                sourceAttributes.forEach(sourceAttribute => {\r\n                    const attributeExists = attributesList.some(attribute => attribute.key === sourceAttribute);\r\n                    if (!attributeExists) {\r\n                        console.warn(`Source attribute ${sourceAttribute} for alarm ${alarm.alarmType} not found in attributes list.`);\r\n                        // Set the active flag to false if any source attribute is missing\r\n                        alarmStatus[alarm.alarmType].active = false;\r\n                    }\r\n                });\r\n            });\r\n\r\n            //widgetContext.dialogs.alert(JSON.stringify(alarmStatus));\r\n\r\n            attributeService.getEntityAttributes({ entityType: 'DEVICE', id: deviceID }, 'SERVER_SCOPE').subscribe(attributes => {\r\n                cfgAttributes = attributes.filter(attribute => attribute.key.startsWith('cfg_') && attribute.key !== 'cfg_activeDatapoints');\r\n                openChangeConfigForm();\r\n            });\r\n        });\r\n    });\r\n});\r\n\r\n\r\nfunction openChangeConfigForm() {\r\n    customDialog.customDialog(htmlTemplate, changeConfigForm).subscribe();\r\n}\r\n\r\nfunction changeConfigForm(instance) {\r\n    let vm = instance;\r\n    vm.cfgAttributes = cfgAttributes;\r\n    vm.alarms = alarms;\r\n    vm.selectedAttribute = null;\r\n    vm.createRuleFields = [];\r\n    vm.clearRuleFields = [];\r\n    vm.alarmStatus = alarmStatus;  // Pass the alarmStatus to the instance\r\n    // Initialize the form group with default values from attributesList\r\n    vm.changeDatapointConfigFormGroup = vm.fb.group({\r\n        datapoint: ['', [vm.validators.required]],\r\n        unit: ['', [vm.validators.required]],\r\n        archive: ['', [vm.validators.required]],\r\n        aggregation: [0, [vm.validators.required]], // Initialize with default value\r\n        displayName: ['', [vm.validators.required]],\r\n        scale: ['', [vm.validators.required, vm.validators.pattern('^[0-9]+(\\\\.[0-9]+)?$')]],\r\n        decimalPoints: ['', [vm.validators.required, vm.validators.pattern('[0-5]'), vm.validators.maxLength(1)]],\r\n        active: ['', [vm.validators.required]]\r\n    });\r\n\r\n    vm.changeAlarmConfigFormGroup = vm.fb.group({\r\n        alarmType: ['', [vm.validators.required]]\r\n    });\r\n\r\n    vm.changeAlarmConfigFormGroup.valueChanges.subscribe(change => {\r\n        console.log('changeAlarmConfigFormGroup changed:', change);\r\n    });\r\n\r\n    vm.onDatapointChange = function (selectedKey) {\r\n        let selected = vm.cfgAttributes.find(attr => attr.key === selectedKey);\r\n        vm.selectedAttribute = selected ? selected.value : null;\r\n        if (selected) {\r\n            vm.changeDatapointConfigFormGroup.patchValue({\r\n                unit: selected.value.unit || '',\r\n                archive: selected.value.archive || '',\r\n                aggregation: selected.value.aggregation !== undefined ? selected.value.aggregation : 0, // Handle undefined case\r\n                displayName: selected.value.displayName || '',\r\n                scale: selected.value.scale || '',\r\n                decimalPoints: selected.value.decimalPoints || '',\r\n                active: selected.value.active !== undefined ? selected.value.active : ''\r\n            });\r\n        } else {\r\n            vm.changeDatapointConfigFormGroup.patchValue({\r\n                unit: '',\r\n                archive: '',\r\n                aggregation: 0, // Default value\r\n                displayName: '',\r\n                scale: '',\r\n                decimalPoints: '',\r\n                active: ''\r\n            });\r\n        }\r\n    };\r\n\r\n    vm.onAlarmTypeChange = function (selectedType) {\r\n        let selectedAlarm = vm.alarms.find(alarm => alarm.alarmType === selectedType);\r\n\r\n        // Clear previous controls from form group\r\n        Object.keys(vm.changeAlarmConfigFormGroup.controls).forEach(control => {\r\n            if (control !== 'alarmType') {\r\n                vm.changeAlarmConfigFormGroup.removeControl(control);\r\n            }\r\n        });\r\n\r\n        if (selectedAlarm) {\r\n            vm.createRuleFields = [];\r\n            vm.clearRuleFields = [];\r\n\r\n            let addedControls = new Set();\r\n\r\n            // Process createRules\r\n            Object.keys(selectedAlarm.createRules).forEach(ruleName => {\r\n                let rule = selectedAlarm.createRules[ruleName];\r\n                let conditions = [];\r\n\r\n                rule.condition.condition.forEach(cond => {\r\n                    if (cond.key && cond.key.key) {\r\n                        let sourceAttribute = cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue && cond.predicate.value.dynamicValue.sourceAttribute;\r\n                        if (sourceAttribute) {\r\n                            let defaultValue = attributesList.find(attr => attr.key === sourceAttribute)?.value || '';\r\n                            if (!addedControls.has(sourceAttribute)) {\r\n                                let formControl = vm.fb.control(defaultValue, vm.validators.required);\r\n                                conditions.push({\r\n                                    label: sourceAttribute,\r\n                                    control: formControl\r\n                                });\r\n                                vm.changeAlarmConfigFormGroup.addControl(sourceAttribute, formControl);\r\n                                addedControls.add(sourceAttribute);\r\n                                formControl.valueChanges.subscribe(change => {\r\n                                    console.log(`Form control ${sourceAttribute} changed:`, change);\r\n                                    vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                                });\r\n                            }\r\n                        } else if (cond.predicate.value && cond.predicate.value.defaultValue) {\r\n                            let defaultValue = cond.predicate.value.defaultValue;\r\n                            conditions.push({\r\n                                label: cond.key.key,\r\n                                control: vm.fb.control({ value: defaultValue, disabled: true })\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (rule.condition.spec && rule.condition.spec.type === \"DURATION\") {\r\n                    let durationPredicate = rule.condition.spec.predicate;\r\n                    let durationSourceAttribute = durationPredicate && durationPredicate.dynamicValue && durationPredicate.dynamicValue.sourceAttribute;\r\n                    let durationControlName = durationPredicate && durationPredicate.dynamicValue ? durationPredicate.dynamicValue.sourceAttribute : rule.condition.spec.defaultSourceAttribute;\r\n                    if (durationControlName) {\r\n                        let durationDefaultValue = attributesList.find(attr => attr.key === durationControlName)?.value || '';\r\n                        if (!addedControls.has(durationControlName)) {\r\n                            let durationControl = vm.fb.control(durationDefaultValue, vm.validators.required);\r\n                            conditions.push({\r\n                                label: durationControlName,\r\n                                control: durationControl,\r\n                                duration: {\r\n                                    control: durationControl,\r\n                                    unit: rule.condition.spec.unit || 'MINUTES'\r\n                                }\r\n                            });\r\n                            console.log(`Creating form control for duration: ${durationControlName}`);\r\n                            vm.changeAlarmConfigFormGroup.addControl(durationControlName, durationControl);\r\n                            addedControls.add(durationControlName);\r\n                            durationControl.valueChanges.subscribe(change => {\r\n                                console.log(`Duration control ${durationControlName} changed:`, change);\r\n                                vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                            });\r\n                        }\r\n                    } else if (rule.condition.spec.defaultSourceAttribute) {\r\n                        let durationDefaultValue = rule.condition.spec.defaultSourceAttribute;\r\n                        conditions.push({\r\n                            label: durationDefaultValue,\r\n                            control: vm.fb.control({ value: durationDefaultValue, disabled: true })\r\n                        });\r\n                    }\r\n                }\r\n                vm.createRuleFields.push({\r\n                    name: ruleName,\r\n                    conditions: conditions\r\n                });\r\n            });\r\n\r\n            // Process clearRule\r\n            let clearConditions = [];\r\n\r\n            selectedAlarm.clearRule.condition.condition.forEach(cond => {\r\n                if (cond.key && cond.key.key) {\r\n                    let sourceAttribute = cond.predicate && cond.predicate.value && cond.predicate.value.dynamicValue && cond.predicate.value.dynamicValue.sourceAttribute;\r\n                    if (sourceAttribute) {\r\n                        let clearDefaultValue = attributesList.find(attr => attr.key === sourceAttribute)?.value || '';\r\n                        if (!addedControls.has(sourceAttribute)) {\r\n                            let formControl = vm.fb.control(clearDefaultValue, vm.validators.required);\r\n                            clearConditions.push({\r\n                                label: sourceAttribute,\r\n                                control: formControl\r\n                            });\r\n                            console.log(`Creating form control for clearRule sourceAttribute: ${sourceAttribute}`);\r\n                            vm.changeAlarmConfigFormGroup.addControl(sourceAttribute, formControl);\r\n                            addedControls.add(sourceAttribute);\r\n                            formControl.valueChanges.subscribe(change => {\r\n                                console.log(`Form control ${sourceAttribute} changed:`, change);\r\n                                vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                            });\r\n                        }\r\n                    } else if (cond.predicate.value && cond.predicate.value.defaultValue) {\r\n                        let clearDefaultValue = cond.predicate.value.defaultValue;\r\n                        clearConditions.push({\r\n                            label: cond.key.key,\r\n                            control: vm.fb.control({ value: clearDefaultValue, disabled: true })\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (selectedAlarm.clearRule.condition.spec && selectedAlarm.clearRule.condition.spec.type === \"DURATION\") {\r\n                let durationPredicate = selectedAlarm.clearRule.condition.spec.predicate;\r\n                let durationSourceAttribute = durationPredicate && durationPredicate.dynamicValue && durationPredicate.dynamicValue.sourceAttribute;\r\n                let durationControlName = durationPredicate && durationPredicate.dynamicValue ? durationPredicate.dynamicValue.sourceAttribute : selectedAlarm.clearRule.condition.spec.defaultSourceAttribute;\r\n                if (durationControlName) {\r\n                    let clearDurationDefaultValue = attributesList.find(attr => attr.key === durationControlName)?.value || '';\r\n                    if (!addedControls.has(durationControlName)) {\r\n                        let durationControl = vm.fb.control(clearDurationDefaultValue, vm.validators.required);\r\n                        clearConditions.push({\r\n                            label: durationControlName,\r\n                            control: durationControl,\r\n                            duration: {\r\n                                control: durationControl,\r\n                                unit: selectedAlarm.clearRule.condition.spec.unit || 'MINUTES'\r\n                            }\r\n                        });\r\n                        console.log(`Creating form control for clearRule duration: ${durationControlName}`);\r\n                        vm.changeAlarmConfigFormGroup.addControl(durationControlName, durationControl);\r\n                        addedControls.add(durationControlName);\r\n                        durationControl.valueChanges.subscribe(change => {\r\n                            console.log(`ClearRule Duration control ${durationControlName} changed:`, change);\r\n                            vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid; // Update save button state\r\n                        });\r\n                    }\r\n                } else if (selectedAlarm.clearRule.condition.spec.defaultSourceAttribute) {\r\n                    let clearDurationDefaultValue = selectedAlarm.clearRule.condition.spec.defaultSourceAttribute;\r\n                    clearConditions.push({\r\n                        label: clearDurationDefaultValue,\r\n                        control: vm.fb.control({ value: clearDurationDefaultValue, disabled: true })\r\n                    });\r\n                }\r\n            }\r\n            vm.clearRuleFields = clearConditions;\r\n        } else {\r\n            vm.createRuleFields = [];\r\n            vm.clearRuleFields = [];\r\n            vm.changeAlarmConfigFormGroup.setControl('alarmSources', vm.fb.array([]));\r\n        }\r\n\r\n        // Subscribe to the valueChanges of the entire form to manage the Save button state\r\n        vm.changeAlarmConfigFormGroup.valueChanges.subscribe(() => {\r\n            vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid;\r\n        });\r\n\r\n        // Initialize saveButtonEnabled based on current form validity\r\n        vm.saveButtonEnabled = vm.changeAlarmConfigFormGroup.valid;\r\n    };\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.saveDatapointConfig = function () {\r\n        const formValues = vm.changeDatapointConfigFormGroup.value;\r\n        const attributeValue = {\r\n            unit: formValues.unit,\r\n            archive: formValues.archive,\r\n            aggregation: formValues.aggregation,\r\n            displayName: formValues.displayName,\r\n            scale: formValues.scale,\r\n            decimalPoints: formValues.decimalPoints,\r\n            active: formValues.active\r\n        };\r\n        attributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            [{\r\n                key: formValues.datapoint,\r\n                value: attributeValue\r\n            }]\r\n        ).subscribe(\r\n            () => {\r\n                console.log('Datapoint config saved successfully.');\r\n                vm.dialogRef.close(null);\r\n            },\r\n            error => {\r\n                console.error('Failed to save datapoint config:', error);\r\n            }\r\n        );\r\n    };\r\n\r\n    vm.saveAlarmConfig = function () {\r\n        const formValues = vm.changeAlarmConfigFormGroup.value;\r\n        let alarmConfigList = [];\r\n\r\n        // Process createRules\r\n        vm.createRuleFields.forEach(rule => {\r\n            rule.conditions.forEach(condition => {\r\n                if (condition.control) {\r\n                    let value = formValues[condition.label] || null;\r\n                    alarmConfigList.push({\r\n                        key: condition.label,\r\n                        value: value\r\n                    });\r\n\r\n                    if (condition.duration) {\r\n                        let durationValue = formValues[condition.duration.control.name] || null;\r\n                        alarmConfigList.push({\r\n                            key: condition.duration.control.name,\r\n                            value: durationValue\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        // Process clearRule\r\n        vm.clearRuleFields.forEach(condition => {\r\n            if (condition.control) {\r\n                let value = formValues[condition.label] || null;\r\n                alarmConfigList.push({\r\n                    key: condition.label,\r\n                    value: value\r\n                });\r\n\r\n                if (condition.duration) {\r\n                    let durationValue = formValues[condition.duration.control.name] || null;\r\n                    alarmConfigList.push({\r\n                        key: condition.duration.control.name,\r\n                        value: durationValue\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        attributeService.saveEntityAttributes(\r\n            { entityType: 'DEVICE', id: deviceID },\r\n            'SERVER_SCOPE',\r\n            alarmConfigList\r\n        ).subscribe(\r\n            response => {\r\n                console.log('Alarm config saved successfully:', response);\r\n                vm.dialogRef.close(null);\r\n            },\r\n            error => {\r\n                widgetContext.dialogs.alert('Failed to save alarm config:', JSON.stringify(error));\r\n                console.error('Failed to save alarm config:', error);\r\n            }\r\n        );\r\n    };\r\n}\r\n\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5f4009b7-f9da-9c30-568d-46cb3185d82b"
              },
              {
                "name": "device-management",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "function openDeviceManagement() {\r\n  const id = entityId?.id;\r\n  if (!id) {\r\n    console.warn('No entityId found!');\r\n    return;\r\n  }\r\n\r\n  const url = `https://cloud.pke-iot.expert/entities/devices/all/${id}`;\r\n  window.open(url, '_blank', 'noopener,noreferrer');\r\n}\r\n\r\nopenDeviceManagement();",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "be8286ca-7714-e447-6087-7557cf2ab664"
              },
              {
                "name": "sim-menu",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "SIM Menu",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "380px",
                "popoverHeight": "375px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "c0969926-8076-b422-4d0e-d590ecc2491e"
              },
              {
                "name": "rssi-widget",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "rssi_widget",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "300px",
                "popoverHeight": "150px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "4ae94c03-cbd9-7a4a-8428-604eb636ce43"
              },
              {
                "name": "snr-widget",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "snr_widget",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "300px",
                "popoverHeight": "150px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "f9c6a348-9996-2eff-af31-b788df5c0c31"
              },
              {
                "name": "detailed-data-dashboard",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let params = widgetContext.stateController.getStateParams();\n\n//params['selectedDevice'];\nwidgetContext.updateAliases();\nwidgetContext.stateController.openState('data_dashboard', params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "157474db-8ba0-c6c2-4308-6da392bf94bb"
              }
            ],
            "headerButton": [
              {
                "name": "Devices",
                "buttonType": "flat",
                "showIcon": true,
                "icon": "devices_other",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openURL",
                "openNewBrowserTab": true,
                "url": "https://cloud.pke-iot.expert/entities/devices/all",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "05d82221-07cc-6709-2a32-0a96d9b1ea75"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "20px"
        },
        "row": 0,
        "col": 0,
        "id": "f4bffa7d-f9c6-30c9-afeb-230ef7bd71a4"
      },
      "437d1800-b90b-9e23-4bf4-07e0b5e3a6e7": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 31536000000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableFilter": true,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "-startTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "0df9b9bb-709d-8e9f-8000-1d0a84f0694b",
            "dataKeys": [
              {
                "name": "startTime",
                "type": "alarm",
                "label": "{i18n:alarm.start-time}",
                "color": "#2196f3",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "5%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var date = new Date(value); // value = 1761126400810\r\n\r\nvar dd   = String(date.getDate()).padStart(2, '0');\r\nvar mm   = String(date.getMonth() + 1).padStart(2, '0');\r\nvar yy   = String(date.getFullYear()).slice(-2);\r\n\r\nvar hh   = String(date.getHours()).padStart(2, '0');\r\nvar min  = String(date.getMinutes()).padStart(2, '0');\r\nvar ss   = String(date.getSeconds()).padStart(2, '0');\r\n\r\nvar formatted = dd + '/' + mm + '/' + yy + '<br>' + hh + ':' + min + ':' + ss;\r\n\r\nreturn formatted;\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.021092237451093787,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "40%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.2780007688856758,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var type = alarm.type || '';\r\nvar severity = alarm.severity;\r\n\r\nvar color;\r\nvar bgColor;\r\n\r\nswitch (severity) {\r\n  case 'CRITICAL':\r\n    color = '#FF0000';\r\n    bgColor = 'rgba(255, 0, 0, 0.1)';\r\n    break;\r\n  case 'MAJOR':\r\n    color = '#FF8C00';\r\n    bgColor = 'rgba(255, 140, 0, 0.1)';\r\n    break;\r\n  case 'MINOR':\r\n    color = '#FFD700';\r\n    bgColor = 'rgba(255, 215, 0, 0.1)';\r\n    break;\r\n  default:\r\n    color = '#666666'; // fallback for unknown severities\r\n    bgColor = 'rgba(0, 0, 0, 0.05)';\r\n}\r\n\r\nreturn (\r\n  '<div class=\"typeIcon\"' +\r\n  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;' +\r\n  ' padding:4px 8px; border-radius:8px; line-height:20px;' +\r\n  ' font-size:14px; font-weight:500; letter-spacing:0.25px;' +\r\n  ' color:' + color + '; background-color:' + bgColor + ';\">' +\r\n  '<span class=\"material-icons\" style=\"font-size:20px; vertical-align:middle;\"></span>' +\r\n  type +\r\n  '</div>'\r\n);\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.7323586880398418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "hidden",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.alarm-status}",
                "color": "#607d8b",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.6588418951443418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "{i18n:alarm.assigned}",
                "color": "#9c27b0",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "15%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.5008441077416634,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": true,
          "titleIcon": "warning",
          "iconColor": null,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {
            "headerButton": [
              {
                "name": "Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "warning",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "75f33890-1b6b-11f0-be11-edd54271a72a",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b0afe3a6-4db7-4798-f1bb-1f508d441f73"
              }
            ]
          },
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "437d1800-b90b-9e23-4bf4-07e0b5e3a6e7"
      },
      "80ae2be3-a5ef-8754-0239-7b2dea617c6c": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 31536000000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableFilter": true,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "-startTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "d448bf9d-472d-50c0-673d-d6ef75ccd28f",
            "dataKeys": [
              {
                "name": "startTime",
                "type": "alarm",
                "label": "{i18n:alarm.start-time}",
                "color": "#2196f3",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "5%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var date = new Date(value); // value = 1761126400810\r\n\r\nvar dd   = String(date.getDate()).padStart(2, '0');\r\nvar mm   = String(date.getMonth() + 1).padStart(2, '0');\r\nvar yy   = String(date.getFullYear()).slice(-2);\r\n\r\nvar hh   = String(date.getHours()).padStart(2, '0');\r\nvar min  = String(date.getMinutes()).padStart(2, '0');\r\nvar ss   = String(date.getSeconds()).padStart(2, '0');\r\n\r\nvar formatted = dd + '/' + mm + '/' + yy + '<br>' + hh + ':' + min + ':' + ss;\r\n\r\nreturn formatted;\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.021092237451093787,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "40%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.2780007688856758,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var type = alarm.type || '';\r\nvar severity = alarm.severity;\r\n\r\nvar color;\r\nvar bgColor;\r\n\r\nswitch (severity) {\r\n  case 'CRITICAL':\r\n    color = '#FF0000';\r\n    bgColor = 'rgba(255, 0, 0, 0.1)';\r\n    break;\r\n  case 'MAJOR':\r\n    color = '#FF8C00';\r\n    bgColor = 'rgba(255, 140, 0, 0.1)';\r\n    break;\r\n  case 'MINOR':\r\n    color = '#FFD700';\r\n    bgColor = 'rgba(255, 215, 0, 0.1)';\r\n    break;\r\n  default:\r\n    color = '#666666'; // fallback for unknown severities\r\n    bgColor = 'rgba(0, 0, 0, 0.05)';\r\n}\r\n\r\nreturn (\r\n  '<div class=\"typeIcon\"' +\r\n  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;' +\r\n  ' padding:4px 8px; border-radius:8px; line-height:20px;' +\r\n  ' font-size:14px; font-weight:500; letter-spacing:0.25px;' +\r\n  ' color:' + color + '; background-color:' + bgColor + ';\">' +\r\n  '<span class=\"material-icons\" style=\"font-size:20px; vertical-align:middle;\"></span>' +\r\n  type +\r\n  '</div>'\r\n);\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.7323586880398418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "hidden",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.alarm-status}",
                "color": "#607d8b",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.6588418951443418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "{i18n:alarm.assigned}",
                "color": "#9c27b0",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "15%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.5008441077416634,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": true,
          "titleIcon": "warning",
          "iconColor": null,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {
            "headerButton": [
              {
                "name": "Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "warning",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "75f33890-1b6b-11f0-be11-edd54271a72a",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b0afe3a6-4db7-4798-f1bb-1f508d441f73"
              }
            ]
          },
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "CRITICAL",
              "MAJOR",
              "MINOR"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "80ae2be3-a5ef-8754-0239-7b2dea617c6c"
      },
      "21193f7b-e61b-e7af-361c-81f01c9cfc66": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1749125522312,
                "endTimeMs": 1749211922312
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": true,
            "entitiesTitle": null,
            "alarmsTitle": "Alarms"
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "5b0de159-a631-e2d6-c153-a4c3b5dc60e4",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "{i18n:alarm.created-time}",
                "color": "#2196f3",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "5%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var date = new Date(value); // value = 1761126400810\r\n\r\nvar dd   = String(date.getDate()).padStart(2, '0');\r\nvar mm   = String(date.getMonth() + 1).padStart(2, '0');\r\nvar yy   = String(date.getFullYear()).slice(-2);\r\n\r\nvar hh   = String(date.getHours()).padStart(2, '0');\r\nvar min  = String(date.getMinutes()).padStart(2, '0');\r\nvar ss   = String(date.getSeconds()).padStart(2, '0');\r\n\r\nvar formatted = dd + '/' + mm + '/' + yy + '<br>' + hh + ':' + min + ':' + ss;\r\n\r\nreturn formatted;\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.021092237451093787,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "40%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.2780007688856758,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var type = alarm.type || '';\r\nvar severity = alarm.severity;\r\n\r\nvar color;\r\nvar bgColor;\r\n\r\nswitch (severity) {\r\n  case 'CRITICAL':\r\n    color = '#FF0000';\r\n    bgColor = 'rgba(255, 0, 0, 0.1)';\r\n    break;\r\n  case 'MAJOR':\r\n    color = '#FF8C00';\r\n    bgColor = 'rgba(255, 140, 0, 0.1)';\r\n    break;\r\n  case 'MINOR':\r\n    color = '#FFD700';\r\n    bgColor = 'rgba(255, 215, 0, 0.1)';\r\n    break;\r\n  default:\r\n    color = '#666666'; // fallback for unknown severities\r\n    bgColor = 'rgba(0, 0, 0, 0.05)';\r\n}\r\n\r\nreturn (\r\n  '<div class=\"typeIcon\"' +\r\n  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;' +\r\n  ' padding:4px 8px; border-radius:8px; line-height:20px;' +\r\n  ' font-size:14px; font-weight:500; letter-spacing:0.25px;' +\r\n  ' color:' + color + '; background-color:' + bgColor + ';\">' +\r\n  '<span class=\"material-icons\" style=\"font-size:20px; vertical-align:middle;\"></span>' +\r\n  type +\r\n  '</div>'\r\n);\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.7323586880398418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "hidden",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.alarm-status}",
                "color": "#607d8b",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.6588418951443418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "{i18n:alarm.assigned}",
                "color": "#9c27b0",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "15%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.5008441077416634,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": true,
          "titleIcon": "warning",
          "iconColor": null,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {
            "headerButton": [
              {
                "name": "Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "warning",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "75f33890-1b6b-11f0-be11-edd54271a72a",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b0afe3a6-4db7-4798-f1bb-1f508d441f73"
              }
            ]
          },
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "CRITICAL"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "21193f7b-e61b-e7af-361c-81f01c9cfc66"
      },
      "7afd26ac-3394-1d01-a567-ca00a07e1e79": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1749125522312,
                "endTimeMs": 1749211922312
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": true,
            "entitiesTitle": null,
            "alarmsTitle": "Alarms"
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "5b0de159-a631-e2d6-c153-a4c3b5dc60e4",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "{i18n:alarm.created-time}",
                "color": "#2196f3",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "5%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var date = new Date(value); // value = 1761126400810\r\n\r\nvar dd   = String(date.getDate()).padStart(2, '0');\r\nvar mm   = String(date.getMonth() + 1).padStart(2, '0');\r\nvar yy   = String(date.getFullYear()).slice(-2);\r\n\r\nvar hh   = String(date.getHours()).padStart(2, '0');\r\nvar min  = String(date.getMinutes()).padStart(2, '0');\r\nvar ss   = String(date.getSeconds()).padStart(2, '0');\r\n\r\nvar formatted = dd + '/' + mm + '/' + yy + '<br>' + hh + ':' + min + ':' + ss;\r\n\r\nreturn formatted;\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.021092237451093787,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "40%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.2780007688856758,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var type = alarm.type || '';\r\nvar severity = alarm.severity;\r\n\r\nvar color;\r\nvar bgColor;\r\n\r\nswitch (severity) {\r\n  case 'CRITICAL':\r\n    color = '#FF0000';\r\n    bgColor = 'rgba(255, 0, 0, 0.1)';\r\n    break;\r\n  case 'MAJOR':\r\n    color = '#FF8C00';\r\n    bgColor = 'rgba(255, 140, 0, 0.1)';\r\n    break;\r\n  case 'MINOR':\r\n    color = '#FFD700';\r\n    bgColor = 'rgba(255, 215, 0, 0.1)';\r\n    break;\r\n  default:\r\n    color = '#666666'; // fallback for unknown severities\r\n    bgColor = 'rgba(0, 0, 0, 0.05)';\r\n}\r\n\r\nreturn (\r\n  '<div class=\"typeIcon\"' +\r\n  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;' +\r\n  ' padding:4px 8px; border-radius:8px; line-height:20px;' +\r\n  ' font-size:14px; font-weight:500; letter-spacing:0.25px;' +\r\n  ' color:' + color + '; background-color:' + bgColor + ';\">' +\r\n  '<span class=\"material-icons\" style=\"font-size:20px; vertical-align:middle;\"></span>' +\r\n  type +\r\n  '</div>'\r\n);\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.7323586880398418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "hidden",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.alarm-status}",
                "color": "#607d8b",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.6588418951443418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "{i18n:alarm.assigned}",
                "color": "#9c27b0",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "15%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.5008441077416634,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": true,
          "titleIcon": "warning",
          "iconColor": null,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {
            "headerButton": [
              {
                "name": "Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "warning",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "75f33890-1b6b-11f0-be11-edd54271a72a",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b0afe3a6-4db7-4798-f1bb-1f508d441f73"
              }
            ]
          },
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "MAJOR"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "7afd26ac-3394-1d01-a567-ca00a07e1e79"
      },
      "a77dbbae-8612-8d1d-6a69-c7ead4462e73": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1749125522312,
                "endTimeMs": 1749211922312
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": true,
            "entitiesTitle": null,
            "alarmsTitle": "Alarms"
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "5b0de159-a631-e2d6-c153-a4c3b5dc60e4",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "{i18n:alarm.created-time}",
                "color": "#2196f3",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "5%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var date = new Date(value); // value = 1761126400810\r\n\r\nvar dd   = String(date.getDate()).padStart(2, '0');\r\nvar mm   = String(date.getMonth() + 1).padStart(2, '0');\r\nvar yy   = String(date.getFullYear()).slice(-2);\r\n\r\nvar hh   = String(date.getHours()).padStart(2, '0');\r\nvar min  = String(date.getMinutes()).padStart(2, '0');\r\nvar ss   = String(date.getSeconds()).padStart(2, '0');\r\n\r\nvar formatted = dd + '/' + mm + '/' + yy + '<br>' + hh + ':' + min + ':' + ss;\r\n\r\nreturn formatted;\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.021092237451093787,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "40%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.2780007688856758,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": true,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "var type = alarm.type || '';\r\nvar severity = alarm.severity;\r\n\r\nvar color;\r\nvar bgColor;\r\n\r\nswitch (severity) {\r\n  case 'CRITICAL':\r\n    color = '#FF0000';\r\n    bgColor = 'rgba(255, 0, 0, 0.1)';\r\n    break;\r\n  case 'MAJOR':\r\n    color = '#FF8C00';\r\n    bgColor = 'rgba(255, 140, 0, 0.1)';\r\n    break;\r\n  case 'MINOR':\r\n    color = '#FFD700';\r\n    bgColor = 'rgba(255, 215, 0, 0.1)';\r\n    break;\r\n  default:\r\n    color = '#666666'; // fallback for unknown severities\r\n    bgColor = 'rgba(0, 0, 0, 0.05)';\r\n}\r\n\r\nreturn (\r\n  '<div class=\"typeIcon\"' +\r\n  ' style=\"width:fit-content; display:flex; align-items:center; gap:6px;' +\r\n  ' padding:4px 8px; border-radius:8px; line-height:20px;' +\r\n  ' font-size:14px; font-weight:500; letter-spacing:0.25px;' +\r\n  ' color:' + color + '; background-color:' + bgColor + ';\">' +\r\n  '<span class=\"material-icons\" style=\"font-size:20px; vertical-align:middle;\"></span>' +\r\n  type +\r\n  '</div>'\r\n);\r\n",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.7323586880398418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "hidden",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.alarm-status}",
                "color": "#607d8b",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "20%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.6588418951443418,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "{i18n:alarm.assigned}",
                "color": "#9c27b0",
                "settings": {
                  "customTitle": "",
                  "columnWidth": "15%",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "useCellContentFunctionOnExport": true,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible",
                  "disableSorting": false
                },
                "_hash": 0.5008441077416634,
                "funcBody": null,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": true,
          "titleIcon": "warning",
          "iconColor": null,
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {
            "headerButton": [
              {
                "name": "Dashboard",
                "buttonType": "flat",
                "showIcon": false,
                "icon": "warning",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {
                  "border-radius": "999px"
                },
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": true,
                "targetDashboardId": "75f33890-1b6b-11f0-be11-edd54271a72a",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b0afe3a6-4db7-4798-f1bb-1f508d441f73"
              }
            ]
          },
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "MINOR"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "a77dbbae-8612-8d1d-6a69-c7ead4462e73"
      }
    },
    "states": {
      "Customer Attributes": {
        "name": "${entityLabel}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "af25b50d-3ba5-4adf-65ad-f955a8a54111": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Location Attributes": {
        "name": "${entityLabel}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ca3c9991-7d3d-76a4-4ed0-4bccf109076c": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Device Header": {
        "name": "${entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "af648660-82b1-7785-e56f-5d9ab107a043": {
                "sizeX": 24,
                "sizeY": 3,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Device Header Dashboard": {
        "name": "Device Header Dashboard",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "082945e5-d522-45e0-07c6-e3c6bdc557ec": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Device Attributes LoRaWAN": {
        "name": "${entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "c398e8a1-0343-c067-947c-f7c6ae40cdb4": {
                "sizeX": 24,
                "sizeY": 18,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Device Credentials": {
        "name": "${entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "8b6cf0f7-1b42-c2f6-07ef-46ec9808f597": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Device Data": {
        "name": "Device Data",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "1d2b8d63-39b8-d2c0-1a37-e8fc7dc23353": {
                "sizeX": 26,
                "sizeY": 13,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Service Attribute": {
        "name": "${entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6ef3c5d8-20a5-10ec-fedf-0d0bfd021aa5": {
                "sizeX": 24,
                "sizeY": 1,
                "resizable": true,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FAFAFA",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "SIM Data Usage": {
        "name": "SIM Data Usage",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "00dd510f-1508-1302-2609-99b23d7a1477": {
                "sizeX": 24,
                "sizeY": 3,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "SIM Menu": {
        "name": "SIM Menu",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "60d322ca-a6d3-24c1-86ac-0b012662d778": {
                "sizeX": 24,
                "sizeY": 8,
                "preserveAspectRatio": false,
                "resizable": true,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_chart": {
        "name": "Chart",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "12302e54-bb40-6438-ac8c-cb97bf6f1d1b": {
                "sizeX": 24,
                "sizeY": 19,
                "resizable": true,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_raw": {
        "name": "Raw",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ca6dac05-ea13-1264-3989-c172a8332167": {
                "sizeX": 26,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_state_chart_trapState": {
        "name": "Time series state chart ",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "35af56ba-0d6b-16a3-d2c4-c3806183f826": {
                "sizeX": 24,
                "sizeY": 12,
                "mobileHeight": null,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_state_chart_output1": {
        "name": "Time series state chart ",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f16b624c-d898-07a0-76a3-748cd985a72f": {
                "sizeX": 24,
                "sizeY": 12,
                "mobileHeight": null,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_state_chart_tamperStatus": {
        "name": "Time series state chart ",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4767060e-eda8-0ab2-443e-c4fb99edbda8": {
                "sizeX": 24,
                "sizeY": 12,
                "mobileHeight": null,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_state_chart_magnetStatus": {
        "name": "Time series state chart ",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7d7cf959-25a9-a557-0b5f-60530f21ae47": {
                "sizeX": 24,
                "sizeY": 12,
                "mobileHeight": null,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_state_chart_position": {
        "name": "Time series state chart ",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "3f106d48-fec3-51c2-886b-d934a76dbbe7": {
                "sizeX": 24,
                "sizeY": 12,
                "mobileHeight": null,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_state_chart_operatingStatus": {
        "name": "Time series state chart ",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6c036989-6331-91b7-e5f4-68d52a3f98e2": {
                "sizeX": 24,
                "sizeY": 12,
                "mobileHeight": null,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "ts_state_chart_leakageStatus": {
        "name": "Time series state chart ",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2017ae6d-c56c-720a-d4fa-afc09444f26e": {
                "sizeX": 24,
                "sizeY": 12,
                "mobileHeight": null,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Home Dashboard Widgets": {
        "name": "Home Dashboard Widgets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "292acb9f-d7c9-c75c-34b5-2803e6cdf30e": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Home": {
        "name": "EM",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "3129dfb9-e858-a56f-349e-89db306a65a8": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#E0E0E0",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Locations Widgets": {
        "name": "Locations Widgets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "593c9923-4417-a309-c857-d3d1aa863653": {
                "sizeX": 10,
                "sizeY": 11,
                "row": 0,
                "col": 14
              },
              "507dbe87-a5d9-1deb-b009-743fabb573dc": {
                "sizeX": 14,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#E0E0E0",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Locations": {
        "name": "Locations",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4c4c16bd-b345-80ec-2c6e-f64abf64c611": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#E0E0E0",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Locations Card": {
        "name": "Locations",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "176fbb8f-6463-2365-df92-c0020ebba277": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Warehouses Card": {
        "name": "Warehouses",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f7e39953-8e8c-5b27-e7b4-caf73e5f325c": {
                "sizeX": 25,
                "sizeY": 10,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Customers Card": {
        "name": "Customers",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f94afe58-8ca1-8b65-981d-f99db18957ae": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Alarms Card": {
        "name": "Alarms",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "8c148321-ac09-da0f-ff74-cea71787d0cb": {
                "sizeX": 25,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Devices": {
        "name": "Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4ef0f252-9c28-33d4-7f08-5ccc56be1b80": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#E0E0E0",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Devices Widgets": {
        "name": "Devices Widgets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "c26723ce-f68c-b0cf-d010-c3bfd5bd7b3f": {
                "sizeX": 10,
                "sizeY": 14,
                "row": 0,
                "col": 14
              },
              "094be4c3-bfea-7cbd-b7a4-17c8f99b0b54": {
                "sizeX": 14,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#E0E0E0",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Device Attributes Tab": {
        "name": "Device Attributes Tab",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "c041f263-bbb2-823f-99b0-7d89ba3d3754": {
                "sizeX": 24,
                "sizeY": 5,
                "row": 13,
                "col": 0,
                "resizable": true,
                "desktopHide": true
              },
              "5b8e06cf-4c8f-a57b-ce35-78e30a417916": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 8,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Device Configuration Tab": {
        "name": "Device Configuration Tab",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0d288b70-1157-70e5-088c-b59978a4781e": {
                "sizeX": 26,
                "sizeY": 12,
                "row": 0,
                "col": 0,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": false
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Device Data Tab": {
        "name": "Device Data Tab",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "1f966663-99b5-e88b-0a3a-d52eefabf34f": {
                "sizeX": 24,
                "sizeY": 12,
                "resizable": true,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Device Alarms Tab": {
        "name": "Device Alarms Tab",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "80ae2be3-a5ef-8754-0239-7b2dea617c6c": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Location Alarms Card": {
        "name": "Location Alarms",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "437d1800-b90b-9e23-4bf4-07e0b5e3a6e7": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Device Data Dashboard": {
        "name": "Device Data Dashboard",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "a4d91f69-6265-d266-eff2-cac617dfad96": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#E0E0E0",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Critical Alarms Card": {
        "name": "Critical Alarms",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "21193f7b-e61b-e7af-361c-81f01c9cfc66": {
                "sizeX": 25,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Major Alarms Card": {
        "name": "Major Alarms",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7afd26ac-3394-1d01-a567-ca00a07e1e79": {
                "sizeX": 36,
                "sizeY": 17,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Minor Alarms Card": {
        "name": "Minor Alarms",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "a77dbbae-8612-8d1d-6a69-c7ead4462e73": {
                "sizeX": 25,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "RSSI Widget": {
        "name": "RSSI",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "3f9e826e-adeb-19c3-e99e-afed8b69f26e": {
                "sizeX": 24,
                "sizeY": 3,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "SNR Widget": {
        "name": "SNR",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b0019001-3c32-3726-1b5c-3cb73b51d62b": {
                "sizeX": 24,
                "sizeY": 7,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "Battery Level Chart": {
        "name": "Battery Level Details",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "5c8a725d-6e42-2a21-d365-1730b601c02c": {
                "sizeX": 24,
                "sizeY": 13,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Locations Map": {
        "name": "location_map",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "be207049-e858-e316-a7a4-b55b6de2c24f": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Locations Map Alarm Badges": {
        "name": "alarm_badges",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "bf6c7567-1704-2793-6481-054a9d80f360": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "X Device Header 2": {
        "name": "Device Header 2",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f4bffa7d-f9c6-30c9-afeb-230ef7bd71a4": {
                "sizeX": 24,
                "sizeY": 3,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "X Home Dashboard Widgets": {
        "name": "Home Dashboard Widgets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "5340f194-224a-b7aa-3606-78d59412eb65": {
                "sizeX": 12,
                "sizeY": 11,
                "row": 0,
                "col": 0
              },
              "377431dd-e25b-469f-c259-9deea117efa9": {
                "sizeX": 12,
                "sizeY": 11,
                "row": 0,
                "col": 12
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#E0E0E0",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      }
    },
    "entityAliases": {
      "b47c9356-4593-2971-f5f6-ffbccfa1c3e3": {
        "id": "b47c9356-4593-2971-f5f6-ffbccfa1c3e3",
        "alias": "Alle Kunden",
        "filter": {
          "type": "entityType",
          "resolveMultiple": true,
          "entityType": "CUSTOMER"
        }
      },
      "5b0de159-a631-e2d6-c153-a4c3b5dc60e4": {
        "id": "5b0de159-a631-e2d6-c153-a4c3b5dc60e4",
        "alias": "Single Customer",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedCustomer",
          "defaultStateEntity": null
        }
      },
      "33721d14-df94-e23d-f1b0-a13735f4b9cb": {
        "id": "33721d14-df94-e23d-f1b0-a13735f4b9cb",
        "alias": "Single Location",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedLocation",
          "defaultStateEntity": null
        }
      },
      "8907f9ef-da96-cd36-f2e5-0f98562adab7": {
        "id": "8907f9ef-da96-cd36-f2e5-0f98562adab7",
        "alias": "Alle Locations",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedCustomer",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": null,
          "assetTypes": [
            "Location"
          ]
        }
      },
      "07d00b0b-d600-91ed-97f6-42171effae40": {
        "id": "07d00b0b-d600-91ed-97f6-42171effae40",
        "alias": "Single Device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null
        }
      },
      "db00267a-cd38-fbf2-8799-ef280789c15b": {
        "id": "db00267a-cd38-fbf2-8799-ef280789c15b",
        "alias": "Alle Devices",
        "filter": {
          "type": "relationsQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedLocation",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 3,
          "fetchLastLevelOnly": false,
          "filters": [
            {
              "relationType": "Contains",
              "entityTypes": [
                "DEVICE"
              ]
            }
          ]
        }
      },
      "d448bf9d-472d-50c0-673d-d6ef75ccd28f": {
        "id": "d448bf9d-472d-50c0-673d-d6ef75ccd28f",
        "alias": "Selected device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null
        }
      },
      "0df9b9bb-709d-8e9f-8000-1d0a84f0694b": {
        "id": "0df9b9bb-709d-8e9f-8000-1d0a84f0694b",
        "alias": "All Devices of Location",
        "filter": {
          "type": "relationsQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedLocation",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": false,
          "filters": [
            {
              "relationType": "Contains",
              "entityTypes": [
                "DEVICE"
              ]
            }
          ]
        }
      },
      "90b53ba0-4ef8-c53d-09f2-cfa630c2eb44": {
        "id": "90b53ba0-4ef8-c53d-09f2-cfa630c2eb44",
        "alias": "Current user",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "59c9369c-da56-a2ff-23b6-a614bece0be0": {
        "id": "59c9369c-da56-a2ff-23b6-a614bece0be0",
        "alias": "Current owner",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "d1554e02-e758-eba6-0f15-6db4779eecbd": {
        "id": "d1554e02-e758-eba6-0f15-6db4779eecbd",
        "alias": "Single Area",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedArea",
          "defaultStateEntity": null
        }
      },
      "e8f543a9-82ff-0b69-d012-8349ea363657": {
        "id": "e8f543a9-82ff-0b69-d012-8349ea363657",
        "alias": "Assigned SIM Card",
        "filter": {
          "type": "relationsQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "filters": [
            {
              "relationType": "Contains",
              "entityTypes": [
                "ASSET"
              ]
            }
          ]
        }
      },
      "1920dc6c-9713-2417-6ae6-6344562e09e0": {
        "id": "1920dc6c-9713-2417-6ae6-6344562e09e0",
        "alias": "homeWidgetMode",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "homeWidgetMode",
          "defaultStateEntity": null
        }
      },
      "f43647ee-facf-120f-2a6d-ab2f78572da8": {
        "id": "f43647ee-facf-120f-2a6d-ab2f78572da8",
        "alias": "Warehouses",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": true,
          "stateEntityParamName": "selectedCustomer",
          "groupType": "ASSET",
          "entityGroupNameFilter": "Warehouses"
        }
      },
      "11c3ee82-3f40-99af-3060-cf8cb4b87f6a": {
        "id": "11c3ee82-3f40-99af-3060-cf8cb4b87f6a",
        "alias": "locationsMode",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "locationsMode",
          "defaultStateEntity": null
        }
      },
      "597402e4-1533-a52d-cfde-d1c3130863bc": {
        "id": "597402e4-1533-a52d-cfde-d1c3130863bc",
        "alias": "deviceMode",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "deviceMode",
          "defaultStateEntity": null
        }
      },
      "5f9afe01-220a-1b1d-b205-5732805a8871": {
        "id": "5f9afe01-220a-1b1d-b205-5732805a8871",
        "alias": "selectedDatapointTab",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDatapointTab",
          "defaultStateEntity": null
        }
      },
      "187a4770-f71d-98f9-f36d-0fb1feec9895": {
        "id": "187a4770-f71d-98f9-f36d-0fb1feec9895",
        "alias": "chartMode",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "chartMode",
          "defaultStateEntity": null
        }
      },
      "374fa6d5-8e45-0054-78db-fcfc1b0b033e": {
        "id": "374fa6d5-8e45-0054-78db-fcfc1b0b033e",
        "alias": "dataMode",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "dataMode",
          "defaultStateEntity": null
        }
      }
    },
    "filters": {
      "4e0d3536-3894-3955-99c2-a40916175da9": {
        "id": "4e0d3536-3894-3955-99c2-a40916175da9",
        "filter": "loraDevice",
        "keyFilters": [
          {
            "key": {
              "type": "SERVER_ATTRIBUTE",
              "key": "isLoRaWANDevice"
            },
            "valueType": "BOOLEAN",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": true,
                    "dynamicValue": null
                  },
                  "type": "BOOLEAN"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "b246b4e2-c41d-d915-3c91-e857b1a640b0": {
        "id": "b246b4e2-c41d-d915-3c91-e857b1a640b0",
        "filter": "pulseMeter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "pulseMeter"
            },
            "valueType": "BOOLEAN",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": true,
                    "dynamicValue": null
                  },
                  "type": "BOOLEAN"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "9557fc2a-5b75-2111-2686-e72cdbe60236": {
        "id": "9557fc2a-5b75-2111-2686-e72cdbe60236",
        "filter": "Gateway",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "meterType"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Gateway",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "ea91e55a-e08d-c8d7-0338-be6820020421": {
        "id": "ea91e55a-e08d-c8d7-0338-be6820020421",
        "filter": "selectedDatapoint: temperature",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "temperature",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "cafb1d2f-4003-9265-70a2-22696983affc": {
        "id": "cafb1d2f-4003-9265-70a2-22696983affc",
        "filter": "selectedDatapoint: H_C_Energy_Heating",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_C_Energy_Heating",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "9967871d-c4ef-3000-886a-b13b4b3c81e6": {
        "id": "9967871d-c4ef-3000-886a-b13b4b3c81e6",
        "filter": "selectedDatapoint: H_C_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_C_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "2a2e0a13-5252-affc-5a36-75a49e7e60fd": {
        "id": "2a2e0a13-5252-affc-5a36-75a49e7e60fd",
        "filter": "selectedDatapoint: H_M_Energy_Heating",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_M_Energy_Heating",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "50d5b14a-abc7-7116-329b-f65fe2acc5de": {
        "id": "50d5b14a-abc7-7116-329b-f65fe2acc5de",
        "filter": "selectedDatapoint: H_M_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_M_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "0577bde9-3645-d0bf-050c-67c7ce0e0b63": {
        "id": "0577bde9-3645-d0bf-050c-67c7ce0e0b63",
        "filter": "selectedDatapoint: H_S_Power",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_S_Power",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "e3303d40-3d7d-01ae-8f0e-0a46a1137943": {
        "id": "e3303d40-3d7d-01ae-8f0e-0a46a1137943",
        "filter": "selectedDatapoint: H_S_TemperatureDifference",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_S_TemperatureDifference",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "cc4dc9d0-691b-13e8-67cd-f8ea38776832": {
        "id": "cc4dc9d0-691b-13e8-67cd-f8ea38776832",
        "filter": "selectedDatapoint: H_S_TemperatureFlow",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_S_TemperatureFlow",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "f0b5835b-4f12-9f13-65c4-8104c53a4f00": {
        "id": "f0b5835b-4f12-9f13-65c4-8104c53a4f00",
        "filter": "selectedDatapoint: H_S_TemperatureReturn",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "H_S_TemperatureReturn",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "8ae3ff45-8e6c-43eb-7762-700f3d5aeaec": {
        "id": "8ae3ff45-8e6c-43eb-7762-700f3d5aeaec",
        "filter": "selectedDatapoint: status_battery_level",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "status_battery_level",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "8e36be62-0961-36dd-68c9-69fba66c5873": {
        "id": "8e36be62-0961-36dd-68c9-69fba66c5873",
        "filter": "selectedDatapoint: status_margin",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "status_margin",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "5742c9f4-75fa-492c-b545-79336aaa0eef": {
        "id": "5742c9f4-75fa-492c-b545-79336aaa0eef",
        "filter": "selectedDatapoint: CHC_C_Energy_Cooling",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_C_Energy_Cooling",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "eb6c7f0e-6636-6dc4-f1a0-3b636fbc4978": {
        "id": "eb6c7f0e-6636-6dc4-f1a0-3b636fbc4978",
        "filter": "selectedDatapoint: CHC_C_Energy_Heating",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_C_Energy_Heating",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "55f1b3cd-c6aa-6a26-0eef-5e8901626fe7": {
        "id": "55f1b3cd-c6aa-6a26-0eef-5e8901626fe7",
        "filter": "selectedDatapoint: CHC_C_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_C_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "79cecde4-530a-07f8-f2bb-71d2153abeb4": {
        "id": "79cecde4-530a-07f8-f2bb-71d2153abeb4",
        "filter": "selectedDatapoint: CHC_M_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_M_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "4b545559-7375-c1ec-08ad-d3a9dfd1c3f9": {
        "id": "4b545559-7375-c1ec-08ad-d3a9dfd1c3f9",
        "filter": "selectedDatapoint: CHC_S_TemperatureDifference",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_S_TemperatureDifference",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "73fd7085-a759-acfc-fa70-74816ef20e00": {
        "id": "73fd7085-a759-acfc-fa70-74816ef20e00",
        "filter": "selectedDatapoint: CHC_S_TemperatureFlow",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_S_TemperatureFlow",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "6c714abd-5ff4-0fb6-35c9-db1d4053230c": {
        "id": "6c714abd-5ff4-0fb6-35c9-db1d4053230c",
        "filter": "selectedDatapoint: CHC_S_TemperatureReturn",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_S_TemperatureReturn",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "4a85d9f6-cd03-84ef-d9c6-ad1e3b3249e2": {
        "id": "4a85d9f6-cd03-84ef-d9c6-ad1e3b3249e2",
        "filter": "selectedDatapoint: CHC_M_Energy_Cooling",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_M_Energy_Cooling",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "2cea00f3-86b3-24d0-8093-b3b275d7471d": {
        "id": "2cea00f3-86b3-24d0-8093-b3b275d7471d",
        "filter": "selectedDatapoint: CHC_M_Energy_Heating",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "CHC_M_Energy_Heating",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "812b76c8-e734-39dc-b5c8-c70d37dfca3f": {
        "id": "812b76c8-e734-39dc-b5c8-c70d37dfca3f",
        "filter": "selectedDatapoint: W_C_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "selectedDatapoint: W_C_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "508674ca-2148-03c5-8bb8-d963ec72c48a": {
        "id": "508674ca-2148-03c5-8bb8-d963ec72c48a",
        "filter": "selectedDatapoint: W_M_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "W_M_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "56384545-c6b3-baab-c6b8-1742280937c7": {
        "id": "56384545-c6b3-baab-c6b8-1742280937c7",
        "filter": "selectedDatapoint: G_M_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "G_M_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "8d66239d-21ef-7029-01cd-1d0e1589a557": {
        "id": "8d66239d-21ef-7029-01cd-1d0e1589a557",
        "filter": "selectedDatapoint: G_C_Volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "G_C_Volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "85607e7a-15b5-2edb-dc2f-ee4a5ab2d759": {
        "id": "85607e7a-15b5-2edb-dc2f-ee4a5ab2d759",
        "filter": "selectedDatapoint: E_C_ActiveEnergyTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_C_ActiveEnergyTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "0dac35fa-bcdf-b785-14f0-8f5438ebd59b": {
        "id": "0dac35fa-bcdf-b785-14f0-8f5438ebd59b",
        "filter": "selectedDatapoint: E_M_ActiveEnergyTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_M_ActiveEnergyTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "75e0b5b7-2179-2966-615c-c6cd8ba07344": {
        "id": "75e0b5b7-2179-2966-615c-c6cd8ba07344",
        "filter": "selectedDatapoint: E_S_ActivePowerTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_ActivePowerTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "8f083904-acc7-fdb9-39de-165e643066c1": {
        "id": "8f083904-acc7-fdb9-39de-165e643066c1",
        "filter": "selectedDatapoint: E_S_ApparentPowerTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_ApparentPowerTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "c556bee0-e768-d158-90f0-b503e8ad5d91": {
        "id": "c556bee0-e768-d158-90f0-b503e8ad5d91",
        "filter": "selectedDatapoint: E_S_Frequency",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_Frequency",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "33fefda7-5731-0cea-1c97-7209426b699d": {
        "id": "33fefda7-5731-0cea-1c97-7209426b699d",
        "filter": "selectedDatapoint: E_S_Voltage",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_Voltage",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "6156c3f5-c22b-c8dd-c515-81d122a1f0f1": {
        "id": "6156c3f5-c22b-c8dd-c515-81d122a1f0f1",
        "filter": "selectedDatapoint: E_S_Current",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_Current",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "371471a8-27c9-b5c1-52e1-0aa142dacf1b": {
        "id": "371471a8-27c9-b5c1-52e1-0aa142dacf1b",
        "filter": "selectedDatapoint: E_S_ReactivePowerTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_ReactivePowerTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "1e032db7-da62-ad49-5bf1-c3e7cbd71fc1": {
        "id": "1e032db7-da62-ad49-5bf1-c3e7cbd71fc1",
        "filter": "selectedDatapoint: E_S_CurrentTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_CurrentTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "9937e98e-bb40-37ea-5526-ef0f2e6d9e7a": {
        "id": "9937e98e-bb40-37ea-5526-ef0f2e6d9e7a",
        "filter": "selectedDatapoint: energy",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "energy",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "726154e3-ffd6-07c6-53b7-6a4c0ab4283d": {
        "id": "726154e3-ffd6-07c6-53b7-6a4c0ab4283d",
        "filter": "selectedDatapoint: power",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "power",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "e61104e4-6f4f-48e4-f382-22c2551eced5": {
        "id": "e61104e4-6f4f-48e4-f382-22c2551eced5",
        "filter": "selectedDatapoint: volume",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "volume",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "67da0000-d889-afea-eba4-2f94669bc547": {
        "id": "67da0000-d889-afea-eba4-2f94669bc547",
        "filter": "selectedDatapoint: voltage",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "voltage",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "8cec3b0c-c0dd-9db4-74a3-60d03eb178c1": {
        "id": "8cec3b0c-c0dd-9db4-74a3-60d03eb178c1",
        "filter": "selectedDatapoint: current",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "current",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "866e38ef-ed00-8bed-bdc6-38fc0ff34a2d": {
        "id": "866e38ef-ed00-8bed-bdc6-38fc0ff34a2d",
        "filter": "selectedDatapoint: co2",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "co2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "6c09fae4-76a8-9a1b-ac3a-eadd0348c15f": {
        "id": "6c09fae4-76a8-9a1b-ac3a-eadd0348c15f",
        "filter": "selectedDatapoint: humidity",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "humidity",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "f92d840b-43bc-15f5-45e4-2e9f460a032c": {
        "id": "f92d840b-43bc-15f5-45e4-2e9f460a032c",
        "filter": "selectedDatapoint: voc",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "voc",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "65767d0d-a596-1fc8-136a-a47b32dbcc54": {
        "id": "65767d0d-a596-1fc8-136a-a47b32dbcc54",
        "filter": "selectedDatapoint: o3",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "o3",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "84474c6f-9da5-ec93-bba6-8e0cd5b8dfe5": {
        "id": "84474c6f-9da5-ec93-bba6-8e0cd5b8dfe5",
        "filter": "selectedDatapoint: pulse",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "pulse",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "022eebf4-1668-1d9f-4295-93f99bf575e2": {
        "id": "022eebf4-1668-1d9f-4295-93f99bf575e2",
        "filter": "selectedDatapoint: digital",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "digital",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "7995609f-e7dc-211d-4be2-07bdc87dc380": {
        "id": "7995609f-e7dc-211d-4be2-07bdc87dc380",
        "filter": "selectedDatapoint: light",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "light",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "9e33b1be-e920-f47c-cc3e-7635e8b86eff": {
        "id": "9e33b1be-e920-f47c-cc3e-7635e8b86eff",
        "filter": "selectedDatapoint: motion",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "motion",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "61ba0e6a-ec00-58ec-1d56-74855780c5a0": {
        "id": "61ba0e6a-ec00-58ec-1d56-74855780c5a0",
        "filter": "selectedDatapoint: leakage_status",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "leakage_status",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "2fd3d495-911c-c865-3807-4450a9623881": {
        "id": "2fd3d495-911c-c865-3807-4450a9623881",
        "filter": "selectedDatapoint: distance",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "distance",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "375b7317-e0ca-4d46-4617-cfe2a1a70f50": {
        "id": "375b7317-e0ca-4d46-4617-cfe2a1a70f50",
        "filter": "selectedDatapoint: position",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "position",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "0d979a95-c133-6334-9dfc-78e603609f26": {
        "id": "0d979a95-c133-6334-9dfc-78e603609f26",
        "filter": "selectedDatapoint: trapState",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "trapState",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "58a7dd30-b589-8b0f-3c0d-6ffa6bdbb44f": {
        "id": "58a7dd30-b589-8b0f-3c0d-6ffa6bdbb44f",
        "filter": "selectedDatapoint: magnet_status",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "magnet_status",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "c0bbf064-c46d-f3d5-2897-bbc8b1a2eaf4": {
        "id": "c0bbf064-c46d-f3d5-2897-bbc8b1a2eaf4",
        "filter": "selectedDatapoint: tamper_status",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "tamper_status",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "1cc9e33f-68a6-372d-9dc9-7a4aee15d2be": {
        "id": "1cc9e33f-68a6-372d-9dc9-7a4aee15d2be",
        "filter": "selectedDatapoint: output1",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "output1",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "f255ffff-70d7-3ddc-e075-0c76098333ca": {
        "id": "f255ffff-70d7-3ddc-e075-0c76098333ca",
        "filter": "selectedDatapoint: input1",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "input1",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "d6c85bea-72c2-9688-c25e-ab74af461bc3": {
        "id": "d6c85bea-72c2-9688-c25e-ab74af461bc3",
        "filter": "selectedDatapoint: rxPackets_rx_count",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rxPackets_rx_count",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "30ac3a73-2e87-23c4-48b8-23ee95d513a4": {
        "id": "30ac3a73-2e87-23c4-48b8-23ee95d513a4",
        "filter": "selectedDatapoint: txPackets_tx_count",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "txPackets_tx_count",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "fc83d74f-9f91-205c-c2f3-9b721b3172c0": {
        "id": "fc83d74f-9f91-205c-c2f3-9b721b3172c0",
        "filter": "selectedDatapoint: rxPacketsPerDr_0",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rxPacketsPerDr_0",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "1dec2f53-027c-3496-b8b0-14a03d191542": {
        "id": "1dec2f53-027c-3496-b8b0-14a03d191542",
        "filter": "selectedDatapoint: rxPacketsPerDr_1",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rxPacketsPerDr_1",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "65cb050e-8f02-bcb2-7931-146a57dc38cd": {
        "id": "65cb050e-8f02-bcb2-7931-146a57dc38cd",
        "filter": "selectedDatapoint: rxPacketsPerDr_2",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rxPacketsPerDr_2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "20a26cee-70a6-74e9-6254-878e8c9524c4": {
        "id": "20a26cee-70a6-74e9-6254-878e8c9524c4",
        "filter": "selectedDatapoint: rxPacketsPerDr_3",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rxPacketsPerDr_3",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "957bf4b3-9318-0d14-51d5-9c9ec0ecb983": {
        "id": "957bf4b3-9318-0d14-51d5-9c9ec0ecb983",
        "filter": "selectedDatapoint: rxPacketsPerDr_4",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rxPacketsPerDr_4",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "55698fec-1700-4738-6db2-5ce624ac7730": {
        "id": "55698fec-1700-4738-6db2-5ce624ac7730",
        "filter": "selectedDatapoint: rxPacketsPerDr_5",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rxPacketsPerDr_5",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "66bab4e0-bb1c-de48-8d25-1b8f48f54c44": {
        "id": "66bab4e0-bb1c-de48-8d25-1b8f48f54c44",
        "filter": "selectedDatapoint: txPacketsPerStatus_OK",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "txPacketsPerStatus_OK",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "6dc7ed86-ad7a-30e4-b100-d8cc2d2495aa": {
        "id": "6dc7ed86-ad7a-30e4-b100-d8cc2d2495aa",
        "filter": "selectedDatapoint: txPacketsPerStatus_COLLISION_PACKET",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "txPacketsPerStatus_COLLISION_PACKET",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "175ac413-4977-8ffc-9f3f-32c9d0a32f62": {
        "id": "175ac413-4977-8ffc-9f3f-32c9d0a32f62",
        "filter": "selectedDatapoint: txPacketsPerStatus_TOO_EARLY",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "txPacketsPerStatus_TOO_EARLY",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "318120fd-4355-ac8a-2df3-8c0358ef710f": {
        "id": "318120fd-4355-ac8a-2df3-8c0358ef710f",
        "filter": "selectedDatapoint: txPacketsPerStatus_TOO_LATE",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "txPacketsPerStatus_TOO_LATE",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "bca9a962-2cdf-5055-5288-50babb4d6ced": {
        "id": "bca9a962-2cdf-5055-5288-50babb4d6ced",
        "filter": "selectedDatapoint: dewPoint",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "dewPoint",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "e970c08b-d38d-646f-59e0-b3ad3e11c308": {
        "id": "e970c08b-d38d-646f-59e0-b3ad3e11c308",
        "filter": "selectedDatapoint: rssi",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": " selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "rssi",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "a5862eb5-ced3-7781-f986-18e0a4f3d7fd": {
        "id": "a5862eb5-ced3-7781-f986-18e0a4f3d7fd",
        "filter": "selectedDatapoint: snr",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": " selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "snr",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "4a31d619-3971-a165-af51-569ddd43b5c4": {
        "id": "4a31d619-3971-a165-af51-569ddd43b5c4",
        "filter": "selectedDatapoint: E_S_PowerFactor",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_PowerFactor",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "832209eb-da83-6949-c03b-8164548e62fc": {
        "id": "832209eb-da83-6949-c03b-8164548e62fc",
        "filter": "selectedDatapoint: E_M_ActiveEnergy_EnergyC",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_M_ActiveEnergy_EnergyC",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "87d006fb-4af5-c488-e6ab-6be0459d95b4": {
        "id": "87d006fb-4af5-c488-e6ab-6be0459d95b4",
        "filter": "selectedDatapoint: E_M_ActiveEnergy_EnergyP",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_M_ActiveEnergy_EnergyP",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "459a8a0e-4a5d-8651-ed9c-a9f247f6f61b": {
        "id": "459a8a0e-4a5d-8651-ed9c-a9f247f6f61b",
        "filter": "selectedDatapoint: E_M_ReactiveEnergyTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_M_ReactiveEnergyTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "d563b314-2643-dedd-4211-98c982136f74": {
        "id": "d563b314-2643-dedd-4211-98c982136f74",
        "filter": "selectedDatapoint: E_S_ActivePowerTotalMax",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_ActivePowerTotalMax",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "2b506455-4098-63d2-d122-30fa77e4b21b": {
        "id": "2b506455-4098-63d2-d122-30fa77e4b21b",
        "filter": "selectedDatapoint: E_S_CurrentL1",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_CurrentL1",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "886e1dce-a188-83c8-4d2d-6a5d84dfb944": {
        "id": "886e1dce-a188-83c8-4d2d-6a5d84dfb944",
        "filter": "selectedDatapoint: E_S_CurrentL2",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_CurrentL2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "468b606e-8884-05ba-97d6-c4366f27305d": {
        "id": "468b606e-8884-05ba-97d6-c4366f27305d",
        "filter": "selectedDatapoint: E_S_CurrentL3",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_CurrentL3",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "83710796-a086-6b8c-413f-c610c15f97c3": {
        "id": "83710796-a086-6b8c-413f-c610c15f97c3",
        "filter": "selectedDatapoint: E_M_ActiveEnergyTotalL1",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_M_ActiveEnergyTotalL1",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "c501c9ba-6243-e6c3-4209-c0e6721f17a0": {
        "id": "c501c9ba-6243-e6c3-4209-c0e6721f17a0",
        "filter": "selectedDatapoint: E_M_ActiveEnergyTotalL2",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_M_ActiveEnergyTotalL2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "502ec6ce-6b66-16b0-c24f-28e743cc4bf2": {
        "id": "502ec6ce-6b66-16b0-c24f-28e743cc4bf2",
        "filter": "selectedDatapoint: E_M_ActiveEnergyTotalL3",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_M_ActiveEnergyTotalL3",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "a3c44398-d1f9-af8d-9edc-2b432fa84323": {
        "id": "a3c44398-d1f9-af8d-9edc-2b432fa84323",
        "filter": "selectedDatapoint: E_C_ActiveEnergy_EnergyC",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_C_ActiveEnergy_EnergyC",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "bcde5be2-5c45-53a4-cf8f-c7ed4e0fb042": {
        "id": "bcde5be2-5c45-53a4-cf8f-c7ed4e0fb042",
        "filter": "selectedDatapoint: E_C_ActiveEnergy_EnergyP",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_C_ActiveEnergy_EnergyP",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "ca3c0662-8f66-15d1-f68e-077b520a695d": {
        "id": "ca3c0662-8f66-15d1-f68e-077b520a695d",
        "filter": "selectedDatapoint: E_C_ReactiveEnergyTotal",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_C_ReactiveEnergyTotal",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "09b0e568-de2e-5e11-83f9-6fc8faad88d6": {
        "id": "09b0e568-de2e-5e11-83f9-6fc8faad88d6",
        "filter": "selectedDatapoint: E_C_ActiveEnergyTotalL1",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "selectedDatapoint",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "5a891689-29f6-5911-c4ef-c34a64077c26": {
        "id": "5a891689-29f6-5911-c4ef-c34a64077c26",
        "filter": "selectedDatapoint: E_C_ActiveEnergyTotalL2",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_C_ActiveEnergyTotalL2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "b08e4297-d946-1f09-2bae-19fd870cf982": {
        "id": "b08e4297-d946-1f09-2bae-19fd870cf982",
        "filter": "selectedDatapoint: E_C_ActiveEnergyTotalL3",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_C_ActiveEnergyTotalL3",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "83a3761a-1f70-1538-f7ac-8da5d8650bf5": {
        "id": "83a3761a-1f70-1538-f7ac-8da5d8650bf5",
        "filter": "selectedDatapoint: E_S_CurrentN",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "E_S_CurrentN",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "eccbdbe2-46ce-8075-a04d-a2ac165e5b88": {
        "id": "eccbdbe2-46ce-8075-a04d-a2ac165e5b88",
        "filter": "selectedDatapoint: operatingStatus",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "selectedDatapoint"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "operatingStatus",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "f18c6edb-d303-4d06-c021-85171f522511": {
        "id": "f18c6edb-d303-4d06-c021-85171f522511",
        "filter": "pulsemeter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "pulseMeter"
            },
            "valueType": "BOOLEAN",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": true,
                    "dynamicValue": null
                  },
                  "type": "BOOLEAN"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      },
      "3d280689-1556-964a-da92-5cd7699f4cda": {
        "id": "3d280689-1556-964a-da92-5cd7699f4cda",
        "filter": "Not Warehouse",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "locationType"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "NOT_EQUAL",
                  "value": {
                    "defaultValue": "Warehouses",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      }
    },
    "timewindow": {
      "hideAggregation": false,
      "hideAggInterval": false,
      "hideTimezone": false,
      "selectedTab": 1,
      "realtime": {
        "realtimeType": 0,
        "interval": 1000,
        "timewindowMs": 60000,
        "quickInterval": "CURRENT_DAY",
        "hideInterval": false,
        "hideLastInterval": false,
        "hideQuickInterval": false
      },
      "history": {
        "historyType": 0,
        "interval": 1000,
        "timewindowMs": 604800000,
        "fixedTimewindow": {
          "startTimeMs": 1742286036262,
          "endTimeMs": 1742372436262
        },
        "quickInterval": "CURRENT_DAY",
        "hideInterval": false,
        "hideLastInterval": false,
        "hideFixedInterval": false,
        "hideQuickInterval": false
      },
      "aggregation": {
        "type": "NONE",
        "limit": 50000
      },
      "timezone": null
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": true,
      "showEntitiesSelect": true,
      "showDashboardTimewindow": true,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true,
      "titleColor": "rgba(0,0,0,0.870588)",
      "showDashboardLogo": false,
      "dashboardLogoUrl": null,
      "hideToolbar": false,
      "showFilters": true,
      "showUpdateDashboardImage": true,
      "dashboardCss": ".tb-widget-container > .tb-widget {\n    border-radius: 8px;\n}\n\ngridster-item:not(.tb-noselect) > .tb-widget-container > .tb-widget {\n    cursor: default !important;\n}\n\n.tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-row {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-legend-keys {\n    cursor: pointer;\n}\n\n.tb-dashboard-page.dark tb-dashboard > div {\n    background-color: #0A1F36 !important; /* rgb(238, 238, 238)*/\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget {\n    background: #0D2743 !important;\n    color: rgba(255, 255, 255, 0.87) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget svg tspan {\n    fill: rgba(255, 255, 255, 0.87) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-latest-chart-legend-item-label div {\n    color: rgba(255, 255, 255, 0.38) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-latest-chart-legend-item-value {\n    color: rgba(255, 255, 255, 0.87) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-latest-chart-shape svg text {\n    fill: rgba(255, 255, 255, 0.87) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-time-series-chart-legend-type-label {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-time-series-chart-legend-item-label div {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-time-series-chart-legend-value {\n    color: rgba(255, 255, 255, 0.87) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .flot-text {\n    color: rgba(255, 255, 255, 0.87) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .flot-text > div > div {\n    color: rgba(255, 255, 255, 0.87) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-header-row {\n    background-color: #0D2743 !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-header-cell.mat-mdc-table-sticky {\n    background-color: #0D2743 !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-row .mat-mdc-cell.mat-mdc-table-sticky {\n    background-color: #0D2743 !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-header-cell {\n    color: rgba(255, 255, 255, 0.87) !important;\n    border-bottom-color: rgba(255, 255, 255, 0.2) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-cell {\n    color: rgba(255, 255, 255, 0.87) !important;\n    border-bottom-color: rgba(255, 255, 255, 0.2) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-header-cell .mat-sort-header-arrow {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-divider {\n    border-top-color: rgba(255, 255, 255, 0.2) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-input-element::placeholder {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-input-element::-moz-placeholder {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-input-element::-webkit-input-placeholder {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-input-element:-ms-input-placeholder {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-cell .mdc-checkbox__background,.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-header-cell .mdc-checkbox__background {\n    border-color : rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-cell button.mat-mdc-icon-button mat-icon {\n    color : rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-cell button.mat-mdc-icon-button tb-icon {\n    color : rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar.mat-mdc-table-toolbar:not([color=\"primary\"]) button.mat-mdc-icon-button mat-icon {\n    color : rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-table .mat-mdc-cell button.mat-mdc-icon-button[disabled][disabled] mat-icon {\n    color : rgba(255, 255, 255, 0.2) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-paginator {\n    color: rgba(255, 255, 255, 0.57) !important;\n}\n\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-paginator button.mat-mdc-icon-button {\n    color : rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-paginator button.mat-mdc-icon-button[disabled][disabled] {\n    color : rgba(255, 255, 255, 0.2) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-paginator .mat-mdc-select-value {\n    color : rgba(255, 255, 255, 0.57) !important;\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .mat-mdc-select-arrow {\n    color : rgba(255, 255, 255, 0.57);\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple:before {\n    border-bottom-color: rgba(255, 255, 255, 0.4);\n}\n\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading, \n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,\n.tb-dashboard-page.dark .tb-widget-container > .tb-widget .mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing {\n    border-color: rgba(255, 255, 255, 0.4);\n}\n\n.tb-dashboard-page.dark .tb-markdown-view div,\n.tb-dashboard-page.dark .tb-markdown-view div.param,\n.tb-dashboard-page.dark .tb-markdown-view .header .title,\n.tb-dashboard-page.dark .tb-markdown-view p {\n    color : rgba(255, 255, 255, 0.87);\n}\n\n.tb-dashboard-page.dark .tb-markdown-view div.param-title,\n.tb-dashboard-page.dark .tb-markdown-view .header .subtitle {\n    color : rgba(255, 255, 255, 0.6);\n}\n\n\n.tb-dashboard-page.dark .tb-powered-by-footer {\n    color : rgba(255, 255, 255, 0.87) !important;\n}\n\n\n.tb-dashboard-page.dark .mat-mdc-icon-button .mat-mdc-button-touch-target .mat-mdc-paginator-icon {\n    color: rgba(255, 255, 255, 0.87) !important;\n}\n"
    }
  },
  "name": "Energiemanagement Administration",
  "resources": null,
  "id": {
    "entityType": "DASHBOARD",
    "id": "e04fdab0-d784-11f0-915d-39f188b2fdb7"
  },
  "createdTime": 1765562614747,
  "tenantId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  },
  "customerId": null,
  "assignedCustomers": null,
  "externalId": null,
  "version": 29,
  "ownerId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  }
}