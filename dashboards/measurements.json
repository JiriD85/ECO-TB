{
  "title": "Measurements",
  "image": "tb-image;/api/images/tenant/belimo_retrofit_plus_padding.png",
  "mobileHide": false,
  "mobileOrder": 1,
  "configuration": {
    "description": "",
    "widgets": {
      "4c8da7a1-659f-e2e5-220c-4128a217e872": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 2592000000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-startTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "New Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "40px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
            "filterId": null,
            "dataKeys": [
              {
                "name": "startTime",
                "type": "alarm",
                "label": "Start time",
                "color": "#607d8b",
                "settings": {
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible"
                },
                "_hash": 0.9100433241266481
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "notifications",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": false,
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}\n",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": false
          },
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "4c8da7a1-659f-e2e5-220c-4128a217e872",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "displayPreparationMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.preparation.title}",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'in preparation';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'in preparation' : 'unset';"
                  },
                  "_hash": 0.4010207052742043,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayActiveMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.active.title}",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": true,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'active';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'active' : 'unset';"
                  },
                  "_hash": 0.717435526543984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayFinishedMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.finished.title}",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'finished';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'finished' : 'unset';"
                  },
                  "_hash": 0.9122349770594107,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayAbortedMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.aborted.title}",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'aborted';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'aborted' : 'unset';"
                  },
                  "_hash": 0.7567501123338984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": false,
            "showActionButtons": false,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 3,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "State Filter",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {
            "fontWeight": "bold",
            "fontSize": "14px"
          },
          "titleStyle": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "paddingBottom": "30px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "noDataDisplayMessage": "",
          "widgetCss": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "6e0676c2-49cd-846e-9c94-80c6b2c0218c": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.measurements.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": true,
            "entityNameColumnTitle": "{i18n:custom.diagnostics.measurement-name.title}",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.diagnostics.measurements.title}",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "0995cad1-8408-0071-28a7-c305d95429e2",
              "filterId": "2d011a64-3af4-277a-980d-904145c28912",
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-address.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.5439377495268714,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8686344328279582
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:entity-field.state}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "20%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var state = value;\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        default:\n            return state;\n    }\n}\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-progress.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getProgressHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.6466565617082951,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-type.title}",
                  "color": "#607d8b",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getMeasurementTypeHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.011120189088471788,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [
              {
                "name": "Selected Measurement",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\n\n// Navigate to measurement_dashboard - the markdown widget there handles the conditional display\nwidgetContext.stateController.openState('measurement_dashboard', params, true);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "27b78a0c-3e2d-8d90-72dd-10f9f80351b5"
              }
            ],
            "actionCellButton": [
              {
                "id": "measurement-info-action",
                "name": "Live Data",
                "icon": "sensors",
                "type": "custom",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "customFunction": {
                  "body": "const measurementId = entityId;\nprojectWizard.openMeasurementInfoDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false
              },
              {
                "name": "Connect Measurement",
                "icon": "add_chart",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var progress = data.Progress || data.progress || data.Fortschritt;\nreturn (progress === 'in preparation' || progress === 'planned');",
                "type": "custom",
                "customFunction": {
                  "body": "utils.dataConnectorDialog(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c020f915-da89-ba7e-5aaa-49066cf1451c"
              },
              {
                "name": "{i18n:custom.diagnostics.action.measurement-parameters}",
                "icon": "settings",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var userRole = widgetContext.stateController.getStateParams().userRole;\r\n/*console.log(widgetContext.stateController.getStateParams());\r\nconsole.log(\"user role:\", userRole);*/\r\n        \r\nif (userRole !== 'Belimo Retrofit Users') {\r\n    return true;\r\n} else {\r\n    return false;\r\n}\r\n    \r\n    /*return (userRoleValue !== 'Belimo Retrofit Users');*/\r\n    \r\n\r\n   \r\n\r\n \r\n",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error(\"No measurement selected\");\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e9d60eaa-56f8-bbfb-45db-110033a2739a"
              },
              {
                "name": "{i18n:custom.diagnostics.action.measurement-dashboard.title}",
                "icon": "dashboard",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\n\n// Navigate to measurement_dashboard - the markdown widget there handles the conditional display\nwidgetContext.stateController.openState('measurement_dashboard', params, true);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6f852a67-6999-f59d-5795-e81b18274a55"
              },
              {
                "id": "delete-measurement-1769460037673",
                "name": "Delete Measurement",
                "icon": "delete",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = entityId;\nconst measurementName = entityName || entityLabel || 'this measurement';\n\nif (!measurementId || !measurementId.id) {\n    console.error(\"No measurement selected\");\n    return;\n}\n\nprojectWizard.deleteMeasurement(widgetContext, measurementId, measurementName);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                }
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.diagnostics.action.go-back.title}",
                "buttonType": "icon",
                "icon": "arrow_back",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\n/*var number = (widgetContext.stateController.getStateIndex())-1;*/\r\n\r\nparams['selectedProject'] = null;\r\nparams['targetStateParameter'] = null;\r\n\r\nparams = {\r\n    \"userRole\": params.userRole\r\n};\r\n\r\nwidgetContext.stateController.updateState(null,params);\r\n/*widgetContext.stateController.navigatePrevState(number);*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3ef7bac7-ead3-49d4-a2aa-1b80aae1b476"
              },
              {
                "name": "Measurement",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "const stateParams = widgetContext.stateController.getStateParams();\nconst selectedProject = stateParams.selectedProject;\n\nif (!selectedProject || !selectedProject.entityId || !selectedProject.entityId.id) {\n    console.error('No project selected. Please select a project first.');\n    return;\n}\n\nconst projectId = { id: selectedProject.entityId.id, entityType: 'ASSET' };\nconst projectName = selectedProject.entityName;\n\n// Determine customerId\nconst NULL_UUID = '13814000-1dd2-11b2-8080-808080808080';\nfunction isValidCustomerId(id) {\n    return id && id !== NULL_UUID;\n}\n\nconst userRole = stateParams.userRole;\nconst stateEntityId = stateParams.entityId;\nlet customerId;\n\nif ((widgetContext.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator') && stateEntityId && stateEntityId.id && isValidCustomerId(stateEntityId.id)) {\n    customerId = stateEntityId;\n    openDialog();\n} else if (isValidCustomerId(widgetContext.currentUser.customerId)) {\n    customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER' };\n    openDialog();\n} else {\n    // Fetch customerId from project asset\n    const $injector = widgetContext.$scope.$injector;\n    const assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n    assetService.getAsset(projectId.id).subscribe(projectAsset => {\n        if (projectAsset && projectAsset.customerId && isValidCustomerId(projectAsset.customerId.id)) {\n            customerId = projectAsset.customerId;\n            openDialog();\n        } else {\n            console.error('Cannot determine customerId. Project has no valid customer assigned.');\n        }\n    });\n}\n\nfunction openDialog() {\n    projectWizard.openAddMeasurementDialog(widgetContext, projectId, projectName, customerId, function(result) {\n        // Update state params with new measurement\n        const params = widgetContext.stateController.getStateParams();\n        params['selectedMeasurement'] = {\n            entityId: result.id,\n            entityName: result.name,\n            entityLabel: result.label || ''\n        };\n        widgetContext.updateAliases();\n        \n        // If connectKit checkbox was checked and it's ultrasonic, open connect dialog\n        if (result.connectKit && result.measurementType === 'ultrasonic') {\n            dataImporter.dataConnectorDialog(widgetContext, result.id, result.name);\n        }\n    });\n}",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                    "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6f6daae0-99ef-3112-baf1-9e8e6cc178b2"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "6e0676c2-49cd-846e-9c94-80c6b2c0218c",
        "typeFullFqn": "system.cards.entities_table"
      },
      "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.3601545606589338,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.22269988983816758
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.08522023745480056
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.6869463922331669
                },
                {
                  "name": "systemType",
                  "type": "attribute",
                  "label": "systemType",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.5906840773460056
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.34162610005382144
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.6538615706972768
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.34458645066683413
                },
                {
                  "name": "dimension",
                  "type": "attribute",
                  "label": "dimension",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.12782307845724783
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.48540079128001534
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.9658749504265884
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.5204980258542499
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "timeseries",
                  "label": "minorAlarmsCount",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.43159566889424095
                },
                {
                  "name": "warningAlarmsCount",
                  "type": "timeseries",
                  "label": "warningAlarmsCount",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.5507603153840216
                },
                {
                  "name": "measurementRole",
                  "type": "attribute",
                  "label": "measurementRole",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.123456789
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.8908409252575222
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "transparent",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": {
              "body": "let $injector = ctx.$scope.$injector;\nlet assetService = $injector.get(ctx.servicesMap.get('assetService'));\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nvar entityId;\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n    entityId = data[0]['entityId'];\n} else {\n    deviceState = false;\n    entityId = null;\n}\nlet userRole;\nif(data[1] && data[1].role){\n    userRole = data[1].role;\n}\n\nvar stateParams = ctx.stateController.getStateParams();\nctx.stateController.updateState(null, stateParams);\nif(entityId) {\n\n    var ButtonHtml = '';\n    if (userRole !== 'Belimo Retrofit Users') {\n        ButtonHtml =\n            '<button id=\"parameter-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.action.measurement-parameters}</span>' +\n            '</button>' +\n            '<button id=\"projects-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n            '</button>';\n    }\n\n    var name, label, state, active, progress, locationName, installationType, systemType, measurementRole, dimension, measurementType, startTime, endTime;\n    var criticalCount, majorCount, minorCount, warningCount;\n    if (data && data.length) {\n        name = data[0]['entityName'] || 'N/A';\n        label = data[0]['Label'] || 'N/A';\n        locationName = data[0]['locationName'] || 'N/A';\n        installationType = data[0]['installationType'] || 'N/A';\n        systemType = data[0]['systemType'] || 'N/A';\n        measurementRole = data[0]['measurementRole'] || 'N/A';\n        dimension = data[0]['dimension'] || 'N/A';\n        state = data[0]['state'] || 'normal';\n        active = data[0]['active'] || 'N/A';\n        progress = data[0]['progress'] || 'N/A';\n        measurementType = data[0]['measurementType'] || 'N/A';\n        startTime = data[0]['startTimeMs'] || 'N/A';\n        endTime = data[0]['endTimeMs'] || 'N/A';\n        criticalCount = parseInt(data[0]['criticalAlarmsCount']) || 0;\n        majorCount = parseInt(data[0]['majorAlarmsCount']) || 0;\n        minorCount = parseInt(data[0]['minorAlarmsCount']) || 0;\n        warningCount = parseInt(data[0]['warningAlarmsCount']) || 0;\n        if (active === 'false') {\n            state = 'disconnected';\n        }\n    }\n\n    // Installation Type Badge (heating=red, cooling=blue)\n    var instStyle = ecoUtils.getInstallationTypeStyle(installationType);\n    var installationBadge = ecoUtils.createBadgeHtml(instStyle.icon, instStyle.label, instStyle.color, instStyle.bgColor);\n\n    // System Type Badge (text only) - fixed i18n key\n    var systemTypeBadge = '';\n    if (systemType && systemType !== 'N/A') {\n        var sysTypeKey = clientUtils.toKebabCase(systemType);\n        systemTypeBadge = '<span class=\"status-badge badge-type\">' +\n            '{i18n:custom.diagnostics.system-type.' + sysTypeKey + '}' +\n            '</span>';\n    }\n\n    // Measurement Role Badge (text only) - fixed i18n key\n    var measurementRoleBadge = '';\n    if (measurementRole && measurementRole !== 'N/A') {\n        var roleKey = clientUtils.toKebabCase(measurementRole);\n        measurementRoleBadge = '<span class=\"status-badge badge-type\">' +\n            '{i18n:custom.diagnostics.measurement-role.' + roleKey + '}' +\n            '</span>';\n    }\n\n    // === State + Alarm Badge (Icon with Badge Pattern) ===\n    var totalAlarms = criticalCount + majorCount + minorCount + warningCount;\n    var stateStyle = ecoUtils.getAlarmStateStyle(state);\n\n    // Build State + Alarm Card\n    var stateAlarmCard = '';\n    if (totalAlarms > 0) {\n        // With alarms: State text (colored) + Bell icon (neutral gray) + Badge (colored)\n        stateAlarmCard = '<div id=\"measurement-alarms\" class=\"state-alarm-card\" style=\"' +\n            'display:inline-flex;align-items:center;gap:12px;' +\n            'padding:8px 14px;border-radius:8px;cursor:pointer;' +\n            'background:' + stateStyle.bgColor + ';' +\n            'transition:all 0.2s ease;\">' +\n            // State text (colored, no icon)\n            '<span style=\"font-weight:600;font-size:13px;color:' + stateStyle.color + ';\">' +\n                (stateStyle.i18nKey ? '{i18n:' + stateStyle.i18nKey + '}' : state) +\n            '</span>' +\n            // Bell icon (neutral gray) with colored badge\n            '<div style=\"position:relative;display:inline-flex;\">' +\n                '<mat-icon style=\"font-size:22px;width:22px;height:22px;color:#666;\">notifications</mat-icon>' +\n                '<span style=\"position:absolute;top:-6px;right:-8px;' +\n                    'min-width:18px;height:18px;padding:0 5px;' +\n                    'border-radius:9px;background:' + stateStyle.color + ';color:white;' +\n                    'font-size:11px;font-weight:600;' +\n                    'display:flex;align-items:center;justify-content:center;\">' +\n                    totalAlarms +\n                '</span>' +\n            '</div>' +\n        '</div>';\n    } else {\n        // No alarms: Simple \"Normal\" text badge (not clickable, no bell)\n        stateAlarmCard = '<span class=\"status-badge\" style=\"background:' + stateStyle.bgColor + ';color:' + stateStyle.color + ';\">' +\n            '<span>' + (stateStyle.i18nKey ? '{i18n:' + stateStyle.i18nKey + '}' : state) + '</span></span>';\n    }\n\n    // Progress Badge with getProgressColor scheme (orange->green->blue->red)\n    var progressBadge = '';\n    if (progress && progress !== 'N/A') {\n        var progStyle = ecoUtils.getProgressColor(progress);\n        var progIcon;\n        switch(progress) {\n            case 'in preparation': progIcon = 'schedule'; break;\n            case 'active': progIcon = 'play_circle'; break;\n            case 'finished': progIcon = 'check_circle'; break;\n            case 'aborted': progIcon = 'cancel'; break;\n            default: progIcon = 'help'; break;\n        }\n        var progI18nKey = progress === 'in preparation' ? 'preparation' : progress;\n        progressBadge = '<span class=\"status-badge\" style=\"background:' + progStyle.bgColor + ';color:' + progStyle.color + ';\">' +\n            '<mat-icon class=\"badge-icon\">' + progIcon + '</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.state-filter.' + progI18nKey + '.title}</span></span>';\n    }\n\n    var displayTitle = (locationName && locationName !== 'N/A') ? locationName : name;\n\n    var header = '<div class=\"measurement-header flex items-center justify-between\">' +\n      '<div class=\"flex items-center gap-3\">' +\n        '<button id=\"go-back\" type=\"button\" mat-raised-button color=\"primary\" class=\"back-button\">' +\n          '<mat-icon>arrow_back</mat-icon><span>{i18n:action.go-back}</span></button>' +\n        '<button id=\"measurement-switch-button\" type=\"button\" mat-raised-button color=\"accent\" class=\"switch-btn\">' +\n          '<mat-icon>swap_horiz</mat-icon>' +\n        '</button>' +\n        '<div class=\"measurement-title-block\">' +\n          '<span class=\"measurement-location-text\">' + ((locationName && locationName !== 'N/A') ? locationName : label) + '</span>' +\n          '<span class=\"measurement-name-text\">' + name + '</span>' +\n        '</div>' +\n      '</div>' +\n      '<div class=\"flex flex-col items-center gap-1\">' +\n        '<div class=\"flex items-center gap-2\">' + installationBadge + systemTypeBadge + measurementRoleBadge + '</div>' +\n        '<div class=\"flex items-center gap-2\">' + progressBadge + ecoUtils.getDateBadgeHtml(startTime, 'start') + ecoUtils.getDateBadgeHtml(endTime, 'end') + '</div>' +\n      '</div>' +\n      '<div class=\"flex items-center justify-center\" style=\"margin:0 24px;\">' + stateAlarmCard + '</div>' +\n      '<div class=\"flex items-center gap-3\">' +\n        '<button id=\"reprocess-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">refresh</mat-icon><span>Reprocessing</span></button>' +\n        ButtonHtml +\n        '<button id=\"analysis-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">insights</mat-icon><span>{i18n:custom.diagnostics.analysis.title}</span></button>' +\n      '</div>' +\n    '</div>';\n\n    // Inject styles\n    (function injectStyles() {\n        var styleId = 'measurement-header-style';\n        if (document.getElementById(styleId)) return;\n\n        var css = '.measurement-tabs-container { display: flex; flex-direction: column; height: 100%; min-height: 0; }' +\n            '.measurement-tabs-container mat-tab-group { flex: 1 1 auto; min-height: 0; height: 100%; }' +\n            '.measurement-tabs-container .mat-mdc-tab-body-wrapper { flex: 1 1 auto; min-height: 0; height: 100%; }' +\n            '.measurement-tabs-container .mat-mdc-tab-body { height: 100%; min-height: 0; }' +\n            '.measurement-tabs-container .mat-mdc-tab-body-content { height: 100%; min-height: 0; overflow: hidden; }' +\n            '.measurement-tab-label { display: inline-flex; align-items: center; gap: 8px; }' +\n            '.measurement-tab-label mat-icon { font-size: 20px; width: 20px; height: 20px; }' +\n            '.measurement-tab-body { width: 100%; height: 100%; display: block; }' +\n            '.state-alarm-card:hover { transform: scale(1.02); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }';\n\n        var styleEl = document.createElement('style');\n        styleEl.id = styleId;\n        styleEl.type = 'text/css';\n        styleEl.appendChild(document.createTextNode(css));\n        document.head.appendChild(styleEl);\n    })();\n\n    // Determine measurement type and installation type\n    var mType = (measurementType || '').toLowerCase();\n    var iType = (installationType || '').toLowerCase();\n\n    // Show navigation bar only for ultrasonic/import\n    var showNavBar = (mType === 'ultrasonic' || mType === 'import');\n    var showMessage = false;\n    var messageText = 'Interpolated data is only available in the analysis after the measurement is completed.';\n\n    // Determine states based on installation type\n    var rawDataState = '';\n    var loadAnalysisState = '';\n    // State definitions (unified - no heating/cooling distinction)\n    rawDataState = 'measurement_dashboard_raw';\n    loadAnalysisState = 'measurement_dashboard_load';\n    heatmapState = 'measurement_dashboard_heatmap';\n    flowState = 'measurement_dashboard_flow';\n    heatcurveState = 'measurement_dashboard_heatcurve';\n    hddState = 'measurement_dashboard_hdd';\n    valveState = 'measurement_dashboard_valve';\n    deltaTState = 'measurement_dashboard_deltat';\n\n    // Content for non-tabbed views\n    var contentHtml = '';\n\n    if (mType === 'lorawan') {\n        contentHtml = '<tb-dashboard-state class=\"w-full h-full\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_lorawan_room\"></tb-dashboard-state>';\n        return '<div class=\"main-layout flex flex-col w-full h-full\">' + header +\n            '<div id=\"power_measurement_wrapper\" class=\"flex-1\">' + contentHtml + '</div></div>';\n    } else if (mType === 'interpolation' || !showNavBar) {\n        contentHtml = '<div class=\"flex items-center justify-center h-full\"><div class=\"text-center p-8\" style=\"background: #fff3e0; border-radius: 8px; margin: 20px;\"><mat-icon style=\"font-size: 48px; width: 48px; height: 48px; color: #ff9800;\">info</mat-icon><p style=\"color: #666; font-size: 16px; margin-top: 16px;\">' + messageText + '</p></div></div>';\n        return '<div class=\"main-layout flex flex-col w-full h-full\">' + header +\n            '<div id=\"power_measurement_wrapper\" class=\"flex-1\">' + contentHtml + '</div></div>';\n    }\n\n    // ========== MAT-TAB-GROUP Navigation for ultrasonic/import ==========\n\n    var tabs = [\n        { id: 'raw', label: '{i18n:custom.diagnostics.nav.raw-data}', icon: 'show_chart', stateId: rawDataState },\n        { id: 'load', label: '{i18n:custom.diagnostics.nav.load-analysis}', icon: 'speed', stateId: loadAnalysisState },\n        { id: 'heatmap', label: '{i18n:custom.diagnostics.nav.heatmap}', icon: 'thermostat', stateId: heatmapState },\n        { id: 'energy-flow', label: '{i18n:custom.diagnostics.nav.energy-flow}', icon: 'account_tree', stateId: flowState },\n        { id: 'heatcurve', label: '{i18n:custom.diagnostics.nav.heatcurve}', icon: 'ssid_chart', stateId: heatcurveState },\n        { id: 'hdd', label: '{i18n:custom.diagnostics.nav.hdd}', icon: 'wb_sunny', stateId: hddState },\n        { id: 'valve', label: '{i18n:custom.diagnostics.nav.valve-sizing}', icon: 'plumbing', stateId: valveState },\n        { id: 'deltat', label: '{i18n:custom.diagnostics.nav.delta-t}', icon: 'thermostat_auto', stateId: deltaTState }\n    ];\n\n    // Get active tab from stateParams\n    var activeTabId = (stateParams.navTab && stateParams.navTab.active) || 'raw';\n    var selectedIndex = 0;\n    for (var i = 0; i < tabs.length; i++) {\n        if (tabs[i].id === activeTabId) {\n            selectedIndex = i;\n            break;\n        }\n    }\n\n    // Set up tab change handler on ctx\n    ctx.measurementNavIndex = selectedIndex;\n    ctx.measurementNavChange = function(ev) {\n        try {\n            var idx = (ev && typeof ev.index === 'number') ? ev.index : 0;\n            var tab = tabs[idx] || tabs[0];\n            ctx.measurementNavIndex = idx;\n\n            var currentParams = ctx.stateController.getStateParams() || {};\n            currentParams.navTab = { active: tab.id };\n            ctx.stateController.updateState(null, currentParams);\n\n            if (ctx.$scope && typeof ctx.$scope.$applyAsync === 'function') {\n                ctx.$scope.$applyAsync();\n            }\n        } catch (e) {\n            console.error('measurementNavChange error', e);\n        }\n    };\n\n    // Build tabs HTML\n    var tabsHtml = '';\n    for (var j = 0; j < tabs.length; j++) {\n        var t = tabs[j];\n        tabsHtml += '<mat-tab>' +\n            '<ng-template mat-tab-label>' +\n                '<span class=\"measurement-tab-label\">' +\n                    '<mat-icon>' + t.icon + '</mat-icon>' +\n                    '<span>' + t.label + '</span>' +\n                '</span>' +\n            '</ng-template>' +\n            '<ng-template matTabContent>' +\n                '<tb-dashboard-state class=\"measurement-tab-body\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"' + t.stateId + '\"></tb-dashboard-state>' +\n            '</ng-template>' +\n        '</mat-tab>';\n    }\n\n    var tabGroupHtml = '<div class=\"measurement-tabs-container\">' +\n        '<mat-tab-group mat-stretch-tabs=\"false\" mat-align-tabs=\"start\"' +\n            ' [selectedIndex]=\"ctx.measurementNavIndex\"' +\n            ' (selectedTabChange)=\"ctx.measurementNavChange($event)\">' +\n            tabsHtml +\n        '</mat-tab-group>' +\n    '</div>';\n\n    return '<div class=\"main-layout flex flex-col w-full h-full\">' + header +\n        '<div id=\"power_measurement_wrapper\" class=\"flex-1\">' + tabGroupHtml + '</div></div>';\n}",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js",
                "ecoUtils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "@media screen and (min-width: 599px) {\n  .parameters-section {\n    display: none;\n  }\n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n/*.main-layout .header .title {\n    width: auto;\n    height: 50px;\n    padding-right: 15px; \n    font-size: 18px;\n    font-weight: 500;\n    background-color: #E0E0E0;\n    color: #28232D;\n    display: flex; \n    align-items: center; \n    justify-content: center;\n    gap: 2px;\n    margin-right: 10px;\n    border-radius: 4px;\n}*/\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#reprocess-button, #projects-button, #reports-button, #data-button, #report-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown {\n    width: auto; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown option {\n    width: 500px;\n    background-color: #f0f0f0; /* Example background color */\n    color: #28232D;           /* Text color */\n    font-size: 18px;          /* Font size */\n    font-weight: 500;         /* Font weight */\n    /* Some browsers may support these, others might ignore them: */\n    padding: 5px;\n}\n\n\n#measurement-dropdown:focus {\n    outline: none !important;\n    border: none !important;\n    box-shadow: none !important;\n    outline-offset: 0 !important;\n}\n\n#measurement-dropdown::-moz-focus-inner {\n    border: 0 !important;\n}\n\n\n/* Optional: Anpassung des Hover-Effekts */\n#reprocess-button:hover, #projects-button:hover, #reports-button:hover, #data-button:hover, #report-button:hover, #parameter-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#reprocess-button mat-icon, #projects-button mat-icon, #reports-button mat-icon, #data-button mat-icon, #report-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #data-button und #report-button */\n#reprocess-button span, #projects-button span, #reports-button span, #data-button span, #report-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n\n/* Badge Styling */\n.status-badge {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.status-badge .badge-icon {\n    font-size: 14px !important;\n    width: 14px !important;\n    height: 14px !important;\n}\n\n.status-badge.badge-heating {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-cooling {\n    background: rgba(33, 150, 243, 0.1);\n    color: #2196F3;\n}\n\n.status-badge.badge-type {\n    background: #f5f5f5;\n    color: #333;\n}\n\n.status-badge.badge-normal {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-active {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-preparation {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-finished {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-aborted {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-critical {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-major {\n    background: rgba(255, 152, 0, 0.15);\n    color: #FF9800;\n}\n\n.status-badge.badge-minor {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-disconnected {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-default {\n    background: #f5f5f5;\n    color: #666;\n}\n\n/* Back Button */\n.back-button {\n    min-width: unset !important;\n    padding: 8px 16px !important;\n}\n\n.back-button mat-icon {\n    font-size: 18px !important;\n    margin-right: 6px;\n}\n\n\n/* Measurement Title Block - consistent text colors */\n.measurement-title-block {\n    display: flex;\n    flex-direction: column;\n    gap: 0;\n    min-width: 0;\n}\n.measurement-location-text {\n    font-size: 15px;\n    font-weight: 500;\n    color: #1a1a1a;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 220px;\n    line-height: 1.2;\n}\n.measurement-name-text {\n    font-size: 12px;\n    color: #666666;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 220px;\n    line-height: 1.2;\n}\n\n/* Measurement Switch Button - white text, centered icon */\n.switch-btn {\n    min-width: 44px !important;\n    width: 44px !important;\n    height: 36px !important;\n    padding: 0 !important;\n    border-radius: 4px !important;\n    display: inline-flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    color: white !important;\n}\n.switch-btn mat-icon {\n    margin: 0 !important;\n    color: white !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n}\n\n/* Header Action Buttons - unified 36px height */\n#reprocess-button,\n#parameter-button,\n#projects-button,\n#reports-button {\n    height: 36px !important;\n    min-height: 36px !important;\n    line-height: 36px !important;\n}\n\n\n\n\n\n\n\n\n\n\n\n/* Main Layout - transparent to show grid background */\n.main-layout {\n    width: 100%;\n    height: 100%;\n}\n\n\n\n.measurement-header .header-title {\n    font-size: 1.4em;\n    font-weight: 550;\n    margin-right: 20px;\n    min-width: 150px;\n}\n\n/* Measurement Header - white card with outer margin (top, left, right) */\n.measurement-header {\n    background: #fff;\n    border-radius: 8px;\n    padding: 12px 16px;\n    margin: 10px 10px 0 10px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.08);\n}\n\n\n/* Navigation Bar */\n.measurement-nav-bar {\n    display: flex;\n    gap: 0;\n    background: #fff;\n    margin: 0 10px;\n    border-radius: 8px;\n    padding: 4px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.08);\n}\n\n.nav-tab {\n    display: inline-flex;\n    align-items: center;\n    gap: 8px;\n    padding: 10px 20px;\n    border: none;\n    background: transparent;\n    color: #666;\n    font-size: 14px;\n    font-weight: 500;\n    cursor: pointer;\n    border-radius: 6px;\n    transition: all 0.2s ease;\n}\n\n.nav-tab:hover {\n    background: rgba(0, 0, 0, 0.04);\n    color: #333;\n}\n\n.nav-tab.active {\n    background: var(--tb-primary-500, #305680);\n    color: white;\n}\n\n.nav-tab mat-icon {\n    font-size: 18px;\n    width: 18px;\n    height: 18px;\n}\n\n.nav-tab.active mat-icon {\n    color: white;\n}\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_dashboard",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error('No measurement selected');\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n// Keep only userRole, clear all other params\nparams = {\n    \"userRole\": params.userRole\n};\n\nwidgetContext.stateController.updateState('default', params);"
              },
              {
                "name": "measurement-switch-button",
                "icon": "swap_horiz",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "",
                "type": "customPretty",
                "customHtml": "<div class=\"measurement-switch-dialog\">\n    <mat-toolbar class=\"dialog-header\" color=\"primary\">\n        <div class=\"flex items-center gap-2\">\n            <mat-icon>swap_horiz</mat-icon>\n            <h2 class=\"dialog-title\">{{ 'custom.diagnostics.action.measurement-switch.title' | translate }}</h2>\n        </div>\n        <span class=\"flex-1\"></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon>close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <div class=\"dialog-content\">\n        <div *ngIf=\"loading\" class=\"loading-container\">\n            <mat-spinner diameter=\"40\"></mat-spinner>\n        </div>\n\n        <div *ngIf=\"!loading && measurements.length === 0\" class=\"empty-message\">\n            {{ 'custom.diagnostics.action.measurement-switch.no-measurements' | translate }}\n        </div>\n\n        <div *ngIf=\"!loading\" class=\"measurement-list\">\n            <div *ngFor=\"let m of measurements\"\n                 class=\"measurement-item\"\n                 [class.current]=\"m.isCurrent\"\n                 (click)=\"selectMeasurement(m)\">\n\n                <div class=\"measurement-info\">\n                    <div class=\"measurement-location\">{{ m.locationName || m.entityLabel || 'N/A' }}</div>\n                    <div class=\"measurement-name\">{{ m.entityName }}</div>\n                </div>\n\n                <div class=\"measurement-badges\">\n                    <span class=\"badge badge-type\" [ngClass]=\"'badge-' + m.measurementType\">\n                        {{ m.measurementTypeLabel }}\n                    </span>\n                    <span class=\"badge badge-progress\" [ngClass]=\"'badge-' + m.progress\">\n                        {{ m.progressLabel }}\n                    </span>\n                </div>\n\n                <mat-icon *ngIf=\"m.isCurrent\" class=\"current-indicator\">check_circle</mat-icon>\n            </div>\n        </div>\n    </div>\n</div>",
                "customCss": ".measurement-switch-dialog {\n    width: 450px;\n    max-height: 70vh;\n    display: flex;\n    flex-direction: column;\n    font-family: Roboto, sans-serif;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.dialog-header {\n    display: flex;\n    align-items: center;\n    padding: 0 8px 0 16px;\n    min-height: 52px;\n}\n\n.dialog-title {\n    margin: 0;\n    font-size: 17px;\n    font-weight: 500;\n}\n\n.dialog-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 0; /* No padding - items touch edges */\n}\n\n.loading-container {\n    display: flex;\n    justify-content: center;\n    padding: 32px;\n}\n\n.empty-message {\n    text-align: center;\n    padding: 32px 16px;\n    color: #666;\n}\n\n.measurement-list {\n    display: flex;\n    flex-direction: column;\n}\n\n.measurement-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 14px 20px;\n    cursor: pointer;\n    transition: background-color 0.15s ease;\n    border-bottom: 1px solid #f0f0f0;\n}\n\n.measurement-item:last-child {\n    border-bottom: none;\n}\n\n.measurement-item:hover {\n    background: #f5f5f5;\n}\n\n.measurement-item.current {\n    background: rgba(33, 150, 243, 0.08);\n    cursor: default;\n}\n\n.measurement-item.current:hover {\n    background: rgba(33, 150, 243, 0.08);\n}\n\n.measurement-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.measurement-location {\n    font-size: 15px;\n    font-weight: 500;\n    color: #212529;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.measurement-name {\n    font-size: 12px;\n    color: #6c757d;\n    margin-top: 2px;\n}\n\n.measurement-badges {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 4px;\n}\n\n.badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 2px 8px;\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.badge-ultrasonic {\n    background: #e8f5e9;\n    color: #2e7d32;\n}\n\n.badge-import {\n    background: #fff3e0;\n    color: #ef6c00;\n}\n\n.badge-lorawan {\n    background: #f3e5f5;\n    color: #7b1fa2;\n}\n\n.badge-progress {\n    background: #f5f5f5;\n    color: #616161;\n}\n\n.badge-in-preparation, .badge-in_preparation {\n    background: #fff8e1;\n    color: #f9a825;\n}\n\n.badge-active {\n    background: #e8f5e9;\n    color: #2e7d32;\n}\n\n.badge-finished {\n    background: #e3f2fd;\n    color: #1565c0;\n}\n\n.badge-aborted {\n    background: #ffebee;\n    color: #c62828;\n}\n\n.current-indicator {\n    color: #2196F3;\n    font-size: 20px !important;\n    width: 20px !important;\n    height: 20px !important;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nconst customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nconst attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nconst assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nconst entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nconst currentMeasurementId = entityId;\nconst stateController = widgetContext.stateController;\n\n// Get selectedProject from stateParams\nvar stateParams = stateController.getStateParams() || {};\nvar projectEntityId = stateParams.selectedProject ? stateParams.selectedProject.entityId : null;\n\n\nif (!projectEntityId) {\n    // Fallback: find project via Owns relation from ASSET\n    entityRelationService.findByTo(currentMeasurementId).subscribe(\n        function(relations) {\n            var ownsFromAsset = (relations || []).filter(function(r) {\n                return r.from && r.from.entityType === 'ASSET' && r.type === 'Owns';\n            });\n            if (ownsFromAsset.length > 0) {\n                loadMeasurementsFromProject(ownsFromAsset[0].from);\n            } else {\n                openDialog([]);\n            }\n        },\n        function(error) {\n            openDialog([]);\n        }\n    );\n} else {\n    loadMeasurementsFromProject(projectEntityId);\n}\n\nfunction loadMeasurementsFromProject(projId) {\n    entityRelationService.findByFrom(projId).subscribe(\n        function(relations) {\n            var measurementRels = (relations || []).filter(function(r) {\n                return r.to && r.to.entityType === 'ASSET' && r.type === 'Owns';\n            });\n\n            if (measurementRels.length === 0) {\n                openDialog([]);\n                return;\n            }\n\n            var measurements = [];\n            var completed = 0;\n            var total = measurementRels.length;\n\n            measurementRels.forEach(function(rel) {\n                assetService.getAsset(rel.to.id).subscribe(\n                    function(asset) {\n                        if (asset.type === 'Measurement') {\n                            measurements.push(asset);\n                        }\n                        completed++;\n                        if (completed === total) {\n                            loadAttributes(measurements);\n                        }\n                    },\n                    function(error) {\n                        completed++;\n                        if (completed === total) {\n                            loadAttributes(measurements);\n                        }\n                    }\n                );\n            });\n        },\n        function(error) {\n            openDialog([]);\n        }\n    );\n}\n\nfunction loadAttributes(measurements) {\n    if (!measurements || measurements.length === 0) {\n        openDialog([]);\n        return;\n    }\n\n    var attributeKeys = ['locationName', 'measurementType', 'progress'];\n    var completed = 0;\n    var measurementData = [];\n\n    measurements.forEach(function(m) {\n        attributeService.getEntityAttributes(m.id, 'SERVER_SCOPE', attributeKeys).subscribe(\n            function(attrs) {\n                var attrMap = {};\n                attrs.forEach(function(a) { attrMap[a.key] = a.value; });\n\n                var mType = attrMap.measurementType || '';\n                if (mType === 'import' || mType === 'ultrasonic') {\n                    measurementData.push({\n                        id: m.id,\n                        entityName: m.name,\n                        entityLabel: m.label,\n                        locationName: attrMap.locationName,\n                        measurementType: mType,\n                        progress: attrMap.progress || 'in preparation',\n                        isCurrent: m.id.id === currentMeasurementId.id,\n                    });\n                }\n\n                completed++;\n                if (completed === measurements.length) {\n                    measurementData.sort(function(a, b) {\n                        var aMatch = (a.entityName || '').match(/(\\d+)$/);\n                        var bMatch = (b.entityName || '').match(/(\\d+)$/);\n                        return (aMatch ? parseInt(aMatch[1]) : 0) - (bMatch ? parseInt(bMatch[1]) : 0);\n                    });\n                    openDialog(measurementData);\n                }\n            },\n            function(error) {\n                completed++;\n                if (completed === measurements.length) {\n                    openDialog(measurementData);\n                }\n            }\n        );\n    });\n}\n\nfunction openDialog(measurements) {\n    customDialog.customDialog(htmlTemplate, MeasurementSwitchController, {\n        measurements: measurements,\n        currentMeasurementId: currentMeasurementId,\n        stateController: stateController,\n    }).subscribe();\n}\n\nfunction MeasurementSwitchController(instance) {\n    var vm = instance;\n    var data = vm.data;\n\n    vm.loading = false;\n    vm.measurements = data.measurements.map(function(m) {\n        var typeLabels = { ultrasonic: 'Ultrasonic', import: 'Import' };\n        var progLabels = { 'in preparation': 'In Vorbereitung', active: 'Aktiv', finished: 'Abgeschlossen', aborted: 'Abgebrochen' };\n        return Object.assign({}, m, {\n            measurementTypeLabel: typeLabels[m.measurementType] || m.measurementType,\n            progressLabel: progLabels[m.progress] || m.progress,\n        });\n    });\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.selectMeasurement = function(measurement) {\n        if (measurement.isCurrent) return;\n        var newParams = {\n            selectedMeasurement: {\n                entityId: measurement.id,\n                entityName: measurement.entityName,\n                entityLabel: measurement.entityLabel || measurement.entityName,\n            }\n        };\n        data.stateController.updateState(null, newParams);\n        vm.dialogRef.close(null);\n    };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "8fcbdda7-ca12-4281-94e0-c58a93c9e6eb"
              },
              {
                "name": "analysis-button",
                "icon": "insights",
                "type": "customPretty",
                "customHtml": "<div style=\"width: 400px;\"><mat-toolbar class=\"flex items-center\" color=\"primary\"><mat-icon style=\"margin-right: 12px;\">insights</mat-icon><h2 style=\"margin: 0; font-size: 18px;\">{i18n:custom.diagnostics.analysis.title}</h2><span class=\"flex-1\"></span><button mat-icon-button (click)=\"dialogRef.close()\"><mat-icon>close</mat-icon></button></mat-toolbar><div class=\"p-4\"><p style=\"color: #666;\">{i18n:custom.diagnostics.analysis.placeholder}</p></div></div>",
                "customCss": "",
                "customFunction": "",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "314c3b24-a344-4b52-9e6b-2898869ea7fa"
              },
              {
                "name": "nav-tab-raw",
                "icon": "show_chart",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams.navTab = { active: 'raw' };\nwidgetContext.stateController.updateState(null, params);"
              },
              {
                "name": "nav-tab-load",
                "icon": "speed",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams.navTab = { active: 'load' };\nwidgetContext.stateController.updateState(null, params);"
              },
              {
                "name": "measurement-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "measurement_alarms",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "25vw",
                "popoverHeight": "25vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "05e4081b-b07f-7f72-6dd4-776f995b3840"
              },
              {
                "name": "reprocess-button",
                "icon": "refresh",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error('No measurement selected');\n    return;\n}\n\nprojectWizard.openReprocessDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "cf-reprocess-action-001"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "0"
        },
        "row": 0,
        "col": 0,
        "id": "6ccd99bd-8562-4e6b-e42b-e7f3c026a129"
      },
      "58b917d2-5768-b5f9-1e78-e45c9491f4f5": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 2592000000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": null,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableFilter": true,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "Created time",
                "color": "#2196f3",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.021092237451093787,
                "funcBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758,
                "funcBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418,
                "funcBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418,
                "funcBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "Assignee",
                "color": "#9c27b0",
                "settings": {},
                "_hash": 0.5008441077416634,
                "funcBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "warning",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": true,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "600",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": false,
          "borderRadius": "0px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "58b917d2-5768-b5f9-1e78-e45c9491f4f5"
      },
      "2ffda43e-cad2-521c-6871-338d15b3b4cc": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.projects.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": true,
            "entityNameColumnTitle": "{i18n:custom.diagnostics.project-id.title}",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": false,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.diagnostics.projects.title}",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
              "filterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "{i18n:custom.diagnostics.project-name.title}",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.23547368231999988,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-address.title}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.8348661406382081,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-progress.title}",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getProgressHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.15334267783981326,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "generalReport",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-report.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar description;\r\nvar generalReport = value;\r\nvar status;\r\nif (generalReport == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n  status = 'paid';\r\n  description = '{i18n:custom.diagnostics.report-status.paid.title}';\r\n} else {\r\n  color = '#EB5757';\r\n  status = 'inactive';\r\n  description = '{i18n:custom.diagnostics.report-status.inactive.title}';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>'+ ' ' + description;",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.47896411690699625,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Select Project",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a7ad4745-1f21-49fd-38f4-70825fe6875f"
              }
            ],
            "actionCellButton": [
              {
                "name": "Edit Project",
                "icon": "edit",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<style>\n/* ECO DESIGN SYSTEM - Project Dialog Styles */\n\n/* Header */\n.edit-project-form .eco-dialog-header,\n.add-entity-form .eco-dialog-header,\nmat-toolbar.eco-dialog-header {\n  display: flex !important;\n  align-items: center !important;\n  gap: 12px !important;\n  padding: 0 16px !important;\n  height: 56px !important;\n  min-height: 56px !important;\n  background-color: var(--tb-primary-500) !important;\n  background: var(--tb-primary-500) !important;\n  color: white !important;\n  font-family: \"Roboto\", \"Helvetica Neue\", sans-serif !important;\n}\n.edit-project-form .eco-dialog-header .header-icon,\n.add-entity-form .eco-dialog-header .header-icon,\nmat-toolbar.eco-dialog-header .header-icon {\n  font-size: 24px !important;\n  width: 24px !important;\n  height: 24px !important;\n  color: white !important;\n}\n.edit-project-form .eco-dialog-header .header-title,\n.add-entity-form .eco-dialog-header .header-title,\nmat-toolbar.eco-dialog-header .header-title {\n  margin: 0 !important;\n  font-size: 1.125rem !important;\n  font-weight: 500 !important;\n  letter-spacing: -0.01em !important;\n  color: white !important;\n  flex: 1 !important;\n}\n.edit-project-form .eco-dialog-header .close-btn,\n.add-entity-form .eco-dialog-header .close-btn,\nmat-toolbar.eco-dialog-header .close-btn {\n  color: rgba(255,255,255,0.8) !important;\n  margin-left: auto !important;\n  transition: all 0.2s ease !important;\n}\n.edit-project-form .eco-dialog-header .close-btn:hover,\n.add-entity-form .eco-dialog-header .close-btn:hover,\nmat-toolbar.eco-dialog-header .close-btn:hover {\n  color: white !important;\n  background: rgba(255,255,255,0.1) !important;\n}\n.edit-project-form .eco-dialog-header mat-icon,\n.add-entity-form .eco-dialog-header mat-icon,\nmat-toolbar.eco-dialog-header mat-icon {\n  color: white !important;\n}\n\n/* Content Area */\n.edit-project-form .dialog-content,\n.add-entity-form .dialog-content {\n  padding: 1rem 1.25rem !important;\n  background: #f8fafc !important;\n  display: flex !important;\n  flex-direction: column !important;\n  gap: 0.75rem !important;\n  max-height: calc(90vh - 130px) !important;\n  overflow-y: auto !important;\n  font-family: \"Roboto\", \"Helvetica Neue\", sans-serif !important;\n}\n\n/* Section Cards */\n.edit-project-form .section-card,\n.add-entity-form .section-card {\n  background: white !important;\n  border: 1px solid #e2e8f0 !important;\n  border-left: 3px solid #1976d2 !important;\n  border-radius: 0 !important;\n  overflow: visible !important;\n}\n.edit-project-form .section-header,\n.add-entity-form .section-header {\n  display: flex !important;\n  align-items: center !important;\n  gap: 8px !important;\n  padding: 10px 14px !important;\n  background: #f8fafc !important;\n  border-bottom: 1px solid #e2e8f0 !important;\n  font-weight: 600 !important;\n  font-size: 0.75rem !important;\n  color: #334155 !important;\n  text-transform: uppercase !important;\n  letter-spacing: 0.3px !important;\n}\n.edit-project-form .section-header mat-icon,\n.add-entity-form .section-header mat-icon {\n  font-size: 16px !important;\n  width: 16px !important;\n  height: 16px !important;\n  color: #1976d2 !important;\n}\n.edit-project-form .section-body,\n.add-entity-form .section-body {\n  padding: 12px 14px !important;\n  display: flex !important;\n  flex-direction: column !important;\n  gap: 4px !important;\n}\n\n/* Form field width enforcement */\n.edit-project-form .section-body mat-form-field,\n.add-entity-form .section-body mat-form-field {\n  width: 100% !important;\n}\n.edit-project-form .section-body .mat-mdc-form-field-subscript-wrapper,\n.add-entity-form .section-body .mat-mdc-form-field-subscript-wrapper {\n  margin-bottom: -4px !important;\n}\n\n/* Footer */\n.edit-project-form .dialog-footer,\n.add-entity-form .dialog-footer {\n  display: flex !important;\n  justify-content: flex-end !important;\n  align-items: center !important;\n  gap: 12px !important;\n  padding: 0.75rem 1.25rem !important;\n  border-top: 1px solid rgba(0, 0, 0, 0.06) !important;\n  background: #fafafa !important;\n}\n\n/* Form field input styles */\n.add-entity-form .mdc-text-field--filled,\n.edit-project-form .mdc-text-field--filled {\n  background-color: #F4F9FE !important;\n}\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled,\n.edit-project-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n.add-entity-form .disabled-field input,\n.edit-project-form .disabled-field input {\n  color: rgba(0, 0, 0, 0.6) !important;\n}\n\n/* Image input compact */\n.edit-project-form tb-image-input .tb-image-input-container,\n.add-entity-form tb-image-input .tb-image-input-container {\n  min-height: 50px !important;\n  max-height: 50px !important;\n}\n.edit-project-form tb-image-input .dropzone,\n.add-entity-form tb-image-input .dropzone {\n  min-height: 42px !important;\n  padding: 4px 8px !important;\n  flex-direction: row !important;\n  gap: 8px !important;\n}\n.edit-project-form tb-image-input .dropzone mat-icon,\n.add-entity-form tb-image-input .dropzone mat-icon {\n  font-size: 18px !important;\n  width: 18px !important;\n  height: 18px !important;\n}\n.edit-project-form tb-image-input .dropzone span,\n.add-entity-form tb-image-input .dropzone span {\n  font-size: 11px !important;\n}\n\n/* Utility classes */\n.flex-1 { flex: 1 !important; }\n.w-full { width: 100% !important; }\n.form-row {\n  display: flex !important;\n  gap: 12px !important;\n}\n.form-col {\n  flex: 1 !important;\n  min-width: 0 !important;\n}\n\n/* Dialog container reset */\n.mat-mdc-dialog-container,\n.mat-mdc-dialog-surface,\n.mdc-dialog__surface {\n  border-radius: 0 !important;\n}\n</style>\n<form #editProjectForm=\"ngForm\" [formGroup]=\"editProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"edit-project-form\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"eco-dialog-header\">\n    <mat-icon class=\"header-icon\">edit</mat-icon>\n    <h2 class=\"header-title\">Edit Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\" class=\"close-btn\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n  <div class=\"dialog-content\">\n    <!-- Customer Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>business</mat-icon>\n        <span>Customer</span>\n      </div>\n      <div class=\"section-body\">\n        <mat-form-field appearance=\"fill\" class=\"w-full disabled-field\">\n          <mat-label>Customer</mat-label>\n          <input matInput formControlName=\"customerName\" readonly>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Project Info Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>folder</mat-icon>\n        <span>Project Info</span>\n      </div>\n      <div class=\"section-body\">\n        <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n        <mat-form-field appearance=\"fill\" class=\"w-full disabled-field\">\n          <mat-label>Project ID</mat-label>\n          <input matInput formControlName=\"name\" readonly>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Label</mat-label>\n          <input matInput formControlName=\"entityLabel\">\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Address Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>location_on</mat-icon>\n        <span>Address</span>\n      </div>\n      <div class=\"section-body\">\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Project address</mat-label>\n          <input matInput formControlName=\"address\" [matAutocomplete]=\"addrAuto\" autocomplete=\"off\">\n          <button mat-icon-button matSuffix type=\"button\" (click)=\"searchAddress()\" [disabled]=\"(editProjectFormGroup.get('address').value || '').length < 5\">\n            <mat-icon>search</mat-icon>\n          </button>\n          <mat-autocomplete #addrAuto=\"matAutocomplete\" [displayWith]=\"displayAddressOption\" (optionSelected)=\"onAddressSelected($event.option.value)\">\n            <mat-option *ngFor=\"let opt of addressOptions\" [value]=\"opt\">{{ opt.label }}</mat-option>\n          </mat-autocomplete>\n          <mat-hint *ngIf=\"(editProjectFormGroup.get('address').value || '').length < 5\">Enter at least 5 characters to search</mat-hint>\n        </mat-form-field>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Postal Code</mat-label>\n            <input matInput formControlName=\"postalCode\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\" style=\"flex: 2;\">\n            <mat-label>City</mat-label>\n            <input matInput formControlName=\"city\">\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Latitude</mat-label>\n            <input matInput formControlName=\"latitude\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Longitude</mat-label>\n            <input matInput formControlName=\"longitude\">\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>NAT</mat-label>\n            <input matInput formControlName=\"normOutdoorTemp\" type=\"number\" step=\"0.1\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col disabled-field\">\n            <mat-label>NAT (calculated)</mat-label>\n            <input matInput formControlName=\"normOutdoorTempCalculated\" type=\"number\" step=\"0.1\" readonly>\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n\n    <!-- HDD Settings Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>thermostat</mat-icon>\n        <span>HDD Settings</span>\n      </div>\n      <div class=\"section-body\">\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Heating Limit</mat-label>\n            <input matInput formControlName=\"hddHeatingLimit\" type=\"number\" step=\"0.5\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Indoor Temperature</mat-label>\n            <input matInput formControlName=\"hddIndoorTemp\" type=\"number\" step=\"0.5\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n        </div>\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Reference HDD (Kd/a)</mat-label>\n          <input matInput formControlName=\"hddReference\" type=\"number\" step=\"1\">\n          <span matSuffix>Kd/a</span>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Energy Costs Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>payments</mat-icon>\n        <span>Energy Costs</span>\n      </div>\n      <div class=\"section-body\">\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Energy Price</mat-label>\n            <input matInput formControlName=\"energyPrice\" type=\"number\" step=\"0.01\">\n            <span matSuffix>EUR/kWh</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Demand Charge</mat-label>\n            <input matInput formControlName=\"demandCharge\" type=\"number\" step=\"0.01\">\n            <span matSuffix>EUR/kW/a</span>\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>CO2 Factor</mat-label>\n            <input matInput formControlName=\"co2Factor\" type=\"number\" step=\"0.001\">\n            <span matSuffix>kg&nbsp;CO&#8322;/kWh</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Primary Energy Factor</mat-label>\n            <input matInput formControlName=\"primaryEnergyFactor\" type=\"number\" step=\"0.01\">\n            <span matSuffix>fPE</span>\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n\n    <!-- Status Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>timeline</mat-icon>\n        <span>Status</span>\n      </div>\n      <div class=\"section-body\">\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Progress</mat-label>\n          <mat-select formControlName=\"progress\">\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\n            <mat-option value=\"active\">Active</mat-option>\n            <mat-option value=\"finished\">Finished</mat-option>\n            <mat-option value=\"aborted\">Aborted</mat-option>\n          </mat-select>\n        </mat-form-field>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\" style=\"flex: 1.5;\">\n            <mat-label>Start Date</mat-label>\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Start Time</mat-label>\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\" style=\"flex: 1.5;\">\n            <mat-label>End Date</mat-label>\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>End Time</mat-label>\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"dialog-footer\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editProjectFormGroup.invalid || !editProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>",
                "customCss": "",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\n\n// Load project data and open dialog\nassetService.getAsset(entityId.id).subscribe(project => {\n    // Load project attributes (including status fields)\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE',\n        ['latitude', 'longitude', 'address', 'postalCode', 'city', 'projectPicture', 'progress', 'startTimeMs', 'endTimeMs', 'normOutdoorTemp', 'normOutdoorTempCalculated', 'hddHeatingLimit', 'hddIndoorTemp', 'hddReference', 'energyPrice', 'demandCharge', 'co2Factor', 'primaryEnergyFactor']\n    ).subscribe(attributes => {\n        const attrMap = {};\n        attributes.forEach(a => { attrMap[a.key] = a.value; });\n\n        // Load customer name\n        if (project.customerId && project.customerId.id) {\n            customerService.getCustomer(project.customerId.id).subscribe(customer => {\n                openEditProjectDialog(project, attrMap, customer ? customer.name : 'Unknown');\n            });\n        } else {\n            openEditProjectDialog(project, attrMap, 'Unknown');\n        }\n    });\n});\n\nfunction openEditProjectDialog(project, attrMap, customerName) {\n    customDialog.customDialog(htmlTemplate, EditProjectDialogController).subscribe();\n\n    function EditProjectDialogController(instance) {\n        let vm = instance;\n\n        vm.project = project;\n        vm.attrMap = attrMap;\n\n        // Initialize date values from timestamps\n        let startDate = null;\n        let startTime = null;\n        let endDate = null;\n        let endTime = null;\n\n        if (attrMap.startTimeMs) {\n            const startDateTime = new Date(Number(attrMap.startTimeMs));\n            startDate = startDateTime;\n            startTime = startDateTime;\n        }\n        if (attrMap.endTimeMs) {\n            const endDateTime = new Date(Number(attrMap.endTimeMs));\n            endDate = endDateTime;\n            endTime = endDateTime;\n        }\n\n        vm.editProjectFormGroup = vm.fb.group({\n            customerName: [{ value: customerName, disabled: true }],\n            name: [{ value: project.name, disabled: true }],\n            entityLabel: [project.label || ''],\n            projectPicture: [attrMap.projectPicture || null],\n            // Status fields\n            progress: [attrMap.progress || 'in preparation'],\n            startDate: [startDate],\n            startTime: [startTime],\n            endDate: [endDate],\n            endTime: [endTime],\n            // Address fields\n            address: [attrMap.address || ''],\n            postalCode: [attrMap.postalCode || ''],\n            city: [attrMap.city || ''],\n            latitude: [attrMap.latitude || ''],\n            longitude: [attrMap.longitude || ''],\n            normOutdoorTemp: [attrMap.normOutdoorTemp || null],\n            normOutdoorTempCalculated: [attrMap.normOutdoorTempCalculated || null],\n            hddHeatingLimit: [attrMap.hddHeatingLimit !== undefined ? attrMap.hddHeatingLimit : 12],\n            hddIndoorTemp: [attrMap.hddIndoorTemp !== undefined ? attrMap.hddIndoorTemp : 20],\n            hddReference: [attrMap.hddReference || null],\n            energyPrice: [attrMap.energyPrice || null],\n            demandCharge: [attrMap.demandCharge || null],\n            co2Factor: [attrMap.co2Factor || null],\n            primaryEnergyFactor: [attrMap.primaryEnergyFactor || null]\n        });\n\n        // Auto-set start/end time when progress changes\n        vm.editProjectFormGroup.get('progress').valueChanges.subscribe(function(progress) {\n            const startDateControl = vm.editProjectFormGroup.get('startDate');\n            const startTimeControl = vm.editProjectFormGroup.get('startTime');\n            const endDateControl = vm.editProjectFormGroup.get('endDate');\n            const endTimeControl = vm.editProjectFormGroup.get('endTime');\n\n            if (progress === 'active' && !startDateControl.value && !startTimeControl.value) {\n                const now = new Date();\n                startDateControl.setValue(now);\n                startTimeControl.setValue(now);\n                startDateControl.markAsDirty();\n                startTimeControl.markAsDirty();\n            }\n\n            if ((progress === 'finished' || progress === 'aborted') && !endDateControl.value && !endTimeControl.value) {\n                const now = new Date();\n                endDateControl.setValue(now);\n                endTimeControl.setValue(now);\n                endDateControl.markAsDirty();\n                endTimeControl.markAsDirty();\n            }\n        });\n\n        // --- Address search state ---\n        vm.addressOptions = [];\n        vm._lastSelectedAddressLabel = null;\n\n        vm.displayAddressOption = function(opt) {\n            if (!opt) return '';\n            return (typeof opt === 'string') ? opt : (opt.label || '');\n        };\n\n        vm.searchAddress = function() {\n            const qRaw = vm.editProjectFormGroup.get('address').value || '';\n            const q = (typeof qRaw === 'string') ? qRaw.trim() : vm.displayAddressOption(qRaw).trim();\n            if (q.length < 5) {\n                vm.addressOptions = [];\n                return;\n            }\n            searchAddressViaPhoton(q);\n        };\n\n        vm.onAddressSelected = function(opt) {\n            if (!opt) return;\n            vm._lastSelectedAddressLabel = opt.label;\n\n            const patchData = {\n                address: opt.label,\n                latitude: opt.lat,\n                longitude: opt.lon\n            };\n\n            const currentPostalCode = (vm.editProjectFormGroup.get('postalCode').value || '').trim();\n            const currentCity = (vm.editProjectFormGroup.get('city').value || '').trim();\n\n            if (!currentPostalCode && opt.postcode) {\n                patchData.postalCode = opt.postcode;\n            }\n            if (!currentCity && opt.city) {\n                patchData.city = opt.city;\n            }\n\n            vm.editProjectFormGroup.patchValue(patchData);\n            vm.editProjectFormGroup.get('address').markAsDirty();\n            vm.editProjectFormGroup.get('latitude').markAsDirty();\n            vm.editProjectFormGroup.get('longitude').markAsDirty();\n\n            if (!currentPostalCode && opt.postcode) {\n                vm.editProjectFormGroup.get('postalCode').markAsDirty();\n            }\n            if (!currentCity && opt.city) {\n                vm.editProjectFormGroup.get('city').markAsDirty();\n            }\n\n            vm.addressOptions = [];\n        };\n\n        // --- Debounced auto-search ---\n        let addrTimer = null;\n        let lastQuery = '';\n\n        vm.editProjectFormGroup.get('address').valueChanges.subscribe(val => {\n            if (typeof val === 'string' && vm._lastSelectedAddressLabel && val === vm._lastSelectedAddressLabel) {\n                return;\n            }\n\n            const s = (typeof val === 'string')\n                ? val.trim()\n                : (vm.displayAddressOption(val) || '').trim();\n\n            if (s.length < 5) {\n                vm.addressOptions = [];\n                lastQuery = s;\n                if (addrTimer) {\n                    clearTimeout(addrTimer);\n                    addrTimer = null;\n                }\n                return;\n            }\n\n            if (s === lastQuery) return;\n            lastQuery = s;\n\n            if (addrTimer) clearTimeout(addrTimer);\n            addrTimer = setTimeout(() => {\n                searchAddressViaPhoton(s);\n            }, 350);\n        });\n\n        function searchAddressViaPhoton(query) {\n            const postalCode = (vm.editProjectFormGroup.get('postalCode').value || '').trim();\n            const city = (vm.editProjectFormGroup.get('city').value || '').trim();\n\n            let refinedQuery = query;\n            if (postalCode) refinedQuery += ' ' + postalCode;\n            if (city) refinedQuery += ' ' + city;\n\n            const url = 'https://photon.komoot.io/api?q=' + encodeURIComponent(refinedQuery) + '&limit=5';\n\n            fetch(url)\n                .then(res => {\n                    if (!res.ok) throw new Error('HTTP ' + res.status);\n                    return res.json();\n                })\n                .then(data => {\n                    const features = (data && data.features) ? data.features : [];\n                    vm.addressOptions = features.map(f => {\n                        const p = f.properties || {};\n                        const coords = (f.geometry && f.geometry.coordinates) ? f.geometry.coordinates : [null, null];\n                        const lon = coords[0];\n                        const lat = coords[1];\n\n                        const street = p.street || p.name || '';\n                        const house = p.housenumber ? (' ' + p.housenumber) : '';\n                        const place = (street + house).trim() || (p.label || p.name || '').trim();\n\n                        const cc = (p.countrycode || '').toUpperCase();\n                        const postcode = p.postcode || '';\n                        const cityFromResult = p.city || p.town || p.village || p.state || '';\n\n                        let tail = '';\n                        if (cc || postcode || cityFromResult) {\n                            tail = (cc ? cc : '');\n                            if (cc && postcode) tail += '-' + postcode;\n                            else if (!cc && postcode) tail += postcode;\n                            if ((cc || postcode) && cityFromResult) tail += ' ' + cityFromResult;\n                            else if (!cc && !postcode && cityFromResult) tail += cityFromResult;\n                        }\n\n                        const label = tail ? (place + ', ' + tail) : place;\n\n                        return {\n                            label,\n                            lat: (typeof lat === 'number') ? lat : parseFloat(lat),\n                            lon: (typeof lon === 'number') ? lon : parseFloat(lon),\n                            postcode: postcode,\n                            city: cityFromResult,\n                            raw: f\n                        };\n                    });\n                })\n                .catch(err => {\n                    console.error('Address search failed', err);\n                    vm.addressOptions = [];\n                });\n        }\n\n        vm.cancel = function() {\n            vm.dialogRef.close(null);\n        };\n\n        vm.save = function() {\n            vm.editProjectFormGroup.markAsPristine();\n\n            // Update asset label\n            const formValues = vm.editProjectFormGroup.getRawValue();\n            const updatedProject = {\n                ...vm.project,\n                label: formValues.entityLabel\n            };\n\n            assetService.saveAsset(updatedProject).subscribe(() => {\n                // Build startTimeMs and endTimeMs from date/time pickers\n                let startTimeMs = null;\n                let endTimeMs = null;\n\n                if (formValues.startDate) {\n                    const startDateObj = new Date(formValues.startDate);\n                    if (formValues.startTime) {\n                        const startTimeObj = new Date(formValues.startTime);\n                        startDateObj.setHours(startTimeObj.getHours(), startTimeObj.getMinutes(), startTimeObj.getSeconds());\n                    }\n                    startTimeMs = startDateObj.getTime();\n                }\n\n                if (formValues.endDate) {\n                    const endDateObj = new Date(formValues.endDate);\n                    if (formValues.endTime) {\n                        const endTimeObj = new Date(formValues.endTime);\n                        endDateObj.setHours(endTimeObj.getHours(), endTimeObj.getMinutes(), endTimeObj.getSeconds());\n                    }\n                    endTimeMs = endDateObj.getTime();\n                }\n\n                // Save attributes\n                const attributesArray = [\n                    { key: 'latitude', value: formValues.latitude || vm.attrMap.latitude || 48.1406022 },\n                    { key: 'longitude', value: formValues.longitude || vm.attrMap.longitude || 16.2932688 },\n                    { key: 'address', value: formValues.address || '' },\n                    { key: 'postalCode', value: formValues.postalCode || '' },\n                    { key: 'city', value: formValues.city || '' },\n                    { key: 'progress', value: formValues.progress || 'in preparation' }\n                ];\n\n                if (startTimeMs !== null) {\n                    attributesArray.push({ key: 'startTimeMs', value: startTimeMs });\n                }\n                if (endTimeMs !== null) {\n                    attributesArray.push({ key: 'endTimeMs', value: endTimeMs });\n                }\n\n                if (formValues.projectPicture) {\n                    attributesArray.push({ key: 'projectPicture', value: formValues.projectPicture });\n                }\n\n                // HDD Settings\n                if (formValues.normOutdoorTemp !== null && formValues.normOutdoorTemp !== '') {\n                    attributesArray.push({ key: 'normOutdoorTemp', value: formValues.normOutdoorTemp });\n                }\n                if (formValues.normOutdoorTempCalculated !== null && formValues.normOutdoorTempCalculated !== '') {\n                    attributesArray.push({ key: 'normOutdoorTempCalculated', value: formValues.normOutdoorTempCalculated });\n                }\n                if (formValues.hddHeatingLimit !== null && formValues.hddHeatingLimit !== '') {\n                    attributesArray.push({ key: 'hddHeatingLimit', value: formValues.hddHeatingLimit });\n                }\n                if (formValues.hddIndoorTemp !== null && formValues.hddIndoorTemp !== '') {\n                    attributesArray.push({ key: 'hddIndoorTemp', value: formValues.hddIndoorTemp });\n                }\n                if (formValues.hddReference !== null && formValues.hddReference !== '') {\n                    attributesArray.push({ key: 'hddReference', value: formValues.hddReference });\n                }\n                // Energy Costs\n                if (formValues.energyPrice !== null && formValues.energyPrice !== '') {\n                    attributesArray.push({ key: 'energyPrice', value: formValues.energyPrice });\n                }\n                if (formValues.demandCharge !== null && formValues.demandCharge !== '') {\n                    attributesArray.push({ key: 'demandCharge', value: formValues.demandCharge });\n                }\n                if (formValues.co2Factor !== null && formValues.co2Factor !== '') {\n                    attributesArray.push({ key: 'co2Factor', value: formValues.co2Factor });\n                }\n                if (formValues.primaryEnergyFactor !== null && formValues.primaryEnergyFactor !== '') {\n                    attributesArray.push({ key: 'primaryEnergyFactor', value: formValues.primaryEnergyFactor });\n                }\n\n                attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', attributesArray).subscribe(() => {\n                    widgetContext.updateAliases();\n                    vm.dialogRef.close(null);\n                });\n            });\n        };\n    }\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8f12b3a-4c5d-9e7f-a1b2-3c4d5e6f7890"
              },
              {
                "name": "Project Wizard",
                "icon": "rocket_launch",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return data.progress === 'in preparation' || data.progress === 'active';",
                "type": "customPretty",
                "customHtml": "",
                "customCss": "",
                "customFunction": {
                  "body": "// Use the Project Wizard library with dataImporter for device assignment\nprojectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n    widgetContext.updateAliases();\n}, { dataImporter: dataImporter });\n",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                    "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9848fd08-5b93-6f97-dc69-65e325748065"
              }
            ],
            "headerButton": [
              {
                "name": "Connect",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "addchart",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.dataConnectorDialog(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3c824487-b796-a41c-5d9e-7eca11e18a04"
              },
              {
                "name": "Project",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<style>\n/* ECO DESIGN SYSTEM - Project Dialog Styles */\n\n/* Header */\n.edit-project-form .eco-dialog-header,\n.add-entity-form .eco-dialog-header,\nmat-toolbar.eco-dialog-header {\n  display: flex !important;\n  align-items: center !important;\n  gap: 12px !important;\n  padding: 0 16px !important;\n  height: 56px !important;\n  min-height: 56px !important;\n  background-color: var(--tb-primary-500) !important;\n  background: var(--tb-primary-500) !important;\n  color: white !important;\n  font-family: \"Roboto\", \"Helvetica Neue\", sans-serif !important;\n}\n.edit-project-form .eco-dialog-header .header-icon,\n.add-entity-form .eco-dialog-header .header-icon,\nmat-toolbar.eco-dialog-header .header-icon {\n  font-size: 24px !important;\n  width: 24px !important;\n  height: 24px !important;\n  color: white !important;\n}\n.edit-project-form .eco-dialog-header .header-title,\n.add-entity-form .eco-dialog-header .header-title,\nmat-toolbar.eco-dialog-header .header-title {\n  margin: 0 !important;\n  font-size: 1.125rem !important;\n  font-weight: 500 !important;\n  letter-spacing: -0.01em !important;\n  color: white !important;\n  flex: 1 !important;\n}\n.edit-project-form .eco-dialog-header .close-btn,\n.add-entity-form .eco-dialog-header .close-btn,\nmat-toolbar.eco-dialog-header .close-btn {\n  color: rgba(255,255,255,0.8) !important;\n  margin-left: auto !important;\n  transition: all 0.2s ease !important;\n}\n.edit-project-form .eco-dialog-header .close-btn:hover,\n.add-entity-form .eco-dialog-header .close-btn:hover,\nmat-toolbar.eco-dialog-header .close-btn:hover {\n  color: white !important;\n  background: rgba(255,255,255,0.1) !important;\n}\n.edit-project-form .eco-dialog-header mat-icon,\n.add-entity-form .eco-dialog-header mat-icon,\nmat-toolbar.eco-dialog-header mat-icon {\n  color: white !important;\n}\n\n/* Content Area */\n.edit-project-form .dialog-content,\n.add-entity-form .dialog-content {\n  padding: 1rem 1.25rem !important;\n  background: #f8fafc !important;\n  display: flex !important;\n  flex-direction: column !important;\n  gap: 0.75rem !important;\n  max-height: calc(90vh - 130px) !important;\n  overflow-y: auto !important;\n  font-family: \"Roboto\", \"Helvetica Neue\", sans-serif !important;\n}\n\n/* Section Cards */\n.edit-project-form .section-card,\n.add-entity-form .section-card {\n  background: white !important;\n  border: 1px solid #e2e8f0 !important;\n  border-left: 3px solid #1976d2 !important;\n  border-radius: 0 !important;\n  overflow: visible !important;\n}\n.edit-project-form .section-header,\n.add-entity-form .section-header {\n  display: flex !important;\n  align-items: center !important;\n  gap: 8px !important;\n  padding: 10px 14px !important;\n  background: #f8fafc !important;\n  border-bottom: 1px solid #e2e8f0 !important;\n  font-weight: 600 !important;\n  font-size: 0.75rem !important;\n  color: #334155 !important;\n  text-transform: uppercase !important;\n  letter-spacing: 0.3px !important;\n}\n.edit-project-form .section-header mat-icon,\n.add-entity-form .section-header mat-icon {\n  font-size: 16px !important;\n  width: 16px !important;\n  height: 16px !important;\n  color: #1976d2 !important;\n}\n.edit-project-form .section-body,\n.add-entity-form .section-body {\n  padding: 12px 14px !important;\n  display: flex !important;\n  flex-direction: column !important;\n  gap: 4px !important;\n}\n\n/* Form field width enforcement */\n.edit-project-form .section-body mat-form-field,\n.add-entity-form .section-body mat-form-field {\n  width: 100% !important;\n}\n.edit-project-form .section-body .mat-mdc-form-field-subscript-wrapper,\n.add-entity-form .section-body .mat-mdc-form-field-subscript-wrapper {\n  margin-bottom: -4px !important;\n}\n\n/* Footer */\n.edit-project-form .dialog-footer,\n.add-entity-form .dialog-footer {\n  display: flex !important;\n  justify-content: flex-end !important;\n  align-items: center !important;\n  gap: 12px !important;\n  padding: 0.75rem 1.25rem !important;\n  border-top: 1px solid rgba(0, 0, 0, 0.06) !important;\n  background: #fafafa !important;\n}\n\n/* Form field input styles */\n.add-entity-form .mdc-text-field--filled,\n.edit-project-form .mdc-text-field--filled {\n  background-color: #F4F9FE !important;\n}\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled,\n.edit-project-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n.add-entity-form .disabled-field input,\n.edit-project-form .disabled-field input {\n  color: rgba(0, 0, 0, 0.6) !important;\n}\n\n/* Image input compact */\n.edit-project-form tb-image-input .tb-image-input-container,\n.add-entity-form tb-image-input .tb-image-input-container {\n  min-height: 50px !important;\n  max-height: 50px !important;\n}\n.edit-project-form tb-image-input .dropzone,\n.add-entity-form tb-image-input .dropzone {\n  min-height: 42px !important;\n  padding: 4px 8px !important;\n  flex-direction: row !important;\n  gap: 8px !important;\n}\n.edit-project-form tb-image-input .dropzone mat-icon,\n.add-entity-form tb-image-input .dropzone mat-icon {\n  font-size: 18px !important;\n  width: 18px !important;\n  height: 18px !important;\n}\n.edit-project-form tb-image-input .dropzone span,\n.add-entity-form tb-image-input .dropzone span {\n  font-size: 11px !important;\n}\n\n/* Utility classes */\n.flex-1 { flex: 1 !important; }\n.w-full { width: 100% !important; }\n.form-row {\n  display: flex !important;\n  gap: 12px !important;\n}\n.form-col {\n  flex: 1 !important;\n  min-width: 0 !important;\n}\n\n/* Dialog container reset */\n.mat-mdc-dialog-container,\n.mat-mdc-dialog-surface,\n.mdc-dialog__surface {\n  border-radius: 0 !important;\n}\n</style>\n<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"eco-dialog-header\">\n    <mat-icon class=\"header-icon\">folder_open</mat-icon>\n    <h2 class=\"header-title\">Add Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\" class=\"close-btn\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n  <div class=\"dialog-content\">\n    <!-- Customer Section -->\n    <div *ngIf=\"isTenantAdmin\" class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>business</mat-icon>\n        <span>Customer</span>\n      </div>\n      <div class=\"section-body\">\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Customer</mat-label>\n          <mat-select formControlName=\"customer\" (selectionChange)=\"onCustomerChange()\" required>\n            <mat-option *ngFor=\"let c of customers\" [value]=\"c\">{{ c.name }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"addProjectFormGroup.get('customer')?.hasError('required')\">Customer is required.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Project Info Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>folder</mat-icon>\n        <span>Project Info</span>\n      </div>\n      <div class=\"section-body\">\n        <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n        <mat-form-field appearance=\"fill\" class=\"w-full disabled-field\">\n          <mat-label>Project ID</mat-label>\n          <input matInput formControlName=\"name\" required readonly>\n          <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">Project title is required.</mat-error>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Label</mat-label>\n          <input matInput formControlName=\"entityLabel\">\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Address Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>location_on</mat-icon>\n        <span>Address</span>\n      </div>\n      <div class=\"section-body\">\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Project address</mat-label>\n          <input matInput formControlName=\"address\" [matAutocomplete]=\"addrAuto\" autocomplete=\"off\">\n          <button mat-icon-button matSuffix type=\"button\" (click)=\"searchAddress()\" [disabled]=\"(addProjectFormGroup.get('address').value || '').length < 5\">\n            <mat-icon>search</mat-icon>\n          </button>\n          <mat-autocomplete #addrAuto=\"matAutocomplete\" [displayWith]=\"displayAddressOption\" (optionSelected)=\"onAddressSelected($event.option.value)\">\n            <mat-option *ngFor=\"let opt of addressOptions\" [value]=\"opt\">{{ opt.label }}</mat-option>\n          </mat-autocomplete>\n          <mat-hint *ngIf=\"(addProjectFormGroup.get('address').value || '').length < 5\">Enter at least 5 characters to search</mat-hint>\n        </mat-form-field>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Postal Code</mat-label>\n            <input matInput formControlName=\"postalCode\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\" style=\"flex: 2;\">\n            <mat-label>City</mat-label>\n            <input matInput formControlName=\"city\">\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Latitude</mat-label>\n            <input matInput formControlName=\"latitude\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Longitude</mat-label>\n            <input matInput formControlName=\"longitude\">\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>NAT</mat-label>\n            <input matInput formControlName=\"normOutdoorTemp\" type=\"number\" step=\"0.1\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col disabled-field\">\n            <mat-label>NAT (calculated)</mat-label>\n            <input matInput formControlName=\"normOutdoorTempCalculated\" type=\"number\" step=\"0.1\" readonly>\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n  \n\n    <!-- HDD Settings Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>thermostat</mat-icon>\n        <span>HDD Settings</span>\n      </div>\n      <div class=\"section-body\">\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Heating Limit</mat-label>\n            <input matInput formControlName=\"hddHeatingLimit\" type=\"number\" step=\"0.5\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Indoor Temperature</mat-label>\n            <input matInput formControlName=\"hddIndoorTemp\" type=\"number\" step=\"0.5\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n        </div>\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Reference HDD (Kd/a)</mat-label>\n          <input matInput formControlName=\"hddReference\" type=\"number\" step=\"1\">\n          <span matSuffix>Kd/a</span>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Energy Costs Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>payments</mat-icon>\n        <span>Energy Costs</span>\n      </div>\n      <div class=\"section-body\">\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Energy Price</mat-label>\n            <input matInput formControlName=\"energyPrice\" type=\"number\" step=\"0.01\">\n            <span matSuffix>EUR/kWh</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Demand Charge</mat-label>\n            <input matInput formControlName=\"demandCharge\" type=\"number\" step=\"0.01\">\n            <span matSuffix>EUR/kW/a</span>\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>CO2 Factor</mat-label>\n            <input matInput formControlName=\"co2Factor\" type=\"number\" step=\"0.001\">\n            <span matSuffix>kg&nbsp;CO&#8322;/kWh</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Primary Energy Factor</mat-label>\n            <input matInput formControlName=\"primaryEnergyFactor\" type=\"number\" step=\"0.01\">\n            <span matSuffix>fPE</span>\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"dialog-footer\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>",
                "customCss": "",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\n\nlet shortNameAttr;\nlet customerShortName;\nlet nextProjectId = 0;\n\nconst ctx = widgetContext;\nconst isTenantAdmin = ctx.currentUser.authority === 'TENANT_ADMIN';\n\nlet customers = [];\nlet customerId;\nlet customerName;\n\n// DEBUG: Log currentUser structure\nconsole.log('DEBUG currentUser:', JSON.stringify(ctx.currentUser, null, 2));\n\n// FIX: Fr Customer Users den Customer direkt aus currentUser laden\nif (!isTenantAdmin) {\n    // customerId kann verschiedene Strukturen haben:\n    // - String: \"uuid\"\n    // - Objekt: {id: \"uuid\", entityType: \"CUSTOMER\"}\n    // - Objekt: {entityType: \"CUSTOMER\", id: \"uuid\"}\n    const rawCustomerId = ctx.currentUser.customerId;\n    console.log('DEBUG rawCustomerId:', rawCustomerId, 'type:', typeof rawCustomerId);\n\n    let customerIdString;\n    if (typeof rawCustomerId === 'string') {\n        customerIdString = rawCustomerId;\n        customerId = { id: rawCustomerId, entityType: 'CUSTOMER' };\n    } else if (rawCustomerId && rawCustomerId.id) {\n        customerIdString = rawCustomerId.id;\n        customerId = rawCustomerId;\n    } else {\n        console.error('Cannot determine customerId from currentUser:', rawCustomerId);\n    }\n\n    console.log('DEBUG customerIdString:', customerIdString);\n    console.log('DEBUG customerId object:', customerId);\n\n    if (customerIdString) {\n        customerService.getCustomer(customerIdString).subscribe(\n            customer => {\n                customerName = customer.name;\n                customers = [customer];\n                console.log('Loaded customer:', customerName);\n                openAddProjectDialog();\n            },\n            error => {\n                console.error('Failed to load customer:', error);\n                // Fallback: Try getUserCustomers\n                const pageLink = ctx.pageLink(1000, 0, null, null, null);\n                customerService.getUserCustomers(pageLink).subscribe(pageData => {\n                    customers = (pageData && pageData.data) ? pageData.data : [];\n                    if (customers.length > 0) {\n                        const c = customers[0];\n                        customerId = { id: c.id.id, entityType: 'CUSTOMER' };\n                        customerName = c.name;\n                    }\n                    openAddProjectDialog();\n                });\n            }\n        );\n    } else {\n        // Fallback wenn customerId nicht ermittelt werden kann\n        const pageLink = ctx.pageLink(1000, 0, null, null, null);\n        customerService.getUserCustomers(pageLink).subscribe(pageData => {\n            customers = (pageData && pageData.data) ? pageData.data : [];\n            if (customers.length > 0) {\n                const c = customers[0];\n                customerId = { id: c.id.id, entityType: 'CUSTOMER' };\n                customerName = c.name;\n            }\n            openAddProjectDialog();\n        });\n    }\n} else {\n    // Fr Tenant Admin: alle Customers laden\n    const pageLink = ctx.pageLink(1000, 0, null, null, null);\n    customerService.getUserCustomers(pageLink).subscribe(pageData => {\n        customers = (pageData && pageData.data) ? pageData.data : [];\n        openAddProjectDialog();\n    });\n}\n\nfunction getLastProjectId(projects) {\n    let maxNumber = 0;\n    projects.forEach(item => {\n        const name = item.name;\n        const parts = name.split('_');\n        if (parts.length === 2) {\n            const number = parseInt(parts[1], 10);\n            if (number > maxNumber) {\n                maxNumber = number;\n            }\n        }\n    });\n    const nextProjectId = maxNumber + 1;\n    return nextProjectId;\n}\n\nfunction openAddProjectDialog() {\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\n}\n\nfunction AddProjectDialogController(instance) {\n  let vm = instance;\n\n  vm.isTenantAdmin = isTenantAdmin;\n  vm.customers = customers;\n\n  vm.addProjectFormGroup = vm.fb.group({\n      customer: [{ value: null, disabled: !isTenantAdmin }, vm.validators.required],\n      name: [{ value: '', disabled: true }, vm.validators.required],\n      entityLabel: [''],\n      projectPicture: [null],\n      address: [''],\n      postalCode: [''],\n      city: [''],\n      latitude: [''],\n      longitude: [''],\n      normOutdoorTemp: [null],\n      normOutdoorTempCalculated: [null],\n      hddHeatingLimit: [12],\n      hddIndoorTemp: [20],\n      hddReference: [null],\n      energyPrice: [null],\n      demandCharge: [null],\n      co2Factor: [null],\n      primaryEnergyFactor: [null]\n  });\n\n  // --- Address search state ---\n  vm.addressOptions = [];\n  vm._lastSelectedAddressLabel = null;\n\n  vm.displayAddressOption = function (opt) {\n    if (!opt) return '';\n    return (typeof opt === 'string') ? opt : (opt.label || '');\n  };\n\n  vm.searchAddress = function () {\n    const qRaw = vm.addProjectFormGroup.get('address').value || '';\n    const q = (typeof qRaw === 'string') ? qRaw.trim() : vm.displayAddressOption(qRaw).trim();\n\n    if (q.length < 5) {\n      vm.addressOptions = [];\n      return;\n    }\n\n    searchAddressViaPhoton(q);\n  };\n\n  vm.onAddressSelected = function (opt) {\n    if (!opt) return;\n\n    vm._lastSelectedAddressLabel = opt.label;\n\n    const patchData = {\n      address: opt.label,\n      latitude: opt.lat,\n      longitude: opt.lon\n    };\n\n    const currentPostalCode = (vm.addProjectFormGroup.get('postalCode').value || '').trim();\n    const currentCity = (vm.addProjectFormGroup.get('city').value || '').trim();\n\n    if (!currentPostalCode && opt.postcode) {\n      patchData.postalCode = opt.postcode;\n    }\n    if (!currentCity && opt.city) {\n      patchData.city = opt.city;\n    }\n\n    vm.addProjectFormGroup.patchValue(patchData);\n\n    vm.addProjectFormGroup.get('address').markAsDirty();\n    vm.addProjectFormGroup.get('latitude').markAsDirty();\n    vm.addProjectFormGroup.get('longitude').markAsDirty();\n\n    if (!currentPostalCode && opt.postcode) {\n      vm.addProjectFormGroup.get('postalCode').markAsDirty();\n    }\n    if (!currentCity && opt.city) {\n      vm.addProjectFormGroup.get('city').markAsDirty();\n    }\n\n    vm.addressOptions = [];\n  };\n\n  // --- Debounced auto-search without rxjs operators ---\n  let addrTimer = null;\n  let lastQuery = '';\n\n  vm.addProjectFormGroup.get('address').valueChanges.subscribe(val => {\n    if (typeof val === 'string' && vm._lastSelectedAddressLabel && val === vm._lastSelectedAddressLabel) {\n      return;\n    }\n\n    const s = (typeof val === 'string')\n      ? val.trim()\n      : (vm.displayAddressOption(val) || '').trim();\n\n    if (s.length < 5) {\n      vm.addressOptions = [];\n      lastQuery = s;\n      if (addrTimer) {\n        clearTimeout(addrTimer);\n        addrTimer = null;\n      }\n      return;\n    }\n\n    if (s === lastQuery) {\n      return;\n    }\n    lastQuery = s;\n\n    if (addrTimer) {\n      clearTimeout(addrTimer);\n    }\n    addrTimer = setTimeout(() => {\n      searchAddressViaPhoton(s);\n    }, 350);\n  });\n\n\n  function searchAddressViaPhoton(query) {\n    const postalCode = (vm.addProjectFormGroup.get('postalCode').value || '').trim();\n    const city = (vm.addProjectFormGroup.get('city').value || '').trim();\n\n    let refinedQuery = query;\n    if (postalCode) {\n      refinedQuery += ' ' + postalCode;\n    }\n    if (city) {\n      refinedQuery += ' ' + city;\n    }\n\n    const url =\n      'https://photon.komoot.io/api' +\n      '?q=' + encodeURIComponent(refinedQuery) +\n      '&limit=5';\n\n    fetch(url)\n      .then(res => {\n        if (!res.ok) throw new Error('HTTP ' + res.status);\n        return res.json();\n      })\n      .then(data => {\n        const features = (data && data.features) ? data.features : [];\n\n        vm.addressOptions = features.map(f => {\n          const p = f.properties || {};\n          const coords = (f.geometry && f.geometry.coordinates) ? f.geometry.coordinates : [null, null];\n          const lon = coords[0];\n          const lat = coords[1];\n\n          const street = p.street || p.name || '';\n          const house = p.housenumber ? (' ' + p.housenumber) : '';\n          const place = (street + house).trim() || (p.label || p.name || '').trim();\n\n          const cc = (p.countrycode || '').toUpperCase();\n          const postcode = p.postcode || '';\n          const cityFromResult = p.city || p.town || p.village || p.state || '';\n\n          let tail = '';\n          if (cc || postcode || cityFromResult) {\n            tail = (cc ? cc : '');\n            if (cc && postcode) tail += '-' + postcode;\n            else if (!cc && postcode) tail += postcode;\n            if ((cc || postcode) && cityFromResult) tail += ' ' + cityFromResult;\n            else if (!cc && !postcode && cityFromResult) tail += cityFromResult;\n          }\n\n          const label = tail ? (place + ', ' + tail) : place;\n\n          return {\n            label,\n            lat: (typeof lat === 'number') ? lat : parseFloat(lat),\n            lon: (typeof lon === 'number') ? lon : parseFloat(lon),\n            postcode: postcode,\n            city: cityFromResult,\n            raw: f\n          };\n        });\n      })\n      .catch(err => {\n        console.error('Address search failed', err);\n        vm.addressOptions = [];\n      });\n  }\n\n\n  // FIX: Customer User: Wenn customerId bereits gesetzt ist, Customer Daten laden\n  if (!isTenantAdmin && customerId) {\n      vm.addProjectFormGroup.patchValue({\n          customer: customers[0]\n      });\n      vm.addProjectFormGroup.get('customer').markAsDirty();\n      loadCustomerData(customerId);\n  }\n\n\n  vm.onCustomerChange = function () {\n      const c = vm.addProjectFormGroup.value.customer;\n      if (!c) return;\n\n      customerId = {\n          id: c.id.id,\n          entityType: 'CUSTOMER'\n      };\n      customerName = c.name;\n\n      loadCustomerData(customerId);\n  };\n\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function () {\n    vm.addProjectFormGroup.markAsPristine();\n    saveProjectObservable(customerId).subscribe(\n      function (Project) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToProjectRelation(customerId, Project.id),\n              saveAttributes(Project.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedProject = params['selectedProject'];\n                params['selectedProject'] = { entityId: Project.id, entityName: Project.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function loadCustomerData(customerId) {\n\n      let assetSearchQuery = {\n          parameters: {\n              rootId: customerId.id,\n              rootType: 'CUSTOMER',\n              direction: 'FROM',\n              relationTypeGroup: 'COMMON',\n              maxLevel: 10,\n              fetchLastLevelOnly: false\n          },\n          relationType: 'Owns',\n          assetTypes: ['Project']\n      };\n\n      assetService.findByQuery(assetSearchQuery).subscribe(projects => {\n\n          nextProjectId = getLastProjectId(projects);\n\n          attributeService\n              .getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName'])\n              .subscribe(attributes => {\n\n                  const shortNameAttr = attributes.find(a => a.key === 'shortName');\n                  customerShortName = shortNameAttr\n                      ? shortNameAttr.value\n                      : customerName;\n\n                  vm.addProjectFormGroup.patchValue({\n                      name: customerShortName + '_' + nextProjectId\n                  });\n\n                  vm.addProjectFormGroup.get('name').markAsDirty();\n              });\n      });\n  }\n\n  function saveProjectObservable(customerId) {\n    return getProjectsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((ProjectsGroup) => {\n            const formValues = vm.addProjectFormGroup.getRawValue();\n            let Project = {\n              name: formValues.name,\n              type: 'Project',\n              label: formValues.entityLabel,\n              customerId: customerId\n            };\n            return assetService.saveAsset(Project, ProjectsGroup.id.id)\n        })\n    );\n  }\n\n  function getProjectsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\n              if (ProjectsGroup) {\n                  return widgetContext.rxjs.of(ProjectsGroup);\n              } else {\n                  ProjectsGroup = {\n                      type: 'ASSET',\n                      name: 'Projects',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(ProjectsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToProjectRelation(customerId, ProjectId) {\n      var relation = {\n          from: customerId,\n          to: ProjectId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n\n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'latitude',\n            value: vm.addProjectFormGroup.value.latitude || 48.1406022\n        },\n        {\n            key: 'longitude',\n            value: vm.addProjectFormGroup.value.longitude || 16.2932688\n        },\n        {\n            key: 'address',\n            value: vm.addProjectFormGroup.value.address\n        },\n        {\n            key: 'progress',\n            value: 'in preparation'\n        },\n        {\n            key: 'units',\n            value: 'metric'\n        }\n    ];\n    if (vm.addProjectFormGroup.value.projectPicture) {\n        attributesArray.push({\n            key: 'projectPicture',\n            value: vm.addProjectFormGroup.value.projectPicture\n        });\n    }\n\n    // NAT + HDD + Energy attributes\n    var formVals = vm.addProjectFormGroup.value;\n    ['normOutdoorTemp', 'normOutdoorTempCalculated', 'hddHeatingLimit', 'hddIndoorTemp', 'hddReference', 'energyPrice', 'demandCharge', 'co2Factor', 'primaryEnergyFactor'].forEach(function(k) {\n      if (formVals[k] !== null && formVals[k] !== '' && formVals[k] !== undefined) {\n        attributesArray.push({key: k, value: formVals[k]});\n      }\n    });\n\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2c6e09e8-98b9-f1ca-0a64-7cce095767a2"
              }
            ],
            "rowDoubleClick": []
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "pageSize": 1024,
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "titleIcon": null,
          "iconColor": null,
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "2ffda43e-cad2-521c-6871-338d15b3b4cc",
        "typeFullFqn": "system.cards.entities_table"
      },
      "b84de4e1-8a84-b5cc-6b10-19292fefbb45": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8057369620518648
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.49953012506084726
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.21088975870489435
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5157976480659352
                },
                {
                  "name": "batteryLevel",
                  "type": "timeseries",
                  "label": "batteryLevel",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.1659349558331873
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.20684451568213258,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.5554495301365088
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.821480189837247
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.31692184501390863
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.14141450952611212
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.8059477883579055
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.2956125596069572
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "timeseries",
                  "label": "minorAlarmsCount",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.039182258695658834
                },
                {
                  "name": "warningAlarmsCount",
                  "type": "timeseries",
                  "label": "warningAlarmsCount",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.5585708987708259
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": {
              "body": "var name, label, address, progress, state;\nvar criticalCount, majorCount, minorCount, warningCount;\n\nif (data && data.length) {\n    name = data[0]['entityName'] || 'N/A';\n    label = data[0]['Label'] || 'N/A';\n    address = data[0]['address'] || 'N/A';\n    progress = data[0]['progress'] || 'N/A';\n    state = data[0]['state'] || 'normal';\n    criticalCount = parseInt(data[0]['criticalAlarmsCount']) || 0;\n    majorCount = parseInt(data[0]['majorAlarmsCount']) || 0;\n    minorCount = parseInt(data[0]['minorAlarmsCount']) || 0;\n    warningCount = parseInt(data[0]['warningAlarmsCount']) || 0;\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    address = 'N/A';\n    progress = 'N/A';\n    state = 'normal';\n    criticalCount = 0;\n    majorCount = 0;\n    minorCount = 0;\n    warningCount = 0;\n}\n\n// Calculate total alarms and create alarm badge\nvar totalAlarms = criticalCount + majorCount + minorCount + warningCount;\nvar alarmBadge = utils.createAlarmBadgeHtml(state, totalAlarms, 'project-alarms');\n\n// Inject hover animation styles\n(function injectStyles() {\n    var styleId = 'project-header-alarm-style';\n    if (document.getElementById(styleId)) return;\n\n    var css = '.state-alarm-card:hover { transform: scale(1.02); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }';\n\n    var styleEl = document.createElement('style');\n    styleEl.id = styleId;\n    styleEl.type = 'text/css';\n    styleEl.appendChild(document.createTextNode(css));\n    document.head.appendChild(styleEl);\n})();\n\n// Project header with Progress + Alarm Badge together, and buttons on right\nvar header = '<div class=\"project-header\" style=\"display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: #fafafa; border: 1px solid #e0e0e0; border-radius: 8px;\">' +\n  '<div style=\"display: flex; flex-direction: column; gap: 4px;\">' +\n    '<div style=\"display: flex; align-items: center; gap: 12px;\">' +\n      '<span style=\"font-weight: 600; font-size: 16px; color: #333;\">' + name + '</span>' +\n      '<span style=\"font-size: 13px; color: #666;\">' + label + '</span>' +\n    '</div>' +\n    '<div style=\"display: flex; align-items: center; gap: 12px; margin-top: 4px;\">' +\n      '<div style=\"display: flex; align-items: center; gap: 8px;\">' +\n        '<mat-icon style=\"font-size: 16px; width: 16px; height: 16px; color: #666;\">location_on</mat-icon>' +\n        '<span style=\"font-size: 12px; color: #666;\">' + address + '</span>' +\n      '</div>' +\n      '<div style=\"margin-left: 16px;\">' + utils.getProgressHtml(progress) + '</div>' +\n      '<div style=\"margin-left: 8px;\">' + alarmBadge + '</div>' +\n    '</div>' +\n  '</div>' +\n  '<div style=\"display: flex; align-items: center; gap: 8px;\">' +\n    '<button id=\"go-back\" type=\"button\" mat-raised-button class=\"header-btn-secondary\">' +\n      '<mat-icon>arrow_back</mat-icon>' +\n      '<span>{i18n:custom.diagnostics.action.go-back.title}</span>' +\n    '</button>' +\n    '<button id=\"open-project-wizard\" type=\"button\" mat-raised-button class=\"header-btn-primary\">' +\n      '<mat-icon>rocket_launch</mat-icon>' +\n      '<span>Project Wizard</span>' +\n    '</button>' +\n  '</div>' +\n'</div>';\n\nreturn header;",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js",
                "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".project-header {\n    background: #fafafa !important;\n    border: 1px solid #e0e0e0 !important;\n    border-radius: 8px !important;\n}\n.project-header .header-btn-primary {\n    background-color: var(--tb-primary-500) !important;\n    color: white !important;\n}\n.project-header .header-btn-primary:hover {\n    background-color: var(--tb-primary-600) !important;\n}\n.project-header .header-btn-secondary {\n    background-color: var(--tb-primary-500) !important;\n    color: white !important;\n}\n.project-header .header-btn-secondary:hover {\n    background-color: var(--tb-primary-600) !important;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "37e5e007-da10-e64c-be1e-899094481e42",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\nparams['selectedProject'] = null;\nparams['targetStateParameter'] = null;\n\nparams = {\n    \"userRole\": params.userRole\n};\n\nwidgetContext.stateController.updateState(null, params);"
              },
              {
                "name": "settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#settings', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getSettingsState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '400px', getSettingsHeight(type));\n\nfunction getSettingsState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_settings';\n        case 'Room Sensor T':            \n            return 'roomsensort_settings';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_settings';                      \n        case 'Door Sensor':\n            return 'door_settings';\n        case 'Motion Sensor':\n            return 'motion_sensor_settings';\n        case 'Occupancy Sensor':\n            return 'occupancy_sensor_settings';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getSettingsHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '800px';\n        case 'Room Sensor T':            \n            return '600px';\n        case 'Room Sensor CO2':            \n            return '800px';                  \n        case 'Door Sensor':\n            return '500px';\n        case 'Motion Sensor':\n            return '340px';\n        case 'Occupancy Sensor':\n            return '500px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "076da598-f2dc-6fda-6744-db268a4c6df7"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery_level_details",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "44417062-4a4f-0479-0042-93952e15436a"
              },
              {
                "name": "details-full",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\n\n// Navigate to measurement_dashboard - the markdown widget there handles the conditional display\nwidgetContext.stateController.openState('measurement_dashboard', params, true);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1532b4d5-2d3c-872e-57ed-d477f9b2e502"
              },
              {
                "name": "details-day",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#details-day', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_details_full';\n        case 'Room Sensor T':            \n            return 'roomsensort_details_full';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_details_full';                      \n        case 'Door Sensor':\n            return 'door_details_full';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_fulls';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':            \n            return '1000px';\n        case 'Room Sensor CO2':            \n            return '1000px';                  \n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1831fd41-86a5-53ac-1e1b-ab4f23f60807"
              },
              {
                "name": "measurement-parameters",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "modules": {
                  "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                },
                "customFunction": "const measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error('No measurement selected');\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a066a7c4-4bbb-d780-315e-af760f5b1e4e"
              },
              {
                "name": "sensor-data",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "301c8f82-5367-e4eb-a578-ca81965b5e9a"
              },
              {
                "name": "open-project-wizard",
                "icon": "assignment",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "var stateParams = widgetContext.stateController.getStateParams();\nvar selectedProject = stateParams ? stateParams.selectedProject : null;\n\nif (selectedProject && selectedProject.entityId) {\n    projectWizard.openProjectWizardDialog(widgetContext, selectedProject.entityId, selectedProject.entityName, selectedProject.entityLabel, function() { widgetContext.updateAliases(); }, { dataImporter: dataImporter });\n} else {\n    console.error('No project selected');\n}",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                    "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "project-wizard-action-1769529175158"
              },
              {
                "name": "project-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects_alarms",
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "popoverPreferredPlacement": "rightBottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "32vw",
                "popoverHeight": "30vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "4940218a-068b-77d2-7af0-5fbc13d7e70c"
              }
            ],
            "headerButton": []
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "b84de4e1-8a84-b5cc-6b10-19292fefbb45",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "678a80b3-1380-cdd2-495f-1701acde66c1": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
              "dataKeys": [
                {
                  "name": "title",
                  "type": "entityField",
                  "label": "Title",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.6231912076992963
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.03179212116453134
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.8801358300155324
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#EEEEEE",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "// 20.03.2025 DOJ\nvar params = ctx.stateController.getStateParams();\n\nvar criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\n\nvar criticalClass = (criticalCount && Number(criticalCount) > 0) ? 'critical' : 'inactive';\nvar majorClass    = (majorCount && Number(majorCount) > 0) ? 'major' : 'inactive';\n\nvar userRole = data[1].role;\nparams['userRole'] = userRole;\nctx.stateController.updateState(null,params);\n\nvar locationName;\nif (data && data.length) {\n    locationName = data[0]['entityName'] || 'N/A';\n} else {\n    locationName = 'N/A';\n}\n\n// Conditionally build the Projects button HTML\nvar projectsButtonHtml = '';\n/*if (userRole === \"Belimo Retrofit Engineers\") {\n    projectsButtonHtml =\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>Projects</span>' +\n        '</button>';\n}*/ if (userRole === \"Belimo Retrofit Engineer\") {\n    projectsButtonHtml =\n        /*'<button id=\"admin-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">admin_panel_settings</mat-icon>' +\n            '<span>Admin</span>' +\n        '</button>' +*/\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n        '</button>';\n} else if (userRole !== \"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\") {\n    projectsButtonHtml =\n        '<button id=\"admin-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">admin_panel_settings</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.admin-btn.title}</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n        '</button>';\n}\n\nconst header =\n  '<div class=\"header flex flex-row justify-between items-stretch\" style=\"margin:0;\">' +\n\n    '<div class=\"flex-none basis-[15%] flex flex-col items-center pl-[5px]\">' +\n      '<div class=\"title\" style=\"font-weight:550; font-size: 1.4em;\">' +\n        locationName +\n      '</div>' +\n    '</div>' +\n\n    '<div class=\"flex items-center pr-[5px]\">' +\n      projectsButtonHtml +\n/*      '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\" class=\"flex items-center\">' +\n        '<mat-icon class=\"tb-mat-18 mr-1\">assessment</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.reports-btn.title}</span>' +\n      '</button>' +*/\n    '</div>' +\n\n  '</div>';\n\n\n\n/*var header =\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between stretch\" fxLayoutGap=\"8px\" style=\"margin: 0px;\">' +\n      \n      '<div fxFlex=\"15\" fxLayout=\"column\" fxLayoutAlign=\"center\" style=\"padding-left: 5px;\" >' + // Reduced fxFlex from 40 to 20\n          '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' + // Reduce font size for title\n        '</div>' +\n\n      '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"8px\" style=\"padding-right: 5px;\">' +\n        projectsButtonHtml +\n        '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n          '<span>Reports</span>' +\n        '</button>' +\n      '</div>' +\n      \n    '</div>';*/\n\n/*return '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        header + \n            '<div id=\"home-dashboard\" style=\"width: 100%; height: 100%; margin-top: 10px;\">'+\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"home_dashboard_widgets\"></tb-dashboard-state>'+\n            '</div>'+\n        '</div>';*/\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">'\n/*  +   header*/\n  +   '<div id=\"home-dashboard\" class=\"w-full h-full\" style=\"width: 100%; height: 100%;\">'\n  +     '<tb-dashboard-state '\n  +       'class=\"flex-1\" '\n  +       '[ctx]=\"ctx\" '\n  +       '[syncParentStateParams]=\"true\" '\n  +       'stateId=\"home_dashboard_widgets\">'\n  +     '</tb-dashboard-state>'\n  +   '</div>'\n  + '</div>';\n\n\n\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n/*.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} */\n\n.header {\n    height: 60px;                    /* Fixed height for medium screens */\n    display: flex;                   /* Use Flexbox for layout */\n    align-items: center;             /* Vertically center content */\n    justify-content: space-between;  /* Space items evenly horizontally */\n    padding: 0 20px;                 /* Horizontal padding only */\n    box-sizing: border-box;          /* Include padding in height */\n}\n\n/* Small screens: up to 600px wide */\n@media (max-width: 600px) {\n    .main-layout .header {\n        height: 50px;   /* Smaller height for small screens */\n        padding: 0 10px; /* Reduced horizontal padding */\n    }\n}\n\n/* Medium screens: 601px to 1024px */\n@media (min-width: 601px) and (max-width: 1024px) {\n    .main-layout .header {\n        height: 60px;    /* Default height */\n        padding: 0 15px; /* Adjust padding if needed */\n    }\n}\n\n/* Large screens: 1025px and above */\n@media (min-width: 1025px) {\n    .main-layout .header {\n        height: 70px;   /* Increased height for larger screens */\n        padding: 0 20px; /* Maintain horizontal padding */\n    }\n}\n\n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #report-button, #reports-button, #admin-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#admin-button  {\n    background-color: red; /* Setzt die Hintergrundfarbe der Buttons */\n}\n\n#admin-button:hover  {\n    background-color: #FA6B6B; /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #report-button:hover, #reports-button:hover  {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon, #admin-button mat-icon  {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#projects-button span, #report-button span, #reports-button span, #admin-button span  {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_dashboard",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error('No measurement selected');\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n// Keep only userRole, clear all other params\nparams = {\n    \"userRole\": params.userRole\n};\n\nwidgetContext.stateController.updateState('default', params);"
              },
              {
                "name": "admin-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "27a13540-f6e7-11f0-9979-9f3434877bb4",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e63ea2ea-53c8-1e57-c98b-a33fc883593f"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "678a80b3-1380-cdd2-495f-1701acde66c1"
      },
      "dc35f902-3824-8f1b-a870-fee55664d0bd": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout flex size-full flex-col\" style=\"padding:0; height:100%;\">\n  <!-- Block A - nur sichtbar, wenn KEIN Projekt gewhlt ist -->\n<!--  <div *ngIf=\"!ctx.stateController.getStateParams().selectedProject\" class=\"flex flex-col\" style=\"width:100%; height:100px;\">\n    <h5 class=\"market-title\">{i18n:custom.diagnostics.projects.title}</h5>\n    <tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" stateId=\"Measurement_state_filter\"> </tb-dashboard-state>\n  </div>-->\n  <!-- Block B - nur sichtbar, wenn EIN Projekt gewhlt ist -->\n  <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedProject\" style=\"height:130px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"project_card_header\"></tb-dashboard-state>\n  <!-- Map container - switches between projects_map and selected_project_map -->\n  <div class=\"flex flex-1 flex-col\" style=\"position: relative;\">\n    <tb-dashboard-state \n      class=\"flex-1\" \n      [ctx]=\"ctx\" \n      [syncParentStateParams]=\"true\" \n      [stateId]=\"ctx.stateController.getStateParams().selectedProject ? 'selected_project_map' : 'projects_map'\">\n    </tb-dashboard-state>\n  </div>\n</div>",
            "markdownTextFunction": "// Zugriff auf State-Parameter und Initialisierung des HTML-Strings\r\nvar stateParams = ctx.stateController.getStateParams();\r\nvar selectedProject = stateParams ? stateParams.selectedProject : null;\r\nvar html = '<div style=\"display:flex; flex-direction:column; height:100%;\">';\r\n\r\n// Fall 1: Kein Projekt ausgewhlt\r\nif (!selectedProject) {\r\n    html += '<div style=\"height:170px; display:flex; flex-direction:column;\">';\r\n    html += '<h3>Projects</h3>';\r\n    html += '<h4>State filter</h4>';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"Measurement_state_filter\"></tb-dashboard-state>';\r\n    html += '<hr>';\r\n    html += '</div>';\r\n    // Unterer Bereich fllt den restlichen Platz (flex:1)\r\n    html += '<div style=\"flex:1;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"projects_map\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n\r\n// Fall 2: Ein Projekt ist ausgewhlt\r\n} else {\r\n    html += '<div style=\"height:200px;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"project_card_header\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n    // Unterer Bereich fllt den restlichen Platz\r\n    html += '<div style=\"flex:1;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"projects_map\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n}\r\n\r\n// Abschlieender div-Tag und Rckgabe des HTML-Strings\r\nhtml += '</div>';\r\nreturn html;",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n.state-filter-title {\n    padding-bottom: 15px;\n    padding-left: 10px;\n}\n\n.market-layout .alarm-badges-layout {\n    position: absolute;\n    height: 50px;\n    top: 0;\n    left: 0;\n    right: 0;\n    z-index: 2;\n    display: flex;\n    justify-content: center;\n    pointer-events: none;\n}\n\n.market-layout .alarm-badges-layout .alarm-badges {\n    height: 50px;\n    width: 350px;\n    pointer-events: all;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 4px !important;\n    margin-bottom: 4px !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mdc-form-field > label {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "borderRadius": "8"
        },
        "row": 0,
        "col": 0,
        "id": "dc35f902-3824-8f1b-a870-fee55664d0bd",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "b2beb7ce-103a-560f-cf9c-b7df21827bf0": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8853142583803868
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8167362021349891
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\n    <section *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex fxLayout=\"column\">\n\t<h5 class=\"market-title\">{{ ctx.stateController.getStateParams().selectedDoktorkit.entityName }}</h5>\n\t<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_card\"></tb-dashboard-state>\n    </section>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" stateId=\"Doktorkits_card\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>\n    <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkit_alarms\"></tb-dashboard-state>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"false\" stateId=\"Doktorkits_alarms\"></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "var projectState = ctx.stateController.getStateParams().selectedProject ? true : false;\r\n\r\nvar stateParams = ctx.stateController.getStateParams();\r\n\r\nctx.stateController.updateState(null, stateParams);\r\n\r\nvar newDashboardtimewindow = {\r\n    aggregation: {\r\n        limit: 50000,\r\n        type: \"NONE\"\r\n    },\r\n    hideAggInterval: true,\r\n    hideAggregation: true,\r\n    hideInterval: false,\r\n    history: {\r\n        historyType: 1,\r\n        fixedTimewindow: {\r\n            startTimeMs: Date.now() - 1209600000, // now - 2 weeks\r\n            endTimeMs: Date.now()\r\n        }\r\n    },\r\n    selectedTab: 1\r\n};\r\n\r\nvar userRole = data[0].role;\r\n\r\nvar stateParams = ctx.stateController.getStateParams();\r\nvar currentUser = ctx.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator';\r\nstateParams[\"userRole\"] = userRole;\r\n/*console.log(\"par:\", stateParams);*/\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, stateParams);\r\n\r\nvar typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-480q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v480q0 33-23.5 56.5T800-80H160Zm240-640h160v-80H400v80Zm40 360v120h80v-120h120v-80H520v-120h-80v120H320v80h120Z\"/></svg>';\r\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\r\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\r\n\r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n          (projectState \r\n            ? ( '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Measurements_card\"></tb-dashboard-state>' )\r\n            : ( '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"all_projects\"></tb-dashboard-state>' )) + \r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow.no-padding {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 4px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "{i18n:action.go-back}",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedMeasurement'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "borderRadius": "8"
        },
        "row": 0,
        "col": 0,
        "id": "b2beb7ce-103a-560f-cf9c-b7df21827bf0",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "0ff674a9-4e70-3742-720a-e681566c9b4f": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
              "filterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "latitude",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.862061599769905
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "longitude",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.017864596400994026
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.652632058135977
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.35182491461913457
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.2357170844737564
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.7555775294467035
                },
                {
                  "name": "outsideHumidity",
                  "type": "timeseries",
                  "label": "outsideHumidity",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.7038818406636014
                },
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "outsideTemp",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.3584981742251683
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "attribute",
                  "label": "majorAlarmsCount",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.2457539608057584
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "attribute",
                  "label": "criticalAlarmsCount",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.362993982508079
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "attribute",
                  "label": "minorAlarmsCount",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.11733799988993221
                },
                {
                  "name": "warningAlarmsCount",
                  "type": "attribute",
                  "label": "warningAlarmsCount",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.6269991260047776
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.9172342215995071
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "name",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.5180855877351238,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "label",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.8758870297077328,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.8815810998227034
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "selectedProject",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5292772206260663,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return true;\n} else {\n    return false;\n}",
                  "aggregationType": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "CartoDB.Positron",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": false,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "",
            "imageUrlAttribute": "",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 14,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": false,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${locationName}",
            "labelFunction": null,
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": true,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}",
            "tooltipFunction": "const temperature = data.outsideTemp;\nconst humidity = data.outsideHumidity;\nconst pressure = data.pressure;\nconst longitude = data.longitude;\nconst latitude = data.latitude;\nvar locationName = data.locationName || 'N/A';\nconst installationType = data.installationType;\nconst address = data.address;\nconst name = data.name;\nconst label = data.label;\n\nconst userRole = dsData[dsData.length - 1].role;\n\n// Alarms\nconst state = data.state;\nconst progress = data.progress;\nconst criticalAlarms = data.criticalAlarmsCount || 'N/A';\nconst majorAlarms = data.majorAlarmsCount || 'N/A';\nconst minorAlarms = data.minorAlarmsCount || 'N/A';\nconst warningAlarms = data.warningAlarmsCount || 'N/A';\n\n// Farben fr Alarms\nconst criticalAlarmsColor = '#FF0000'; // Rot\nconst criticalAlarmsBgColor =\n'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\n\nconst majorAlarmsColor = '#FF8C00'; // Orange\nconst majorAlarmsBgColor =\n'rgba(255, 140, 0, 0.1)'; // Transparenter Orange\n\nconst minorAlarmsColor = '#FFD700'; // Gold\nconst minorAlarmsBgColor =\n'rgba(255, 215, 0, 0.1)'; // Transparenter Gold\n\nconst warningAlarmsColor = '#000000'; // Schwarz\nconst warningAlarmsBgColor =\n'rgba(128, 128, 128, 0.1)'; // Transparenter Grau\n\nvar ButtonHtml = '';\nif (userRole !== \"Belimo Retrofit Users\") {\n    ButtonHtml = '<div style=\"text-align: center\">' +\n        '<link-act name=\"all_measurements\">Edit Measurements</link-act>' +\n        '</div>';\n}\n/*console.log(ButtonHtml);*/\n\nif (locationName === 'N/A') {\n    locationName = label;\n}\n\nreturn '<div style=\"display:flex;flex-direction:column;margin-bottom:8px;font-family:\\'Roboto\\';font-weight:500;font-size:16px;line-height:24px;letter-spacing:0.25px;color:#29313C\">' +\n    '<div>' + locationName + ' | ' + name + '</div>' +\n    '<div style=\"width: 100%;border-bottom:1px solid rgba(0, 0, 0, 0.12);margin:12px 0;\"></div>' +\n\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Address</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    address + '</div>' +\n    '</div>' +\n/*    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Critical Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    criticalAlarmsColor + ';background-color:' +\n    criticalAlarmsBgColor + '\">' + criticalAlarms +\n    '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Major Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    majorAlarmsColor + ';background-color:' +\n    majorAlarmsBgColor + '\">' + majorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Minor Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    minorAlarmsColor + ';background-color:' +\n    minorAlarmsBgColor + '\">' + minorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Warning Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    warningAlarmsColor + ';background-color:' +\n    warningAlarmsBgColor + '\">' + warningAlarms + '</div>' +\n    '</div>' +*/\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Temperature</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    temperature + ' C</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Humidity</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    humidity + ' % r.H.</div>' +\n    '</div>' +\n    projectWizardButtonHtml +\n    ButtonHtml +\n    '</div>';",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var progress = data['progress'];\r\nvar selectedProject = data['selectedProject'] === true;\r\nvar selectedMode = dsData.filter(function(data) { return data['selectedProject'] === true; }).length > 0;\r\n\r\nvar width = 30;\r\nvar svgStr = getDoktorkitSvg(progress, width, selectedProject);\r\nvar encodedSvg = encodeURIComponent(svgStr);\r\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\r\nif (selectedProject) {\r\n  width += 8;\r\n}\r\nreturn {\r\n  url: svgUrl,\r\n  size: width,\r\n  markerOffset: [width / 2, width / 2],\r\n  tooltipOffset: [width * 0.5 - width / 2, -(width / 2)]\r\n};\r\n\r\nfunction getDoktorkitSvg(progress, width, isSelected) {\r\n    var color = getBackgroundColor(progress);\r\n    var background = getBackground(color);\r\n    var svgSize = isSelected ? (width + 8) : width;\r\n    var opacity = selectedMode && !isSelected ? 0.4 : 1;\r\n\r\n    // Home-Icon SVG (zentriert und skaliert)\r\n    var shape = '<g transform=\"translate(10,10) scale(0.8)\">' +\r\n                '<path d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\" fill=\"white\"/>' +\r\n                '</g>';\r\n\r\n    var projectSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgSize + '\" height=\"' + svgSize + '\" viewBox=\"0 0 46 46\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\r\n                     wrapIfSelected(background + shape, isSelected);\r\n    if (isSelected) {\r\n        projectSvg += getProjectSelectionStroke();\r\n    }\r\n    projectSvg += '</svg>';\r\n    return projectSvg;\r\n}\r\n\r\nfunction wrapIfSelected(svg, isSelected) {\r\n    if (isSelected) {\r\n        return '<g transform=\"translate(4,4)\">' + svg + '</g>';\r\n    } else {\r\n        return svg;\r\n    }\r\n}\r\n\r\n// Hintergrundkreis genau mittig\r\nfunction getBackground(color) {\r\n    return '<circle cx=\"19\" cy=\"19\" r=\"15\" fill=\"'+ color +'\"/>';\r\n}\r\n\r\n// Selektionsring exakt um den Hintergrundkreis herum\r\nfunction getProjectSelectionStroke() {\r\n    return '<circle cx=\"23\" cy=\"23\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\r\n}\r\n\r\nfunction getBackgroundColor(progress) {\r\n  switch(progress) {\r\n    case 'in preperation': \r\n        return '#000000'; // '#CAC1D2'--> grau\r\n    case 'finished': \r\n        return '#27AE60'; // --> grn\r\n    case 'active': \r\n        return '#f3de61'; // --> gelb\r\n    default: \r\n        return '#000000'; // --> grau\r\n  }\r\n}",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "useClusterMarkers": true,
            "zoomOnClick": true,
            "maxZoom": null,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true,
            "useIconCreateFunction": false,
            "clusterMarkerFunction": null
          },
          "title": "New OpenStreetMap",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Select Project",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nvar selectedProject = params['selectedProject'];\nif (selectedProject && selectedProject.entityId.id === entityId.id) {\n    params['selectedProject'] = null;\n} else {\n    params['selectedProject'] = { entityId: entityId, entityName: entityName, entityLabel: entityLabel };\n}\nwidgetContext.stateController.updateState(null, params);\n/*console.log(\"Params 1: \" + JSON.stringify(params));*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4de7962b-a1de-5cb1-cd78-993dc7863614"
              }
            ],
            "tooltipAction": [
              {
                "name": "all_measurements",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nparams['selectedProject'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedProject';\n/*params['selectedMeasurement'] = null;*/\n/*console.log(\"Params 2: \" + JSON.stringify(params));*/\nwidgetContext.stateController.openState('all_measurements', params);\t",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1ca54350-817a-27b3-26a7-3572544d8523"
              }
            ]
          },
          "showTitleIcon": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "borderRadius": "0px",
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "0ff674a9-4e70-3742-720a-e681566c9b4f",
        "typeFullFqn": "system.maps_v2.openstreetmap"
      },
      "f2279347-4693-4b0a-17c2-15d2887559fa": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1745755787013,
                "endTimeMs": 1745842187013
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              },
              {
                "label": "{i18n:widgets.maps.layer.topographic}",
                "provider": "openstreet",
                "layerType": "Esri.WorldTopoMap",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "OpenStreetMap.HOT",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "Esri.WorldStreetMap",
                "referenceLayer": null
              },
              {
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
                "dsFilterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
                "additionalDataSources": null,
                "additionalDataKeys": [
                  {
                    "name": "progress",
                    "type": "attribute",
                    "label": "progress",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.9725950885098493
                  },
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.2872987416504812,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  },
                  {
                    "name": "address",
                    "type": "attribute",
                    "label": "address",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8026110588871542
                  },
                  {
                    "name": "outsideTemp",
                    "type": "timeseries",
                    "label": "outsideTemp",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.759902282076257
                  },
                  {
                    "name": "outsideHumidity",
                    "type": "timeseries",
                    "label": "outsideHumidity",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.05821233805088244
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8646915284773707,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "label": {
                  "show": true,
                  "type": "function",
                  "pattern": "${entityName}",
                  "patternFunction": {
                    "body": "var color = utils.getProgressColor(data.progress).color;\r\n\r\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \r\n           '${entityName}' + \r\n        '</span>';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js",
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                    }
                  }
                },
                "tooltip": {
                  "show": false,
                  "trigger": "hover",
                  "autoclose": true,
                  "type": "function",
                  "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} C<br/><small>See tooltip settings for details</small>",
                  "offsetX": 0,
                  "offsetY": -1,
                  "patternFunction": {
                    "body": "const locationName = data.locationName || data.label || entityName;\nconst name = data.name || entityName;\nconst progress = data.progress;\nconst address = data.address || '';\n\nlet progressHtml = '';\nif (progress) {\n    let color, bgColor, label;\n    switch (progress) {\n        case 'active':\n            color = '#27AE60';\n            bgColor = 'rgba(39, 174, 96, 0.12)';\n            label = 'Active';\n            break;\n        case 'in preparation':\n            color = '#F2994A';\n            bgColor = 'rgba(242, 153, 74, 0.12)';\n            label = 'In Preparation';\n            break;\n        case 'finished':\n            color = '#2F80ED';\n            bgColor = 'rgba(47, 128, 237, 0.12)';\n            label = 'Finished';\n            break;\n        case 'aborted':\n            color = '#EB5757';\n            bgColor = 'rgba(235, 87, 87, 0.12)';\n            label = 'Aborted';\n            break;\n        default:\n            color = '#828282';\n            bgColor = 'rgba(130, 130, 130, 0.12)';\n            label = progress || 'Unknown';\n    }\n    progressHtml = '<span style=\"padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 500; color: ' + color + '; background-color: ' + bgColor + ';\">' + label + '</span>';\n}\n\nreturn '<div style=\"font-family: Roboto; font-size: 14px;\">' +\n    '<div style=\"font-weight: 600; margin-bottom: 4px;\">' + locationName + '</div>' +\n    '<div style=\"color: #666; font-size: 12px; margin-bottom: 4px;\">' + name + '</div>' +\n    (progressHtml ? '<div>' + progressHtml + '</div>' : '') +\n    '<div style=\"color: #999; font-size: 11px; margin-top: 8px;\">Click for details</div>' +\n    '</div>';",
                    "modules": {}
                  },
                  "tagActions": null
                },
                "click": {
                  "type": "customPretty",
                  "customHtml": "<form class=\"project-popup-form\">\n  <button class=\"popup-close\" mat-icon-button (click)=\"close()\" type=\"button\">\n    <mat-icon class=\"material-icons\">close</mat-icon>\n  </button>\n  <div mat-dialog-content>\n    <!-- Project Picture -->\n    <section *ngIf=\"project.picture\" class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <img class=\"project-picture\" [src]=\"project.picture\"/>\n    </section>\n    \n    <!-- Project Name -->\n    <section class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <div class=\"popup-title\">{{ project.locationName }}</div>\n      <div class=\"popup-subtitle\">{{ project.name }}</div>\n    </section>\n    \n    <mat-divider style=\"margin-bottom: 16px;\"></mat-divider>\n    \n    <!-- Project Details -->\n    <section class=\"flex flex-col gap-2\" style=\"padding-bottom: 16px;\">\n      <div class=\"flex flex-row items-baseline\">\n        <div class=\"popup-label\">Address</div>\n        <div class=\"popup-value\">{{ project.address }}</div>\n      </div>\n      <div class=\"flex flex-row items-center\">\n        <div class=\"popup-label\">Progress</div>\n        <div class=\"popup-badge\" [style.color]=\"project.progressStyle.color\" [style.background-color]=\"project.progressStyle.bgColor\">\n          {{ project.progressStyle.label }}\n        </div>\n      </div>\n      <div class=\"flex flex-row items-center\" *ngIf=\"project.measurementsCount !== null\">\n        <div class=\"popup-label\">Measurements</div>\n        <div class=\"popup-value\">{{ project.measurementsCount }}</div>\n      </div>\n    </section>\n    \n    <!-- Timestamps -->\n    <section *ngIf=\"project.startTime || project.endTime\" class=\"flex flex-row gap-2 flex-wrap\" style=\"padding-bottom: 16px;\">\n      <div *ngIf=\"project.startTime\" class=\"timestamp-badge\" [style.color]=\"project.startTime.color\" [style.background-color]=\"project.startTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.startTime.icon }}</mat-icon>\n        <span>{{ project.startTime.label }}</span>\n      </div>\n      <div *ngIf=\"project.endTime\" class=\"timestamp-badge\" [style.color]=\"project.endTime.color\" [style.background-color]=\"project.endTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.endTime.icon }}</mat-icon>\n        <span>{{ project.endTime.label }}</span>\n      </div>\n    </section>\n    \n    <!-- Buttons -->\n    <section class=\"flex flex-row gap-2 items-center justify-center flex-wrap\" style=\"padding-top: 8px;\">\n      <button *ngIf=\"showWizardButton\" type=\"button\" mat-flat-button color=\"primary\" class=\"popup-button wizard-button\" (click)=\"openProjectWizard()\">\n        <mat-icon>rocket_launch</mat-icon>\n        <span>Project Wizard</span>\n      </button>\n      <button type=\"button\" mat-stroked-button class=\"popup-button edit-button\" (click)=\"openEditProject()\">\n        <mat-icon>edit</mat-icon>\n        <span>Edit</span>\n      </button>\n    </section>\n  </div>\n</form>",
                  "customCss": ".project-popup-form {\n    width: 420px;\n    position: relative;\n    padding: 16px;\n    background: white;\n}\n\n.project-popup-form .mat-mdc-dialog-content {\n    max-height: 95vh;\n    padding: 0;\n}\n\n.project-popup-form .popup-close {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    z-index: 1;\n    color: rgba(0,0,0,0.54);\n}\n.project-popup-form .popup-close:hover {\n    color: rgba(0,0,0,0.87);\n    background: rgba(0,0,0,0.04);\n}\n\n.project-popup-form .project-picture {\n    width: 160px;\n    height: 160px;\n    border-radius: 8px;\n    object-fit: cover;\n    border: 1px solid #e2e8f0;\n}\n\n.project-popup-form .popup-title {\n    font-weight: 600;\n    font-size: 18px;\n    line-height: 24px;\n    color: #1e293b;\n    text-align: center;\n}\n\n.project-popup-form .popup-subtitle {\n    font-size: 14px;\n    color: #64748b;\n    text-align: center;\n}\n\n.project-popup-form .popup-label {\n    font-size: 13px;\n    line-height: 16px;\n    font-weight: 500;\n    color: #94a3b8;\n    width: 110px;\n    flex-shrink: 0;\n}\n\n.project-popup-form .popup-value {\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: 500;\n    letter-spacing: 0.25px;\n    color: #1e293b;\n}\n\n.project-popup-form .popup-badge {\n    display: inline-block;\n    padding: 4px 10px;\n    border-radius: 6px;\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 16px;\n}\n\n.project-popup-form .timestamp-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 500;\n}\n\n.project-popup-form .popup-button {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    border-radius: 6px;\n}\n\n.project-popup-form .wizard-button {\n    background-color: var(--tb-primary-500) !important;\n}\n\n.project-popup-form .edit-button {\n    color: #F2994A !important;\n    border-color: #F2994A !important;\n}\n\n.project-popup-form .mat-mdc-outlined-button.mat-primary:not(:disabled),\n.project-popup-form .mat-mdc-stroked-button.mat-primary:not(:disabled) {\n    color: var(--tb-primary-500);\n    border-color: var(--tb-primary-500);\n}\n\n.project-popup-form mat-divider {\n    border-color: #e2e8f0;\n}",
                  "customFunction": {
                    "body": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet rxjs = widgetContext.rxjs;\n\n// Load attributes and relations in parallel\nrxjs.forkJoin([\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', \n        ['locationName', 'address', 'progress', 'startTimeMs', 'endTimeMs', 'projectPicture']\n    ),\n    entityRelationService.findByFrom(entityId, 'Owns')\n]).subscribe(function(results) {\n    let attributes = results[0];\n    let relations = results[1];\n    \n    let attrMap = {};\n    attributes.forEach(function(attr) {\n        attrMap[attr.key] = attr.value;\n    });\n    \n    // Count measurements (relations with type Owns to ASSETs)\n    let measurementsCount = relations.filter(function(rel) {\n        return rel.to && rel.to.entityType === 'ASSET';\n    }).length;\n    \n    openProjectPopupDialog(attrMap, measurementsCount);\n});\n\nfunction openProjectPopupDialog(attrMap, measurementsCount) {\n    customDialog.customDialog(htmlTemplate, ProjectPopupController).subscribe();\n    \n    function ProjectPopupController(instance) {\n        let vm = instance;\n        \n        // Progress styling\n        let progressStyle = getProgressColor(attrMap.progress);\n        \n        // Timestamp styling\n        let startTime = getTimestampStyle(attrMap.startTimeMs, 'start');\n        let endTime = getTimestampStyle(attrMap.endTimeMs, 'end');\n        \n        vm.project = {\n            name: entityName,\n            locationName: attrMap.locationName || entityLabel || entityName,\n            address: attrMap.address || 'N/A',\n            progress: attrMap.progress,\n            progressStyle: progressStyle,\n            picture: attrMap.projectPicture || null,\n            startTime: startTime,\n            endTime: endTime,\n            measurementsCount: measurementsCount\n        };\n        \n        vm.showWizardButton = (attrMap.progress === 'in preparation' || attrMap.progress === 'active');\n        \n        vm.close = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        vm.openProjectWizard = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            }, { dataImporter: dataImporter });\n        };\n        \n        vm.openMeasurements = function() {\n            vm.dialogRef.close(null);\n            var params = widgetContext.stateController.getStateParams();\n            var selectedProject = params['selectedProject'];\n            if (selectedProject && selectedProject.entityId.id === entityId.id) {\n                params['selectedProject'] = null;\n            } else {\n                params['selectedProject'] = { \n                    entityId: entityId, \n                    entityName: entityName, \n                    entityLabel: entityLabel \n                };\n            }\n            widgetContext.stateController.updateState(null, params);\n        };\n        vm.openEditProject = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openEditProjectDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            });\n        };\n\n        \n        // Helper functions\n        function getProgressColor(progress) {\n            let color, bgColor, label;\n            switch (progress) {\n                case 'in preparation':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'In Preparation';\n                    break;\n                case 'planned':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'Planned';\n                    break;\n                case 'active':\n                    color = '#27AE60';\n                    bgColor = 'rgba(39, 174, 96, 0.12)';\n                    label = 'Active';\n                    break;\n                case 'finished':\n                    color = '#2F80ED';\n                    bgColor = 'rgba(47, 128, 237, 0.12)';\n                    label = 'Finished';\n                    break;\n                case 'aborted':\n                    color = '#EB5757';\n                    bgColor = 'rgba(235, 87, 87, 0.12)';\n                    label = 'Aborted';\n                    break;\n                default:\n                    color = '#828282';\n                    bgColor = 'rgba(130, 130, 130, 0.12)';\n                    label = progress || 'N/A';\n            }\n            return { color: color, bgColor: bgColor, label: label };\n        }\n        \n        function getTimestampStyle(timestampMs, type) {\n            if (timestampMs === null || timestampMs === undefined) {\n                return null;\n            }\n            var date = new Date(Number(timestampMs));\n            var pad = function(n) { return n.toString().padStart(2, '0'); };\n            var formattedTime = date.getFullYear() + '-' + pad(date.getMonth() + 1) + '-' + pad(date.getDate()) +\n                ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n            \n            var icon, color, bgColor, label;\n            if (type === 'start') {\n                icon = 'play_circle';\n                color = '#27AE60';\n                bgColor = 'rgba(39, 174, 96, 0.12)';\n                label = 'Start: ' + formattedTime;\n            } else {\n                icon = 'stop_circle';\n                color = '#2F80ED';\n                bgColor = 'rgba(47, 128, 237, 0.12)';\n                label = 'End: ' + formattedTime;\n            }\n            return { icon: icon, color: color, bgColor: bgColor, label: label };\n        }\n    }\n}",
                    "modules": {
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                      "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                    }
                  },
                  "customResources": [],
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "add",
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "icon",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "size": 40,
                  "color": {
                    "type": "function",
                    "color": "#307FE5",
                    "rangeKey": null,
                    "range": null,
                    "colorFunction": {
                      "body": "return utils.getProgressColor(data.progress).color;",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    }
                  },
                  "iconContainer": "iconContainer4",
                  "icon": "domain"
                },
                "markerImage": {
                  "type": "image",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": true,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedProject",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.5634367819170003,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce"
              },
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "role",
                    "type": "attribute",
                    "label": "role",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7014478669430672
                  },
                  {
                    "name": "displayAbortedMeasurement",
                    "type": "attribute",
                    "label": "displayAbortedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8011587598224269
                  },
                  {
                    "name": "displayActiveMeasurement",
                    "type": "attribute",
                    "label": "displayActiveMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8205299052205228
                  },
                  {
                    "name": "displayFinishedMeasurement",
                    "type": "attribute",
                    "label": "displayFinishedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.038665901375789624
                  },
                  {
                    "name": "displayPreparationMeasurement",
                    "type": "attribute",
                    "label": "displayPreparationMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.21373032656145663
                  }
                ],
                "dsEntityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [
              "metric"
            ],
            "dragModeButton": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [
              {
                "label": "Filter",
                "icon": "filter_alt",
                "color": "#0000008A",
                "action": {
                  "type": "openDashboardState",
                  "targetDashboardStateId": "Measurement_state_filter",
                  "setEntityId": true,
                  "stateEntityParamName": null,
                  "openRightLayout": false,
                  "popoverPreferredPlacement": "top",
                  "popoverHideOnClickOutside": true,
                  "popoverHideDashboardToolbar": true,
                  "popoverWidth": "300px",
                  "popoverHeight": "250px",
                  "popoverStyle": {
                    "padding": "16px",
                    "borderRadius": "8px",
                    "boxShadow": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
                    "background": "#ffffff"
                  },
                  "openInSeparateDialog": false,
                  "openInPopover": true
                }
              }
            ],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "8px"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": true,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {
            "headerButton": []
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "f2279347-4693-4b0a-17c2-15d2887559fa"
      },
      "fb583db5-3fc6-275a-34f4-120bfe140af2": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1745755787013,
                "endTimeMs": 1745842187013
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              },
              {
                "label": "{i18n:widgets.maps.layer.topographic}",
                "provider": "openstreet",
                "layerType": "Esri.WorldTopoMap",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "OpenStreetMap.HOT",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "Esri.WorldStreetMap",
                "referenceLayer": null
              },
              {
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
                "dsFilterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
                "additionalDataSources": null,
                "additionalDataKeys": [
                  {
                    "name": "progress",
                    "type": "attribute",
                    "label": "progress",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.9725950885098493
                  },
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.2872987416504812,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  },
                  {
                    "name": "address",
                    "type": "attribute",
                    "label": "address",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8026110588871542
                  },
                  {
                    "name": "outsideTemp",
                    "type": "timeseries",
                    "label": "outsideTemp",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.759902282076257
                  },
                  {
                    "name": "outsideHumidity",
                    "type": "timeseries",
                    "label": "outsideHumidity",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.05821233805088244
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8646915284773707,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "label": {
                  "show": true,
                  "type": "function",
                  "pattern": "${entityName}",
                  "patternFunction": {
                    "body": "var color = utils.getProgressColor(data.progress).color;\r\n\r\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \r\n           '${entityName}' + \r\n        '</span>';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                    }
                  }
                },
                "tooltip": {
                  "show": false,
                  "type": "function",
                  "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} C<br/><small>See tooltip settings for details</small>",
                  "patternFunction": {
                    "body": "const locationName = data.locationName || data.label || entityName;\nconst name = data.name || entityName;\nconst progress = data.progress;\nconst address = data.address || '';\n\nlet progressHtml = '';\nif (progress) {\n    let color, bgColor, label;\n    switch (progress) {\n        case 'active':\n            color = '#27AE60';\n            bgColor = 'rgba(39, 174, 96, 0.12)';\n            label = 'Active';\n            break;\n        case 'in preparation':\n            color = '#F2994A';\n            bgColor = 'rgba(242, 153, 74, 0.12)';\n            label = 'In Preparation';\n            break;\n        case 'finished':\n            color = '#2F80ED';\n            bgColor = 'rgba(47, 128, 237, 0.12)';\n            label = 'Finished';\n            break;\n        case 'aborted':\n            color = '#EB5757';\n            bgColor = 'rgba(235, 87, 87, 0.12)';\n            label = 'Aborted';\n            break;\n        default:\n            color = '#828282';\n            bgColor = 'rgba(130, 130, 130, 0.12)';\n            label = progress || 'Unknown';\n    }\n    progressHtml = '<span style=\"padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 500; color: ' + color + '; background-color: ' + bgColor + ';\">' + label + '</span>';\n}\n\nreturn '<div style=\"font-family: Roboto; font-size: 14px;\">' +\n    '<div style=\"font-weight: 600; margin-bottom: 4px;\">' + locationName + '</div>' +\n    '<div style=\"color: #666; font-size: 12px; margin-bottom: 4px;\">' + name + '</div>' +\n    (progressHtml ? '<div>' + progressHtml + '</div>' : '') +\n    '<div style=\"color: #999; font-size: 11px; margin-top: 8px;\">Click for details</div>' +\n    '</div>';",
                    "modules": {}
                  },
                  "trigger": "hover",
                  "autoclose": true,
                  "offsetX": 0,
                  "offsetY": -1,
                  "tagActions": null
                },
                "click": {
                  "type": "customPretty",
                  "customHtml": "<form class=\"project-popup-form\">\n  <button class=\"popup-close\" mat-icon-button (click)=\"close()\" type=\"button\">\n    <mat-icon class=\"material-icons\">close</mat-icon>\n  </button>\n  <div mat-dialog-content>\n    <!-- Project Picture -->\n    <section *ngIf=\"project.picture\" class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <img class=\"project-picture\" [src]=\"project.picture\"/>\n    </section>\n    \n    <!-- Project Name -->\n    <section class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <div class=\"popup-title\">{{ project.locationName }}</div>\n      <div class=\"popup-subtitle\">{{ project.name }}</div>\n    </section>\n    \n    <mat-divider style=\"margin-bottom: 16px;\"></mat-divider>\n    \n    <!-- Project Details -->\n    <section class=\"flex flex-col gap-2\" style=\"padding-bottom: 16px;\">\n      <div class=\"flex flex-row items-baseline\">\n        <div class=\"popup-label\">Address</div>\n        <div class=\"popup-value\">{{ project.address }}</div>\n      </div>\n      <div class=\"flex flex-row items-center\">\n        <div class=\"popup-label\">Progress</div>\n        <div class=\"popup-badge\" [style.color]=\"project.progressStyle.color\" [style.background-color]=\"project.progressStyle.bgColor\">\n          {{ project.progressStyle.label }}\n        </div>\n      </div>\n      <div class=\"flex flex-row items-center\" *ngIf=\"project.measurementsCount !== null\">\n        <div class=\"popup-label\">Measurements</div>\n        <div class=\"popup-value\">{{ project.measurementsCount }}</div>\n      </div>\n    </section>\n    \n    <!-- Timestamps -->\n    <section *ngIf=\"project.startTime || project.endTime\" class=\"flex flex-row gap-2 flex-wrap\" style=\"padding-bottom: 16px;\">\n      <div *ngIf=\"project.startTime\" class=\"timestamp-badge\" [style.color]=\"project.startTime.color\" [style.background-color]=\"project.startTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.startTime.icon }}</mat-icon>\n        <span>{{ project.startTime.label }}</span>\n      </div>\n      <div *ngIf=\"project.endTime\" class=\"timestamp-badge\" [style.color]=\"project.endTime.color\" [style.background-color]=\"project.endTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.endTime.icon }}</mat-icon>\n        <span>{{ project.endTime.label }}</span>\n      </div>\n    </section>\n    \n    <!-- Buttons -->\n    <section class=\"flex flex-row gap-2 items-center justify-center flex-wrap\" style=\"padding-top: 8px;\">\n      <button *ngIf=\"showWizardButton\" type=\"button\" mat-flat-button color=\"primary\" class=\"popup-button wizard-button\" (click)=\"openProjectWizard()\">\n        <mat-icon>rocket_launch</mat-icon>\n        <span>Project Wizard</span>\n      </button>\n      <button type=\"button\" mat-stroked-button color=\"primary\" class=\"popup-button\" (click)=\"openMeasurements()\">\n        <mat-icon>assignment</mat-icon>\n        <span>Measurements</span>\n      </button>\n      <button type=\"button\" mat-stroked-button class=\"popup-button edit-button\" (click)=\"openEditProject()\">\n        <mat-icon>edit</mat-icon>\n        <span>Edit</span>\n      </button>\n    </section>\n  </div>\n</form>",
                  "customCss": ".project-popup-form {\n    width: 420px;\n    position: relative;\n    padding: 16px;\n    background: white;\n}\n\n.project-popup-form .mat-mdc-dialog-content {\n    max-height: 95vh;\n    padding: 0;\n}\n\n.project-popup-form .popup-close {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    z-index: 1;\n    color: rgba(0,0,0,0.54);\n}\n.project-popup-form .popup-close:hover {\n    color: rgba(0,0,0,0.87);\n    background: rgba(0,0,0,0.04);\n}\n\n.project-popup-form .project-picture {\n    width: 160px;\n    height: 160px;\n    border-radius: 8px;\n    object-fit: cover;\n    border: 1px solid #e2e8f0;\n}\n\n.project-popup-form .popup-title {\n    font-weight: 600;\n    font-size: 18px;\n    line-height: 24px;\n    color: #1e293b;\n    text-align: center;\n}\n\n.project-popup-form .popup-subtitle {\n    font-size: 14px;\n    color: #64748b;\n    text-align: center;\n}\n\n.project-popup-form .popup-label {\n    font-size: 13px;\n    line-height: 16px;\n    font-weight: 500;\n    color: #94a3b8;\n    width: 110px;\n    flex-shrink: 0;\n}\n\n.project-popup-form .popup-value {\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: 500;\n    letter-spacing: 0.25px;\n    color: #1e293b;\n}\n\n.project-popup-form .popup-badge {\n    display: inline-block;\n    padding: 4px 10px;\n    border-radius: 6px;\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 16px;\n}\n\n.project-popup-form .timestamp-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 500;\n}\n\n.project-popup-form .popup-button {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    border-radius: 6px;\n}\n\n.project-popup-form .wizard-button {\n    background-color: var(--tb-primary-500) !important;\n}\n\n.project-popup-form .edit-button {\n    color: #F2994A !important;\n    border-color: #F2994A !important;\n}\n\n.project-popup-form .mat-mdc-outlined-button.mat-primary:not(:disabled),\n.project-popup-form .mat-mdc-stroked-button.mat-primary:not(:disabled) {\n    color: var(--tb-primary-500);\n    border-color: var(--tb-primary-500);\n}\n\n.project-popup-form mat-divider {\n    border-color: #e2e8f0;\n}",
                  "customFunction": {
                    "body": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet rxjs = widgetContext.rxjs;\n\n// Load attributes and relations in parallel\nrxjs.forkJoin([\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', \n        ['locationName', 'address', 'progress', 'startTimeMs', 'endTimeMs', 'projectPicture']\n    ),\n    entityRelationService.findByFrom(entityId, 'Owns')\n]).subscribe(function(results) {\n    let attributes = results[0];\n    let relations = results[1];\n    \n    let attrMap = {};\n    attributes.forEach(function(attr) {\n        attrMap[attr.key] = attr.value;\n    });\n    \n    // Count measurements (relations with type Owns to ASSETs)\n    let measurementsCount = relations.filter(function(rel) {\n        return rel.to && rel.to.entityType === 'ASSET';\n    }).length;\n    \n    openProjectPopupDialog(attrMap, measurementsCount);\n});\n\nfunction openProjectPopupDialog(attrMap, measurementsCount) {\n    customDialog.customDialog(htmlTemplate, ProjectPopupController).subscribe();\n    \n    function ProjectPopupController(instance) {\n        let vm = instance;\n        \n        // Progress styling\n        let progressStyle = getProgressColor(attrMap.progress);\n        \n        // Timestamp styling\n        let startTime = getTimestampStyle(attrMap.startTimeMs, 'start');\n        let endTime = getTimestampStyle(attrMap.endTimeMs, 'end');\n        \n        vm.project = {\n            name: entityName,\n            locationName: attrMap.locationName || entityLabel || entityName,\n            address: attrMap.address || 'N/A',\n            progress: attrMap.progress,\n            progressStyle: progressStyle,\n            picture: attrMap.projectPicture || null,\n            startTime: startTime,\n            endTime: endTime,\n            measurementsCount: measurementsCount\n        };\n        \n        vm.showWizardButton = (attrMap.progress === 'in preparation' || attrMap.progress === 'active');\n        \n        vm.close = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        vm.openProjectWizard = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            }, { dataImporter: dataImporter });\n        };\n        \n        vm.openMeasurements = function() {\n            vm.dialogRef.close(null);\n            var params = widgetContext.stateController.getStateParams();\n            var selectedProject = params['selectedProject'];\n            if (selectedProject && selectedProject.entityId.id === entityId.id) {\n                params['selectedProject'] = null;\n            } else {\n                params['selectedProject'] = { \n                    entityId: entityId, \n                    entityName: entityName, \n                    entityLabel: entityLabel \n                };\n            }\n            widgetContext.stateController.updateState(null, params);\n        };\n        vm.openEditProject = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openEditProjectDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            });\n        };\n\n        \n        // Helper functions\n        function getProgressColor(progress) {\n            let color, bgColor, label;\n            switch (progress) {\n                case 'in preparation':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'In Preparation';\n                    break;\n                case 'planned':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'Planned';\n                    break;\n                case 'active':\n                    color = '#27AE60';\n                    bgColor = 'rgba(39, 174, 96, 0.12)';\n                    label = 'Active';\n                    break;\n                case 'finished':\n                    color = '#2F80ED';\n                    bgColor = 'rgba(47, 128, 237, 0.12)';\n                    label = 'Finished';\n                    break;\n                case 'aborted':\n                    color = '#EB5757';\n                    bgColor = 'rgba(235, 87, 87, 0.12)';\n                    label = 'Aborted';\n                    break;\n                default:\n                    color = '#828282';\n                    bgColor = 'rgba(130, 130, 130, 0.12)';\n                    label = progress || 'N/A';\n            }\n            return { color: color, bgColor: bgColor, label: label };\n        }\n        \n        function getTimestampStyle(timestampMs, type) {\n            if (timestampMs === null || timestampMs === undefined) {\n                return null;\n            }\n            var date = new Date(Number(timestampMs));\n            var pad = function(n) { return n.toString().padStart(2, '0'); };\n            var formattedTime = date.getFullYear() + '-' + pad(date.getMonth() + 1) + '-' + pad(date.getDate()) +\n                ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n            \n            var icon, color, bgColor, label;\n            if (type === 'start') {\n                icon = 'play_circle';\n                color = '#27AE60';\n                bgColor = 'rgba(39, 174, 96, 0.12)';\n                label = 'Start: ' + formattedTime;\n            } else {\n                icon = 'stop_circle';\n                color = '#2F80ED';\n                bgColor = 'rgba(47, 128, 237, 0.12)';\n                label = 'End: ' + formattedTime;\n            }\n            return { icon: icon, color: color, bgColor: bgColor, label: label };\n        }\n    }\n}",
                    "modules": {
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                      "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                    }
                  },
                  "customResources": [],
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "add",
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "icon",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "iconContainer": "iconContainer4",
                  "icon": "domain",
                  "size": 40,
                  "color": {
                    "type": "function",
                    "color": "#307FE5",
                    "rangeKey": null,
                    "range": null,
                    "colorFunction": {
                      "body": "return utils.getProgressColor(data.progress).color;",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    }
                  }
                },
                "markerImage": {
                  "type": "image",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": true,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedProject",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.5634367819170003,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce"
              },
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "role",
                    "type": "attribute",
                    "label": "role",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7014478669430672
                  },
                  {
                    "name": "displayAbortedMeasurement",
                    "type": "attribute",
                    "label": "displayAbortedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8011587598224269
                  },
                  {
                    "name": "displayActiveMeasurement",
                    "type": "attribute",
                    "label": "displayActiveMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8205299052205228
                  },
                  {
                    "name": "displayFinishedMeasurement",
                    "type": "attribute",
                    "label": "displayFinishedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.038665901375789624
                  },
                  {
                    "name": "displayPreparationMeasurement",
                    "type": "attribute",
                    "label": "displayPreparationMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.21373032656145663
                  }
                ],
                "dsEntityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [
              "metric"
            ],
            "dragModeButton": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [
              {
                "label": "Filter",
                "icon": "filter_alt",
                "color": "#0000008A",
                "action": {
                  "type": "openDashboardState",
                  "targetDashboardStateId": "Measurement_state_filter",
                  "setEntityId": true,
                  "stateEntityParamName": null,
                  "openRightLayout": false,
                  "popoverPreferredPlacement": "top",
                  "popoverHideOnClickOutside": true,
                  "popoverHideDashboardToolbar": true,
                  "popoverWidth": "300px",
                  "popoverHeight": "250px",
                  "popoverStyle": {
                    "padding": "16px",
                    "borderRadius": "8px",
                    "boxShadow": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
                    "background": "#ffffff"
                  },
                  "openInSeparateDialog": false,
                  "openInPopover": true
                }
              },
              {
                "label": "Add Project",
                "icon": "add",
                "color": "#0000008a",
                "action": {
                  "type": "placeMapItem",
                  "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"ui-demo-dialog\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"eco-dialog-header\">\n    <mat-icon class=\"header-icon\">folder_open</mat-icon>\n    <h2 class=\"header-title\">Add Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\" class=\"close-btn\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n  <div class=\"dialog-content\">\n    <!-- Customer Section -->\n    <div *ngIf=\"isTenantAdmin\" class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>business</mat-icon>\n        <span>Customer</span>\n      </div>\n      <div class=\"section-body\">\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Customer</mat-label>\n          <mat-select formControlName=\"customer\" (selectionChange)=\"onCustomerChange()\" required>\n            <mat-option *ngFor=\"let c of customers\" [value]=\"c\">{{ c.name }}</mat-option>\n          </mat-select>\n          <mat-error *ngIf=\"addProjectFormGroup.get('customer')?.hasError('required')\">Customer is required.</mat-error>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Project Info Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>folder</mat-icon>\n        <span>Project Info</span>\n      </div>\n      <div class=\"section-body\">\n        <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n        <mat-form-field appearance=\"fill\" class=\"w-full disabled-field\">\n          <mat-label>Project ID</mat-label>\n          <input matInput formControlName=\"name\" required readonly>\n          <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">Project ID is required.</mat-error>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Label</mat-label>\n          <input matInput formControlName=\"entityLabel\">\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Address Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>location_on</mat-icon>\n        <span>Address</span>\n      </div>\n      <div class=\"section-body\">\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Project address</mat-label>\n          <input matInput formControlName=\"address\" [matAutocomplete]=\"addrAuto\" autocomplete=\"off\">\n          <button mat-icon-button matSuffix type=\"button\" (click)=\"searchAddress()\" [disabled]=\"(addProjectFormGroup.get('address').value || '').length < 5\">\n            <mat-icon>search</mat-icon>\n          </button>\n          <mat-autocomplete #addrAuto=\"matAutocomplete\" [displayWith]=\"displayAddressOption\" (optionSelected)=\"onAddressSelected($event.option.value)\">\n            <mat-option *ngFor=\"let opt of addressOptions\" [value]=\"opt\">{{ opt.label }}</mat-option>\n          </mat-autocomplete>\n          <mat-hint *ngIf=\"(addProjectFormGroup.get('address').value || '').length < 5\">Enter at least 5 characters to search</mat-hint>\n        </mat-form-field>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Postal Code</mat-label>\n            <input matInput formControlName=\"postalCode\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" style=\"flex: 2;\">\n            <mat-label>City</mat-label>\n            <input matInput formControlName=\"city\">\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Latitude</mat-label>\n            <input matInput formControlName=\"latitude\">\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Longitude</mat-label>\n            <input matInput formControlName=\"longitude\">\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>NAT</mat-label>\n            <input matInput formControlName=\"normOutdoorTemp\" type=\"number\" step=\"0.1\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col disabled-field\">\n            <mat-label>NAT (calculated)</mat-label>\n            <input matInput formControlName=\"normOutdoorTempCalculated\" type=\"number\" step=\"0.1\" readonly>\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n\n    <!-- HDD Settings Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>thermostat</mat-icon>\n        <span>HDD Settings</span>\n      </div>\n      <div class=\"section-body\">\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Heating Limit</mat-label>\n            <input matInput formControlName=\"hddHeatingLimit\" type=\"number\" step=\"0.5\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Indoor Temperature</mat-label>\n            <input matInput formControlName=\"hddIndoorTemp\" type=\"number\" step=\"0.5\">\n            <span matSuffix>&deg;C</span>\n          </mat-form-field>\n        </div>\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\n          <mat-label>Reference HDD (Kd/a)</mat-label>\n          <input matInput formControlName=\"hddReference\" type=\"number\" step=\"1\">\n          <span matSuffix>Kd/a</span>\n        </mat-form-field>\n      </div>\n    </div>\n\n    <!-- Energy Costs Section -->\n    <div class=\"section-card\">\n      <div class=\"section-header\">\n        <mat-icon>payments</mat-icon>\n        <span>Energy Costs</span>\n      </div>\n      <div class=\"section-body\">\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Energy Price</mat-label>\n            <input matInput formControlName=\"energyPrice\" type=\"number\" step=\"0.01\">\n            <span matSuffix>EUR/kWh</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Demand Charge</mat-label>\n            <input matInput formControlName=\"demandCharge\" type=\"number\" step=\"0.01\">\n            <span matSuffix>EUR/kW/a</span>\n          </mat-form-field>\n        </div>\n        <div class=\"form-row\">\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>CO2 Factor</mat-label>\n            <input matInput formControlName=\"co2Factor\" type=\"number\" step=\"0.001\">\n            <span matSuffix>kg&nbsp;CO&#8322;/kWh</span>\n          </mat-form-field>\n          <mat-form-field appearance=\"fill\" class=\"form-col\">\n            <mat-label>Primary Energy Factor</mat-label>\n            <input matInput formControlName=\"primaryEnergyFactor\" type=\"number\" step=\"0.01\">\n            <span matSuffix>fPE</span>\n          </mat-form-field>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"dialog-footer\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>",
                  "customCss": "/* ECO Design System - Project Dialog */\n.eco-dialog-header {\n  display: flex; align-items: center; gap: 12px;\n  padding: 0 16px; height: 56px; min-height: 56px;\n  background-color: var(--tb-primary-500); color: white;\n  font-family: \"Roboto\", \"Helvetica Neue\", sans-serif;\n}\n.eco-dialog-header .header-icon { font-size: 24px; width: 24px; height: 24px; }\n.eco-dialog-header .header-title { margin: 0; font-size: 1.125rem; font-weight: 500; letter-spacing: -0.01em; }\n.eco-dialog-header .close-btn { color: rgba(255,255,255,0.8) !important; margin-left: auto; }\n.eco-dialog-header .close-btn:hover { color: white !important; background: rgba(255,255,255,0.1) !important; }\n.dialog-content {\n  padding: 1rem 1.25rem !important; background: #f8fafc !important;\n  display: flex; flex-direction: column; gap: 0.75rem;\n  max-height: calc(90vh - 130px); overflow-y: auto;\n  font-family: \"Roboto\", \"Helvetica Neue\", sans-serif;\n}\n.section-card { background: white; border: 1px solid #e2e8f0; border-left: 3px solid var(--tb-primary-500); overflow: visible; }\n.section-header { display: flex; align-items: center; gap: 8px; padding: 10px 14px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; font-weight: 600; font-size: 0.75rem; color: #334155; text-transform: uppercase; letter-spacing: 0.3px; }\n.section-header mat-icon { font-size: 16px; width: 16px; height: 16px; color: var(--tb-primary-500); }\n.section-body { padding: 12px 14px; display: flex; flex-direction: column; gap: 4px; }\n.section-body mat-form-field { width: 100%; }\n.section-body .mat-mdc-form-field-subscript-wrapper { margin-bottom: -4px; }\n.dialog-footer { display: flex; justify-content: flex-end; align-items: center; gap: 12px; padding: 0.75rem 1.25rem; border-top: 1px solid rgba(0,0,0,0.06); background: #fafafa; }\n.flex-1 { flex: 1; }\n.w-full { width: 100%; }\n.form-row { display: flex; gap: 12px; }\n.form-col { flex: 1; min-width: 0; }\n.mdc-text-field--filled:not(.mdc-text-field--disabled) { background-color: #F4F9FE !important; }\n.mat-mdc-form-field-focus-overlay { background-color: #F4F9FE !important; }\n.mdc-text-field--filled.mdc-text-field--disabled { background-color: rgba(244,249,254,0.5) !important; }\n.disabled-field input { color: rgba(0,0,0,0.6) !important; }\ntb-image-input .tb-image-input-container { min-height: 50px !important; max-height: 50px !important; }\ntb-image-input .dropzone { min-height: 42px !important; padding: 4px 8px !important; flex-direction: row !important; gap: 8px !important; }\ntb-image-input .dropzone mat-icon { font-size: 18px !important; width: 18px !important; height: 18px !important; }\ntb-image-input .dropzone span { font-size: 11px !important; }\n.mat-mdc-dialog-container, .mat-mdc-dialog-surface, .mdc-dialog__surface { border-radius: 0 !important; }",
                  "customFunction": "/*========================================================================*/\n/*========  Add Project with Customer Selection & Reverse Geocoding  =====*/\n/*========================================================================*/\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet $http = $injector.get(widgetContext.servicesMap.get('http'));\n\n// Get marker coordinates\nconst markerLat = additionalParams.coordinates.x;\nconst markerLon = additionalParams.coordinates.y;\n\nconsole.log(\"Marker Coordinates: \", markerLat, markerLon);\n\n// Check if Tenant Admin\nconst ctx = widgetContext;\nconst isTenantAdmin = ctx.currentUser.authority === 'TENANT_ADMIN';\n\n// Shared variables for async operations\nlet customers = [];\nlet customerId;\nlet customerName;\nlet addressData = null;\nlet nextProjectId = 0;\nlet customerShortName = '';\n\n// Step 1: Reverse Geocoding\nreverseGeocode(markerLat, markerLon)\n  .then(data => {\n    addressData = data;\n    console.log('Reverse geocoding result:', addressData);\n\n    // Step 2: Fetch customers based on user type\n    return fetchCustomers();\n  })\n  .then(() => {\n    console.log('Customers fetched:', customers);\n    console.log('customerId:', customerId);\n\n    // Step 3: Open dialog\n    openAddProjectDialog();\n  })\n  .catch(error => {\n    console.error('Error in Add Project workflow:', error);\n  });\n\n/**\n * Reverse Geocoding: Converts lat/lon to address using Photon API\n */\nfunction reverseGeocode(lat, lon) {\n  return new Promise((resolve, reject) => {\n    const url = `https://photon.komoot.io/reverse?lat=${lat}&lon=${lon}&limit=1`;\n\n    $http.get(url).subscribe(\n      response => {\n        if (response && response.features && response.features.length > 0) {\n          const feature = response.features[0];\n          const props = feature.properties;\n\n          let street = props.street || props.name || '';\n          let housenumber = props.housenumber || '';\n          let postcode = props.postcode || '';\n          let city = props.city || props.town || props.village || '';\n          let countryCode = props.countrycode ? props.countrycode.toUpperCase() : '';\n\n          let addressLine = street;\n          if (housenumber) {\n            addressLine += ' ' + housenumber;\n          }\n\n          let locationLine = '';\n          if (countryCode && postcode) {\n            locationLine = countryCode + '-' + postcode;\n          } else if (postcode) {\n            locationLine = postcode;\n          }\n          if (city) {\n            locationLine += (locationLine ? ' ' : '') + city;\n          }\n\n          let fullAddress = addressLine;\n          if (locationLine) {\n            fullAddress += ', ' + locationLine;\n          }\n\n          resolve({\n            address: fullAddress,\n            postalCode: postcode,\n            city: city,\n            latitude: lat,\n            longitude: lon\n          });\n        } else {\n          resolve({\n            address: '',\n            postalCode: '',\n            city: '',\n            latitude: lat,\n            longitude: lon\n          });\n        }\n      },\n      error => {\n        console.error('Photon API error:', error);\n        reject(error);\n      }\n    );\n  });\n}\n\n/**\n * Fetch customers based on user role\n * FIX: For Customer Users, use currentUser.customerId directly\n */\nfunction fetchCustomers() {\n  return new Promise((resolve, reject) => {\n    // FIX: Fr Customer Users den Customer direkt aus currentUser laden\n    if (!isTenantAdmin && ctx.currentUser.customerId) {\n      // customerId kann verschiedene Strukturen haben: String oder Objekt\n      const rawCustomerId = ctx.currentUser.customerId;\n      console.log('DEBUG rawCustomerId:', rawCustomerId, 'type:', typeof rawCustomerId);\n\n      let customerIdString;\n      if (typeof rawCustomerId === 'string') {\n        customerIdString = rawCustomerId;\n        customerId = { id: rawCustomerId, entityType: 'CUSTOMER' };\n      } else if (rawCustomerId && rawCustomerId.id) {\n        customerIdString = rawCustomerId.id;\n        customerId = rawCustomerId;\n      }\n\n      console.log('DEBUG customerIdString:', customerIdString);\n      console.log('DEBUG customerId object:', customerId);\n\n      if (customerIdString) {\n        customerService.getCustomer(customerIdString).subscribe(\n          customer => {\n            customerName = customer.name;\n            customers = [customer];\n            console.log('Loaded customer for Customer User:', customerName);\n            resolve();\n          },\n          error => {\n            console.error('Failed to load customer:', error);\n            // Fallback: Try getUserCustomers\n            fallbackGetUserCustomers(resolve, reject);\n          }\n        );\n      } else {\n        fallbackGetUserCustomers(resolve, reject);\n      }\n    } else {\n      // Fr Tenant Admin: alle Customers laden\n      const pageLink = ctx.pageLink(1000, 0, null, null, null);\n      customerService.getUserCustomers(pageLink).subscribe(\n        pageData => {\n          customers = (pageData && pageData.data) ? pageData.data : [];\n          resolve();\n        },\n        error => {\n          console.error('Error fetching customers:', error);\n          reject(error);\n        }\n      );\n    }\n  });\n}\n\nfunction fallbackGetUserCustomers(resolve, reject) {\n  const pageLink = ctx.pageLink(1000, 0, null, null, null);\n  customerService.getUserCustomers(pageLink).subscribe(\n    pageData => {\n      customers = (pageData && pageData.data) ? pageData.data : [];\n      if (customers.length > 0) {\n        const c = customers[0];\n        customerId = { id: c.id.id, entityType: 'CUSTOMER' };\n        customerName = c.name;\n      }\n      resolve();\n    },\n    error => {\n      console.error('Fallback getUserCustomers failed:', error);\n      reject(error);\n    }\n  );\n}\n\nfunction openAddProjectDialog() {\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\n}\n\nfunction AddProjectDialogController(instance) {\n  let vm = instance;\n\n  vm.isTenantAdmin = isTenantAdmin;\n  vm.customers = customers;\n\n  // FormGroup erstellen\n  vm.addProjectFormGroup = vm.fb.group({\n    customer: [{ value: null, disabled: !isTenantAdmin }, vm.validators.required],\n    name: [{ value: '', disabled: true }, vm.validators.required],\n    entityLabel: [''],\n    projectPicture: [''],\n    address: [addressData ? addressData.address : ''],\n    postalCode: [addressData ? addressData.postalCode : ''],\n    city: [addressData ? addressData.city : ''],\n    latitude: [addressData ? addressData.latitude.toFixed(6) : markerLat.toFixed(6)],\n    longitude: [addressData ? addressData.longitude.toFixed(6) : markerLon.toFixed(6)],\n    normOutdoorTemp: [null],\n      normOutdoorTempCalculated: [null],\n    hddHeatingLimit: [12],\n    hddIndoorTemp: [20],\n    hddReference: [null],\n    energyPrice: [null],\n    demandCharge: [null],\n    co2Factor: [null],\n    primaryEnergyFactor: [null]\n  });\n\n  // Customer vorausfllen (Non-Tenant-Admin)\n  if (!isTenantAdmin && customerId) {\n    vm.addProjectFormGroup.patchValue({\n      customer: customers[0]\n    });\n    vm.addProjectFormGroup.get('customer').markAsDirty();\n    loadCustomerData(customerId);\n  }\n\n  // Customer Change Handler (fr Tenant Admin)\n  vm.onCustomerChange = function () {\n    const c = vm.addProjectFormGroup.getRawValue().customer;\n    if (!c) return;\n\n    customerId = {\n      id: c.id.id,\n      entityType: 'CUSTOMER'\n    };\n    customerName = c.name;\n\n    loadCustomerData(customerId);\n  };\n\n  // Load customer-specific data (projects + shortName)\n  function loadCustomerData(custId) {\n    const assetSearchQuery = {\n      \"parameters\": {\n        \"rootId\": custId.id,\n        \"rootType\": \"CUSTOMER\",\n        \"direction\": \"FROM\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 10,\n        \"fetchLastLevelOnly\": false\n      },\n      \"relationType\": \"Owns\",\n      \"assetTypes\": [\"Project\"]\n    };\n\n    assetService.findByQuery(assetSearchQuery).subscribe(projects => {\n      nextProjectId = getLastProjectId(projects);\n\n      attributeService\n        .getEntityAttributes(custId, 'SERVER_SCOPE', ['shortName'])\n        .subscribe(attributes => {\n          const shortNameAttr = attributes.find(a => a.key === 'shortName');\n          customerShortName = shortNameAttr ? shortNameAttr.value : customerName;\n\n          vm.addProjectFormGroup.patchValue({\n            name: customerShortName + '_' + nextProjectId\n          });\n\n          vm.addProjectFormGroup.get('name').markAsDirty();\n        });\n    });\n  }\n\n  function getLastProjectId(projects) {\n    let maxNumber = 0;\n    projects.forEach(item => {\n      const name = item.name;\n      const parts = name.split('_');\n      if (parts.length === 2) {\n        const number = parseInt(parts[1], 10);\n        if (number > maxNumber) {\n          maxNumber = number;\n        }\n      }\n    });\n    return maxNumber + 1;\n  }\n\n  vm.cancel = function() {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function () {\n    if (!customerId) {\n      console.error('No customer selected');\n      return;\n    }\n\n    const formValues = vm.addProjectFormGroup.getRawValue();\n    if (!formValues.name || formValues.name === '') {\n      console.error('Project name is not set. Please select a customer first.');\n      return;\n    }\n\n    vm.addProjectFormGroup.markAsPristine();\n    saveProjectObservable(customerId).subscribe(\n      function (Project) {\n        widgetContext.rxjs.forkJoin([\n          saveCustomerToProjectRelation(customerId, Project.id),\n          saveAttributes(Project.id)\n        ]).subscribe(\n          function () {\n            var params = widgetContext.stateController.getStateParams();\n            params['selectedProject'] = {\n              entityId: Project.id,\n              entityName: Project.name,\n              entityLabel: ''\n            };\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n          }\n        );\n      }\n    );\n  };\n\n  function saveProjectObservable(custId) {\n    return getProjectsGroup(custId).pipe(\n      widgetContext.rxjs.switchMap((ProjectsGroup) => {\n        const formValues = vm.addProjectFormGroup.getRawValue();\n        let Project = {\n          name: formValues.name,\n          type: 'Project',\n          label: formValues.entityLabel,\n          customerId: custId\n        };\n        return assetService.saveAsset(Project, ProjectsGroup.id.id)\n      })\n    );\n  }\n\n  function saveAttributes(entityId) {\n    let attributesArray = getMapItemLocationAttributes();\n    const formValues = vm.addProjectFormGroup.getRawValue();\n\n    attributesArray.push({key: 'address', value: formValues.address});\n    attributesArray.push({key: 'postalCode', value: formValues.postalCode});\n    attributesArray.push({key: 'city', value: formValues.city});\n    attributesArray.push({key: 'progress', value: 'in preparation'});\n    attributesArray.push({key: 'units', value: 'metric'});\n    attributesArray.push({key: 'projectPicture', value: formValues.projectPicture || ''});\n\n    // NAT\n    if (formValues.normOutdoorTemp !== null && formValues.normOutdoorTemp !== '') {\n      attributesArray.push({key: 'normOutdoorTemp', value: formValues.normOutdoorTemp});\n    }\n    if (formValues.normOutdoorTempCalculated !== null && formValues.normOutdoorTempCalculated !== '') {\n      attributesArray.push({key: 'normOutdoorTempCalculated', value: formValues.normOutdoorTempCalculated});\n    }\n\n    // HDD Settings\n    if (formValues.hddHeatingLimit !== null && formValues.hddHeatingLimit !== '') {\n      attributesArray.push({key: 'hddHeatingLimit', value: formValues.hddHeatingLimit});\n    }\n    if (formValues.hddIndoorTemp !== null && formValues.hddIndoorTemp !== '') {\n      attributesArray.push({key: 'hddIndoorTemp', value: formValues.hddIndoorTemp});\n    }\n    if (formValues.hddReference !== null && formValues.hddReference !== '') {\n      attributesArray.push({key: 'hddReference', value: formValues.hddReference});\n    }\n    // Energy Costs\n    if (formValues.energyPrice !== null && formValues.energyPrice !== '') {\n      attributesArray.push({key: 'energyPrice', value: formValues.energyPrice});\n    }\n    if (formValues.demandCharge !== null && formValues.demandCharge !== '') {\n      attributesArray.push({key: 'demandCharge', value: formValues.demandCharge});\n    }\n    if (formValues.co2Factor !== null && formValues.co2Factor !== '') {\n      attributesArray.push({key: 'co2Factor', value: formValues.co2Factor});\n    }\n    if (formValues.primaryEnergyFactor !== null && formValues.primaryEnergyFactor !== '') {\n      attributesArray.push({key: 'primaryEnergyFactor', value: formValues.primaryEnergyFactor});\n    }\n\n    if (attributesArray.length > 0) {\n      return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n    }\n    return widgetContext.rxjs.of([]);\n  }\n\n  function getProjectsGroup(custId) {\n    return entityGroupService.getEntityGroupsByOwnerId(custId.entityType, custId.id, 'ASSET').pipe(\n      widgetContext.rxjs.switchMap((entityGroups) => {\n        var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\n        if (ProjectsGroup) {\n          return widgetContext.rxjs.of(ProjectsGroup);\n        } else {\n          ProjectsGroup = {\n            type: 'ASSET',\n            name: 'Projects',\n            ownerId: custId\n          };\n          return entityGroupService.saveEntityGroup(ProjectsGroup);\n        }\n      })\n    );\n  }\n\n  function saveCustomerToProjectRelation(custId, ProjectId) {\n    var relation = {\n      from: custId,\n      to: ProjectId,\n      typeGroup: 'COMMON',\n      type: 'Owns'\n    };\n    return entityRelationService.saveRelation(relation);\n  }\n\n  function getMapItemLocationAttributes() {\n    const attributes = [];\n    const mapItemType = $event.shape;\n    if (mapItemType === 'Marker') {\n      const mapType = widgetContext.mapInstance.type();\n      attributes.push({key: mapType === 'image' ? 'xPos' : 'latitude', value: additionalParams.coordinates.x});\n      attributes.push({key: mapType === 'image' ? 'yPos' : 'longitude', value: additionalParams.coordinates.y});\n    } else if (mapItemType === 'Rectangle' || mapItemType === 'Polygon') {\n      attributes.push({key: 'perimeter', value: additionalParams.coordinates});\n    } else if (mapItemType === 'Circle') {\n      attributes.push({key: 'circle', value: additionalParams.coordinates});\n    }\n    return attributes;\n  }\n}\n",
                  "customResources": [],
                  "mapItemType": "marker",
                  "mapItemTooltips": {},
                  "openInSeparateDialog": false,
                  "openInPopover": false
                }
              }
            ],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "8px"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": true,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {
            "headerButton": []
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "fb583db5-3fc6-275a-34f4-120bfe140af2"
      },
      "e354c44b-c1c8-fb3d-5b59-a5289253db07": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_timeseries_zoom_sync",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#f44336",
                  "settings": {
                    "chartsAssignment": [
                      1
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.9444811527116705,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#ffc107",
                  "settings": {
                    "chartsAssignment": [
                      2
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.6453341809415059,
                  "aggregationType": null,
                  "units": "ppm",
                  "decimals": 0,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#607d8b",
                  "settings": {
                    "chartsAssignment": [
                      3
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.6391401664350539,
                  "aggregationType": null,
                  "units": "%",
                  "decimals": 0,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.496052658010679
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.13418022126324225
                }
              ]
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_HOUR",
              "interval": 5000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "chartType": "line",
            "smoothLine": true,
            "displayMode": "stacked",
            "lineWidth": 2,
            "showArea": null,
            "areaOpacity": 0.3,
            "showDataZoomSlider": true,
            "showLegend": true,
            "legendStyle": "card",
            "legendPosition": "top",
            "legendAlign": "center",
            "legendCardColorMode": "auto",
            "legendCardColor": "#2196F3",
            "legendValues": [
              "current",
              "min",
              "max"
            ],
            "showTimestamp": false,
            "timestampFormat": "YYYY-MM-DD HH:mm:ss",
            "yAxisMin": null,
            "yAxisMax": null,
            "yAxis2Min": null,
            "yAxis2Max": null,
            "removeOutliers": true,
            "outlierMethod": "iqr",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 3,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "smoothingEnabled": true,
            "smoothingWindowMinutes": 5,
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorColor": "#435B63",
            "twSelectorPosition": "left",
            "twSelectorDefaultMode": "custom",
            "twSelectorDayFormat": "DD.MM.YYYY",
            "twSelectorWeekFormat": "DD.MM.YYYY - DD.MM.YYYY",
            "twSelectorMonthFormat": "MMMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twAggregationType": "NONE",
            "twMaxDataPoints": 100000,
            "chartSpacing": 2,
            "chartTopMargin": 5,
            "chartBottomMargin": 1,
            "chart1Enabled": true,
            "chart1Title": "Power",
            "chart1Type": "line",
            "chart1Height": null,
            "chart1YAxisLeftTitle": null,
            "chart1YAxisRightTitle": null,
            "chart2Enabled": true,
            "chart2Title": "Volume Flow",
            "chart2Type": "line",
            "chart2Height": null,
            "chart2YAxisLeftTitle": null,
            "chart2YAxisRightTitle": null,
            "chart3Enabled": true,
            "chart3Title": "Temperatures",
            "chart3Type": "line",
            "chart3Height": null,
            "chart3YAxisLeftTitle": "Temperature (C)",
            "chart3YAxisRightTitle": null,
            "chart4Enabled": null,
            "chart4Title": null,
            "chart4Type": "line",
            "chart4Height": null,
            "chart4YAxisLeftTitle": null,
            "chart4YAxisRightTitle": null,
            "chartTitleFontSize": 12,
            "chartTitleOpacity": 1,
            "chartTitleColor": "#666666",
            "axisLabelFontSize": 11,
            "axisLabelColor": "#666666",
            "axisTickFontSize": 10
          },
          "title": "ECO Timeseries Zoom Sync",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "margin": "",
          "borderRadius": "",
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "e354c44b-c1c8-fb3d-5b59-a5289253db07"
      },
      "1ee843bb-c0dd-4547-e431-e8c7136e25b8": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_timeseries_zoom_sync",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "P_th_kW",
                  "type": "timeseries",
                  "label": "Power",
                  "color": "#F44336",
                  "settings": {
                    "chartIndex": 1,
                    "yAxisIndex": 0,
                    "yAxisLabel": null,
                    "yAxisUnit": null,
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.7243417145383836,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "Vdot_m3h",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#048AD3",
                  "settings": {
                    "chartsAssignment": [
                      2
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.2976350468906287,
                  "aggregationType": null,
                  "units": "m/hr",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "T_flow_C",
                  "type": "timeseries",
                  "label": "Temperature Flow",
                  "color": "#E91E63",
                  "settings": {
                    "chartsAssignment": [
                      3
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.06402744684616413,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "T_return_C",
                  "type": "timeseries",
                  "label": "Temperature Return",
                  "color": "#673AB7",
                  "settings": {
                    "chartsAssignment": [
                      3
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.054478723552532804,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "dT_K",
                  "type": "timeseries",
                  "label": "Temperature Difference",
                  "color": "#E89623",
                  "settings": {
                    "chartsAssignment": [
                      3
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.09203730244585884,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.496052658010679
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.13418022126324225
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "Temperature Outside",
                  "color": "#F5DD00",
                  "settings": {
                    "chartsAssignment": [
                      1,
                      2
                    ],
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.43370536744548527,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_HOUR",
              "interval": 5000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "chartType": "line",
            "smoothLine": true,
            "displayMode": "stacked",
            "lineWidth": 2,
            "showArea": null,
            "areaOpacity": 0.3,
            "showDataZoomSlider": true,
            "showLegend": true,
            "legendStyle": "card",
            "legendPosition": "top",
            "legendAlign": "center",
            "legendCardColorMode": "auto",
            "legendCardColor": "#2196F3",
            "legendValues": [
              "current",
              "min",
              "max"
            ],
            "showTimestamp": false,
            "timestampFormat": "YYYY-MM-DD HH:mm:ss",
            "yAxisMin": null,
            "yAxisMax": null,
            "yAxis2Min": null,
            "yAxis2Max": null,
            "removeOutliers": true,
            "outlierMethod": "zscore",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 10,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "smoothingEnabled": true,
            "smoothingWindowMinutes": 1,
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorColor": "#435B63",
            "twSelectorPosition": "center",
            "twSelectorDefaultMode": "custom",
            "twSelectorDayFormat": "DD.MM.YYYY",
            "twSelectorWeekFormat": "DD.MM.YYYY - DD.MM.YYYY",
            "twSelectorMonthFormat": "MMMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twAggregationType": "NONE",
            "twMaxDataPoints": 100000,
            "chartSpacing": 2,
            "chartTopMargin": 5,
            "chartBottomMargin": 1,
            "chart1Enabled": true,
            "chart1Title": "Power",
            "chart1Type": "line",
            "chart1Height": null,
            "chart1YAxisLeftTitle": null,
            "chart1YAxisLeftGap": null,
            "chart1YAxisRightTitle": null,
            "chart1YAxisRightGap": null,
            "chart2Enabled": true,
            "chart2Title": "Volume Flow",
            "chart2Type": "line",
            "chart2Height": null,
            "chart2YAxisLeftTitle": null,
            "chart2YAxisLeftGap": null,
            "chart2YAxisRightTitle": null,
            "chart2YAxisRightGap": null,
            "chart3Enabled": true,
            "chart3Title": "Temperatures",
            "chart3Type": "line",
            "chart3Height": null,
            "chart3YAxisLeftTitle": "Temperature (C)",
            "chart3YAxisLeftGap": null,
            "chart3YAxisRightTitle": null,
            "chart3YAxisRightGap": null,
            "chart4Enabled": null,
            "chart4Title": null,
            "chart4Type": "line",
            "chart4Height": null,
            "chart4YAxisLeftTitle": null,
            "chart4YAxisLeftGap": null,
            "chart4YAxisRightTitle": null,
            "chart4YAxisRightGap": null,
            "chartTitleFontSize": 12,
            "chartTitleOpacity": 1,
            "chartTitleColor": "#666666",
            "axisLabelFontSize": 11,
            "axisLabelColor": "#666666",
            "axisTickFontSize": 10
          },
          "title": "ECO Timeseries Zoom Sync",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "margin": "",
          "borderRadius": "",
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "1ee843bb-c0dd-4547-e431-e8c7136e25b8"
      },
      "a21078eb-a587-780d-7dfe-2698ff6a84bf": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_heatmap_cartesian",
        "type": "timeseries",
        "sizeX": 10,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "P_th_kW",
                  "type": "timeseries",
                  "label": "Power",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.993016872768508,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "is_on",
                  "type": "timeseries",
                  "label": "is_on",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.11738694638415748
                },
                {
                  "name": "Vdot_m3h",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.19300246084914385,
                  "aggregationType": null,
                  "units": "m/hr",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.08177395908869056
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.6030533039795397
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "Temperature Outside",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.7940256534221138,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "interval": 3600000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "viewMode": "custom",
            "timeResolution": "1h",
            "showCellValues": false,
            "highlightWeekends": true,
            "weekendColor": "#F44336",
            "customStartTime": "${startTimeMs}",
            "customEndTime": "${endTimeMs}",
            "calculateConsumption": null,
            "aggregationMode": "avg",
            "compareMode": null,
            "comparePeriod": "previousWeek",
            "enableZoomSync": false,
            "zoomSyncDebounce": 150,
            "showDataZoomSlider": false,
            "colorScheme": "temperature",
            "minColor": "#E3F2FD",
            "maxColor": "#0D47A1",
            "showVisualMap": true,
            "minValue": null,
            "maxValue": null,
            "showTooltip": true,
            "additionalTooltipKeys": "outsideTemp,Vdot_m3h",
            "showLegend": true,
            "legendStyle": "card",
            "legendPosition": "top",
            "legendAlign": "center",
            "legendCardColorMode": "auto",
            "legendCardColor": "#2196F3",
            "legendValues": [
              "min",
              "max",
              "mean",
              "baseload",
              "peak"
            ],
            "showTimestamp": false,
            "timestampFormat": "YYYY-MM-DD HH:mm:ss",
            "removeOutliers": true,
            "outlierMethod": "zscore",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 10,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "smoothingEnabled": true,
            "smoothingWindowMinutes": 60,
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorDefaultMode": "day",
            "twSelectorColor": "#435B63",
            "twSelectorPosition": "center",
            "twSelectorDayFormat": "D MMM YYYY",
            "twSelectorWeekFormat": "D-D MMM",
            "twSelectorMonthFormat": "MMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twAggregationType": "NONE",
            "twMaxDataPoints": 100000,
            "showBaselineAnalysis": true,
            "isOnDataKey": "is_on",
            "baseloadMethod": "percentile",
            "baseloadPercentile": 10,
            "highlightStandbyConsumption": true,
            "standbyThreshold": 0.1,
            "standbyColor": "#E91E63",
            "showPeakMarkers": true,
            "peakloadMethod": "percentile",
            "peakloadPercentile": 95,
            "peakloadSigma": 2,
            "peakThresholdValue": 150,
            "peakColor": "#FF5722",
            "enablePeakSimulation": true,
            "peakSliderMin": 1,
            "peakSliderMax": 500,
            "peakSliderStep": 1,
            "peakSliderDefault": null,
            "peakSliderColor": "#FF5722",
            "showPeakKpiCards": true,
            "showPeaksOnlyToggle": true
          },
          "title": "Heatmap Cartesian",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "a21078eb-a587-780d-7dfe-2698ff6a84bf"
      },
      "75113984-0850-03fe-9a34-27f9ea92a37b": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_energy_flow_card",
        "type": "timeseries",
        "sizeX": 12,
        "sizeY": 8,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "P_th_kW",
                  "type": "timeseries",
                  "label": "Power",
                  "color": "#2196f3",
                  "settings": {}
                },
                {
                  "name": "E_th_kWh",
                  "type": "timeseries",
                  "label": "Energy",
                  "color": "#4caf50",
                  "settings": {}
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "Start Time",
                  "settings": {}
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "End Time",
                  "settings": {}
                }
              ]
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_HOUR",
              "interval": 5000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "relationType": "MeasurementHierarchy",
            "powerAttribute": "P_th_kW",
            "energyAttribute": "E_th_kWh",
            "weightAttribute": "interpolationWeight",
            "targetState": "",
            "defaultMode": "energy",
            "showToolbar": true,
            "showAnimation": true,
            "dotsPerLine": 3,
            "minFlowRate": 0.75,
            "maxFlowRate": 6,
            "nodeScale": 150,
            "showTimewindowSelector": true,
            "twSelectorColor": "#435B63",
            "twSelectorPosition": "center",
            "twSelectorDefaultMode": "custom",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "heatingColor": "#f44336",
            "coolingColor": "#2196f3",
            "unmeasuredColor": "#9e9e9e",
            "generatorColor": "#4caf50",
            "generatorIcon": "bolt",
            "subDistributionIcon": "device_hub",
            "circuitIcon": "thermostat",
            "unmeasuredIcon": "calculate",
            "valueStyle": "valueAndPercentage",
            "labelMode": "auto",
            "cardTemplate": "[{\"icon\":true,\"size\":20},{\"text\":\"${entityLabel}\",\"fontSize\":12,\"bold\":true,\"maxLength\":18},{\"text\":\"${value}\",\"fontSize\":13,\"bold\":true},{\"text\":\"${measurementRole}\",\"fontSize\":9},{\"text\":\"Design: ${designPower} kW\",\"fontSize\":9,\"condition\":\"designPower\"}]"
          },
          "title": "Energy Flow Card",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "75113984-0850-03fe-9a34-27f9ea92a37b"
      },
      "4ff09ee3-18bc-09c0-cd0a-ff09c8c40c5f": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_scatter_xy",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "T_flow_C",
                  "type": "timeseries",
                  "label": "Flow Temperature",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.9488636227613657,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "is_on",
                  "type": "timeseries",
                  "label": "is_on",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.4521744992793243
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.9200358836731681
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.6620390630061979
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "outsideTemp",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5831341137960312
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_HOUR",
              "interval": 5000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "axisMode": "xy",
            "xAxisDataKey": "outsideTemp",
            "yAxisDataKey": "T_flow_C",
            "xAxisLabel": "Outside Temperature",
            "xAxisUnit": "C",
            "yAxisLabel": null,
            "enableZoom": false,
            "showDataZoomSlider": false,
            "pointSize": 6,
            "pointOpacity": 0.6,
            "symbolShape": "circle",
            "showRegressionLine": true,
            "regressionLineWidth": 2,
            "maxTimestampDiffSeconds": 3600,
            "aggregateBucketMinutes": 60,
            "isOnDataKey": "is_on",
            "removeOutliers": true,
            "outlierMethod": "zscore",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 10,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "smoothingEnabled": true,
            "smoothingWindowMinutes": 60,
            "showLegend": true,
            "legendStyle": "card",
            "legendPosition": "top",
            "legendAlign": "center",
            "legendCardColorMode": "auto",
            "legendCardColor": "#2196F3",
            "legendValues": [
              "min",
              "max",
              "mean",
              "count",
              "r2"
            ],
            "showTimestamp": false,
            "timestampFormat": "YYYY-MM-DD HH:mm:ss",
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorColor": null,
            "twSelectorPosition": "center",
            "twSelectorDefaultMode": "custom",
            "twSelectorDayFormat": "DD.MM.YYYY",
            "twSelectorWeekFormat": "DD.MM.YYYY - DD.MM.YYYY",
            "twSelectorMonthFormat": "MMMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twAggregationType": "NONE",
            "twMaxDataPoints": 100000,
            "axisLabelFontSize": 11,
            "axisLabelColor": "#666666",
            "axisTickFontSize": 10
          },
          "title": "ECO Scatter X/Y",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "4ff09ee3-18bc-09c0-cd0a-ff09c8c40c5f"
      },
      "4921e6d8-0905-4e69-1181-75765fbc57c8": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_weather_normalized_consumption",
        "type": "timeseries",
        "sizeX": 10,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "E_th_kWh",
                  "type": "timeseries",
                  "label": "Energy",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.9827082454840694,
                  "aggregationType": null,
                  "units": "kWh",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.4275701392804667
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.16526601855675294
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "Temperature Outside",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.22055229400635357,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 1,
            "history": {
              "historyType": 1,
              "fixedTimewindow": {
                "startTimeMs": 1769608899384,
                "endTimeMs": 1770501782552
              },
              "interval": 1786000,
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "temperatureDataKey": "outsideTemp",
            "consumptionMode": "meter",
            "heatingThreshold": 12,
            "indoorTemp": 20,
            "referenceGTZ": "3400",
            "buildingArea": null,
            "showConsumptionBars": true,
            "showHDDBars": true,
            "showTempLine": true,
            "showTrendLine": true,
            "enableZoom": true,
            "consumptionColorHeating": "#FF7043",
            "consumptionColorNonHeating": "#BDBDBD",
            "hddColor": "#42A5F5",
            "tempLineColor": "#66BB6A",
            "trendLineColor": "#AB47BC",
            "showLegend": true,
            "legendStyle": "card",
            "legendPosition": "top",
            "legendAlign": "center",
            "legendCardColorMode": "auto",
            "legendCardColor": "#2196F3",
            "showTimestamp": false,
            "timestampFormat": "YYYY-MM-DD HH:mm:ss",
            "showEnergyCard": true,
            "energyCardTitle": null,
            "energyCardColorMode": "",
            "energyCardColor": null,
            "energyCardValues": [
              "mean",
              "sum",
              "normalizedAnnual",
              "perSquareMeter"
            ],
            "showTempCard": true,
            "tempCardTitle": null,
            "tempCardColorMode": "",
            "tempCardColor": null,
            "tempCardValues": [
              "min",
              "max",
              "mean"
            ],
            "showHddCard": true,
            "hddCardTitle": null,
            "hddCardColorMode": "",
            "hddCardColor": null,
            "hddCardValues": [
              "sum",
              "count"
            ],
            "showEfficiencyCard": true,
            "efficiencyCardTitle": null,
            "efficiencyCardColorMode": "",
            "efficiencyCardColor": null,
            "efficiencyCardValues": [
              "min",
              "max",
              "mean"
            ],
            "filterIncompleteDays": "trim",
            "minDayHours": 23,
            "removeOutliers": true,
            "outlierMethod": "zscore",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 10,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorColor": null,
            "twSelectorPosition": "center",
            "twSelectorDefaultMode": "custom",
            "twSelectorDayFormat": "DD.MM.YYYY",
            "twSelectorWeekFormat": "DD.MM.YYYY - DD.MM.YYYY",
            "twSelectorMonthFormat": "MMMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}"
          },
          "title": "Weather-Normalized Consumption",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "4921e6d8-0905-4e69-1181-75765fbc57c8"
      },
      "87816380-086a-5eb9-bff2-e1763bb7a8bd": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_energy_signature",
        "type": "timeseries",
        "sizeX": 10,
        "sizeY": 7,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "P_th_kW",
                  "type": "timeseries",
                  "label": "Power",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.20204826812463583,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "Vdot_m3h",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.19039893187344548,
                  "aggregationType": null,
                  "units": "m/hr",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "is_on",
                  "type": "timeseries",
                  "label": "is_on",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.6214494248429233
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.3775134475783908
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.13744799869617474
                },
                {
                  "name": "valveDimension",
                  "type": "attribute",
                  "label": "valveDimension",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.21022386254064696
                },
                {
                  "name": "valveKvs",
                  "type": "attribute",
                  "label": "valveKvs",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.07858538882916422
                },
                {
                  "name": "valveType",
                  "type": "attribute",
                  "label": "valveType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.9296999053546136
                },
                {
                  "name": "designDeltaT",
                  "type": "attribute",
                  "label": "designDeltaT",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.7405241878291021
                },
                {
                  "name": "designFlow",
                  "type": "attribute",
                  "label": "designFlow",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.9653543641586485
                },
                {
                  "name": "designPower",
                  "type": "attribute",
                  "label": "designPower",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.7718352731182668
                },
                {
                  "name": "designFlowTemp",
                  "type": "attribute",
                  "label": "designFlowTemp",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.5620509085518408
                },
                {
                  "name": "designReturnTemp",
                  "type": "attribute",
                  "label": "designReturnTemp",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.6261276351260457
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "Temperature Outside",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.8690816953694742,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "interval": 60000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "pThDataKey": "P_th_kW",
            "vdotDataKey": "Vdot_m3h",
            "tOutDataKey": "outsideTemp",
            "isOnDataKey": "is_on",
            "pThUnit": "kW",
            "vdotUnit": "m/h",
            "tOutUnit": "C",
            "normOutdoorTemp": "-13",
            "normOutdoorTempCalculated": "-9",
            "safetyFactor": 10,
            "aggregateBucketMinutes": 60,
            "maxTimestampDiffSeconds": 3600,
            "minDataPoints": 10,
            "designPower": "${designPower}",
            "designFlow": "${designFlow}",
            "designDeltaT": "${designDeltaT}",
            "designFlowTemp": "${designFlowTemp}",
            "designReturnTemp": "${designReturnTemp}",
            "showValveComparison": true,
            "currentValveDN": "${valveDimension}",
            "currentValveKvs": "${valveKvs}",
            "currentValveType": "${valveType}",
            "valveSeriesFilter": "all",
            "chartViewMode": "power",
            "showToggleButton": true,
            "pointSize": 6,
            "pointOpacity": 0.6,
            "scatterColor": "#2196F3",
            "regressionLineWidth": 2,
            "regressionColor": null,
            "showMarkLines": true,
            "showMarkPoints": true,
            "showDataZoomSlider": false,
            "removeOutliers": true,
            "outlierMethod": "zscore",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 10,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "filterMinPower": 1,
            "smoothingEnabled": null,
            "smoothingWindowMinutes": 15,
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorColor": null,
            "twSelectorPosition": "center",
            "twSelectorDefaultMode": "custom",
            "twSelectorDayFormat": "DD.MM.YYYY",
            "twSelectorWeekFormat": "DD.MM.YYYY - DD.MM.YYYY",
            "twSelectorMonthFormat": "MMMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twAggregationType": "NONE",
            "twMaxDataPoints": 100000,
            "axisLabelFontSize": 14,
            "axisLabelColor": "#666666",
            "axisTickFontSize": 13,
            "resultsPanelFontSize": 14,
            "natLineColor": "#1565C0",
            "nat2Color": "#42A5F5",
            "tMinColor": "#FF9800",
            "tMaxColor": "#F44336"
          },
          "title": "ECO Energy Signature",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "87816380-086a-5eb9-bff2-e1763bb7a8bd"
      },
      "c2394469-7696-cec4-8033-fc9fa9c8c79f": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_delta_t_analysis",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "P_th_kW",
                  "type": "timeseries",
                  "label": "Power",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8869024489244012,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "dT_K",
                  "type": "timeseries",
                  "label": "Delta T",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.3410476529379184,
                  "aggregationType": null,
                  "units": "K",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "dT_flag",
                  "type": "timeseries",
                  "label": "dT_flag",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.7395392993606684
                },
                {
                  "name": "is_on",
                  "type": "timeseries",
                  "label": "is_on",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.02175897179182107
                },
                {
                  "name": "Vdot_m3h",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.12324874708720845,
                  "aggregationType": null,
                  "units": "m/hr",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "designDeltaT",
                  "type": "attribute",
                  "label": "designDeltaT",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.13740798695893108
                },
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.21495996496451364
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8812951845428376
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "Temperature Outside",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.6388677365549297,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_HOUR",
              "interval": 5000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "pthDataKey": "P_th_kW",
            "dtDataKey": "dT_K",
            "dtFlagDataKey": "dT_flag",
            "outsideTempDataKey": "outsideTemp",
            "vdotDataKey": "Vdot_m3h",
            "designDeltaTKey": "${designDeltaT}",
            "designDeltaTValue": 10,
            "maxTimestampDiffSeconds": 3600,
            "xAxisLabel": null,
            "xAxisUnit": "",
            "yAxisLabel": null,
            "yAxisUnit": "",
            "pointSize": 8,
            "pointOpacity": 0.7,
            "minBubbleSize": 4,
            "maxBubbleSize": 20,
            "colorOk": "#4CAF50",
            "colorWarn": "#FF9800",
            "colorSevere": "#F44336",
            "showDesignLine": true,
            "designLineColor": "#E91E63",
            "designLineStyle": "dashed",
            "designLineWidth": 3,
            "aggregateBucketMinutes": 5,
            "isOnDataKey": "is_on",
            "removeOutliers": true,
            "outlierMethod": "zscore",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 10,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "pumpRatedPowerKey": null,
            "pumpRatedPowerValue": null,
            "pumpControlTypeKey": null,
            "currentPumpPowerKey": null,
            "showKpiCards": true,
            "showLegend": true,
            "enableZoom": false,
            "showDataZoomSlider": false,
            "showToolbox": false,
            "showTimewindowSelector": true,
            "twSelectorColor": null,
            "twSelectorPosition": "center",
            "twSelectorDefaultMode": "custom",
            "twSelectorDayFormat": "DD.MM.YYYY",
            "twSelectorWeekFormat": "DD.MM.YYYY - DD.MM.YYYY",
            "twSelectorMonthFormat": "MMMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twMaxDataPoints": 100000,
            "axisLabelFontSize": 11,
            "axisLabelColor": "#666666",
            "axisTickFontSize": 10
          },
          "title": "ECO Delta T Analysis",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "c2394469-7696-cec4-8033-fc9fa9c8c79f"
      },
      "949f1723-a3d4-d935-8ddc-c42b3e461815": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_load_duration_curve",
        "type": "timeseries",
        "sizeX": 10,
        "sizeY": 8,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "P_th_kW",
                  "type": "timeseries",
                  "label": "Power",
                  "color": "#048AD3",
                  "settings": {},
                  "_hash": 0.530239266852971,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "is_on",
                  "type": "timeseries",
                  "label": "is_on",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.3104755725321964
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.4803910446663644
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.3590134894785407
                },
                {
                  "name": "area",
                  "type": "attribute",
                  "label": "area",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.42368228483391346
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "Temperature Outside",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.13488693727596213,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "hddHeatingLimit",
                  "type": "attribute",
                  "label": "hddHeatingLimit",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.40976528434675874
                },
                {
                  "name": "hddIndoorTemp",
                  "type": "attribute",
                  "label": "hddIndoorTemp",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.34281741299592017
                },
                {
                  "name": "hddReference",
                  "type": "attribute",
                  "label": "hddReference",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.18960013931233255
                },
                {
                  "name": "energyPrice",
                  "type": "attribute",
                  "label": "energyPrice",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.8682012676502189
                },
                {
                  "name": "demandCharge",
                  "type": "attribute",
                  "label": "demandCharge",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.9213518192172886
                }
              ]
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "interval": 60000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 100000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "showDurationCurve": true,
            "showLoadProfile": true,
            "dataType": "power",
            "energyToPower": null,
            "showDataZoomSlider": false,
            "enableMouseZoom": null,
            "secondaryDataKey": "outsideTemp",
            "secondaryColor": "#FF9800",
            "secondaryLineWidth": 2,
            "secondaryLineStyle": "solid",
            "showLegend": true,
            "legendStyle": "card",
            "legendPosition": "top",
            "legendAlign": "center",
            "legendCardColorMode": "auto",
            "legendCardColor": "#2196F3",
            "legendValues": [
              "current",
              "min",
              "max",
              "mean",
              "median",
              "baseload",
              "peak",
              "volllaststunden",
              "auslastung",
              "peakEnergy",
              "totalEnergy"
            ],
            "secondaryLegendValues": [
              "current",
              "min",
              "max",
              "mean"
            ],
            "showTimestamp": false,
            "timestampFormat": "YYYY-MM-DD HH:mm:ss",
            "showTooltip": true,
            "yAxisLabel": null,
            "yAxisMin": null,
            "yAxisMax": null,
            "removeOutliers": true,
            "outlierMethod": "zscore",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 10,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "smoothingEnabled": true,
            "smoothingWindow": 5,
            "filterDurationCurveByIsOn": true,
            "isOnDataKey": "is_on",
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorDefaultMode": "custom",
            "twSelectorColor": "#435B63",
            "twSelectorPosition": "center",
            "twSelectorDayFormat": "D MMM YYYY",
            "twSelectorWeekFormat": "D-D MMM",
            "twSelectorMonthFormat": "MMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twAggregationType": "NONE",
            "twMaxDataPoints": 100000,
            "showMeanLine": true,
            "meanMethod": "mean_operating",
            "meanLineColor": "#FF9800",
            "showMedianLine": true,
            "medianMethod": "median_operating",
            "medianPercentile": 50,
            "medianLineColor": "#9C27B0",
            "showBaseloadLine": true,
            "baseloadMethod": "percentile",
            "baseloadPercentile": 10,
            "baseloadLineColor": "#4CAF50",
            "showPeakloadLine": true,
            "peakloadMethod": "percentile",
            "peakloadPercentile": 95,
            "peakloadSigma": 2,
            "peakloadLineColor": "#F44336",
            "enablePeakShaving": true,
            "demandChargeKW": "${demandCharge}",
            "energyPriceKWh": "${energyPrice}",
            "includeEnergyPrice": false,
            "peakShavingColor": "#ff4d4d",
            "peakShavingOpacity": 0.3,
            "showPeakShavingText": true,
            "hddTrimPartialDays": true,
            "heatingThreshold": "${hddHeatingLimit}",
            "indoorTemp": "${hddIndoorTemp}",
            "referenceGTZ": "${hddReference}",
            "buildingArea": "${area}"
          },
          "title": "Duration Curve",
          "dropShadow": false,
          "enableFullscreen": true,
          "enableDataExport": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "949f1723-a3d4-d935-8ddc-c42b3e461815"
      }
    },
    "states": {
      "default": {
        "name": "{i18n:custom.diagnostics.projects.title}",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "678a80b3-1380-cdd2-495f-1701acde66c1": {
                "sizeX": 48,
                "sizeY": 24,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 48,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": false,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Measurements_card": {
        "name": "Measurements_card",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6e0676c2-49cd-846e-9c94-80c6b2c0218c": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": false,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_alarms": {
        "name": "measurement_alarms",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4c8da7a1-659f-e2e5-220c-4128a217e872": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": false,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Measurement_state_filter": {
        "name": "Measurement_state_filter",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "projects_map": {
        "name": "projects_map",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "fb583db5-3fc6-275a-34f4-120bfe140af2": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "projects_alarms": {
        "name": "projects_alarms",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "58b917d2-5768-b5f9-1e78-e45c9491f4f5": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "all_projects": {
        "name": "all_projects",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2ffda43e-cad2-521c-6871-338d15b3b4cc": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "project_card_header": {
        "name": "project_card_header",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b84de4e1-8a84-b5cc-6b10-19292fefbb45": {
                "sizeX": 24,
                "sizeY": 5,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "home_dashboard_widgets": {
        "name": "home_dashboard_widgets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "dc35f902-3824-8f1b-a870-fee55664d0bd": {
                "sizeX": 12,
                "sizeY": 11,
                "row": 0,
                "col": 0
              },
              "b2beb7ce-103a-560f-cf9c-b7df21827bf0": {
                "sizeX": 12,
                "sizeY": 11,
                "row": 0,
                "col": 12
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "selected_project_map": {
        "name": "selected_project_map",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0ff674a9-4e70-3742-720a-e681566c9b4f": {
                "sizeX": 7,
                "sizeY": 9,
                "row": 14,
                "col": 0,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "f2279347-4693-4b0a-17c2-15d2887559fa": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard": {
        "name": "measurement_dashboard",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                "sizeX": 80,
                "sizeY": 70,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": false,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            },
            "breakpoints": {
              "md": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              },
              "sm": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              },
              "xs": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              }
            }
          }
        }
      },
      "measurement_lorawan_room": {
        "name": "measurement_lorawan_room",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "e354c44b-c1c8-fb3d-5b59-a5289253db07": {
                "sizeX": 80,
                "sizeY": 46,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard_raw": {
        "name": "measurement_dashboard_raw",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "1ee843bb-c0dd-4547-e431-e8c7136e25b8": {
                "sizeX": 80,
                "sizeY": 46,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard_load": {
        "name": "measurement_dashboard_load",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "949f1723-a3d4-d935-8ddc-c42b3e461815": {
                "sizeX": 80,
                "sizeY": 42,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard_heatmap": {
        "name": "measurement_dashboard_heatmap",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "a21078eb-a587-780d-7dfe-2698ff6a84bf": {
                "sizeX": 80,
                "sizeY": 40,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard_flow": {
        "name": "measurement_dashboard_flow",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "75113984-0850-03fe-9a34-27f9ea92a37b": {
                "sizeX": 82,
                "sizeY": 43,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard_heatcurve": {
        "name": "measurement_dashboard_heatcurve",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4ff09ee3-18bc-09c0-cd0a-ff09c8c40c5f": {
                "sizeX": 80,
                "sizeY": 43,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard_hdd": {
        "name": "measurement_dashboard_hdd",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4921e6d8-0905-4e69-1181-75765fbc57c8": {
                "sizeX": 80,
                "sizeY": 44,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_dashboard_valve": {
        "name": "measurement_dashboard_valve",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "87816380-086a-5eb9-bff2-e1763bb7a8bd": {
                "sizeX": 80,
                "sizeY": 41,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_dashboard_deltat": {
        "name": "measurement_dashboard_deltat",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "c2394469-7696-cec4-8033-fc9fa9c8c79f": {
                "sizeX": 80,
                "sizeY": 41,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      }
    },
    "entityAliases": {
      "783dd5f0-d34d-946d-a82f-95d3a6eaadd1": {
        "id": "783dd5f0-d34d-946d-a82f-95d3a6eaadd1",
        "alias": "Doktorkits",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetNameFilter": "",
          "assetTypes": [
            "Doktorkit"
          ]
        }
      },
      "1d799daf-1882-7a76-938b-c97e8c08ff11": {
        "id": "1d799daf-1882-7a76-938b-c97e8c08ff11",
        "alias": "Selected Doktorkit",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null
        }
      },
      "129977b6-de2f-546b-7df8-2040f39f8732": {
        "id": "129977b6-de2f-546b-7df8-2040f39f8732",
        "alias": "Doktorkit Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Chiller",
            "Freezer",
            "Smart Shelf",
            "Smart Bin",
            "Door Sensor",
            "Liquid Level Sensor",
            "Occupancy Sensor",
            "Smoke Sensor",
            "Motion Sensor",
            "P-Flow D116",
            "Room Sensor CO2",
            "Room",
            "Room Sensor T"
          ]
        }
      },
      "7b659beb-1601-5b67-528e-0846d1a0efa6": {
        "id": "7b659beb-1601-5b67-528e-0846d1a0efa6",
        "alias": "Current user",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "b755362a-b545-8ee6-a67b-df2c9e39d6e5": {
        "id": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
        "alias": "Selected device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null
        }
      },
      "cdf692dd-915b-cdc8-7b51-fc8980c44135": {
        "id": "cdf692dd-915b-cdc8-7b51-fc8980c44135",
        "alias": "Door Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Door Sensor"
          ]
        }
      },
      "15130463-060f-d497-b4ee-39cfc42d3096": {
        "id": "15130463-060f-d497-b4ee-39cfc42d3096",
        "alias": "Occupancy Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Occupancy Sensor"
          ]
        }
      },
      "88fa493d-e8a6-93b9-1d99-ee3d9cbe8487": {
        "id": "88fa493d-e8a6-93b9-1d99-ee3d9cbe8487",
        "alias": "Smoke Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Smoke Sensor"
          ]
        }
      },
      "6073fc37-70ca-4537-f15a-c7dbdd56b343": {
        "id": "6073fc37-70ca-4537-f15a-c7dbdd56b343",
        "alias": "Motion Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Motion Sensor"
          ]
        }
      },
      "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82": {
        "id": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
        "alias": "Current owner",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "b41759e3-cb61-1aaf-8b24-856e5f5a3889": {
        "id": "b41759e3-cb61-1aaf-8b24-856e5f5a3889",
        "alias": "P-Flow D116",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "P-Flow D116"
          ]
        }
      },
      "a1259275-97cf-904a-15a9-9e107522eb5f": {
        "id": "a1259275-97cf-904a-15a9-9e107522eb5f",
        "alias": "Room Sensors T",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor T"
          ]
        }
      },
      "5d6907db-bad0-623f-389a-47e7ee2981b0": {
        "id": "5d6907db-bad0-623f-389a-47e7ee2981b0",
        "alias": "Room Sensors CO2",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor CO2"
          ]
        }
      },
      "d63f1302-8c37-ca6d-76ff-033d16969b1a": {
        "id": "d63f1302-8c37-ca6d-76ff-033d16969b1a",
        "alias": "SelectedEntity",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "SelectedEntity",
          "defaultStateEntity": {
            "entityType": "ASSET",
            "id": "feca5d50-6906-11ef-9bb9-b94f875dce3b"
          }
        }
      },
      "432d69f7-88cf-15c4-69ef-6ea4f27aac50": {
        "id": "432d69f7-88cf-15c4-69ef-6ea4f27aac50",
        "alias": "Selected Doktorkit1",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": false,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "TO",
          "maxLevel": 1,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "assetTypes": [
            "Doktorkit"
          ]
        }
      },
      "d873a1ea-6540-b9dc-b254-70b2900a45d9": {
        "id": "d873a1ea-6540-b9dc-b254-70b2900a45d9",
        "alias": "Single Device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": null,
          "defaultStateEntity": null
        }
      },
      "ae29d67c-e1c3-0479-1e39-9207f44f9990": {
        "id": "ae29d67c-e1c3-0479-1e39-9207f44f9990",
        "alias": "All P-Flows",
        "filter": {
          "type": "deviceType",
          "resolveMultiple": true,
          "deviceTypes": [
            "P-Flow D116"
          ],
          "deviceNameFilter": ""
        }
      },
      "a5025959-4eb0-bbfb-1bef-115e0c344ebf": {
        "id": "a5025959-4eb0-bbfb-1bef-115e0c344ebf",
        "alias": "Measurement",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Measurement"
          ],
          "assetNameFilter": ""
        }
      },
      "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9": {
        "id": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
        "alias": "Selected Measurement",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null
        }
      },
      "cd72a6f3-8ac8-11ef-aa7b-13581cf4c95d": {
        "id": "cd72a6f3-8ac8-11ef-aa7b-13581cf4c95d",
        "alias": "All Entities: Measurement",
        "filter": {
          "resolveMultiple": true,
          "type": "assetType",
          "assetNameFilter": "",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "e84cedc2-95ee-c038-4d48-ef91acc6a4cc": {
        "id": "e84cedc2-95ee-c038-4d48-ef91acc6a4cc",
        "alias": "Temperature Sensor",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Temperature Sensor"
          ]
        }
      },
      "f3843d4e-b8c6-a299-fb02-e522271f7c35": {
        "id": "f3843d4e-b8c6-a299-fb02-e522271f7c35",
        "alias": "sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor CO2",
            "Room Sensor T"
          ]
        }
      },
      "70ff25cd-3d47-b7fc-05e1-765294946bf0": {
        "id": "70ff25cd-3d47-b7fc-05e1-765294946bf0",
        "alias": "Measurement Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement",
          "deviceTypes": [
            "Room Sensor CO2",
            "Room Sensor T"
          ]
        }
      },
      "2ad8a8aa-5f43-9902-6258-79e6421b1fb2": {
        "id": "2ad8a8aa-5f43-9902-6258-79e6421b1fb2",
        "alias": "Projects",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Project"
          ]
        }
      },
      "b0061bd7-595f-a375-e74c-115b41049852": {
        "id": "b0061bd7-595f-a375-e74c-115b41049852",
        "alias": "Measurements",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "3e0192c2-97b8-b3a1-2a43-399659e8d7e1": {
        "id": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
        "alias": "All Projects",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Project"
          ],
          "assetNameFilter": ""
        }
      },
      "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce": {
        "id": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
        "alias": "Selected Project",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null
        }
      },
      "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6": {
        "id": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
        "alias": "Project",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Project"
          ],
          "assetNameFilter": ""
        }
      },
      "906dd8e6-abf4-bc27-7499-1318cb35ac80": {
        "id": "906dd8e6-abf4-bc27-7499-1318cb35ac80",
        "alias": "Measurement Devices1",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement",
          "deviceTypes": [
            "P-Flow D116",
            "Temperature Sensor",
            "Room Sensor T",
            "Room Sensor CO2",
            "RESI",
            "LTE Status",
            "LoRaWAN Gateway"
          ]
        }
      },
      "0995cad1-8408-0071-28a7-c305d95429e2": {
        "id": "0995cad1-8408-0071-28a7-c305d95429e2",
        "alias": "Project Measurements",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null,
          "rootEntity": {
            "entityType": "CURRENT_CUSTOMER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "0aeb5a06-c961-6c9b-d253-199be04f61c5": {
        "id": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
        "alias": "VR Pflow",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "P-Flow D116 VR"
          ]
        }
      },
      "e043f69e-804d-8e1d-062c-7da5becf5b51": {
        "id": "e043f69e-804d-8e1d-062c-7da5becf5b51",
        "alias": "Room Sensor CO2 VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Room Sensor CO2 VR"
          ]
        }
      },
      "430f6413-271a-248e-ea6f-7bfd6fd1f9f6": {
        "id": "430f6413-271a-248e-ea6f-7bfd6fd1f9f6",
        "alias": "Gateway VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Gateway VR"
          ]
        }
      },
      "e23ea274-9aa0-8938-2b73-ff48762a93fc": {
        "id": "e23ea274-9aa0-8938-2b73-ff48762a93fc",
        "alias": "Temperature Sensors VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Temperature Sensor VR"
          ]
        }
      },
      "8520bbb4-c9f0-7635-5364-ec3b685f1ff7": {
        "id": "8520bbb4-c9f0-7635-5364-ec3b685f1ff7",
        "alias": "Project related to Measurement",
        "filter": {
          "type": "relationsQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "TO",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "filters": [
            {
              "relationType": "Owns",
              "entityTypes": [
                "ASSET"
              ],
              "negate": false
            }
          ]
        }
      },
      "a9fa6f19-ba67-3088-3fe0-6677fed234ea": {
        "id": "a9fa6f19-ba67-3088-3fe0-6677fed234ea",
        "alias": "measurement_pke",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "ASSET",
            "id": "05de41e0-f841-11f0-9979-9f3434877bb4"
          }
        }
      },
      "83d0c937-d77a-71a9-5ffc-fdc6b350e7f4": {
        "id": "83d0c937-d77a-71a9-5ffc-fdc6b350e7f4",
        "alias": "measurement_pke6",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "ASSET",
            "id": "b77cad70-fc50-11f0-9fc4-33b9bcf3ddd0"
          }
        }
      },
      "1454385a-1706-88a6-0c42-2cf0c163f5df": {
        "id": "1454385a-1706-88a6-0c42-2cf0c163f5df",
        "alias": "project_pke",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "ASSET",
            "id": "ea97da10-faaa-11f0-9979-9f3434877bb4"
          }
        }
      }
    },
    "filters": {
      "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8": {
        "id": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
        "filter": "Device filter",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smart Shelf",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displaySmartShelf",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Freezer",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFreezer",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Chiller",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayChiller",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smart Bin",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayWasteBin",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Door Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayDoorSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Liquid Level Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayLiquidLevelSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Motion Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMotionSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Occupancy Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayOccupancySensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smoke Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displaySmokeSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "P-Flow D116",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPFlowD116",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Room Sensor T",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayRoomSensorT",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Room Sensor CO2",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayRoomSensorCO2",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Temperature Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayTemperatureSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          },
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "state"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "critical",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayCritical",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "major",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMajor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "normal",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayNormal",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          },
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "active"
            },
            "valueType": "BOOLEAN",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": true,
                          "dynamicValue": null
                        },
                        "type": "BOOLEAN"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": false,
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayDisconnected",
                            "inherit": false
                          }
                        },
                        "type": "BOOLEAN"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "35492bf9-fb1b-d326-8b75-f0c24db7a976": {
        "id": "35492bf9-fb1b-d326-8b75-f0c24db7a976",
        "filter": "State filter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "state"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "normal",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayNormalDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "critical",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayCriticalDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "major",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMajorDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "minor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMinorDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "2d011a64-3af4-277a-980d-904145c28912": {
        "id": "2d011a64-3af4-277a-980d-904145c28912",
        "filter": "Progress filter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "progress"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preparation",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPreparationMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "active",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayActiveMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "finished",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFinishedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "aborted",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayAbortedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preperation",
                          "dynamicValue": null
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "dfd37bd2-bb12-d529-9ea0-999958063eb5": {
        "id": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
        "filter": "Progress filter projects",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "progress"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preparation",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPreparationMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "active",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayActiveMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "finished",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFinishedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preperation",
                          "dynamicValue": null
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "409ee35d-10ed-b257-7161-3ee1d74855a5": {
        "id": "409ee35d-10ed-b257-7161-3ee1d74855a5",
        "filter": "CO2",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Room Sensor CO2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "1c512dc2-e762-a4d6-a30a-dc26cd05d381": {
        "id": "1c512dc2-e762-a4d6-a30a-dc26cd05d381",
        "filter": "Temp",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Room Sensor T",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09": {
        "id": "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09",
        "filter": "Project",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Project",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "f5356b4d-71ea-0593-9374-5e08d022fa44": {
        "id": "f5356b4d-71ea-0593-9374-5e08d022fa44",
        "filter": "Is on",
        "keyFilters": [
          {
            "key": {
              "type": "TIME_SERIES",
              "key": "is_on"
            },
            "valueType": "BOOLEAN",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": true,
                    "dynamicValue": null
                  },
                  "type": "BOOLEAN"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0,
                  "unit": ""
                }
              }
            ]
          }
        ],
        "editable": true
      }
    },
    "timewindow": {
      "hideAggregation": true,
      "hideAggInterval": true,
      "hideTimezone": false,
      "selectedTab": 1,
      "history": {
        "historyType": 1,
        "fixedTimewindow": {
          "startTimeMs": 1769506475279,
          "endTimeMs": 1770900698337
        },
        "interval": 3824000,
        "hideInterval": false,
        "hideLastInterval": false,
        "hideQuickInterval": false
      },
      "aggregation": {
        "type": "NONE",
        "limit": 100000
      },
      "timezone": null
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": true,
      "showEntitiesSelect": false,
      "showDashboardTimewindow": true,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true,
      "titleColor": "rgba(0,0,0,0.870588)",
      "showDashboardLogo": false,
      "dashboardLogoUrl": null,
      "hideToolbar": false,
      "showFilters": true,
      "showUpdateDashboardImage": false,
      "dashboardCss": ".tb-widget-container > .tb-widget {\n    border-radius: 8px;\n}\n\n.tb-widget-container {\n    border-radius: 8px;\n}\n\n\ngridster-item:not(.tb-noselect) > .tb-widget-container > .tb-widget {\n    cursor: default !important;\n}\n\n.tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-row {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-legend-keys {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-markdown-view .tb-progress-cover, .tb-widget-container > .tb-widget .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-widget-container > .tb-widget .tb-markdown-view div, .tb-widget-container > .tb-widget .tb-markdown-view p {\n    line-height: normal;\n}\n\n"
    }
  },
  "name": "Measurements",
  "resources": null,
  "id": {
    "entityType": "DASHBOARD",
    "id": "d086f510-f6be-11f0-adb4-33b9bcf3ddd0"
  },
  "createdTime": 1768995985121,
  "tenantId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  },
  "customerId": null,
  "assignedCustomers": null,
  "externalId": {
    "entityType": "DASHBOARD",
    "id": "d086f510-f6be-11f0-adb4-33b9bcf3ddd0"
  },
  "version": 469,
  "ownerId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  }
}