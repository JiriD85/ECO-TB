{
  "title": "Measurements",
  "image": "tb-image;/api/images/tenant/belimo_retrofit_plus_padding.png",
  "mobileHide": false,
  "mobileOrder": 1,
  "configuration": {
    "description": "",
    "widgets": {
      "225675bf-745f-b2bc-b83c-52d751910205": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.031424315886006804
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.323899218375304
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\n\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\n\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\n\nreturn '<div style=\"width: 100%; height: 100%; padding: 0;\" fxLayoutGap=\"16px\" fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutAlign.gt-md=\"center center\">'+\n       '<div id=\"critical-alarms\" class=\"alarm-badge '+ criticalClass +'\"><i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ criticalCount +'</span> Critical</div>' +\n       '<div id=\"major-alarms\" class=\"alarm-badge '+ majorClass +'\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ majorCount +'</span> Major</div>' +\n       '<div>';",
            "useMarkdownTextFunction": true,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "critical-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "market_critical_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2255454c-8c83-dfae-2e0b-8d0df6db6a70"
              },
              {
                "name": "major-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "market_major_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "e52ae76c-959f-f84e-c6b7-3e49c242e70e"
              }
            ]
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "225675bf-745f-b2bc-b83c-52d751910205",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "4c8da7a1-659f-e2e5-220c-4128a217e872": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 604800000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1737884022023,
                "endTimeMs": 1737970422023
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-startTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "New Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "40px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
            "filterId": null,
            "dataKeys": [
              {
                "name": "startTime",
                "type": "alarm",
                "label": "Start time",
                "color": "#607d8b",
                "settings": {
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible"
                },
                "_hash": 0.9100433241266481
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "notifications",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": false,
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}\n",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": false
          },
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "4c8da7a1-659f-e2e5-220c-4128a217e872",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "8805b23e-efea-86a7-d754-9fdfe37acbaa": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.031424315886006804
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.323899218375304
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\n\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\n\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\n\nreturn '<div style=\"width: 100%; height: 100%; padding: 0;\" fxLayoutGap=\"16px\" fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutAlign.gt-md=\"center center\">'+\n       '<div id=\"critical-alarms\" class=\"alarm-badge '+ criticalClass +'\"><i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ criticalCount +'</span> Critical</div>' +\n       '<div id=\"major-alarms\" class=\"alarm-badge '+ majorClass +'\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ majorCount +'</span> Major</div>' +\n       '<div>';",
            "useMarkdownTextFunction": true,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "critical-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "all_critical_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2255454c-8c83-dfae-2e0b-8d0df6db6a70"
              },
              {
                "name": "major-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "all_major_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "e52ae76c-959f-f84e-c6b7-3e49c242e70e"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "8805b23e-efea-86a7-d754-9fdfe37acbaa",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "displayPreparationMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.preparation.title}",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'in preparation';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'in preparation' : 'unset';"
                  },
                  "_hash": 0.4010207052742043,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayActiveMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.active.title}",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": true,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'active';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'active' : 'unset';"
                  },
                  "_hash": 0.717435526543984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayFinishedMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.finished.title}",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'finished';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'finished' : 'unset';"
                  },
                  "_hash": 0.9122349770594107,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayAbortedMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.aborted.title}",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'aborted';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'aborted' : 'unset';"
                  },
                  "_hash": 0.7567501123338984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": false,
            "showActionButtons": false,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 3,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "State Filter",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {
            "fontWeight": "bold",
            "fontSize": "14px"
          },
          "titleStyle": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "paddingBottom": "30px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "noDataDisplayMessage": "",
          "widgetCss": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "6e0676c2-49cd-846e-9c94-80c6b2c0218c": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.measurements.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": true,
            "entityNameColumnTitle": "{i18n:custom.diagnostics.measurement-name.title}",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.diagnostics.measurements.title}",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "0995cad1-8408-0071-28a7-c305d95429e2",
              "filterId": "2d011a64-3af4-277a-980d-904145c28912",
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-address.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.5439377495268714,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8686344328279582
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:entity-field.state}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "20%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var state = value;\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        default:\n            return state;\n    }\n}\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-progress.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getProgressHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.6466565617082951,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-type.title}",
                  "color": "#607d8b",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getMeasurementTypeHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.011120189088471788,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [
              {
                "name": "Selected Measurement",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nlet measurementType = \"\";\nvar stateId;\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType', 'measurementType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        if (attributes.find(attr => attr.key === 'measurementType')) {\n            measurementType = attributes.find(attr => attr.key === 'measurementType').value;\n        }\n            \n        if (measurementType === 'loraWan') {\n            stateId = 'measurement_details';\n        } else if (measurementType === 'ultrasonic') {\n            stateId = getMeasurementState(type);\n        } else {\n            stateId = getMeasurementState(type);\n        }\n        //console.log(stateId);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}\n\n\n\n/*let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "27b78a0c-3e2d-8d90-72dd-10f9f80351b5"
              }
            ],
            "actionCellButton": [
              {
                "id": "measurement-info-action",
                "name": "Live Data",
                "icon": "sensors",
                "type": "custom",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "customFunction": {
                  "body": "const measurementId = entityId;\nprojectWizard.openMeasurementInfoDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false
              },
              {
                "name": "Connect Measurement",
                "icon": "add_chart",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var progress = data.Progress || data.progress;\nvar isUltrasonic = data['Measurement Type'] === 'ultrasonic';\nreturn isUltrasonic && (progress === 'in preparation' || progress === 'planned');",
                "type": "custom",
                "customFunction": {
                  "body": "utils.dataConnectorDialog(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c020f915-da89-ba7e-5aaa-49066cf1451c"
              },
              {
                "name": "{i18n:custom.diagnostics.action.measurement-parameters}",
                "icon": "settings",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var userRole = widgetContext.stateController.getStateParams().userRole;\r\n/*console.log(widgetContext.stateController.getStateParams());\r\nconsole.log(\"user role:\", userRole);*/\r\n        \r\nif (userRole !== 'Belimo Retrofit Users') {\r\n    return true;\r\n} else {\r\n    return false;\r\n}\r\n    \r\n    /*return (userRoleValue !== 'Belimo Retrofit Users');*/\r\n    \r\n\r\n   \r\n\r\n \r\n",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error(\"No measurement selected\");\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e9d60eaa-56f8-bbfb-45db-110033a2739a"
              },
              {
                "name": "{i18n:custom.diagnostics.action.measurement-dashboard.title}",
                "icon": "dashboard",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nlet measurementType = \"\";\nvar stateId;\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType', 'measurementType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        measurementType = attributes.find(attr => attr\n            .key === 'measurementType').value;\n            \n        if (measurementType === 'loraWan') {\n            stateId = 'measurement_details';\n        } else if (measurementType === 'ultrasonic') {\n            stateId = getMeasurementState(type);\n        } else {\n            stateId = getMeasurementState(type);\n        }\n\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6f852a67-6999-f59d-5795-e81b18274a55"
              },
              {
                "id": "delete-measurement-1769460037673",
                "name": "Delete Measurement",
                "icon": "delete",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = entityId;\nconst measurementName = entityName || entityLabel || 'this measurement';\n\nif (!measurementId || !measurementId.id) {\n    console.error(\"No measurement selected\");\n    return;\n}\n\nprojectWizard.deleteMeasurement(widgetContext, measurementId, measurementName);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                }
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.diagnostics.action.go-back.title}",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "arrow_back",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\n/*var number = (widgetContext.stateController.getStateIndex())-1;*/\r\n\r\nparams['selectedProject'] = null;\r\nparams['targetStateParameter'] = null;\r\n\r\nparams = {\r\n    \"userRole\": params.userRole\r\n};\r\n\r\nwidgetContext.stateController.updateState(null,params);\r\n/*widgetContext.stateController.navigatePrevState(number);*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3ef7bac7-ead3-49d4-a2aa-1b80aae1b476"
              },
              {
                "name": "Measurement",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "const stateParams = widgetContext.stateController.getStateParams();\nconst selectedProject = stateParams.selectedProject;\n\nif (!selectedProject || !selectedProject.entityId || !selectedProject.entityId.id) {\n    console.error('No project selected. Please select a project first.');\n    return;\n}\n\nconst projectId = { id: selectedProject.entityId.id, entityType: 'ASSET' };\nconst projectName = selectedProject.entityName;\n\n// Determine customerId\nconst NULL_UUID = '13814000-1dd2-11b2-8080-808080808080';\nfunction isValidCustomerId(id) {\n    return id && id !== NULL_UUID;\n}\n\nconst userRole = stateParams.userRole;\nconst stateEntityId = stateParams.entityId;\nlet customerId;\n\nif ((widgetContext.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator') && stateEntityId && stateEntityId.id && isValidCustomerId(stateEntityId.id)) {\n    customerId = stateEntityId;\n    openDialog();\n} else if (isValidCustomerId(widgetContext.currentUser.customerId)) {\n    customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER' };\n    openDialog();\n} else {\n    // Fetch customerId from project asset\n    const $injector = widgetContext.$scope.$injector;\n    const assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n    assetService.getAsset(projectId.id).subscribe(projectAsset => {\n        if (projectAsset && projectAsset.customerId && isValidCustomerId(projectAsset.customerId.id)) {\n            customerId = projectAsset.customerId;\n            openDialog();\n        } else {\n            console.error('Cannot determine customerId. Project has no valid customer assigned.');\n        }\n    });\n}\n\nfunction openDialog() {\n    projectWizard.openAddMeasurementDialog(widgetContext, projectId, projectName, customerId, function(result) {\n        // Update state params with new measurement\n        const params = widgetContext.stateController.getStateParams();\n        params['selectedMeasurement'] = {\n            entityId: result.id,\n            entityName: result.name,\n            entityLabel: result.label || ''\n        };\n        widgetContext.updateAliases();\n        \n        // If connectKit checkbox was checked and it's ultrasonic, open connect dialog\n        if (result.connectKit && result.measurementType === 'ultrasonic') {\n            dataImporter.dataConnectorDialog(widgetContext, result.id, result.name);\n        }\n    });\n}",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                    "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6f6daae0-99ef-3112-baf1-9e8e6cc178b2"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "6e0676c2-49cd-846e-9c94-80c6b2c0218c",
        "typeFullFqn": "system.cards.entities_table"
      },
      "e6cefd55-e905-d7ce-8f86-08635fbe2679": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 15552000000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-startTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "reserveSpaceForHiddenAction": "true",
            "useRowStyleFunction": false,
            "alarmsTitle": "Alarms"
          },
          "title": "Alarms",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "40px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "783dd5f0-d34d-946d-a82f-95d3a6eaadd1",
            "filterId": "2d011a64-3af4-277a-980d-904145c28912",
            "dataKeys": [
              {
                "name": "startTime",
                "type": "alarm",
                "label": "Start time",
                "color": "#9c27b0",
                "settings": {
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible"
                },
                "_hash": 0.18228508234861218
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418
              },
              {
                "name": "progress",
                "type": "attribute",
                "label": "Progress",
                "color": "#9c27b0",
                "settings": {},
                "_hash": 0.48382170691251236,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "notifications",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": true,
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}\n",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": true
          },
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "e6cefd55-e905-d7ce-8f86-08635fbe2679",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "d680c934-edcf-4cf0-7073-cc1fb4530391": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 1,
            "history": {
              "historyType": 0,
              "timewindowMs": 2592000000,
              "interval": 1000,
              "fixedTimewindow": {
                "startTimeMs": 1640171736303,
                "endTimeMs": 1640258136303
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "reserveSpaceForHiddenAction": "true",
            "useRowStyleFunction": false,
            "alarmsTitle": "Critical Alarms"
          },
          "title": "New Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
            "filterId": null,
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "{i18n:alarm.created-time}",
                "color": "#2196f3",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.021092237451093787,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.status}",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "more_horiz",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": true,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "CRITICAL"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true
          }
        },
        "row": 0,
        "col": 0,
        "id": "d680c934-edcf-4cf0-7073-cc1fb4530391",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "106a5add-e710-6fea-e975-a7f9b61e2802": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 1,
            "history": {
              "historyType": 0,
              "timewindowMs": 2592000000,
              "interval": 1000,
              "fixedTimewindow": {
                "startTimeMs": 1640171736303,
                "endTimeMs": 1640258136303
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "reserveSpaceForHiddenAction": "true",
            "useRowStyleFunction": false,
            "alarmsTitle": "Major Alarms"
          },
          "title": "New Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
            "filterId": null,
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "Created time",
                "color": "#2196f3",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.021092237451093787
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418
              }
            ]
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "more_horiz",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": true,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "MAJOR"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true
          },
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "106a5add-e710-6fea-e975-a7f9b61e2802",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "f0dfbf6c-c2b0-2975-eb81-df9748cae9a5": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.017780279769597174,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.22474637380276485
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.709327809947802
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.2676021249658249
                },
                {
                  "name": "installationTypeOptions",
                  "type": "attribute",
                  "label": "installationTypeOptions",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.35597892581066426
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8462392482745986
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.312769116057807
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.5314446691155006
                },
                {
                  "name": "dimension",
                  "type": "attribute",
                  "label": "dimension",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.8453803324883225
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.10102575048646112
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.7997860161209402
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "0995cad1-8408-0071-28a7-c305d95429e2",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.8016917353994459
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.5728925212540854,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "transparent",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": {
              "body": "let $injector = ctx.$scope.$injector;\nlet assetService = $injector.get(ctx.servicesMap.get('assetService'));\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nvar entityId;\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n    entityId = data[0]['entityId'];\n} else {\n    deviceState = false;\n    entityId = null;\n}\nlet userRole;\nif(data[1] && data[1].role){\n    userRole = data[1].role;\n}\n\nvar stateParams = ctx.stateController.getStateParams();\nctx.stateController.updateState(null, stateParams);\nif(entityId) {\n\n    var ButtonHtml = '';\n    if (userRole !== 'Belimo Retrofit Users') {\n        ButtonHtml =\n            '<button id=\"parameter-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.action.measurement-parameters}</span>' +\n            '</button>' +\n            '<button id=\"projects-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n            '</button>';\n    }\n\n    var name, label, state, active, progress, locationName, installationType, installation, dimension, installationTypeOptions, measurementType, startTime, endTime;\n    if (data && data.length) {\n        name = data[0]['entityName'] || 'N/A';\n        label = data[0]['Label'] || 'N/A';\n        locationName = data[0]['locationName'] || 'N/A';\n        installationType = data[0]['installationType'] || 'N/A';\n        installationTypeOptions = data[0]['installationTypeOptions'] || 'N/A';\n        dimension = data[0]['dimension'] || 'N/A';\n        state = data[0]['state'] || 'N/A';\n        active = data[0]['active'] || 'N/A';\n        progress = data[0]['progress'] || 'N/A';\n        measurementType = data[0]['measurementType'] || 'N/A';\n        startTime = data[0]['startTimeMs'] || 'N/A';\n        endTime = data[0]['endTimeMs'] || 'N/A';\n        if (active === 'false') {\n            state = 'disconnected';\n        }\n    }\n\n    // finished & aborted\n    if (startTime !== 'N/A' && endTime !== 'N/A') {\n        deltaTime = endTime - startTime;\n        timeThreshold = 3024000000; // 35 days\n        if (deltaTime <= timeThreshold) {\n            var newDashboardtimewindow = {\n                aggregation: { limit: 100000, type: \"NONE\" },\n                hideAggInterval: true,\n                hideAggregation: true,\n                hideInterval: false,\n                history: {\n                    historyType: 1,\n                    fixedTimewindow: { startTimeMs: startTime, endTimeMs: endTime }\n                },\n                selectedTab: 1\n            };\n        } else {\n            var newDashboardtimewindow = {\n                aggregation: { limit: 100000, type: \"NONE\" },\n                hideAggInterval: true,\n                hideAggregation: true,\n                hideInterval: false,\n                history: {\n                    historyType: 1,\n                    fixedTimewindow: { startTimeMs: endTime - timeThreshold, endTimeMs: endTime }\n                },\n                selectedTab: 1\n            };\n        }\n    }\n    // active\n    else if (startTime !== 'N/A' && endTime === 'N/A') {\n        timeThreshold = 3024000000;\n        deltaTime = (Date.now())-startTime;\n        if(deltaTime>timeThreshold){\n            startTime = startTime+(deltaTime-timeThreshold);\n        }\n        var newDashboardtimewindow = {\n            aggregation: { limit: 100000, type: \"NONE\" },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: { startTimeMs: startTime, endTimeMs: Date.now() }\n            },\n            selectedTab: 1\n        };\n    }\n    // default\n    else {\n        var newDashboardtimewindow = {\n            aggregation: { limit: 100000, type: \"NONE\" },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: { startTimeMs: Date.now() - 1209600000, endTimeMs: Date.now() }\n            },\n            selectedTab: 1\n        };\n    }\n\n    ctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\n    ctx.stateController.updateState(null, stateParams);\n\n    function getStateBadge(stateValue, type) {\n        var badgeClass = '';\n        var icon = '';\n        var label = '';\n        switch (stateValue) {\n            case 'in preparation':\n                badgeClass = 'badge-preparation'; icon = 'schedule';\n                label = '{i18n:custom.diagnostics.state-filter.preparation.title}'; break;\n            case 'active':\n                badgeClass = 'badge-active'; icon = 'play_circle';\n                label = '{i18n:custom.diagnostics.state-filter.active.title}'; break;\n            case 'finished':\n                badgeClass = 'badge-finished'; icon = 'check_circle';\n                label = '{i18n:custom.diagnostics.state-filter.finished.title}'; break;\n            case 'aborted':\n                badgeClass = 'badge-aborted'; icon = 'cancel';\n                label = '{i18n:custom.diagnostics.state-filter.aborted.title}'; break;\n            case 'critical':\n                badgeClass = 'badge-critical'; icon = 'error';\n                label = '{i18n:custom.diagnostics.alarm-severity.critical}'; break;\n            case 'major':\n                badgeClass = 'badge-major'; icon = 'warning';\n                label = '{i18n:custom.diagnostics.alarm-severity.major}'; break;\n            case 'minor':\n                badgeClass = 'badge-minor'; icon = 'info';\n                label = '{i18n:custom.diagnostics.alarm-severity.minor}'; break;\n            case 'normal':\n                badgeClass = 'badge-normal'; icon = 'check_circle';\n                label = '{i18n:custom.diagnostics.alarm-severity.normal}'; break;\n            case 'disconnected':\n                badgeClass = 'badge-disconnected'; icon = 'link_off';\n                label = '{i18n:device.inactive}'; break;\n            default:\n                badgeClass = 'badge-default'; icon = 'help';\n                label = stateValue || 'N/A';\n        }\n        return '<span class=\"status-badge ' + badgeClass + '\">' +\n               '<mat-icon class=\"badge-icon\">' + icon + '</mat-icon>' +\n               '<span>' + label + '</span></span>';\n    }\n\n    function formatTimestampDisplay(timestampMs) {\n        if (timestampMs === null || timestampMs === undefined || timestampMs === 'N/A') return null;\n        var value = Number(timestampMs);\n        if (!Number.isFinite(value) || value <= 0) return null;\n        var date = new Date(value);\n        function pad(n) { return n.toString().padStart(2, '0'); }\n        return pad(date.getDate()) + '.' + pad(date.getMonth() + 1) + '.' + date.getFullYear() +\n               ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n    }\n\n    function getDateBadge(timestampMs, type) {\n        var formatted = formatTimestampDisplay(timestampMs);\n        if (!formatted) return '';\n        var icon = type === 'start' ? 'play_circle' : 'stop_circle';\n        var color = type === 'start' ? '#27AE60' : '#2F80ED';\n        var bgColor = type === 'start' ? 'rgba(39, 174, 96, 0.12)' : 'rgba(47, 128, 237, 0.12)';\n        return '<span class=\"status-badge\" style=\"background:' + bgColor + '; color:' + color + ';\">' +\n               '<mat-icon class=\"badge-icon\">' + icon + '</mat-icon>' +\n               '<span>' + formatted + '</span></span>';\n    }\n\n    var installationBadge = '<span class=\"status-badge badge-cooling\">' +\n        '<mat-icon class=\"badge-icon\">ac_unit</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.measurement-type.cooling.title}</span></span>';\n\n    var typeBadge = '<span class=\"status-badge badge-type\">' +\n        `{i18n:custom.diagnostics.action.edit-measurement-parameters.installation-type-options.${clientUtils.toKebabCase(installationTypeOptions)}.title}` +\n        '</span>';\n\n    var displayTitle = (locationName && locationName !== 'N/A') ? locationName : name;\n\n    var header = '<div class=\"measurement-header flex items-center justify-between\">' +\n      '<div class=\"flex items-center gap-3\">' +\n        '<button id=\"go-back\" type=\"button\" mat-raised-button color=\"primary\" class=\"back-button\">' +\n          '<mat-icon>arrow_back</mat-icon><span>{i18n:action.go-back}</span></button>' +\n        '<button id=\"measurement-switch-button\" type=\"button\" mat-raised-button color=\"accent\" class=\"switch-btn\">' +\n          '<mat-icon>swap_horiz</mat-icon>' +\n        '</button>' +\n        '<div class=\"measurement-title-block\">' +\n          '<span class=\"measurement-location-text\">' + ((locationName && locationName !== 'N/A') ? locationName : label) + '</span>' +\n          '<span class=\"measurement-name-text\">' + name + '</span>' +\n        '</div>' +\n      '</div>' +\n      '<div class=\"flex flex-col items-center gap-1 flex-1\">' +\n        '<div class=\"flex items-center gap-2\">' + installationBadge + typeBadge + getStateBadge(state, 'state') + '</div>' +\n        '<div class=\"flex items-center gap-2\">' + getStateBadge(progress, 'progress') + getDateBadge(startTime, 'start') + getDateBadge(endTime, 'end') + '</div>' +\n      '</div>' +\n      '<div class=\"flex items-center gap-2\">' + ButtonHtml +\n        '<button id=\"reports-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon><span>{i18n:custom.diagnostics.reports-btn.title}</span></button>' +\n        '<button id=\"analysis-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">insights</mat-icon><span>{i18n:custom.diagnostics.analysis.title}</span></button>' +\n      '</div>' +\n    '</div>';\n\n    return '<div class=\"main-layout flex flex-col w-full h-full\">' + header +\n        '<div id=\"power_measurement_cooling_wrapper\" class=\"flex-1\">' +\n          '<tb-dashboard-state class=\"w-full h-full\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_data_cooling\"></tb-dashboard-state>' +\n        '</div></div>';\n}\n",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n/*.main-layout .header .title {\n    width: auto;\n    height: 50px;\n    padding-right: 15px; \n    font-size: 18px;\n    font-weight: 500;\n    background-color: #E0E0E0;\n    color: #28232D;\n    display: flex; \n    align-items: center; \n    justify-content: center;\n    gap: 2px;\n    margin-right: 10px;\n    border-radius: 4px;\n}*/\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #reports-button, #data-button, #report-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown option {\n    width: 500px;\n    background-color: #f0f0f0; /* Example background color */\n    color: #28232D;           /* Text color */\n    font-size: 18px;          /* Font size */\n    font-weight: 500;         /* Font weight */\n    /* Some browsers may support these, others might ignore them: */\n    padding: 5px;\n}\n\n\n#measurement-dropdown:focus {\n    outline: none !important;\n    border: none !important;\n    box-shadow: none !important;\n    outline-offset: 0 !important;\n}\n\n#measurement-dropdown::-moz-focus-inner {\n    border: 0 !important;\n}\n\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #reports-button:hover, #data-button:hover, #report-button:hover, #parameter-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #reports-button mat-icon, #data-button mat-icon, #report-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #data-button und #report-button */\n#projects-button span, #reports-button span, #data-button span, #report-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n\n/* Badge Styling */\n.status-badge {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.status-badge .badge-icon {\n    font-size: 14px !important;\n    width: 14px !important;\n    height: 14px !important;\n}\n\n.status-badge.badge-heating {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-cooling {\n    background: rgba(33, 150, 243, 0.1);\n    color: #2196F3;\n}\n\n.status-badge.badge-type {\n    background: #f5f5f5;\n    color: #333;\n}\n\n.status-badge.badge-normal {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-active {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-preparation {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-finished {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-aborted {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-critical {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-major {\n    background: rgba(255, 152, 0, 0.15);\n    color: #FF9800;\n}\n\n.status-badge.badge-minor {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-disconnected {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-default {\n    background: #f5f5f5;\n    color: #666;\n}\n\n/* Back Button */\n.back-button {\n    min-width: unset !important;\n    padding: 8px 16px !important;\n}\n\n.back-button mat-icon {\n    font-size: 18px !important;\n    margin-right: 6px;\n}\n\n\n/* Measurement Title Block - consistent text colors */\n.measurement-title-block {\n    display: flex;\n    flex-direction: column;\n    gap: 0;\n    min-width: 0;\n}\n.measurement-location-text {\n    font-size: 15px;\n    font-weight: 500;\n    color: #1a1a1a;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 220px;\n    line-height: 1.2;\n}\n.measurement-name-text {\n    font-size: 12px;\n    color: #666666;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 220px;\n    line-height: 1.2;\n}\n\n/* Measurement Switch Button - white text, centered icon */\n.switch-btn {\n    min-width: 44px !important;\n    width: 44px !important;\n    height: 36px !important;\n    padding: 0 !important;\n    border-radius: 4px !important;\n    display: inline-flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    color: white !important;\n}\n.switch-btn mat-icon {\n    margin: 0 !important;\n    color: white !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n}\n\n/* Header Action Buttons - unified 36px height */\n#parameter-button,\n#projects-button,\n#reports-button {\n    height: 36px !important;\n    min-height: 36px !important;\n    line-height: 36px !important;\n}\n\n\n\n\n\n\n\n\n\n\n\n/* Main Layout - transparent to show grid background */\n.main-layout {\n    width: 100%;\n    height: 100%;\n}\n\n\n\n.measurement-header .header-title {\n    font-size: 1.4em;\n    font-weight: 550;\n    margin-right: 20px;\n    min-width: 150px;\n}\n\n/* Measurement Header - white card with outer margin (top, left, right) */\n.measurement-header {\n    background: #fff;\n    border-radius: 8px;\n    padding: 12px 16px;\n    margin: 10px 10px 0 10px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.08);\n}\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "reports-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": "",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": "",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form\n  [formGroup]=\"addDeviceFormGroup\"\n(ngSubmit)=\"save()\"\nclass=\"add-entity-form w-11/12 max-w-3xl mx-auto\">\n\n    <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\n    <h2 class=\"text-lg font-semibold\">{{ 'custom.diagnostics.action.edit-measurement-parameters.title' | translate }}</h2>\n<span class=\"flex-1\"></span>\n<button mat-icon-button (click)=\"cancel()\" type=\"button\">\n    <mat-icon>close</mat-icon>\n</button>\n</mat-toolbar>\n\n<mat-progress-bar\n    color=\"warn\"\n    mode=\"indeterminate\"\n    *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n\n<div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear class=\"space-y-4\">\n\n        <!-- Assignment Step -->\n        <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\n            <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.assignment.title' | translate }}</ng-template>\n\n            <!-- Assigned Devices -->\n            <mat-form-field appearance=\"fill\" class=\"w-full\">\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.title' | translate }}</mat-label>\n                <mat-chip-grid\n                #chipList\n                aria-label=\"Assigned Devices\"\n                class=\"flex flex-wrap gap-2 mt-2\">\n                <mat-chip-row *ngFor=\"let dev of assignedDevices\" color=\"primary\" selected disableRipple>\n                {{ dev.name }}\n            </mat-chip-row>\n        </mat-chip-grid>\n        <input\n            matInput\n        [matChipInputFor]=\"chipList\"\n        readonly\n        [placeholder]=\"assignedDevices?.length ? '' : ('custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate)\"/>\n        <mat-error *ngIf=\"!assignedDevices?.length\">{{'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate}}</mat-error>\n</mat-form-field>\n\n<!-- Progress -->\n<mat-form-field appearance=\"fill\" class=\"w-full\">\n    <mat-label>{{ 'custom.diagnostics.measurement-progress.title' | translate }}</mat-label>\n    <mat-select formControlName=\"progress\">\n        <mat-option value=\"in preparation\">{{ 'custom.diagnostics.state-filter.preparation.title' | translate }}</mat-option>\n        <mat-option value=\"active\">{{ 'custom.diagnostics.state-filter.active.title' | translate }}</mat-option>\n        <mat-option value=\"finished\">{{ 'custom.diagnostics.state-filter.finished.title' | translate }}</mat-option>\n        <mat-option value=\"aborted\">{{ 'custom.diagnostics.state-filter.aborted.title' | translate }}</mat-option>\n    </mat-select>\n</mat-form-field>\n\n<!-- Start/End DateTime -->\n<div class=\"flex w-full gap-2\">\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-date.title' | translate }}</mat-label>\n        <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\n    <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\"/>\n    </mat-form-field>\n<mat-form-field appearance=\"fill\" class=\"flex-1\">\n    <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-time.title' | translate }}</mat-label>\n    <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\n<mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\"/>\n    </mat-form-field>\n</div>\n\n<div class=\"flex w-full gap-2\">\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-date.title' | translate }}</mat-label>\n        <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\n    <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\"/>\n    </mat-form-field>\n<mat-form-field appearance=\"fill\" class=\"flex-1\">\n    <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-time.title' | translate }}</mat-label>\n    <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\n<mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\"/>\n    </mat-form-field>\n</div>\n\n<!-- Actions -->\n<div mat-dialog-actions class=\"flex justify-end gap-2\">\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ 'action.cancel' | translate }}</button>\n<button\n    mat-button\n    matStepperNext\n    type=\"button\"\n    color=\"primary\"\n            *ngIf=\"showAttributesStep\"\n    [disabled]=\"!assignedDevicesAvailable\">\n    {{ 'custom.diagnostics.action.next.title' | translate }}\n    </button>\n<button\n    mat-raised-button\n    color=\"primary\"\n    type=\"submit\"\n            *ngIf=\"!showAttributesStep\"\n    [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n    {{ 'action.save' | translate }}\n    </button>\n</div>\n</mat-step>\n\n<!-- Attributes Step -->\n<mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\n    <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.default-parameters.title' | translate }}</ng-template>\n\n<div class=\"flex flex-col gap-2\">\n\n    <!-- Dimension -->\n    <fieldset class=\"fieldset\">\n        <legend class=\"fieldset-legend\">Dimension</legend>\n        <div class=\"flex w-full gap-2\">\n            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.title' | translate }}</mat-label>\n                <mat-select formControlName=\"dimension\" required>\n                    <mat-option *ngFor=\"let dim of dimensionOptions\" [value]=\"dim\">{{ dim }}</mat-option>\n            </mat-select>\n            <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\n            {{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.error' | translate }}\n        </mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.nominal-flow.title' | translate }}</mat-label>\n        <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly/>\n    </mat-form-field>\n</div>\n<div class=\"flex gap-2\">\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.floor-volume.title' | translate }}</mat-label>\n        <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\"/>\n    </mat-form-field>\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.pump-power.title' | translate }}</mat-label>\n        <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\"/>\n    </mat-form-field>\n</div>\n</fieldset>\n\n<!-- Installation -->\n<fieldset class=\"fieldset\">\n    <legend class=\"fieldset-legend\">Installation</legend>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.title' | translate }}</mat-label>\n            <mat-select formControlName=\"installationType\" required>\n                <mat-option value=\"heating\">{{ 'custom.diagnostics.measurement-type.heating.title' | translate }}</mat-option>\n                <mat-option value=\"cooling\">{{ 'custom.diagnostics.measurement-type.cooling.title' | translate }}</mat-option>\n            </mat-select>\n            <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\n            {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.error' | translate }}\n        </mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.title' | translate }}</mat-label>\n        <mat-select formControlName=\"installationTypeOptions\" required>\n            <ng-container\n            *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\n            <mat-option value=\"radiatorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.radiator-heating.title' | translate }}</mat-option>\n            <mat-option value=\"floorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.floor-heating.title' | translate }}</mat-option>\n            <mat-option value=\"districtHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.district-heating.title' | translate }}</mat-option>\n            <mat-option value=\"heatingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.heating-other.title' | translate }}</mat-option>\n        </ng-container>\n        <ng-container\n        *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\n        <mat-option value=\"coolingCircuit\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-circuit.title' | translate }}</mat-option>\n        <mat-option value=\"coolingCeiling\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-ceiling.title' | translate }}</mat-option>\n        <mat-option value=\"chiller\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.chiller.title' | translate }}</mat-option>\n        <mat-option value=\"coolingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-other.title' | translate }}</mat-option>\n    </ng-container>\n</mat-select>\n<mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\n    {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.error' | translate }}\n</mat-error>\n</mat-form-field>\n</div>\n</fieldset>\n\n<!-- Analysis -->\n<fieldset class=\"fieldset\">\n    <legend class=\"fieldset-legend\">Analysis</legend>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature' | translate }}</mat-label>\n            <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\"/>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>Delta T</mat-label>\n            <input matInput formControlName=\"deltaT\" type=\"number\"/>\n        </mat-form-field>\n    </div>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold-setting' | translate }}</mat-label>\n            <mat-select formControlName=\"loadCourseFilterTemperature\" required>\n                <mat-option value=\"above\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.above' | translate }}</mat-option>\n                <mat-option value=\"below\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.below' | translate }}</mat-option>\n            </mat-select>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold' | translate }}</mat-label>\n            <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\"/>\n        </mat-form-field>\n    </div>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.maximum-power-threshold' | translate }}</mat-label>\n            <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\"/>\n        </mat-form-field>\n    </div>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{'unit.measures.area' | translate}}</mat-label>\n            <input matInput formControlName=\"area\" type=\"number\"/>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'filter.unit' | translate}}</mat-label>\n            <input matInput formControlName=\"unit\" type=\"text\"/>\n        </mat-form-field>\n    </div>\n</fieldset>\n\n<!-- Weekly Operating Schedule -->\n<fieldset class=\"fieldset\">\n    <legend class=\"fieldset-legend\">{{ 'custom.diagnostics.action.edit-measurement-parameters.timings.weekly-schedule.title' | translate }}</legend>\n    <div\n        formGroupName=\"weeklyOperatingSchedule\"\n        class=\"flex justify-between items-center gap-2\">\n        <mat-checkbox formControlName=\"monday\">{{ 'scheduler.monday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"tuesday\">{{ 'scheduler.tuesday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"wednesday\">{{ 'scheduler.wednesday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"thursday\">{{ 'scheduler.thursday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"friday\">{{ 'scheduler.friday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"saturday\">{{ 'scheduler.saturday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"sunday\">{{ 'scheduler.sunday-label' | translate }}</mat-checkbox>\n    </div>\n</fieldset>\n\n</div>\n\n<div mat-dialog-actions class=\"flex justify-end gap-2\">\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"> {{ 'action.cancel' | translate }}</button>\n<button mat-button matStepperPrevious color=\"primary\"> {{ 'action.back' | translate }}</button>\n<button\n    mat-raised-button\n    color=\"primary\"\n    type=\"submit\"\n            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n    {{ 'action.save' | translate }}\n    </button>\n</div>\n</mat-step>\n\n<!-- Alarm Thresholds Step (Commented Out) -->\n<!--  -->\n</mat-horizontal-stepper>\n</div>\n</form>\n",
                "customCss": ".add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = [\r\n    'customDialog',\r\n    'entityService',\r\n    'deviceService',\r\n    'entityGroupService',\r\n    'attributeService',\r\n    'entityRelationService',\r\n    'assetService'\r\n].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Invalid measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            fetchAttributes(devices);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching devices:\", error);\r\n            fetchAttributes([]);\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDevices) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDevices, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching attributes:\", error);\r\n            openAddDeviceDialog(assignedDevices, []);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDevices, attributes) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        assignedDevices,\r\n        attributes,\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    // const measurementType = vm.data.attributes[0].value;\r\n    const measurementTypeAttr = vm.data.attributes.find(attr => attr.key === 'measurementType');\r\n    const measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\r\n\r\n    const {\r\n        measurementId,\r\n        assignedDevices = [],\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n\r\n    vm.assignedDevices = assignedDevices;\r\n    vm.assignedDevicesAvailable = assignedDevices.length > 0;\r\n\r\n    vm.showAttributesStep = vm.assignedDevicesAvailable && (measurementType === 'ultrasonic');\r\n    /*vm.showAlarmThresholdsStep = vm.assignedDevicesAvailable;*/\r\n\r\n\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                progress: [{ value: 'in preparation', disabled: !vm.assignedDevicesAvailable }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                startTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area: [null],\r\n                unit: [null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            /*alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),*/\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Map known attribute keys to form controls\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                // If it's 'progress', put in assignmentStep; else in attributesStep\r\n                const stepGroup =\r\n                    (formControlName === 'progress')\r\n                        ? 'assignmentStep'\r\n                        : 'attributesStep';\r\n\r\n                vm.addDeviceFormGroup\r\n                  .get(`stepper.${stepGroup}.${formControlName}`)\r\n                  .setValue(attr.value);\r\n            }\r\n            // Start/end times\r\n            else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = (attr.key === 'startTimeMs') ? 'startDate' : 'endDate';\r\n                    const timeControlName = (attr.key === 'startTimeMs') ? 'startTime' : 'endTime';\r\n\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            }\r\n            // Weekly schedule\r\n            else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n            // If you had existing alarm threshold attributes, you could map them similarly\r\n            // e.g. if there's an attr.key === 'maxVolumeFlowCriticalThreshold', etc.\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n\r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((val) => {\r\n                setDefaultDeltaT(val);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((val) => {\r\n                if (val) {\r\n                    // Example: floorVolume is 2% of nominalFlow\r\n                    const floorVal = (val * 0.02).toFixed(3);\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(floorVal);\r\n                }\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.assignmentStep.progress')\r\n            .valueChanges.subscribe((newValue) => {\r\n                if (newValue !== lastProgressValue) {\r\n                    lastProgressValue = newValue;\r\n                    updateProgressControl();\r\n                }\r\n            });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n            \r\n    if (!vm.showAttributesStep) {\r\n          // For the entire step:\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').disable();\r\n          // or remove required validators from each control\r\n        } else {\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').enable();\r\n        }\r\n\r\n        if (!vm.assignedDevicesAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n\r\n        // If progress is active but no start time set, auto-set to now\r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        }\r\n        // If progress is finished/aborted but no end time set (and we have a start), auto-set end to now\r\n        else if (\r\n            (progressControl.value === 'finished' || progressControl.value === 'aborted') &&\r\n            startDateControl.value && startTimeControl.value &&\r\n            !endDateControl.value && !endTimeControl.value\r\n        ) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        \r\n        // Only clear if the current value isn't one of the valid options\r\n        const currentOption = vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').value;\r\n        if (!options.includes(currentOption)) {\r\n             vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n        }\r\n    }\r\n\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const defaultDelta = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.deltaT')\r\n            .setValue(defaultDelta);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n/*        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;*/\r\n\r\n        // Convert date/time to epoch\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            {\r\n                key: 'area',\r\n                value: {\r\n                    value: attributesStep.area,\r\n                    unit: attributesStep.unit\r\n                }\r\n            },\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n\r\n            /*{ key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },*/\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                // Save successful\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error while saving attributes:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "77a63eda-0194-b957-14b1-932f77030c85"
              },
              {
                "name": "measurement-switch-button",
                "icon": "swap_horiz",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "",
                "type": "customPretty",
                "customHtml": "<div class=\"measurement-switch-dialog\">\n    <mat-toolbar class=\"dialog-header\" color=\"primary\">\n        <div class=\"flex items-center gap-2\">\n            <mat-icon>swap_horiz</mat-icon>\n            <h2 class=\"dialog-title\">{{ 'custom.diagnostics.action.measurement-switch.title' | translate }}</h2>\n        </div>\n        <span class=\"flex-1\"></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon>close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <div class=\"dialog-content\">\n        <div *ngIf=\"loading\" class=\"loading-container\">\n            <mat-spinner diameter=\"40\"></mat-spinner>\n        </div>\n\n        <div *ngIf=\"!loading && measurements.length === 0\" class=\"empty-message\">\n            {{ 'custom.diagnostics.action.measurement-switch.no-measurements' | translate }}\n        </div>\n\n        <div *ngIf=\"!loading\" class=\"measurement-list\">\n            <div *ngFor=\"let m of measurements\"\n                 class=\"measurement-item\"\n                 [class.current]=\"m.isCurrent\"\n                 (click)=\"selectMeasurement(m)\">\n\n                <div class=\"measurement-info\">\n                    <div class=\"measurement-location\">{{ m.locationName || m.entityLabel || 'N/A' }}</div>\n                    <div class=\"measurement-name\">{{ m.entityName }}</div>\n                </div>\n\n                <div class=\"measurement-badges\">\n                    <span class=\"badge badge-type\" [ngClass]=\"'badge-' + m.measurementType\">\n                        {{ m.measurementTypeLabel }}\n                    </span>\n                    <span class=\"badge badge-progress\" [ngClass]=\"'badge-' + m.progress\">\n                        {{ m.progressLabel }}\n                    </span>\n                </div>\n\n                <mat-icon *ngIf=\"m.isCurrent\" class=\"current-indicator\">check_circle</mat-icon>\n            </div>\n        </div>\n    </div>\n</div>",
                "customCss": ".measurement-switch-dialog {\n    width: 450px;\n    max-height: 70vh;\n    display: flex;\n    flex-direction: column;\n    font-family: Roboto, sans-serif;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.dialog-header {\n    display: flex;\n    align-items: center;\n    padding: 0 8px 0 16px;\n    min-height: 52px;\n}\n\n.dialog-title {\n    margin: 0;\n    font-size: 17px;\n    font-weight: 500;\n}\n\n.dialog-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 0; /* No padding - items touch edges */\n}\n\n.loading-container {\n    display: flex;\n    justify-content: center;\n    padding: 32px;\n}\n\n.empty-message {\n    text-align: center;\n    padding: 32px 16px;\n    color: #666;\n}\n\n.measurement-list {\n    display: flex;\n    flex-direction: column;\n}\n\n.measurement-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 14px 20px;\n    cursor: pointer;\n    transition: background-color 0.15s ease;\n    border-bottom: 1px solid #f0f0f0;\n}\n\n.measurement-item:last-child {\n    border-bottom: none;\n}\n\n.measurement-item:hover {\n    background: #f5f5f5;\n}\n\n.measurement-item.current {\n    background: rgba(33, 150, 243, 0.08);\n    cursor: default;\n}\n\n.measurement-item.current:hover {\n    background: rgba(33, 150, 243, 0.08);\n}\n\n.measurement-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.measurement-location {\n    font-size: 15px;\n    font-weight: 500;\n    color: #212529;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.measurement-name {\n    font-size: 12px;\n    color: #6c757d;\n    margin-top: 2px;\n}\n\n.measurement-badges {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 4px;\n}\n\n.badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 2px 8px;\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.badge-ultrasonic {\n    background: #e8f5e9;\n    color: #2e7d32;\n}\n\n.badge-import {\n    background: #fff3e0;\n    color: #ef6c00;\n}\n\n.badge-lorawan {\n    background: #f3e5f5;\n    color: #7b1fa2;\n}\n\n.badge-progress {\n    background: #f5f5f5;\n    color: #616161;\n}\n\n.badge-in-preparation, .badge-in_preparation {\n    background: #fff8e1;\n    color: #f9a825;\n}\n\n.badge-active {\n    background: #e8f5e9;\n    color: #2e7d32;\n}\n\n.badge-finished {\n    background: #e3f2fd;\n    color: #1565c0;\n}\n\n.badge-aborted {\n    background: #ffebee;\n    color: #c62828;\n}\n\n.current-indicator {\n    color: #2196F3;\n    font-size: 20px !important;\n    width: 20px !important;\n    height: 20px !important;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nconst {\n    customDialog,\n    attributeService,\n    assetService,\n    entityRelationService,\n} = [\n    'customDialog',\n    'attributeService',\n    'assetService',\n    'entityRelationService',\n].reduce((services, name) => {\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\n    return services;\n}, {});\n\nconst currentMeasurementId = entityId;\nconst stateController = widgetContext.stateController;\n\nconst currentStateName = stateController.getStateId();\nconst isHeating = currentStateName.includes('heating');\n\nfindProjectAndMeasurements();\n\nfunction findProjectAndMeasurements() {\n    entityRelationService.findByTo(currentMeasurementId).subscribe(\n        (relations) => {\n            const projectRelations = (relations || []).filter(\n                (r) => r.from && r.from.entityType === 'ASSET'\n            );\n\n            if (projectRelations.length > 0) {\n                const projectEntityId = projectRelations[0].from;\n                findMeasurementsInProject(projectEntityId);\n            } else {\n                openDialog([]);\n            }\n        },\n        (error) => {\n            console.error('Error finding project relations:', error);\n            openDialog([]);\n        }\n    );\n}\n\nfunction findMeasurementsInProject(projectEntityId) {\n    entityRelationService.findByFrom(projectEntityId).subscribe(\n        (relations) => {\n            const measurementRelations = (relations || []).filter(\n                (r) => r.to && r.to.entityType === 'ASSET'\n            );\n\n            if (measurementRelations.length === 0) {\n                openDialog([]);\n                return;\n            }\n\n            const measurementEntityIds = measurementRelations.map(r => r.to);\n            fetchMeasurementDetails(measurementEntityIds);\n        },\n        (error) => {\n            console.error('Error finding measurements:', error);\n            openDialog([]);\n        }\n    );\n}\n\nfunction fetchMeasurementDetails(measurementEntityIds) {\n    const measurements = [];\n    let completed = 0;\n\n    measurementEntityIds.forEach((entityId) => {\n        assetService.getAsset(entityId.id).subscribe(\n            (asset) => {\n                measurements.push(asset);\n                completed++;\n                if (completed === measurementEntityIds.length) {\n                    fetchMeasurementAttributes(measurements);\n                }\n            },\n            (error) => {\n                console.error('Error fetching asset:', entityId.id, error);\n                completed++;\n                if (completed === measurementEntityIds.length) {\n                    fetchMeasurementAttributes(measurements);\n                }\n            }\n        );\n    });\n}\n\nfunction fetchMeasurementAttributes(measurements) {\n    if (!measurements || measurements.length === 0) {\n        openDialog([]);\n        return;\n    }\n\n    const attributeKeys = ['locationName', 'measurementType', 'progress'];\n    let completed = 0;\n    const measurementData = [];\n\n    measurements.forEach((m) => {\n        attributeService.getEntityAttributes(m.id, 'SERVER_SCOPE', attributeKeys).subscribe(\n            (attrs) => {\n                const attrMap = {};\n                attrs.forEach((a) => { attrMap[a.key] = a.value; });\n\n                const mType = attrMap.measurementType || '';\n                if (mType === 'import' || mType === 'ultrasonic' || mType === 'lorawan') {\n                    measurementData.push({\n                        id: m.id,\n                        entityName: m.name,\n                        entityLabel: m.label,\n                        locationName: attrMap.locationName,\n                        measurementType: mType,\n                        progress: attrMap.progress || 'in preparation',\n                        isCurrent: m.id.id === currentMeasurementId.id,\n                    });\n                }\n\n                completed++;\n                if (completed === measurements.length) {\n                    measurementData.sort((a, b) => {\n                        const aMatch = (a.entityName || '').match(/(\\d+)$/);\n                        const bMatch = (b.entityName || '').match(/(\\d+)$/);\n                        return (aMatch ? parseInt(aMatch[1]) : 0) - (bMatch ? parseInt(bMatch[1]) : 0);\n                    });\n                    openDialog(measurementData);\n                }\n            },\n            (error) => {\n                console.error('Error fetching attributes for', m.id, error);\n                completed++;\n                if (completed === measurements.length) {\n                    openDialog(measurementData);\n                }\n            }\n        );\n    });\n}\n\nfunction openDialog(measurements) {\n    customDialog.customDialog(htmlTemplate, MeasurementSwitchController, {\n        measurements,\n        currentMeasurementId,\n        isHeating,\n        stateController,\n    }).subscribe();\n}\n\nfunction MeasurementSwitchController(instance) {\n    const vm = instance;\n    const { measurements, currentMeasurementId, isHeating, stateController } = vm.data;\n\n    vm.loading = false;\n    vm.measurements = measurements.map((m) => ({\n        ...m,\n        measurementTypeLabel: getMeasurementTypeLabel(m.measurementType),\n        progressLabel: getProgressLabel(m.progress),\n    }));\n\n    function getMeasurementTypeLabel(type) {\n        const labels = {\n            'ultrasonic': 'Ultrasonic',\n            'import': 'Import',\n            'lorawan': 'LoRaWAN',\n        };\n        return labels[type] || type;\n    }\n\n    function getProgressLabel(progress) {\n        const labels = {\n            'in preparation': 'In Vorbereitung',\n            'in_preparation': 'In Vorbereitung',\n            'active': 'Aktiv',\n            'finished': 'Abgeschlossen',\n            'aborted': 'Abgebrochen',\n        };\n        return labels[progress] || progress;\n    }\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.selectMeasurement = function(measurement) {\n        if (measurement.isCurrent) {\n            return;\n        }\n\n        // Update current state params instead of pushing new state\n        const newParams = {\n            selectedMeasurement: {\n                entityId: measurement.id,\n                entityName: measurement.entityName,\n                entityLabel: measurement.entityLabel || measurement.entityName,\n            }\n        };\n\n        // Use updateState to replace params without adding to state stack\n        stateController.updateState(null, newParams);\n\n        vm.dialogRef.close(null);\n    };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9afdb21f-8bc8-4a65-81d7-d18f212c112f"
              },
              {
                "name": "analysis-button",
                "icon": "insights",
                "type": "customPretty",
                "customHtml": "<div style=\"width: 400px;\"><mat-toolbar class=\"flex items-center\" color=\"primary\"><mat-icon style=\"margin-right: 12px;\">insights</mat-icon><h2 style=\"margin: 0; font-size: 18px;\">{i18n:custom.diagnostics.analysis.title}</h2><span class=\"flex-1\"></span><button mat-icon-button (click)=\"dialogRef.close()\"><mat-icon>close</mat-icon></button></mat-toolbar><div class=\"p-4\"><p style=\"color: #666;\">{i18n:custom.diagnostics.analysis.placeholder}</p></div></div>",
                "customCss": "",
                "customFunction": "",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "50211e4f-2ed7-434b-b169-86bf637b33a9"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "0"
        },
        "row": 0,
        "col": 0,
        "id": "f0dfbf6c-c2b0-2975-eb81-df9748cae9a5"
      },
      "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.3601545606589338,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.22269988983816758
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.08522023745480056
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.6869463922331669
                },
                {
                  "name": "installationTypeOptions",
                  "type": "attribute",
                  "label": "installationTypeOptions",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.5906840773460056
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.34162610005382144
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.6538615706972768
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.34458645066683413
                },
                {
                  "name": "dimension",
                  "type": "attribute",
                  "label": "dimension",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.12782307845724783
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.48540079128001534
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.8908409252575222
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "transparent",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": {
              "body": "let $injector = ctx.$scope.$injector;\nlet assetService = $injector.get(ctx.servicesMap.get('assetService'));\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nvar entityId;\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n    entityId = data[0]['entityId'];\n} else {\n    deviceState = false;\n    entityId = null;\n}\nlet userRole;\nif(data[1] && data[1].role){\n    userRole = data[1].role;\n}\n\nvar stateParams = ctx.stateController.getStateParams();\nctx.stateController.updateState(null, stateParams);\nif(entityId) {\n\n    var ButtonHtml = '';\n    if (userRole !== 'Belimo Retrofit Users') {\n        ButtonHtml =\n            '<button id=\"parameter-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.action.measurement-parameters}</span>' +\n            '</button>' +\n            '<button id=\"projects-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n            '</button>';\n    }\n\n    var name, label, state, active, progress, locationName, installationType, installation, dimension, installationTypeOptions, measurementType, startTime, endTime;\n    if (data && data.length) {\n        name = data[0]['entityName'] || 'N/A';\n        label = data[0]['Label'] || 'N/A';\n        locationName = data[0]['locationName'] || 'N/A';\n        installationType = data[0]['installationType'] || 'N/A';\n        installationTypeOptions = data[0]['installationTypeOptions'] || 'N/A';\n        dimension = data[0]['dimension'] || 'N/A';\n        state = data[0]['state'] || 'N/A';\n        active = data[0]['active'] || 'N/A';\n        progress = data[0]['progress'] || 'N/A';\n        measurementType = data[0]['measurementType'] || 'N/A';\n        startTime = data[0]['startTimeMs'] || 'N/A';\n        endTime = data[0]['endTimeMs'] || 'N/A';\n        if (active === 'false') {\n            state = 'disconnected';\n        }\n    }\n\n    // finished & aborted\n    if (startTime !== 'N/A' && endTime !== 'N/A') {\n        deltaTime = endTime - startTime;\n        timeThreshold = 3024000000; // 35 days\n        if (deltaTime <= timeThreshold) {\n            var newDashboardtimewindow = {\n                aggregation: { limit: 100000, type: \"NONE\" },\n                hideAggInterval: true,\n                hideAggregation: true,\n                hideInterval: false,\n                history: {\n                    historyType: 1,\n                    fixedTimewindow: { startTimeMs: startTime, endTimeMs: endTime }\n                },\n                selectedTab: 1\n            };\n        } else {\n            var newDashboardtimewindow = {\n                aggregation: { limit: 100000, type: \"NONE\" },\n                hideAggInterval: true,\n                hideAggregation: true,\n                hideInterval: false,\n                history: {\n                    historyType: 1,\n                    fixedTimewindow: { startTimeMs: endTime - timeThreshold, endTimeMs: endTime }\n                },\n                selectedTab: 1\n            };\n        }\n    }\n    // active\n    else if (startTime !== 'N/A' && endTime === 'N/A') {\n        timeThreshold = 3024000000;\n        deltaTime = (Date.now())-startTime;\n        if(deltaTime>timeThreshold){\n            startTime = startTime+(deltaTime-timeThreshold);\n        }\n        var newDashboardtimewindow = {\n            aggregation: { limit: 100000, type: \"NONE\" },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: { startTimeMs: startTime, endTimeMs: Date.now() }\n            },\n            selectedTab: 1\n        };\n    }\n    // default\n    else {\n        var newDashboardtimewindow = {\n            aggregation: { limit: 100000, type: \"NONE\" },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: { startTimeMs: Date.now() - 1209600000, endTimeMs: Date.now() }\n            },\n            selectedTab: 1\n        };\n    }\n\n    ctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\n    ctx.stateController.updateState(null, stateParams);\n\n    function getStateBadge(stateValue, type) {\n        var badgeClass = '';\n        var icon = '';\n        var label = '';\n        switch (stateValue) {\n            case 'in preparation':\n                badgeClass = 'badge-preparation'; icon = 'schedule';\n                label = '{i18n:custom.diagnostics.state-filter.preparation.title}'; break;\n            case 'active':\n                badgeClass = 'badge-active'; icon = 'play_circle';\n                label = '{i18n:custom.diagnostics.state-filter.active.title}'; break;\n            case 'finished':\n                badgeClass = 'badge-finished'; icon = 'check_circle';\n                label = '{i18n:custom.diagnostics.state-filter.finished.title}'; break;\n            case 'aborted':\n                badgeClass = 'badge-aborted'; icon = 'cancel';\n                label = '{i18n:custom.diagnostics.state-filter.aborted.title}'; break;\n            case 'critical':\n                badgeClass = 'badge-critical'; icon = 'error';\n                label = '{i18n:custom.diagnostics.alarm-severity.critical}'; break;\n            case 'major':\n                badgeClass = 'badge-major'; icon = 'warning';\n                label = '{i18n:custom.diagnostics.alarm-severity.major}'; break;\n            case 'minor':\n                badgeClass = 'badge-minor'; icon = 'info';\n                label = '{i18n:custom.diagnostics.alarm-severity.minor}'; break;\n            case 'normal':\n                badgeClass = 'badge-normal'; icon = 'check_circle';\n                label = '{i18n:custom.diagnostics.alarm-severity.normal}'; break;\n            case 'disconnected':\n                badgeClass = 'badge-disconnected'; icon = 'link_off';\n                label = '{i18n:device.inactive}'; break;\n            default:\n                badgeClass = 'badge-default'; icon = 'help';\n                label = stateValue || 'N/A';\n        }\n        return '<span class=\"status-badge ' + badgeClass + '\">' +\n               '<mat-icon class=\"badge-icon\">' + icon + '</mat-icon>' +\n               '<span>' + label + '</span></span>';\n    }\n\n    function formatTimestampDisplay(timestampMs) {\n        if (timestampMs === null || timestampMs === undefined || timestampMs === 'N/A') return null;\n        var value = Number(timestampMs);\n        if (!Number.isFinite(value) || value <= 0) return null;\n        var date = new Date(value);\n        function pad(n) { return n.toString().padStart(2, '0'); }\n        return pad(date.getDate()) + '.' + pad(date.getMonth() + 1) + '.' + date.getFullYear() +\n               ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n    }\n\n    function getDateBadge(timestampMs, type) {\n        var formatted = formatTimestampDisplay(timestampMs);\n        if (!formatted) return '';\n        var icon = type === 'start' ? 'play_circle' : 'stop_circle';\n        var color = type === 'start' ? '#27AE60' : '#2F80ED';\n        var bgColor = type === 'start' ? 'rgba(39, 174, 96, 0.12)' : 'rgba(47, 128, 237, 0.12)';\n        return '<span class=\"status-badge\" style=\"background:' + bgColor + '; color:' + color + ';\">' +\n               '<mat-icon class=\"badge-icon\">' + icon + '</mat-icon>' +\n               '<span>' + formatted + '</span></span>';\n    }\n\n    var installationBadge = '<span class=\"status-badge badge-heating\">' +\n        '<mat-icon class=\"badge-icon\">local_fire_department</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.measurement-type.heating.title}</span></span>';\n\n    var typeBadge = '<span class=\"status-badge badge-type\">' +\n        `{i18n:custom.diagnostics.action.edit-measurement-parameters.installation-type-options.${clientUtils.toKebabCase(installationTypeOptions)}.title}` +\n        '</span>';\n\n    var displayTitle = (locationName && locationName !== 'N/A') ? locationName : name;\n\n    var header = '<div class=\"measurement-header flex items-center justify-between\">' +\n      '<div class=\"flex items-center gap-3\">' +\n        '<button id=\"go-back\" type=\"button\" mat-raised-button color=\"primary\" class=\"back-button\">' +\n          '<mat-icon>arrow_back</mat-icon><span>{i18n:action.go-back}</span></button>' +\n        '<button id=\"measurement-switch-button\" type=\"button\" mat-raised-button color=\"accent\" class=\"switch-btn\">' +\n          '<mat-icon>swap_horiz</mat-icon>' +\n        '</button>' +\n        '<div class=\"measurement-title-block\">' +\n          '<span class=\"measurement-location-text\">' + ((locationName && locationName !== 'N/A') ? locationName : label) + '</span>' +\n          '<span class=\"measurement-name-text\">' + name + '</span>' +\n        '</div>' +\n      '</div>' +\n      '<div class=\"flex flex-col items-center gap-1 flex-1\">' +\n        '<div class=\"flex items-center gap-2\">' + installationBadge + typeBadge + getStateBadge(state, 'state') + '</div>' +\n        '<div class=\"flex items-center gap-2\">' + getStateBadge(progress, 'progress') + getDateBadge(startTime, 'start') + getDateBadge(endTime, 'end') + '</div>' +\n      '</div>' +\n      '<div class=\"flex items-center gap-2\">' + ButtonHtml +\n        '<button id=\"reports-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon><span>{i18n:custom.diagnostics.reports-btn.title}</span></button>' +\n        '<button id=\"analysis-button\" type=\"button\" mat-raised-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">insights</mat-icon><span>{i18n:custom.diagnostics.analysis.title}</span></button>' +\n      '</div>' +\n    '</div>';\n\n    return '<div class=\"main-layout flex flex-col w-full h-full\">' + header +\n        '<div id=\"power_measurement_heating_wrapper\" class=\"flex-1\">' +\n          '<tb-dashboard-state class=\"w-full h-full\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_data_heating\"></tb-dashboard-state>' +\n        '</div></div>';\n}\n",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "@media screen and (min-width: 599px) {\n  .parameters-section {\n    display: none;\n  }\n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n/*.main-layout .header .title {\n    width: auto;\n    height: 50px;\n    padding-right: 15px; \n    font-size: 18px;\n    font-weight: 500;\n    background-color: #E0E0E0;\n    color: #28232D;\n    display: flex; \n    align-items: center; \n    justify-content: center;\n    gap: 2px;\n    margin-right: 10px;\n    border-radius: 4px;\n}*/\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #reports-button, #data-button, #report-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown {\n    width: auto; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown option {\n    width: 500px;\n    background-color: #f0f0f0; /* Example background color */\n    color: #28232D;           /* Text color */\n    font-size: 18px;          /* Font size */\n    font-weight: 500;         /* Font weight */\n    /* Some browsers may support these, others might ignore them: */\n    padding: 5px;\n}\n\n\n#measurement-dropdown:focus {\n    outline: none !important;\n    border: none !important;\n    box-shadow: none !important;\n    outline-offset: 0 !important;\n}\n\n#measurement-dropdown::-moz-focus-inner {\n    border: 0 !important;\n}\n\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #reports-button:hover, #data-button:hover, #report-button:hover, #parameter-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #reports-button mat-icon, #data-button mat-icon, #report-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #data-button und #report-button */\n#projects-button span, #reports-button span, #data-button span, #report-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n\n/* Badge Styling */\n.status-badge {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.status-badge .badge-icon {\n    font-size: 14px !important;\n    width: 14px !important;\n    height: 14px !important;\n}\n\n.status-badge.badge-heating {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-cooling {\n    background: rgba(33, 150, 243, 0.1);\n    color: #2196F3;\n}\n\n.status-badge.badge-type {\n    background: #f5f5f5;\n    color: #333;\n}\n\n.status-badge.badge-normal {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-active {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-preparation {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-finished {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-aborted {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-critical {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-major {\n    background: rgba(255, 152, 0, 0.15);\n    color: #FF9800;\n}\n\n.status-badge.badge-minor {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-disconnected {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-default {\n    background: #f5f5f5;\n    color: #666;\n}\n\n/* Back Button */\n.back-button {\n    min-width: unset !important;\n    padding: 8px 16px !important;\n}\n\n.back-button mat-icon {\n    font-size: 18px !important;\n    margin-right: 6px;\n}\n\n\n/* Measurement Title Block - consistent text colors */\n.measurement-title-block {\n    display: flex;\n    flex-direction: column;\n    gap: 0;\n    min-width: 0;\n}\n.measurement-location-text {\n    font-size: 15px;\n    font-weight: 500;\n    color: #1a1a1a;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 220px;\n    line-height: 1.2;\n}\n.measurement-name-text {\n    font-size: 12px;\n    color: #666666;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 220px;\n    line-height: 1.2;\n}\n\n/* Measurement Switch Button - white text, centered icon */\n.switch-btn {\n    min-width: 44px !important;\n    width: 44px !important;\n    height: 36px !important;\n    padding: 0 !important;\n    border-radius: 4px !important;\n    display: inline-flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    color: white !important;\n}\n.switch-btn mat-icon {\n    margin: 0 !important;\n    color: white !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n}\n\n/* Header Action Buttons - unified 36px height */\n#parameter-button,\n#projects-button,\n#reports-button {\n    height: 36px !important;\n    min-height: 36px !important;\n    line-height: 36px !important;\n}\n\n\n\n\n\n\n\n\n\n\n\n/* Main Layout - transparent to show grid background */\n.main-layout {\n    width: 100%;\n    height: 100%;\n}\n\n\n\n.measurement-header .header-title {\n    font-size: 1.4em;\n    font-weight: 550;\n    margin-right: 20px;\n    min-width: 150px;\n}\n\n/* Measurement Header - white card with outer margin (top, left, right) */\n.measurement-header {\n    background: #fff;\n    border-radius: 8px;\n    padding: 12px 16px;\n    margin: 10px 10px 0 10px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.08);\n}\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form\n        [formGroup]=\"addDeviceFormGroup\"\n        (ngSubmit)=\"save()\"\n        class=\"add-entity-form w-11/12 max-w-3xl mx-auto\">\n\n    <mat-toolbar class=\"flex items-center justify-between bg-primary text-white px-4\" color=\"primary\">\n        <h2 class=\"text-lg font-semibold\">{{ 'custom.diagnostics.action.edit-measurement-parameters.title' | translate }}</h2>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon>close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <mat-progress-bar\n            color=\"warn\"\n            mode=\"indeterminate\"\n            *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n\n    <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\n        <mat-horizontal-stepper formGroupName=\"stepper\" linear class=\"space-y-4\">\n\n            <!-- Assignment Step -->\n            <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\n                <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.assignment.title' | translate }}</ng-template>\n\n                <!-- Assigned Devices -->\n                <mat-form-field appearance=\"fill\" class=\"w-full\">\n                    <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.title' | translate }}</mat-label>\n                    <mat-chip-grid\n                            #chipList\n                            aria-label=\"Assigned Devices\"\n                            class=\"flex flex-wrap gap-2 mt-2\">\n                        <mat-chip-row *ngFor=\"let dev of assignedDevices\" color=\"primary\" selected disableRipple>\n                            {{ dev.name }}\n                        </mat-chip-row>\n                    </mat-chip-grid>\n                    <input\n                            matInput\n                            [matChipInputFor]=\"chipList\"\n                            readonly\n                            [placeholder]=\"assignedDevices?.length ? '' : ('custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate)\"/>\n                    <mat-error *ngIf=\"!assignedDevices?.length\">{{'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate}}</mat-error>\n                </mat-form-field>\n\n                <!-- Progress -->\n                <mat-form-field appearance=\"fill\" class=\"w-full\">\n                    <mat-label>{{ 'custom.diagnostics.measurement-progress.title' | translate }}</mat-label>\n                    <mat-select formControlName=\"progress\">\n                        <mat-option value=\"in preparation\">{{ 'custom.diagnostics.state-filter.preparation.title' | translate }}</mat-option>\n                        <mat-option value=\"active\">{{ 'custom.diagnostics.state-filter.active.title' | translate }}</mat-option>\n                        <mat-option value=\"finished\">{{ 'custom.diagnostics.state-filter.finished.title' | translate }}</mat-option>\n                        <mat-option value=\"aborted\">{{ 'custom.diagnostics.state-filter.aborted.title' | translate }}</mat-option>\n                    </mat-select>\n                </mat-form-field>\n\n                <!-- Start/End DateTime -->\n                <div class=\"flex w-full gap-2\">\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-date.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\"/>\n                    </mat-form-field>\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-time.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\"/>\n                    </mat-form-field>\n                </div>\n\n                <div class=\"flex w-full gap-2\">\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-date.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\"/>\n                    </mat-form-field>\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-time.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\"/>\n                    </mat-form-field>\n                </div>\n\n                <!-- Actions -->\n                <div mat-dialog-actions class=\"flex justify-end gap-2\">\n                    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ 'action.cancel' | translate }}</button>\n                    <button\n                            mat-button\n                            matStepperNext\n                            type=\"button\"\n                            color=\"primary\"\n                            *ngIf=\"showAttributesStep\"\n                            [disabled]=\"!assignedDevicesAvailable\">\n                        {{ 'custom.diagnostics.action.next.title' | translate }}\n                    </button>\n                    <button\n                            mat-raised-button\n                            color=\"primary\"\n                            type=\"submit\"\n                            *ngIf=\"!showAttributesStep\"\n                            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n                        {{ 'action.save' | translate }}\n                    </button>\n                </div>\n            </mat-step>\n\n            <!-- Attributes Step -->\n            <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\n                <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.default-parameters.title' | translate }}</ng-template>\n\n                <div class=\"flex flex-col gap-2\">\n\n                    <!-- Dimension -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">Dimension</legend>\n                        <div class=\"flex w-full gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.title' | translate }}</mat-label>\n                                <mat-select formControlName=\"dimension\" required>\n                                    <mat-option *ngFor=\"let dim of dimensionOptions\" [value]=\"dim\">{{ dim }}</mat-option>\n                                </mat-select>\n                                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\n                                    {{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.error' | translate }}\n                                </mat-error>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.nominal-flow.title' | translate }}</mat-label>\n                                <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.floor-volume.title' | translate }}</mat-label>\n                                <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\"/>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.pump-power.title' | translate }}</mat-label>\n                                <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                    </fieldset>\n\n                    <!-- Installation -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">Installation</legend>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.title' | translate }}</mat-label>\n                                <mat-select formControlName=\"installationType\" required>\n                                    <mat-option value=\"heating\">{{ 'custom.diagnostics.measurement-type.heating.title' | translate }}</mat-option>\n                                    <mat-option value=\"cooling\">{{ 'custom.diagnostics.measurement-type.cooling.title' | translate }}</mat-option>\n                                </mat-select>\n                                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\n                                    {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.error' | translate }}\n                                </mat-error>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.title' | translate }}</mat-label>\n                                <mat-select formControlName=\"installationTypeOptions\" required>\n                                    <ng-container\n                                            *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\n                                        <mat-option value=\"radiatorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.radiator-heating.title' | translate }}</mat-option>\n                                        <mat-option value=\"floorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.floor-heating.title' | translate }}</mat-option>\n                                        <mat-option value=\"districtHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.district-heating.title' | translate }}</mat-option>\n                                        <mat-option value=\"heatingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.heating-other.title' | translate }}</mat-option>\n                                    </ng-container>\n                                    <ng-container\n                                            *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\n                                        <mat-option value=\"coolingCircuit\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-circuit.title' | translate }}</mat-option>\n                                        <mat-option value=\"coolingCeiling\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-ceiling.title' | translate }}</mat-option>\n                                        <mat-option value=\"chiller\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.chiller.title' | translate }}</mat-option>\n                                        <mat-option value=\"coolingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-other.title' | translate }}</mat-option>\n                                    </ng-container>\n                                </mat-select>\n                                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\n                                    {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.error' | translate }}\n                                </mat-error>\n                            </mat-form-field>\n                        </div>\n                    </fieldset>\n\n\n                    <!-- Analysis -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">Analysis</legend>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature' | translate }}</mat-label>\n                                <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\"/>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>Delta T</mat-label>\n                                <input matInput formControlName=\"deltaT\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold-setting' | translate }}</mat-label>\n                                <mat-select formControlName=\"loadCourseFilterTemperature\" required>\n                                    <mat-option value=\"above\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.above' | translate }}</mat-option>\n                                    <mat-option value=\"below\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.below' | translate }}</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold' | translate }}</mat-label>\n                                <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.maximum-power-threshold' | translate }}</mat-label>\n                                <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{'unit.measures.area' | translate}}</mat-label>\n                                <input matInput formControlName=\"area\" type=\"number\"/>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'filter.unit' | translate}}</mat-label>\n                                <input matInput formControlName=\"unit\" type=\"text\"/>\n                            </mat-form-field>\n                        </div>\n                    </fieldset>\n\n                    <!-- Weekly Operating Schedule -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">{{ 'custom.diagnostics.action.edit-measurement-parameters.timings.weekly-schedule.title' | translate }}</legend>\n                        <div\n                                formGroupName=\"weeklyOperatingSchedule\"\n                                class=\"flex justify-between items-center gap-2\">\n                            <mat-checkbox formControlName=\"monday\">{{ 'scheduler.monday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"tuesday\">{{ 'scheduler.tuesday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"wednesday\">{{ 'scheduler.wednesday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"thursday\">{{ 'scheduler.thursday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"friday\">{{ 'scheduler.friday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"saturday\">{{ 'scheduler.saturday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"sunday\">{{ 'scheduler.sunday-label' | translate }}</mat-checkbox>\n                        </div>\n                    </fieldset>\n\n                </div>\n\n                <div mat-dialog-actions class=\"flex justify-end gap-2\">\n                    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"> {{ 'action.cancel' | translate }}</button>\n                    <button mat-button matStepperPrevious color=\"primary\"> {{ 'action.back' | translate }}</button>\n                    <button\n                            mat-raised-button\n                            color=\"primary\"\n                            type=\"submit\"\n                            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n                        {{ 'action.save' | translate }}\n                    </button>\n                </div>\n            </mat-step>\n\n            <!-- Alarm Thresholds Step (Commented Out) -->\n            <!--  -->\n        </mat-horizontal-stepper>\n    </div>\n</form>\n",
                "customCss": ".add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = [\r\n    'customDialog',\r\n    'entityService',\r\n    'deviceService',\r\n    'entityGroupService',\r\n    'attributeService',\r\n    'entityRelationService',\r\n    'assetService'\r\n].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Invalid measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            fetchAttributes(devices);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching devices:\", error);\r\n            fetchAttributes([]);\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDevices) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDevices, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching attributes:\", error);\r\n            openAddDeviceDialog(assignedDevices, []);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDevices, attributes) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        assignedDevices,\r\n        attributes,\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    // Retrieve data from vm.data provided to the controller\r\n    const {\r\n        measurementId,\r\n        assignedDevices = [],\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n\r\n    // Retrieve measurementType and progress attribute values\r\n    const measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\r\n    const progressAttr = attributes.find(attr => attr.key === 'progress');\r\n    const measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\r\n    // Default progress to \"in preparation\" if not found\r\n    const progressValue = progressAttr ? progressAttr.value : 'in preparation';\r\n\r\n    // Allow editing if there are assigned devices OR if progress is not \"in preparation\"\r\n    vm.assignedDevicesAvailable = (assignedDevices.length > 0) || (progressValue !== 'in preparation');\r\n\r\n    // If you show a \"No devices assigned!\" text, update the condition accordingly.\r\n    // e.g., vm.showNoDevicesMessage = (assignedDevices.length === 0 && progressValue === 'in preparation');\r\n\r\n    // For additional UI logic  show attributes step only when devices are available and measurementType is 'ultrasonic'\r\n    vm.showAttributesStep = vm.assignedDevicesAvailable && (measurementType === 'ultrasonic');\r\n    /*vm.showAlarmThresholdsStep = vm.assignedDevicesAvailable;*/\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                progress: [{ value: progressValue, disabled: !vm.assignedDevicesAvailable }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                startTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area: [null],\r\n                unit: [null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            /*alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),*/\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Map known attribute keys to form controls\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                // Place 'progress' in assignmentStep; otherwise, in attributesStep\r\n                const stepGroup = (formControlName === 'progress') ? 'assignmentStep' : 'attributesStep';\r\n                vm.addDeviceFormGroup.get(`stepper.${stepGroup}.${formControlName}`).setValue(attr.value);\r\n            }\r\n            // Start/end times\r\n            else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = (attr.key === 'startTimeMs') ? 'startDate' : 'endDate';\r\n                    const timeControlName = (attr.key === 'startTimeMs') ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            }\r\n            // Weekly schedule\r\n            else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup.get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n            // Additional mapping for alarm threshold attributes can be added similarly.\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n\r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').valueChanges.subscribe(() => {\r\n            updateInstallationTypeOptions();\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').valueChanges.subscribe((val) => {\r\n            setDefaultDeltaT(val);\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.dimension').valueChanges.subscribe((dimension) => {\r\n            const nominalFlow = getNominalFlowByDimension(dimension);\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.nominalFlow').setValue(nominalFlow);\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.nominalFlow').valueChanges.subscribe((val) => {\r\n            if (val) {\r\n                // Example: floor volume as 2% of nominalFlow\r\n                const floorVal = (val * 0.02).toFixed(3);\r\n                vm.addDeviceFormGroup.get('stepper.attributesStep.deltaTAnalysisFloorVolume').setValue(floorVal);\r\n            }\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.progress').valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.showAttributesStep) {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep').disable();\r\n        } else {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep').enable();\r\n        }\r\n\r\n        if (!vm.assignedDevicesAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n\r\n        // Auto-set start time if progress is active and not already set.\r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        }\r\n        // Auto-set end time if progress indicates finished/aborted and no end time is set.\r\n        else if (\r\n            (progressControl.value === 'finished' || progressControl.value === 'aborted') &&\r\n            startDateControl.value && startTimeControl.value &&\r\n            !endDateControl.value && !endTimeControl.value\r\n        ) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const defaultDelta = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(defaultDelta);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        // const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;  // if needed\r\n\r\n        // Convert date/time values to epoch timestamps\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n        let attributesArray;\r\n        if (measurementType === 'ultrasonic') {\r\n            attributesArray = [\r\n                { key: 'xPos', value: 0.5 },\r\n                { key: 'yPos', value: 0.5 },\r\n                { key: 'installationType', value: attributesStep.installationType },\r\n                { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n                { key: 'progress', value: assignmentStep.progress },\r\n                { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n                { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n                { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n                { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n                { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n                { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n                {\r\n                    key: 'area',\r\n                    value: {\r\n                        value: attributesStep.area,\r\n                        unit: attributesStep.unit,\r\n                    },\r\n                },\r\n                { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n                { key: 'dimension', value: attributesStep.dimension },\r\n                { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n                { key: 'deltaT', value: attributesStep.deltaT },\r\n                { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n                { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            ];\r\n        } else {\r\n            attributesArray = [\r\n                { key: 'xPos', value: 0.5 },\r\n                { key: 'yPos', value: 0.5 },\r\n                { key: 'progress', value: assignmentStep.progress },\r\n                { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n                { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            ];\r\n        }\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                // Save successful; update aliases and close dialog\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error while saving attributes:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b"
              },
              {
                "name": "measurement-switch-button",
                "icon": "swap_horiz",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "",
                "type": "customPretty",
                "customHtml": "<div class=\"measurement-switch-dialog\">\n    <mat-toolbar class=\"dialog-header\" color=\"primary\">\n        <div class=\"flex items-center gap-2\">\n            <mat-icon>swap_horiz</mat-icon>\n            <h2 class=\"dialog-title\">{{ 'custom.diagnostics.action.measurement-switch.title' | translate }}</h2>\n        </div>\n        <span class=\"flex-1\"></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon>close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <div class=\"dialog-content\">\n        <div *ngIf=\"loading\" class=\"loading-container\">\n            <mat-spinner diameter=\"40\"></mat-spinner>\n        </div>\n\n        <div *ngIf=\"!loading && measurements.length === 0\" class=\"empty-message\">\n            {{ 'custom.diagnostics.action.measurement-switch.no-measurements' | translate }}\n        </div>\n\n        <div *ngIf=\"!loading\" class=\"measurement-list\">\n            <div *ngFor=\"let m of measurements\"\n                 class=\"measurement-item\"\n                 [class.current]=\"m.isCurrent\"\n                 (click)=\"selectMeasurement(m)\">\n\n                <div class=\"measurement-info\">\n                    <div class=\"measurement-location\">{{ m.locationName || m.entityLabel || 'N/A' }}</div>\n                    <div class=\"measurement-name\">{{ m.entityName }}</div>\n                </div>\n\n                <div class=\"measurement-badges\">\n                    <span class=\"badge badge-type\" [ngClass]=\"'badge-' + m.measurementType\">\n                        {{ m.measurementTypeLabel }}\n                    </span>\n                    <span class=\"badge badge-progress\" [ngClass]=\"'badge-' + m.progress\">\n                        {{ m.progressLabel }}\n                    </span>\n                </div>\n\n                <mat-icon *ngIf=\"m.isCurrent\" class=\"current-indicator\">check_circle</mat-icon>\n            </div>\n        </div>\n    </div>\n</div>",
                "customCss": ".measurement-switch-dialog {\n    width: 450px;\n    max-height: 70vh;\n    display: flex;\n    flex-direction: column;\n    font-family: Roboto, sans-serif;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.dialog-header {\n    display: flex;\n    align-items: center;\n    padding: 0 8px 0 16px;\n    min-height: 52px;\n}\n\n.dialog-title {\n    margin: 0;\n    font-size: 17px;\n    font-weight: 500;\n}\n\n.dialog-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 0; /* No padding - items touch edges */\n}\n\n.loading-container {\n    display: flex;\n    justify-content: center;\n    padding: 32px;\n}\n\n.empty-message {\n    text-align: center;\n    padding: 32px 16px;\n    color: #666;\n}\n\n.measurement-list {\n    display: flex;\n    flex-direction: column;\n}\n\n.measurement-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 14px 20px;\n    cursor: pointer;\n    transition: background-color 0.15s ease;\n    border-bottom: 1px solid #f0f0f0;\n}\n\n.measurement-item:last-child {\n    border-bottom: none;\n}\n\n.measurement-item:hover {\n    background: #f5f5f5;\n}\n\n.measurement-item.current {\n    background: rgba(33, 150, 243, 0.08);\n    cursor: default;\n}\n\n.measurement-item.current:hover {\n    background: rgba(33, 150, 243, 0.08);\n}\n\n.measurement-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.measurement-location {\n    font-size: 15px;\n    font-weight: 500;\n    color: #212529;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.measurement-name {\n    font-size: 12px;\n    color: #6c757d;\n    margin-top: 2px;\n}\n\n.measurement-badges {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 4px;\n}\n\n.badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 2px 8px;\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.badge-ultrasonic {\n    background: #e8f5e9;\n    color: #2e7d32;\n}\n\n.badge-import {\n    background: #fff3e0;\n    color: #ef6c00;\n}\n\n.badge-lorawan {\n    background: #f3e5f5;\n    color: #7b1fa2;\n}\n\n.badge-progress {\n    background: #f5f5f5;\n    color: #616161;\n}\n\n.badge-in-preparation, .badge-in_preparation {\n    background: #fff8e1;\n    color: #f9a825;\n}\n\n.badge-active {\n    background: #e8f5e9;\n    color: #2e7d32;\n}\n\n.badge-finished {\n    background: #e3f2fd;\n    color: #1565c0;\n}\n\n.badge-aborted {\n    background: #ffebee;\n    color: #c62828;\n}\n\n.current-indicator {\n    color: #2196F3;\n    font-size: 20px !important;\n    width: 20px !important;\n    height: 20px !important;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nconst {\n    customDialog,\n    attributeService,\n    assetService,\n    entityRelationService,\n} = [\n    'customDialog',\n    'attributeService',\n    'assetService',\n    'entityRelationService',\n].reduce((services, name) => {\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\n    return services;\n}, {});\n\nconst currentMeasurementId = entityId;\nconst stateController = widgetContext.stateController;\n\nconst currentStateName = stateController.getStateId();\nconst isHeating = currentStateName.includes('heating');\n\nfindProjectAndMeasurements();\n\nfunction findProjectAndMeasurements() {\n    entityRelationService.findByTo(currentMeasurementId).subscribe(\n        (relations) => {\n            const projectRelations = (relations || []).filter(\n                (r) => r.from && r.from.entityType === 'ASSET'\n            );\n\n            if (projectRelations.length > 0) {\n                const projectEntityId = projectRelations[0].from;\n                findMeasurementsInProject(projectEntityId);\n            } else {\n                openDialog([]);\n            }\n        },\n        (error) => {\n            console.error('Error finding project relations:', error);\n            openDialog([]);\n        }\n    );\n}\n\nfunction findMeasurementsInProject(projectEntityId) {\n    entityRelationService.findByFrom(projectEntityId).subscribe(\n        (relations) => {\n            const measurementRelations = (relations || []).filter(\n                (r) => r.to && r.to.entityType === 'ASSET'\n            );\n\n            if (measurementRelations.length === 0) {\n                openDialog([]);\n                return;\n            }\n\n            const measurementEntityIds = measurementRelations.map(r => r.to);\n            fetchMeasurementDetails(measurementEntityIds);\n        },\n        (error) => {\n            console.error('Error finding measurements:', error);\n            openDialog([]);\n        }\n    );\n}\n\nfunction fetchMeasurementDetails(measurementEntityIds) {\n    const measurements = [];\n    let completed = 0;\n\n    measurementEntityIds.forEach((entityId) => {\n        assetService.getAsset(entityId.id).subscribe(\n            (asset) => {\n                measurements.push(asset);\n                completed++;\n                if (completed === measurementEntityIds.length) {\n                    fetchMeasurementAttributes(measurements);\n                }\n            },\n            (error) => {\n                console.error('Error fetching asset:', entityId.id, error);\n                completed++;\n                if (completed === measurementEntityIds.length) {\n                    fetchMeasurementAttributes(measurements);\n                }\n            }\n        );\n    });\n}\n\nfunction fetchMeasurementAttributes(measurements) {\n    if (!measurements || measurements.length === 0) {\n        openDialog([]);\n        return;\n    }\n\n    const attributeKeys = ['locationName', 'measurementType', 'progress'];\n    let completed = 0;\n    const measurementData = [];\n\n    measurements.forEach((m) => {\n        attributeService.getEntityAttributes(m.id, 'SERVER_SCOPE', attributeKeys).subscribe(\n            (attrs) => {\n                const attrMap = {};\n                attrs.forEach((a) => { attrMap[a.key] = a.value; });\n\n                const mType = attrMap.measurementType || '';\n                if (mType === 'import' || mType === 'ultrasonic' || mType === 'lorawan') {\n                    measurementData.push({\n                        id: m.id,\n                        entityName: m.name,\n                        entityLabel: m.label,\n                        locationName: attrMap.locationName,\n                        measurementType: mType,\n                        progress: attrMap.progress || 'in preparation',\n                        isCurrent: m.id.id === currentMeasurementId.id,\n                    });\n                }\n\n                completed++;\n                if (completed === measurements.length) {\n                    measurementData.sort((a, b) => {\n                        const aMatch = (a.entityName || '').match(/(\\d+)$/);\n                        const bMatch = (b.entityName || '').match(/(\\d+)$/);\n                        return (aMatch ? parseInt(aMatch[1]) : 0) - (bMatch ? parseInt(bMatch[1]) : 0);\n                    });\n                    openDialog(measurementData);\n                }\n            },\n            (error) => {\n                console.error('Error fetching attributes for', m.id, error);\n                completed++;\n                if (completed === measurements.length) {\n                    openDialog(measurementData);\n                }\n            }\n        );\n    });\n}\n\nfunction openDialog(measurements) {\n    customDialog.customDialog(htmlTemplate, MeasurementSwitchController, {\n        measurements,\n        currentMeasurementId,\n        isHeating,\n        stateController,\n    }).subscribe();\n}\n\nfunction MeasurementSwitchController(instance) {\n    const vm = instance;\n    const { measurements, currentMeasurementId, isHeating, stateController } = vm.data;\n\n    vm.loading = false;\n    vm.measurements = measurements.map((m) => ({\n        ...m,\n        measurementTypeLabel: getMeasurementTypeLabel(m.measurementType),\n        progressLabel: getProgressLabel(m.progress),\n    }));\n\n    function getMeasurementTypeLabel(type) {\n        const labels = {\n            'ultrasonic': 'Ultrasonic',\n            'import': 'Import',\n            'lorawan': 'LoRaWAN',\n        };\n        return labels[type] || type;\n    }\n\n    function getProgressLabel(progress) {\n        const labels = {\n            'in preparation': 'In Vorbereitung',\n            'in_preparation': 'In Vorbereitung',\n            'active': 'Aktiv',\n            'finished': 'Abgeschlossen',\n            'aborted': 'Abgebrochen',\n        };\n        return labels[progress] || progress;\n    }\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.selectMeasurement = function(measurement) {\n        if (measurement.isCurrent) {\n            return;\n        }\n\n        // Update current state params instead of pushing new state\n        const newParams = {\n            selectedMeasurement: {\n                entityId: measurement.id,\n                entityName: measurement.entityName,\n                entityLabel: measurement.entityLabel || measurement.entityName,\n            }\n        };\n\n        // Use updateState to replace params without adding to state stack\n        stateController.updateState(null, newParams);\n\n        vm.dialogRef.close(null);\n    };\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "8fcbdda7-ca12-4281-94e0-c58a93c9e6eb"
              },
              {
                "name": "analysis-button",
                "icon": "insights",
                "type": "customPretty",
                "customHtml": "<div style=\"width: 400px;\"><mat-toolbar class=\"flex items-center\" color=\"primary\"><mat-icon style=\"margin-right: 12px;\">insights</mat-icon><h2 style=\"margin: 0; font-size: 18px;\">{i18n:custom.diagnostics.analysis.title}</h2><span class=\"flex-1\"></span><button mat-icon-button (click)=\"dialogRef.close()\"><mat-icon>close</mat-icon></button></mat-toolbar><div class=\"p-4\"><p style=\"color: #666;\">{i18n:custom.diagnostics.analysis.placeholder}</p></div></div>",
                "customCss": "",
                "customFunction": "",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "314c3b24-a344-4b52-9e6b-2898869ea7fa"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "0"
        },
        "row": 0,
        "col": 0,
        "id": "6ccd99bd-8562-4e6b-e42b-e7f3c026a129"
      },
      "7a36c052-6804-1d2c-f3e9-b9ed5dac5420": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.volume-flow}",
                  "color": "#048AD3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.9892163329260306,
                  "units": "m/hr",
                  "decimals": 3,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value/1000;"
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-difference}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.20173100962836799,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "m",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.measurement.volume}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              },
              "axis1": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "right",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis1",
                "order": 1
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.volume}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "7a36c052-6804-1d2c-f3e9-b9ed5dac5420"
      },
      "3fda1b23-00b0-4999-0128-01040c961775": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-flow}",
                  "color": "#009688",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.9892163329260306,
                  "units": "C",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-return}",
                  "color": "#8BC34A",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.47698777490073074,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-difference}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.946108921429071,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.temperatures}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "3fda1b23-00b0-4999-0128-01040c961775"
      },
      "fe140916-565b-011d-3429-ac76a7b5cb55": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_Power_Cooling",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.timeseries.power.title}",
                  "color": "#009688",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.21936947652303296,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.timeseries.outside-temperature.title}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3061892804743369,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "kW",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.power.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              },
              "axis1": {
                "units": "C",
                "decimals": 1,
                "show": true,
                "label": "{i18n:unit.measures.temperature}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "right",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis1",
                "order": 1
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.cooling-power}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "fe140916-565b-011d-3429-ac76a7b5cb55"
      },
      "58b917d2-5768-b5f9-1e78-e45c9491f4f5": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "realtime": {
              "interval": 1000,
              "timewindowMs": 86400000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableFilter": true,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "Created time",
                "color": "#2196f3",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.021092237451093787,
                "funcBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758,
                "funcBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418,
                "funcBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418,
                "funcBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "Assignee",
                "color": "#9c27b0",
                "settings": {},
                "_hash": 0.5008441077416634,
                "funcBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "warning",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": false,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "600",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": false,
          "borderRadius": "0px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "58b917d2-5768-b5f9-1e78-e45c9491f4f5"
      },
      "11062bbc-f7e6-bc7a-f406-642666929251": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e23ea274-9aa0-8938-2b73-ff48762a93fc",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "${entityLabel}",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3489862002865809,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.temperatures}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "11062bbc-f7e6-bc7a-f406-642666929251"
      },
      "2ffda43e-cad2-521c-6871-338d15b3b4cc": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.projects.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": true,
            "entityNameColumnTitle": "{i18n:custom.diagnostics.project-id.title}",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": false,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.diagnostics.projects.title}",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
              "filterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "{i18n:custom.diagnostics.project-name.title}",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.23547368231999988,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-address.title}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.8348661406382081,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-progress.title}",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getProgressHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.15334267783981326,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "generalReport",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-report.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar description;\r\nvar generalReport = value;\r\nvar status;\r\nif (generalReport == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n  status = 'paid';\r\n  description = '{i18n:custom.diagnostics.report-status.paid.title}';\r\n} else {\r\n  color = '#EB5757';\r\n  status = 'inactive';\r\n  description = '{i18n:custom.diagnostics.report-status.inactive.title}';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>'+ ' ' + description;",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.47896411690699625,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Select Project",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a7ad4745-1f21-49fd-38f4-70825fe6875f"
              }
            ],
            "actionCellButton": [
              {
                "name": "Edit Project",
                "icon": "edit",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #editProjectForm=\"ngForm\" [formGroup]=\"editProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"edit-project-form\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"flex items-center\" color=\"primary\">\n    <mat-icon style=\"margin-right: 12px;\">edit</mat-icon>\n    <h2 style=\"margin: 0; font-size: 18px;\">Edit Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col gap-2 p-4\">\n    <mat-form-field appearance=\"outline\" class=\"w-full disabled-field\">\n      <mat-label>Customer</mat-label>\n      <input matInput formControlName=\"customerName\" readonly>\n    </mat-form-field>\n    <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n    <mat-form-field appearance=\"outline\" class=\"w-full disabled-field\">\n        <mat-label>Project ID</mat-label>\n        <input matInput formControlName=\"name\" readonly>\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Label</mat-label>\n        <input matInput formControlName=\"entityLabel\">\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n      <mat-label>Project address</mat-label>\n      <input matInput formControlName=\"address\" [matAutocomplete]=\"addrAuto\" autocomplete=\"off\">\n      <button mat-icon-button matSuffix type=\"button\" (click)=\"searchAddress()\" [disabled]=\"(editProjectFormGroup.get('address').value || '').length < 5\">\n        <mat-icon>search</mat-icon>\n      </button>\n      <mat-autocomplete #addrAuto=\"matAutocomplete\" [displayWith]=\"displayAddressOption\" (optionSelected)=\"onAddressSelected($event.option.value)\">\n        <mat-option *ngFor=\"let opt of addressOptions\" [value]=\"opt\">{{ opt.label }}</mat-option>\n      </mat-autocomplete>\n      <mat-hint *ngIf=\"(editProjectFormGroup.get('address').value || '').length < 5\">Enter at least 5 characters to search</mat-hint>\n    </mat-form-field>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Postal Code</mat-label>\n          <input matInput formControlName=\"postalCode\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 2;\">\n          <mat-label>City</mat-label>\n          <input matInput formControlName=\"city\">\n      </mat-form-field>\n    </div>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Latitude</mat-label>\n          <input matInput formControlName=\"latitude\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Longitude</mat-label>\n          <input matInput formControlName=\"longitude\">\n      </mat-form-field>\n    </div>\n  </div>\n  <div class=\"flex justify-end items-center gap-2 p-4\" style=\"border-top: 1px solid #e0e0e0; background: #fafafa;\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editProjectFormGroup.invalid || !editProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.edit-project-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.edit-project-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.edit-project-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.edit-project-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n.edit-project-form .disabled-field input {\n  color: rgba(0, 0, 0, 0.6) !important;\n}\n\n.edit-project-form .disabled-field {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\nmat-icon {\n    vertical-align: middle;\n    margin-right: 4px;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\n\n// Load project data and open dialog\nassetService.getAsset(entityId.id).subscribe(project => {\n    // Load project attributes\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', \n        ['latitude', 'longitude', 'address', 'postalCode', 'city', 'projectPicture']\n    ).subscribe(attributes => {\n        const attrMap = {};\n        attributes.forEach(a => { attrMap[a.key] = a.value; });\n        \n        // Load customer name\n        if (project.customerId && project.customerId.id) {\n            customerService.getCustomer(project.customerId.id).subscribe(customer => {\n                openEditProjectDialog(project, attrMap, customer ? customer.name : 'Unknown');\n            });\n        } else {\n            openEditProjectDialog(project, attrMap, 'Unknown');\n        }\n    });\n});\n\nfunction openEditProjectDialog(project, attrMap, customerName) {\n    customDialog.customDialog(htmlTemplate, EditProjectDialogController).subscribe();\n    \n    function EditProjectDialogController(instance) {\n        let vm = instance;\n        \n        vm.project = project;\n        vm.attrMap = attrMap;\n        \n        vm.editProjectFormGroup = vm.fb.group({\n            customerName: [{ value: customerName, disabled: true }],\n            name: [{ value: project.name, disabled: true }],\n            entityLabel: [project.label || ''],\n            projectPicture: [attrMap.projectPicture || null],\n            address: [attrMap.address || ''],\n            postalCode: [attrMap.postalCode || ''],\n            city: [attrMap.city || ''],\n            latitude: [attrMap.latitude || ''],\n            longitude: [attrMap.longitude || '']\n        });\n        \n        // --- Address search state ---\n        vm.addressOptions = [];\n        vm._lastSelectedAddressLabel = null;\n        \n        vm.displayAddressOption = function(opt) {\n            if (!opt) return '';\n            return (typeof opt === 'string') ? opt : (opt.label || '');\n        };\n        \n        vm.searchAddress = function() {\n            const qRaw = vm.editProjectFormGroup.get('address').value || '';\n            const q = (typeof qRaw === 'string') ? qRaw.trim() : vm.displayAddressOption(qRaw).trim();\n            if (q.length < 5) {\n                vm.addressOptions = [];\n                return;\n            }\n            searchAddressViaPhoton(q);\n        };\n        \n        vm.onAddressSelected = function(opt) {\n            if (!opt) return;\n            vm._lastSelectedAddressLabel = opt.label;\n            \n            const patchData = {\n                address: opt.label,\n                latitude: opt.lat,\n                longitude: opt.lon\n            };\n            \n            const currentPostalCode = (vm.editProjectFormGroup.get('postalCode').value || '').trim();\n            const currentCity = (vm.editProjectFormGroup.get('city').value || '').trim();\n            \n            if (!currentPostalCode && opt.postcode) {\n                patchData.postalCode = opt.postcode;\n            }\n            if (!currentCity && opt.city) {\n                patchData.city = opt.city;\n            }\n            \n            vm.editProjectFormGroup.patchValue(patchData);\n            vm.editProjectFormGroup.get('address').markAsDirty();\n            vm.editProjectFormGroup.get('latitude').markAsDirty();\n            vm.editProjectFormGroup.get('longitude').markAsDirty();\n            \n            if (!currentPostalCode && opt.postcode) {\n                vm.editProjectFormGroup.get('postalCode').markAsDirty();\n            }\n            if (!currentCity && opt.city) {\n                vm.editProjectFormGroup.get('city').markAsDirty();\n            }\n            \n            vm.addressOptions = [];\n        };\n        \n        // --- Debounced auto-search ---\n        let addrTimer = null;\n        let lastQuery = '';\n        \n        vm.editProjectFormGroup.get('address').valueChanges.subscribe(val => {\n            if (typeof val === 'string' && vm._lastSelectedAddressLabel && val === vm._lastSelectedAddressLabel) {\n                return;\n            }\n            \n            const s = (typeof val === 'string')\n                ? val.trim()\n                : (vm.displayAddressOption(val) || '').trim();\n            \n            if (s.length < 5) {\n                vm.addressOptions = [];\n                lastQuery = s;\n                if (addrTimer) {\n                    clearTimeout(addrTimer);\n                    addrTimer = null;\n                }\n                return;\n            }\n            \n            if (s === lastQuery) return;\n            lastQuery = s;\n            \n            if (addrTimer) clearTimeout(addrTimer);\n            addrTimer = setTimeout(() => {\n                searchAddressViaPhoton(s);\n            }, 350);\n        });\n        \n        function searchAddressViaPhoton(query) {\n            const postalCode = (vm.editProjectFormGroup.get('postalCode').value || '').trim();\n            const city = (vm.editProjectFormGroup.get('city').value || '').trim();\n            \n            let refinedQuery = query;\n            if (postalCode) refinedQuery += ' ' + postalCode;\n            if (city) refinedQuery += ' ' + city;\n            \n            const url = 'https://photon.komoot.io/api?q=' + encodeURIComponent(refinedQuery) + '&limit=5';\n            \n            fetch(url)\n                .then(res => {\n                    if (!res.ok) throw new Error('HTTP ' + res.status);\n                    return res.json();\n                })\n                .then(data => {\n                    const features = (data && data.features) ? data.features : [];\n                    vm.addressOptions = features.map(f => {\n                        const p = f.properties || {};\n                        const coords = (f.geometry && f.geometry.coordinates) ? f.geometry.coordinates : [null, null];\n                        const lon = coords[0];\n                        const lat = coords[1];\n                        \n                        const street = p.street || p.name || '';\n                        const house = p.housenumber ? (' ' + p.housenumber) : '';\n                        const place = (street + house).trim() || (p.label || p.name || '').trim();\n                        \n                        const cc = (p.countrycode || '').toUpperCase();\n                        const postcode = p.postcode || '';\n                        const cityFromResult = p.city || p.town || p.village || p.state || '';\n                        \n                        let tail = '';\n                        if (cc || postcode || cityFromResult) {\n                            tail = (cc ? cc : '');\n                            if (cc && postcode) tail += '-' + postcode;\n                            else if (!cc && postcode) tail += postcode;\n                            if ((cc || postcode) && cityFromResult) tail += ' ' + cityFromResult;\n                            else if (!cc && !postcode && cityFromResult) tail += cityFromResult;\n                        }\n                        \n                        const label = tail ? (place + ', ' + tail) : place;\n                        \n                        return {\n                            label,\n                            lat: (typeof lat === 'number') ? lat : parseFloat(lat),\n                            lon: (typeof lon === 'number') ? lon : parseFloat(lon),\n                            postcode: postcode,\n                            city: cityFromResult,\n                            raw: f\n                        };\n                    });\n                })\n                .catch(err => {\n                    console.error('Address search failed', err);\n                    vm.addressOptions = [];\n                });\n        }\n        \n        vm.cancel = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        vm.save = function() {\n            vm.editProjectFormGroup.markAsPristine();\n            \n            // Update asset label\n            const formValues = vm.editProjectFormGroup.getRawValue();\n            const updatedProject = {\n                ...vm.project,\n                label: formValues.entityLabel\n            };\n            \n            assetService.saveAsset(updatedProject).subscribe(() => {\n                // Save attributes\n                const attributesArray = [\n                    { key: 'latitude', value: formValues.latitude || vm.attrMap.latitude || 48.1406022 },\n                    { key: 'longitude', value: formValues.longitude || vm.attrMap.longitude || 16.2932688 },\n                    { key: 'address', value: formValues.address || '' },\n                    { key: 'postalCode', value: formValues.postalCode || '' },\n                    { key: 'city', value: formValues.city || '' }\n                ];\n                \n                if (formValues.projectPicture) {\n                    attributesArray.push({ key: 'projectPicture', value: formValues.projectPicture });\n                }\n                \n                attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', attributesArray).subscribe(() => {\n                    widgetContext.updateAliases();\n                    vm.dialogRef.close(null);\n                });\n            });\n        };\n    }\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8f12b3a-4c5d-9e7f-a1b2-3c4d5e6f7890"
              },
              {
                "name": "Project Wizard",
                "icon": "rocket_launch",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return data.progress === 'in preparation' || data.progress === 'active';",
                "type": "customPretty",
                "customHtml": "",
                "customCss": "",
                "customFunction": {
                  "body": "// Use the Project Wizard library with dataImporter for device assignment\nprojectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n    widgetContext.updateAliases();\n}, { dataImporter: dataImporter });\n",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                    "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9848fd08-5b93-6f97-dc69-65e325748065"
              }
            ],
            "headerButton": [
              {
                "name": "Connect",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "addchart",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.dataConnectorDialog(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3c824487-b796-a41c-5d9e-7eca11e18a04"
              },
              {
                "name": "Project",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"flex items-center\" color=\"primary\">\n    <mat-icon style=\"margin-right: 12px;\">folder_open</mat-icon>\n    <h2 style=\"margin: 0; font-size: 18px;\">Add Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col gap-2 p-4\">\n    <mat-form-field *ngIf=\"isTenantAdmin\" appearance=\"outline\" class=\"w-full\">\n      <mat-label>Customer</mat-label>\n      <mat-select formControlName=\"customer\" (selectionChange)=\"onCustomerChange()\" required>\n        <mat-option *ngFor=\"let c of customers\" [value]=\"c\">{{ c.name }}</mat-option>\n      </mat-select>\n      <mat-error *ngIf=\"addProjectFormGroup.get('customer')?.hasError('required')\">Customer is required.</mat-error>\n    </mat-form-field>\n    <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project ID</mat-label>\n        <input matInput formControlName=\"name\" required readonly>\n        <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">Project title is required.</mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Label</mat-label>\n        <input matInput formControlName=\"entityLabel\">\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n      <mat-label>Project address</mat-label>\n      <input matInput formControlName=\"address\" [matAutocomplete]=\"addrAuto\" autocomplete=\"off\">\n      <button mat-icon-button matSuffix type=\"button\" (click)=\"searchAddress()\" [disabled]=\"(addProjectFormGroup.get('address').value || '').length < 5\">\n        <mat-icon>search</mat-icon>\n      </button>\n      <mat-autocomplete #addrAuto=\"matAutocomplete\" [displayWith]=\"displayAddressOption\" (optionSelected)=\"onAddressSelected($event.option.value)\">\n        <mat-option *ngFor=\"let opt of addressOptions\" [value]=\"opt\">{{ opt.label }}</mat-option>\n      </mat-autocomplete>\n      <mat-hint *ngIf=\"(addProjectFormGroup.get('address').value || '').length < 5\">Enter at least 5 characters to search</mat-hint>\n    </mat-form-field>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Postal Code</mat-label>\n          <input matInput formControlName=\"postalCode\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 2;\">\n          <mat-label>City</mat-label>\n          <input matInput formControlName=\"city\">\n      </mat-form-field>\n    </div>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Latitude</mat-label>\n          <input matInput formControlName=\"latitude\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Longitude</mat-label>\n          <input matInput formControlName=\"longitude\">\n      </mat-form-field>\n    </div>\n  </div>\n  <div class=\"flex justify-end items-center gap-2 p-4\" style=\"border-top: 1px solid #e0e0e0; background: #fafafa;\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\n//let $scope = widgetContext.$scope;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\n\r\nlet shortNameAttr;\r\nlet customerShortName;\r\nlet nextProjectId = 0;\r\n\r\nconst ctx = widgetContext;\r\nconst isTenantAdmin = ctx.currentUser.authority === 'TENANT_ADMIN';\r\n\r\nlet customers = [];\r\nlet customerId;\r\nlet customerName;\r\n\r\nconst pageLink = ctx.pageLink(1000, 0, null, null, null);\r\n\r\ncustomerService.getUserCustomers(pageLink).subscribe(pageData => {\r\n\r\n    customers = (pageData && pageData.data) ? pageData.data : [];\r\n\r\n    // Non-Tenant-Admin  genau ein Customer\r\n    if (!isTenantAdmin && customers.length === 1) {\r\n        const c = customers[0];\r\n        customerId = {\r\n            id: c.id.id,\r\n            entityType: 'CUSTOMER'\r\n        };\r\n        customerName = c.name;\r\n    }\r\n\r\n    openAddProjectDialog();\r\n});\r\n\r\nfunction getLastProjectId(projects) {\r\n    let maxNumber = 0;\r\n    projects.forEach(item => {\r\n        const name = item.name;\r\n        const parts = name.split('_');\r\n        if (parts.length === 2) {\r\n            const number = parseInt(parts[1], 10);\r\n            if (number > maxNumber) {\r\n                maxNumber = number;\r\n            }\r\n        }\r\n    });\r\n    const nextProjectId = maxNumber + 1;\r\n    return nextProjectId;\r\n}\r\n\r\nfunction openAddProjectDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\r\n}\r\n\r\nfunction AddProjectDialogController(instance) {\r\n  let vm = instance;\r\n\r\n  vm.isTenantAdmin = isTenantAdmin;\r\n  vm.customers = customers;\r\n\r\nvm.addProjectFormGroup = vm.fb.group({\r\n    customer: [{ value: null, disabled: !isTenantAdmin }, vm.validators.required],\r\n    name: [{ value: '', disabled: true }, vm.validators.required],\r\n    entityLabel: [''],\r\n    projectPicture: [null],\r\n    address: [''],\r\n    postalCode: [''],\r\n    city: [''],\r\n    latitude: [''],\r\n    longitude: ['']\r\n});\r\n\r\n  // --- Address search state ---\r\n  vm.addressOptions = [];\r\n  vm._lastSelectedAddressLabel = null;\r\n\r\n  vm.displayAddressOption = function (opt) {\r\n    // MatAutocomplete calls displayWith with object OR string\r\n    if (!opt) return '';\r\n    return (typeof opt === 'string') ? opt : (opt.label || '');\r\n  };\r\n\r\n  vm.searchAddress = function () {\r\n    const qRaw = vm.addProjectFormGroup.get('address').value || '';\r\n    const q = (typeof qRaw === 'string') ? qRaw.trim() : vm.displayAddressOption(qRaw).trim();\r\n\r\n    if (q.length < 5) {\r\n      vm.addressOptions = [];\r\n      return;\r\n    }\r\n\r\n    searchAddressViaPhoton(q);\r\n  };\r\n\r\n  vm.onAddressSelected = function (opt) {\r\n    if (!opt) return;\r\n\r\n    vm._lastSelectedAddressLabel = opt.label;\r\n\r\n    // Patch-Objekt vorbereiten\r\n    const patchData = {\r\n      address: opt.label,\r\n      latitude: opt.lat,\r\n      longitude: opt.lon\r\n    };\r\n\r\n    // Nur postalCode und city setzen, wenn sie im Formular NICHT bereits ausgefllt sind\r\n    const currentPostalCode = (vm.addProjectFormGroup.get('postalCode').value || '').trim();\r\n    const currentCity = (vm.addProjectFormGroup.get('city').value || '').trim();\r\n\r\n    if (!currentPostalCode && opt.postcode) {\r\n      patchData.postalCode = opt.postcode;\r\n    }\r\n    if (!currentCity && opt.city) {\r\n      patchData.city = opt.city;\r\n    }\r\n\r\n    vm.addProjectFormGroup.patchValue(patchData);\r\n\r\n    vm.addProjectFormGroup.get('address').markAsDirty();\r\n    vm.addProjectFormGroup.get('latitude').markAsDirty();\r\n    vm.addProjectFormGroup.get('longitude').markAsDirty();\r\n\r\n    if (!currentPostalCode && opt.postcode) {\r\n      vm.addProjectFormGroup.get('postalCode').markAsDirty();\r\n    }\r\n    if (!currentCity && opt.city) {\r\n      vm.addProjectFormGroup.get('city').markAsDirty();\r\n    }\r\n\r\n    // optional: Ergebnisse leeren, damit Dropdown zugeht\r\n    vm.addressOptions = [];\r\n  };\r\n\r\n  // --- Debounced auto-search without rxjs operators ---\r\n  let addrTimer = null;\r\n  let lastQuery = '';\r\n\r\n  vm.addProjectFormGroup.get('address').valueChanges.subscribe(val => {\r\n    // Wenn eine Auswahl gerade gesetzt wurde, nicht sofort neu suchen\r\n    if (typeof val === 'string' && vm._lastSelectedAddressLabel && val === vm._lastSelectedAddressLabel) {\r\n      return;\r\n    }\r\n\r\n    const s = (typeof val === 'string')\r\n      ? val.trim()\r\n      : (vm.displayAddressOption(val) || '').trim();\r\n\r\n    // Reset results for short strings\r\n    if (s.length < 5) {\r\n      vm.addressOptions = [];\r\n      lastQuery = s;\r\n      if (addrTimer) {\r\n        clearTimeout(addrTimer);\r\n        addrTimer = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Simple distinctUntilChanged\r\n    if (s === lastQuery) {\r\n      return;\r\n    }\r\n    lastQuery = s;\r\n\r\n    // Debounce\r\n    if (addrTimer) {\r\n      clearTimeout(addrTimer);\r\n    }\r\n    addrTimer = setTimeout(() => {\r\n      searchAddressViaPhoton(s);\r\n    }, 350);\r\n  });\r\n\r\n\r\n  function searchAddressViaPhoton(query) {\r\n    // Hole postalCode und city aus dem Formular\r\n    const postalCode = (vm.addProjectFormGroup.get('postalCode').value || '').trim();\r\n    const city = (vm.addProjectFormGroup.get('city').value || '').trim();\r\n\r\n    // Verfeinerte Query erstellen\r\n    let refinedQuery = query;\r\n    if (postalCode) {\r\n      refinedQuery += ' ' + postalCode;\r\n    }\r\n    if (city) {\r\n      refinedQuery += ' ' + city;\r\n    }\r\n\r\n    const url =\r\n      'https://photon.komoot.io/api' +\r\n      '?q=' + encodeURIComponent(refinedQuery) +\r\n      '&limit=5';\r\n\r\n    fetch(url)\r\n      .then(res => {\r\n        if (!res.ok) throw new Error('HTTP ' + res.status);\r\n        return res.json();\r\n      })\r\n      .then(data => {\r\n        const features = (data && data.features) ? data.features : [];\r\n\r\n        vm.addressOptions = features.map(f => {\r\n          const p = f.properties || {};\r\n          const coords = (f.geometry && f.geometry.coordinates) ? f.geometry.coordinates : [null, null];\r\n          const lon = coords[0];\r\n          const lat = coords[1];\r\n\r\n          // Bausteine\r\n          const street = p.street || p.name || '';\r\n          const house = p.housenumber ? (' ' + p.housenumber) : '';\r\n          const place = (street + house).trim() || (p.label || p.name || '').trim();\r\n\r\n          const cc = (p.countrycode || '').toUpperCase();\r\n          const postcode = p.postcode || '';\r\n          const cityFromResult = p.city || p.town || p.village || p.state || '';\r\n\r\n          // Ziel-Format: \"Adresse, CC-PLZ Ort\"\r\n          let tail = '';\r\n          if (cc || postcode || cityFromResult) {\r\n            tail = (cc ? cc : '');\r\n            if (cc && postcode) tail += '-' + postcode;\r\n            else if (!cc && postcode) tail += postcode;\r\n            if ((cc || postcode) && cityFromResult) tail += ' ' + cityFromResult;\r\n            else if (!cc && !postcode && cityFromResult) tail += cityFromResult;\r\n          }\r\n\r\n          const label = tail ? (place + ', ' + tail) : place;\r\n\r\n          return {\r\n            label,\r\n            lat: (typeof lat === 'number') ? lat : parseFloat(lat),\r\n            lon: (typeof lon === 'number') ? lon : parseFloat(lon),\r\n            postcode: postcode,\r\n            city: cityFromResult,\r\n            raw: f\r\n          };\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.error('Address search failed', err);\r\n        vm.addressOptions = [];\r\n      });\r\n  }\r\n\r\n\r\n  \r\nif (!isTenantAdmin && customerId) {\r\n    vm.addProjectFormGroup.patchValue({\r\n        customer: customers[0]\r\n    });\r\n    vm.addProjectFormGroup.get('customer').markAsDirty();\r\n    loadCustomerData(customerId);\r\n}\r\n\r\n  \r\nvm.onCustomerChange = function () {\r\n    const c = vm.addProjectFormGroup.value.customer;\r\n    if (!c) return;\r\n\r\n    customerId = {\r\n        id: c.id.id,\r\n        entityType: 'CUSTOMER'\r\n    };\r\n    customerName = c.name;\r\n\r\n    loadCustomerData(customerId);\r\n};\r\n\r\n  \r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n  \r\n  vm.save = function () {\r\n    vm.addProjectFormGroup.markAsPristine();\r\n    saveProjectObservable(customerId).subscribe(\r\n      function (Project) {\r\n          widgetContext.rxjs.forkJoin([\r\n              saveCustomerToProjectRelation(customerId, Project.id),\r\n              saveAttributes(Project.id)\r\n          ]).subscribe(\r\n              function () {\r\n                var params = widgetContext.stateController.getStateParams();\r\n                var selectedProject = params['selectedProject'];\r\n                params['selectedProject'] = { entityId: Project.id, entityName: Project.name, entityLabel: '' };\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n              }\r\n        );\r\n      }\r\n    );\r\n  };\r\n  \r\nfunction loadCustomerData(customerId) {\r\n\r\n    let assetSearchQuery = {\r\n        parameters: {\r\n            rootId: customerId.id,\r\n            rootType: 'CUSTOMER',\r\n            direction: 'FROM',\r\n            relationTypeGroup: 'COMMON',\r\n            maxLevel: 10,\r\n            fetchLastLevelOnly: false\r\n        },\r\n        relationType: 'Owns',\r\n        assetTypes: ['Project']\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(projects => {\r\n\r\n        nextProjectId = getLastProjectId(projects);\r\n\r\n        attributeService\r\n            .getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName'])\r\n            .subscribe(attributes => {\r\n\r\n                const shortNameAttr = attributes.find(a => a.key === 'shortName');\r\n                customerShortName = shortNameAttr\r\n                    ? shortNameAttr.value\r\n                    : customerName;\r\n\r\n                vm.addProjectFormGroup.patchValue({\r\n                    name: customerShortName + '_' + nextProjectId\r\n                });\r\n\r\n                vm.addProjectFormGroup.get('name').markAsDirty();\r\n            });\r\n    });\r\n}\r\n\r\n  function saveProjectObservable(customerId) {\r\n    return getProjectsGroup(customerId).pipe(\r\n        widgetContext.rxjs.switchMap((ProjectsGroup) => {\r\n            const formValues = vm.addProjectFormGroup.getRawValue();\r\n            let Project = {\r\n              name: formValues.name,\r\n              type: 'Project',\r\n              label: formValues.entityLabel,\r\n              customerId: customerId\r\n            };\r\n            return assetService.saveAsset(Project, ProjectsGroup.id.id)\r\n        })\r\n    );\r\n  }\r\n  \r\n  function getProjectsGroup(customerId) {\r\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\r\n          widgetContext.rxjs.switchMap((entityGroups) => {\r\n              var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\r\n              if (ProjectsGroup) {\r\n                  return widgetContext.rxjs.of(ProjectsGroup);\r\n              } else {\r\n                  ProjectsGroup = {\r\n                      type: 'ASSET',\r\n                      name: 'Projects',\r\n                      ownerId: customerId\r\n                  };\r\n                  return entityGroupService.saveEntityGroup(ProjectsGroup);\r\n              }\r\n          })\r\n      );\r\n  }\r\n\r\n  function saveCustomerToProjectRelation(customerId, ProjectId) {\r\n      var relation = {\r\n          from: customerId,\r\n          to: ProjectId,\r\n          typeGroup: 'COMMON',\r\n          type: 'Owns'\r\n      };\r\n      return entityRelationService.saveRelation(relation);\r\n  }\r\n  \r\n  function saveAttributes(entityId) {\r\n    let attributesArray = [\r\n        {\r\n            key: 'latitude',\r\n            value: vm.addProjectFormGroup.value.latitude || 48.1406022\r\n        },\r\n        {\r\n            key: 'longitude',\r\n            value: vm.addProjectFormGroup.value.longitude || 16.2932688\r\n        },\r\n        {\r\n            key: 'address',\r\n            value: vm.addProjectFormGroup.value.address\r\n        },        \r\n        {\r\n            key: 'progress',\r\n            value: 'in preparation'\r\n        },\r\n        {\n            key: 'units',\n            value: 'metric'\n        }\n    ];\n    // Add projectPicture if provided\n    if (vm.addProjectFormGroup.value.projectPicture) {\n        attributesArray.push({\n            key: 'projectPicture',\n            value: vm.addProjectFormGroup.value.projectPicture\n        });\n    }\r\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n  }\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2c6e09e8-98b9-f1ca-0a64-7cce095767a2"
              }
            ],
            "rowDoubleClick": []
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "pageSize": 1024,
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "titleIcon": null,
          "iconColor": null,
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "2ffda43e-cad2-521c-6871-338d15b3b4cc",
        "typeFullFqn": "system.cards.entities_table"
      },
      "b84de4e1-8a84-b5cc-6b10-19292fefbb45": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8057369620518648
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.49953012506084726
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.21088975870489435
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5157976480659352
                },
                {
                  "name": "batteryLevel",
                  "type": "timeseries",
                  "label": "batteryLevel",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.1659349558331873
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.20684451568213258,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.5554495301365088
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.821480189837247
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.31692184501390863
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.14141450952611212
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": {
              "body": "var name, label, type, state, active, progress, locationName, installationType, installation, measurementType, address;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    locationName = data[0]['locationName'];\n    installationType = data[0]['installationType'];\n    type = data[0]['Type'];\n    state = data[0]['state'];\n    active = data[0]['active'];\n    progress = data[0]['progress'];\n    measurementType = data[0]['measurementType'];\n    address = data[0]['address'];\n    if (active === 'false') {\n        state = 'disconnected';\n    }\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    state = 'N/A';\n    progress = 'N/A';\n    locationName = 'N/A';\n    installationType = 'N/A';\n    active = 'N/A';\n    measurementType ='N/A';\n}\n\n/*if (installationType === 'heating') {\n    installation = '<mat-icon>local_fire_department</mat-icon>Heating';\n} else if (installationType === 'cooling') {\n    installation = '<mat-icon>ac_unit</mat-icon>Cooling';\n} else {\n    installation = '<mat-icon>question_mark</mat-icon>N/A';\n}*/\n\nif (installationType === 'heating') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: red;\">local_fire_department</mat-icon><span style=\"margin-left: 8px;\">Heating</span></div>';\n} else if (installationType === 'cooling') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: blue;\">ac_unit</mat-icon><span style=\"margin-left: 8px;\">Cooling</span></div>';\n} else {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon>question_mark</mat-icon><span style=\"margin-left: 8px;\">N/A</span></div>';\n}\n\nvar header = '<div class=\"header flex flex-row justify-start items-stretch gap-2\">' +\n                // Zurck-Button\n                /*'<div class=\"flex flex-col justify-center items-center\">' +\n                  '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\n                    '<mat-icon>arrow_back</mat-icon>' +\n                  '</button>' +\n                '</div>' +\n                // Titel und Untertitel\n                '<div class=\"flex-1 flex flex-col justify-center items-center\">' +\n                  '<div class=\"title\">' + locationName + '</div>' +\n                  '<div class=\"subtitle\">' + name + '</div>' +\n                '</div>' +*/\n                // Container fr die beiden Buttons\n                '<div class=\"flex flex-row justify-center items-center gap-2\">' +\n                  // Parameter-Button\n                  '<button id=\"measurement-parameters\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                    '<span>Parameters</span>' +\n                  '</button>' +\n                  // Sensors-Button\n                  '<button id=\"sensor-data\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">sensors</mat-icon>' +\n                    '<span>Sensor Data</span>' +\n                  '</button>' +\n                  // Details-Button\n                  '<button id=\"details-full\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\n                    '<span>Details</span>' +\n                  '</button>' +\n                '</div>' +\n             '</div>';\n\n\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">'\n  /* +    header + */\n  +   '<div class=\"params flex flex-row gap-2\">'\n  +     '<div class=\"param-cell flex-1 flex flex-col gap-2\">'\n  +       '<div class=\"param-title\">{i18n:custom.diagnostics.project-name.title}</div>'\n  +       '<div class=\"param\">' + label + '</div>'\n  +     '</div>'\n  +     '<div class=\"param-cell flex-1 flex flex-col gap-2\">'\n  +       '<div class=\"param-title\">{i18n:custom.diagnostics.project-address.title}</div>'\n  +       '<div class=\"param\">' + address + '</div>'\n  +     '</div>'\n  +     '<div class=\"param-cell flex-1 flex flex-col gap-2\">'\n  +       '<div class=\"param-title\">{i18n:custom.diagnostics.project-progress.title}</div>'\n  +       '<div class=\"param\">' + utils.getProgressHtml(progress) + '</div>'\n  +     '</div>'\n  +   '</div>'\n  + '</div>';\n",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js",
                "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".main-layout .header {\n    height: 60px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 0 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "5392aff0-5ef7-11ef-a314-81782f443b0c",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "37e5e007-da10-e64c-be1e-899094481e42"
              },
              {
                "name": "settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#settings', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getSettingsState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '400px', getSettingsHeight(type));\n\nfunction getSettingsState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_settings';\n        case 'Room Sensor T':            \n            return 'roomsensort_settings';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_settings';                      \n        case 'Door Sensor':\n            return 'door_settings';\n        case 'Motion Sensor':\n            return 'motion_sensor_settings';\n        case 'Occupancy Sensor':\n            return 'occupancy_sensor_settings';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getSettingsHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '800px';\n        case 'Room Sensor T':            \n            return '600px';\n        case 'Room Sensor CO2':            \n            return '800px';                  \n        case 'Door Sensor':\n            return '500px';\n        case 'Motion Sensor':\n            return '340px';\n        case 'Occupancy Sensor':\n            return '500px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "076da598-f2dc-6fda-6744-db268a4c6df7"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery_level_details",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "44417062-4a4f-0479-0042-93952e15436a"
              },
              {
                "name": "details-full",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1532b4d5-2d3c-872e-57ed-d477f9b2e502"
              },
              {
                "name": "details-day",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#details-day', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_details_full';\n        case 'Room Sensor T':            \n            return 'roomsensort_details_full';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_details_full';                      \n        case 'Door Sensor':\n            return 'door_details_full';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_fulls';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':            \n            return '1000px';\n        case 'Room Sensor CO2':            \n            return '1000px';                  \n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1831fd41-86a5-53ac-1e1b-ab4f23f60807"
              },
              {
                "name": "measurement-parameters",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "modules": {
                  "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                },
                "customFunction": "const measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error('No measurement selected');\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a066a7c4-4bbb-d780-315e-af760f5b1e4e"
              },
              {
                "name": "sensor-data",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "301c8f82-5367-e4eb-a578-ca81965b5e9a"
              }
            ],
            "headerButton": []
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "b84de4e1-8a84-b5cc-6b10-19292fefbb45",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "678a80b3-1380-cdd2-495f-1701acde66c1": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
              "dataKeys": [
                {
                  "name": "title",
                  "type": "entityField",
                  "label": "Title",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.6231912076992963
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.03179212116453134
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.8801358300155324
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#EEEEEE",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "// 20.03.2025 DOJ\nvar params = ctx.stateController.getStateParams();\n\nvar criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\n\nvar criticalClass = (criticalCount && Number(criticalCount) > 0) ? 'critical' : 'inactive';\nvar majorClass    = (majorCount && Number(majorCount) > 0) ? 'major' : 'inactive';\n\nvar userRole = data[1].role;\nparams['userRole'] = userRole;\nctx.stateController.updateState(null,params);\n\nvar locationName;\nif (data && data.length) {\n    locationName = data[0]['entityName'] || 'N/A';\n} else {\n    locationName = 'N/A';\n}\n\n// Conditionally build the Projects button HTML\nvar projectsButtonHtml = '';\n/*if (userRole === \"Belimo Retrofit Engineers\") {\n    projectsButtonHtml =\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>Projects</span>' +\n        '</button>';\n}*/ if (userRole === \"Belimo Retrofit Engineer\") {\n    projectsButtonHtml =\n        /*'<button id=\"admin-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">admin_panel_settings</mat-icon>' +\n            '<span>Admin</span>' +\n        '</button>' +*/\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n        '</button>';\n} else if (userRole !== \"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\") {\n    projectsButtonHtml =\n        '<button id=\"admin-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">admin_panel_settings</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.admin-btn.title}</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n        '</button>';\n}\n\nconst header =\n  '<div class=\"header flex flex-row justify-between items-stretch\" style=\"margin:0;\">' +\n\n    '<div class=\"flex-none basis-[15%] flex flex-col items-center pl-[5px]\">' +\n      '<div class=\"title\" style=\"font-weight:550; font-size: 1.4em;\">' +\n        locationName +\n      '</div>' +\n    '</div>' +\n\n    '<div class=\"flex items-center pr-[5px]\">' +\n      projectsButtonHtml +\n/*      '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\" class=\"flex items-center\">' +\n        '<mat-icon class=\"tb-mat-18 mr-1\">assessment</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.reports-btn.title}</span>' +\n      '</button>' +*/\n    '</div>' +\n\n  '</div>';\n\n\n\n/*var header =\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between stretch\" fxLayoutGap=\"8px\" style=\"margin: 0px;\">' +\n      \n      '<div fxFlex=\"15\" fxLayout=\"column\" fxLayoutAlign=\"center\" style=\"padding-left: 5px;\" >' + // Reduced fxFlex from 40 to 20\n          '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' + // Reduce font size for title\n        '</div>' +\n\n      '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"8px\" style=\"padding-right: 5px;\">' +\n        projectsButtonHtml +\n        '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n          '<span>Reports</span>' +\n        '</button>' +\n      '</div>' +\n      \n    '</div>';*/\n\n/*return '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        header + \n            '<div id=\"home-dashboard\" style=\"width: 100%; height: 100%; margin-top: 10px;\">'+\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"home_dashboard_widgets\"></tb-dashboard-state>'+\n            '</div>'+\n        '</div>';*/\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">'\n/*  +   header*/\n  +   '<div id=\"home-dashboard\" class=\"w-full h-full\" style=\"width: 100%; height: 100%;\">'\n  +     '<tb-dashboard-state '\n  +       'class=\"flex-1\" '\n  +       '[ctx]=\"ctx\" '\n  +       '[syncParentStateParams]=\"true\" '\n  +       'stateId=\"home_dashboard_widgets\">'\n  +     '</tb-dashboard-state>'\n  +   '</div>'\n  + '</div>';\n\n\n\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n/*.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} */\n\n.header {\n    height: 60px;                    /* Fixed height for medium screens */\n    display: flex;                   /* Use Flexbox for layout */\n    align-items: center;             /* Vertically center content */\n    justify-content: space-between;  /* Space items evenly horizontally */\n    padding: 0 20px;                 /* Horizontal padding only */\n    box-sizing: border-box;          /* Include padding in height */\n}\n\n/* Small screens: up to 600px wide */\n@media (max-width: 600px) {\n    .main-layout .header {\n        height: 50px;   /* Smaller height for small screens */\n        padding: 0 10px; /* Reduced horizontal padding */\n    }\n}\n\n/* Medium screens: 601px to 1024px */\n@media (min-width: 601px) and (max-width: 1024px) {\n    .main-layout .header {\n        height: 60px;    /* Default height */\n        padding: 0 15px; /* Adjust padding if needed */\n    }\n}\n\n/* Large screens: 1025px and above */\n@media (min-width: 1025px) {\n    .main-layout .header {\n        height: 70px;   /* Increased height for larger screens */\n        padding: 0 20px; /* Maintain horizontal padding */\n    }\n}\n\n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #report-button, #reports-button, #admin-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#admin-button  {\n    background-color: red; /* Setzt die Hintergrundfarbe der Buttons */\n}\n\n#admin-button:hover  {\n    background-color: #FA6B6B; /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #report-button:hover, #reports-button:hover  {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon, #admin-button mat-icon  {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#projects-button span, #report-button span, #reports-button span, #admin-button span  {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>{i18n:custom.diagnostics.action.edit-measurement-parameters.title}</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <!--<mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>-->\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>{i18n:custom.diagnostics.measurement-progress.title}</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">{i18n:custom.diagnostics.state-filter.preparation.title}</mat-option>\r\n            <mat-option value=\"active\">{i18n:custom.diagnostics.state-filter.active.title}</mat-option>\r\n            <mat-option value=\"finished\">{i18n:custom.diagnostics.state-filter.finished.title}</mat-option>\r\n            <mat-option value=\"aborted\">{i18n:custom.diagnostics.state-filter.aborted.title}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.start-date.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.start-time.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.end-date.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.end-time.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{i18n:custom.diagnostics.action.cancel.title}</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedPFlowAvailable\">{i18n:custom.diagnostics.action.next.title}</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.dimension.title}</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                {i18n:custom.diagnostics.action.edit-measurement-parameters.dimension.error}\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.nominal-flow.title}</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-mearuement-parameters.floor-volume.title}</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.pump-power.title}</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\n/*function fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}*/\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n/*    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }*/\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes('No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b"
              },
              {
                "name": "admin-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "27a13540-f6e7-11f0-9979-9f3434877bb4",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e63ea2ea-53c8-1e57-c98b-a33fc883593f"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "678a80b3-1380-cdd2-495f-1701acde66c1"
      },
      "dc35f902-3824-8f1b-a870-fee55664d0bd": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout flex size-full flex-col\" style=\"padding:0; height:100%;\">\n  <!-- Block A - nur sichtbar, wenn KEIN Projekt gewhlt ist -->\n<!--  <div *ngIf=\"!ctx.stateController.getStateParams().selectedProject\" class=\"flex flex-col\" style=\"width:100%; height:100px;\">\n    <h5 class=\"market-title\">{i18n:custom.diagnostics.projects.title}</h5>\n    <tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" stateId=\"Measurement_state_filter\"> </tb-dashboard-state>\n  </div>-->\n  <!-- Block B - nur sichtbar, wenn EIN Projekt gewhlt ist -->\n  <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedProject\" style=\"height:100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"project_card_header\"></tb-dashboard-state>\n  <!-- Map container - switches between projects_map and selected_project_map -->\n  <div class=\"flex flex-1 flex-col\" style=\"position: relative;\">\n    <tb-dashboard-state \n      class=\"flex-1\" \n      [ctx]=\"ctx\" \n      [syncParentStateParams]=\"true\" \n      [stateId]=\"ctx.stateController.getStateParams().selectedProject ? 'selected_project_map' : 'projects_map'\">\n    </tb-dashboard-state>\n  </div>\n</div>",
            "markdownTextFunction": "// Zugriff auf State-Parameter und Initialisierung des HTML-Strings\r\nvar stateParams = ctx.stateController.getStateParams();\r\nvar selectedProject = stateParams ? stateParams.selectedProject : null;\r\nvar html = '<div style=\"display:flex; flex-direction:column; height:100%;\">';\r\n\r\n// Fall 1: Kein Projekt ausgewhlt\r\nif (!selectedProject) {\r\n    html += '<div style=\"height:170px; display:flex; flex-direction:column;\">';\r\n    html += '<h3>Projects</h3>';\r\n    html += '<h4>State filter</h4>';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"Measurement_state_filter\"></tb-dashboard-state>';\r\n    html += '<hr>';\r\n    html += '</div>';\r\n    // Unterer Bereich fllt den restlichen Platz (flex:1)\r\n    html += '<div style=\"flex:1;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"projects_map\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n\r\n// Fall 2: Ein Projekt ist ausgewhlt\r\n} else {\r\n    html += '<div style=\"height:170px;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"project_card_header\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n    // Unterer Bereich fllt den restlichen Platz\r\n    html += '<div style=\"flex:1;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"projects_map\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n}\r\n\r\n// Abschlieender div-Tag und Rckgabe des HTML-Strings\r\nhtml += '</div>';\r\nreturn html;",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n.state-filter-title {\n    padding-bottom: 15px;\n    padding-left: 10px;\n}\n\n.market-layout .alarm-badges-layout {\n    position: absolute;\n    height: 50px;\n    top: 0;\n    left: 0;\n    right: 0;\n    z-index: 2;\n    display: flex;\n    justify-content: center;\n    pointer-events: none;\n}\n\n.market-layout .alarm-badges-layout .alarm-badges {\n    height: 50px;\n    width: 350px;\n    pointer-events: all;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 4px !important;\n    margin-bottom: 4px !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mdc-form-field > label {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "borderRadius": "8"
        },
        "row": 0,
        "col": 0,
        "id": "dc35f902-3824-8f1b-a870-fee55664d0bd",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "b2beb7ce-103a-560f-cf9c-b7df21827bf0": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8853142583803868
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8167362021349891
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\n    <section *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex fxLayout=\"column\">\n\t<h5 class=\"market-title\">{{ ctx.stateController.getStateParams().selectedDoktorkit.entityName }}</h5>\n\t<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_card\"></tb-dashboard-state>\n    </section>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" stateId=\"Doktorkits_card\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>\n    <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkit_alarms\"></tb-dashboard-state>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"false\" stateId=\"Doktorkits_alarms\"></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "var projectState = ctx.stateController.getStateParams().selectedProject ? true : false;\r\n\r\nvar stateParams = ctx.stateController.getStateParams();\r\n\r\nctx.stateController.updateState(null, stateParams);\r\n\r\nvar newDashboardtimewindow = {\r\n    aggregation: {\r\n        limit: 50000,\r\n        type: \"NONE\"\r\n    },\r\n    hideAggInterval: true,\r\n    hideAggregation: true,\r\n    hideInterval: false,\r\n    history: {\r\n        historyType: 1,\r\n        fixedTimewindow: {\r\n            startTimeMs: Date.now() - 1209600000, // now - 2 weeks\r\n            endTimeMs: Date.now()\r\n        }\r\n    },\r\n    selectedTab: 1\r\n};\r\n\r\nvar userRole = data[0].role;\r\n\r\nvar stateParams = ctx.stateController.getStateParams();\r\nvar currentUser = ctx.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator';\r\nstateParams[\"userRole\"] = userRole;\r\n/*console.log(\"par:\", stateParams);*/\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, stateParams);\r\n\r\nvar typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-480q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v480q0 33-23.5 56.5T800-80H160Zm240-640h160v-80H400v80Zm40 360v120h80v-120h120v-80H520v-120h-80v120H320v80h120Z\"/></svg>';\r\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\r\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\r\n\r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n          (projectState \r\n            ? ( '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Measurements_card\"></tb-dashboard-state>' )\r\n            : ( '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"all_projects\"></tb-dashboard-state>' )) + \r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow.no-padding {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 4px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "{i18n:action.go-back}",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedMeasurement'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "borderRadius": "8"
        },
        "row": 0,
        "col": 0,
        "id": "b2beb7ce-103a-560f-cf9c-b7df21827bf0",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "0ff674a9-4e70-3742-720a-e681566c9b4f": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
              "filterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "latitude",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.862061599769905
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "longitude",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.017864596400994026
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.652632058135977
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.35182491461913457
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.2357170844737564
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.7555775294467035
                },
                {
                  "name": "outsideHumidity",
                  "type": "timeseries",
                  "label": "outsideHumidity",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.7038818406636014
                },
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "outsideTemp",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.3584981742251683
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "attribute",
                  "label": "majorAlarmsCount",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.2457539608057584
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "attribute",
                  "label": "criticalAlarmsCount",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.362993982508079
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "attribute",
                  "label": "minorAlarmsCount",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.11733799988993221
                },
                {
                  "name": "warningAlarmsCount",
                  "type": "attribute",
                  "label": "warningAlarmsCount",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.6269991260047776
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.9172342215995071
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "name",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.5180855877351238,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "label",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.8758870297077328,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.8815810998227034
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "selectedProject",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5292772206260663,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return true;\n} else {\n    return false;\n}",
                  "aggregationType": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "CartoDB.Positron",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": false,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "",
            "imageUrlAttribute": "",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 14,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": false,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${locationName}",
            "labelFunction": null,
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": true,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}",
            "tooltipFunction": "const temperature = data.outsideTemp;\nconst humidity = data.outsideHumidity;\nconst pressure = data.pressure;\nconst longitude = data.longitude;\nconst latitude = data.latitude;\nvar locationName = data.locationName || 'N/A';\nconst installationType = data.installationType;\nconst address = data.address;\nconst name = data.name;\nconst label = data.label;\n\nconst userRole = dsData[dsData.length - 1].role;\n\n// Alarms\nconst state = data.state;\nconst progress = data.progress;\nconst criticalAlarms = data.criticalAlarmsCount || 'N/A';\nconst majorAlarms = data.majorAlarmsCount || 'N/A';\nconst minorAlarms = data.minorAlarmsCount || 'N/A';\nconst warningAlarms = data.warningAlarmsCount || 'N/A';\n\n// Farben fr Alarms\nconst criticalAlarmsColor = '#FF0000'; // Rot\nconst criticalAlarmsBgColor =\n'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\n\nconst majorAlarmsColor = '#FF8C00'; // Orange\nconst majorAlarmsBgColor =\n'rgba(255, 140, 0, 0.1)'; // Transparenter Orange\n\nconst minorAlarmsColor = '#FFD700'; // Gold\nconst minorAlarmsBgColor =\n'rgba(255, 215, 0, 0.1)'; // Transparenter Gold\n\nconst warningAlarmsColor = '#000000'; // Schwarz\nconst warningAlarmsBgColor =\n'rgba(128, 128, 128, 0.1)'; // Transparenter Grau\n\nvar ButtonHtml = '';\nif (userRole !== \"Belimo Retrofit Users\") {\n    ButtonHtml = '<div style=\"text-align: center\">' +\n        '<link-act name=\"all_measurements\">Edit Measurements</link-act>' +\n        '</div>';\n}\n/*console.log(ButtonHtml);*/\n\nif (locationName === 'N/A') {\n    locationName = label;\n}\n\nreturn '<div style=\"display:flex;flex-direction:column;margin-bottom:8px;font-family:\\'Roboto\\';font-weight:500;font-size:16px;line-height:24px;letter-spacing:0.25px;color:#29313C\">' +\n    '<div>' + locationName + ' | ' + name + '</div>' +\n    '<div style=\"width: 100%;border-bottom:1px solid rgba(0, 0, 0, 0.12);margin:12px 0;\"></div>' +\n\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Address</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    address + '</div>' +\n    '</div>' +\n/*    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Critical Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    criticalAlarmsColor + ';background-color:' +\n    criticalAlarmsBgColor + '\">' + criticalAlarms +\n    '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Major Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    majorAlarmsColor + ';background-color:' +\n    majorAlarmsBgColor + '\">' + majorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Minor Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    minorAlarmsColor + ';background-color:' +\n    minorAlarmsBgColor + '\">' + minorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Warning Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    warningAlarmsColor + ';background-color:' +\n    warningAlarmsBgColor + '\">' + warningAlarms + '</div>' +\n    '</div>' +*/\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Temperature</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    temperature + ' C</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Humidity</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    humidity + ' % r.H.</div>' +\n    '</div>' +\n    projectWizardButtonHtml +\n    ButtonHtml +\n    '</div>';",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var progress = data['progress'];\r\nvar selectedProject = data['selectedProject'] === true;\r\nvar selectedMode = dsData.filter(function(data) { return data['selectedProject'] === true; }).length > 0;\r\n\r\nvar width = 30;\r\nvar svgStr = getDoktorkitSvg(progress, width, selectedProject);\r\nvar encodedSvg = encodeURIComponent(svgStr);\r\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\r\nif (selectedProject) {\r\n  width += 8;\r\n}\r\nreturn {\r\n  url: svgUrl,\r\n  size: width,\r\n  markerOffset: [width / 2, width / 2],\r\n  tooltipOffset: [width * 0.5 - width / 2, -(width / 2)]\r\n};\r\n\r\nfunction getDoktorkitSvg(progress, width, isSelected) {\r\n    var color = getBackgroundColor(progress);\r\n    var background = getBackground(color);\r\n    var svgSize = isSelected ? (width + 8) : width;\r\n    var opacity = selectedMode && !isSelected ? 0.4 : 1;\r\n\r\n    // Home-Icon SVG (zentriert und skaliert)\r\n    var shape = '<g transform=\"translate(10,10) scale(0.8)\">' +\r\n                '<path d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\" fill=\"white\"/>' +\r\n                '</g>';\r\n\r\n    var projectSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgSize + '\" height=\"' + svgSize + '\" viewBox=\"0 0 46 46\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\r\n                     wrapIfSelected(background + shape, isSelected);\r\n    if (isSelected) {\r\n        projectSvg += getProjectSelectionStroke();\r\n    }\r\n    projectSvg += '</svg>';\r\n    return projectSvg;\r\n}\r\n\r\nfunction wrapIfSelected(svg, isSelected) {\r\n    if (isSelected) {\r\n        return '<g transform=\"translate(4,4)\">' + svg + '</g>';\r\n    } else {\r\n        return svg;\r\n    }\r\n}\r\n\r\n// Hintergrundkreis genau mittig\r\nfunction getBackground(color) {\r\n    return '<circle cx=\"19\" cy=\"19\" r=\"15\" fill=\"'+ color +'\"/>';\r\n}\r\n\r\n// Selektionsring exakt um den Hintergrundkreis herum\r\nfunction getProjectSelectionStroke() {\r\n    return '<circle cx=\"23\" cy=\"23\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\r\n}\r\n\r\nfunction getBackgroundColor(progress) {\r\n  switch(progress) {\r\n    case 'in preperation': \r\n        return '#000000'; // '#CAC1D2'--> grau\r\n    case 'finished': \r\n        return '#27AE60'; // --> grn\r\n    case 'active': \r\n        return '#f3de61'; // --> gelb\r\n    default: \r\n        return '#000000'; // --> grau\r\n  }\r\n}",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "useClusterMarkers": true,
            "zoomOnClick": true,
            "maxZoom": null,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true,
            "useIconCreateFunction": false,
            "clusterMarkerFunction": null
          },
          "title": "New OpenStreetMap",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Select Project",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nvar selectedProject = params['selectedProject'];\nif (selectedProject && selectedProject.entityId.id === entityId.id) {\n    params['selectedProject'] = null;\n} else {\n    params['selectedProject'] = { entityId: entityId, entityName: entityName, entityLabel: entityLabel };\n}\nwidgetContext.stateController.updateState(null, params);\n/*console.log(\"Params 1: \" + JSON.stringify(params));*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4de7962b-a1de-5cb1-cd78-993dc7863614"
              }
            ],
            "tooltipAction": [
              {
                "name": "all_measurements",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nparams['selectedProject'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedProject';\n/*params['selectedMeasurement'] = null;*/\n/*console.log(\"Params 2: \" + JSON.stringify(params));*/\nwidgetContext.stateController.openState('all_measurements', params);\t",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1ca54350-817a-27b3-26a7-3572544d8523"
              }
            ]
          },
          "showTitleIcon": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "borderRadius": "0px",
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "0ff674a9-4e70-3742-720a-e681566c9b4f",
        "typeFullFqn": "system.maps_v2.openstreetmap"
      },
      "f2279347-4693-4b0a-17c2-15d2887559fa": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1745755787013,
                "endTimeMs": 1745842187013
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              },
              {
                "label": "{i18n:widgets.maps.layer.topographic}",
                "provider": "openstreet",
                "layerType": "Esri.WorldTopoMap",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "OpenStreetMap.HOT",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "Esri.WorldStreetMap",
                "referenceLayer": null
              },
              {
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
                "dsFilterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
                "additionalDataSources": null,
                "additionalDataKeys": [
                  {
                    "name": "progress",
                    "type": "attribute",
                    "label": "progress",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.9725950885098493
                  },
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.2872987416504812,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  },
                  {
                    "name": "address",
                    "type": "attribute",
                    "label": "address",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8026110588871542
                  },
                  {
                    "name": "outsideTemp",
                    "type": "timeseries",
                    "label": "outsideTemp",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.759902282076257
                  },
                  {
                    "name": "outsideHumidity",
                    "type": "timeseries",
                    "label": "outsideHumidity",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.05821233805088244
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8646915284773707,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "label": {
                  "show": true,
                  "type": "function",
                  "pattern": "${entityName}",
                  "patternFunction": {
                    "body": "var color = utils.getProgressColor(data.progress).color;\r\n\r\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \r\n           '${entityName}' + \r\n        '</span>';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js",
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                    }
                  }
                },
                "tooltip": {
                  "show": false,
                  "trigger": "hover",
                  "autoclose": true,
                  "type": "function",
                  "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} C<br/><small>See tooltip settings for details</small>",
                  "offsetX": 0,
                  "offsetY": -1,
                  "patternFunction": {
                    "body": "const locationName = data.locationName || data.label || entityName;\nconst name = data.name || entityName;\nconst progress = data.progress;\nconst address = data.address || '';\n\nlet progressHtml = '';\nif (progress) {\n    let color, bgColor, label;\n    switch (progress) {\n        case 'active':\n            color = '#27AE60';\n            bgColor = 'rgba(39, 174, 96, 0.12)';\n            label = 'Active';\n            break;\n        case 'in preparation':\n            color = '#F2994A';\n            bgColor = 'rgba(242, 153, 74, 0.12)';\n            label = 'In Preparation';\n            break;\n        case 'finished':\n            color = '#2F80ED';\n            bgColor = 'rgba(47, 128, 237, 0.12)';\n            label = 'Finished';\n            break;\n        case 'aborted':\n            color = '#EB5757';\n            bgColor = 'rgba(235, 87, 87, 0.12)';\n            label = 'Aborted';\n            break;\n        default:\n            color = '#828282';\n            bgColor = 'rgba(130, 130, 130, 0.12)';\n            label = progress || 'Unknown';\n    }\n    progressHtml = '<span style=\"padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 500; color: ' + color + '; background-color: ' + bgColor + ';\">' + label + '</span>';\n}\n\nreturn '<div style=\"font-family: Roboto; font-size: 14px;\">' +\n    '<div style=\"font-weight: 600; margin-bottom: 4px;\">' + locationName + '</div>' +\n    '<div style=\"color: #666; font-size: 12px; margin-bottom: 4px;\">' + name + '</div>' +\n    (progressHtml ? '<div>' + progressHtml + '</div>' : '') +\n    '<div style=\"color: #999; font-size: 11px; margin-top: 8px;\">Click for details</div>' +\n    '</div>';",
                    "modules": {}
                  },
                  "tagActions": null
                },
                "click": {
                  "type": "customPretty",
                  "customHtml": "<form class=\"project-popup-form\">\n  <button class=\"popup-close\" mat-icon-button (click)=\"close()\" type=\"button\">\n    <mat-icon class=\"material-icons\">close</mat-icon>\n  </button>\n  <div mat-dialog-content>\n    <!-- Project Picture -->\n    <section *ngIf=\"project.picture\" class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <img class=\"project-picture\" [src]=\"project.picture\"/>\n    </section>\n    \n    <!-- Project Name -->\n    <section class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <div class=\"popup-title\">{{ project.locationName }}</div>\n      <div class=\"popup-subtitle\">{{ project.name }}</div>\n    </section>\n    \n    <mat-divider style=\"margin-bottom: 16px;\"></mat-divider>\n    \n    <!-- Project Details -->\n    <section class=\"flex flex-col gap-2\" style=\"padding-bottom: 16px;\">\n      <div class=\"flex flex-row items-baseline\">\n        <div class=\"popup-label\">Address</div>\n        <div class=\"popup-value\">{{ project.address }}</div>\n      </div>\n      <div class=\"flex flex-row items-center\">\n        <div class=\"popup-label\">Progress</div>\n        <div class=\"popup-badge\" [style.color]=\"project.progressStyle.color\" [style.background-color]=\"project.progressStyle.bgColor\">\n          {{ project.progressStyle.label }}\n        </div>\n      </div>\n      <div class=\"flex flex-row items-center\" *ngIf=\"project.measurementsCount !== null\">\n        <div class=\"popup-label\">Measurements</div>\n        <div class=\"popup-value\">{{ project.measurementsCount }}</div>\n      </div>\n    </section>\n    \n    <!-- Timestamps -->\n    <section *ngIf=\"project.startTime || project.endTime\" class=\"flex flex-row gap-2 flex-wrap\" style=\"padding-bottom: 16px;\">\n      <div *ngIf=\"project.startTime\" class=\"timestamp-badge\" [style.color]=\"project.startTime.color\" [style.background-color]=\"project.startTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.startTime.icon }}</mat-icon>\n        <span>{{ project.startTime.label }}</span>\n      </div>\n      <div *ngIf=\"project.endTime\" class=\"timestamp-badge\" [style.color]=\"project.endTime.color\" [style.background-color]=\"project.endTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.endTime.icon }}</mat-icon>\n        <span>{{ project.endTime.label }}</span>\n      </div>\n    </section>\n    \n    <!-- Buttons -->\n    <section class=\"flex flex-row gap-2 items-center justify-center flex-wrap\" style=\"padding-top: 8px;\">\n      <button *ngIf=\"showWizardButton\" type=\"button\" mat-flat-button color=\"primary\" class=\"popup-button wizard-button\" (click)=\"openProjectWizard()\">\n        <mat-icon>rocket_launch</mat-icon>\n        <span>Project Wizard</span>\n      </button>\n      <button type=\"button\" mat-stroked-button class=\"popup-button edit-button\" (click)=\"openEditProject()\">\n        <mat-icon>edit</mat-icon>\n        <span>Edit</span>\n      </button>\n    </section>\n  </div>\n</form>",
                  "customCss": ".project-popup-form {\n    width: 420px;\n    position: relative;\n    padding: 16px;\n}\n\n.project-popup-form .mat-mdc-dialog-content {\n    max-height: 95vh;\n    padding: 0;\n}\n\n.project-popup-form .popup-close {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    z-index: 1;\n}\n\n.project-popup-form .project-picture {\n    width: 160px;\n    height: 160px;\n    border-radius: 8px;\n    object-fit: cover;\n}\n\n.project-popup-form .popup-title {\n    font-weight: 600;\n    font-size: 18px;\n    line-height: 24px;\n    color: #29313C;\n    text-align: center;\n}\n\n.project-popup-form .popup-subtitle {\n    font-size: 14px;\n    color: #666;\n    text-align: center;\n}\n\n.project-popup-form .popup-label {\n    font-size: 13px;\n    line-height: 16px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.38);\n    width: 110px;\n    flex-shrink: 0;\n}\n\n.project-popup-form .popup-value {\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: 500;\n    letter-spacing: 0.25px;\n    color: #29313C;\n}\n\n.project-popup-form .popup-badge {\n    display: inline-block;\n    padding: 4px 8px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 16px;\n}\n\n.project-popup-form .timestamp-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 500;\n}\n\n.project-popup-form .popup-button {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.project-popup-form .wizard-button {\n    background-color: #307FE5;\n}\n\n.project-popup-form .edit-button {\n    color: #F2994A;\n    border-color: #F2994A;\n}\n\n.project-popup-form .mat-mdc-outlined-button.mat-primary:not(:disabled),\n.project-popup-form .mat-mdc-stroked-button.mat-primary:not(:disabled) {\n    color: #307FE5;\n    border-color: #307FE5;\n}",
                  "customFunction": {
                    "body": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet rxjs = widgetContext.rxjs;\n\n// Load attributes and relations in parallel\nrxjs.forkJoin([\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', \n        ['locationName', 'address', 'progress', 'startTimeMs', 'endTimeMs', 'projectPicture']\n    ),\n    entityRelationService.findByFrom(entityId, 'Owns')\n]).subscribe(function(results) {\n    let attributes = results[0];\n    let relations = results[1];\n    \n    let attrMap = {};\n    attributes.forEach(function(attr) {\n        attrMap[attr.key] = attr.value;\n    });\n    \n    // Count measurements (relations with type Owns to ASSETs)\n    let measurementsCount = relations.filter(function(rel) {\n        return rel.to && rel.to.entityType === 'ASSET';\n    }).length;\n    \n    openProjectPopupDialog(attrMap, measurementsCount);\n});\n\nfunction openProjectPopupDialog(attrMap, measurementsCount) {\n    customDialog.customDialog(htmlTemplate, ProjectPopupController).subscribe();\n    \n    function ProjectPopupController(instance) {\n        let vm = instance;\n        \n        // Progress styling\n        let progressStyle = getProgressColor(attrMap.progress);\n        \n        // Timestamp styling\n        let startTime = getTimestampStyle(attrMap.startTimeMs, 'start');\n        let endTime = getTimestampStyle(attrMap.endTimeMs, 'end');\n        \n        vm.project = {\n            name: entityName,\n            locationName: attrMap.locationName || entityLabel || entityName,\n            address: attrMap.address || 'N/A',\n            progress: attrMap.progress,\n            progressStyle: progressStyle,\n            picture: attrMap.projectPicture || null,\n            startTime: startTime,\n            endTime: endTime,\n            measurementsCount: measurementsCount\n        };\n        \n        vm.showWizardButton = (attrMap.progress === 'in preparation' || attrMap.progress === 'active');\n        \n        vm.close = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        vm.openProjectWizard = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            }, { dataImporter: dataImporter });\n        };\n        \n        vm.openMeasurements = function() {\n            vm.dialogRef.close(null);\n            var params = widgetContext.stateController.getStateParams();\n            var selectedProject = params['selectedProject'];\n            if (selectedProject && selectedProject.entityId.id === entityId.id) {\n                params['selectedProject'] = null;\n            } else {\n                params['selectedProject'] = { \n                    entityId: entityId, \n                    entityName: entityName, \n                    entityLabel: entityLabel \n                };\n            }\n            widgetContext.stateController.updateState(null, params);\n        };\n        vm.openEditProject = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openEditProjectDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            });\n        };\n\n        \n        // Helper functions\n        function getProgressColor(progress) {\n            let color, bgColor, label;\n            switch (progress) {\n                case 'in preparation':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'In Preparation';\n                    break;\n                case 'planned':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'Planned';\n                    break;\n                case 'active':\n                    color = '#27AE60';\n                    bgColor = 'rgba(39, 174, 96, 0.12)';\n                    label = 'Active';\n                    break;\n                case 'finished':\n                    color = '#2F80ED';\n                    bgColor = 'rgba(47, 128, 237, 0.12)';\n                    label = 'Finished';\n                    break;\n                case 'aborted':\n                    color = '#EB5757';\n                    bgColor = 'rgba(235, 87, 87, 0.12)';\n                    label = 'Aborted';\n                    break;\n                default:\n                    color = '#828282';\n                    bgColor = 'rgba(130, 130, 130, 0.12)';\n                    label = progress || 'N/A';\n            }\n            return { color: color, bgColor: bgColor, label: label };\n        }\n        \n        function getTimestampStyle(timestampMs, type) {\n            if (timestampMs === null || timestampMs === undefined) {\n                return null;\n            }\n            var date = new Date(Number(timestampMs));\n            var pad = function(n) { return n.toString().padStart(2, '0'); };\n            var formattedTime = date.getFullYear() + '-' + pad(date.getMonth() + 1) + '-' + pad(date.getDate()) +\n                ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n            \n            var icon, color, bgColor, label;\n            if (type === 'start') {\n                icon = 'play_circle';\n                color = '#27AE60';\n                bgColor = 'rgba(39, 174, 96, 0.12)';\n                label = 'Start: ' + formattedTime;\n            } else {\n                icon = 'stop_circle';\n                color = '#2F80ED';\n                bgColor = 'rgba(47, 128, 237, 0.12)';\n                label = 'End: ' + formattedTime;\n            }\n            return { icon: icon, color: color, bgColor: bgColor, label: label };\n        }\n    }\n}",
                    "modules": {
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                      "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                    }
                  },
                  "customResources": [],
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "add",
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "icon",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "size": 40,
                  "color": {
                    "type": "function",
                    "color": "#307FE5",
                    "rangeKey": null,
                    "range": null,
                    "colorFunction": {
                      "body": "return utils.getProgressColor(data.progress).color;",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    }
                  },
                  "iconContainer": "iconContainer4",
                  "icon": "domain"
                },
                "markerImage": {
                  "type": "image",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": true,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedProject",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.5634367819170003,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce"
              },
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "role",
                    "type": "attribute",
                    "label": "role",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7014478669430672
                  },
                  {
                    "name": "displayAbortedMeasurement",
                    "type": "attribute",
                    "label": "displayAbortedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8011587598224269
                  },
                  {
                    "name": "displayActiveMeasurement",
                    "type": "attribute",
                    "label": "displayActiveMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8205299052205228
                  },
                  {
                    "name": "displayFinishedMeasurement",
                    "type": "attribute",
                    "label": "displayFinishedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.038665901375789624
                  },
                  {
                    "name": "displayPreparationMeasurement",
                    "type": "attribute",
                    "label": "displayPreparationMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.21373032656145663
                  }
                ],
                "dsEntityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [
              "metric"
            ],
            "dragModeButton": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [
              {
                "label": "Filter",
                "icon": "filter_alt",
                "color": "#0000008A",
                "action": {
                  "type": "openDashboardState",
                  "targetDashboardStateId": "Measurement_state_filter",
                  "setEntityId": true,
                  "stateEntityParamName": null,
                  "openRightLayout": false,
                  "popoverPreferredPlacement": "top",
                  "popoverHideOnClickOutside": true,
                  "popoverHideDashboardToolbar": true,
                  "popoverWidth": "300px",
                  "popoverHeight": "250px",
                  "popoverStyle": {
                    "padding": "16px",
                    "borderRadius": "8px",
                    "boxShadow": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
                    "background": "#ffffff"
                  },
                  "openInSeparateDialog": false,
                  "openInPopover": true
                }
              }
            ],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "8px"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": true,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {
            "headerButton": []
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "f2279347-4693-4b0a-17c2-15d2887559fa"
      },
      "fb583db5-3fc6-275a-34f4-120bfe140af2": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1745755787013,
                "endTimeMs": 1745842187013
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              },
              {
                "label": "{i18n:widgets.maps.layer.topographic}",
                "provider": "openstreet",
                "layerType": "Esri.WorldTopoMap",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "OpenStreetMap.HOT",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "Esri.WorldStreetMap",
                "referenceLayer": null
              },
              {
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
                "dsFilterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
                "additionalDataSources": null,
                "additionalDataKeys": [
                  {
                    "name": "progress",
                    "type": "attribute",
                    "label": "progress",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.9725950885098493
                  },
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.2872987416504812,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  },
                  {
                    "name": "address",
                    "type": "attribute",
                    "label": "address",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8026110588871542
                  },
                  {
                    "name": "outsideTemp",
                    "type": "timeseries",
                    "label": "outsideTemp",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.759902282076257
                  },
                  {
                    "name": "outsideHumidity",
                    "type": "timeseries",
                    "label": "outsideHumidity",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.05821233805088244
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8646915284773707,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "label": {
                  "show": true,
                  "type": "function",
                  "pattern": "${entityName}",
                  "patternFunction": {
                    "body": "var color = utils.getProgressColor(data.progress).color;\r\n\r\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \r\n           '${entityName}' + \r\n        '</span>';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                    }
                  }
                },
                "tooltip": {
                  "show": false,
                  "type": "function",
                  "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} C<br/><small>See tooltip settings for details</small>",
                  "patternFunction": {
                    "body": "const locationName = data.locationName || data.label || entityName;\nconst name = data.name || entityName;\nconst progress = data.progress;\nconst address = data.address || '';\n\nlet progressHtml = '';\nif (progress) {\n    let color, bgColor, label;\n    switch (progress) {\n        case 'active':\n            color = '#27AE60';\n            bgColor = 'rgba(39, 174, 96, 0.12)';\n            label = 'Active';\n            break;\n        case 'in preparation':\n            color = '#F2994A';\n            bgColor = 'rgba(242, 153, 74, 0.12)';\n            label = 'In Preparation';\n            break;\n        case 'finished':\n            color = '#2F80ED';\n            bgColor = 'rgba(47, 128, 237, 0.12)';\n            label = 'Finished';\n            break;\n        case 'aborted':\n            color = '#EB5757';\n            bgColor = 'rgba(235, 87, 87, 0.12)';\n            label = 'Aborted';\n            break;\n        default:\n            color = '#828282';\n            bgColor = 'rgba(130, 130, 130, 0.12)';\n            label = progress || 'Unknown';\n    }\n    progressHtml = '<span style=\"padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 500; color: ' + color + '; background-color: ' + bgColor + ';\">' + label + '</span>';\n}\n\nreturn '<div style=\"font-family: Roboto; font-size: 14px;\">' +\n    '<div style=\"font-weight: 600; margin-bottom: 4px;\">' + locationName + '</div>' +\n    '<div style=\"color: #666; font-size: 12px; margin-bottom: 4px;\">' + name + '</div>' +\n    (progressHtml ? '<div>' + progressHtml + '</div>' : '') +\n    '<div style=\"color: #999; font-size: 11px; margin-top: 8px;\">Click for details</div>' +\n    '</div>';",
                    "modules": {}
                  },
                  "trigger": "hover",
                  "autoclose": true,
                  "offsetX": 0,
                  "offsetY": -1,
                  "tagActions": null
                },
                "click": {
                  "type": "customPretty",
                  "customHtml": "<form class=\"project-popup-form\">\n  <button class=\"popup-close\" mat-icon-button (click)=\"close()\" type=\"button\">\n    <mat-icon class=\"material-icons\">close</mat-icon>\n  </button>\n  <div mat-dialog-content>\n    <!-- Project Picture -->\n    <section *ngIf=\"project.picture\" class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <img class=\"project-picture\" [src]=\"project.picture\"/>\n    </section>\n    \n    <!-- Project Name -->\n    <section class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <div class=\"popup-title\">{{ project.locationName }}</div>\n      <div class=\"popup-subtitle\">{{ project.name }}</div>\n    </section>\n    \n    <mat-divider style=\"margin-bottom: 16px;\"></mat-divider>\n    \n    <!-- Project Details -->\n    <section class=\"flex flex-col gap-2\" style=\"padding-bottom: 16px;\">\n      <div class=\"flex flex-row items-baseline\">\n        <div class=\"popup-label\">Address</div>\n        <div class=\"popup-value\">{{ project.address }}</div>\n      </div>\n      <div class=\"flex flex-row items-center\">\n        <div class=\"popup-label\">Progress</div>\n        <div class=\"popup-badge\" [style.color]=\"project.progressStyle.color\" [style.background-color]=\"project.progressStyle.bgColor\">\n          {{ project.progressStyle.label }}\n        </div>\n      </div>\n      <div class=\"flex flex-row items-center\" *ngIf=\"project.measurementsCount !== null\">\n        <div class=\"popup-label\">Measurements</div>\n        <div class=\"popup-value\">{{ project.measurementsCount }}</div>\n      </div>\n    </section>\n    \n    <!-- Timestamps -->\n    <section *ngIf=\"project.startTime || project.endTime\" class=\"flex flex-row gap-2 flex-wrap\" style=\"padding-bottom: 16px;\">\n      <div *ngIf=\"project.startTime\" class=\"timestamp-badge\" [style.color]=\"project.startTime.color\" [style.background-color]=\"project.startTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.startTime.icon }}</mat-icon>\n        <span>{{ project.startTime.label }}</span>\n      </div>\n      <div *ngIf=\"project.endTime\" class=\"timestamp-badge\" [style.color]=\"project.endTime.color\" [style.background-color]=\"project.endTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.endTime.icon }}</mat-icon>\n        <span>{{ project.endTime.label }}</span>\n      </div>\n    </section>\n    \n    <!-- Buttons -->\n    <section class=\"flex flex-row gap-2 items-center justify-center flex-wrap\" style=\"padding-top: 8px;\">\n      <button *ngIf=\"showWizardButton\" type=\"button\" mat-flat-button color=\"primary\" class=\"popup-button wizard-button\" (click)=\"openProjectWizard()\">\n        <mat-icon>rocket_launch</mat-icon>\n        <span>Project Wizard</span>\n      </button>\n      <button type=\"button\" mat-stroked-button color=\"primary\" class=\"popup-button\" (click)=\"openMeasurements()\">\n        <mat-icon>assignment</mat-icon>\n        <span>Measurements</span>\n      </button>\n      <button type=\"button\" mat-stroked-button class=\"popup-button edit-button\" (click)=\"openEditProject()\">\n        <mat-icon>edit</mat-icon>\n        <span>Edit</span>\n      </button>\n    </section>\n  </div>\n</form>",
                  "customCss": ".project-popup-form {\n    width: 420px;\n    position: relative;\n    padding: 16px;\n}\n\n.project-popup-form .mat-mdc-dialog-content {\n    max-height: 95vh;\n    padding: 0;\n}\n\n.project-popup-form .popup-close {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    z-index: 1;\n}\n\n.project-popup-form .project-picture {\n    width: 160px;\n    height: 160px;\n    border-radius: 8px;\n    object-fit: cover;\n}\n\n.project-popup-form .popup-title {\n    font-weight: 600;\n    font-size: 18px;\n    line-height: 24px;\n    color: #29313C;\n    text-align: center;\n}\n\n.project-popup-form .popup-subtitle {\n    font-size: 14px;\n    color: #666;\n    text-align: center;\n}\n\n.project-popup-form .popup-label {\n    font-size: 13px;\n    line-height: 16px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.38);\n    width: 110px;\n    flex-shrink: 0;\n}\n\n.project-popup-form .popup-value {\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: 500;\n    letter-spacing: 0.25px;\n    color: #29313C;\n}\n\n.project-popup-form .popup-badge {\n    display: inline-block;\n    padding: 4px 8px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 16px;\n}\n\n.project-popup-form .timestamp-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 500;\n}\n\n.project-popup-form .popup-button {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.project-popup-form .wizard-button {\n    background-color: #307FE5;\n}\n\n.project-popup-form .edit-button {\n    color: #F2994A;\n    border-color: #F2994A;\n}\n\n.project-popup-form .mat-mdc-outlined-button.mat-primary:not(:disabled),\n.project-popup-form .mat-mdc-stroked-button.mat-primary:not(:disabled) {\n    color: #307FE5;\n    border-color: #307FE5;\n}",
                  "customFunction": {
                    "body": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet rxjs = widgetContext.rxjs;\n\n// Load attributes and relations in parallel\nrxjs.forkJoin([\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', \n        ['locationName', 'address', 'progress', 'startTimeMs', 'endTimeMs', 'projectPicture']\n    ),\n    entityRelationService.findByFrom(entityId, 'Owns')\n]).subscribe(function(results) {\n    let attributes = results[0];\n    let relations = results[1];\n    \n    let attrMap = {};\n    attributes.forEach(function(attr) {\n        attrMap[attr.key] = attr.value;\n    });\n    \n    // Count measurements (relations with type Owns to ASSETs)\n    let measurementsCount = relations.filter(function(rel) {\n        return rel.to && rel.to.entityType === 'ASSET';\n    }).length;\n    \n    openProjectPopupDialog(attrMap, measurementsCount);\n});\n\nfunction openProjectPopupDialog(attrMap, measurementsCount) {\n    customDialog.customDialog(htmlTemplate, ProjectPopupController).subscribe();\n    \n    function ProjectPopupController(instance) {\n        let vm = instance;\n        \n        // Progress styling\n        let progressStyle = getProgressColor(attrMap.progress);\n        \n        // Timestamp styling\n        let startTime = getTimestampStyle(attrMap.startTimeMs, 'start');\n        let endTime = getTimestampStyle(attrMap.endTimeMs, 'end');\n        \n        vm.project = {\n            name: entityName,\n            locationName: attrMap.locationName || entityLabel || entityName,\n            address: attrMap.address || 'N/A',\n            progress: attrMap.progress,\n            progressStyle: progressStyle,\n            picture: attrMap.projectPicture || null,\n            startTime: startTime,\n            endTime: endTime,\n            measurementsCount: measurementsCount\n        };\n        \n        vm.showWizardButton = (attrMap.progress === 'in preparation' || attrMap.progress === 'active');\n        \n        vm.close = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        vm.openProjectWizard = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            }, { dataImporter: dataImporter });\n        };\n        \n        vm.openMeasurements = function() {\n            vm.dialogRef.close(null);\n            var params = widgetContext.stateController.getStateParams();\n            var selectedProject = params['selectedProject'];\n            if (selectedProject && selectedProject.entityId.id === entityId.id) {\n                params['selectedProject'] = null;\n            } else {\n                params['selectedProject'] = { \n                    entityId: entityId, \n                    entityName: entityName, \n                    entityLabel: entityLabel \n                };\n            }\n            widgetContext.stateController.updateState(null, params);\n        };\n        vm.openEditProject = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openEditProjectDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            });\n        };\n\n        \n        // Helper functions\n        function getProgressColor(progress) {\n            let color, bgColor, label;\n            switch (progress) {\n                case 'in preparation':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'In Preparation';\n                    break;\n                case 'planned':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'Planned';\n                    break;\n                case 'active':\n                    color = '#27AE60';\n                    bgColor = 'rgba(39, 174, 96, 0.12)';\n                    label = 'Active';\n                    break;\n                case 'finished':\n                    color = '#2F80ED';\n                    bgColor = 'rgba(47, 128, 237, 0.12)';\n                    label = 'Finished';\n                    break;\n                case 'aborted':\n                    color = '#EB5757';\n                    bgColor = 'rgba(235, 87, 87, 0.12)';\n                    label = 'Aborted';\n                    break;\n                default:\n                    color = '#828282';\n                    bgColor = 'rgba(130, 130, 130, 0.12)';\n                    label = progress || 'N/A';\n            }\n            return { color: color, bgColor: bgColor, label: label };\n        }\n        \n        function getTimestampStyle(timestampMs, type) {\n            if (timestampMs === null || timestampMs === undefined) {\n                return null;\n            }\n            var date = new Date(Number(timestampMs));\n            var pad = function(n) { return n.toString().padStart(2, '0'); };\n            var formattedTime = date.getFullYear() + '-' + pad(date.getMonth() + 1) + '-' + pad(date.getDate()) +\n                ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n            \n            var icon, color, bgColor, label;\n            if (type === 'start') {\n                icon = 'play_circle';\n                color = '#27AE60';\n                bgColor = 'rgba(39, 174, 96, 0.12)';\n                label = 'Start: ' + formattedTime;\n            } else {\n                icon = 'stop_circle';\n                color = '#2F80ED';\n                bgColor = 'rgba(47, 128, 237, 0.12)';\n                label = 'End: ' + formattedTime;\n            }\n            return { icon: icon, color: color, bgColor: bgColor, label: label };\n        }\n    }\n}",
                    "modules": {
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                      "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                    }
                  },
                  "customResources": [],
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "add",
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "icon",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "iconContainer": "iconContainer4",
                  "icon": "domain",
                  "size": 40,
                  "color": {
                    "type": "function",
                    "color": "#307FE5",
                    "rangeKey": null,
                    "range": null,
                    "colorFunction": {
                      "body": "return utils.getProgressColor(data.progress).color;",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    }
                  }
                },
                "markerImage": {
                  "type": "image",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": true,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedProject",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.5634367819170003,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce"
              },
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "role",
                    "type": "attribute",
                    "label": "role",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7014478669430672
                  },
                  {
                    "name": "displayAbortedMeasurement",
                    "type": "attribute",
                    "label": "displayAbortedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8011587598224269
                  },
                  {
                    "name": "displayActiveMeasurement",
                    "type": "attribute",
                    "label": "displayActiveMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8205299052205228
                  },
                  {
                    "name": "displayFinishedMeasurement",
                    "type": "attribute",
                    "label": "displayFinishedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.038665901375789624
                  },
                  {
                    "name": "displayPreparationMeasurement",
                    "type": "attribute",
                    "label": "displayPreparationMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.21373032656145663
                  }
                ],
                "dsEntityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [
              "metric"
            ],
            "dragModeButton": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [
              {
                "label": "Filter",
                "icon": "filter_alt",
                "color": "#0000008A",
                "action": {
                  "type": "openDashboardState",
                  "targetDashboardStateId": "Measurement_state_filter",
                  "setEntityId": true,
                  "stateEntityParamName": null,
                  "openRightLayout": false,
                  "popoverPreferredPlacement": "top",
                  "popoverHideOnClickOutside": true,
                  "popoverHideDashboardToolbar": true,
                  "popoverWidth": "300px",
                  "popoverHeight": "250px",
                  "popoverStyle": {
                    "padding": "16px",
                    "borderRadius": "8px",
                    "boxShadow": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
                    "background": "#ffffff"
                  },
                  "openInSeparateDialog": false,
                  "openInPopover": true
                }
              },
              {
                "label": "Add Project",
                "icon": "add",
                "color": "#0000008a",
                "action": {
                  "type": "placeMapItem",
                  "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"flex items-center\" color=\"primary\">\n    <mat-icon style=\"margin-right: 12px;\">folder_open</mat-icon>\n    <h2 style=\"margin: 0; font-size: 18px;\">Add Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col gap-2 p-4\">\n    <mat-form-field *ngIf=\"isTenantAdmin\" appearance=\"outline\" class=\"w-full\">\n      <mat-label>Customer</mat-label>\n      <mat-select formControlName=\"customer\" (selectionChange)=\"onCustomerChange()\" required>\n        <mat-option *ngFor=\"let c of customers\" [value]=\"c\">{{ c.name }}</mat-option>\n      </mat-select>\n      <mat-error *ngIf=\"addProjectFormGroup.get('customer')?.hasError('required')\">Customer is required.</mat-error>\n    </mat-form-field>\n    <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project ID</mat-label>\n        <input matInput formControlName=\"name\" required readonly>\n        <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">Project title is required.</mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Label</mat-label>\n        <input matInput formControlName=\"entityLabel\">\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project address</mat-label>\n        <input matInput formControlName=\"address\">\n    </mat-form-field>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Postal Code</mat-label>\n          <input matInput formControlName=\"postalCode\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 2;\">\n          <mat-label>City</mat-label>\n          <input matInput formControlName=\"city\">\n      </mat-form-field>\n    </div>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Latitude</mat-label>\n          <input matInput formControlName=\"latitude\" readonly>\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Longitude</mat-label>\n          <input matInput formControlName=\"longitude\" readonly>\n      </mat-form-field>\n    </div>\n  </div>\n  <div class=\"flex justify-end items-center gap-2 p-4\" style=\"border-top: 1px solid #e0e0e0; background: #fafafa;\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>\n",
                  "customCss": "",
                  "customFunction": "/*========================================================================*/\n/*========  Add Project with Customer Selection & Reverse Geocoding  =====*/\n/*========================================================================*/\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet $http = $injector.get(widgetContext.servicesMap.get('http'));\n\n// Get marker coordinates\nconst markerLat = additionalParams.coordinates.x;\nconst markerLon = additionalParams.coordinates.y;\n\nconsole.log(\"Marker Coordinates: \", markerLat, markerLon);\n\n// Check if Tenant Admin\nconst isTenantAdmin = widgetContext.currentUser.authority === 'TENANT_ADMIN';\nconst pageLink = widgetContext.pageLink(1000, 0, null, null, null);\n\n// Shared variables for async operations\nlet customers = [];\nlet selectedCustomerId = null;\nlet selectedCustomerName = null;\nlet addressData = null;\nlet nextProjectId = 0;\nlet customerShortName = '';\n\n// Step 1: Reverse Geocoding\nreverseGeocode(markerLat, markerLon)\n  .then(data => {\n    addressData = data;\n    console.log('Reverse geocoding result:', addressData);\n\n    // Step 2: Fetch customers\n    return fetchCustomers();\n  })\n  .then(() => {\n    console.log('Customers fetched:', customers);\n\n    // Step 3: Open dialog with customer selection\n    openAddProjectDialog();\n  })\n  .catch(error => {\n    console.error('Error in Add Project workflow:', error);\n  });\n\n/**\n * Reverse Geocoding: Converts lat/lon to address using Photon API\n * Address format: Straenname Hausnummer, CC-Postleitzahl Ort\n */\nfunction reverseGeocode(lat, lon) {\n  return new Promise((resolve, reject) => {\n    const url = `https://photon.komoot.io/reverse?lat=${lat}&lon=${lon}&limit=1`;\n\n    $http.get(url).subscribe(\n      response => {\n        if (response && response.features && response.features.length > 0) {\n          const feature = response.features[0];\n          const props = feature.properties;\n\n          // Build address in format: Straenname Hausnummer, CC-Postleitzahl Ort\n          let street = props.street || props.name || '';\n          let housenumber = props.housenumber || '';\n          let postcode = props.postcode || '';\n          let city = props.city || props.town || props.village || '';\n          let countryCode = props.countrycode ? props.countrycode.toUpperCase() : '';\n\n          // Street + Housenumber part\n          let addressLine = street;\n          if (housenumber) {\n            addressLine += ' ' + housenumber;\n          }\n\n          // CC-Postcode + City part\n          let locationLine = '';\n          if (countryCode && postcode) {\n            locationLine = countryCode + '-' + postcode;\n          } else if (postcode) {\n            locationLine = postcode;\n          }\n          if (city) {\n            locationLine += (locationLine ? ' ' : '') + city;\n          }\n\n          // Combined format: \"Street Number, CC-Postcode City\"\n          let fullAddress = addressLine;\n          if (locationLine) {\n            fullAddress += ', ' + locationLine;\n          }\n\n          const result = {\n            address: fullAddress,\n            postalCode: postcode,\n            city: city,\n            latitude: lat,\n            longitude: lon\n          };\n\n          resolve(result);\n        } else {\n          resolve({\n            address: '',\n            postalCode: '',\n            city: '',\n            latitude: lat,\n            longitude: lon\n          });\n        }\n      },\n      error => {\n        console.error('Photon API error:', error);\n        reject(error);\n      }\n    );\n  });\n}\n\n/**\n * Fetch customers based on user role\n */\nfunction fetchCustomers() {\n  return new Promise((resolve, reject) => {\n    customerService.getUserCustomers(pageLink).subscribe(\n      pageData => {\n        customers = (pageData && pageData.data) ? pageData.data : [];\n\n        // Non-Tenant-Admin  automatically select the single customer\n        if (!isTenantAdmin && customers.length === 1) {\n          const c = customers[0];\n          selectedCustomerId = {\n            id: c.id.id,\n            entityType: 'CUSTOMER'\n          };\n          selectedCustomerName = c.name;\n        }\n\n        resolve();\n      },\n      error => {\n        console.error('Error fetching customers:', error);\n        reject(error);\n      }\n    );\n  });\n}\n\nfunction openAddProjectDialog() {\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\n}\n\nfunction AddProjectDialogController(instance) {\n  let vm = instance;\n\n  vm.isTenantAdmin = isTenantAdmin;\n  vm.customers = customers;\n\n  // FormGroup erstellen\n  vm.addProjectFormGroup = vm.fb.group({\n    customer: [{ value: null, disabled: !isTenantAdmin }, vm.validators.required],\n    name: [{ value: '', disabled: true }, vm.validators.required],\n    entityLabel: [''],\n    projectPicture: [''],\n    address: [addressData ? addressData.address : ''],\n    postalCode: [addressData ? addressData.postalCode : ''],\n    city: [addressData ? addressData.city : ''],\n    latitude: [addressData ? addressData.latitude.toFixed(6) : markerLat.toFixed(6)],\n    longitude: [addressData ? addressData.longitude.toFixed(6) : markerLon.toFixed(6)]\n  });\n\n  // Customer vorausfllen (Non-Tenant-Admin)\n  if (!isTenantAdmin && selectedCustomerId) {\n    vm.addProjectFormGroup.patchValue({\n      customer: customers[0]\n    });\n    vm.addProjectFormGroup.get('customer').markAsDirty();\n    loadCustomerData(selectedCustomerId, selectedCustomerName);\n  }\n\n  // Customer Change Handler\n  vm.onCustomerChange = function () {\n    const c = vm.addProjectFormGroup.getRawValue().customer;\n    if (!c) return;\n\n    selectedCustomerId = {\n      id: c.id.id,\n      entityType: 'CUSTOMER'\n    };\n    selectedCustomerName = c.name;\n\n    loadCustomerData(selectedCustomerId, selectedCustomerName);\n  };\n\n  // Load customer-specific data (projects + shortName)\n  function loadCustomerData(customerId, customerName) {\n    const assetSearchQuery = {\n      \"parameters\": {\n        \"rootId\": customerId.id,\n        \"rootType\": \"CUSTOMER\",\n        \"direction\": \"FROM\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 10,\n        \"fetchLastLevelOnly\": false\n      },\n      \"relationType\": \"Owns\",\n      \"assetTypes\": [\"Project\"]\n    };\n\n    assetService.findByQuery(assetSearchQuery).subscribe(projects => {\n      nextProjectId = getLastProjectId(projects);\n\n      attributeService\n        .getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName'])\n        .subscribe(attributes => {\n          const shortNameAttr = attributes.find(a => a.key === 'shortName');\n          customerShortName = shortNameAttr ? shortNameAttr.value : customerName;\n\n          vm.addProjectFormGroup.patchValue({\n            name: customerShortName + '_' + nextProjectId\n          });\n\n          vm.addProjectFormGroup.get('name').markAsDirty();\n        });\n    });\n  }\n\n  function getLastProjectId(projects) {\n    let maxNumber = 0;\n    projects.forEach(item => {\n      const name = item.name;\n      const parts = name.split('_');\n      if (parts.length === 2) {\n        const number = parseInt(parts[1], 10);\n        if (number > maxNumber) {\n          maxNumber = number;\n        }\n      }\n    });\n    return maxNumber + 1;\n  }\n\n  vm.cancel = function() {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function () {\n    if (!selectedCustomerId) {\n      console.error('No customer selected');\n      return;\n    }\n\n    // Validate that name is set\n    const formValues = vm.addProjectFormGroup.getRawValue();\n    if (!formValues.name || formValues.name === '') {\n      console.error('Project name is not set. Please select a customer first.');\n      return;\n    }\n\n    vm.addProjectFormGroup.markAsPristine();\n    saveProjectObservable(selectedCustomerId).subscribe(\n      function (Project) {\n        widgetContext.rxjs.forkJoin([\n          saveCustomerToProjectRelation(selectedCustomerId, Project.id),\n          saveAttributes(Project.id)\n        ]).subscribe(\n          function () {\n            var params = widgetContext.stateController.getStateParams();\n            params['selectedProject'] = {\n              entityId: Project.id,\n              entityName: Project.name,\n              entityLabel: ''\n            };\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n          }\n        );\n      }\n    );\n  };\n\n  function saveProjectObservable(customerId) {\n    return getProjectsGroup(customerId).pipe(\n      widgetContext.rxjs.switchMap((ProjectsGroup) => {\n        const formValues = vm.addProjectFormGroup.getRawValue();\n        let Project = {\n          name: formValues.name,\n          type: 'Project',\n          label: formValues.entityLabel,\n          customerId: customerId\n        };\n        return assetService.saveAsset(Project, ProjectsGroup.id.id)\n      })\n    );\n  }\n\n  function saveAttributes(entityId) {\n    let attributesArray = getMapItemLocationAttributes();\n    const formValues = vm.addProjectFormGroup.getRawValue();\n\n    attributesArray.push({key: 'address', value: formValues.address});\n    attributesArray.push({key: 'postalCode', value: formValues.postalCode});\n    attributesArray.push({key: 'city', value: formValues.city});\n    attributesArray.push({key: 'progress', value: 'in preparation'});\n    attributesArray.push({key: 'units', value: 'metric'});\n    attributesArray.push({key: 'projectPicture', value: formValues.projectPicture || ''});\n\n    if (attributesArray.length > 0) {\n      return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n    }\n    return widgetContext.rxjs.of([]);\n  }\n\n  function getProjectsGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n      widgetContext.rxjs.switchMap((entityGroups) => {\n        var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\n        if (ProjectsGroup) {\n          return widgetContext.rxjs.of(ProjectsGroup);\n        } else {\n          ProjectsGroup = {\n            type: 'ASSET',\n            name: 'Projects',\n            ownerId: customerId\n          };\n          return entityGroupService.saveEntityGroup(ProjectsGroup);\n        }\n      })\n    );\n  }\n\n  function saveCustomerToProjectRelation(customerId, ProjectId) {\n    var relation = {\n      from: customerId,\n      to: ProjectId,\n      typeGroup: 'COMMON',\n      type: 'Owns'\n    };\n    return entityRelationService.saveRelation(relation);\n  }\n\n  function getMapItemLocationAttributes() {\n    const attributes = [];\n    const mapItemType = $event.shape;\n    if (mapItemType === 'Marker') {\n      const mapType = widgetContext.mapInstance.type();\n      attributes.push({key: mapType === 'image' ? 'xPos' : 'latitude', value: additionalParams.coordinates.x});\n      attributes.push({key: mapType === 'image' ? 'yPos' : 'longitude', value: additionalParams.coordinates.y});\n    } else if (mapItemType === 'Rectangle' || mapItemType === 'Polygon') {\n      attributes.push({key: 'perimeter', value: additionalParams.coordinates});\n    } else if (mapItemType === 'Circle') {\n      attributes.push({key: 'circle', value: additionalParams.coordinates});\n    }\n    return attributes;\n  }\n}\n",
                  "customResources": [],
                  "mapItemType": "marker",
                  "mapItemTooltips": {},
                  "openInSeparateDialog": false,
                  "openInPopover": false
                }
              }
            ],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "8px"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": true,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {
            "headerButton": []
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "fb583db5-3fc6-275a-34f4-120bfe140af2"
      },
      "0ee615fb-cbb2-65ba-136e-f9a02d8c3a9a": {
        "typeFullFqn": "tenant.eco_custom_widgets.eco_timeseries_zoom_sync",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_S_Power_Heating",
                  "type": "timeseries",
                  "label": "Power",
                  "color": "#F44336",
                  "settings": {
                    "chartIndex": 1,
                    "yAxisIndex": 0,
                    "yAxisLabel": null,
                    "yAxisUnit": null,
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.7243417145383836,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#048AD3",
                  "settings": {
                    "chartIndex": 2,
                    "yAxisIndex": 0,
                    "yAxisLabel": null,
                    "yAxisUnit": null,
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.2976350468906287,
                  "aggregationType": null,
                  "units": "L/hr",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "Flow Temperature",
                  "color": "#E91E63",
                  "settings": {
                    "chartIndex": 3,
                    "yAxisIndex": 0,
                    "yAxisLabel": null,
                    "yAxisUnit": null,
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.06402744684616413,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "Return Temperature",
                  "color": "#673AB7",
                  "settings": {
                    "chartIndex": 3,
                    "yAxisIndex": 0,
                    "yAxisLabel": null,
                    "yAxisUnit": null,
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.054478723552532804,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "Temperature Difference",
                  "color": "#E89623",
                  "settings": {
                    "chartIndex": 3,
                    "yAxisIndex": 0,
                    "yAxisLabel": null,
                    "yAxisUnit": null,
                    "yAxisMin": null,
                    "yAxisMax": null
                  },
                  "_hash": 0.09203730244585884,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.496052658010679
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.13418022126324225
                }
              ]
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_HOUR",
              "interval": 5000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "chartType": "line",
            "smoothLine": true,
            "displayMode": "stacked",
            "lineWidth": 2,
            "showArea": null,
            "areaOpacity": 0.3,
            "showDataZoomSlider": true,
            "showLegend": true,
            "legendStyle": "card",
            "legendPosition": "top",
            "legendAlign": "center",
            "legendCardColorMode": "auto",
            "legendCardColor": "#2196F3",
            "legendValues": [
              "current",
              "min",
              "max"
            ],
            "showTimestamp": false,
            "timestampFormat": "YYYY-MM-DD HH:mm:ss",
            "yAxisMin": null,
            "yAxisMax": null,
            "yAxis2Min": null,
            "yAxis2Max": null,
            "removeOutliers": true,
            "outlierMethod": "iqr",
            "outlierIqrMultiplier": 1.5,
            "outlierZscoreThreshold": 3,
            "outlierMinValue": null,
            "outlierMaxValue": null,
            "smoothingEnabled": true,
            "smoothingWindowMinutes": 5,
            "showToolbox": false,
            "toolboxFeatures": [
              "saveAsImage",
              "dataView",
              "dataZoom",
              "restore"
            ],
            "showTimewindowSelector": true,
            "twSelectorColor": "#435B63",
            "twSelectorPosition": "left",
            "twSelectorDefaultMode": "custom",
            "twSelectorDayFormat": "DD.MM.YYYY",
            "twSelectorWeekFormat": "DD.MM.YYYY - DD.MM.YYYY",
            "twSelectorMonthFormat": "MMMM YYYY",
            "twCustomStartTime": "${startTimeMs}",
            "twCustomEndTime": "${endTimeMs}",
            "twAggregationType": "NONE",
            "twMaxDataPoints": 100000,
            "chartSpacing": 2,
            "chartTopMargin": 5,
            "chartBottomMargin": 1,
            "chart1Enabled": true,
            "chart1Title": "Power",
            "chart1Type": "line",
            "chart1Height": null,
            "chart2Enabled": true,
            "chart2Title": "Volume Flow",
            "chart2Type": "line",
            "chart2Height": null,
            "chart3Enabled": true,
            "chart3Title": "Temperatures",
            "chart3Type": "line",
            "chart3Height": null,
            "chart4Enabled": null,
            "chart4Title": null,
            "chart4Type": "line",
            "chart4Height": null
          },
          "title": "ECO Timeseries Zoom Sync",
          "dropShadow": false,
          "enableFullscreen": true,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "hasAdditionalLatestDataKeys": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "margin": "",
          "borderRadius": "",
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "0ee615fb-cbb2-65ba-136e-f9a02d8c3a9a"
      }
    },
    "states": {
      "default": {
        "name": "{i18n:custom.diagnostics.projects.title}",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "678a80b3-1380-cdd2-495f-1701acde66c1": {
                "sizeX": 48,
                "sizeY": 24,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 48,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "alarm_badges": {
        "name": "{i18n:custom.diagnostics.states.alarm-badges}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "225675bf-745f-b2bc-b83c-52d751910205": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "all_critical_alarms": {
        "name": "{i18n:custom.diagnostics.states.all-critical-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "d680c934-edcf-4cf0-7073-cc1fb4530391": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "all_major_alarms": {
        "name": "{i18n:custom.diagnostics.states.all-major-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "106a5add-e710-6fea-e975-a7f9b61e2802": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "all_alarm_badges": {
        "name": "{i18n:custom.diagnostics.states.all-alarm-badges}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "8805b23e-efea-86a7-d754-9fdfe37acbaa": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "Measurements_card": {
        "name": "{i18n:custom.diagnostics.states.measurements-card}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6e0676c2-49cd-846e-9c94-80c6b2c0218c": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": false,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Measurements_alarms": {
        "name": "{i18n:custom.diagnostics.states.measurements-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "e6cefd55-e905-d7ce-8f86-08635fbe2679": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_alarms": {
        "name": "{i18n:custom.diagnostics.states.measurement-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4c8da7a1-659f-e2e5-220c-4128a217e872": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": false,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_details_cooling_full": {
        "name": "{i18n:custom.diagnostics.states.data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f0dfbf6c-c2b0-2975-eb81-df9748cae9a5": {
                "sizeX": 80,
                "sizeY": 96,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_details_heating_full": {
        "name": "{i18n:custom.diagnostics.states.data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                "sizeX": 80,
                "sizeY": 70,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": false,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            },
            "breakpoints": {
              "md": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              },
              "sm": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              },
              "xs": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              }
            }
          }
        }
      },
      "Measurement_state_filter": {
        "name": "{i18n:custom.diagnostics.states.measurement-state-filter}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_data_cooling": {
        "name": "{i18n:custom.diagnostics.states.measurement-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7a36c052-6804-1d2c-f3e9-b9ed5dac5420": {
                "sizeX": 80,
                "sizeY": 20,
                "row": 20,
                "col": 0
              },
              "3fda1b23-00b0-4999-0128-01040c961775": {
                "sizeX": 80,
                "sizeY": 21,
                "row": 40,
                "col": 0
              },
              "fe140916-565b-011d-3429-ac76a7b5cb55": {
                "sizeX": 80,
                "sizeY": 20,
                "row": 0,
                "col": 0
              },
              "11062bbc-f7e6-bc7a-f406-642666929251": {
                "sizeX": 80,
                "sizeY": 21,
                "row": 61,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_data_heating": {
        "name": "{i18n:custom.diagnostics.states.measurement-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0ee615fb-cbb2-65ba-136e-f9a02d8c3a9a": {
                "sizeX": 80,
                "sizeY": 46,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "projects_map": {
        "name": "{i18n:custom.diagnostics.states.projects-map}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "fb583db5-3fc6-275a-34f4-120bfe140af2": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "projects_alarms": {
        "name": "{i18n:custom.diagnostics.states.projects-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "58b917d2-5768-b5f9-1e78-e45c9491f4f5": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "all_projects": {
        "name": "{i18n:custom.diagnostics.states.all-projects}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2ffda43e-cad2-521c-6871-338d15b3b4cc": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "project_card_header": {
        "name": "{i18n:custom.diagnostics.states.projects-card}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b84de4e1-8a84-b5cc-6b10-19292fefbb45": {
                "sizeX": 24,
                "sizeY": 7,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "home_dashboard_widgets": {
        "name": "{i18n:custom.diagnostics.states.home-dashboard-widgets}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "dc35f902-3824-8f1b-a870-fee55664d0bd": {
                "sizeX": 12,
                "sizeY": 11,
                "row": 0,
                "col": 0
              },
              "b2beb7ce-103a-560f-cf9c-b7df21827bf0": {
                "sizeX": 12,
                "sizeY": 11,
                "row": 0,
                "col": 12
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "selected_project_map": {
        "name": "{i18n:custom.diagnostics.states.selected-project-map}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0ff674a9-4e70-3742-720a-e681566c9b4f": {
                "sizeX": 7,
                "sizeY": 9,
                "row": 14,
                "col": 0,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "f2279347-4693-4b0a-17c2-15d2887559fa": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      }
    },
    "entityAliases": {
      "783dd5f0-d34d-946d-a82f-95d3a6eaadd1": {
        "id": "783dd5f0-d34d-946d-a82f-95d3a6eaadd1",
        "alias": "Doktorkits",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetNameFilter": "",
          "assetTypes": [
            "Doktorkit"
          ]
        }
      },
      "1d799daf-1882-7a76-938b-c97e8c08ff11": {
        "id": "1d799daf-1882-7a76-938b-c97e8c08ff11",
        "alias": "Selected Doktorkit",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null
        }
      },
      "129977b6-de2f-546b-7df8-2040f39f8732": {
        "id": "129977b6-de2f-546b-7df8-2040f39f8732",
        "alias": "Doktorkit Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Chiller",
            "Freezer",
            "Smart Shelf",
            "Smart Bin",
            "Door Sensor",
            "Liquid Level Sensor",
            "Occupancy Sensor",
            "Smoke Sensor",
            "Motion Sensor",
            "P-Flow D116",
            "Room Sensor CO2",
            "Room",
            "Room Sensor T"
          ]
        }
      },
      "7b659beb-1601-5b67-528e-0846d1a0efa6": {
        "id": "7b659beb-1601-5b67-528e-0846d1a0efa6",
        "alias": "Current user",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "b755362a-b545-8ee6-a67b-df2c9e39d6e5": {
        "id": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
        "alias": "Selected device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null
        }
      },
      "cdf692dd-915b-cdc8-7b51-fc8980c44135": {
        "id": "cdf692dd-915b-cdc8-7b51-fc8980c44135",
        "alias": "Door Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Door Sensor"
          ]
        }
      },
      "15130463-060f-d497-b4ee-39cfc42d3096": {
        "id": "15130463-060f-d497-b4ee-39cfc42d3096",
        "alias": "Occupancy Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Occupancy Sensor"
          ]
        }
      },
      "88fa493d-e8a6-93b9-1d99-ee3d9cbe8487": {
        "id": "88fa493d-e8a6-93b9-1d99-ee3d9cbe8487",
        "alias": "Smoke Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Smoke Sensor"
          ]
        }
      },
      "6073fc37-70ca-4537-f15a-c7dbdd56b343": {
        "id": "6073fc37-70ca-4537-f15a-c7dbdd56b343",
        "alias": "Motion Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Motion Sensor"
          ]
        }
      },
      "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82": {
        "id": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
        "alias": "Current owner",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "b41759e3-cb61-1aaf-8b24-856e5f5a3889": {
        "id": "b41759e3-cb61-1aaf-8b24-856e5f5a3889",
        "alias": "P-Flow D116",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "P-Flow D116"
          ]
        }
      },
      "a1259275-97cf-904a-15a9-9e107522eb5f": {
        "id": "a1259275-97cf-904a-15a9-9e107522eb5f",
        "alias": "Room Sensors T",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor T"
          ]
        }
      },
      "5d6907db-bad0-623f-389a-47e7ee2981b0": {
        "id": "5d6907db-bad0-623f-389a-47e7ee2981b0",
        "alias": "Room Sensors CO2",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor CO2"
          ]
        }
      },
      "d63f1302-8c37-ca6d-76ff-033d16969b1a": {
        "id": "d63f1302-8c37-ca6d-76ff-033d16969b1a",
        "alias": "SelectedEntity",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "SelectedEntity",
          "defaultStateEntity": {
            "entityType": "ASSET",
            "id": "feca5d50-6906-11ef-9bb9-b94f875dce3b"
          }
        }
      },
      "432d69f7-88cf-15c4-69ef-6ea4f27aac50": {
        "id": "432d69f7-88cf-15c4-69ef-6ea4f27aac50",
        "alias": "Selected Doktorkit1",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": false,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "TO",
          "maxLevel": 1,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "assetTypes": [
            "Doktorkit"
          ]
        }
      },
      "d873a1ea-6540-b9dc-b254-70b2900a45d9": {
        "id": "d873a1ea-6540-b9dc-b254-70b2900a45d9",
        "alias": "Single Device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": null,
          "defaultStateEntity": null
        }
      },
      "ae29d67c-e1c3-0479-1e39-9207f44f9990": {
        "id": "ae29d67c-e1c3-0479-1e39-9207f44f9990",
        "alias": "All P-Flows",
        "filter": {
          "type": "deviceType",
          "resolveMultiple": true,
          "deviceTypes": [
            "P-Flow D116"
          ],
          "deviceNameFilter": ""
        }
      },
      "a5025959-4eb0-bbfb-1bef-115e0c344ebf": {
        "id": "a5025959-4eb0-bbfb-1bef-115e0c344ebf",
        "alias": "Measurement",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Measurement"
          ],
          "assetNameFilter": ""
        }
      },
      "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9": {
        "id": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
        "alias": "Selected Measurement",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null
        }
      },
      "cd72a6f3-8ac8-11ef-aa7b-13581cf4c95d": {
        "id": "cd72a6f3-8ac8-11ef-aa7b-13581cf4c95d",
        "alias": "All Entities: Measurement",
        "filter": {
          "resolveMultiple": true,
          "type": "assetType",
          "assetNameFilter": "",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "e84cedc2-95ee-c038-4d48-ef91acc6a4cc": {
        "id": "e84cedc2-95ee-c038-4d48-ef91acc6a4cc",
        "alias": "Temperature Sensor",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Temperature Sensor"
          ]
        }
      },
      "f3843d4e-b8c6-a299-fb02-e522271f7c35": {
        "id": "f3843d4e-b8c6-a299-fb02-e522271f7c35",
        "alias": "sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor CO2",
            "Room Sensor T"
          ]
        }
      },
      "70ff25cd-3d47-b7fc-05e1-765294946bf0": {
        "id": "70ff25cd-3d47-b7fc-05e1-765294946bf0",
        "alias": "Measurement Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement",
          "deviceTypes": [
            "Room Sensor CO2",
            "Room Sensor T"
          ]
        }
      },
      "2ad8a8aa-5f43-9902-6258-79e6421b1fb2": {
        "id": "2ad8a8aa-5f43-9902-6258-79e6421b1fb2",
        "alias": "Projects",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Project"
          ]
        }
      },
      "b0061bd7-595f-a375-e74c-115b41049852": {
        "id": "b0061bd7-595f-a375-e74c-115b41049852",
        "alias": "Measurements",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "3e0192c2-97b8-b3a1-2a43-399659e8d7e1": {
        "id": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
        "alias": "All Projects",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Project"
          ],
          "assetNameFilter": ""
        }
      },
      "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce": {
        "id": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
        "alias": "Selected Project",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null
        }
      },
      "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6": {
        "id": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
        "alias": "Project",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Project"
          ],
          "assetNameFilter": ""
        }
      },
      "906dd8e6-abf4-bc27-7499-1318cb35ac80": {
        "id": "906dd8e6-abf4-bc27-7499-1318cb35ac80",
        "alias": "Measurement Devices1",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement",
          "deviceTypes": [
            "P-Flow D116",
            "Temperature Sensor",
            "Room Sensor T",
            "Room Sensor CO2",
            "RESI",
            "LTE Status",
            "LoRaWAN Gateway"
          ]
        }
      },
      "0995cad1-8408-0071-28a7-c305d95429e2": {
        "id": "0995cad1-8408-0071-28a7-c305d95429e2",
        "alias": "Project Measurements",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null,
          "rootEntity": {
            "entityType": "CURRENT_CUSTOMER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "0aeb5a06-c961-6c9b-d253-199be04f61c5": {
        "id": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
        "alias": "VR Pflow",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "P-Flow D116 VR"
          ]
        }
      },
      "e043f69e-804d-8e1d-062c-7da5becf5b51": {
        "id": "e043f69e-804d-8e1d-062c-7da5becf5b51",
        "alias": "Room Sensor CO2 VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Room Sensor CO2 VR"
          ]
        }
      },
      "430f6413-271a-248e-ea6f-7bfd6fd1f9f6": {
        "id": "430f6413-271a-248e-ea6f-7bfd6fd1f9f6",
        "alias": "Gateway VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Gateway VR"
          ]
        }
      },
      "e23ea274-9aa0-8938-2b73-ff48762a93fc": {
        "id": "e23ea274-9aa0-8938-2b73-ff48762a93fc",
        "alias": "Temperature Sensors VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Temperature Sensor VR"
          ]
        }
      }
    },
    "filters": {
      "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8": {
        "id": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
        "filter": "Device filter",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smart Shelf",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displaySmartShelf",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Freezer",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFreezer",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Chiller",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayChiller",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smart Bin",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayWasteBin",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Door Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayDoorSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Liquid Level Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayLiquidLevelSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Motion Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMotionSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Occupancy Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayOccupancySensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smoke Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displaySmokeSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "P-Flow D116",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPFlowD116",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Room Sensor T",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayRoomSensorT",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Room Sensor CO2",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayRoomSensorCO2",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Temperature Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayTemperatureSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          },
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "state"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "critical",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayCritical",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "major",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMajor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "normal",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayNormal",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          },
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "active"
            },
            "valueType": "BOOLEAN",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": true,
                          "dynamicValue": null
                        },
                        "type": "BOOLEAN"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": false,
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayDisconnected",
                            "inherit": false
                          }
                        },
                        "type": "BOOLEAN"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "35492bf9-fb1b-d326-8b75-f0c24db7a976": {
        "id": "35492bf9-fb1b-d326-8b75-f0c24db7a976",
        "filter": "State filter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "state"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "normal",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayNormalDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "critical",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayCriticalDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "major",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMajorDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "minor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMinorDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "2d011a64-3af4-277a-980d-904145c28912": {
        "id": "2d011a64-3af4-277a-980d-904145c28912",
        "filter": "Progress filter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "progress"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preparation",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPreparationMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "active",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayActiveMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "finished",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFinishedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "aborted",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayAbortedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preperation",
                          "dynamicValue": null
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "dfd37bd2-bb12-d529-9ea0-999958063eb5": {
        "id": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
        "filter": "Progress filter projects",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "progress"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preparation",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPreparationMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "active",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayActiveMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "finished",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFinishedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preperation",
                          "dynamicValue": null
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "409ee35d-10ed-b257-7161-3ee1d74855a5": {
        "id": "409ee35d-10ed-b257-7161-3ee1d74855a5",
        "filter": "CO2",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Room Sensor CO2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "1c512dc2-e762-a4d6-a30a-dc26cd05d381": {
        "id": "1c512dc2-e762-a4d6-a30a-dc26cd05d381",
        "filter": "Temp",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Room Sensor T",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09": {
        "id": "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09",
        "filter": "Project",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Project",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      }
    },
    "timewindow": {
      "aggregation": {
        "limit": 100000,
        "type": "NONE"
      },
      "hideAggInterval": true,
      "hideAggregation": true,
      "history": {
        "historyType": 1,
        "fixedTimewindow": {
          "startTimeMs": 1769506475279,
          "endTimeMs": 1769507413830
        }
      },
      "selectedTab": 1
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": true,
      "showEntitiesSelect": false,
      "showDashboardTimewindow": true,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true,
      "titleColor": "rgba(0,0,0,0.870588)",
      "showDashboardLogo": false,
      "dashboardLogoUrl": null,
      "hideToolbar": false,
      "showFilters": true,
      "showUpdateDashboardImage": false,
      "dashboardCss": ".tb-widget-container > .tb-widget {\n    border-radius: 8px;\n}\n\n.tb-widget-container {\n    border-radius: 8px;\n}\n\n\ngridster-item:not(.tb-noselect) > .tb-widget-container > .tb-widget {\n    cursor: default !important;\n}\n\n.tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-row {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-legend-keys {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-markdown-view .tb-progress-cover, .tb-widget-container > .tb-widget .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-widget-container > .tb-widget .tb-markdown-view div, .tb-widget-container > .tb-widget .tb-markdown-view p {\n    line-height: normal;\n}\n\n"
    }
  },
  "name": "Measurements",
  "resources": null,
  "id": {
    "entityType": "DASHBOARD",
    "id": "d086f510-f6be-11f0-adb4-33b9bcf3ddd0"
  },
  "createdTime": 1768995985121,
  "tenantId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  },
  "customerId": null,
  "assignedCustomers": null,
  "externalId": {
    "entityType": "DASHBOARD",
    "id": "d086f510-f6be-11f0-adb4-33b9bcf3ddd0"
  },
  "version": 175,
  "ownerId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  }
}