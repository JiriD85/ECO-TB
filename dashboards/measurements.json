{
  "title": "Measurements",
  "image": "tb-image;/api/images/tenant/belimo_retrofit_plus_padding.png",
  "mobileHide": false,
  "mobileOrder": 1,
  "configuration": {
    "description": "",
    "widgets": {
      "4d269bd2-0e40-1c62-0385-a1ab42115c6d": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "displayPFlowD116",
                  "type": "attribute",
                  "label": "P-Flow D116",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "gas_meter",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'P-Flow D116';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'P-Flow D116' : 'unset';"
                  },
                  "_hash": 0.6710361911502145,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayRoomSensorT",
                  "type": "attribute",
                  "label": "Room Sensor T",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": true,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "device_thermostat",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value ===  'Room Sensor T';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'Room Sensor T' : 'unset';"
                  },
                  "_hash": 0.08862302790414156,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayRoomSensorCO2",
                  "type": "attribute",
                  "label": "Room Sensor CO2",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "co2",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'Room Sensor CO2';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'Room Sensor CO2' : 'unset';"
                  },
                  "_hash": 0.3664955947097166,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value;"
                },
                {
                  "name": "displayTemperatureSensor",
                  "type": "attribute",
                  "label": "Temperature Sensor",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "thermostat",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'Temperature Sensor';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'Temperature Sensor' : 'unset';"
                  },
                  "_hash": 0.24043001515285378,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showResultMessage": false,
            "showActionButtons": false,
            "showGroupTitle": false,
            "fieldsAlignment": "row",
            "fieldsInRow": 1,
            "rowGap": 0,
            "columnGap": 10,
            "groupTitle": "${entityName}"
          },
          "title": "Filter",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {
            "fontWeight": "bold",
            "fontSize": "14px"
          },
          "titleStyle": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "paddingBottom": "30px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "noDataDisplayMessage": "",
          "widgetCss": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "4d269bd2-0e40-1c62-0385-a1ab42115c6d",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "ff1eb384-d7f3-2a33-ca59-2296652ca079": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "displayNormal",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project.state.normal}",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "required": false,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "useCustomIcon": true,
                    "useGetValueFunction": true,
                    "useSetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'normal';",
                    "setValueFunctionBody": "return value ? 'normal' : 'unset';",
                    "customIcon": "tb-image;/api/images/system/smart_supermarket_dashboard_widget_state_filter_custom_icon.svg"
                  },
                  "_hash": 0.39082762251115444,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "displayMajor",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project.major}",
                  "color": "#4caf50",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "required": false,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "useCustomIcon": true,
                    "useGetValueFunction": true,
                    "useSetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'major';",
                    "setValueFunctionBody": "return value ? 'major' : 'unset';",
                    "customIcon": "tb-image;/api/images/system/smart_supermarket_dashboard_widget_state_filter_custom_icon_(1).svg"
                  },
                  "_hash": 0.34454051580229117,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "displayCritical",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project.state.critical}",
                  "color": "#2196f3",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "required": false,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "useCustomIcon": true,
                    "useGetValueFunction": true,
                    "useSetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'critical';",
                    "setValueFunctionBody": "return value ? 'critical' : 'unset';",
                    "customIcon": "tb-image;/api/images/system/smart_supermarket_dashboard_widget_state_filter_custom_icon_(2).svg"
                  },
                  "_hash": 0.5184545311042434,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "displayDisconnected",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-details.state.disconnected}",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "required": false,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "useCustomIcon": true,
                    "useGetValueFunction": true,
                    "useSetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'false';",
                    "setValueFunctionBody": "return value ? false : true;",
                    "customIcon": "tb-image;/api/images/system/smart_supermarket_dashboard_widget_state_filter_custom_icon_(3).svg"
                  },
                  "_hash": 0.8262637732306279,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showActionButtons": false,
            "showResultMessage": false,
            "showGroupTitle": false,
            "fieldsAlignment": "row",
            "updateAllValues": false,
            "groupTitle": "${entityName}",
            "fieldsInRow": 1,
            "columnGap": 10,
            "rowGap": 5
          },
          "title": "State Filter",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {
            "fontWeight": "bold",
            "fontSize": "14px"
          },
          "titleStyle": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "paddingBottom": "30px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "noDataDisplayMessage": "",
          "widgetCss": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "ff1eb384-d7f3-2a33-ca59-2296652ca079",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "34bb2f8f-4bf0-dac4-a017-badfac3e31bb": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.2843241633853528
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.269921240377482,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "floorplan",
                  "type": "attribute",
                  "label": "floorplan",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8780681509751609
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7387368079086034
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<!--<div fxLayout=\"row\" fxLayoutAlign=\"center center\" style=\"margin-bottom: 20px; padding: 10px; background-color: #ffffff;\">\n    <button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\n        <mat-icon class=\"tb-mat-18\">map</mat-icon>\n        <span>Plan</span>\n    </button>\n    <button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\n        <mat-icon class=\"tb-mat-18\">equalizer</mat-icon>\n        <span>Raw Data</span>\n    </button>\n</div>\n<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\">\n    </div>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n        <div fxFlex=\"50\" fxLayout=\"column\">\n            <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n            <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>\n        </div>\n        <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n        <div fxFlex=\"50\" fxLayout=\"column\">\n            <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n            <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>\n        </div>\n    </div>\n</div>-->\n\n<div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">\n  <div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding-top: 10px; background-color: #ffffff;\">\n    <button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">\n      <mat-icon class=\"tb-mat-18\">map</mat-icon><span>Plan</span>\n    </button>\n    <button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">\n      <mat-icon class=\"tb-mat-18\">equalizer</mat-icon><span>Raw Data</span>\n    </button>\n  </div>\n<div style=\"display: flex; justify-content: flex-end; padding: 10px;\">\n  <button id=\"manage-plan-button\" mat-icon-button style=\"background-color: #fafafa; color: #000;\">\n    <mat-icon>space_dashboard</mat-icon>\n  </button>\n</div>\n\n\n\n\n\n  <div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">\n    <div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\" style=\"flex: 0;\"></div>\n    <tb-dashboard-state style=\"flex: 2;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div style=\"flex: 1; display: flex; flex-direction: row;\">\n      <div style=\"flex: 1; display: flex; flex-direction: column;\">\n        <h5 style=\"padding-bottom: 7px;\">Filter</h5>\n        <tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>\n      </div>\n      <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n      <div style=\"flex: 1; display: flex; flex-direction: column;\">\n        <h5 style=\"padding-bottom: 7px;\">State filter</h5>\n        <tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>\n      </div>\n    </div>\n  </div>\n</div>\n",
            "markdownTextFunction": "var floorplanValue = data[0].floorplan;\n/*console.log(\"floorplan: \",data[0].floorplan);*/\nvar userRole = data[1].role || \"\";\n/*console.log(\"role:\", userRole);*/\nlet mode;\nif (floorplanValue && floorplanValue !== \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K\") {\n    mode = ctx.stateController.getStateParams().tabMode || 'selectedMeasurementPlan';\n} else {\n    mode = ctx.stateController.getStateParams().tabMode || 'selectedMeasurementRawData';\n}\n\n// 2) Conditionally build the Manage Plan button HTML\nvar managePlanButtonHtml = \"\";\nvar planHtml = '';\nif (mode === \"selectedMeasurementPlan\" && userRole !== \"Belimo Retrofit Users\") {\n    managePlanButtonHtml =\n  '<div style=\"display: flex; justify-content: flex-end; padding: 10px;\">' +\n    '<button id=\"manage-plan-button\" type=\"button\" mat-button color=\"primary\" style=\"text-align: center; background-color: #fafafa; width: 200px;\">' +\n      '<mat-icon>map</mat-icon><span>Manage Plan</span>' +\n    '</button>' +\n  '</div>';\n    planHtml = '<tb-dashboard-state style=\"flex: 2;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\">' +\n        '</tb-dashboard-state>';\n} else if (mode === \"selectedMeasurementPlan\" && userRole === \"Belimo Retrofit Users\") {\n    planHtml = '<tb-dashboard-state style=\"flex: 2;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan_user\">' +\n        '</tb-dashboard-state>';\n}\nlet params = ctx.stateController.getStateParams();\n\nvar vm = this;\n\nvm.onInit = function() {\n};\n\nvm.updateMode = function(newMode) {\n    let params = vm.ctx.stateController.getStateParams() || {};\n    params.tabMode = newMode;\n    vm.ctx.stateController.updateState(null, params);\n};\n\nreturn '' +\n'<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n  '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding: 10px 8px; background-color: #ffffff;\">' +\n\n    '<button id=\"plan-button\" ' +\n      'type=\"button\" mat-button color=\"primary\" ' +\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementPlan\\')\">' +\n      '<mat-icon class=\"tb-mat-18\">map</mat-icon>' +\n      '<span>Plan</span>' +\n    '</button>' +\n\n    '<button id=\"raw-data-button\" ' +\n      'type=\"button\" mat-button color=\"primary\" ' +\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementRawData\\')\">' +\n      '<mat-icon class=\"tb-mat-18\">equalizer</mat-icon>' +\n      '<span>Raw Data</span>' +\n    '</button>' +\n  '</div>' +\n\n  // Instead of inlining a ternary for the manage-plan button, we insert our variable:\n  managePlanButtonHtml +\n\n  (mode === 'selectedMeasurementRawData'\n    ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_raw_data\">' +\n      '</tb-dashboard-state>'\n    :\n      '<div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">' +\n        planHtml +\n        '<mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>' +\n        '<div style=\"flex: 1; display: flex; flex-direction: row;\">' +\n          '<div style=\"flex: 1; display: flex; flex-direction: column;\">' +\n            '<h5 style=\"padding-bottom: 7px;\">Filter</h5>' +\n            '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"measurement_filter\">' +\n            '</tb-dashboard-state>' +\n          '</div>' +\n          '<mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>' +\n          '<div style=\"flex: 1; display: flex; flex-direction: column;\">' +\n            '<h5 style=\"padding-bottom: 7px;\">State filter</h5>' +\n            '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"state_filter\">' +\n            '</tb-dashboard-state>' +\n          '</div>' +\n        '</div>' +\n      '</div>'\n  ) +\n'</div>';\n\n\n/*var floorplanValue = data[0].floorplan.value;\n\nif (floorplanValue) {\n    // Return HTML if floorplanValue is not null, undefined, empty string, 0, or false\n    return '<div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">' +\n      '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding-top: 10px; background-color: #ffffff;\">' +\n        '<button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">' +\n          '<mat-icon class=\"tb-mat-18\">map</mat-icon><span>Plan</span>' +\n        '</button>' +\n        '<button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">' +\n          '<mat-icon class=\"tb-mat-18\">equalizer</mat-icon><span>Raw Data</span>' +\n        '</button>' +\n      '</div>' +\n      '<div style=\"display: flex; justify-content: flex-end; padding: 10px;\">' +\n        '<button id=\"manage-plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \"\">' +\n          '<mat-icon> map</mat-icon><span>Manage Plan</span>' +\n        '</button>' +\n      '</div>' +\n      '<div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">' +\n        '<div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\" style=\"flex: 0;\"></div>' +\n        '<tb-dashboard-state style=\"flex: 2;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>' +\n        '<mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>' +\n        '<div style=\"flex: 1; display: flex; flex-direction: row;\">' +\n          '<div style=\"flex: 1; display: flex; flex-direction: column;\">' +\n            '<h5 style=\"padding-bottom: 7px;\">Filter</h5>' +\n            '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>' +\n          '</div>' +\n          '<mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>' +\n          '<div style=\"flex: 1; display: flex; flex-direction: column;\">' +\n            '<h5 style=\"padding-bottom: 7px;\">State filter</h5>' +\n            '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>' +\n          '</div>' +\n        '</div>' +\n      '</div>' +\n    '</div>';\n} else {\n    // Return HTML if floorplanValue is null, undefined, empty string, etc.\n    return '<div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">' +\n      '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" style=\"margin-bottom: 20px; padding: 10px; background-color: #ffffff;\">' +\n        '<button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">' +\n          '<mat-icon class=\"tb-mat-18\">map</mat-icon>' +\n          '<span>Plan</span>' +\n        '</button>' +\n        '<button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">' +\n          '<mat-icon class=\"tb-mat-18\">equalizer</mat-icon>' +\n          '<span>Raw Data</span>' +\n        '</button>' +\n      '</div>' +\n      '<div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">' +\n        '<div fxLayout=\"row\" fxLayoutAlign=\"end center\"  style=\"flex: 0;\"></div>' +\n        '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_raw_data\"></tb-dashboard-state>' +\n      '</div>' +\n    '</div>';\n}\n*/",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n/*.market-layout {\n    position: relative;\n    padding-top: 0; \n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n    margin-top: 0; \n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n    margin-top: -5px; \n}*/\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n.tb-widget-container .tb-widget .leaflet-control-zoom {\n    display: none;\n}\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "raw-data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['tabMode'] = 'selectedMeasurementRawData'; \nconsole.log(params);\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "473c03b6-d4f0-a790-a16c-123eed809d64"
              },
              {
                "name": "plan-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['tabMode'] = 'selectedMeasurementPlan'; \nconsole.log(params);\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "636654fb-e2d7-fa7c-4356-aad908ca2a98"
              },
              {
                "name": "manage-plan-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "add_plan",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "650px",
                "popoverHeight": "200px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "a2b3cbcd-96e7-c9e7-c76f-5dda0d890f93"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "34bb2f8f-4bf0-dac4-a017-badfac3e31bb",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "7a37cf70-51c1-aef6-ef15-27041e016bd5": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a1259275-97cf-904a-15a9-9e107522eb5f",
              "filterId": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
              "dataKeys": [
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.07057010303477718
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8768256363159095
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7481769686268884
                },
                {
                  "name": "xPos",
                  "type": "attribute",
                  "label": "xPos",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.1947251343876919
                },
                {
                  "name": "yPos",
                  "type": "attribute",
                  "label": "yPos",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8911555639185675
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8300505638957978
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#0091ea",
                  "settings": {},
                  "_hash": 0.32082557959927205
                },
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "temperature",
                  "color": "#512da8",
                  "settings": {},
                  "_hash": 0.24680864685323223,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "5d6907db-bad0-623f-389a-47e7ee2981b0",
              "filterId": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
              "dataKeys": [
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.7876756601471564,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#afb42b",
                  "settings": {},
                  "_hash": 0.8133480088844827,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#00796b",
                  "settings": {},
                  "_hash": 0.4937093092511089,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "xPos",
                  "type": "attribute",
                  "label": "xPos",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.18823677296060626,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "yPos",
                  "type": "attribute",
                  "label": "yPos",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.6309039008437192,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.3746151295694715,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#ff6d00",
                  "settings": {},
                  "_hash": 0.023710096563531735,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "co2",
                  "color": "#512da8",
                  "settings": {},
                  "_hash": 0.4460309311574986
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "selectedDevice",
                  "color": "#c51162",
                  "settings": {},
                  "_hash": 0.7145163667848988,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value === 'true' || value === 'false') {\n    return true;\n} else {\n    return false;\n}"
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "b41759e3-cb61-1aaf-8b24-856e5f5a3889",
              "filterId": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
              "dataKeys": [
                {
                  "name": "xPos",
                  "type": "attribute",
                  "label": "xPos",
                  "color": "#689f38",
                  "settings": {},
                  "_hash": 0.11251144843157146,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "yPos",
                  "type": "attribute",
                  "label": "yPos",
                  "color": "#303f9f",
                  "settings": {},
                  "_hash": 0.76013730882728,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#fbc02d",
                  "settings": {},
                  "_hash": 0.42670180691148096,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#0288d1",
                  "settings": {},
                  "_hash": 0.8298562942134391,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#c2185b",
                  "settings": {},
                  "_hash": 0.6222873037249923,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#f57c00",
                  "settings": {},
                  "_hash": 0.45753130895487804,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "volumeFlow",
                  "color": "#512da8",
                  "settings": {},
                  "_hash": 0.19307298224311076,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "image-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "OpenStreetMap.Mapnik",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": true,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "Selected Measurement",
            "imageUrlAttribute": "floorplan",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": null,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": true,
            "disableDoubleClickZooming": true,
            "disableZoomControl": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0,
            "markerOffsetY": 0.5,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": true,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "<div style=\"position: relative; white-space: nowrap; text-align: center; font-size: 12px; top: -5px;\"><span style=\"margin-left: -500%;\"></span><span style=\"border-radius: 10px; color: #fff; background-color: #666; padding-left: 5px; padding-right: 5px; padding-top: 3px; padding-bottom: 3px;\">${entityLabel}</span><span style=\"margin-right: -500%;\"></span></div>",
            "labelFunction": null,
            "showTooltip": true,
            "showTooltipAction": "hover",
            "autocloseTooltip": true,
            "useTooltipFunction": true,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}",
            "tooltipFunction": "var content = '<div style=\"font-family: Roboto;\">' +\r\n                 '<div style=\"font-size: 18px; font-weight: 500; padding-bottom: 8px;\">${entityLabel}</div>';\r\n                 \r\nvar deviceType = data['Type'];\r\nif (typeof deviceType !== undefined) {\r\n    content += '<div style=\"font-size: 13px; font-weight: normal;\">' + getInfoByDeviceType(deviceType) + '</div>';\r\n}\r\ncontent += '</div>';\r\nreturn content;\r\n\r\nfunction getInfoByDeviceType(type) {\r\n    switch (type) {\r\n        case 'P-Flow D116':    \r\n            return 'Volume Flow: ${volumeFlow:0} l/hr';\r\n        case 'Room Sensor T':\r\n            return 'Temperature: ${temperature:1}%';\r\n        case 'Room Sensor CO2':\r\n            return 'CO2 Level: ${co2:0}%';\r\n        case 'Door Sensor':\r\n            var open = data['open'] === 'true';\r\n            return 'State: ' + (open ? 'Open' : 'Closed');\r\n        case 'Motion Sensor':\r\n            var movement = data['movement'] === 'true';\r\n            return 'Movement detection: ' + (movement ? 'Detected' : 'None');\r\n        case 'Occupancy Sensor':\r\n            var occupied = data['occupied'] === 'true';\r\n            return 'State: ' + (occupied ? 'Occupied' : 'Vacant');\r\n        default:\r\n            return 'TODO';\r\n    }\r\n}\r\n",
            "tooltipOffsetX": 0.5,
            "tooltipOffsetY": -0.5,
            "color": "#FE7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var defaultMarkerWidth = 30;\nvar type = data['Type'];\nvar state = data['state'];\nvar active = data['active'];\n\n// Determine the status based on state and active flag\nvar status = state;\nif (active === 'false') {\n    status = 'disconnected';\n}\n\n// Get text for the device (e.g., temperature, CO2, or flow reading)\nvar text = getDeviceText(type, status);\n\n// Get the background color based on type and status\nvar color = getBackgroundColor(type, status);\n\n// Get the device image (base64 string)\nvar base64Image = getImage(type);\n\n// Build the SVG string: draw the circle, overlay the image,\n// and add text (if any) below the circle.\nvar svgStr = '<svg width=\"' + defaultMarkerWidth + '\" height=\"' + defaultMarkerWidth +\n             '\" xmlns=\"http://www.w3.org/2000/svg\">' +\n             // Draw the circle using the dynamic background color\n             '<circle cx=\"' + (defaultMarkerWidth / 2) + '\" cy=\"' + (defaultMarkerWidth / 2) +\n             '\" r=\"' + (defaultMarkerWidth / 2) + '\" fill=\"' + color + '\"/>' +\n             // Embed the base64 image on top of the circle\n             '<image href=\"' + base64Image +\n             '\" x=\"' + (defaultMarkerWidth / 4) + '\" y=\"' + (defaultMarkerWidth / 4) +\n             '\" width=\"' + (defaultMarkerWidth / 2) + '\" height=\"' + (defaultMarkerWidth / 2) + '\"/>';\n// Optionally add text if one is returned from getDeviceText\nif (text !== '') {\n    // Here, we position the text centered below the circle.\n    // Adjust x, y, font-family, font-size, or fill as needed.\n    svgStr += '<text x=\"' + (defaultMarkerWidth / 2) + '\" y=\"' + (defaultMarkerWidth + 12) +\n              '\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"10\" fill=\"black\">' + text + '</text>';\n}\nsvgStr += '</svg>';\n\n// Encode and build the SVG URL\nvar encodedSvg = btoa(svgStr);\nvar svgUrl = 'data:image/svg+xml;base64,' + encodedSvg;\n\nreturn {\n    url: svgUrl,\n    size: defaultMarkerWidth,\n    markerOffset: [defaultMarkerWidth / 2, defaultMarkerWidth / 2],\n    tooltipOffset: [defaultMarkerWidth / 2, -defaultMarkerWidth / 2]\n};\n\nfunction getBackgroundColor(type, status) {\n    switch(status) {\n        case 'major':\n            return '#D5C21B';\n        case 'critical':   \n            return '#E64A19';\n        case 'disconnected':\n            return '#CAC1D2';\n        case 'normal':\n        default:    \n            switch(type) {\n                case 'Room Sensor T':\n                    return '#4A8AEC';\n                case 'Room Sensor CO2':\n                    return '#4A8AEC';\n                default:\n                    return '#1F8B4D';\n            }\n    }\n}\n\nfunction getDeviceText(type, status) {\n    switch(status) {\n        case 'disconnected':\n            return 'NO CONN';\n        case 'normal':\n        default:\n            switch(type) {\n                case 'Temperature Sensor':\n                    var temperature = Number(data['temperature']);\n                    return 'T: ' + temperature.toFixed(1) + ' C';\n                case 'Room Sensor CO2':\n                    var co2 = Number(data['co2']);\n                    return 'CO2: ' + co2.toFixed(1) + ' ppm';\n                case 'P-Flow D116':\n                    var vFlow = Number(data['volumeFlow']);\n                    return 'Flow: ' + vFlow.toFixed(3) + ' L/hr';\n                default:\n                    return '';\n            }\n    }\n}\n\nfunction getImage(type) {\n    switch(type) {\n        case 'P-Flow D116':\n            return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAABklJREFUeF7tnUuoHUUQhv9fF+pGzcLoytfGFyoKgqIBQ6ImPhA1LjQKogaMwQdKfIEoKEYiBh+YCEYR1AREcaFJfGLA6EYQoqi4MSKIjyw0IqircirM1ZPrme453TXThzvVcLiL6eqqqW96pqen+7+El6IZYFHv7hwOoPBF4AAcQOEMFHbvPcABFM5AYffeAxzAvhkQEQnlhGTwosm175vH1PWA3ATm2jsA7wF9XwN+Cyqb8Vnec28hufZ9J8OfAX1nfJY/B+AA/BnQyzUgIgcAuBbA6QCOHPkd0ksAzU72APh+5PcZgJdI/t1HXJ3fgkTkHACXAVgJ4KA+TsrAx58ANgB4g+QOg/Yam+gUgIg8A+DmLk+gh7bXk1zVlZ/OAIjIhwDO7SrwntvdTnJhFz47ASAivwA4rIuAC7a5m+R8a//mAETkWwDHWAc6Je3tInmsZSymAETkOQA3WgY4hW1tJLnCKi4zACLyCIB7rQKb8nbWkLzPIkYTACKyCMD7LQPSYd1mAF8B+LIaYexuaddJtWqkps+qkwCcCOCq6jx02NymLCb5QZuKoTpWAJ6vXmSubxHMkyRvb1GvWBUReQLAbS0CeIHkDS3qBatkAxCRA6uAfwWgfxtL7EtW7olY28dmVQH8BWAeSf2bXCwA3FS/NYaCuIbkK8lRFjAUkeUAXo64Xkny2ZzwLACsr6cZmuLYRvLCnCBL2YrIVgBLA/43kMx607cA8BaAiwJB3kry6VJJzPErIrcAeCrQxhaSF+f4sADwOYCTA0FcQPLdnCBL2YrI+QDeCfj/guQpOfFZAPgNQGhK+QiSP+cEWcpWRA4H8FPA/x6Sh+bEZwGg03U8OSfXxjY2OouNhmL2sRgcQOGFXg7AAYSXIsa6cO7x2C3Eb0G5GY7YO4DIUsSO8w8H4ADyrrHce2TMPi+6uPXge0A8RWVrxC6QGMBY9MWHobEASx93AIUJOAAHEM5A11dI4fyj6/PzZ0CEsAMo3AUcQACAiNyhh0mu64qTA2jIrIhcDWDmQ/9ykpu6gOAAxmRVRJYA2Dbr0FKSb1tDcACzMioiZwB4s1oKo58LR4t+9ryE5KeWEBzASDZF5Kg6+U2LAHSBwBKSP1pBcAB1JkVkfwC6BEZvP6GymaQ+H0yKA/gPwCRL3+8n+bAFAQcA6Nvog9WfByZM6DKSr09o87/qgwcgIrq7Upc/Tlp0wfClJD+a1HC0/qABiIgu+9MRT2r5BsCiakfLD6kNDB3Aq9UmjitTk1fbrSV5d2obgwUgImcB+CQ1cSN2uun6TJI6RJ24DBnAWgCrJ87YeIPHSN6V0taQAWwBYLWvYGv1hhxaQt/IZsgAdgE4OuWqHWPzHcmkvctDBqAqJgcbAfidZJIqy5ABvAdgsRGA90mel9LWkAGsqXYi3pOStDE2j1b6P0mbyIcMoM0uxbZ8kndpDhnAPAAfAzihbZYb6n0N4GySOjUxcRksAM2UiFwB4LWJs7avQdak3KAB1BBi+5BDfLL38Q4eQA0hRYllHck7M3uPL8yaSaCIHA/gIQDLIknV+aPVJC3mkRzA7GSLyOW19OVpAPS3X6XKuBOATrbpT5UO/8i98kfAZ23DjcVhsTQxtlF7fmlNoFgSmo7XWkKqf9dUpmKjdkyqYCHJ7alJKGknIqr6qOqPTWUqpApiYh2rKrXBlE+KJXO/13el/qhKKKp92lSmQqwjNkzcUUl7LSiezYQAKik2/Z4ckjDLHuZaPANUJVGXjITK1EuVjXnYt5EuW0FyYwLbf00sAKgot77mB3Whczez5Zxkim3sBQyAfupUybIske9sAPW98nEAe5eKR0rypFisYavjLaXK1J3Ji54VAL1Ptl1/o6ua9adLRnaW1hKqNYFOraQ0j6vlyUISZaOcF1goq5sAqHvBXFBKb9uRzBTVzQDUEOaSYnoTDFMldVMANYS5qJw+A8NcQd0cQA1hLiqomyuna646AVBDmGQ5edt7b6l6porpoyfRGYAaQso8fqkkN/k1U0of56BTADUEVVbXHSv6C+pLT1HmVQ9ad11uslBID51X5wBmnNci39cBUKHTaf43Vjq7+2KuKHfbi6k3AG0DGlo9B1CYuANwAIUzUNi99wAHUDgDhd17D3AAhTNQ2P0/iaIqjpSUnaoAAAAASUVORK5CYII=';\n        case 'Temperature Sensor':\n            return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAABWlJREFUeF7tnUnIXEUQx/9/FUFQESXiloMaMYKCCqIHowaDR0XciAZDQIkXUVwQFzABF9DoQTwoeohL3CPo0QUlCbhBggsYcUEwuKIHPQiilK/kDcSPzPTr15WuHqiGj29gqqu6/r/Xy/Sb6UdEcVWArtEjOAKA80UQAAKAswLO4aMHBABnBZzDRw8IAMMVEJEDAZwG4FQAZwE4G8A+AN4D8CGATwB8TPKn4V59LeemB4jIzQBuBHDMAMkeIHnbADt3k+YBiMixAF4EcEamWl8AWElyR2a9quZNAxCRdQDuLlRkPUn102RpFoCILALws5FqS0h+beTL1E3LAF4AcIVRtjtInm7ky9RNkwBEZBWAZ0wzBZocipoDICIH6VISgE6+1uUCkm9aOy3x1yKA87v1/VsDkrocwJbe7hwALw2ocwPJRwbYVTNpEcDtAO6bpQC7Zc2e3pdu2ZRQ7nGS11VTd0CgFgG82g1BF89o+0XdhPr6FAAXdp+UX5tRdwvJcwfoUs2kRQC7ABw9Q4GjSP4wBcCRAL6fUfcXkodXU3dAoBYBzBxGpg0/k1xTw1Cq/gDNTE0CgKmc+c4CQL5mpjUCgKmc+c7mHkBqzF8oScwBiYskJehCAVP2ASCzV6YEDQCZguaaB4BcxYztcwEsDF9a3zidpLu5n4QDQJJxnkHpFVxaP6+15dbRA8o1LPIQAIrkK68cAMo1LPIQAIrkK68cAMo1LPIw9wBSq57Yisi8PlKCxlZEpqC55gEgVzFj+wBgLGiuu1wAsRWRq3DCPgAYC5rrLgDkKmZsHwCMBc11lwKQ6y8+B2QqFgAyBbM2DwDWimb6CwCZglmbBwBrRTP9BYBMwazNA4C1opn+AkCmYJbmRj/MTjXpfpJ3pIxqvd/MDZlK4k90fZTk9bVEnhWnCQCVxZ/osZHkGm8I7gD6U1A2OAnhDsEVgIgsB6A/nN7XCYCGXUNyo1d8NwAicgiAN0YcQ2Ot1bcAlpPU/9WLJ4DHAKytnvGeA7oNRS4ARESPGtvaiPiTZiwjua12m7wAPATgptrJJuI9TFKPRatavADo4UnHVc00HewbksenzWwtqgMQkfMAvGObhpk3nYzfNfM2wJEHAD0JRU9EabFU36bwAPAUgKtbVL8bFp8mubpm2zwA6GFMeihTi+XtbiW0ombDPAB8DmBpzSQzYu0keVKGfbGpB4DfAei5cC2WP0geXLNhHgB+BXBozSQzYv1G8rAM+2JTDwDvAzizuOV7x8EHJPVQ8GrFA8CzAK6qlmFeoE0k9czSasUDgJ4F3epZzuu6X+Csr6Y+UP8pSiKiV7/2ghbLKpKbajbMowecCGBnzSQzYi0lqcfeVyvVAWhmIqJb0bol3VLZRnJZ7QZ5AbimOxv0idrJJuJdS/LJ2m3yAnAEgO8A7Fc74Snx/gawuDvW+Mfa7XEB0A9DOtldWTvhKfGeI+myNPYEoOOtbszt7wzhLwArSLrcInUD0PeCWwA86AzgVpJe30uq/zlgodgi8gqAS5wgbCZ5qVPs/8K69oBJ4iKiE/KQ54NZarWL5GJLh2N8NQGgH44+BXDymCRG1PmM5Ckj6plXaQZAD+HObml6j3mW/3d4F8l793KMwe6bAtBDuKx7gI/eNz5gcBbDDP8EsJrky8PM61g1B6CHoI8t1BWSTs6lX9z9B8BmABtIflRH1uFRmgSw2+Ssk+TK/oFuuQ9i294/g/J5kjrJN1maBrC7YiKiN8sVwgnddvaS/k9fa/kSwFf9n77eTlJv/jdf5gZA80qObGAAGCmcVbUAYKXkSD8BYKRwVtUCgJWSI/0EgJHCWVULAFZKjvQTAEYKZ1XtXyJe8HBzPYhKAAAAAElFTkSuQmCC';\n        case 'Room Sensor CO2':\n            return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAAAqhJREFUeF7tmtFNAzEQRNdVgCiGEuCPIuGLPmgDJKowCkqiA5R4d2/Pw0kv316PPc/j8/nSjJ/UgSZVR9wAIF4EAACA2AGxPAkAgNgBsTwJAIDYAbE8CQCA2AGxPAkAgNgBsTwJAIDYAbE8CQCA2AGxPAkAgNgBsTwJAIDYAbE8CQCA2AGxPAkAgNgBsTwJAIDYAbE8CQCA2AGxPAnYK4De+7OZ3ZvZTXAOH2b21lp7jNTN1ouMbU3bVAJ6732N6Km2tebSn61XMTdvHy4Dlp313l/N7MErMGj30lp7utZmtl7RvNzdZAC8m9mdW+F6w8/W2u0AwFS9onm5u8kAKNl+vNtQ1fbj1XM7V9QQAEVGZrspAzB6oF5ayf+tLmtktg4AWeeK6qYByI53dnKy48zWASDrXFEdAIqMzHYDgKxzRXUA+GXkiveO1B0XAOoAnHsaHa2XkgDYAICZDe+4zm/m0a0seyyM6pzaZ/Wq64LjH95xTQdQbcgo5tV6QQA2Gh8ALji64iH8o8fpAKIr5LwCBh9lqgzx6kXnkU1aeQKiA/caAoC/p4SpH0h671P1ogtJkQA+SS4oTQdw0K7aFrwPqtl6xzlm//VxKN/uGLo4n2cHmHpln/m3lALg272IRffIvbWv+BeGN9kHb8JXEXszNDreFQ/9VLIB4LwLiqzqCHQAACCyXrZvu/ZYGR0hCSAB0TWzbfuCI+j3AL3PDBLgTEAUOwCijh3bk4CkcVVlAKhyMtkPAJLGVZUBoMrJnfTDKUgMCgAAEDsglicBABA7IJYnAQAQOyCWJwEAEDsglicBABA7IJYnAQAQOyCWJwEAEDsglicBABA7IJYnAQAQOyCWJwEAEDsglicBABA7IJb/ArGXeHBt7cNGAAAAAElFTkSuQmCC';\n        case 'RESI':\n            return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAABbZJREFUeF7tnUnoHEUUxr8PbwpKEBeU5KigBxe8uOASwQ03FANuJxdEo2LAixfjxYsQcUkQl5MbKIobRgVjDC4XcTko6FFREoOIgt7k2U9qknb+01Ndb6q7p3peQTN/0vVeVX2/2rpSXU14GFQBDpq6Jw4HMHAlcAAOYGAFBk7eW4ADGFiBgZP3FuAAuldARM4HsB7AhvBb/1sz8BOAH8Pvgb9J7u46d6NsASKiAp8H4BIAVwA43CjknwDeBvAegI9JKpysYTQARERFvi8If0FWlQ46+wjAngroNpIKZ+EwCgAicksQ/+SFFWnn4FsAj5J8rl305lhFAxCRi4Pw+jtEeD+A0F9TKBJA6G62VYOm1vxlCNoStli6peIAiMhJAJ4BcNYyKF/Lw2cAbiP5XUq+igIQuhytbcenFLLHuD9rqyTZuksqBkAYaJ81ivk3gA8BfF7VUhWpfqlLBVq/zgRwIYBDjend2naALgKAiGwF8GCiGF8C0JqoU8ddJP9JsReRQ6op58Zq/q9TWh3kT0+xB/AQSc333FAEAC1BAoTvAewAsD1V9CalAoy7ANwJ4MSYqG3FVz/FAGgBQbuVifB/tBApOYqIHAFgAqJpHGpV8yeJFwVgDgTtZu4g+UOyqgYDETkBwFOhe6p7SBK/uBYwKelUd/Q8gM2WObhB+wMm4VnkSQA3h39MFr9YALWWcBjJ+9sIKSLaZVwH4FoA62qXmv9eu14D8CpJ7dKiQUQeAfBXmwF3lrPiuqCoIlMRRORyADcAuD7R9mUAL5F8J9EuKfpoAQThbw/L0UmiTEXW5einuwIxSgAion2zzlZyBp3Wbs7psOgxYJYQInIkgFfCA1RurdTfLgCbSP6Wy/moWkDCw9oi+plmO00JjgpAbXaUumzRFkhW8UfXBU1U7KglZBd/tAAiLeF1ALpQ91W4NPpp4dIFt2tmNIdOxB81gBkQvg6LZG/M629E5Oqw8npqiNeZ+KMHUINwLICHSeren2gQEd0/9EC1vrTX+oQbTSREGN0g3LbgyxLPAQxMwgE4gH4VkGqOOi9FVp1+nznqNbE+C9aUlgMYmIIDcAD/U8C7oKkK4WNAxy3Eu6COBY65dwAxhTq+7wA6Fjjm3gHEFOr4vgPoWOCYewcQU6jj+w6gY4Fj7h1ATKGO7zuAjgWOuXcAMYU6vj86ACJyKQC99M2RUwAc07GGQ7vfB+CbarOvvomzk+TORTK00GKciLwA4MZFMjAC2xdJ3mQthxlArClbM1SqnXUV1QRARO6pXnB4rFSxOsr3vSQfT/WdDEBEzgbwSWpCKxL/HJKfppTVAmB7eF0zJZ1VibuDZNJ7CRYA+kainkDlYa0Cu0kmnVVkAfBr9RL0Ua7+TAX2kzw6RRsLgKXaV5NS2BxxY7O/1NmQA0ik4gASBcsd3QHkVjTRX7EARORNAGeE8n5B8qo2Ze/bLpanIgE0ZTo2YPVtFxNf7xcHoDrjTd/b1TMaZgU9k2HTrBt927URv1QAe+csUe8jqa8PrQki0qvdmAHoqSPHNRTwF5IzDz4SkV7txgxAB98rGwr4VtNgHAbf3uxGC2Bev+mDsOHMOOssIAyq54aatqdp8J2uiX3bxVqCtfxNfn0pIqb41H0HkChY7ugOILeiif4cQKJguaMvA4B5D0i5y1uav8YHy5yDsJ7HfFFpyvSU3w9IJn1MwjIL0q0Xd/dUoNKSeYKkbtlpHSwAdBviu61TWK2Il6VuVUwGEJ5sfUvi2opl2qJoAjBveWG1KvzB0saWVbINwnVHvkXxPzVMWxInOppbwMRB2KqoZzPrx3X0O15j3zO0v/oPJv2OmH6sR8+WTtqKON0SFgawql1OrnI7gFxKGv04AKNwucwcQC4ljX4cgFG4XGYOIJeSRj8OwChcLjMHkEtJox8HYBQul5kDyKWk0Y8DMAqXy8wB5FLS6Odf4H9af8IAZ/UAAAAASUVORK5CYII=';\n        default:\n            return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAAAXNSR0IArs4c6QAAAr9JREFUeF7tnMFtFEEQRX8FAeQAIZgLFyRSADJAhljgQASQAhY3LgTAkQxABNHIB0tey5r+M7N/SwvPV/+pmn2va3u9694SP60EqrU7zYWA5kWAAAQ0E2huzwQgoJlAc3smAAHNBJrbMwEIaCbQ3J4JQEAzgeb2TAACmgk0t2cCENBMoLk9E4CAZgLN7ZkABDQTaG7PBCCgmUBzeybg3ASMMS4kvZT0WNITSQ+aH0N3+9+Sfkj6Kemqqq7W3NCqCRhjvJX0fk2D/zD7uapeu4/bFjDGGG5RclJVWWyt0Bjjk6RXgF1F4F1VfZhdMRUwxngh6cusEL+/l8DTqvq+xMYRcG3xEsCbCHysqjd7BXyV9HxTey76VlXP9gr4JekRLDcR+FNVD/cKWHz14+72NzcxezU1q9d9/V2Ye+/H2QMQsLCEEXAHTnqCmIDJH4QImOxVe0e2+3omgAk4XAOzkT/2imECVm56CFh+U46Xoc0LCgEIWLensAc0rxgEIOCAwN4FwR7QvKAQgAA24cV3b/Y+x236GOOMLtrL5+RPQWfE1rpVBFiYciEE5NhalRFgYcqFEJBja1VGgIUpF0JAjq1VGQEWplwIATm2VmUEWJhyIQTk2FqVEWBhyoUQkGNrVUaAhSkXQkCOrVX5FAI4oGGpuDd0lAMaHFHaLuAoR5Q4pLddwFEO6XFMdbuA/cdUr3tzUHuTgeMc1L5pPdvtN93iP3yR+2/70w/lbzPiyzqsFZP5so5bk8DX1Rx6ON3X1Vj+Ca0isOopaFVlwhYBBFiYciEE5NhalRFgYcqFEJBja1VGgIUpF0JAjq1VGQEWplwIATm2VmUEWJhyIQTk2FqVEWBhyoUQkGNrVUaAhSkXQkCOrVUZARamXAgBObZWZQRYmHIhBOTYWpURYGHKhRCQY2tVRoCFKRdCQI6tVfkvVs8Uf+O+5tAAAAAASUVORK5CYII=';\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*var type = data['Type'];\nvar active = data['active'];\nvar state = data['state'];\nvar selectedDevice = data['selectedDevice'] === true;\nvar selectedMode = dsData.filter(function (data) { return data['selectedDevice'] === true; }).length > 0;\n\nvar status = state;\nif (active === 'false') {\n    status = 'disconnected';\n}\n\nvar text = getDeviceText(type, status);\n\nvar defaultMarkerWidth = 30;\n\nvar width = defaultMarkerWidth + getTextWidth(text);\n\nvar svgStr = getDeviceSvg(type, status, width, text, selectedDevice);\n\nvar encodedSvg = encodeURIComponent(svgStr);\n\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\n\n\nvar newWidth = width * 0.5;\nif (selectedDevice) {\n    width += 8;\n    defaultMarkerWidth += 8;\n}\n\nreturn {\n    url: svgUrl,\n    size: width,\n    markerOffset: [defaultMarkerWidth / 2, defaultMarkerWidth / 2],\n    tooltipOffset: [width * 0.5 - defaultMarkerWidth / 2, - (defaultMarkerWidth / 2)]\n};\n\n\n\nfunction getDeviceSvg(type, status, width, text, isSelected) {\n    var shape = getDeviceShape(type);\n    var color = getBackgroundColor(type, status);\n    var background = getDeviceBackground(color, width);\n    var svgWidth = isSelected ? (width + 8) : width;\n    var svgHeight = isSelected ? 38 : 30;\n    \n    var opacity = selectedMode && !selectedDevice ? 0.4 : 1;\n    \n    var deviceSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgWidth + '\" height=\"' + svgHeight + '\" viewBox=\"0 0 ' + svgWidth + ' ' + svgHeight + '\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                    wrapIfSelected(background + shape, isSelected);\n    if (status === 'disconnected') {\n        deviceSvg += wrapIfSelected('<path d=\"M6.92896 21.728L21.0711 7.58589L22.4853 9.00011L8.34317 23.1422L6.92896 21.728Z\" fill=\"' + color + '\"/>' +\n                     '<path d=\"M7.10692 21.3171C6.81393 21.0241 6.81393 20.5491 7.10692 20.2561L20.1852 7.17788C20.4781 6.88489 20.9532 6.88489 21.2462 7.17788V7.17788C21.5392 7.47088 21.5392 7.94591 21.2462 8.2389L8.16794 21.3171C7.87495 21.6101 7.39991 21.6101 7.10692 21.3171V21.3171Z\" fill=\"white\"/>', isSelected);\n    }\n    if (text !== '') {\n        var transform = isSelected ? '34 10' : '30 6';\n        deviceSvg += '<text transform=\"translate(' + transform + ')\" fill=\"white\" xml:space=\"preserve\" style=\"white-space: pre\" font-family=\"Roboto\" font-size=\"15.4\" font-weight=\"500\" letter-spacing=\"0em\"><tspan x=\"0.10664\" y=\"14.2637\">' + text + '</tspan></text>';\n    }\n    if (selectedDevice) {\n        deviceSvg += getDeviceSelectionStroke(width);\n    }\n    deviceSvg += '</svg>';\n    return deviceSvg;    \n}\n\nfunction wrapIfSelected(svg, isSelected) {\n    if (isSelected) {\n        return '<g transform=\"translate(4 4)\">' + svg + '</g>';\n    } else {\n        return svg;\n    }\n}\n\nfunction getDeviceBackground(color, width) {\n     if (width === 30) {\n         return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>';\n     } else {\n         return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>' + \n                '<circle cx=\"' + (width - 15) + '\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>' +\n                '<rect x=\"15\" y=\"0\" width=\"' + (width - 30) + '\" height=\"30\" rx=\"1\" fill=\"'+ color +'\"/>';\n     }\n}\n\nfunction getDeviceSelectionStroke(width) {\n     if (width === 30) {\n         return '<circle cx=\"19\" cy=\"19\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n     } else {\n         var rectWidth = width + 6;\n         return '<rect x=\"1\" y=\"1\" width=\"' + rectWidth + '\" height=\"36\" rx=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n     }\n}\n\nfunction getBackgroundColor(type, status) {\n    switch(status) {\n        case 'major':\n            return '#D5C21B';\n        case 'critical':   \n            return '#E64A19';\n        case 'disconnected':\n            return '#CAC1D2';\n        case 'normal':\n        default:    \n            switch(type) {\n                case 'Room Sensor T':\n                    return '#4A8AEC';\n                case 'Room Sensor CO2':\n                    return '#4A8AEC';\n                default:\n                    return '#1F8B4D';\n            }\n            break;\n    }\n}\n\nfunction getTextWidth(text) {\n    var width = 0;\n    for (var i = 0; i < text.length; i++) {\n        var charWidth;\n        var character = text.charAt(i);\n        if (character === ' ') {\n            charWidth = 8;\n        } else if (character === '-') {\n            charWidth = 7;\n        } else if (character === '') {\n            charWidth = 5;\n        } else if (!isNaN(character * 1)){\n            charWidth = 9;\n        } else {\n            // Upper case\n            if (character === character.toUpperCase()) {\n                charWidth = 12;\n            // Lower case    \n            } else {\n                charWidth = 10;\n            }\n        }\n        width += charWidth;\n    }\n    return width;\n}\n\nfunction getDeviceText(type, status) {\n    switch(status) {\n        case 'disconnected':\n            return 'NO CONN';\n        case 'normal':\n        default:    \n            switch(type) {\n                case 'Temperature Sensor':\n                    var temperature = Number(data['temperature']);\n                    return 'T: ' + temperature.toFixed(1) + ' C';\n                case 'Room Sensor CO2':\n                    var co2 = Number(data['co2']);\n                    return 'CO2: ' + co2.toFixed(1) + ' ppm';\n                case 'P-Flow D116':\n                    var vFlow = Number(data['volumeFlow']);\n                    return 'Flow: ' + vFlow.toFixed(3)  + ' L/hr';\n                default:\n                    return '';\n            }\n            break;        \n    }\n}\n\n/*function getDeviceShape(type) {\n    switch(type) {\n    case 'P-Flow D116':\n      return '<path d=\"M320-80q-66 0-113-47t-47-113v-400q0-66 47-113t113-47h40v-80h80v80h80v-80h80v80h40q66 0 113 47t47 113v400q0 66-47 113T640-80H320Zm0-80h320q33 0 56.5-23.5T720-240v-400q0-33-23.5-56.5T640-720H320q-33 0-56.5 23.5T240-640v400q0 33 23.5 56.5T320-160Z\"/>';\n    case 'Temperature Sensor':\n      return '<path d=\"M480-80q-83 0-141.5-58.5T280-280q0-48 21-89.5t59-70.5v-320q0-50 35-85t85-35q50 0 85 35t35 85v320q38 29 59 70.5t21 89.5q0 83-58.5 141.5T480-80Zm-40-440h80v-40h-40v-40h40v-80h-40v-40h40v-40q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240Z\"/>';\n    case 'Room Sensor CO2':\n      return '<path d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\"/>';\n    case 'RESI':\n      return '<path d=\"M200-120q-33 0-56.5-23.5T120-200v-160q0-33 23.5-56.5T200-440h400v-160h80v160h80q33 0 56.5 23.5T840-360v160q0 33-23.5 56.5T760-120H200Zm0-80h560v-160H200v160Zm80-40q17 0 28.5-11.5T320-280q0-17-11.5-28.5T280-320q-17 0-28.5 11.5T240-280q0 17 11.5 28.5T280-240Zm140 0q17 0 28.5-11.5T460-280q0-17-11.5-28.5T420-320q-17 0-28.5 11.5T380-280q0 17 11.5 28.5T420-240Zm140 0q17 0 28.5-11.5T600-280q0-17-11.5-28.5T560-320q-17 0-28.5 11.5T520-280q0 17 11.5 28.5T560-240Zm10-390-58-58q26-24 58-38t70-14q38 0 70 14t58 38l-58 58q-14-14-31.5-22t-38.5-8q-21 0-38.5 8T570-630ZM470-730l-56-56q44-44 102-69t124-25q66 0 124 25t102 69l-56 56q-33-33-76.5-51.5T640-800q-50 0-93.5 18.5T470-730ZM200-200v-160 160Z\"/>';\n    default:\n      return '<path d=\"M160-240q-33 0-56.5-23.5T80-320v-320q0-33 23.5-56.5T160-720h640q33 0 56.5 23.5T880-640v320q0 33-23.5 56.5T800-240H160Zm0-80h640v-320H680v160h-80v-160h-80v160h-80v-160h-80v160h-80v-160H160v320Zm120-160h80-80Zm160 0h80-80Zm160 0h80-80Zm-120 0Z\"/>';\n  }\n}*/\n\n/*function getDeviceShape(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Temperature Sensor':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Room Sensor CO2':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Door Sensor':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M19 9H11V21H19V9ZM13 17C13.5523 17 14 16.5523 14 16C14 15.4477 13.5523 15 13 15C12.4477 15 12 15.4477 12 16C12 16.5523 12.4477 17 13 17Z\" fill=\"white\"/>' +\n                   '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M21 22V8C21 7.44772 20.5523 7 20 7H10C9.44772 7 9 7.44772 9 8V22H8.5C8.22386 22 8 22.2239 8 22.5C8 22.7761 8.22386 23 8.5 23H21.5C21.7761 23 22 22.7761 22 22.5C22 22.2239 21.7761 22 21.5 22H21ZM20 8H10L10 22H20V8Z\" fill=\"white\"/>';\n        case 'Motion Sensor':\n            return '<path d=\"M7.5 10C7.22386 10 7 10.2239 7 10.5C7 10.7761 7.22386 11 7.5 11H9C9 11.5523 9.44772 12 10 12H20C20.5523 12 21 11.5523 21 11H22.5C22.7761 11 23 10.7761 23 10.5C23 10.2239 22.7761 10 22.5 10H7.5Z\" fill=\"white\"/>' +\n                   '<path d=\"M17.0001 17C17.5524 17 18.0001 16.5523 18.0001 16C18.0001 15.4477 17.5524 15 17.0001 15C16.4478 15 16.0001 15.4477 16.0001 16C16.0001 16.5523 16.4478 17 17.0001 17Z\" fill=\"white\"/>' +\n                   '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15.0001 21C19.0804 21 22.4472 17.9453 22.9384 13.998C23.0066 13.45 22.5524 13 22.0001 13H8.00009C7.4478 13 6.99353 13.45 7.06173 13.998C7.55295 17.9453 10.9198 21 15.0001 21ZM17.0001 18C18.1047 18 19.0001 17.1046 19.0001 16C19.0001 14.8954 18.1047 14 17.0001 14C15.8955 14 15.0001 14.8954 15.0001 16C15.0001 17.1046 15.8955 18 17.0001 18Z\" fill=\"white\"/>';\n        case 'Occupancy Sensor':\n            return '<path d=\"M12 8.5C12 9.32843 11.3284 10 10.5 10C9.67157 10 9 9.32843 9 8.5C9 7.67157 9.67157 7 10.5 7C11.3284 7 12 7.67157 12 8.5Z\" fill=\"white\"/>' +\n                   '<path d=\"M10 22L10 19H11L11 22C11 22.5523 11.4477 23 12 23C12.5523 23 13 22.5523 13 22V17C13.5523 17 14 16.5523 14 16V12.8865C14 11.8446 13.1554 11 12.1135 11C12.0947 11 12.076 11.0005 12.0574 11.0016C12.0384 11.0005 12.0193 11 12 11L9 11C8.98072 11 8.96157 11.0005 8.94255 11.0016C8.92403 11.0005 8.90535 11 8.88652 11C7.84462 11 7 11.8446 7 12.8865V16C7 16.5523 7.44772 17 8 17V22C8 22.5523 8.44772 23 9 23C9.55229 23 10 22.5523 10 22Z\" fill=\"white\"/>' +\n                   '<path d=\"M21 23C20.4477 23 20 22.5523 20 22V19H19V22C19 22.5523 18.5523 23 18 23C17.4477 23 17 22.5523 17 22V19H15.7215C15.3724 19 15.1308 18.6513 15.2533 18.3244L17.4733 12.4045C17.7901 11.5597 18.5977 11 19.5 11C20.4023 11 21.2099 11.5597 21.5267 12.4045L23.7467 18.3244C23.8692 18.6513 23.6276 19 23.2785 19H22V22C22 22.5523 21.5523 23 21 23Z\" fill=\"white\"/>' +\n                   '<path d=\"M19.5 10C20.3284 10 21 9.32843 21 8.5C21 7.67157 20.3284 7 19.5 7C18.6716 7 18 7.67157 18 8.5C18 9.32843 18.6716 10 19.5 10Z\" fill=\"white\"/>';\n        default:\n            return '';\n    }\n}*/",
            "markerImages": [
              "tb-image;/api/images/tenant/gas_meter_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png",
              "tb-image;/api/images/tenant/co2_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png",
              "tb-image;/api/images/tenant/device_thermostat_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png",
              "tb-image;/api/images/tenant/router_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png",
              "tb-image;/api/images/tenant/straighten_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png"
            ],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "snappable": false,
            "initDragMode": true,
            "hideAllControlButton": true,
            "hideDrawControlButton": false,
            "hideEditControlButton": false,
            "hideRemoveControlButton": false
          },
          "title": "Doktorkit plan",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Select device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nvar selectedDevice = params['selectedDevice'];\nif (selectedDevice && selectedDevice.entityId.id === entityId.id) {\n    params['selectedDevice'] = null;\n} else {\n    params['selectedDevice'] = { entityId: entityId };\n}\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c33ff837-63f4-df99-87f2-f2f409b5c997"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "noDataDisplayMessage": "",
          "widgetCss": ".leaflet-popup-content-wrapper, .leaflet-popup-tip {\n    background: #fff;\n    color: #333;\n    box-shadow: 0px 7px 14px rgba(40, 35, 45, 0.21);\n}\n\n.leaflet-popup-content-wrapper {\n    padding: 1px;\n    text-align: left;\n    border-radius: 4px;\n}\n\n.leaflet-container a.leaflet-popup-close-button {\n    padding: 8px 8px 0 0;\n}\n\n.leaflet-popup-content {\n    margin: 12px 25px 12px 16px;\n}\n\n.leaflet-popup-tip {\n    width: 14px;\n    height: 14px;\n}\n",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "7a37cf70-51c1-aef6-ef15-27041e016bd5",
        "typeFullFqn": "system.maps_v2.image_map"
      },
      "225675bf-745f-b2bc-b83c-52d751910205": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.031424315886006804
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.323899218375304
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\n\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\n\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\n\nreturn '<div style=\"width: 100%; height: 100%; padding: 0;\" fxLayoutGap=\"16px\" fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutAlign.gt-md=\"center center\">'+\n       '<div id=\"critical-alarms\" class=\"alarm-badge '+ criticalClass +'\"><i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ criticalCount +'</span> Critical</div>' +\n       '<div id=\"major-alarms\" class=\"alarm-badge '+ majorClass +'\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ majorCount +'</span> Major</div>' +\n       '<div>';",
            "useMarkdownTextFunction": true,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "critical-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "market_critical_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2255454c-8c83-dfae-2e0b-8d0df6db6a70"
              },
              {
                "name": "major-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "market_major_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "e52ae76c-959f-f84e-c6b7-3e49c242e70e"
              }
            ]
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "225675bf-745f-b2bc-b83c-52d751910205",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "592649d5-d648-e75f-0dc6-5c8ccd94b6d7": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "entitiesTitle": "Measurements",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 4,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Devices",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a5025959-4eb0-bbfb-1bef-115e0c344ebf",
              "filterId": "2d011a64-3af4-277a-980d-904145c28912",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.46096251592014714
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var type = value;\n\nvar typeSvg = getTypeSvg(type);\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ typeSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ type +'</span>' +\n       '</span>';\n            \nfunction getTypeSvg(type) {\n    var typeSvg;\n    switch (type) {\n        case 'Smart Shelf':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.5 2C2.22386 2 2 2.22386 2 2.5V17.5C2 17.7761 2.22386 18 2.5 18C2.77614 18 3 17.7761 3 17.5V17H17V17.5C17 17.7761 17.2239 18 17.5 ' +\n                      '18C17.7761 18 18 17.7761 18 17.5V2.5C18 2.22386 17.7761 2 17.5 2C17.2239 2 17 2.22386 17 2.5V8H14C14.5523 8 15 7.55228 15 7V4C15 3.44772 14.5523 3 14 3H11C10.4477 3 10 3.44772 10 4V7C10 ' +\n                      '7.55228 10.4477 8 11 8H7C7.55228 8 8 7.55228 8 7V6C8 5.44772 7.55228 5 7 5H6C5.44772 5 5 5.44772 5 6V7C5 7.55228 5.44772 8 6 8H3V2.5C3 2.22386 2.77614 2 2.5 2ZM17 16V9H3V16H6C5.44772 16 ' +\n                      '5 15.5523 5 15V12C5 11.4477 5.44772 11 6 11H9C9.55228 11 10 11.4477 10 12V15C10 15.5523 9.55228 16 9 16H12C11.4477 16 11 15.5523 11 15V13C11 12.4477 11.4477 12 12 12H14C14.5523 12 15 ' +\n                      '12.4477 15 13V15C15 15.5523 14.5523 16 14 16H17Z\" fill=\"#212121\"/>';\n            break;\n        case 'Freezer':            \n            typeSvg = '<rect x=\"9\" y=\"2\" width=\"2\" height=\"16\" rx=\"1\" fill=\"#212121\"/>' +\n                      '<path d=\"M12.5 3.5L10 6L7.5 3.5M12.5 16.5L10 14L7.5 16.5\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<path d=\"M16.8792 8.91509L13.4641 8.00002L14.3792 4.58496M5.62082 15.4151L6.53588 12L3.12082 11.085\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<path d=\"M5.62085 4.58491L6.53591 7.99998L3.12085 8.91504M16.8792 11.0849L13.4641 12L14.3792 15.415\" stroke=\"#212121\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>' +\n                      '<rect x=\"16.4282\" y=\"5.13379\" width=\"2\" height=\"16\" rx=\"1\" transform=\"rotate(60 16.4282 5.13379)\" fill=\"#212121\"/>' +\n                      '<rect x=\"2.57178\" y=\"6.86621\" width=\"2\" height=\"16\" rx=\"1\" transform=\"rotate(-60 2.57178 6.86621)\" fill=\"#212121\"/>';\n            break;\n        case 'Chiller':            \n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M13.0001 7.49994C13.0001 8.53714 12.2661 9.2516 11.4454 9.64333C11.2807 9.72191 11.1185 9.75061 10.9657 9.73874C10.9881 9.82201 ' +\n                      '11.0001 9.90957 11.0001 9.99994C11.0001 10.0304 10.9988 10.0605 10.9961 10.0902C11.1511 10.0322 11.322 9.99993 11.5001 9.99993L12.5001 9.99994L13.5 9.99993C14.3285 9.99992 15.0003 ' +\n                      '10.6975 14.6435 11.4452C14.2517 12.2658 13.5373 12.9999 12.5001 12.9999C11.4629 12.9999 10.7484 12.2658 10.3567 11.4452C10.2781 11.2805 10.2494 11.1184 10.2613 10.9655C10.178 10.988 ' +\n                      '10.0905 10.9999 10.0001 10.9999C9.96965 10.9999 9.93949 10.9986 9.90971 10.9959C9.96779 11.1509 10 11.3218 10 11.5L10 12.4999L10 13.4999C10.0001 14.3284 9.30246 15.0002 8.55482 ' +\n                      '14.6433C7.73413 14.2516 7.00006 13.5371 7.00006 12.4999C7.00006 11.4627 7.73413 10.7483 8.55482 10.3566C8.71948 10.278 8.8817 10.2493 9.03459 10.2611C9.01212 10.1779 9.00013 10.0903 ' +\n                      '9.00013 9.99994C9.00013 9.9695 9.00149 9.93938 9.00416 9.90963C8.84921 9.96766 8.67837 9.9999 8.50029 9.99989L7.50031 9.99988L6.50033 9.99989C5.67189 9.9999 5.00006 9.3023 5.35692 ' +\n                      '8.55467C5.74865 7.73397 6.46311 6.99991 7.50031 6.99991C8.5375 6.99991 9.25197 7.73397 9.6437 8.55467C9.72227 8.71929 9.75098 8.88149 9.73911 9.03435C9.82232 9.01191 9.90983 8.99994 ' +\n                      '10.0001 8.99994C10.0306 8.99994 10.0607 9.0013 10.0905 9.00397C10.0324 8.84898 10.0002 8.67807 10.0002 8.49992L10.0002 7.49994L10.0002 6.49996C10.0001 5.67153 10.6977 4.99969 11.4454 ' +\n                      '5.35655C12.2661 5.74828 13.0001 6.46274 13.0001 7.49994Z\" fill=\"#212121\"/>' +\n                      '<circle cx=\"10\" cy=\"10\" r=\"8\" stroke=\"#212121\" stroke-width=\"2\"/>';\n            break;                      \n        case 'Smart Bin':\n            typeSvg = '<path d=\"M6.71849 14C5.15241 14 4.19394 12.2816 5.01686 10.9491L5.09816 10.8175C5.17797 10.8327 5.26094 10.8383 5.34575 10.8332C5.89704 10.8001 6.31713 10.3264 6.28404 9.77509L6.21705 8.65906C6.19838 8.34795 6.03571 8.06333 5.77714 7.88933C5.51856 7.71533 5.19363 7.67184 4.8984 7.77171L3.93237 8.09851C3.40921 8.27549 3.12858 8.84306 3.30556 9.36622C3.34237 9.47504 3.39608 9.57337 3.46278 9.65927L3.31523 9.89818C1.66939 12.5631 3.58633 16 6.71849 16H7.83485C8.38714 16 8.83485 15.5523 8.83485 15C8.83485 14.4478 8.38714 14 7.83485 14L6.71849 14Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M13.3135 13.8409C14.8789 13.8873 15.8879 12.198 15.1048 10.8418L14.5467 9.87495C14.2705 9.39666 14.4344 8.78507 14.9127 8.50893C15.391 8.23279 16.0026 8.39666 16.2787 8.87495L16.8369 9.84175C18.403 12.5543 16.3849 15.9329 13.2542 15.84L12.9735 15.8317C12.9324 15.9324 12.8741 16.0281 12.7983 16.1143C12.4337 16.5292 11.8019 16.5699 11.387 16.2054L10.621 15.5322C10.3869 15.3264 10.2621 15.0233 10.2835 14.7123C10.3049 14.4014 10.47 14.1182 10.7301 13.9465L11.6632 13.3305C12.124 13.0262 12.7444 13.1531 13.0487 13.614C13.0955 13.6849 13.1321 13.7596 13.1588 13.8363L13.3135 13.8409Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M11.6696 5.21002C10.9272 3.83113 8.95968 3.80195 8.17664 5.15821L7.61846 6.12501C7.34232 6.6033 6.73073 6.76718 6.25244 6.49104C5.77414 6.21489 5.61027 5.6033 5.88641 5.12501L6.44459 4.15821C8.01067 1.44568 11.9456 1.50404 13.4306 4.26183L13.5637 4.50907C13.6715 4.49425 13.7835 4.4969 13.8961 4.51943C14.4377 4.62774 14.7889 5.15457 14.6806 5.69613L14.4806 6.69613C14.4195 7.00175 14.2193 7.26139 13.9393 7.39833C13.6594 7.53526 13.3315 7.53382 13.0528 7.39444L12.0528 6.89444C11.5588 6.64745 11.3586 6.04678 11.6056 5.5528C11.6436 5.47681 11.6899 5.40777 11.743 5.34624L11.6696 5.21002Z\" fill=\"#212121\"/>';\n            break;          \n        case 'Door Sensor':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 4H6V16H14V4ZM8 12C8.55228 12 9 11.5523 9 11C9 10.4477 8.55228 10 8 10C7.44772 10 7 10.4477 7 11C7 11.5523 7.44772 12 8 12Z\" fill=\"#212121\"/>' +\n                      '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16 17V3C16 2.44772 15.5523 2 15 2H5C4.44772 2 4 2.44772 4 3V17H3.5C3.22386 17 3 17.2239 3 17.5C3 17.7761 3.22386 18 3.5 18H16.5C16.7761 18 17 17.7761 17 17.5C17 17.2239 16.7761 17 16.5 17H16ZM15 3H5L5 17H15V3Z\" fill=\"#212121\"/>';\n            break;\n        case 'Liquid Level Sensor':\n            typeSvg = '<path d=\"M14.6363 0.453212C14.8228 0.210257 15.1772 0.210257 15.3637 0.453213C15.9404 1.2044 17 2.73057 17 3.80373C17 5.02723 16.1143 5.99982 15 5.99982C13.8857 5.99982 13 5.02723 13 3.80373C13 2.73057 14.0596 1.2044 14.6363 0.453212Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M8.3017 2.76073C8.67788 2.33798 9.32212 2.33798 9.6983 2.76073C11.2801 4.53832 15 9.0479 15 12.1437C15 15.4064 12.3427 18 9 18C5.65725 18 3 15.4064 3 12.1437C3 9.0479 6.71994 4.53832 8.3017 2.76073Z\" fill=\"#212121\"/>';\n            break;\n        case 'Motion Sensor':\n            typeSvg = '<path d=\"M2.5 5C2.22386 5 2 5.22386 2 5.5C2 5.77614 2.22386 6 2.5 6H4C4 6.55228 4.44772 7 5 7H15C15.5523 7 16 6.55228 16 6H17.5C17.7761 6 18 5.77614 18 5.5C18 5.22386 17.7761 5 17.5 5H2.5Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M12.0001 12C12.5524 12 13.0001 11.5523 13.0001 11C13.0001 10.4477 12.5524 10 12.0001 10C11.4478 10 11.0001 10.4477 11.0001 11C11.0001 11.5523 11.4478 12 12.0001 12Z\" fill=\"#212121\"/>' +\n                      '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10.0001 16C14.0804 16 17.4472 12.9453 17.9384 8.99801C18.0066 8.44996 17.5524 8 17.0001 8H3.00009C2.4478 8 1.99353 8.44996 2.06173 8.99801C2.55295 12.9453 5.91978 16 10.0001 16ZM12.0001 13C13.1047 13 14.0001 12.1046 14.0001 11C14.0001 9.89543 13.1047 9 12.0001 9C10.8955 9 10.0001 9.89543 10.0001 11C10.0001 12.1046 10.8955 13 12.0001 13Z\" fill=\"#212121\"/>';\n            break;\n        case 'Occupancy Sensor':\n            typeSvg = '<path d=\"M7 3.5C7 4.32843 6.32843 5 5.5 5C4.67157 5 4 4.32843 4 3.5C4 2.67157 4.67157 2 5.5 2C6.32843 2 7 2.67157 7 3.5Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M3 12C2.44772 12 2 11.5523 2 11L2 7.88652C2 6.84462 2.84462 6 3.88652 6C3.90535 6 3.92403 6.00055 3.94255 6.00162C3.96157 6.00055 3.98072 6 4 6H7C7.01928 6 7.03843 6.00055 7.05745 6.00162C7.07597 6.00055 7.09465 6 7.11348 6C8.15538 6 9 6.84462 9 7.88652V11C9 11.5523 8.55229 12 8 12V17C8 17.5523 7.55228 18 7 18C6.44772 18 6 17.5523 6 17L6 14H5V17C5 17.5523 4.55228 18 4 18C3.44772 18 3 17.5523 3 17V12Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M16 18C15.4477 18 15 17.5523 15 17V14H14V17C14 17.5523 13.5523 18 13 18C12.4477 18 12 17.5523 12 17V14H10.7215C10.3724 14 10.1308 13.6513 10.2533 13.3244L12.4733 7.40449C12.7901 6.55968 13.5977 6 14.5 6C15.4023 6 16.2099 6.55968 16.5267 7.40449L18.7467 13.3244C18.8692 13.6513 18.6276 14 18.2785 14H17V17C17 17.5523 16.5523 18 16 18Z\" fill=\"#212121\"/>' +\n                      '<path d=\"M14.5 5C15.3284 5 16 4.32843 16 3.5C16 2.67157 15.3284 2 14.5 2C13.6716 2 13 2.67157 13 3.5C13 4.32843 13.6716 5 14.5 5Z\" fill=\"#212121\"/>';\n            break;\n        case 'Smoke Sensor':\n            typeSvg = '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9.64491 2.08319C9.48444 1.9888 9.28482 1.99138 9.12685 2.08988C8.96887 2.18839 8.87871 2.3665 8.89285 2.55213C8.98169 3.71876 8.78795 4.5943 8.45363 5.30483C8.11607 6.02225 7.62209 6.60008 7.06387 7.157C6.88401 7.33644 6.69008 7.52013 6.49214 7.70763C6.10197 8.07721 5.69618 8.46158 5.35189 8.85718C4.81113 9.47853 4.35082 10.1982 4.15741 11.131C3.35478 15.0023 6.43952 18.1649 10.361 17.9822C10.41 17.9806 10.4592 17.9779 10.5088 17.9741L10.55 17.9708L10.5673 17.9695C10.6635 17.9622 10.7585 17.9532 10.8523 17.9427C10.897 17.9427 10.9422 17.9409 10.9878 17.9375C11.1369 17.9261 11.2735 17.9002 11.3976 17.8614C12.9028 17.5787 14.0571 16.8581 14.836 15.8302C15.7453 14.6303 16.1036 13.0646 15.9781 11.4151C15.7275 8.1215 13.5473 4.37866 9.64491 2.08319ZM12.1372 15.5326C12.1487 15.5269 12.1601 15.521 12.1714 15.5152C12.2227 15.2706 12.2393 15.0003 12.2172 14.7101C12.1353 13.6344 11.5243 12.3752 10.3912 11.4298C10.3443 11.6743 10.2711 11.8979 10.1767 12.1045C9.97248 12.5515 9.68116 12.8915 9.40451 13.1748C9.2918 13.2902 9.1897 13.3891 9.09461 13.4812C8.93666 13.6341 8.79804 13.7684 8.66241 13.9284C8.46694 14.1591 8.33595 14.3839 8.28119 14.6575C8.20904 15.018 8.23357 15.3634 8.33595 15.6725C8.69526 15.8186 9.08844 15.9185 9.50948 15.9633C9.62655 15.764 9.79981 15.6036 9.97777 15.4389C10.3505 15.0938 10.7439 14.7297 10.6844 13.949C11.3929 14.3558 11.8813 14.938 12.1372 15.5326ZM13.2143 14.6343L13.2159 14.6563L13.2421 14.6222C13.7907 13.8983 14.0816 12.8503 13.9839 11.5668C13.8301 9.5445 12.7138 7.15459 10.6097 5.25541C10.5143 5.57021 10.3981 5.86993 10.2634 6.15628C9.78098 7.18157 9.09869 7.9521 8.47652 8.57282C8.20885 8.83986 7.97694 9.05847 7.76612 9.25719C7.43058 9.57348 7.14846 9.83941 6.86065 10.1701C6.45742 10.6334 6.21678 11.0502 6.11585 11.537C5.83546 12.8894 6.29313 14.1616 7.23945 14.9971C7.24423 14.8222 7.26422 14.6432 7.30064 14.4613C7.39921 13.9687 7.63564 13.5933 7.89951 13.2819C8.06367 13.0882 8.26661 12.8908 8.44919 12.7131C8.53584 12.6288 8.61792 12.549 8.68907 12.4761C8.93347 12.2258 9.13295 11.9826 9.26713 11.689C9.39844 11.4016 9.47964 11.0379 9.44124 10.5337C9.42702 10.347 9.51835 10.168 9.67788 10.0698C9.83741 9.97174 10.0384 9.97101 10.1986 10.068C12.0451 11.1851 13.0906 13.0082 13.2143 14.6343Z\" fill=\"#212121\"/>';\n            break;\n        default:\n            typeSvg = '<circle cx=\"10\" cy=\"10\" r=\"10\" fill=\"#AAAAAA\"/>';\n    }\n    \n    return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' + \n           typeSvg +\n           '</svg>';\n} \n",
                    "defaultColumnVisibility": "hidden-mobile",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.8077097060074172,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden-mobile",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.4057433451983201,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "State",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var state = value;\nvar active = entity.active;\nif (active === 'false') {\n    state = 'disconnected';\n}\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#607d8b",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "disabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.04680501891139488,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "State",
                  "color": "#9c27b0",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var state = value;\nvar active = entity.active;\nif (active === 'false') {\n    state = 'disconnected';\n}\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n/*           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +*/\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.09724992828702295,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "Progress",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.314485118861195,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [
              {
                "name": "Select device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedDevice'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedDevice';\n\nvar currentStateId = widgetContext.stateController.getStateId();\nif (currentStateId === 'default') {\n   widgetContext.stateController.openState('Doktorkit_details', params);\t\n} else {\n   widgetContext.stateController.updateState(null, params);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "27b78a0c-3e2d-8d90-72dd-10f9f80351b5"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "configMode": "advanced",
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "592649d5-d648-e75f-0dc6-5c8ccd94b6d7",
        "typeFullFqn": "system.cards.entities_table"
      },
      "ffbfe096-2667-28d1-7142-e25b1de3fd5d": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.4880248004489329
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.334866663156842
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": "// let mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementAlarms';\r\nlet mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementSignalStrength';\r\n\r\nlet params = ctx.stateController.getStateParams();\r\nlet switchTimeWindow = null;\r\nlet startTimeMs, endTimeMs;\r\n\r\nif (data && data.length) {\r\n    startTimeMs = data[0].startTimeMs || 0;\r\n    endTimeMs = data[0].endTimeMs || 0;\r\n}\r\n\r\nif (startTimeMs !== 0 && endTimeMs !== 0) {\r\n    if (endTimeMs - startTimeMs <= 1209600000) {\r\n        switchTimeWindow = 1;\r\n    } else {\r\n        switchTimeWindow = 2;\r\n    }\r\n}\r\n\r\nvar vm = this;\r\n\r\nvm.onInit = function() {\r\n    \r\n};\r\n\r\nvm.updateMode = function(newMode) {\r\n    let params = vm.ctx.stateController.getStateParams() || {};\r\n    params.targetMode = newMode;\r\n    vm.ctx.stateController.updateState(null, params);\r\n};\r\n\r\nswitch (switchTimeWindow) {\r\n    case 1:\r\n    case 2:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: startTimeMs,\r\n                    endTimeMs: endTimeMs\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n    default:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: Date.now() - 1209600000,\r\n                    endTimeMs: Date.now()\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n}\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, params);\r\n\r\nreturn '' +\r\n'<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n  '<tb-dashboard-state style=\"height: 100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_card_header\"></tb-dashboard-state>' +\r\n  '<tb-dashboard-state style=\"height: 100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_card_details\"></tb-dashboard-state>' +\r\n  '<mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>' +\r\n  '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding: 10px 8px; background-color: #ffffff;\">' +\r\n    \r\n    '<button id=\"alarms-button\" type=\"button\" mat-button color=\"primary\" ' +\r\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\r\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementAlarms\\')\">' +\r\n      '<mat-icon class=\"tb-mat-18\">map</mat-icon>' +\r\n      '<span>Alarms</span>' +\r\n    '</button>' +\r\n    \r\n    '<button id=\"signal-strength-button\" type=\"button\" mat-button color=\"primary\" ' +\r\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\r\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementSignalStrength\\')\">' +\r\n      '<mat-icon class=\"tb-mat-18\">signal_cellular_alt</mat-icon>' +\r\n      '<span>Signal Strength</span>' +\r\n    '</button>' +\r\n  '</div>' +\r\n  \r\n  (mode === 'selectedMeasurementSignalStrength'\r\n    ? '<mat-expansion-panel style=\"margin: 8px; box-shadow: none; background-color: #fafafa;\">' +\r\n        '<mat-expansion-panel-header>' +\r\n          '<mat-panel-title style = \"color: #757575;\">' +\r\n            'Signal Strength Legend' +\r\n          '</mat-panel-title>' +\r\n        '</mat-expansion-panel-header>' +\r\n        '<mat-tab-group>' +\r\n          \r\n          '<mat-tab label=\"RSRP\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= -80</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-80 to -90</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-90 to -100</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -100</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"RSRQ\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= -10</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-10 to -15</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-15 to -20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -20</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"RSSI\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt; -65</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-65 to -75</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Fair</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-75 to -85</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Poor</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -85</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"SNR\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= 20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">13 to 20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">0 to 13</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= 0</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n        '</mat-tab-group>' +\r\n      '</mat-expansion-panel>'\r\n    : ''\r\n  ) +\r\n  \r\n  (mode === 'selectedMeasurementAlarms'\r\n    ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_alarms\"></tb-dashboard-state>'\r\n    : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"signal_strength\"></tb-dashboard-state>'\r\n  ) +\r\n'</div>';\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.mat-form-field input[disabled] {\n  background-color: #f5f5f5; /* Light grey background to indicate disabled state */\n  cursor: not-allowed; /* Change cursor to indicate non-interactive element */\n  color: #9e9e9e; /* Change text color to indicate disabled state */\n  \n}\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow.no-padding {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 4px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "default",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              },
              {
                "name": "alarms-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['targetMode'] = 'selectedMeasurementAlarms'; \nconsole.log(params);\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5858ee89-1140-5f22-75de-09d735b37df1"
              },
              {
                "name": "signal-strength-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['targetMode'] = 'selectedMeasurementSignalStrength';\nconsole.log(params);\nwidgetContext.updateAliases();\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "cc7da9e0-1e94-489c-af1e-c0eea0165ff9"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "ffbfe096-2667-28d1-7142-e25b1de3fd5d",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "4c8da7a1-659f-e2e5-220c-4128a217e872": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 1000,
              "timewindowMs": 604800000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1737884022023,
                "endTimeMs": 1737970422023
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-startTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "New Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "40px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
            "filterId": null,
            "dataKeys": [
              {
                "name": "startTime",
                "type": "alarm",
                "label": "Start time",
                "color": "#607d8b",
                "settings": {
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible"
                },
                "_hash": 0.9100433241266481
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "notifications",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": false,
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}\n",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": false
          },
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "4c8da7a1-659f-e2e5-220c-4128a217e872",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "af27e6f5-e59b-8413-1bfa-7af5b36a4e5b": {
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "batteryLevel",
                  "type": "timeseries",
                  "label": "Battery level",
                  "color": "#2196f3",
                  "settings": {
                    "excludeFromStacking": false,
                    "hideDataByDefault": false,
                    "disableDataHiding": false,
                    "removeFromLegend": false,
                    "showLines": true,
                    "fillLines": true,
                    "showPoints": false,
                    "showPointShape": "circle",
                    "pointShapeFormatter": "var size = radius * Math.sqrt(Math.PI) / 2;\nctx.moveTo(x - size, y - size);\nctx.lineTo(x + size, y + size);\nctx.moveTo(x - size, y + size);\nctx.lineTo(x + size, y - size);",
                    "showPointsLineWidth": 5,
                    "showPointsRadius": 3,
                    "showSeparateAxis": false,
                    "axisPosition": "left",
                    "thresholds": [
                      {
                        "thresholdValueSource": "entityAttribute",
                        "thresholdAttribute": "lowBatteryMajorThreshold",
                        "thresholdEntityAlias": "Selected device",
                        "color": "#f8b301",
                        "lineWidth": 2
                      },
                      {
                        "thresholdValueSource": "entityAttribute",
                        "thresholdAttribute": "lowBatteryCriticalThreshold",
                        "thresholdEntityAlias": "Selected device",
                        "lineWidth": 2,
                        "color": "#ff0000"
                      }
                    ],
                    "comparisonSettings": {
                      "showValuesForComparison": true
                    },
                    "axisTitle": "Battery level, %"
                  },
                  "_hash": 0.6540640005694329,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ]
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 604800000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1800000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "shadowSize": 0,
            "fontSize": 10,
            "xaxis": {
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "showLabels": true,
              "color": "#545454",
              "tickDecimals": 0,
              "min": 0,
              "max": 100
            },
            "grid": {
              "color": "#f5f5f5",
              "tickColor": "#DDDDDD",
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1
            },
            "stack": false,
            "tooltipIndividual": false,
            "smoothLines": true,
            "tooltipCumulative": false,
            "hideZeros": false,
            "showTooltip": true,
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "xaxisSecond": {
              "axisPosition": "top",
              "showLabels": true
            },
            "customLegendEnabled": false,
            "fontColor": "#545454",
            "showLegend": false,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false
            }
          },
          "title": "Battery Level History",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "af27e6f5-e59b-8413-1bfa-7af5b36a4e5b",
        "typeFullFqn": "system.charts.basic_timeseries"
      },
      "5364ac11-0129-8771-7bb1-67718bd3efda": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "lowBatteryCriticalThreshold",
                  "type": "attribute",
                  "label": "Low battery threshold for critical alarm",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 0,
                    "maxValue": 100
                  },
                  "_hash": 0.3977852589212394,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 10;\n}"
                },
                {
                  "name": "lowBatteryMajorThreshold",
                  "type": "attribute",
                  "label": "Low battery threshold for major alarm",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 0,
                    "maxValue": 100
                  },
                  "_hash": 0.9885317089867498,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}"
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showActionButtons": true,
            "showResultMessage": true,
            "showGroupTitle": false,
            "fieldsAlignment": "column",
            "updateAllValues": false,
            "groupTitle": "${entityName}",
            "fieldsInRow": 2
          },
          "title": "Settings",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "padding-top": "8px",
            "padding-bottom": "24px",
            "fontSize": "18px",
            "fontWeight": 500
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": ".tb-multiple-input button[type=submit] {\n    margin-right: 0 !important;\n}\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "5364ac11-0129-8771-7bb1-67718bd3efda",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "49056eb9-3240-4315-84e8-73ea065e4652": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "motion",
                  "type": "timeseries",
                  "label": "motion",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.41421011215312653,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value === 'true' ? 'Detected' : 'None';"
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextPattern": "**Movement detection** (${motion})",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownCss": "p {\n    padding-left: 16px;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "49056eb9-3240-4315-84e8-73ea065e4652",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "bb3e4bc4-7f69-b8df-c554-dfdffd83a4dc": {
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "motion",
                  "type": "timeseries",
                  "label": "Movement detection",
                  "color": "#2196f3",
                  "settings": {
                    "excludeFromStacking": false,
                    "hideDataByDefault": false,
                    "disableDataHiding": false,
                    "removeFromLegend": false,
                    "showLines": true,
                    "fillLines": true,
                    "showPoints": false,
                    "showPointShape": "circle",
                    "pointShapeFormatter": "var size = radius * Math.sqrt(Math.PI) / 2;\nctx.moveTo(x - size, y - size);\nctx.lineTo(x + size, y + size);\nctx.moveTo(x - size, y + size);\nctx.lineTo(x + size, y - size);",
                    "showPointsLineWidth": 5,
                    "showPointsRadius": 3,
                    "showSeparateAxis": false,
                    "axisPosition": "left",
                    "thresholds": [],
                    "comparisonSettings": {
                      "showValuesForComparison": true
                    },
                    "axisTitle": "Movement detection",
                    "axisMax": 1
                  },
                  "_hash": 0.774509473282736,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value === 'true' ? 1 : 0;"
                }
              ]
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 604800000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1800000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "shadowSize": 0,
            "fontColor": "#545454",
            "fontSize": 10,
            "xaxis": {
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "showLabels": true,
              "color": "#545454",
              "ticksFormatter": "if (value > 0 && value <= 1) {\n    return 'Detected';\n} else if (value === 0) {\n    return 'None';\n} else {\n    return '';\n}",
              "tickDecimals": 0
            },
            "grid": {
              "color": "#e0e0e0",
              "tickColor": "#DDDDDD",
              "verticalLines": false,
              "horizontalLines": false,
              "outlineWidth": 1
            },
            "stack": false,
            "tooltipIndividual": false,
            "tooltipValueFormatter": "if (value > 0 && value <= 1) {\n    return 'Detected';\n} else if (value === 0) {\n    return 'None';\n} else {\n    return '';\n}",
            "smoothLines": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "showTooltip": true,
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "xaxisSecond": {
              "axisPosition": "top",
              "showLabels": true
            },
            "customLegendEnabled": false,
            "showLegend": false,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false
            }
          },
          "title": "Door state",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "widgetStyle": {},
          "useDashboardTimewindow": false,
          "actions": {
            "headerButton": []
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "bb3e4bc4-7f69-b8df-c554-dfdffd83a4dc",
        "typeFullFqn": "system.charts.state_chart"
      },
      "9ab503a5-3c68-5dfb-d55a-8672bf48ada9": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "maxOccupancyTimeCriticalThreshold",
                  "type": "attribute",
                  "label": "Occupancy duration for critical alarm",
                  "color": "#2196f3",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 2,
                    "maxValue": 400,
                    "useCustomIcon": false,
                    "useGetValueFunction": false,
                    "useSetValueFunction": false
                  },
                  "_hash": 0.3859130334588563,
                  "units": "Minutes",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 60;\n}"
                },
                {
                  "name": "maxOccupancyTimeMajorThreshold",
                  "type": "attribute",
                  "label": "Occupancy duration for major alarm",
                  "color": "#4caf50",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 2,
                    "maxValue": 600,
                    "useCustomIcon": false,
                    "useGetValueFunction": false,
                    "useSetValueFunction": false
                  },
                  "_hash": 0.09378045215692454,
                  "units": "Minutes",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}"
                },
                {
                  "name": "lowBatteryCriticalThreshold",
                  "type": "attribute",
                  "label": "Low battery threshold for critical alarm",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 0,
                    "maxValue": 100
                  },
                  "_hash": 0.3977852589212394,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 10;\n}"
                },
                {
                  "name": "lowBatteryMajorThreshold",
                  "type": "attribute",
                  "label": "Low battery threshold for major alarm",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 0,
                    "maxValue": 100
                  },
                  "_hash": 0.9885317089867498,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}"
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showActionButtons": true,
            "showResultMessage": true,
            "showGroupTitle": false,
            "fieldsAlignment": "column",
            "updateAllValues": false,
            "groupTitle": "${entityName}",
            "fieldsInRow": 2
          },
          "title": "Settings",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "padding-top": "8px",
            "padding-bottom": "24px",
            "fontSize": "18px",
            "fontWeight": 500
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": ".tb-multiple-input button[type=submit] {\n    margin-right: 0 !important;\n}\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "9ab503a5-3c68-5dfb-d55a-8672bf48ada9",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "33b97c6e-ccca-4677-2ae1-6b8c6339f036": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "occupied",
                  "type": "timeseries",
                  "label": "occupied",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.41421011215312653,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value === 'true' ? 'Occupied' : 'Vacant';"
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextPattern": "**State** (${occupied})",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownCss": "p {\n    padding-left: 16px;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "33b97c6e-ccca-4677-2ae1-6b8c6339f036",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "96f25bbc-79bc-c367-440b-e4bb292f7656": {
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "occupied",
                  "type": "timeseries",
                  "label": "State",
                  "color": "#2196f3",
                  "settings": {
                    "excludeFromStacking": false,
                    "hideDataByDefault": false,
                    "disableDataHiding": false,
                    "removeFromLegend": false,
                    "showLines": true,
                    "fillLines": true,
                    "showPoints": false,
                    "showPointShape": "circle",
                    "pointShapeFormatter": "var size = radius * Math.sqrt(Math.PI) / 2;\nctx.moveTo(x - size, y - size);\nctx.lineTo(x + size, y + size);\nctx.moveTo(x - size, y + size);\nctx.lineTo(x + size, y - size);",
                    "showPointsLineWidth": 5,
                    "showPointsRadius": 3,
                    "showSeparateAxis": false,
                    "axisPosition": "left",
                    "thresholds": [],
                    "comparisonSettings": {
                      "showValuesForComparison": true
                    },
                    "axisTitle": "State",
                    "axisMax": 1
                  },
                  "_hash": 0.774509473282736,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value === 'true' ? 1 : 0;"
                }
              ]
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 604800000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1800000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "shadowSize": 0,
            "fontColor": "#545454",
            "fontSize": 10,
            "xaxis": {
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "showLabels": true,
              "color": "#545454",
              "ticksFormatter": "if (value > 0 && value <= 1) {\n    return 'Occupied';\n} else if (value === 0) {\n    return 'Vacant';\n} else {\n    return '';\n}",
              "tickDecimals": 0
            },
            "grid": {
              "color": "#e0e0e0",
              "tickColor": "#DDDDDD",
              "verticalLines": false,
              "horizontalLines": false,
              "outlineWidth": 1
            },
            "stack": false,
            "tooltipIndividual": false,
            "tooltipValueFormatter": "if (value > 0 && value <= 1) {\n    return 'Occupied';\n} else if (value === 0) {\n    return 'Vacant';\n} else {\n    return '';\n}",
            "smoothLines": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "showTooltip": true,
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "xaxisSecond": {
              "axisPosition": "top",
              "showLabels": true
            },
            "customLegendEnabled": false,
            "showLegend": false,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": false,
              "showMax": false,
              "showAvg": false,
              "showTotal": false
            }
          },
          "title": "Door state",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "widgetStyle": {},
          "useDashboardTimewindow": false,
          "actions": {
            "headerButton": []
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "96f25bbc-79bc-c367-440b-e4bb292f7656",
        "typeFullFqn": "system.charts.state_chart"
      },
      "e8e3d4be-2720-0677-2c04-ff9a5fdb2447": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8057369620518648
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.49953012506084726
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.21088975870489435
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5157976480659352
                },
                {
                  "name": "batteryLevel",
                  "type": "timeseries",
                  "label": "batteryLevel",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.1659349558331873
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.20684451568213258,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.5554495301365088
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.821480189837247
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.31692184501390863
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": "var name, label, type, state, active, progress, locationName, installationType, installation, measurementType;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    locationName = data[0]['locationName'];\n    installationType = data[0]['installationType'];\n    type = data[0]['Type'];\n    state = data[0]['state'];\n    active = data[0]['active'];\n    progress = data[0]['progress'];\n    measurementType = data[0]['measurementType'];\n    if (active === 'false') {\n        state = 'disconnected';\n    }\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    state = 'N/A';\n    progress = 'N/A';\n    locationName = 'N/A';\n    installationType = 'N/A';\n    active = 'N/A';\n    measurementType ='N/A';\n}\n\n/*if (installationType === 'heating') {\n    installation = '<mat-icon>local_fire_department</mat-icon>Heating';\n} else if (installationType === 'cooling') {\n    installation = '<mat-icon>ac_unit</mat-icon>Cooling';\n} else {\n    installation = '<mat-icon>question_mark</mat-icon>N/A';\n}*/\n\nif (installationType === 'heating') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: red;\">local_fire_department</mat-icon><span style=\"margin-left: 8px;\">Heating</span></div>';\n} else if (installationType === 'cooling') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: blue;\">ac_unit</mat-icon><span style=\"margin-left: 8px;\">Cooling</span></div>';\n} else {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon>question_mark</mat-icon><span style=\"margin-left: 8px;\">N/A</span></div>';\n}\n\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\n                // Zurck-Button\n                /*'<div fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                  '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\n                    '<mat-icon>arrow_back</mat-icon>' +\n                  '</button>' +\n                '</div>' +\n                // Titel und Untertitel\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                  '<div class=\"title\">' + locationName + '</div>' +\n                  '<div class=\"subtitle\">' + name + '</div>' +\n                '</div>' +*/\n                // Container fr die beiden Buttons\n                '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\">' +\n                  // Parameter-Button\n                  '<button id=\"measurement-parameters\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                    '<span>Parameters</span>' +\n                  '</button>' +\n                  // Sensors-Button\n                  '<button id=\"sensor-data\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">sensors</mat-icon>' +\n                    '<span>Sensor Data</span>' +\n                  '</button>' +\n                  // Details-Button\n                  '<button id=\"details-full\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\n                    '<span>Details</span>' +\n                  '</button>' +\n                '</div>' +\n             '</div>';\n\n\n/*return '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n          '<div fxLayout=\"row\" class=\"params\">' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Measurement Type: </div>' +\n                '<div class=\"param\">'+ measurementType +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Installation Type: </div>' +\n                '<div class=\"param\">'+ installationType +'</div>' +\n              '</div>' +\n              '<div fxFlex class=\"param-cell\" fxLayout=\"column\" fxLayoutGap=\"8px\">' +\n                '<div class=\"param-title\">Progress: </div>' +\n                '<div class=\"param\">'+ getStateHtml(progress) +'</div>' +\n              '</div>' +\n          '</div>' +\n       '<div>';*/\n       \nreturn '<div class=\"main-layout w-full h-full flex flex-col\">' +\n\n    '<div class=\"p-4 flex flex-row gap-4\" style= \"background-color: #FAFAFA\">' +\n\n      '<div class=\"flex-1 flex flex-col gap-2\">' +\n        '<div class=\"param-title\">Measurement Type:</div>' +\n        '<div class=\"param\">' + measurementType + '</div>' +\n      '</div>' +\n\n      '<div class=\"flex-1 flex flex-col gap-2\">' +\n        '<div class=\"param-title\">Installation Type:</div>' +\n        '<div class=\"param\">' + installationType + '</div>' +\n      '</div>' +\n\n      '<div class=\"flex-1 flex flex-col gap-2\">' +\n        '<div class=\"param-title\">Progress:</div>' +\n        '<div class=\"param\">' + getStateHtml(progress) + '</div>' +\n      '</div>' +\n\n    '</div>' +\n\n  '</div>';\n\n\n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n    '</span>';\n}\n\n\nfunction getStateSvg(state) {\n    switch (state) {\n        case 'in preparation':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '</svg>';\n        case 'active':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#f3de61\"/>' +\n                   '</svg>';\n        case 'finished':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#27AE60\"/>' +\n                   '</svg>';\n        /*case 'aborted':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/>' +\n                   '</svg>';*/\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"orange\"/>' +\n                   '</svg>';\n        case 'minor':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"yellow\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"green\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'minor':\n            return 'Minor';\n        case 'normal':\n            return 'normal';\n        case 'in preperation':\n            return 'in Preperation';\n        case 'active':\n            return 'active';\n        case 'finished':\n            return 'finished';\n        /*case 'aborted':\n            return 'Aborted';*/\n        default:\n            return state;\n    }\n}\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".main-layout .header {\n    height: 60px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 0 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "5392aff0-5ef7-11ef-a314-81782f443b0c",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "37e5e007-da10-e64c-be1e-899094481e42"
              },
              {
                "name": "settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#settings', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getSettingsState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '400px', getSettingsHeight(type));\n\nfunction getSettingsState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_settings';\n        case 'Room Sensor T':            \n            return 'roomsensort_settings';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_settings';                      \n        case 'Door Sensor':\n            return 'door_settings';\n        case 'Motion Sensor':\n            return 'motion_sensor_settings';\n        case 'Occupancy Sensor':\n            return 'occupancy_sensor_settings';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getSettingsHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '800px';\n        case 'Room Sensor T':            \n            return '600px';\n        case 'Room Sensor CO2':            \n            return '800px';                  \n        case 'Door Sensor':\n            return '500px';\n        case 'Motion Sensor':\n            return '340px';\n        case 'Occupancy Sensor':\n            return '500px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "076da598-f2dc-6fda-6744-db268a4c6df7"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery_level_details",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "44417062-4a4f-0479-0042-93952e15436a"
              },
              {
                "name": "details-full",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1532b4d5-2d3c-872e-57ed-d477f9b2e502"
              },
              {
                "name": "details-day",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#details-day', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_details_full';\n        case 'Room Sensor T':            \n            return 'roomsensort_details_full';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_details_full';                      \n        case 'Door Sensor':\n            return 'door_details_full';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_fulls';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':            \n            return '1000px';\n        case 'Room Sensor CO2':            \n            return '1000px';                  \n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1831fd41-86a5-53ac-1e1b-ab4f23f60807"
              },
              {
                "name": "measurement-parameters",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "modules": {
                  "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                },
                "customFunction": "const measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error('No measurement selected');\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a066a7c4-4bbb-d780-315e-af760f5b1e4e"
              },
              {
                "name": "sensor-data",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "301c8f82-5367-e4eb-a578-ca81965b5e9a"
              }
            ],
            "headerButton": []
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "e8e3d4be-2720-0677-2c04-ff9a5fdb2447",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "aa7ff32f-7ec6-0a0a-4f83-8903765633e1": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5157976480659352
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF2A",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": "var type;      \nif (data && data.length) {\n    type = data[0]['Type'];\n} else {\n    type = 'N/A';\n}\n//console.log(data[0]['entityId']);\nvar detailsStateName = getDetailsStateName(type);\n\nreturn '<div class=\"w-full h-full flex flex-col\">' +\n    '<tb-dashboard-state ' +\n      'class=\"flex-1\" ' +\n      '[ctx]=\"ctx\" ' +\n      '[syncParentStateParams]=\"true\" ' +\n      'stateId=\"' + detailsStateName + '\">' +\n    '</tb-dashboard-state>' +\n  '</div>';\n\n\n\nfunction getDetailsStateName(deviceType) {\n    switch(deviceType) {\n        case 'Measurement':\n            return 'pflow_details';\n        case 'Room Sensor T':\n            return 'roomsensort_details';\n        case 'Room Sensor CO2':\n            return 'roomsensorco2_details';\n        case 'Door Sensor':\n            return 'door_details';\n        case 'Motion Sensor':\n            return 'motion_sensor_details';\n        case 'Occupancy Sensor':\n            return 'occupancy_sensor_details';\n        default:\n            return 'unknown_details';\n    }\n}       \n       ",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ""
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedDevice'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "37e5e007-da10-e64c-be1e-899094481e42"
              },
              {
                "name": "settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#settings', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getSettingsState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '400px', getSettingsHeight(type));\n\nfunction getSettingsState(type) {\n    switch (type) {\n        case 'Smart Shelf':\n            return 'smart_shelf_settings';\n        case 'Freezer':            \n            return 'freezer_settings';\n        case 'Chiller':            \n            return 'chiller_settings';                      \n        case 'Smart Bin':\n            return 'smart_bin_settings';          \n        case 'Door Sensor':\n            return 'door_settings';\n        case 'Liquid Level Sensor':\n            return 'liquid_sensor_settings';\n        case 'Motion Sensor':\n            return 'motion_sensor_settings';\n        case 'Occupancy Sensor':\n            return 'occupancy_sensor_settings';\n        case 'Smoke Sensor':\n            return 'smoke_sensor_settings';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getSettingsHeight(type) {\n    switch (type) {\n        case 'Smart Shelf':\n            return '280px';\n        case 'Freezer':            \n            return '420px';\n        case 'Chiller':            \n            return '420px';                  \n        case 'Smart Bin':\n            return '420px';                  \n        case 'Door Sensor':\n            return '420px';\n        case 'Liquid Level Sensor':\n            return '420px';\n        case 'Motion Sensor':\n            return '280px';\n        case 'Occupancy Sensor':\n            return '420px';\n        case 'Smoke Sensor':\n            return '280px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "076da598-f2dc-6fda-6744-db268a4c6df7"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery_level_details",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "25vw",
                "popoverHeight": "25vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "44417062-4a4f-0479-0042-93952e15436a"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "aa7ff32f-7ec6-0a0a-4f83-8903765633e1",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "8805b23e-efea-86a7-d754-9fdfe37acbaa": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.031424315886006804
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.323899218375304
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\n\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\n\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\n\nreturn '<div style=\"width: 100%; height: 100%; padding: 0;\" fxLayoutGap=\"16px\" fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutAlign.gt-md=\"center center\">'+\n       '<div id=\"critical-alarms\" class=\"alarm-badge '+ criticalClass +'\"><i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ criticalCount +'</span> Critical</div>' +\n       '<div id=\"major-alarms\" class=\"alarm-badge '+ majorClass +'\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i><span class=\"alarm-count\">'+ majorCount +'</span> Major</div>' +\n       '<div>';",
            "useMarkdownTextFunction": true,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "critical-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "all_critical_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "2255454c-8c83-dfae-2e0b-8d0df6db6a70"
              },
              {
                "name": "major-alarms",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "all_major_alarms",
                "setEntityId": false,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottom",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "800px",
                "popoverHeight": "600px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "e52ae76c-959f-f84e-c6b7-3e49c242e70e"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "8805b23e-efea-86a7-d754-9fdfe37acbaa",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "displayPreparationMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.preparation.title}",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'in preparation';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'in preparation' : 'unset';"
                  },
                  "_hash": 0.4010207052742043,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayActiveMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.active.title}",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": true,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'active';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'active' : 'unset';"
                  },
                  "_hash": 0.717435526543984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayFinishedMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.finished.title}",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'finished';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'finished' : 'unset';"
                  },
                  "_hash": 0.9122349770594107,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "displayAbortedMeasurement",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.state-filter.aborted.title}",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "before",
                    "selectOptions": [],
                    "radioColor": null,
                    "radioColumns": 1,
                    "radioLabelPosition": "after",
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": true,
                    "getValueFunctionBody": "return !value || value === 'aborted';",
                    "useSetValueFunction": true,
                    "setValueFunctionBody": "return value ? 'aborted' : 'unset';"
                  },
                  "_hash": 0.7567501123338984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": false,
            "showActionButtons": false,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 3,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "State Filter",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {
            "fontWeight": "bold",
            "fontSize": "14px"
          },
          "titleStyle": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "paddingBottom": "30px"
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "noDataDisplayMessage": "",
          "widgetCss": "",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "6e0676c2-49cd-846e-9c94-80c6b2c0218c": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.measurements.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": true,
            "entityNameColumnTitle": "{i18n:custom.diagnostics.measurement-name.title}",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.diagnostics.measurements.title}",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "0995cad1-8408-0071-28a7-c305d95429e2",
              "filterId": "2d011a64-3af4-277a-980d-904145c28912",
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-address.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.5439377495268714,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8686344328279582
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "{i18n:entity-field.state}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "20%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var state = value;\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        default:\n            return state;\n    }\n}\n",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-progress.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getProgressHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.6466565617082951,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-type.title}",
                  "color": "#607d8b",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getMeasurementTypeHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.011120189088471788,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [
              {
                "name": "Selected Measurement",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nlet measurementType = \"\";\nvar stateId;\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType', 'measurementType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        if (attributes.find(attr => attr.key === 'measurementType')) {\n            measurementType = attributes.find(attr => attr.key === 'measurementType').value;\n        }\n            \n        if (measurementType === 'loraWan') {\n            stateId = 'measurement_details';\n        } else if (measurementType === 'ultrasonic') {\n            stateId = getMeasurementState(type);\n        } else {\n            stateId = getMeasurementState(type);\n        }\n        //console.log(stateId);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}\n\n\n\n/*let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "27b78a0c-3e2d-8d90-72dd-10f9f80351b5"
              }
            ],
            "actionCellButton": [
              {
                "name": "Connect Measurement",
                "icon": "add_chart",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var progress = data.Progress || data.progress;\nvar isUltrasonic = data['Measurement Type'] === 'ultrasonic';\nreturn isUltrasonic && (progress === 'in preparation' || progress === 'planned');",
                "type": "custom",
                "customFunction": {
                  "body": "utils.dataConnectorDialog(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c020f915-da89-ba7e-5aaa-49066cf1451c"
              },
              {
                "name": "{i18n:custom.diagnostics.action.measurement-parameters}",
                "icon": "settings",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var userRole = widgetContext.stateController.getStateParams().userRole;\r\n/*console.log(widgetContext.stateController.getStateParams());\r\nconsole.log(\"user role:\", userRole);*/\r\n        \r\nif (userRole !== 'Belimo Retrofit Users') {\r\n    return true;\r\n} else {\r\n    return false;\r\n}\r\n    \r\n    /*return (userRoleValue !== 'Belimo Retrofit Users');*/\r\n    \r\n\r\n   \r\n\r\n \r\n",
                "type": "custom",
                "customFunction": {
                  "body": "const measurementId = entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error(\"No measurement selected\");\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e9d60eaa-56f8-bbfb-45db-110033a2739a"
              },
              {
                "name": "{i18n:custom.diagnostics.action.measurement-commissioning.title}",
                "icon": "engineering",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var progress = data.Progress || data.progress;\nvar isUltrasonic = data['Measurement Type'] === 'ultrasonic';\nreturn isUltrasonic && progress === 'active';",
                "type": "openDashboardState",
                "targetDashboardStateId": "measurement_details",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9e3b9891-b984-4475-345e-b738850e1fda"
              },
              {
                "name": "{i18n:custom.diagnostics.action.measurement-dashboard.title}",
                "icon": "dashboard",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nlet measurementType = \"\";\nvar stateId;\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType', 'measurementType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        measurementType = attributes.find(attr => attr\n            .key === 'measurementType').value;\n            \n        if (measurementType === 'loraWan') {\n            stateId = 'measurement_details';\n        } else if (measurementType === 'ultrasonic') {\n            stateId = getMeasurementState(type);\n        } else {\n            stateId = getMeasurementState(type);\n        }\n\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6f852a67-6999-f59d-5795-e81b18274a55"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.diagnostics.action.go-back.title}",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "arrow_back",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\n/*var number = (widgetContext.stateController.getStateIndex())-1;*/\r\n\r\nparams['selectedProject'] = null;\r\nparams['targetStateParameter'] = null;\r\n\r\nparams = {\r\n    \"userRole\": params.userRole\r\n};\r\n\r\nwidgetContext.stateController.updateState(null,params);\r\n/*widgetContext.stateController.navigatePrevState(number);*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3ef7bac7-ead3-49d4-a2aa-1b80aae1b476"
              },
              {
                "name": "Measurement",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "const stateParams = widgetContext.stateController.getStateParams();\nconst selectedProject = stateParams.selectedProject;\n\nif (!selectedProject || !selectedProject.entityId || !selectedProject.entityId.id) {\n    console.error('No project selected. Please select a project first.');\n    return;\n}\n\nconst projectId = { id: selectedProject.entityId.id, entityType: 'ASSET' };\nconst projectName = selectedProject.entityName;\n\n// Determine customerId\nconst NULL_UUID = '13814000-1dd2-11b2-8080-808080808080';\nfunction isValidCustomerId(id) {\n    return id && id !== NULL_UUID;\n}\n\nconst userRole = stateParams.userRole;\nconst stateEntityId = stateParams.entityId;\nlet customerId;\n\nif ((widgetContext.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator') && stateEntityId && stateEntityId.id && isValidCustomerId(stateEntityId.id)) {\n    customerId = stateEntityId;\n    openDialog();\n} else if (isValidCustomerId(widgetContext.currentUser.customerId)) {\n    customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER' };\n    openDialog();\n} else {\n    // Fetch customerId from project asset\n    const $injector = widgetContext.$scope.$injector;\n    const assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n    assetService.getAsset(projectId.id).subscribe(projectAsset => {\n        if (projectAsset && projectAsset.customerId && isValidCustomerId(projectAsset.customerId.id)) {\n            customerId = projectAsset.customerId;\n            openDialog();\n        } else {\n            console.error('Cannot determine customerId. Project has no valid customer assigned.');\n        }\n    });\n}\n\nfunction openDialog() {\n    projectWizard.openAddMeasurementDialog(widgetContext, projectId, projectName, customerId, function(result) {\n        // Update state params with new measurement\n        const params = widgetContext.stateController.getStateParams();\n        params['selectedMeasurement'] = {\n            entityId: result.id,\n            entityName: result.name,\n            entityLabel: result.label || ''\n        };\n        widgetContext.updateAliases();\n        \n        // If connectKit checkbox was checked and it's ultrasonic, open connect dialog\n        if (result.connectKit && result.measurementType === 'ultrasonic') {\n            dataImporter.dataConnectorDialog(widgetContext, result.id, result.name);\n        }\n    });\n}",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                    "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6f6daae0-99ef-3112-baf1-9e8e6cc178b2"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "6e0676c2-49cd-846e-9c94-80c6b2c0218c",
        "typeFullFqn": "system.cards.entities_table"
      },
      "e6cefd55-e905-d7ce-8f86-08635fbe2679": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 15552000000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-startTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "reserveSpaceForHiddenAction": "true",
            "useRowStyleFunction": false,
            "alarmsTitle": "Alarms"
          },
          "title": "Alarms",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "40px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "783dd5f0-d34d-946d-a82f-95d3a6eaadd1",
            "filterId": "2d011a64-3af4-277a-980d-904145c28912",
            "dataKeys": [
              {
                "name": "startTime",
                "type": "alarm",
                "label": "Start time",
                "color": "#9c27b0",
                "settings": {
                  "columnWidth": "0px",
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": "",
                  "defaultColumnVisibility": "visible",
                  "columnSelectionToDisplay": "enabled",
                  "columnExportOption": "onlyVisible"
                },
                "_hash": 0.18228508234861218
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418
              },
              {
                "name": "progress",
                "type": "attribute",
                "label": "Progress",
                "color": "#9c27b0",
                "settings": {},
                "_hash": 0.48382170691251236,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "notifications",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": true,
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}\n",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": true
          },
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "e6cefd55-e905-d7ce-8f86-08635fbe2679",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "d680c934-edcf-4cf0-7073-cc1fb4530391": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 1,
            "history": {
              "historyType": 0,
              "timewindowMs": 2592000000,
              "interval": 1000,
              "fixedTimewindow": {
                "startTimeMs": 1640171736303,
                "endTimeMs": 1640258136303
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "reserveSpaceForHiddenAction": "true",
            "useRowStyleFunction": false,
            "alarmsTitle": "Critical Alarms"
          },
          "title": "New Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
            "filterId": null,
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "{i18n:alarm.created-time}",
                "color": "#2196f3",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.021092237451093787,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "{i18n:alarm.originator}",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "{i18n:alarm.type}",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "{i18n:alarm.severity}",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "{i18n:alarm.status}",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "more_horiz",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": true,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "CRITICAL"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true
          }
        },
        "row": 0,
        "col": 0,
        "id": "d680c934-edcf-4cf0-7073-cc1fb4530391",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "106a5add-e710-6fea-e975-a7f9b61e2802": {
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "hideInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 1,
            "history": {
              "historyType": 0,
              "timewindowMs": 2592000000,
              "interval": 1000,
              "fixedTimewindow": {
                "startTimeMs": 1640171736303,
                "endTimeMs": 1640258136303
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSelection": true,
            "enableSearch": true,
            "displayDetails": false,
            "allowAcknowledgment": true,
            "allowClear": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "enableSelectColumnDisplay": true,
            "enableStickyAction": false,
            "enableFilter": false,
            "enableStickyHeader": true,
            "reserveSpaceForHiddenAction": "true",
            "useRowStyleFunction": false,
            "alarmsTitle": "Major Alarms"
          },
          "title": "New Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": null,
            "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
            "filterId": null,
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "Created time",
                "color": "#2196f3",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.021092237451093787
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418
              }
            ]
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "more_horiz",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "datasources": [],
          "enableDataExport": true,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "alarmFilterConfig": {
            "statusList": [
              "ACTIVE"
            ],
            "severityList": [
              "MAJOR"
            ],
            "typeList": [],
            "searchPropagatedAlarms": true
          },
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "106a5add-e710-6fea-e975-a7f9b61e2802",
        "typeFullFqn": "system.alarm_widgets.alarms_table"
      },
      "ab49ec6b-ce93-15dd-53ea-c67bb6a2c01c": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "maxVolumeFlowCriticalThreshold",
                  "type": "attribute",
                  "label": "Maximum volume flow threshold for critical alarm",
                  "color": "#2196f3",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": 0,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.3859130334588563,
                  "units": "L/hr",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 2000;\n}",
                  "aggregationType": null
                },
                {
                  "name": "maxVolumeFlowMajorThreshold",
                  "type": "attribute",
                  "label": "Maximum volume flow threshold for major alarm",
                  "color": "#4caf50",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": 0,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.09378045215692454,
                  "units": "L/hr",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 1000;\n}",
                  "aggregationType": null
                },
                {
                  "name": "lowBatteryCriticalThreshold",
                  "type": "attribute",
                  "label": "Low battery threshold for critical alarm",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 0,
                    "maxValue": 100
                  },
                  "_hash": 0.3977852589212394,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 10;\n}",
                  "aggregationType": null
                },
                {
                  "name": "lowBatteryMajorThreshold",
                  "type": "attribute",
                  "label": "Low battery threshold for major alarm",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "selectOptions": [],
                    "step": 1,
                    "required": true,
                    "invalidDateErrorMessage": "",
                    "isEditable": "editable",
                    "dataKeyHidden": false,
                    "minValue": 0,
                    "maxValue": 100
                  },
                  "_hash": 0.9885317089867498,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}",
                  "aggregationType": null
                },
                {
                  "name": "maxEnergyCriticalThreshold",
                  "type": "attribute",
                  "label": "Maximum Energy Threshold for critical alarm",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 99999,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6663965222671995,
                  "aggregationType": null,
                  "units": "kWh",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 2000;\n}"
                },
                {
                  "name": "maxEnergyMajorThreshold",
                  "type": "attribute",
                  "label": "Maximum Energy Threshold for major alarm",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.7548674991392081,
                  "aggregationType": null,
                  "units": "kWh",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 2000;\n}"
                },
                {
                  "name": "minTemperatureDifferenceCriticalThreshold",
                  "type": "attribute",
                  "label": "Minimal Temperature Difference Threshold for critical alarm (C)",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.846767151443657,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 5;\n}"
                },
                {
                  "name": "minTemperatureDifferenceMajorThreshold",
                  "type": "attribute",
                  "label": "Minimal Temperature Difference Threshold for major alarm (C)",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.8768888681670524,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 15;\n};"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "column",
            "fieldsInRow": 2,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "P-Flow Settings",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "padding-top": "8px",
            "padding-bottom": "24px",
            "fontSize": "18px",
            "fontWeight": 500
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": ".tb-multiple-input button[type=submit] {\n    margin-right: 0 !important;\n}\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "displayTimewindow": true,
          "borderRadius": "8px",
          "titleFont": {
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "ab49ec6b-ce93-15dd-53ea-c67bb6a2c01c",
        "typeFullFqn": "system.input_widgets.update_multiple_attributes"
      },
      "87fc8197-77df-8eb8-ad06-b3adf7dfd24a": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {
                    "hideDataByDefault": false,
                    "disableDataHiding": false,
                    "removeFromLegend": false,
                    "excludeFromStacking": false,
                    "showLines": true,
                    "lineWidth": 1,
                    "fillLines": false,
                    "showPoints": false,
                    "tooltipValueFormatter": "",
                    "showSeparateAxis": true,
                    "axisTitle": "Temperature",
                    "axisMin": null,
                    "axisMax": null,
                    "axisPosition": "left",
                    "axisTickSize": null,
                    "axisTickDecimals": null,
                    "axisTicksFormatter": "",
                    "comparisonSettings": {
                      "showValuesForComparison": true,
                      "comparisonValuesLabel": "",
                      "color": ""
                    },
                    "thresholds": []
                  },
                  "_hash": 0.017697597730323755,
                  "units": "C",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#4caf50",
                  "settings": {
                    "hideDataByDefault": false,
                    "disableDataHiding": false,
                    "removeFromLegend": false,
                    "excludeFromStacking": false,
                    "showLines": true,
                    "lineWidth": 1,
                    "fillLines": false,
                    "showPoints": false,
                    "tooltipValueFormatter": "",
                    "showSeparateAxis": false,
                    "axisTitle": "CO2",
                    "axisMin": null,
                    "axisMax": null,
                    "axisPosition": "left",
                    "axisTickSize": null,
                    "axisTickDecimals": null,
                    "axisTicksFormatter": "",
                    "comparisonSettings": {
                      "showValuesForComparison": true,
                      "comparisonValuesLabel": "",
                      "color": ""
                    },
                    "thresholds": []
                  },
                  "_hash": 0.7943909715553428,
                  "units": "ppm",
                  "decimals": 0,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Timeseries Line Chart",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": null,
          "titleColor": null,
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "87fc8197-77df-8eb8-ad06-b3adf7dfd24a"
      },
      "c44b1059-5a11-90ca-1bfe-fece6fa42852": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "highCo2CriticalThreshold",
                  "type": "attribute",
                  "label": "High CO2 Threshold for critical alarm (ppm)",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 5000,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.7069728513113278,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 2000;\n}"
                },
                {
                  "name": "highCo2MajorThreshold",
                  "type": "attribute",
                  "label": "High CO2 Threshold for major alarm (ppm)",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 5000,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.9054961611432217,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 1000;\n}"
                },
                {
                  "name": "highTemperatureCriticalThreshold",
                  "type": "attribute",
                  "label": "High Temperature Threshold for critical alarm (C)",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "double",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 40,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.28532995014756324,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}"
                },
                {
                  "name": "highTemperatureMajorThreshold",
                  "type": "attribute",
                  "label": "High Temperature Threshold for major alarm (C)",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "double",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 40,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5566141757806922,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 27;\n}"
                },
                {
                  "name": "highHumidityCriticalThreshold",
                  "type": "attribute",
                  "label": "High Humidity Threshold for critical alarm (% r.H.)",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6532879324088665,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 90;\n}"
                },
                {
                  "name": "highHumidityMajorThreshold",
                  "type": "attribute",
                  "label": "High Humidity Threshold for major alarm (% r.H.)",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.36112993452243014,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 70;\n}"
                },
                {
                  "name": "lowBatteryCriticalThreshold",
                  "type": "attribute",
                  "label": "Low Battery Threshold for critical alarm (%)",
                  "color": "#2196f3",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.19000312613717574,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 10;\n}"
                },
                {
                  "name": "lowBatteryMajorThreshold",
                  "type": "attribute",
                  "label": "Low Battery Threshold for major alarm (%)",
                  "color": "#4caf50",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.024171448838607335,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1708884710235,
                "endTimeMs": 1708971110235
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "column",
            "fieldsInRow": 2,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "Sensor Settings",
          "dropShadow": true,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleFont": {
            "sizeUnit": "px",
            "family": null,
            "weight": "bold",
            "style": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "c44b1059-5a11-90ca-1bfe-fece6fa42852"
      },
      "2bc5f64c-7fee-8bb6-336d-8a2cbf961524": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#E89623",
                  "settings": {},
                  "_hash": 0.47709016535438975,
                  "units": "ppm",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "CO2",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "2bc5f64c-7fee-8bb6-336d-8a2cbf961524"
      },
      "cf5253e9-b2c8-ac67-491f-282c24015c21": {
        "typeFullFqn": "system.range_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "deviceId": "f914c020-c664-11ee-8196-b3999b4a11b6",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.463540446159211,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "dataZoom": false,
            "rangeColors": [
              {
                "from": 0,
                "to": 500,
                "color": "#234CC7"
              },
              {
                "from": 501,
                "to": 700,
                "color": "#305AD7"
              },
              {
                "from": 701,
                "to": 850,
                "color": "#7191EF"
              },
              {
                "from": 851,
                "to": 1000,
                "color": "#FFA600"
              },
              {
                "from": 1001,
                "to": 1500,
                "color": "#F36900"
              },
              {
                "from": 1501,
                "to": 2000,
                "color": "#F04022"
              },
              {
                "from": 2001,
                "to": null,
                "color": "#D81838"
              }
            ],
            "outOfRangeColor": "#ccc",
            "fillArea": true,
            "showLegend": true,
            "legendPosition": "top",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "showTooltip": true,
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": "dd MMM yyyy HH:mm",
              "lastUpdateAgo": false,
              "custom": false
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "tooltipDateInterval": true
          },
          "title": "Range Chart: CO2",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "ppm",
          "decimals": 0,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "cf5253e9-b2c8-ac67-491f-282c24015c21"
      },
      "e9207298-bc6a-64ad-e3db-5643079ea688": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.5604701312483413,
                  "units": "C",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Temperature",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "e9207298-bc6a-64ad-e3db-5643079ea688"
      },
      "680c4c4a-31e7-b07f-1679-38b96e3d9805": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#048AD3",
                  "settings": {},
                  "_hash": 0.20661271100689915,
                  "units": "%",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Humidity",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "basic",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "680c4c4a-31e7-b07f-1679-38b96e3d9805"
      },
      "6917478a-b64c-bf6f-8a55-92f1704fc6b5": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.9023657151544773,
                  "units": "C",
                  "decimals": 1
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Temperature",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "6917478a-b64c-bf6f-8a55-92f1704fc6b5"
      },
      "070179fc-7774-89e8-ec56-1ef4f1c1c8b8": {
        "typeFullFqn": "system.range_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "deviceId": "f914c020-c664-11ee-8196-b3999b4a11b6",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8890563038125108
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "dataZoom": true,
            "rangeColors": [
              {
                "from": null,
                "to": 10,
                "color": "#234CC7"
              },
              {
                "from": 10,
                "to": 15,
                "color": "#305AD7"
              },
              {
                "from": 15,
                "to": 20,
                "color": "#7191EF"
              },
              {
                "from": 20,
                "to": 25,
                "color": "#FFA600"
              },
              {
                "from": 20,
                "to": 30,
                "color": "#F36900"
              },
              {
                "from": 30,
                "to": 35,
                "color": "#F04022"
              },
              {
                "from": 35,
                "to": null,
                "color": "#D81838"
              }
            ],
            "outOfRangeColor": "#ccc",
            "fillArea": true,
            "showLegend": true,
            "legendPosition": "top",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "showTooltip": true,
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": "dd MMM yyyy HH:mm",
              "lastUpdateAgo": false,
              "custom": false
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Temperature",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "basic",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "L/hr",
          "decimals": 0,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "070179fc-7774-89e8-ec56-1ef4f1c1c8b8"
      },
      "7f5d298e-ace3-6483-1092-1c6b50934a19": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.41794951591076934,
                  "units": "%",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Humidity",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "7f5d298e-ace3-6483-1092-1c6b50934a19"
      },
      "a840f0bb-80fb-abca-4576-801d29551ba0": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "vdd",
                  "type": "timeseries",
                  "label": "Battery Voltage",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.07673624074182261,
                  "units": "V",
                  "decimals": 3,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value/1000;"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Battery Voltage",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "a840f0bb-80fb-abca-4576-801d29551ba0"
      },
      "d4b83442-1ea0-9415-6a0b-1f7935f9bd7c": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.5555217927853249,
                  "units": "C",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Tempe",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": null,
          "titleColor": null,
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "d4b83442-1ea0-9415-6a0b-1f7935f9bd7c"
      },
      "4ac2a89e-42b7-ebfb-eae1-e881e40943af": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "highTemperatureCriticalThreshold",
                  "type": "attribute",
                  "label": "High Temperature Threshold for critical alarm (C)",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 40,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.28532995014756324,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}"
                },
                {
                  "name": "highTemperatureMajorThreshold",
                  "type": "attribute",
                  "label": "High Temperature Threshold for major alarm (C)",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 40,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5566141757806922,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 27;\n}"
                },
                {
                  "name": "highHumidityCriticalThreshold",
                  "type": "attribute",
                  "label": "High Humidity Threshold for critical alarm (% r.H.)",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6532879324088665,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 90;\n}"
                },
                {
                  "name": "highHumidityMajorThreshold",
                  "type": "attribute",
                  "label": "High Humidity Threshold for major alarm (% r.H.)",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.36112993452243014,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 70;\n}"
                },
                {
                  "name": "lowBatteryCriticalThreshold",
                  "type": "attribute",
                  "label": "Low Battery Threshold for critical alarm (%)",
                  "color": "#2196f3",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.19000312613717574,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 10;\n}"
                },
                {
                  "name": "lowBatteryMajorThreshold",
                  "type": "attribute",
                  "label": "Low Battery Threshold for major alarm (%)",
                  "color": "#4caf50",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "integer",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": 100,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.024171448838607335,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value){\n    return value;\n} else {\n    return 30;\n}"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1708884710235,
                "endTimeMs": 1708971110235
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": false,
            "saveButtonLabel": "",
            "resetButtonLabel": "",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "column",
            "fieldsInRow": 2,
            "rowGap": 0,
            "columnGap": 10
          },
          "title": "Settings",
          "dropShadow": true,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "4ac2a89e-42b7-ebfb-eae1-e881e40943af"
      },
      "29c4ec73-3130-f5e7-5f6f-fa646591108e": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "CHC_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "Energy Heating",
                  "color": "#E91E63",
                  "settings": {},
                  "_hash": 0.8308802191522042,
                  "units": "kWh",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": true,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Energy Heating",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "29c4ec73-3130-f5e7-5f6f-fa646591108e"
      },
      "5661ff7b-5b0c-bd01-4898-2dfda22776dd": {
        "typeFullFqn": "system.range_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "deviceId": "f914c020-c664-11ee-8196-b3999b4a11b6",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "CHC_S_VolumeFlow",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.9199666930810841
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "dataZoom": true,
            "rangeColors": [
              {
                "from": null,
                "to": 100,
                "color": "#234CC7"
              },
              {
                "from": 100,
                "to": 500,
                "color": "#305AD7"
              },
              {
                "from": 500,
                "to": 2000,
                "color": "#7191EF"
              },
              {
                "from": 2001,
                "to": 5000,
                "color": "#FFA600"
              },
              {
                "from": 5001,
                "to": 10000,
                "color": "#F36900"
              },
              {
                "from": 10001,
                "to": 15000,
                "color": "#F04022"
              },
              {
                "from": 15001,
                "to": null,
                "color": "#D81838"
              }
            ],
            "outOfRangeColor": "#ccc",
            "fillArea": true,
            "showLegend": true,
            "legendPosition": "top",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "showTooltip": true,
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": "dd MMM yyyy HH:mm",
              "lastUpdateAgo": false,
              "custom": false
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Volume Flow",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "basic",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "L/hr",
          "decimals": 0,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "1px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "5661ff7b-5b0c-bd01-4898-2dfda22776dd"
      },
      "e3277349-ad52-3e0a-015c-f260a68bb0cf": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "Flow Temperature",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.8121514991311551,
                  "units": "C",
                  "decimals": 0
                },
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "Return Tempertaure",
                  "color": "#048AD3",
                  "settings": {},
                  "_hash": 0.4676027312934654,
                  "units": "C",
                  "decimals": 0
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "Temperature Difference",
                  "color": "#E89623",
                  "settings": {},
                  "_hash": 0.7256583479193239,
                  "units": "C",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "enableSelection": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "tooltipValueFormatter": "",
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": true,
            "thresholdsLineWidth": null,
            "comparisonEnabled": false,
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Flow and Return Tempertaure",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "e3277349-ad52-3e0a-015c-f260a68bb0cf"
      },
      "3d4965dd-8090-5d23-d81e-231301edd42f": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "CHC_C_Volume",
                  "type": "timeseries",
                  "label": "Volume",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.29412091168199916,
                  "units": "m",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Volume",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": null,
          "enableDataExport": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "3d4965dd-8090-5d23-d81e-231301edd42f"
      },
      "b4c2a5f0-b2d3-af37-7585-f2ea20fd928a": {
        "typeFullFqn": "system.date.date_range_navigator",
        "type": "static",
        "sizeX": 5,
        "sizeY": 5.5,
        "config": {
          "datasources": [
            {
              "type": "static",
              "name": "function",
              "dataKeys": [
                {
                  "name": "f(x)",
                  "type": "function",
                  "label": "Random",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.15479322438769105,
                  "funcBody": "var value = prevValue + Math.random() * 100 - 50;\nvar multiplier = Math.pow(10, 2 || 0);\nvar value = Math.round(value * multiplier) / multiplier;\nif (value < -1000) {\n\tvalue = -1000;\n} else if (value > 1000) {\n\tvalue = 1000;\n}\nreturn value;"
                }
              ]
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "defaultInterval": "week",
            "stepSize": "day",
            "useSessionStorage": true
          },
          "title": "Date range",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": true,
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "b4c2a5f0-b2d3-af37-7585-f2ea20fd928a"
      },
      "3ae8dcc8-ab98-9029-9ce7-ef3278d38a4b": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7596279317284409
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802275365,
                "endTimeMs": 1709888675365
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 30,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": "dd.MM.yyyy, h:mm",
              "lastUpdateAgo": false,
              "custom": true
            },
            "dateFont": {
              "size": 18,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "C",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "3ae8dcc8-ab98-9029-9ce7-ef3278d38a4b"
      },
      "c8f8d8bd-675c-fa4c-5347-f86d3bf18bc0": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7519168653731356
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802313945,
                "endTimeMs": 1709888713945
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 30,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "mdi:water-percent",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": "dd.MM.yyyy, h:mm",
              "lastUpdateAgo": false,
              "custom": true
            },
            "dateFont": {
              "size": 18,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "%",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "c8f8d8bd-675c-fa4c-5347-f86d3bf18bc0"
      },
      "aa210274-7e83-dd1e-76a8-d529b493763a": {
        "typeFullFqn": "system.date.date_range_navigator",
        "type": "static",
        "sizeX": 5,
        "sizeY": 5.5,
        "config": {
          "datasources": [
            {
              "type": "static",
              "name": "function",
              "dataKeys": [
                {
                  "name": "f(x)",
                  "type": "function",
                  "label": "Random",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.15479322438769105,
                  "funcBody": "var value = prevValue + Math.random() * 100 - 50;\nvar multiplier = Math.pow(10, 2 || 0);\nvar value = Math.round(value * multiplier) / multiplier;\nif (value < -1000) {\n\tvalue = -1000;\n} else if (value > 1000) {\n\tvalue = 1000;\n}\nreturn value;"
                }
              ]
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "defaultInterval": "week",
            "stepSize": "day",
            "useSessionStorage": true
          },
          "title": "Date-range-navigator",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {}
        },
        "row": 0,
        "col": 0,
        "id": "aa210274-7e83-dd1e-76a8-d529b493763a"
      },
      "4da35c6f-23cf-8e97-0199-31df847bf881": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.96293937289271
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802689003,
                "endTimeMs": 1709889089003
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 30,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "C",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "4da35c6f-23cf-8e97-0199-31df847bf881"
      },
      "9a1a3549-3407-a31b-ed9a-78818516d3e0": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.6497522501457633
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802778399,
                "endTimeMs": 1709889178399
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 30,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "%",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "9a1a3549-3407-a31b-ed9a-78818516d3e0"
      },
      "28432f7d-12b7-a81d-208e-27e2710ac818": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.9281198282731116
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802813543,
                "endTimeMs": 1709889213543
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 30,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "ppm",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "28432f7d-12b7-a81d-208e-27e2710ac818"
      },
      "87314bbb-97ef-cc18-88c5-b27cb0d97bdf": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n          ('<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"pflow_details_heating_full\"></tb-dashboard-state>' +\n               '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"device_card_details\"></tb-dashboard-state>') \n             +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "87314bbb-97ef-cc18-88c5-b27cb0d97bdf"
      },
      "f337da30-2ec6-4c29-ee85-8d63e210b4e4": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "let $injector = ctx.$scope.$injector;\nlet params = ctx.stateController.getStateParams();\n//ctx.dialogs.alert('Params:', JSON.stringify(params));\nvar deviceState;\nvar stateId = params.state||\"pflow_details_cooling_full\"; // Default stateId\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n//var params=ctx.stateController.getParams();\n// Ensure the event listeners are attached after the DOM is loaded\ndocument.addEventListener('DOMContentLoaded', (event) => {\n    document.getElementById('data-button').addEventListener('click', function() {\n        changeState('pflow_details_cooling_full', this);\n    });\n    document.getElementById('report-button').addEventListener('click', function() {\n        changeState('pflow_analysis_cooling_full', this);\n    });\n    document.getElementById('settings-button').addEventListener('click', function() {\n        changeState('pflow_settings', this);\n    });\n});\n\nfunction changeState(newStateId, button) {\n    stateId = newStateId;\n    var dashboardState = document.getElementById('dashboard-state');\n    dashboardState.setAttribute('stateId', stateId);\n    \n    // Remove the active class from all buttons\n    var buttons = document.querySelectorAll('button');\n    buttons.forEach(function(btn) {\n        btn.classList.remove('active-button');\n    });\n    \n    // Add the active class to the clicked button\n    button.classList.add('active-button');\n    \n    // If needed, force a re-render or update the component state\n    dashboardState.innerHTML = ''; // Clear content if necessary\n    dashboardState.innerHTML = '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"' + stateId + '\"></tb-dashboard-state>';\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"margin: 10px; background-color: #f5f5f5; padding: 10px; border-bottom: 1px solid #ddd;\">' +\n            '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button style=\"margin-right: 10px;\"><mat-icon>arrow_back</mat-icon></button>' +\n            '<button id=\"data-button\" matTooltip=\"Data\" type=\"button\" mat-button ' +\n                'style=\"border-radius: 15px; padding: 10px 20px; font-size: 16px; margin-right: 10px;\">Data</button>' +\n            '<button id=\"report-button\" matTooltip=\"Report\" type=\"button\" mat-button ' +\n                'style=\"border-radius: 15px; padding: 10px 20px; font-size: 16px; margin-right: 10px;\">Report</button>' +\n            '<button id=\"settings-button\" matTooltip=\"Settings\" type=\"button\" mat-button ' +\n                'style=\"border-radius: 15px; padding: 10px 20px; font-size: 16px; margin-right: 10px;\">Settings</button>' +\n        '</div>' +\n        // Body\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"' + stateId + '\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "try {\n    let params = widgetContext.stateController.getStateParams();\n    //let helper = params.selectedDevice;\n    /*if(params.selectedDevice){\n        delete params.selectedDevice;\n    }*/\n    // Set state to \"pflow_analysis_cooling_full\"\n    params.state = \"pflow_analysis_cooling_full\";\n    //params.entityName = helper.entityName;\n    //params.entityId = helper.entityId;\n    // Display params for testing purposes\n    widgetContext.dialogs.alert('test:', JSON.stringify(params));\n\n    // Update state\n    widgetContext.stateController.updateState(null,params, true);\n} catch (error) {\n    // Optionally, you can display an alert or perform other error handling actions\n    widgetContext.dialogs.alert('Error:', 'Failed to update state.', error);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "try {\n    let params = widgetContext.stateController.getStateParams();\n    if(params.selectedDevice){\n        delete params.selectedDevice;\n    }    // Set state to \"pflow_details_cooling_full\"\n    params.state = \"pflow_details_cooling_full\";\n    // Display params for testing purposes\n    widgetContext.dialogs.alert('test:', JSON.stringify(params));\n\n    // Update state\n    widgetContext.stateController.updateState(null, params, true);\n} catch (error) {\n    // Optionally, you can display an alert or perform other error handling actions\n    widgetContext.dialogs.alert('Error:', 'Failed to update state.', error);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "try {\n    let params = widgetContext.stateController.getStateParams();\n    if(params.selectedDevice){\n        delete params.selectedDevice;\n    }\n    // Set state to \"pflow_settings\"\n    params.state = \"pflow_settings\";\n    // Display params for testing purposes\n    widgetContext.dialogs.alert('test:', JSON.stringify(params));\n\n    // Update state\n    widgetContext.stateController.updateState(null, params, true);\n} catch (error) {\n    // Optionally, you can display an alert or perform other error handling actions\n    widgetContext.dialogs.alert('Error:', 'Failed to update state.', error);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "f337da30-2ec6-4c29-ee85-8d63e210b4e4"
      },
      "06eaaf19-559a-967f-7911-9619d9a57607": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_details_cooling_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Data",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "06eaaf19-559a-967f-7911-9619d9a57607"
      },
      "4e40953b-c12c-d708-164d-5b70bbf2a968": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_analysis_cooling_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Analysis",
              "showIcon": true,
              "icon": "troubleshoot",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "4e40953b-c12c-d708-164d-5b70bbf2a968"
      },
      "dc347069-3e77-444f-88bc-89244f6b673f": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_settings",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Settings",
              "showIcon": true,
              "icon": "settings",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_settings_cooling",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "dc347069-3e77-444f-88bc-89244f6b673f"
      },
      "bc6323a3-b6b2-1682-d675-ec84f43d282c": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_details_cooling_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Back",
              "showIcon": true,
              "icon": "mdi:arrow-left-circle",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "go-back",
                "icon": "mdi:arrow-left-circle",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "bc6323a3-b6b2-1682-d675-ec84f43d282c"
      },
      "477d7249-dc45-1b10-d654-c6dbcd64891f": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"pflow_header_buttons_cooling\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "477d7249-dc45-1b10-d654-c6dbcd64891f"
      },
      "f0dfbf6c-c2b0-2975-eb81-df9748cae9a5": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.017780279769597174,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.22474637380276485
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.709327809947802
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.2676021249658249
                },
                {
                  "name": "installationTypeOptions",
                  "type": "attribute",
                  "label": "installationTypeOptions",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.35597892581066426
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8462392482745986
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.312769116057807
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.5314446691155006
                },
                {
                  "name": "dimension",
                  "type": "attribute",
                  "label": "dimension",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.8453803324883225
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.10102575048646112
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.7997860161209402
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "0995cad1-8408-0071-28a7-c305d95429e2",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.8016917353994459
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.5728925212540854,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": {
              "body": "let $injector = ctx.$scope.$injector;\nlet assetService = $injector.get(ctx.servicesMap.get('assetService'));\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nvar entityId;\nvar deviceState;\n/*if (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n    entityId = data[0]['entityId'];\n} else {\n    deviceState = false;\n    entityId = null;\n}*/\n\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n\n    // Handle both string and object forms\n    if (typeof data[0]['entityId'] === 'string') {\n        entityId = {\n            id: data[0]['entityId'],\n            entityType: 'ASSET' // or use data[0].entityType if available\n        };\n    } else {\n        entityId = data[0]['entityId'];\n    }\n\n} else {\n    deviceState = false;\n    entityId = null;\n}\n\n/*var userRole = data[1].role;*/\n\nvar stateParams = ctx.stateController.getStateParams();\nvar userRole = stateParams.userRole;\n/*stateParams[\"userRole\"] = userRole;*/\nctx.stateController.updateState(null, stateParams);\n\nvar ButtonHtml = '';\nif (userRole !== \"Belimo Retrofit Users\") {\n    ButtonHtml =\n        '<button id=\"parameter-button\" type=\"button\" mat-button color=\"primary\">' +\n        '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.action.measurement-parameters}</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n        '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n        '</button>';\n}\nvar name, label, state, active, progress, locationName, installationType, installation, dimension, installationTypeOptions, measurementType, startTime, endTime;\nif (data && data.length) {\n    name = data[0]['entityName'] || 'N/A';\n    label = data[0]['Label'] || 'N/A';\n    locationName = data[0]['locationName'] || 'N/A';\n    installationType = data[0]['installationType'] || 'N/A';\n    installationTypeOptions = data[0]['installationTypeOptions'] || 'N/A';\n    dimension = data[0]['dimension'] || 'N/A';\n    state = data[0]['state'] || 'N/A';\n    active = data[0]['active'] || 'N/A';\n    progress = data[0]['progress'] || 'N/A';\n    measurementType = data[0]['measurementType'] || 'N/A';\n    startTime = data[0]['startTimeMs'] || 'N/A';\n    endTime = data[0]['endTimeMs'] || 'N/A';\n    if (active === 'false') {\n        state = 'disconnected';\n    }\n}\n\n/*if (installationType === \"cooling\") {\n    console.log(data);\n}*/\n\n// finished & aborted\nif (startTime !== 'N/A' && endTime !== 'N/A') {\n    deltaTime = endTime - startTime;\n    timeThreshold = 3024000000; // 35 days\n    if (deltaTime <= timeThreshold) {\n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: startTime, // now - 2 weeks\n                    endTimeMs: endTime\n                }\n            },\n            selectedTab: 1\n        };\n    } else {\n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: endTime - timeThreshold, // now - 2 weeks\n                    endTimeMs: endTime\n                }\n            },\n            selectedTab: 1\n        };\n    }\n}\n// active\nelse if (startTime !== 'N/A' && endTime === 'N/A') {\n    var newDashboardtimewindow = {\n        aggregation: {\n            limit: 100000,\n            type: \"NONE\"\n        },\n        hideAggInterval: true,\n        hideAggregation: true,\n        hideInterval: false,\n        history: {\n            historyType: 1,\n            fixedTimewindow: {\n                startTimeMs: startTime,\n                endTimeMs: Date.now()\n            }\n        },\n        selectedTab: 1\n    };\n// default\n}\nelse {\n    var newDashboardtimewindow = {\n        aggregation: {\n            limit: 100000,\n            type: \"NONE\"\n        },\n        hideAggInterval: true,\n        hideAggregation: true,\n        hideInterval: false,\n        history: {\n            historyType: 1,\n            fixedTimewindow: {\n                startTimeMs: Date.now() - 1209600000, // now - 2 weeks\n                endTimeMs: Date.now()\n            }\n        },\n        selectedTab: 1\n    };\n}\n\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\nctx.stateController.updateState(null, stateParams);\n\n/*var projectAssetQuery = {\n    \"parameters\": {\n        \"rootId\": entityId,\n        \"rootType\": \"ASSET\",\n        \"direction\": \"TO\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 1073741824,\n        \"fetchLastLevelOnly\": false\n    },\n    \"relationType\": \"Owns\",\n    \"assetTypes\": [\n        \"Project\"\n    ]\n};*/\n\nvar projectAssetQuery = {\n    \"parameters\": {\n        \"rootId\": entityId.id || entityId, // Use string ID\n        \"rootType\": entityId.entityType || \"ASSET\",\n        \"direction\": \"TO\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 1073741824,\n        \"fetchLastLevelOnly\": false\n    },\n    \"relationType\": \"Owns\",\n    \"assetTypes\": [\n        \"Project\"\n    ]\n};\n\n\nassetService.findByQuery(projectAssetQuery).subscribe(\n    function(projects) {\n        if (projects && projects.length > 0) {\n            var projectId = projects[0].id.id || projects[0].id;\n            /*console.log(\"Found project with ID:\", projectId);*/\n\n            var measurementAssetsQuery = {\n                \"parameters\": {\n                    \"rootId\": projectId,\n                    \"rootType\": \"ASSET\",\n                    \"direction\": \"FROM\",\n                    \"relationTypeGroup\": \"COMMON\",\n                    \"maxLevel\": 1073741824,\n                    \"fetchLastLevelOnly\": false\n                },\n                \"relationType\": \"Owns\",\n                \"assetTypes\": [\n                    \"Measurement\"\n                ]\n            };\n\n            assetService.findByQuery(measurementAssetsQuery).subscribe(\n                function(measurements) {\n                    /* console.log(\"Measurements found:\", measurements);*/\n                    // Build the dropdown and insert it into the container beside the buttons\n                    var dropdownHtml = buildMeasurementDropdown(measurements);\n                    document.getElementById(\"measurement-dropdown-container\").innerHTML = dropdownHtml;\n                    // Now attach the change listener to the newly inserted dropdown\n                    var dropdownEl = document.getElementById(\"measurement-dropdown\");\n                    if (dropdownEl) {\n                        dropdownEl.addEventListener(\"change\", function(e) {\n                            onMeasurementChange(e.target.value);\n                        });\n                    }\n                },\n                function(error) {\n                    console.error(\"Error fetching measurements:\", error);\n                }\n            );\n        } else {\n            console.log(\"No project found.\");\n        }\n    },\n    function(error) {\n        console.error(\"Error fetching project:\", error);\n    }\n);\n\n    // Helper function for state badges\n    function getStateBadge(state, type) {\n        var badgeClass = '';\n        var icon = '';\n        var label = '';\n        \n        switch (state) {\n            case 'in preparation':\n                badgeClass = 'badge-preparation';\n                icon = 'schedule';\n                label = '{i18n:custom.diagnostics.state-filter.preparation.title}';\n                break;\n            case 'active':\n                badgeClass = 'badge-active';\n                icon = 'play_circle';\n                label = '{i18n:custom.diagnostics.state-filter.active.title}';\n                break;\n            case 'finished':\n                badgeClass = 'badge-finished';\n                icon = 'check_circle';\n                label = '{i18n:custom.diagnostics.state-filter.finished.title}';\n                break;\n            case 'aborted':\n                badgeClass = 'badge-aborted';\n                icon = 'cancel';\n                label = '{i18n:custom.diagnostics.state-filter.aborted.title}';\n                break;\n            case 'critical':\n                badgeClass = 'badge-critical';\n                icon = 'error';\n                label = '{i18n:alarm.severity-critical}';\n                break;\n            case 'major':\n                badgeClass = 'badge-major';\n                icon = 'warning';\n                label = '{i18n:alarm.severity-major}';\n                break;\n            case 'minor':\n                badgeClass = 'badge-minor';\n                icon = 'info';\n                label = '{i18n:alarm.severity-minor}';\n                break;\n            case 'normal':\n                badgeClass = 'badge-normal';\n                icon = 'check_circle';\n                label = '{i18n:alarm.severity-normal}';\n                break;\n            case 'disconnected':\n                badgeClass = 'badge-disconnected';\n                icon = 'link_off';\n                label = '{i18n:device.inactive}';\n                break;\n            default:\n                badgeClass = 'badge-default';\n                icon = 'help';\n                label = state || 'N/A';\n        }\n        \n        return '<span class=\"status-badge ' + badgeClass + '\">' +\n               '<mat-icon class=\"badge-icon\">' + icon + '</mat-icon>' +\n               '<span>' + label + '</span>' +\n               '</span>';\n    }\n    \n    // Installation type badge - COOLING\n    var installationBadge = '<span class=\"status-badge badge-cooling\">' +\n        '<mat-icon class=\"badge-icon\">ac_unit</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.measurement-type.cooling.title}</span>' +\n        '</span>';\n    \n    // Type badge (installation type options)\n    var typeBadge = '<span class=\"status-badge badge-type\">' +\n        `{i18n:custom.diagnostics.action.edit-measurement-parameters.installation-type-options.${clientUtils.toKebabCase(installationTypeOptions)}.title}` +\n        '</span>';\n    \n    var header = '<div class=\"measurement-header flex items-center justify-between\">' +\n\n    // Back Button (left)\n    '<div class=\"flex-none\">' +\n      '<button id=\"go-back\" matTooltip=\"{i18n:action.go-back}\" type=\"button\" mat-icon-button class=\"p-2\">' +\n        '<mat-icon>arrow_back</mat-icon>' +\n      '</button>' +\n    '</div>' +\n\n    // Title + Badges section\n    '<div class=\"flex flex-row items-center flex-1 gap-3\">' +\n      // Title\n      '<div class=\"header-title\">' + locationName + '</div>' +\n      // Badges row\n      '<div class=\"flex items-center gap-2 flex-wrap\">' +\n        installationBadge +\n        typeBadge +\n        getStateBadge(state, 'state') +\n        getStateBadge(progress, 'progress') +\n      '</div>' +\n    '</div>' +\n\n    // Action buttons (right)\n    '<div class=\"flex-none flex items-center\">' +\n      ButtonHtml +\n      '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\" class=\"flex items-center\">' +\n        '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.reports-btn.title}</span>' +\n      '</button>' +\n      '<div id=\"measurement-dropdown-container\" class=\"ml-4\"></div>' +\n    '</div>' +\n\n  '</div>';\n\nreturn '' +\n    '<div class=\"main-layout flex flex-col w-full h-full\">' +\n    header +\n    '<div id=\"power_measurement_cooling_wrapper\" class=\"flex-1 w-full h-full\">' +\n    '<tb-dashboard-state class=\"w-full h-full\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_data_cooling\"></tb-dashboard-state>' +\n    '</div>' +\n    '</div>';\n\n\n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n        '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n        '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n        '</span>';\n}\n\nfunction getStateSvg(state) {\n    switch (state) {\n        case 'in preparation':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/></svg>';\n        case 'active':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"yellow\"/></svg>'; // #f3de61\n        case 'finished':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"green\"/></svg>'; // #27AE60\n        case 'aborted':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n        case 'major':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"orange\"/></svg>';\n        case 'minor':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"yellow\"/></svg>';\n        case 'normal':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"green\"/></svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                '<g clip-path=\"url(#clip0)\">' +\n                '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                '<path d=\"M1.93 16.73L16.07 2.59L17.49 4L3.34 18.14L1.93 16.73Z\" fill=\"#CAC1D2\"/>' +\n                '</g>' +\n                '<defs><clipPath id=\"clip0\"><rect width=\"20\" height=\"20\" fill=\"white\"/></clipPath></defs>' +\n                '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/></svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n        return `{i18n:custom.diagnostics.measurement-details.state.${clientUtils.toKebabCase(state)}}`\n}\n\nvar measurementData = [];\n\nfunction buildMeasurementDropdown(measurements) {\n    measurementData = measurements;\n\n    // Retrieve the current measurement's id from state params (if available)\n    var stateParams = ctx.stateController.getStateParams();\n    var currentMeasurementId = null;\n    if (stateParams && stateParams.selectedMeasurement) {\n        currentMeasurementId = stateParams.selectedMeasurement.entityId.id || stateParams.selectedMeasurement.entityId;\n    }\n\n    // Filter and sort measurements\n    var sortedMeasurements = measurements\n        .filter(function(measurement) {\n            var mId = measurement.id.id || measurement.id;\n            return mId !== currentMeasurementId;\n        })\n        .sort(function(a, b) {\n            var aName = a.entityName || a.name || \"\";\n            var bName = b.entityName || b.name || \"\";\n            var aMatch = aName.match(/(\\d+)$/);\n            var bMatch = bName.match(/(\\d+)$/);\n            var aNum = aMatch ? parseInt(aMatch[1], 10) : 0;\n            var bNum = bMatch ? parseInt(bMatch[1], 10) : 0;\n            return aNum - bNum;\n        });\n\n\n    var defaultTitle = (locationName && locationName !== 'N/A') ? locationName : \"Select Measurement\";\n    defaultTitle += \" \\u25BE\";\n\n    var dropdownHtml = '<select id=\"measurement-dropdown\" ' +\n        'onfocus=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\" ' +\n        'onblur=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\" ' +\n        'style=\"height: 40px; padding: 0 15px; font-size: 18px; font-weight: 500; ' +\n        'background-color: #E0E0E0; color: #28232D; margin-right: 10px; border: none; ' +\n        'border-radius: 4px; -webkit-appearance: none; appearance: none; ' +\n        'white-space: pre;\">';\n\n    dropdownHtml += '<option value=\"\" style=\"background-color: #f0f0f0; color: #28232D; ' +\n        'font-size: 18px; font-weight: 400; white-space: pre;\" selected; padding-right: 20px;>' +\n        defaultTitle + '</option>';\n\n    // Helper: pad a string to a fixed length (by characters)\n    function padString(str, length) {\n        str = str || \"\";\n        if (str.length >= length) return str.substring(0, length);\n        return str + \" \".repeat(length - str.length);\n    }\n\n    // Define fixed column widths (in number of characters)\n    var leftColumnWidth = 30;  // for locationName\n    var rightColumnWidth = 30; // for entityName\n\n    // Build each option\n    sortedMeasurements.forEach(function(measurement) {\n        var mId = measurement.id.id || measurement.id;\n        var optionId = \"measurement-option-\" + mId;\n        dropdownHtml += '<option id=\"'+ optionId +'\" value=\"' + mId + '\" ' +\n            'style=\"background-color: #f0f0f0; color: #28232D; font-size: 18px; ' +\n            'font-weight: 400; white-space: pre; padding-right: 20px;\">' +\n            'Loading...' +\n            '</option>';\n\n        // Fetch the locationName asynchronously\n        attributeService.getEntityAttributes(measurement.id, 'SERVER_SCOPE', ['locationName'])\n            .subscribe(\n                function(attributes) {\n                    var locationAttr = attributes.find(attr => attr.key === 'locationName');\n                    var locationDisplay = locationAttr ? locationAttr.value : \"N/A\";\n                    var entityDisplay = measurement.entityName || measurement.name || mId;\n                    // Pad both sides so that the divider always appears in the middle.\n                    var leftText = padString(locationDisplay, leftColumnWidth);\n                    var rightText = padString(entityDisplay, rightColumnWidth);\n                    // Append non-breaking spaces for extra right-side padding.\n                    var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\"; // Adjust count as needed\n                    var displayText = leftText + \"  \" + rightText + trailingPadding;\n                    var optionEl = document.getElementById(optionId);\n                    if (optionEl) {\n                        optionEl.innerHTML = displayText;\n                    }\n                },\n                function(error) {\n                    console.error(\"Error fetching locationName for measurement\", measurement, error);\n                    var entityDisplay = measurement.entityName || measurement.name || mId;\n                    var leftText = padString(\"N/A\", leftColumnWidth);\n                    var rightText = padString(entityDisplay, rightColumnWidth);\n                    var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\";\n                    var optionEl = document.getElementById(optionId);\n                    if (optionEl) {\n                        optionEl.innerHTML = leftText + \"  \" + rightText + trailingPadding;\n                    }\n                }\n            );\n\n    });\n\n    dropdownHtml += '</select>';\n    return dropdownHtml;\n}\n\n\nfunction onMeasurementChange(selectedMeasurementId) {\n    if (!selectedMeasurementId) return;\n\n    var selectedMeasurement = measurementData.find(function(m) {\n        var mId = m.id.id || m.id;\n        return mId === selectedMeasurementId;\n    });\n\n    if (!selectedMeasurement) {\n        console.error(\"Measurement object not found for id:\", selectedMeasurementId);\n        return;\n    }\n\n    attributeService.getEntityAttributes(selectedMeasurement.id, 'SERVER_SCOPE', ['installationType', 'measurementType'])\n        .subscribe(\n            attributes => {\n\n                var installationTypeAttr = attributes.find(attr => attr.key === 'installationType');\n                var measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\n\n                var installationType = installationTypeAttr ? installationTypeAttr.value : null;\n                var measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\n\n                var stateId;\n                if (measurementType === 'loraWan') {\n                    stateId = 'measurement_details';\n                } else if (measurementType === 'ultrasonic' && installationType === 'heating') {\n                    stateId = 'measurement_details_heating_full';\n                } else if (measurementType === 'ultrasonic' && installationType === 'cooling') {\n                    stateId = 'measurement_details_cooling_full';\n                } else {\n                    stateId = 'measurement_details_heating_full';\n                }\n\n                var updatedMeasurement = {\n                    entityId: {\n                        id: selectedMeasurement.id.id || selectedMeasurement.id,\n                        entityType: \"ASSET\"\n                    },\n                    entityName: selectedMeasurement.entityName || selectedMeasurement.name,\n                    entityLabel: selectedMeasurement.entityLabel || selectedMeasurement.label ||\n                        (selectedMeasurement.entityName || selectedMeasurement.name)\n                };\n\n                var params = ctx.stateController.getStateParams() || {};\n                params['selectedMeasurement'] = updatedMeasurement;\n                params['targetEntityParamName'] = \"selectedMeasurement\";\n                params['_ts'] = new Date().getTime();\n\n                //console.log(\"Updating selectedMeasurement to:\", updatedMeasurement, params, \"using stateId:\", stateId);\n\n                ctx.stateController.updateState(stateId, params);\n            },\n            error => {\n                console.error(\"Error fetching attributes for measurement:\", error);\n            }\n        );\n}\n\n",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n/*.main-layout .header .title {\n    width: auto;\n    height: 50px;\n    padding-right: 15px; \n    font-size: 18px;\n    font-weight: 500;\n    background-color: #E0E0E0;\n    color: #28232D;\n    display: flex; \n    align-items: center; \n    justify-content: center;\n    gap: 2px;\n    margin-right: 10px;\n    border-radius: 4px;\n}*/\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #reports-button, #data-button, #report-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown option {\n    width: 500px;\n    background-color: #f0f0f0; /* Example background color */\n    color: #28232D;           /* Text color */\n    font-size: 18px;          /* Font size */\n    font-weight: 500;         /* Font weight */\n    /* Some browsers may support these, others might ignore them: */\n    padding: 5px;\n}\n\n\n#measurement-dropdown:focus {\n    outline: none !important;\n    border: none !important;\n    box-shadow: none !important;\n    outline-offset: 0 !important;\n}\n\n#measurement-dropdown::-moz-focus-inner {\n    border: 0 !important;\n}\n\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #reports-button:hover, #data-button:hover, #report-button:hover, #parameter-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #reports-button mat-icon, #data-button mat-icon, #report-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #data-button und #report-button */\n#projects-button span, #reports-button span, #data-button span, #report-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n\n/* Badge Styling */\n.status-badge {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.status-badge .badge-icon {\n    font-size: 14px !important;\n    width: 14px !important;\n    height: 14px !important;\n}\n\n.status-badge.badge-heating {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-cooling {\n    background: rgba(33, 150, 243, 0.1);\n    color: #2196F3;\n}\n\n.status-badge.badge-type {\n    background: #f5f5f5;\n    color: #333;\n}\n\n.status-badge.badge-normal {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-active {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-preparation {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-finished {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-aborted {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-critical {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-major {\n    background: rgba(255, 152, 0, 0.15);\n    color: #FF9800;\n}\n\n.status-badge.badge-minor {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-disconnected {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-default {\n    background: #f5f5f5;\n    color: #666;\n}\n\n/* Measurement Header Layout */\n.measurement-header {\n    background: #fff;\n    border-radius: 8px;\n    padding: 12px 16px;\n    margin: 5px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.08);\n}\n\n.measurement-header .header-title {\n    font-size: 1.4em;\n    font-weight: 550;\n    margin-right: 20px;\n    min-width: 150px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "reports-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": "",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": "",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form\n  [formGroup]=\"addDeviceFormGroup\"\n(ngSubmit)=\"save()\"\nclass=\"add-entity-form w-11/12 max-w-3xl mx-auto\">\n\n    <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\n    <h2 class=\"text-lg font-semibold\">{{ 'custom.diagnostics.action.edit-measurement-parameters.title' | translate }}</h2>\n<span class=\"flex-1\"></span>\n<button mat-icon-button (click)=\"cancel()\" type=\"button\">\n    <mat-icon>close</mat-icon>\n</button>\n</mat-toolbar>\n\n<mat-progress-bar\n    color=\"warn\"\n    mode=\"indeterminate\"\n    *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n\n<div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear class=\"space-y-4\">\n\n        <!-- Assignment Step -->\n        <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\n            <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.assignment.title' | translate }}</ng-template>\n\n            <!-- Assigned Devices -->\n            <mat-form-field appearance=\"fill\" class=\"w-full\">\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.title' | translate }}</mat-label>\n                <mat-chip-grid\n                #chipList\n                aria-label=\"Assigned Devices\"\n                class=\"flex flex-wrap gap-2 mt-2\">\n                <mat-chip-row *ngFor=\"let dev of assignedDevices\" color=\"primary\" selected disableRipple>\n                {{ dev.name }}\n            </mat-chip-row>\n        </mat-chip-grid>\n        <input\n            matInput\n        [matChipInputFor]=\"chipList\"\n        readonly\n        [placeholder]=\"assignedDevices?.length ? '' : ('custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate)\"/>\n        <mat-error *ngIf=\"!assignedDevices?.length\">{{'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate}}</mat-error>\n</mat-form-field>\n\n<!-- Progress -->\n<mat-form-field appearance=\"fill\" class=\"w-full\">\n    <mat-label>{{ 'custom.diagnostics.measurement-progress.title' | translate }}</mat-label>\n    <mat-select formControlName=\"progress\">\n        <mat-option value=\"in preparation\">{{ 'custom.diagnostics.state-filter.preparation.title' | translate }}</mat-option>\n        <mat-option value=\"active\">{{ 'custom.diagnostics.state-filter.active.title' | translate }}</mat-option>\n        <mat-option value=\"finished\">{{ 'custom.diagnostics.state-filter.finished.title' | translate }}</mat-option>\n        <mat-option value=\"aborted\">{{ 'custom.diagnostics.state-filter.aborted.title' | translate }}</mat-option>\n    </mat-select>\n</mat-form-field>\n\n<!-- Start/End DateTime -->\n<div class=\"flex w-full gap-2\">\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-date.title' | translate }}</mat-label>\n        <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\n    <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\"/>\n    </mat-form-field>\n<mat-form-field appearance=\"fill\" class=\"flex-1\">\n    <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-time.title' | translate }}</mat-label>\n    <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\n<mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\"/>\n    </mat-form-field>\n</div>\n\n<div class=\"flex w-full gap-2\">\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-date.title' | translate }}</mat-label>\n        <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\n    <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\"/>\n    </mat-form-field>\n<mat-form-field appearance=\"fill\" class=\"flex-1\">\n    <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-time.title' | translate }}</mat-label>\n    <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\n<mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n<input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\"/>\n    </mat-form-field>\n</div>\n\n<!-- Actions -->\n<div mat-dialog-actions class=\"flex justify-end gap-2\">\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ 'action.cancel' | translate }}</button>\n<button\n    mat-button\n    matStepperNext\n    type=\"button\"\n    color=\"primary\"\n            *ngIf=\"showAttributesStep\"\n    [disabled]=\"!assignedDevicesAvailable\">\n    {{ 'custom.diagnostics.action.next.title' | translate }}\n    </button>\n<button\n    mat-raised-button\n    color=\"primary\"\n    type=\"submit\"\n            *ngIf=\"!showAttributesStep\"\n    [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n    {{ 'action.save' | translate }}\n    </button>\n</div>\n</mat-step>\n\n<!-- Attributes Step -->\n<mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\n    <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.default-parameters.title' | translate }}</ng-template>\n\n<div class=\"flex flex-col gap-2\">\n\n    <!-- Dimension -->\n    <fieldset class=\"fieldset\">\n        <legend class=\"fieldset-legend\">Dimension</legend>\n        <div class=\"flex w-full gap-2\">\n            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.title' | translate }}</mat-label>\n                <mat-select formControlName=\"dimension\" required>\n                    <mat-option *ngFor=\"let dim of dimensionOptions\" [value]=\"dim\">{{ dim }}</mat-option>\n            </mat-select>\n            <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\n            {{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.error' | translate }}\n        </mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.nominal-flow.title' | translate }}</mat-label>\n        <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly/>\n    </mat-form-field>\n</div>\n<div class=\"flex gap-2\">\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.floor-volume.title' | translate }}</mat-label>\n        <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\"/>\n    </mat-form-field>\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.pump-power.title' | translate }}</mat-label>\n        <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\"/>\n    </mat-form-field>\n</div>\n</fieldset>\n\n<!-- Installation -->\n<fieldset class=\"fieldset\">\n    <legend class=\"fieldset-legend\">Installation</legend>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.title' | translate }}</mat-label>\n            <mat-select formControlName=\"installationType\" required>\n                <mat-option value=\"heating\">{{ 'custom.diagnostics.measurement-type.heating.title' | translate }}</mat-option>\n                <mat-option value=\"cooling\">{{ 'custom.diagnostics.measurement-type.cooling.title' | translate }}</mat-option>\n            </mat-select>\n            <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\n            {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.error' | translate }}\n        </mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.title' | translate }}</mat-label>\n        <mat-select formControlName=\"installationTypeOptions\" required>\n            <ng-container\n            *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\n            <mat-option value=\"radiatorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.radiator-heating.title' | translate }}</mat-option>\n            <mat-option value=\"floorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.floor-heating.title' | translate }}</mat-option>\n            <mat-option value=\"districtHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.district-heating.title' | translate }}</mat-option>\n            <mat-option value=\"heatingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.heating-other.title' | translate }}</mat-option>\n        </ng-container>\n        <ng-container\n        *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\n        <mat-option value=\"coolingCircuit\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-circuit.title' | translate }}</mat-option>\n        <mat-option value=\"coolingCeiling\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-ceiling.title' | translate }}</mat-option>\n        <mat-option value=\"chiller\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.chiller.title' | translate }}</mat-option>\n        <mat-option value=\"coolingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-other.title' | translate }}</mat-option>\n    </ng-container>\n</mat-select>\n<mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\n    {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.error' | translate }}\n</mat-error>\n</mat-form-field>\n</div>\n</fieldset>\n\n<!-- Analysis -->\n<fieldset class=\"fieldset\">\n    <legend class=\"fieldset-legend\">Analysis</legend>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature' | translate }}</mat-label>\n            <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\"/>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>Delta T</mat-label>\n            <input matInput formControlName=\"deltaT\" type=\"number\"/>\n        </mat-form-field>\n    </div>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold-setting' | translate }}</mat-label>\n            <mat-select formControlName=\"loadCourseFilterTemperature\" required>\n                <mat-option value=\"above\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.above' | translate }}</mat-option>\n                <mat-option value=\"below\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.below' | translate }}</mat-option>\n            </mat-select>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold' | translate }}</mat-label>\n            <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\"/>\n        </mat-form-field>\n    </div>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.maximum-power-threshold' | translate }}</mat-label>\n            <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\"/>\n        </mat-form-field>\n    </div>\n    <div class=\"flex gap-2\">\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{'unit.measures.area' | translate}}</mat-label>\n            <input matInput formControlName=\"area\" type=\"number\"/>\n        </mat-form-field>\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\n            <mat-label>{{ 'filter.unit' | translate}}</mat-label>\n            <input matInput formControlName=\"unit\" type=\"text\"/>\n        </mat-form-field>\n    </div>\n</fieldset>\n\n<!-- Weekly Operating Schedule -->\n<fieldset class=\"fieldset\">\n    <legend class=\"fieldset-legend\">{{ 'custom.diagnostics.action.edit-measurement-parameters.timings.weekly-schedule.title' | translate }}</legend>\n    <div\n        formGroupName=\"weeklyOperatingSchedule\"\n        class=\"flex justify-between items-center gap-2\">\n        <mat-checkbox formControlName=\"monday\">{{ 'scheduler.monday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"tuesday\">{{ 'scheduler.tuesday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"wednesday\">{{ 'scheduler.wednesday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"thursday\">{{ 'scheduler.thursday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"friday\">{{ 'scheduler.friday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"saturday\">{{ 'scheduler.saturday-label' | translate }}</mat-checkbox>\n        <mat-checkbox formControlName=\"sunday\">{{ 'scheduler.sunday-label' | translate }}</mat-checkbox>\n    </div>\n</fieldset>\n\n</div>\n\n<div mat-dialog-actions class=\"flex justify-end gap-2\">\n    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"> {{ 'action.cancel' | translate }}</button>\n<button mat-button matStepperPrevious color=\"primary\"> {{ 'action.back' | translate }}</button>\n<button\n    mat-raised-button\n    color=\"primary\"\n    type=\"submit\"\n            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n    {{ 'action.save' | translate }}\n    </button>\n</div>\n</mat-step>\n\n<!-- Alarm Thresholds Step (Commented Out) -->\n<!--  -->\n</mat-horizontal-stepper>\n</div>\n</form>\n",
                "customCss": ".add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = [\r\n    'customDialog',\r\n    'entityService',\r\n    'deviceService',\r\n    'entityGroupService',\r\n    'attributeService',\r\n    'entityRelationService',\r\n    'assetService'\r\n].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Invalid measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            fetchAttributes(devices);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching devices:\", error);\r\n            fetchAttributes([]);\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDevices) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDevices, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching attributes:\", error);\r\n            openAddDeviceDialog(assignedDevices, []);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDevices, attributes) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        assignedDevices,\r\n        attributes,\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    // const measurementType = vm.data.attributes[0].value;\r\n    const measurementTypeAttr = vm.data.attributes.find(attr => attr.key === 'measurementType');\r\n    const measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\r\n\r\n    const {\r\n        measurementId,\r\n        assignedDevices = [],\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n\r\n    vm.assignedDevices = assignedDevices;\r\n    vm.assignedDevicesAvailable = assignedDevices.length > 0;\r\n\r\n    vm.showAttributesStep = vm.assignedDevicesAvailable && (measurementType === 'ultrasonic');\r\n    /*vm.showAlarmThresholdsStep = vm.assignedDevicesAvailable;*/\r\n\r\n\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                progress: [{ value: 'in preparation', disabled: !vm.assignedDevicesAvailable }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                startTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area: [null],\r\n                unit: [null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            /*alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),*/\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Map known attribute keys to form controls\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                // If it's 'progress', put in assignmentStep; else in attributesStep\r\n                const stepGroup =\r\n                    (formControlName === 'progress')\r\n                        ? 'assignmentStep'\r\n                        : 'attributesStep';\r\n\r\n                vm.addDeviceFormGroup\r\n                  .get(`stepper.${stepGroup}.${formControlName}`)\r\n                  .setValue(attr.value);\r\n            }\r\n            // Start/end times\r\n            else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = (attr.key === 'startTimeMs') ? 'startDate' : 'endDate';\r\n                    const timeControlName = (attr.key === 'startTimeMs') ? 'startTime' : 'endTime';\r\n\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            }\r\n            // Weekly schedule\r\n            else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n            // If you had existing alarm threshold attributes, you could map them similarly\r\n            // e.g. if there's an attr.key === 'maxVolumeFlowCriticalThreshold', etc.\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n\r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((val) => {\r\n                setDefaultDeltaT(val);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((val) => {\r\n                if (val) {\r\n                    // Example: floorVolume is 2% of nominalFlow\r\n                    const floorVal = (val * 0.02).toFixed(3);\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(floorVal);\r\n                }\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.assignmentStep.progress')\r\n            .valueChanges.subscribe((newValue) => {\r\n                if (newValue !== lastProgressValue) {\r\n                    lastProgressValue = newValue;\r\n                    updateProgressControl();\r\n                }\r\n            });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n            \r\n    if (!vm.showAttributesStep) {\r\n          // For the entire step:\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').disable();\r\n          // or remove required validators from each control\r\n        } else {\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').enable();\r\n        }\r\n\r\n        if (!vm.assignedDevicesAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n\r\n        // If progress is active but no start time set, auto-set to now\r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        }\r\n        // If progress is finished/aborted but no end time set (and we have a start), auto-set end to now\r\n        else if (\r\n            (progressControl.value === 'finished' || progressControl.value === 'aborted') &&\r\n            startDateControl.value && startTimeControl.value &&\r\n            !endDateControl.value && !endTimeControl.value\r\n        ) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        \r\n        // Only clear if the current value isn't one of the valid options\r\n        const currentOption = vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').value;\r\n        if (!options.includes(currentOption)) {\r\n             vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n        }\r\n    }\r\n\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const defaultDelta = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.deltaT')\r\n            .setValue(defaultDelta);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n/*        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;*/\r\n\r\n        // Convert date/time to epoch\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            {\r\n                key: 'area',\r\n                value: {\r\n                    value: attributesStep.area,\r\n                    unit: attributesStep.unit\r\n                }\r\n            },\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n\r\n            /*{ key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },*/\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                // Save successful\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error while saving attributes:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "77a63eda-0194-b957-14b1-932f77030c85"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "0"
        },
        "row": 0,
        "col": 0,
        "id": "f0dfbf6c-c2b0-2975-eb81-df9748cae9a5"
      },
      "35967d36-4117-f746-7cea-f04152cc3f37": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_details_heating_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Data",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "35967d36-4117-f746-7cea-f04152cc3f37"
      },
      "3390e8ee-14d3-1ead-2dc6-4600bc4ae29e": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_analysis_heating_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Analysis",
              "showIcon": true,
              "icon": "troubleshoot",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "3390e8ee-14d3-1ead-2dc6-4600bc4ae29e"
      },
      "11d78927-a872-be78-96aa-3b4606f174fd": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_settings",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Settings",
              "showIcon": true,
              "icon": "settings",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_settings_heating",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "11d78927-a872-be78-96aa-3b4606f174fd"
      },
      "7f1de781-2af6-c3f6-e8aa-4d11c9c637fe": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_details_cooling_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "filled",
              "showLabel": true,
              "label": "Back",
              "showIcon": true,
              "icon": "mdi:arrow-left-circle",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "go-back",
                "icon": "mdi:arrow-left-circle",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          },
          "margin": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "7f1de781-2af6-c3f6-e8aa-4d11c9c637fe"
      },
      "2401f1f4-a8fd-a132-a006-588b3ab4ad55": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_header_buttons_heating\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "2401f1f4-a8fd-a132-a006-588b3ab4ad55"
      },
      "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.3601545606589338,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.22269988983816758
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.08522023745480056
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.6869463922331669
                },
                {
                  "name": "installationTypeOptions",
                  "type": "attribute",
                  "label": "installationTypeOptions",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.5906840773460056
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.34162610005382144
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.6538615706972768
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.34458645066683413
                },
                {
                  "name": "dimension",
                  "type": "attribute",
                  "label": "dimension",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.12782307845724783
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.48540079128001534
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.8908409252575222
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": {
              "body": "let $injector = ctx.$scope.$injector;\nlet assetService = $injector.get(ctx.servicesMap.get('assetService'));\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nvar entityId;\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n    entityId = data[0]['entityId'];\n} else {\n    deviceState = false;\n    entityId = null;\n}\nlet userRole;\nif(data[1] && data[1].role){\n    userRole = data[1].role;\n}\n\nconsole.log(\"role:\", userRole);\n/*var userRole = data[1].role;*/\nvar stateParams = ctx.stateController.getStateParams();\n//console.log(\"stateParams\",stateParams);\n//console.log(\"ctx.stateController\",ctx.stateController.parseState);\n//var userRole = stateParams.userRole;\n/*stateParams[\"userRole\"] = userRole;*/\nctx.stateController.updateState(null, stateParams);\nif(entityId) {\n    \n    \n    var ButtonHtml = '';\n    if (userRole !== 'Belimo Retrofit Users') {\n        ButtonHtml =\n            '<button id=\"parameter-button\" type=\"button\" mat-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.action.measurement-parameters}</span>' +\n            '</button>' +\n            '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n            '</button>';\n    }\n    \n    /*var ButtonHtml = '';\n    if (userRole !== 'Belimo Retrofit Users') {\n        ButtonHtml =\n            '<button id=\"parameter-button\" type=\"button\" mat-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.action.measurement-parameters}</span>' +\n            '</button>' +\n            '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n                '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n            '</button>';\n    }*/\n    \n    var name, label, state, active, progress, locationName, installationType, installation, dimension, installationTypeOptions, measurementType, startTime, endTime;\n    if (data && data.length) {\n        name = data[0]['entityName'] || 'N/A';\n        label = data[0]['Label'] || 'N/A';\n        locationName = data[0]['locationName'] || 'N/A';\n        installationType = data[0]['installationType'] || 'N/A';\n        installationTypeOptions = data[0]['installationTypeOptions'] || 'N/A';\n        dimension = data[0]['dimension'] || 'N/A';\n        state = data[0]['state'] || 'N/A';\n        active = data[0]['active'] || 'N/A';\n        progress = data[0]['progress'] || 'N/A';\n        measurementType = data[0]['measurementType'] || 'N/A';\n        startTime = data[0]['startTimeMs'] || 'N/A';\n        endTime = data[0]['endTimeMs'] || 'N/A';\n        if (active === 'false') {\n            state = 'disconnected';\n        }\n    }\n    \n    // finished & aborted\n    if (startTime !== 'N/A' && endTime !== 'N/A') {\n        deltaTime = endTime - startTime;\n        timeThreshold = 3024000000; // 35 days\n        if (deltaTime <= timeThreshold) { \n            var newDashboardtimewindow = {\n                aggregation: {\n                    limit: 100000,\n                    type: \"NONE\"\n                },\n                hideAggInterval: true,\n                hideAggregation: true,\n                hideInterval: false,\n                history: {\n                    historyType: 1,\n                    fixedTimewindow: {\n                        startTimeMs: startTime, // now - 2 weeks\n                        endTimeMs: endTime\n                    }\n                },\n                selectedTab: 1\n            };\n        } else {\n            var newDashboardtimewindow = {\n                aggregation: {\n                    limit: 100000,\n                    type: \"NONE\"\n                },\n                hideAggInterval: true,\n                hideAggregation: true,\n                hideInterval: false,\n                history: {\n                    historyType: 1,\n                    fixedTimewindow: {\n                        startTimeMs: endTime - timeThreshold, // now - 2 weeks\n                        endTimeMs: endTime\n                    }\n                },\n                selectedTab: 1\n            }; \n        }\n    }\n    // active\n    else if (startTime !== 'N/A' && endTime === 'N/A') {\n        timeThreshold = 3024000000; // 35 days\n        deltaTime = (Date.now())-startTime;\n        if(deltaTime>timeThreshold){\n            startTime = startTime+(deltaTime-timeThreshold);\n        }\n            var newDashboardtimewindow = {\n                aggregation: {\n                    limit: 100000,\n                    type: \"NONE\"\n                },\n                hideAggInterval: true,\n                hideAggregation: true,\n                hideInterval: false,\n                history: {\n                    historyType: 1,\n                    fixedTimewindow: {\n                        startTimeMs: startTime,\n                        endTimeMs: Date.now()\n                    }\n                },\n                selectedTab: 1\n        };\n    // default\n    }\n    else {\n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: Date.now() - 1209600000, // now - 2 weeks\n                    endTimeMs: Date.now()\n                }\n            },\n            selectedTab: 1\n        };\n    }\n    \n    ctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\n    ctx.stateController.updateState(null, stateParams);\n    \n    var projectAssetQuery = {\n        \"parameters\": {\n            \"rootId\": entityId,\n            \"rootType\": \"ASSET\",\n            \"direction\": \"TO\",\n            \"relationTypeGroup\": \"COMMON\",\n            \"maxLevel\": 1073741824,\n            \"fetchLastLevelOnly\": false\n        },\n        \"relationType\": \"Owns\",\n        \"assetTypes\": [\n            \"Project\"\n        ]\n    };\n    \n    assetService.findByQuery(projectAssetQuery).subscribe(\n        function(projects) {\n            if (projects && projects.length > 0) {\n                var projectId = projects[0].id.id || projects[0].id;\n                /*console.log(\"Found project with ID:\", projectId);*/\n    \n                var measurementAssetsQuery = {\n                    \"parameters\": {\n                        \"rootId\": projectId,\n                        \"rootType\": \"ASSET\",\n                        \"direction\": \"FROM\",\n                        \"relationTypeGroup\": \"COMMON\",\n                        \"maxLevel\": 1073741824,\n                        \"fetchLastLevelOnly\": false\n                    },\n                    \"relationType\": \"Owns\",\n                    \"assetTypes\": [\n                        \"Measurement\"\n                    ]\n                };\n    \n                assetService.findByQuery(measurementAssetsQuery).subscribe(\n                    function(measurements) {\n                       /* console.log(\"Measurements found:\", measurements);*/\n                        // Build the dropdown and insert it into the container beside the buttons\n                        var dropdownHtml = buildMeasurementDropdown(measurements);\n                        document.getElementById(\"measurement-dropdown-container\").innerHTML = dropdownHtml;\n                        // Now attach the change listener to the newly inserted dropdown\n                        var dropdownEl = document.getElementById(\"measurement-dropdown\");\n                        if (dropdownEl) {\n                            dropdownEl.addEventListener(\"change\", function(e) {\n                                onMeasurementChange(e.target.value);\n                            });\n                        }\n                    },\n                    function(error) {\n                        console.error(\"Error fetching measurements:\", error);\n                    }\n                );\n            } else {\n                console.log(\"No project found.\");\n            }\n        },\n        function(error) {\n            console.error(\"Error fetching project:\", error);\n        }\n    );\n    \n    // Helper function for state badges\n    function getStateBadge(state, type) {\n        var badgeClass = '';\n        var icon = '';\n        var label = '';\n        \n        switch (state) {\n            case 'in preparation':\n                badgeClass = 'badge-preparation';\n                icon = 'schedule';\n                label = '{i18n:custom.diagnostics.state-filter.preparation.title}';\n                break;\n            case 'active':\n                badgeClass = 'badge-active';\n                icon = 'play_circle';\n                label = '{i18n:custom.diagnostics.state-filter.active.title}';\n                break;\n            case 'finished':\n                badgeClass = 'badge-finished';\n                icon = 'check_circle';\n                label = '{i18n:custom.diagnostics.state-filter.finished.title}';\n                break;\n            case 'aborted':\n                badgeClass = 'badge-aborted';\n                icon = 'cancel';\n                label = '{i18n:custom.diagnostics.state-filter.aborted.title}';\n                break;\n            case 'critical':\n                badgeClass = 'badge-critical';\n                icon = 'error';\n                label = '{i18n:alarm.severity-critical}';\n                break;\n            case 'major':\n                badgeClass = 'badge-major';\n                icon = 'warning';\n                label = '{i18n:alarm.severity-major}';\n                break;\n            case 'minor':\n                badgeClass = 'badge-minor';\n                icon = 'info';\n                label = '{i18n:alarm.severity-minor}';\n                break;\n            case 'normal':\n                badgeClass = 'badge-normal';\n                icon = 'check_circle';\n                label = '{i18n:alarm.severity-normal}';\n                break;\n            case 'disconnected':\n                badgeClass = 'badge-disconnected';\n                icon = 'link_off';\n                label = '{i18n:device.inactive}';\n                break;\n            default:\n                badgeClass = 'badge-default';\n                icon = 'help';\n                label = state || 'N/A';\n        }\n        \n        return '<span class=\"status-badge ' + badgeClass + '\">' +\n               '<mat-icon class=\"badge-icon\">' + icon + '</mat-icon>' +\n               '<span>' + label + '</span>' +\n               '</span>';\n    }\n    \n    // Installation type badge\n    var installationBadge = '<span class=\"status-badge badge-heating\">' +\n        '<mat-icon class=\"badge-icon\">local_fire_department</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.measurement-type.heating.title}</span>' +\n        '</span>';\n    \n    // Type badge (installation type options)\n    var typeBadge = '<span class=\"status-badge badge-type\">' +\n        `{i18n:custom.diagnostics.action.edit-measurement-parameters.installation-type-options.${clientUtils.toKebabCase(installationTypeOptions)}.title}` +\n        '</span>';\n    \n    var header = '<div class=\"measurement-header flex items-center justify-between\">' +\n\n    // Back Button (left)\n    '<div class=\"flex-none\">' +\n      '<button id=\"go-back\" matTooltip=\"{i18n:action.go-back}\" type=\"button\" mat-icon-button class=\"p-2\">' +\n        '<mat-icon>arrow_back</mat-icon>' +\n      '</button>' +\n    '</div>' +\n\n    // Title + Badges section\n    '<div class=\"flex flex-row items-center flex-1 gap-3\">' +\n      // Title\n      '<div class=\"header-title\">' + locationName + '</div>' +\n      // Badges row\n      '<div class=\"flex items-center gap-2 flex-wrap\">' +\n        installationBadge +\n        typeBadge +\n        getStateBadge(state, 'state') +\n        getStateBadge(progress, 'progress') +\n      '</div>' +\n    '</div>' +\n\n    // Action buttons (right)\n    '<div class=\"flex-none flex items-center\">' +\n      ButtonHtml +\n      '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\" class=\"flex items-center\">' +\n        '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.reports-btn.title}</span>' +\n      '</button>' +\n      '<div id=\"measurement-dropdown-container\" class=\"ml-4\"></div>' +\n    '</div>' +\n\n  '</div>';\n\nreturn '' +\n  '<div class=\"main-layout flex flex-col w-full h-full\">' +\n    header +\n    '<div id=\"power_measurement_heating_wrapper\" class=\"flex-1\">' +\n      '<tb-dashboard-state class=\"w-full h-full\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_data_heating\"></tb-dashboard-state>' +\n    '</div>' +\n  '</div>';\n\n    function getStateHtml(state) {\n        var stateSvg = getStateSvg(state);\n        var encodedStateSvg = encodeURIComponent(stateSvg);\n        var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n        var stateLabel = getStateLabel(state);\n        return '<span>'+\n               '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n               '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n               '</span>';\n    }\n    \n    function getStateSvg(state) {\n        switch (state) {\n            case 'in preparation':\n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/></svg>';\n            case 'active':            \n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"yellow\"/></svg>'; // #f3de61\n            case 'finished':            \n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"green\"/></svg>'; // #27AE60\n            case 'aborted':            \n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n            case 'critical':\n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n            case 'major':            \n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"orange\"/></svg>';\n            case 'minor':            \n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"yellow\"/></svg>';\n            case 'normal':            \n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"green\"/></svg>';\n            case 'disconnected':\n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                       '<g clip-path=\"url(#clip0)\">' +\n                       '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                       '<path d=\"M1.93 16.73L16.07 2.59L17.49 4L3.34 18.14L1.93 16.73Z\" fill=\"#CAC1D2\"/>' +\n                       '</g>' +\n                       '<defs><clipPath id=\"clip0\"><rect width=\"20\" height=\"20\" fill=\"white\"/></clipPath></defs>' +\n                       '</svg>';\n            default:\n                return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/></svg>';\n        }\n    }\n    \n    function getStateLabel(state) {\n        return `{i18n:custom.diagnostics.measurement-details-heating-full.state.${clientUtils.toKebabCase(state)}}`\n    }\n    \n    var measurementData = [];\n    \n    function buildMeasurementDropdown(measurements) {\n        measurementData = measurements;\n        \n        // Retrieve the current measurement's id from state params (if available)\n        var stateParams = ctx.stateController.getStateParams();\n        var currentMeasurementId = null;\n        if (stateParams && stateParams.selectedMeasurement) {\n            currentMeasurementId = stateParams.selectedMeasurement.entityId.id || stateParams.selectedMeasurement.entityId;\n        }\n        \n        // Filter and sort measurements\n        var sortedMeasurements = measurements\n            .filter(function(measurement) {\n                var mId = measurement.id.id || measurement.id;\n                return mId !== currentMeasurementId;\n            })\n            .sort(function(a, b) {\n                var aName = a.entityName || a.name || \"\";\n                var bName = b.entityName || b.name || \"\";\n                var aMatch = aName.match(/(\\d+)$/);\n                var bMatch = bName.match(/(\\d+)$/);\n                var aNum = aMatch ? parseInt(aMatch[1], 10) : 0;\n                var bNum = bMatch ? parseInt(bMatch[1], 10) : 0;\n                return aNum - bNum;\n            });\n        \n    \n        var defaultTitle = (locationName && locationName !== 'N/A') ? locationName : \"Select Measurement\";\n        defaultTitle += \" \\u25BE\";\n        \n        var dropdownHtml = '<select id=\"measurement-dropdown\" ' +\n            'onfocus=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\" ' +\n            'onblur=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\" ' +\n            'style=\"height: 40px; padding: 0 15px; font-size: 18px; font-weight: 500; ' +\n            'background-color: #E0E0E0; color: #28232D; margin-right: 10px; border: none; ' +\n            'border-radius: 4px; -webkit-appearance: none; appearance: none; ' +\n            'white-space: pre;\">';\n    \n        dropdownHtml += '<option value=\"\" style=\"background-color: #f0f0f0; color: #28232D; ' +\n                        'font-size: 18px; font-weight: 400; white-space: pre;\" selected; padding-right: 20px;>' +\n                        defaultTitle + '</option>';\n        \n        // Helper: pad a string to a fixed length (by characters)\n        function padString(str, length) {\n            str = str || \"\";\n            if (str.length >= length) return str.substring(0, length);\n            return str + \" \".repeat(length - str.length);\n        }\n        \n        // Define fixed column widths (in number of characters)\n        var leftColumnWidth = 30;  // for locationName\n        var rightColumnWidth = 30; // for entityName\n        \n        // Build each option\n        sortedMeasurements.forEach(function(measurement) {\n            var mId = measurement.id.id || measurement.id;\n            var optionId = \"measurement-option-\" + mId;\n            dropdownHtml += '<option id=\"'+ optionId +'\" value=\"' + mId + '\" ' +\n                'style=\"background-color: #f0f0f0; color: #28232D; font-size: 18px; ' +\n                'font-weight: 400; white-space: pre; padding-right: 20px;\">' +\n                'Loading...' +\n                '</option>';\n            \n            // Fetch the locationName asynchronously\n            attributeService.getEntityAttributes(measurement.id, 'SERVER_SCOPE', ['locationName'])\n        .subscribe(\n            function(attributes) {\n                var locationAttr = attributes.find(attr => attr.key === 'locationName');\n                var locationDisplay = locationAttr ? locationAttr.value : \"N/A\";\n                var entityDisplay = measurement.entityName || measurement.name || mId;\n                // Pad both sides so that the divider always appears in the middle.\n                var leftText = padString(locationDisplay, leftColumnWidth);\n                var rightText = padString(entityDisplay, rightColumnWidth);\n                // Append non-breaking spaces for extra right-side padding.\n                var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\"; // Adjust count as needed\n                var displayText = leftText + \"  \" + rightText + trailingPadding;\n                var optionEl = document.getElementById(optionId);\n                if (optionEl) {\n                    optionEl.innerHTML = displayText;\n                }\n            },\n            function(error) {\n                console.error(\"Error fetching locationName for measurement\", measurement, error);\n                var entityDisplay = measurement.entityName || measurement.name || mId;\n                var leftText = padString(\"N/A\", leftColumnWidth);\n                var rightText = padString(entityDisplay, rightColumnWidth);\n                var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\";\n                var optionEl = document.getElementById(optionId);\n                if (optionEl) {\n                    optionEl.innerHTML = leftText + \"  \" + rightText + trailingPadding;\n                }\n            }\n        );\n    \n        });\n        \n        dropdownHtml += '</select>';\n        return dropdownHtml;\n    }\n    \n    \n    function onMeasurementChange(selectedMeasurementId) {\n        if (!selectedMeasurementId) return;\n        \n        var selectedMeasurement = measurementData.find(function(m) {\n            var mId = m.id.id || m.id;\n            return mId === selectedMeasurementId;\n        });\n        \n        if (!selectedMeasurement) {\n            console.error(\"Measurement object not found for id:\", selectedMeasurementId);\n            return;\n        }\n    \n        attributeService.getEntityAttributes(selectedMeasurement.id, 'SERVER_SCOPE', ['installationType', 'measurementType'])\n          .subscribe(\n              attributes => {\n    \n                  var installationTypeAttr = attributes.find(attr => attr.key === 'installationType');\n                  var measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\n                  \n                  var installationType = installationTypeAttr ? installationTypeAttr.value : null;\n                  var measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\n                  \n                  var stateId;\n                  if (measurementType === 'loraWan') {\n                      stateId = 'measurement_details';\n                  } else if (measurementType === 'ultrasonic' && installationType === 'heating') {\n                      stateId = 'measurement_details_heating_full';\n                  } else if (measurementType === 'ultrasonic' && installationType === 'cooling') {\n                      stateId = 'measurement_details_cooling_full';\n                  } else {\n                      stateId = 'measurement_details_heating_full';\n                  }\n    \n                  var updatedMeasurement = {\n                      entityId: {\n                          id: selectedMeasurement.id.id || selectedMeasurement.id,\n                          entityType: \"ASSET\"\n                      },\n                      entityName: selectedMeasurement.entityName || selectedMeasurement.name,\n                      entityLabel: selectedMeasurement.entityLabel || selectedMeasurement.label ||\n                                   (selectedMeasurement.entityName || selectedMeasurement.name)\n                  };\n    \n                  var params = ctx.stateController.getStateParams() || {};\n                  params['selectedMeasurement'] = updatedMeasurement;\n                  params['targetEntityParamName'] = \"selectedMeasurement\";\n                  params['_ts'] = new Date().getTime();\n                  \n                  //console.log(\"Updating selectedMeasurement to:\", updatedMeasurement, params, \"using stateId:\", stateId);\n    \n                  ctx.stateController.updateState(stateId, params);\n              },\n              error => {\n                  console.error(\"Error fetching attributes for measurement:\", error);\n              }\n          );\n    }\n}\n",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": "@media screen and (min-width: 599px) {\n  .parameters-section {\n    display: none;\n  }\n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n/*.main-layout .header .title {\n    width: auto;\n    height: 50px;\n    padding-right: 15px; \n    font-size: 18px;\n    font-weight: 500;\n    background-color: #E0E0E0;\n    color: #28232D;\n    display: flex; \n    align-items: center; \n    justify-content: center;\n    gap: 2px;\n    margin-right: 10px;\n    border-radius: 4px;\n}*/\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #reports-button, #data-button, #report-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown {\n    width: auto; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown option {\n    width: 500px;\n    background-color: #f0f0f0; /* Example background color */\n    color: #28232D;           /* Text color */\n    font-size: 18px;          /* Font size */\n    font-weight: 500;         /* Font weight */\n    /* Some browsers may support these, others might ignore them: */\n    padding: 5px;\n}\n\n\n#measurement-dropdown:focus {\n    outline: none !important;\n    border: none !important;\n    box-shadow: none !important;\n    outline-offset: 0 !important;\n}\n\n#measurement-dropdown::-moz-focus-inner {\n    border: 0 !important;\n}\n\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #reports-button:hover, #data-button:hover, #report-button:hover, #parameter-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #reports-button mat-icon, #data-button mat-icon, #report-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #data-button und #report-button */\n#projects-button span, #reports-button span, #data-button span, #report-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n\n/* Badge Styling */\n.status-badge {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 6px 12px;\n    border-radius: 8px;\n    font-size: 13px;\n    font-weight: 500;\n    white-space: nowrap;\n}\n\n.status-badge .badge-icon {\n    font-size: 14px !important;\n    width: 14px !important;\n    height: 14px !important;\n}\n\n.status-badge.badge-heating {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-cooling {\n    background: rgba(33, 150, 243, 0.1);\n    color: #2196F3;\n}\n\n.status-badge.badge-type {\n    background: #f5f5f5;\n    color: #333;\n}\n\n.status-badge.badge-normal {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-active {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-preparation {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-finished {\n    background: rgba(76, 175, 80, 0.1);\n    color: #4CAF50;\n}\n\n.status-badge.badge-aborted {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-critical {\n    background: rgba(244, 67, 54, 0.1);\n    color: #F44336;\n}\n\n.status-badge.badge-major {\n    background: rgba(255, 152, 0, 0.15);\n    color: #FF9800;\n}\n\n.status-badge.badge-minor {\n    background: rgba(255, 235, 59, 0.2);\n    color: #F9A825;\n}\n\n.status-badge.badge-disconnected {\n    background: rgba(158, 158, 158, 0.15);\n    color: #757575;\n}\n\n.status-badge.badge-default {\n    background: #f5f5f5;\n    color: #666;\n}\n\n/* Measurement Header Layout */\n.measurement-header {\n    background: #fff;\n    border-radius: 8px;\n    padding: 12px 16px;\n    margin: 5px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.08);\n}\n\n.measurement-header .header-title {\n    font-size: 1.4em;\n    font-weight: 550;\n    margin-right: 20px;\n    min-width: 150px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form\n        [formGroup]=\"addDeviceFormGroup\"\n        (ngSubmit)=\"save()\"\n        class=\"add-entity-form w-11/12 max-w-3xl mx-auto\">\n\n    <mat-toolbar class=\"flex items-center justify-between bg-primary text-white px-4\" color=\"primary\">\n        <h2 class=\"text-lg font-semibold\">{{ 'custom.diagnostics.action.edit-measurement-parameters.title' | translate }}</h2>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon>close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <mat-progress-bar\n            color=\"warn\"\n            mode=\"indeterminate\"\n            *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n\n    <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\n        <mat-horizontal-stepper formGroupName=\"stepper\" linear class=\"space-y-4\">\n\n            <!-- Assignment Step -->\n            <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\n                <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.assignment.title' | translate }}</ng-template>\n\n                <!-- Assigned Devices -->\n                <mat-form-field appearance=\"fill\" class=\"w-full\">\n                    <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.title' | translate }}</mat-label>\n                    <mat-chip-grid\n                            #chipList\n                            aria-label=\"Assigned Devices\"\n                            class=\"flex flex-wrap gap-2 mt-2\">\n                        <mat-chip-row *ngFor=\"let dev of assignedDevices\" color=\"primary\" selected disableRipple>\n                            {{ dev.name }}\n                        </mat-chip-row>\n                    </mat-chip-grid>\n                    <input\n                            matInput\n                            [matChipInputFor]=\"chipList\"\n                            readonly\n                            [placeholder]=\"assignedDevices?.length ? '' : ('custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate)\"/>\n                    <mat-error *ngIf=\"!assignedDevices?.length\">{{'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate}}</mat-error>\n                </mat-form-field>\n\n                <!-- Progress -->\n                <mat-form-field appearance=\"fill\" class=\"w-full\">\n                    <mat-label>{{ 'custom.diagnostics.measurement-progress.title' | translate }}</mat-label>\n                    <mat-select formControlName=\"progress\">\n                        <mat-option value=\"in preparation\">{{ 'custom.diagnostics.state-filter.preparation.title' | translate }}</mat-option>\n                        <mat-option value=\"active\">{{ 'custom.diagnostics.state-filter.active.title' | translate }}</mat-option>\n                        <mat-option value=\"finished\">{{ 'custom.diagnostics.state-filter.finished.title' | translate }}</mat-option>\n                        <mat-option value=\"aborted\">{{ 'custom.diagnostics.state-filter.aborted.title' | translate }}</mat-option>\n                    </mat-select>\n                </mat-form-field>\n\n                <!-- Start/End DateTime -->\n                <div class=\"flex w-full gap-2\">\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-date.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\"/>\n                    </mat-form-field>\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-time.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\"/>\n                    </mat-form-field>\n                </div>\n\n                <div class=\"flex w-full gap-2\">\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-date.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\"/>\n                    </mat-form-field>\n                    <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                        <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-time.title' | translate }}</mat-label>\n                        <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\n                        <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                        <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\"/>\n                    </mat-form-field>\n                </div>\n\n                <!-- Actions -->\n                <div mat-dialog-actions class=\"flex justify-end gap-2\">\n                    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ 'action.cancel' | translate }}</button>\n                    <button\n                            mat-button\n                            matStepperNext\n                            type=\"button\"\n                            color=\"primary\"\n                            *ngIf=\"showAttributesStep\"\n                            [disabled]=\"!assignedDevicesAvailable\">\n                        {{ 'custom.diagnostics.action.next.title' | translate }}\n                    </button>\n                    <button\n                            mat-raised-button\n                            color=\"primary\"\n                            type=\"submit\"\n                            *ngIf=\"!showAttributesStep\"\n                            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n                        {{ 'action.save' | translate }}\n                    </button>\n                </div>\n            </mat-step>\n\n            <!-- Attributes Step -->\n            <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\n                <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.default-parameters.title' | translate }}</ng-template>\n\n                <div class=\"flex flex-col gap-2\">\n\n                    <!-- Dimension -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">Dimension</legend>\n                        <div class=\"flex w-full gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.title' | translate }}</mat-label>\n                                <mat-select formControlName=\"dimension\" required>\n                                    <mat-option *ngFor=\"let dim of dimensionOptions\" [value]=\"dim\">{{ dim }}</mat-option>\n                                </mat-select>\n                                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\n                                    {{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.error' | translate }}\n                                </mat-error>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.nominal-flow.title' | translate }}</mat-label>\n                                <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.floor-volume.title' | translate }}</mat-label>\n                                <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\"/>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.pump-power.title' | translate }}</mat-label>\n                                <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                    </fieldset>\n\n                    <!-- Installation -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">Installation</legend>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.title' | translate }}</mat-label>\n                                <mat-select formControlName=\"installationType\" required>\n                                    <mat-option value=\"heating\">{{ 'custom.diagnostics.measurement-type.heating.title' | translate }}</mat-option>\n                                    <mat-option value=\"cooling\">{{ 'custom.diagnostics.measurement-type.cooling.title' | translate }}</mat-option>\n                                </mat-select>\n                                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\n                                    {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.error' | translate }}\n                                </mat-error>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.title' | translate }}</mat-label>\n                                <mat-select formControlName=\"installationTypeOptions\" required>\n                                    <ng-container\n                                            *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\n                                        <mat-option value=\"radiatorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.radiator-heating.title' | translate }}</mat-option>\n                                        <mat-option value=\"floorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.floor-heating.title' | translate }}</mat-option>\n                                        <mat-option value=\"districtHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.district-heating.title' | translate }}</mat-option>\n                                        <mat-option value=\"heatingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.heating-other.title' | translate }}</mat-option>\n                                    </ng-container>\n                                    <ng-container\n                                            *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\n                                        <mat-option value=\"coolingCircuit\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-circuit.title' | translate }}</mat-option>\n                                        <mat-option value=\"coolingCeiling\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-ceiling.title' | translate }}</mat-option>\n                                        <mat-option value=\"chiller\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.chiller.title' | translate }}</mat-option>\n                                        <mat-option value=\"coolingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-other.title' | translate }}</mat-option>\n                                    </ng-container>\n                                </mat-select>\n                                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\n                                    {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.error' | translate }}\n                                </mat-error>\n                            </mat-form-field>\n                        </div>\n                    </fieldset>\n\n\n                    <!-- Analysis -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">Analysis</legend>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature' | translate }}</mat-label>\n                                <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\"/>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>Delta T</mat-label>\n                                <input matInput formControlName=\"deltaT\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold-setting' | translate }}</mat-label>\n                                <mat-select formControlName=\"loadCourseFilterTemperature\" required>\n                                    <mat-option value=\"above\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.above' | translate }}</mat-option>\n                                    <mat-option value=\"below\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.below' | translate }}</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold' | translate }}</mat-label>\n                                <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.maximum-power-threshold' | translate }}</mat-label>\n                                <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\"/>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex gap-2\">\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{'unit.measures.area' | translate}}</mat-label>\n                                <input matInput formControlName=\"area\" type=\"number\"/>\n                            </mat-form-field>\n                            <mat-form-field appearance=\"fill\" class=\"flex-1\">\n                                <mat-label>{{ 'filter.unit' | translate}}</mat-label>\n                                <input matInput formControlName=\"unit\" type=\"text\"/>\n                            </mat-form-field>\n                        </div>\n                    </fieldset>\n\n                    <!-- Weekly Operating Schedule -->\n                    <fieldset class=\"fieldset\">\n                        <legend class=\"fieldset-legend\">{{ 'custom.diagnostics.action.edit-measurement-parameters.timings.weekly-schedule.title' | translate }}</legend>\n                        <div\n                                formGroupName=\"weeklyOperatingSchedule\"\n                                class=\"flex justify-between items-center gap-2\">\n                            <mat-checkbox formControlName=\"monday\">{{ 'scheduler.monday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"tuesday\">{{ 'scheduler.tuesday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"wednesday\">{{ 'scheduler.wednesday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"thursday\">{{ 'scheduler.thursday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"friday\">{{ 'scheduler.friday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"saturday\">{{ 'scheduler.saturday-label' | translate }}</mat-checkbox>\n                            <mat-checkbox formControlName=\"sunday\">{{ 'scheduler.sunday-label' | translate }}</mat-checkbox>\n                        </div>\n                    </fieldset>\n\n                </div>\n\n                <div mat-dialog-actions class=\"flex justify-end gap-2\">\n                    <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"> {{ 'action.cancel' | translate }}</button>\n                    <button mat-button matStepperPrevious color=\"primary\"> {{ 'action.back' | translate }}</button>\n                    <button\n                            mat-raised-button\n                            color=\"primary\"\n                            type=\"submit\"\n                            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\n                        {{ 'action.save' | translate }}\n                    </button>\n                </div>\n            </mat-step>\n\n            <!-- Alarm Thresholds Step (Commented Out) -->\n            <!--  -->\n        </mat-horizontal-stepper>\n    </div>\n</form>\n",
                "customCss": ".add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = [\r\n    'customDialog',\r\n    'entityService',\r\n    'deviceService',\r\n    'entityGroupService',\r\n    'attributeService',\r\n    'entityRelationService',\r\n    'assetService'\r\n].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Invalid measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            fetchAttributes(devices);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching devices:\", error);\r\n            fetchAttributes([]);\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDevices) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDevices, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching attributes:\", error);\r\n            openAddDeviceDialog(assignedDevices, []);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDevices, attributes) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        assignedDevices,\r\n        attributes,\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    // Retrieve data from vm.data provided to the controller\r\n    const {\r\n        measurementId,\r\n        assignedDevices = [],\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n\r\n    // Retrieve measurementType and progress attribute values\r\n    const measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\r\n    const progressAttr = attributes.find(attr => attr.key === 'progress');\r\n    const measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\r\n    // Default progress to \"in preparation\" if not found\r\n    const progressValue = progressAttr ? progressAttr.value : 'in preparation';\r\n\r\n    // Allow editing if there are assigned devices OR if progress is not \"in preparation\"\r\n    vm.assignedDevicesAvailable = (assignedDevices.length > 0) || (progressValue !== 'in preparation');\r\n\r\n    // If you show a \"No devices assigned!\" text, update the condition accordingly.\r\n    // e.g., vm.showNoDevicesMessage = (assignedDevices.length === 0 && progressValue === 'in preparation');\r\n\r\n    // For additional UI logic  show attributes step only when devices are available and measurementType is 'ultrasonic'\r\n    vm.showAttributesStep = vm.assignedDevicesAvailable && (measurementType === 'ultrasonic');\r\n    /*vm.showAlarmThresholdsStep = vm.assignedDevicesAvailable;*/\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                progress: [{ value: progressValue, disabled: !vm.assignedDevicesAvailable }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                startTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area: [null],\r\n                unit: [null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            /*alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),*/\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Map known attribute keys to form controls\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                // Place 'progress' in assignmentStep; otherwise, in attributesStep\r\n                const stepGroup = (formControlName === 'progress') ? 'assignmentStep' : 'attributesStep';\r\n                vm.addDeviceFormGroup.get(`stepper.${stepGroup}.${formControlName}`).setValue(attr.value);\r\n            }\r\n            // Start/end times\r\n            else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = (attr.key === 'startTimeMs') ? 'startDate' : 'endDate';\r\n                    const timeControlName = (attr.key === 'startTimeMs') ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            }\r\n            // Weekly schedule\r\n            else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup.get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n            // Additional mapping for alarm threshold attributes can be added similarly.\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n\r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').valueChanges.subscribe(() => {\r\n            updateInstallationTypeOptions();\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').valueChanges.subscribe((val) => {\r\n            setDefaultDeltaT(val);\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.dimension').valueChanges.subscribe((dimension) => {\r\n            const nominalFlow = getNominalFlowByDimension(dimension);\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.nominalFlow').setValue(nominalFlow);\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.nominalFlow').valueChanges.subscribe((val) => {\r\n            if (val) {\r\n                // Example: floor volume as 2% of nominalFlow\r\n                const floorVal = (val * 0.02).toFixed(3);\r\n                vm.addDeviceFormGroup.get('stepper.attributesStep.deltaTAnalysisFloorVolume').setValue(floorVal);\r\n            }\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.progress').valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.showAttributesStep) {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep').disable();\r\n        } else {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep').enable();\r\n        }\r\n\r\n        if (!vm.assignedDevicesAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n\r\n        // Auto-set start time if progress is active and not already set.\r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        }\r\n        // Auto-set end time if progress indicates finished/aborted and no end time is set.\r\n        else if (\r\n            (progressControl.value === 'finished' || progressControl.value === 'aborted') &&\r\n            startDateControl.value && startTimeControl.value &&\r\n            !endDateControl.value && !endTimeControl.value\r\n        ) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const defaultDelta = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(defaultDelta);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        // const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;  // if needed\r\n\r\n        // Convert date/time values to epoch timestamps\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n        let attributesArray;\r\n        if (measurementType === 'ultrasonic') {\r\n            attributesArray = [\r\n                { key: 'xPos', value: 0.5 },\r\n                { key: 'yPos', value: 0.5 },\r\n                { key: 'installationType', value: attributesStep.installationType },\r\n                { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n                { key: 'progress', value: assignmentStep.progress },\r\n                { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n                { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n                { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n                { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n                { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n                { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n                {\r\n                    key: 'area',\r\n                    value: {\r\n                        value: attributesStep.area,\r\n                        unit: attributesStep.unit,\r\n                    },\r\n                },\r\n                { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n                { key: 'dimension', value: attributesStep.dimension },\r\n                { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n                { key: 'deltaT', value: attributesStep.deltaT },\r\n                { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n                { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            ];\r\n        } else {\r\n            attributesArray = [\r\n                { key: 'xPos', value: 0.5 },\r\n                { key: 'yPos', value: 0.5 },\r\n                { key: 'progress', value: assignmentStep.progress },\r\n                { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n                { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            ];\r\n        }\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                // Save successful; update aliases and close dialog\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error while saving attributes:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "6ccd99bd-8562-4e6b-e42b-e7f3c026a129"
      },
      "80ed8bf1-aad0-a5a5-535f-6f404f000320": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_details_cooling_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Back",
              "showIcon": true,
              "icon": "mdi:arrow-left-circle",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "go-back",
                "icon": "mdi:arrow-left-circle",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "80ed8bf1-aad0-a5a5-535f-6f404f000320"
      },
      "ab87c892-d194-6ac8-f5a2-4628926b3e97": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "roomsensorco2_settings"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Settings",
              "showIcon": true,
              "icon": "settings",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "roomsensorco2_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "ab87c892-d194-6ac8-f5a2-4628926b3e97"
      },
      "72261d07-1672-31e6-9d4d-892a6a0a672c": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "roomsensorco2_details_full"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Data",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "roomsensorco2_details_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "72261d07-1672-31e6-9d4d-892a6a0a672c"
      },
      "6c236701-eaf6-c11c-77e8-bf54e7b97581": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensorCO2_header_buttons\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "6c236701-eaf6-c11c-77e8-bf54e7b97581"
      },
      "27f8ed33-fd9a-5dba-0121-70f6b5c3991b": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensorCO2_header_buttons\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "27f8ed33-fd9a-5dba-0121-70f6b5c3991b"
      },
      "00d6d8b9-bbdc-863a-35e4-24dd4a7efd69": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": "pflow_details_cooling_full",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              },
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Back",
              "showIcon": true,
              "icon": "mdi:arrow-left-circle",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "go-back",
                "icon": "mdi:arrow-left-circle",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "00d6d8b9-bbdc-863a-35e4-24dd4a7efd69"
      },
      "f3ac0043-1b43-f234-c053-4d40928ab225": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "roomsensort_settings"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Settings",
              "showIcon": true,
              "icon": "settings",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "roomsensort_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "f3ac0043-1b43-f234-c053-4d40928ab225"
      },
      "51d3fa62-6a83-4c88-e873-fb6a3b88d94b": {
        "typeFullFqn": "system.action_button",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718798104772,
                "endTimeMs": 1718884504772
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF01",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "activatedState": {
              "action": "GET_DASHBOARD_STATE",
              "defaultValue": false,
              "executeRpc": {
                "method": null,
                "requestTimeout": null,
                "requestPersistent": null,
                "persistentPollingInterval": null
              },
              "getAttribute": {
                "scope": null,
                "key": "state"
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;",
                "compareToValue": "roomsensort_details_full"
              }
            },
            "disabledState": {
              "action": "DO_NOTHING",
              "defaultValue": false,
              "getAttribute": {
                "key": "state",
                "scope": null
              },
              "getTimeSeries": {
                "key": "state"
              },
              "dataToValue": {
                "type": "NONE",
                "compareToValue": true,
                "dataToValueFunction": "/* Should return boolean value */\nreturn data;"
              }
            },
            "appearance": {
              "type": "outlined",
              "showLabel": true,
              "label": "Data",
              "showIcon": true,
              "icon": "insert_chart",
              "iconSize": 24,
              "iconSizeUnit": "px",
              "mainColor": "#3D9BE9",
              "backgroundColor": "#FFFFFF",
              "autoScale": true,
              "customStyle": {
                "enabled": null,
                "hovered": null,
                "pressed": null,
                "activated": null,
                "disabled": null
              }
            }
          },
          "title": "Action button",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "4px",
          "configMode": "advanced",
          "actions": {
            "click": [
              {
                "name": "onClick",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "roomsensort_details_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bd80b787-5b71-a945-c4c6-b80018b0b9e6"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "51d3fa62-6a83-4c88-e873-fb6a3b88d94b"
      },
      "f119a080-11c4-049c-0f89-17fd12719edb": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensorT_header_buttons\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "f119a080-11c4-049c-0f89-17fd12719edb"
      },
      "eb0fd3f6-1a82-f6d5-8986-6c000af388be": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensorT_header_buttons\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "eb0fd3f6-1a82-f6d5-8986-6c000af388be"
      },
      "956f112c-836d-5fdb-4697-320d30c41d2b": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensorT_header_buttons\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "956f112c-836d-5fdb-4697-320d30c41d2b"
      },
      "2179cb06-cda4-771a-810d-2f978012b858": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.9576759699773905,
                  "units": "C",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": [
                {
                  "name": "highTemperatureMajorThreshold",
                  "type": "attribute",
                  "label": "highTemperatureMajorThreshold",
                  "color": "#4caf50",
                  "settings": {
                    "__thresholdKey": true
                  },
                  "_hash": 0.3368785807269745
                },
                {
                  "name": "highTemperatureCriticalThreshold",
                  "type": "attribute",
                  "label": "highTemperatureCriticalThreshold",
                  "color": "#f44336",
                  "settings": {
                    "__thresholdKey": true
                  },
                  "_hash": 0.1316420414548043
                }
              ]
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "weeks",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [
              {
                "type": "latestKey",
                "yAxisId": "default",
                "units": null,
                "decimals": 0,
                "lineColor": "rgb(232, 150, 35)",
                "lineType": "dashed",
                "lineWidth": 2,
                "startSymbol": "none",
                "startSymbolSize": 5,
                "endSymbol": "arrow",
                "endSymbolSize": 5,
                "showLabel": true,
                "labelPosition": "end",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.76)",
                "enableLabelBackground": false,
                "labelBackground": "rgba(255,255,255,0.56)",
                "latestKey": "highTemperatureMajorThreshold",
                "latestKeyType": "attribute"
              },
              {
                "type": "latestKey",
                "yAxisId": "default",
                "units": null,
                "decimals": 0,
                "lineColor": "rgb(244, 67, 54)",
                "lineType": "dashed",
                "lineWidth": 2,
                "startSymbol": "none",
                "startSymbolSize": 5,
                "endSymbol": "arrow",
                "endSymbolSize": 5,
                "showLabel": true,
                "labelPosition": "end",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.76)",
                "enableLabelBackground": false,
                "labelBackground": "rgba(255,255,255,0.56)",
                "latestKey": "highTemperatureCriticalThreshold",
                "latestKeyType": "attribute"
              }
            ],
            "dataZoom": false,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "Time series chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "C",
          "decimals": 1,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "2179cb06-cda4-771a-810d-2f978012b858"
      },
      "e3d99119-f445-4079-37e3-7b4992e60521": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "entitiesTitle": "Doktorkits",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "entityNameColumnTitle": "",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 4,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Doktorkits",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "783dd5f0-d34d-946d-a82f-95d3a6eaadd1",
              "filterId": "35492bf9-fb1b-d326-8b75-f0c24db7a976",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "20%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden-mobile",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.46096251592014714,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#ffc107",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.5439377495268714,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "State",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "20%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var state = value;\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        default:\n            return state;\n    }\n}\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": true,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [
              {
                "name": "Select Doktorkit",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedDoktorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "27b78a0c-3e2d-8d90-72dd-10f9f80351b5"
              }
            ],
            "actionCellButton": [
              {
                "name": "Open details",
                "icon": "medical_services",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "Doktorkit_details",
                "setEntityId": true,
                "stateEntityParamName": "selectedDoktorkit",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9e3b9891-b984-4475-345e-b738850e1fda"
              },
              {
                "name": "Open alarms",
                "icon": "add_alert",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "Doktorkits_alarms",
                "setEntityId": true,
                "stateEntityParamName": "selectedDoktorkit",
                "openRightLayout": true,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "367671e7-b239-7991-9af4-bfb949fee2a8"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "e3d99119-f445-4079-37e3-7b4992e60521",
        "typeFullFqn": "system.cards.entities_table"
      },
      "fb3ae59b-bb2f-7bd3-4a88-8b6fc7374aec": {
        "typeFullFqn": "system.cards.horizontal_value_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_S_Power_Cooling",
                  "type": "timeseries",
                  "label": "Max Power",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.6072106968134974,
                  "aggregationType": "MAX",
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "comparisonEnabled": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1713733365761,
                "endTimeMs": 1713819765761
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "horizontal",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 16,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "ac_unit",
            "iconColor": {
              "type": "constant",
              "color": "#048AD3",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';",
              "rangeList": null
            },
            "valueFont": {
              "family": "Roboto",
              "size": 36,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": false,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Av",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "kW",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "headerButton": []
          },
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "bold",
            "style": "normal",
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "fb3ae59b-bb2f-7bd3-4a88-8b6fc7374aec"
      },
      "0186d4b5-cc3c-7b88-d260-b0ad618c5e56": {
        "typeFullFqn": "system.cards.horizontal_value_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_C_Energy_Cooling",
                  "type": "timeseries",
                  "label": "Energy Cooling",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.42927066487589305,
                  "aggregationType": "SUM",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "comparisonEnabled": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1713733365761,
                "endTimeMs": 1713819765761
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "horizontal",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 16,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "ac_unit",
            "iconColor": {
              "type": "constant",
              "color": "#048AD3",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';",
              "rangeList": null
            },
            "valueFont": {
              "family": "Roboto",
              "size": 36,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": false,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Energy Cooling",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "kWh",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "headerButton": []
          },
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "bold",
            "style": "normal",
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "0186d4b5-cc3c-7b88-d260-b0ad618c5e56"
      },
      "f209084b-5a75-d2cf-3d73-fe40d7db1f60": {
        "typeFullFqn": "system.cards.horizontal_value_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_C_Energy_Heating",
                  "type": "timeseries",
                  "label": "Energy Heating",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.42927066487589305,
                  "aggregationType": "SUM",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "comparisonEnabled": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1713733365761,
                "endTimeMs": 1713819765761
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "horizontal",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 16,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "local_fire_department",
            "iconColor": {
              "type": "constant",
              "color": "#F44336",
              "rangeList": null,
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 36,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": false,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Energy Heating",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "kWh",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "headerButton": []
          },
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "bold",
            "style": "normal",
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "f209084b-5a75-d2cf-3d73-fe40d7db1f60"
      },
      "439a6caa-89b9-46fe-0daf-b5c2a80e41b3": {
        "typeFullFqn": "system.cards.horizontal_value_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_S_Power_Heating",
                  "type": "timeseries",
                  "label": "Max Power",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.6072106968134974,
                  "aggregationType": "MAX",
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "comparisonEnabled": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1713733365761,
                "endTimeMs": 1713819765761
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "horizontal",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 16,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "local_fire_department",
            "iconColor": {
              "type": "constant",
              "color": "#F44336",
              "rangeList": null,
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 36,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": false,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Av",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "kW",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "headerButton": []
          },
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "bold",
            "style": "normal",
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "439a6caa-89b9-46fe-0daf-b5c2a80e41b3"
      },
      "27f828db-8b95-3386-8a3a-df9c1f75b737": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_header_buttons_cooling\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "27f828db-8b95-3386-8a3a-df9c1f75b737"
      },
      "fa4b7c84-2a5a-d1a3-efdc-f4f236fad799": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1724742103028,
                "endTimeMs": 1724828503028
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var content = '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' + \n    '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"pflow_settings\"></tb-dashboard-state>'+\n    '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"roomsensorco2_settings\"></tb-dashboard-state>'+\n    '</div>';\nreturn content;",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "fa4b7c84-2a5a-d1a3-efdc-f4f236fad799"
      },
      "b632f7ae-1a4c-1cf8-fe73-72b5fe064888": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n} else {\n    deviceState = false;\n}\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        // Header\n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\">' +\n        '</div>' +\n        '<div id=\"dashboard-state\" fxLayout=\"column\" fxFlex>' +\n            '<tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_header_buttons_heating\"></tb-dashboard-state>' +\n        '</div>' +\n       '</div>';",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.active-button {\n        background-color: #007bff; /* Change this to the desired highlight color */\n        color: white;\n        border-color: #007bff; /* Make sure the border matches the highlight color */\n    }\n.active-button:hover {\n        background-color: #0056b3; /* Darker shade for hover effect */\n        border-color: #0056b3;\n    }"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\n\n//widgetContext.stateController.openState(\"default\",params.selectedDevice.entityId);\nwidgetContext.stateController.navigatePrevState(1);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_analysis_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_details_cooling_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "settings-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "pflow_settings",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "b632f7ae-1a4c-1cf8-fe73-72b5fe064888"
      },
      "30be4621-8d89-f075-23cf-61e291b96f06": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1724742103028,
                "endTimeMs": 1724828503028
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var content = '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' + \n    '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"pflow_settings\"></tb-dashboard-state>'+\n    '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"roomsensorco2_settings\"></tb-dashboard-state>'+\n    '</div>';\nreturn content;",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": true,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "30be4621-8d89-f075-23cf-61e291b96f06"
      },
      "7a36c052-6804-1d2c-f3e9-b9ed5dac5420": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.volume-flow}",
                  "color": "#048AD3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.9892163329260306,
                  "units": "m/hr",
                  "decimals": 3,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value/1000;"
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-difference}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.20173100962836799,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "m",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.measurement.volume}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              },
              "axis1": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "right",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis1",
                "order": 1
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.volume}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "7a36c052-6804-1d2c-f3e9-b9ed5dac5420"
      },
      "3fda1b23-00b0-4999-0128-01040c961775": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-flow}",
                  "color": "#009688",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.9892163329260306,
                  "units": "C",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-return}",
                  "color": "#8BC34A",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.47698777490073074,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-difference}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.946108921429071,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.temperatures}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "3fda1b23-00b0-4999-0128-01040c961775"
      },
      "fe140916-565b-011d-3429-ac76a7b5cb55": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_Power_Cooling",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.timeseries.power.title}",
                  "color": "#009688",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.21936947652303296,
                  "aggregationType": null,
                  "units": "kW",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.timeseries.outside-temperature.title}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3061892804743369,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "kW",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.power.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              },
              "axis1": {
                "units": "C",
                "decimals": 1,
                "show": true,
                "label": "{i18n:unit.measures.temperature}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "right",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis1",
                "order": 1
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.cooling-power}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "fe140916-565b-011d-3429-ac76a7b5cb55"
      },
      "b70192cf-42b2-333a-0301-e057bf2eec00": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_M_Energy_Cooling",
                  "type": "timeseries",
                  "label": "Energy",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.771684112761218,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709801809226,
                "endTimeMs": 1709888209226
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "simplified",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 30,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "local_fire_department",
            "iconColor": {
              "type": "constant",
              "color": "#F44336",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';",
              "rangeList": null
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "imageUrl": null,
              "color": "#FFFFFF",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Value card",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "kWh",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "b70192cf-42b2-333a-0301-e057bf2eec00"
      },
      "d697b7ec-551e-fe5b-5f4f-ac78e4e5207c": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_M_Volume",
                  "type": "timeseries",
                  "label": "Volume",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.02192356801703177
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709801872563,
                "endTimeMs": 1709888272563
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "simplified",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 30,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "water_drop",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "imageUrl": null,
              "color": "#FFFFFF",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Value card",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "m",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "d697b7ec-551e-fe5b-5f4f-ac78e4e5207c"
      },
      "2b8ba61e-2750-15df-bc70-07cc290cbe83": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "deviceName",
                  "type": "attribute",
                  "label": "deviceName",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.18898048752010266
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.16749751122135326
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.4546758680870897
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718726416923,
                "endTimeMs": 1718812816923
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": " - **Selected P-Flow**: ${entityName} / ${entityLabel}\n - **Installation Type**: ${installationType}.",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ""
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "margin": "0px",
          "borderRadius": "8px"
        },
        "row": 0,
        "col": 0,
        "id": "2b8ba61e-2750-15df-bc70-07cc290cbe83"
      },
      "db99f5e8-955e-55c4-31b5-1d05c028cc4c": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "deviceName",
                  "type": "attribute",
                  "label": "deviceName",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.18898048752010266
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.16749751122135326
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.4546758680870897
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.2242998419492157
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718726416923,
                "endTimeMs": 1718812816923
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "### P-flow Information\n - **Measurement ID**: ${entityName}\n - **Measurement Name**: ${locationName}\n - **Installation Type**: ${installationType}",
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ""
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "8px"
        },
        "row": 0,
        "col": 0,
        "id": "db99f5e8-955e-55c4-31b5-1d05c028cc4c"
      },
      "60492841-691e-4aaf-2079-661426ccd30d": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_Power_Heating",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.timeseries.power.title}",
                  "color": "#F44336",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.9892163329260306,
                  "units": "kW",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            },
            {
              "type": "entity",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.timeseries.outside-temperature.title}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5578075209921574,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "kW",
                "decimals": 1,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.power.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              },
              "axis1": {
                "units": "C",
                "decimals": 1,
                "show": true,
                "label": "{i18n:custom.diagnostics.timeseries.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "right",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis1",
                "order": 1
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.timeseries.heating-energy.title}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "60492841-691e-4aaf-2079-661426ccd30d"
      },
      "96ce98de-c2ee-4d11-1317-208ab21d346c": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.volume-flow}",
                  "color": "#048AD3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.9892163329260306,
                  "units": "m",
                  "decimals": 3,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value/1000;"
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-difference}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "axis1",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "tooltipValueFormatter": null,
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.27147667954996146,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "m",
                "decimals": 3,
                "show": true,
                "label": "{i18n:custom.diagnostics.measurement.volume}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              },
              "axis1": {
                "units": "C",
                "decimals": 1,
                "show": true,
                "label": "{i18n:custom.diagnostics.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "right",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "axis1",
                "order": 1
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.volume}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "96ce98de-c2ee-4d11-1317-208ab21d346c"
      },
      "4e1a1bc0-e7a2-a7db-3486-930af4fef035": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_TemperatureFlow",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-flow}",
                  "color": "#F44336",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.9892163329260306,
                  "units": "C",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureReturn",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-return}",
                  "color": "#048AD3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.47698777490073074,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "{i18n:custom.diagnostics.measurement.temperature-difference}",
                  "color": "#E89623",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.946108921429071,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.temperatures}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "4e1a1bc0-e7a2-a7db-3486-930af4fef035"
      },
      "6ba7fe94-7200-fc06-9ad8-21cb0cf36479": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "Energy",
                  "color": "#F44336",
                  "settings": {},
                  "_hash": 0.771684112761218,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709801809226,
                "endTimeMs": 1709888209226
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "simplified",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 30,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "local_fire_department",
            "iconColor": {
              "type": "constant",
              "color": "#F44336",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';",
              "rangeList": null
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "imageUrl": null,
              "color": "#FFFFFF",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Value card",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "kWh",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "6ba7fe94-7200-fc06-9ad8-21cb0cf36479"
      },
      "37fbc640-6df7-6604-0f78-68b1285679ee": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "CHC_M_Volume",
                  "type": "timeseries",
                  "label": "Volume",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.02192356801703177
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709801872563,
                "endTimeMs": 1709888272563
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "simplified",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 30,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "water_drop",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "family": "Roboto",
              "size": 52,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "imageUrl": null,
              "color": "#FFFFFF",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            }
          },
          "title": "Value card",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "m",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "37fbc640-6df7-6604-0f78-68b1285679ee"
      },
      "7af6c9bf-4916-efb4-59db-6ed309edbdde": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8902879312951573
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1730110460337,
                "endTimeMs": 1730196860337
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var DeviceState;\r\nvar profile;\r\nconsole.log(data);\r\nif (data && data.length && data[0]['entityId']) {\r\n    profile = data[0].deviceType;\r\n    console.log(profile);\r\n    DeviceState = true;\r\n} else {\r\n    DeviceState = false;\r\n}\r\n\r\n// Determine which stateId to use based on the profile\r\nvar stateId;\r\n\r\nif (profile === 'Room Sensor CO2') {\r\n    stateId = 'sensor_charts_co2';\r\n} else if (profile === 'Room Sensor T' || profile === 'Temperature Sensor') {\r\n    stateId = 'sensor_charts_t';\r\n} else {\r\n    stateId = 'sensor_charts_t'; // Default stateId if DeviceState is false\r\n}\r\n\r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n       (DeviceState \r\n         ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"' + stateId + '\"></tb-dashboard-state>' \r\n         : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensors\"></tb-dashboard-state>') +\r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 100px;\n    margin: 6px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.main-layout .tb-mat-20 {\n    width: 1px;\n    height: 2px;\n    margin: 2px;\n}"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "7af6c9bf-4916-efb4-59db-6ed309edbdde"
      },
      "3ca713e9-31b0-85f5-bf19-a706095abeda": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1730110980841,
                "endTimeMs": 1730197380841
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0",
          "settings": {
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "displayEntityLabel": false,
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "entitiesTitle": "Entities"
          },
          "title": "Sensors",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "70ff25cd-3d47-b7fc-05e1-765294946bf0",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7573592191483534
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "rowClick": [
              {
                "name": "selectedDevice",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_loraWan",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fa5baf05-0c4c-2092-bebf-ac5fb62d3770"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "list",
          "iconColor": null,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": false,
          "margin": "0",
          "borderRadius": "8px",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleTooltip": ""
        },
        "row": 0,
        "col": 0,
        "id": "3ca713e9-31b0-85f5-bf19-a706095abeda"
      },
      "649f24ef-7d15-4059-3823-0d81c54101dc": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e043f69e-804d-8e1d-062c-7da5becf5b51",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "${entityLabel}",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6204444548947727,
                  "units": "ppm",
                  "decimals": 0,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "CO2",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "649f24ef-7d15-4059-3823-0d81c54101dc"
      },
      "ed5da7c5-02bf-09c0-3f12-caefcbf36cd7": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.96293937289271
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802689003,
                "endTimeMs": 1709889089003
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 80,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 120,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true,
            "padding": ""
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "C",
          "decimals": 1,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "ed5da7c5-02bf-09c0-3f12-caefcbf36cd7"
      },
      "ae4fa934-fc77-b9e5-8920-9987b32dbab6": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.6497522501457633
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802778399,
                "endTimeMs": 1709889178399
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 80,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 120,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true,
            "padding": ""
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "%",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "ae4fa934-fc77-b9e5-8920-9987b32dbab6"
      },
      "720d70c4-8845-3052-43de-be6d8fc98a01": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.9281198282731116
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802813543,
                "endTimeMs": 1709889213543
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 80,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 120,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true,
            "padding": ""
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "ppm",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "720d70c4-8845-3052-43de-be6d8fc98a01"
      },
      "4dcb82fa-72ef-14e3-c54a-44dbc36eb417": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "vdd",
                  "type": "timeseries",
                  "label": "Battery",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7183554137035979,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value<=3648 && value >= 3000){\n    return (value-3000)/(3648-3000)*100;\n}else if (value <(3648*2) && value>6000){\n    return (value - 6000)/((3648*2)-6000)*100;\n} else{\n    return value;    \n}\n"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802689003,
                "endTimeMs": 1709889089003
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "layout": "simplified",
            "autoScale": true,
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 80,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.5"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 120,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal",
              "lineHeight": "100%"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false,
              "auto": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "1.33"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": ""
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "%",
          "decimals": 1,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "4dcb82fa-72ef-14e3-c54a-44dbc36eb417"
      },
      "0486fd1e-360b-e18d-3e9a-c43c555cc0fe": {
        "typeFullFqn": "system.range_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "deviceId": "f914c020-c664-11ee-8196-b3999b4a11b6",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "CO2",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.463540446159211,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "dataZoom": false,
            "rangeColors": [
              {
                "from": 0,
                "to": 500,
                "color": "#234CC7"
              },
              {
                "from": 501,
                "to": 700,
                "color": "#305AD7"
              },
              {
                "from": 701,
                "to": 850,
                "color": "#7191EF"
              },
              {
                "from": 851,
                "to": 1000,
                "color": "#FFA600"
              },
              {
                "from": 1001,
                "to": 1500,
                "color": "#F36900"
              },
              {
                "from": 1501,
                "to": 2000,
                "color": "#F04022"
              },
              {
                "from": 2001,
                "to": null,
                "color": "#D81838"
              }
            ],
            "outOfRangeColor": "#ccc",
            "fillArea": true,
            "showLegend": true,
            "legendPosition": "top",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "showTooltip": true,
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": "dd MMM yyyy HH:mm",
              "lastUpdateAgo": false,
              "custom": false
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "tooltipDateInterval": true
          },
          "title": "CO2",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "ppm",
          "decimals": 0,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "0486fd1e-360b-e18d-3e9a-c43c555cc0fe"
      },
      "01b57f7f-f414-bc7c-6812-5dd5225647fd": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6204444548947727,
                  "units": "C",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "Temperature",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "01b57f7f-f414-bc7c-6812-5dd5225647fd"
      },
      "5f3c6baf-c439-2035-55d8-452f2b4189bc": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.96293937289271
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802689003,
                "endTimeMs": 1709889089003
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 60,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 100,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "C",
          "decimals": 1,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "5f3c6baf-c439-2035-55d8-452f2b4189bc"
      },
      "9fa6ddf2-ac2f-6bda-b319-c1f14e2282fb": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.6497522501457633
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802778399,
                "endTimeMs": 1709889178399
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 60,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 100,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "%",
          "decimals": 0,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "9fa6ddf2-ac2f-6bda-b319-c1f14e2282fb"
      },
      "2b1276c2-7a3f-5a63-4c80-04cdde36f526": {
        "typeFullFqn": "system.cards.value_card",
        "type": "latest",
        "sizeX": 3,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "vdd",
                  "type": "timeseries",
                  "label": "Battery",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7183554137035979,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value<=3648 && value >= 3000){\n    return (value-3000)/(3648-3000)*100;\n}else{\n    return value;    \n}\n"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1709802689003,
                "endTimeMs": 1709889089003
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "simplified",
            "showLabel": true,
            "labelFont": {
              "size": 60,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "thermostat",
            "iconColor": {
              "type": "constant",
              "color": "#5469FF",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 100,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true
          },
          "title": "Value card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "%",
          "decimals": 1,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "advanced",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "8px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "enableDataExport": false,
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          }
        },
        "row": 0,
        "col": 0,
        "id": "2b1276c2-7a3f-5a63-4c80-04cdde36f526"
      },
      "843ceccf-46a3-26d5-6d27-43da879d2274": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "Humidity",
                  "color": "#4caf50",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.11151802817827683,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "Humidity",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "843ceccf-46a3-26d5-6d27-43da879d2274"
      },
      "c12fb268-5630-0789-3a3d-b1603bfe590f": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "status_battery_level",
                  "type": "timeseries",
                  "label": "Battery Level",
                  "color": "#000000",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6437441856490309,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0,
                "min": 0,
                "max": 100
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "Battery",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "c12fb268-5630-0789-3a3d-b1603bfe590f"
      },
      "83485f16-ee24-9e2d-7272-aec8d40e9a4b": {
        "typeFullFqn": "system.range_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "deviceId": "f914c020-c664-11ee-8196-b3999b4a11b6",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8890563038125108
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "hideInterval": false,
            "hideLastInterval": false,
            "hideQuickInterval": false,
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "dataZoom": true,
            "rangeColors": [
              {
                "to": 10,
                "color": "#234CC7",
                "from": null
              },
              {
                "from": 10,
                "to": 15,
                "color": "#305AD7"
              },
              {
                "from": 15,
                "to": 20,
                "color": "#7191EF"
              },
              {
                "from": 20,
                "to": 25,
                "color": "#FFA600"
              },
              {
                "from": 20,
                "to": 30,
                "color": "#F36900"
              },
              {
                "from": 30,
                "to": 35,
                "color": "#F04022"
              },
              {
                "from": 35,
                "color": "#D81838",
                "to": null
              }
            ],
            "outOfRangeColor": "#ccc",
            "fillArea": true,
            "showLegend": true,
            "legendPosition": "top",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "showTooltip": true,
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": "dd MMM yyyy HH:mm",
              "lastUpdateAgo": false,
              "custom": false,
              "auto": false
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "showRangeThresholds": true,
            "rangeThreshold": {
              "type": "constant",
              "yAxisId": "default",
              "units": null,
              "decimals": 0,
              "lineColor": "#37383b",
              "lineType": "dashed",
              "lineWidth": 1,
              "startSymbol": "circle",
              "startSymbolSize": 5,
              "endSymbol": "arrow",
              "endSymbolSize": 7,
              "showLabel": true,
              "labelPosition": "insideEndTop",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "labelColor": "#37383b",
              "enableLabelBackground": true,
              "labelBackground": "rgba(255,255,255,0.56)"
            },
            "fillAreaOpacity": 0.7,
            "showLine": true,
            "step": false,
            "stepType": "start",
            "smooth": false,
            "lineType": "solid",
            "lineWidth": 2,
            "showPoints": false,
            "showPointLabel": false,
            "pointLabelPosition": "top",
            "pointLabelFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "1"
            },
            "pointLabelColor": "rgba(0, 0, 0, 0.76)",
            "enablePointLabelBackground": false,
            "pointLabelBackground": "rgba(255,255,255,0.56)",
            "pointShape": "emptyCircle",
            "pointSize": 4,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "yAxis": {
              "units": null,
              "decimals": 0,
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "left",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormatter": null,
              "showTicks": false,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": false,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)",
              "id": "default",
              "order": 0
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": false,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "thresholds": [],
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "padding": "12px"
          },
          "title": "Temperature",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "basic",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "C",
          "decimals": 0,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": true
        },
        "row": 0,
        "col": 0,
        "id": "83485f16-ee24-9e2d-7272-aec8d40e9a4b"
      },
      "62bee3d4-61ba-6a86-0a99-a34e46518cff": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "Project Administration",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": true,
            "entityNameColumnTitle": "ID",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Projects",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
              "filterId": "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.23547368231999988,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8348661406382081,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "Progress",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar state = value;\r\nif (state == 'active') { // all key values here are strings\r\n  color = '#f3de61'; // Yellow\r\n} else if (state == 'in preparation') {\r\n  /*color = '#005757';*/\r\n  /*color = '#eef30b';*/\r\n  color = '#CAC1D2';// Grey\r\n}\r\nelse {\r\n  color = '#27AE60';//Green\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>' + ' ' + value;\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.15334267783981326,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "generalReport",
                  "type": "attribute",
                  "label": "Report",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar generalReport = value;\r\nif (generalReport == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.8824380396132228,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Open Measurements",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "measurements_new",
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "General Report",
                "icon": "verified",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "/*var userRole = widgetContext.stateController.getStateParams().userRole;\nif(userRole !==\"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\"){\n    return true;\n}else{\n    return false;\n}*/\n\nreturn false;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" (ngSubmit)=\"checkout()\" class=\"add-entity-form\" [formGroup]=\"addEntityFormGroup\">\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>Payment Options</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n    <div mat-dialog-content fxLayout=\"column\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"32px\">\n            <div fxLayout=\"column\">\n                <div>Pay by Invoice</div>\n                <mat-checkbox [checked]=\"buyInvoice\" (change)=\"onSelectBuyInvoice($event)\"></mat-checkbox>\n            </div>\n            <div fxLayout=\"column\">\n                <div>Credit Card / Alternative Payments</div>\n                <mat-checkbox [checked]=\"buyCard\" (change)=\"onSelectBuyCard($event)\"></mat-checkbox>\n            </div>\n        </div>\n    </div>\n\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\n            Cancel\n        </button>\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || (!buyInvoice && !buyCard)\">\n            Checkout\n        </button>\n    </div>\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet PageLink = widgetContext.pageLink;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet assetProfileService = $injector.get(widgetContext.servicesMap.get('assetProfileService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\nlet tenantId = \"efb63c10-b576-11ee-a6c2-a149ed03c64d\";\r\nlet stripeSecretKey;\r\nlet sessionId = '';\r\nlet products = [];\r\nlet projectID = entityId.id;\r\nlet customerId;\r\nlet customerStripeId;\r\nlet bearerToken = '';\r\n\r\nvar customer;\r\nif (widgetContext.currentUser.authority !== 'CUSTOMER_USER') {\r\n  customer = widgetContext.stateController.getStateParams().entityId;  \r\n} else {\r\n  customer = { entityType: \"CUSTOMER\", id: widgetContext.currentUser.customerId };\r\n}\r\n\r\nlet projectName = '';\r\nvar url = window.location.href;\r\n\r\nfunction getQueryParam(param) {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  return urlParams.get(param);\r\n}\r\n\r\nconst sessionIdFromUrl = getQueryParam('session_id');\r\nif (sessionIdFromUrl) {\r\n  window.history.replaceState({}, document.title, window.location.pathname);\r\n  localStorage.removeItem('selectedProjectId');\r\n  checkPaymentStatus(sessionIdFromUrl, projectID);\r\n} else {\r\n  initialize();\r\n}\r\n\r\nfunction initialize() {\r\n  const pageLink = PageLink(50, 0);\r\n  const query = {\r\n    parameters: {\r\n      rootId: customer.id,\r\n      rootType: \"CUSTOMER\",\r\n      direction: \"FROM\",\r\n      relationTypeGroup: \"COMMON\",\r\n      maxLevel: 1,\r\n      fetchLastLevelOnly: false\r\n    },\r\n    relationType: \"Contains\",\r\n    assetTypes: [\"Product\"]\r\n  };\r\n\r\n  assetService.getAssetInfo(projectID).subscribe(info => {\r\n    customerId = info.customerId;\r\n    projectName = info.name || projectID;\r\n    // console.log(\"projectID\", projectID);\r\n    checkSingleProjectStatus(projectID).then(result => {\r\n        // console.log(\"result Proje\", result)\r\n      if (result === 'paid') {\r\n        alert(\"The selected Project already has the generalReport activated.\");\r\n      } else if (result === 'openInvoice') {\r\n        alert(\"There is an open invoice for this Project. Please check your email inbox.\");\r\n      } else {\r\n        attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n          customerStripeId = stripeId[0].value;\r\n          attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey'])\r\n            .subscribe(attribute => {\r\n              stripeSecretKey = attribute[0].value;\r\n              fetch('https://cloud.pke-iot.expert/api/auth/login', {\r\n                method: 'POST',\r\n                headers: {\r\n                  'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                  \"username\": \"belimo.api@pke-iot.expert\",\r\n                  \"password\": \"vfx3cvr@VMJ3bxk3urg\"\r\n                })\r\n              })\r\n              .then(resp => resp.json())\r\n              .then(loginData => {\r\n                bearerToken = loginData.token;\r\n                return fetch('https://cloud.pke-iot.expert/api/assets', {\r\n                  method: 'POST',\r\n                  headers: {\r\n                    'accept': 'application/json',\r\n                    'Content-Type': 'application/json',\r\n                    'X-Authorization': 'Bearer ' + bearerToken\r\n                  },\r\n                  body: JSON.stringify(query)\r\n                });\r\n              })\r\n              .then(resp2 => resp2.json())\r\n              .then(assets => {\r\n                // console.log(\"All fetched products:\", assets);\r\n                let filteredProducts = [];\r\n                let productFetches = assets.map(asset => {\r\n                  return new Promise((resolve, reject) => {\r\n                    fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${asset.id.id}/values/attributes?keys=prodType`, {\r\n                      method: 'GET',\r\n                      headers: {\r\n                        'accept': 'application/json',\r\n                        'X-Authorization': 'Bearer ' + bearerToken\r\n                      }\r\n                    })\r\n                    .then(resp3 => resp3.json())\r\n                    .then(attributes => {\r\n                      if (attributes.length > 0 && attributes[0].key === 'prodType' && attributes[0].value === 'generalReport') {\r\n                        filteredProducts.push(asset);\r\n                      }\r\n                      resolve();\r\n                    })\r\n                    .catch(err => {\r\n                      console.error(\"Error fetching prodType:\", err);\r\n                      resolve();\r\n                    });\r\n                  });\r\n                });\r\n                Promise.all(productFetches).then(() => {\r\n                  //console.log(\"Filtered products:\", filteredProducts);\r\n                  products = filteredProducts;\r\n                  openAddEntityDialog();\r\n                });\r\n              })\r\n              .catch(error => {\r\n                console.error(\"Error fetching products:\", error);\r\n                alert('Failed to fetch products. Please try again.');\r\n              });\r\n            });\r\n        });\r\n      }\r\n    }).catch(err => {\r\n      console.error('Error checking project status:', err);\r\n      alert('Failed to check project status. Please try again.');\r\n    });\r\n  });\r\n}\r\n\r\nfunction openAddEntityDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n  let vm = instance;\r\n  vm.products = products;\r\n  vm.buyInvoice = false;\r\n  vm.buyCard = false;\r\n\r\n  vm.addEntityFormGroup = vm.fb.group({});\r\n\r\n  vm.onSelectBuyInvoice = function(event) {\r\n    vm.buyInvoice = event.checked;\r\n    if (vm.buyInvoice) {\r\n      vm.buyCard = false;\r\n    }\r\n  };\r\n\r\n  vm.onSelectBuyCard = function(event) {\r\n    vm.buyCard = event.checked;\r\n    if (vm.buyCard) {\r\n      vm.buyInvoice = false;\r\n    }\r\n  };\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n\r\n  vm.checkout = function () {\r\n    if (!vm.products.length) {\r\n      alert(\"No product found for generalReport.\");\r\n      vm.dialogRef.close(null);\r\n      return;\r\n    }\r\n    const productId = vm.products[0].id.id;\r\n    fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${productId}/values/attributes?keys=price_stripe_id`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'accept': 'application/json',\r\n        'X-Authorization': 'Bearer ' + bearerToken\r\n      }\r\n    })\r\n    .then(resp => resp.json())\r\n    .then(attributes => {\r\n      let priceIdObj = attributes.find(attr => attr.key === 'price_stripe_id');\r\n      if (priceIdObj) {\r\n        const priceId = priceIdObj.value;\r\n        if (vm.buyInvoice) {\r\n          createInvoiceForOneTimePurchase(priceId, instance);\r\n        } else if (vm.buyCard) {\r\n          createCheckoutSession(priceId, instance);\r\n        } else {\r\n          alert(\"Please select a payment method.\");\r\n        }\r\n      } else {\r\n        console.error('Price ID not found for the product (price_stripe_id).');\r\n        vm.dialogRef.close(null);\r\n      }\r\n    })\r\n    .catch(err => {\r\n      console.error('Error fetching price_stripe_id:', err);\r\n      vm.dialogRef.close(null);\r\n    });\r\n  };\r\n}\r\n\r\nasync function createInvoiceForOneTimePurchase(priceId, instance) {\r\n  try {\r\n    const priceResp = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResp.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResp.statusText}`);\r\n    }\r\n    const priceData = await priceResp.json();\r\n    const amount = priceData.unit_amount;\r\n    const currency = priceData.currency;\r\n\r\n    let invoiceBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      auto_advance: 'false',\r\n      collection_method: 'send_invoice',\r\n      days_until_due: '14'\r\n    });\r\n    const invoiceResp = await fetch('https://api.stripe.com/v1/invoices', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceBody\r\n    });\r\n    if (!invoiceResp.ok) {\r\n      throw new Error(`Error creating draft invoice: ${invoiceResp.statusText}`);\r\n    }\r\n    const invoiceData = await invoiceResp.json();\r\n\r\n    let invoiceItemBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      invoice: invoiceData.id,\r\n      amount: amount.toString(),\r\n      currency: currency,\r\n      description: `One-time purchase for project: ${projectName}`\r\n    });\r\n    const invoiceItemResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceItemBody\r\n    });\r\n    if (!invoiceItemResp.ok) {\r\n      throw new Error(`Error creating invoice item: ${invoiceItemResp.statusText}`);\r\n    }\r\n    await invoiceItemResp.json();\r\n\r\n    const finalizeResp = await fetch(`https://api.stripe.com/v1/invoices/${invoiceData.id}/finalize`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!finalizeResp.ok) {\r\n      throw new Error(`Error finalizing invoice: ${finalizeResp.statusText}`);\r\n    }\r\n    const finalizedInvoice = await finalizeResp.json();\r\n\r\n    const attributes = [\r\n      { key: \"generalReport\", value: false },\r\n      { key: \"invoiceId\", value: invoiceData.id }\r\n    ];\r\n    attributeService.saveEntityAttributes(\r\n      { entityType: 'ASSET', id: projectID },\r\n      \"SERVER_SCOPE\",\r\n      attributes\r\n    ).subscribe(\r\n      () => {\r\n        alert(\"Invoice created and sent!\");\r\n        instance.dialogRef.close(null);\r\n      },\r\n      (error) => {\r\n        console.error('Error updating generalReport attribute:', error);\r\n        instance.dialogRef.close(null);\r\n      }\r\n    );\r\n  } catch (err) {\r\n    console.error(\"Error creating invoice:\", err);\r\n    alert(\"Failed to create invoice. Please try again.\");\r\n    instance.dialogRef.close(null);\r\n  }\r\n}\r\n\r\nasync function createCheckoutSession(priceId, instance) {\r\n  try {\r\n    const priceResponse = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResponse.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResponse.statusText}`);\r\n    }\r\n    const priceData = await priceResponse.json();\r\n    const isRecurring = priceData.recurring !== null;\r\n    const mode = isRecurring ? 'subscription' : 'payment';\r\n    const successUrl = url;\r\n    const cancelUrl = url;\r\n\r\n    const bodyParams = new URLSearchParams({\r\n      'success_url': successUrl,\r\n      'cancel_url': cancelUrl,\r\n      'payment_method_types[]': 'card',\r\n      'mode': mode,\r\n      'customer': customerStripeId\r\n    });\r\n    bodyParams.append('line_items[0][price_data][currency]', priceData.currency);\r\n    bodyParams.append('line_items[0][price_data][unit_amount]', String(priceData.unit_amount));\r\n    bodyParams.append('line_items[0][price_data][product_data][name]', `One-time purchase for: ${projectName}`);\r\n    bodyParams.append('line_items[0][quantity]', '1');\r\n\r\n    const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: bodyParams\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.url) {\r\n      sessionId = data.id;\r\n      localStorage.setItem('sessionId', sessionId);\r\n      await new Promise((resolve, reject) => {\r\n        attributeService.saveEntityAttributes(\r\n          { entityType: 'ASSET', id: projectID },\r\n          \"SERVER_SCOPE\",\r\n          [{ key: \"sessionId\", value: sessionId }]\r\n        ).subscribe(\r\n          () => resolve(),\r\n          (error) => {\r\n            console.error('Error saving session ID attribute:', error);\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n      instance.dialogRef.close(null);\r\n      window.location.href = data.url;\r\n    } else {\r\n      console.error('Checkout session URL not found in response');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating checkout session:', error);\r\n  }\r\n}\r\n\r\nasync function checkPaymentStatus(sessionId, entityId) {\r\n  try {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      await fetchStripeKeysAndCustomerId();\r\n    }\r\n    const response = await fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.payment_status === 'paid') {\r\n      alert('Payment completed successfully!');\r\n      const attributes = [\r\n        { key: \"generalReport\", value: true }\r\n      ];\r\n      attributeService.saveEntityAttributes(\r\n        { entityType: 'ASSET', id: projectID },\r\n        \"SERVER_SCOPE\",\r\n        attributes\r\n      ).subscribe(\r\n        () => {},\r\n        (error) => {\r\n          console.error('Error saving generalReport attribute:', error);\r\n        }\r\n      );\r\n      return 'paid';\r\n    } else {\r\n      alert('Payment was not successful. Please try again.');\r\n      return data.payment_status;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking payment status:', error);\r\n    return 'error';\r\n  }\r\n}\r\n\r\nasync function fetchStripeKeysAndCustomerId() {\r\n  return new Promise((resolve, reject) => {\r\n    assetService.getAssetInfo(projectID).subscribe(info => {\r\n      customerId = info.customerId;\r\n      projectName = info.name || projectID;\r\n      attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n        customerStripeId = stripeId[0].value;\r\n        attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey']).subscribe(attribute => {\r\n          stripeSecretKey = attribute[0].value;\r\n          resolve();\r\n        }, reject);\r\n      }, reject);\r\n    }, reject);\r\n  });\r\n}\r\n\r\nfunction checkSingleProjectStatus(mId) {\r\n  return new Promise((resolve, reject) => {\r\n    attributeService.getEntityAttributes(\r\n      { entityType: 'ASSET', id: mId },\r\n      \"SERVER_SCOPE\",\r\n      ['generalReport','invoiceId','sessionId']\r\n    ).subscribe(attrs => {\r\n      // console.log(\"attrs\", attrs);\r\n      let generalReportVal = false;\r\n      let invoiceIdVal = null;\r\n      let sessionIdVal = null;\r\n      attrs.forEach(a => {\r\n        if (a.key === 'generalReport') generalReportVal = a.value;\r\n        if (a.key === 'invoiceId') invoiceIdVal = a.value;\r\n        if (a.key === 'sessionId') sessionIdVal = a.value;\r\n      });\r\n      if (generalReportVal === true) {\r\n        resolve(\"paid\");\r\n      } else {\r\n        if (sessionIdVal) {\r\n          checkStripeSessionPaid(sessionIdVal).then(isSessionPaid => {\r\n            if (isSessionPaid) {\r\n              resolve(\"paid\");\r\n            } else if (invoiceIdVal) {\r\n              checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n                if (invStatus === 'paid') resolve(\"paid\");\r\n                else if (invStatus === 'open') resolve(\"openInvoice\");\r\n                else resolve(\"unpaid\");\r\n              }).catch(() => reject());\r\n            } else {\r\n              resolve(\"unpaid\");\r\n            }\r\n          }).catch(() => reject());\r\n        } else if (invoiceIdVal) {\r\n          checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n            if (invStatus === 'paid') resolve(\"paid\");\r\n            else if (invStatus === 'open') resolve(\"openInvoice\");\r\n            else resolve(\"unpaid\");\r\n          }).catch(() => reject());\r\n        } else {\r\n          resolve(\"unpaid\");\r\n        }\r\n      }\r\n    }, err => reject(err));\r\n  });\r\n}\r\n\r\nfunction checkStripeSessionPaid(sid) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sid}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.payment_status === 'paid') resolve(true);\r\n        else resolve(false);\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n\r\nfunction checkStripeInvoice(invoiceIdVal) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceIdVal}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.status === 'paid') {\r\n          resolve('paid');\r\n        } else if (d.status === 'open' || d.status === 'draft') {\r\n          resolve('open');\r\n        } else {\r\n          resolve(d.status);\r\n        }\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "cfb1f17f-7079-cb37-3f1b-1a4b30881eba"
              },
              {
                "name": "Activate all Reports",
                "icon": "mdi:file-chart",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "/*var userRole = widgetContext.stateController.getStateParams().userRole;\nif(userRole !==\"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\"){\n    return true;\n}else{\n    return false;\n}*/\n\nreturn false;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" (ngSubmit)=\"checkout()\" class=\"add-entity-form\" [formGroup]=\"addEntityFormGroup\">\r\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n        <h2>Payment Options</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <div mat-dialog-content fxLayout=\"column\">\r\n        <div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"32px\">\r\n            <div fxLayout=\"column\">\r\n                <div>Pay by Invoice</div>\r\n                <mat-checkbox [checked]=\"buyInvoice\" (change)=\"onSelectBuyInvoice($event)\"></mat-checkbox>\r\n            </div>\r\n            <div fxLayout=\"column\">\r\n                <div>Credit Card / Alternative Payments</div>\r\n                <mat-checkbox [checked]=\"buyCard\" (change)=\"onSelectBuyCard($event)\"></mat-checkbox>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\r\n            Cancel\r\n        </button>\r\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || (!buyInvoice && !buyCard)\">\r\n            Checkout\r\n        </button>\r\n    </div>\r\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet PageLink = widgetContext.pageLink;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet assetProfileService = $injector.get(widgetContext.servicesMap.get('assetProfileService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\nlet stripeSecretKey;\r\nlet sessionId = '';\r\nlet bearerToken = '';\r\nlet projectID = entityId.id;\r\nlet customerId;\r\nlet customerStripeId;\r\nlet projectName = '';\r\nlet measurements;\r\nvar customer;\r\nif (widgetContext.currentUser.authority !== 'CUSTOMER_USER') {\r\n  customer = widgetContext.stateController.getStateParams().entityId;  \r\n} else {\r\n  customer = { entityType: \"CUSTOMER\", id: widgetContext.currentUser.customerId };\r\n}\r\nvar url = window.location.href;\r\n\r\n// Global variables for products\r\nlet productGeneral, productUltrasonic, productLoraWan;\r\n\r\n// Helper: get query parameter from URL\r\nfunction getQueryParam(param) {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  return urlParams.get(param);\r\n}\r\n\r\n// Provided function to get related sensors for a measurement (loraWan type)\r\nfunction getRelatedSensors(measurementId){\r\n    let deviceQuery = {\r\n      parameters: {\r\n        rootId: measurementId,\r\n        rootType: \"ASSET\",\r\n        direction: \"FROM\",\r\n        relationTypeGroup: \"COMMON\",\r\n        maxLevel: 1073741824,\r\n        fetchLastLevelOnly: true\r\n      },\r\n      relationType: \"Measurement\",\r\n      deviceTypes: [\"Room Sensor CO2\"]\r\n    }\r\n    return deviceService.findByQuery(deviceQuery);\r\n}\r\n\r\n// First, fetch all measurements for the project (assets of type \"Measurement\")\r\nlet assetSearchQuery = {\r\n  \"parameters\": {\r\n    \"rootId\": projectID,\r\n    \"rootType\": \"ASSET\",\r\n    \"direction\": \"FROM\",\r\n    \"relationTypeGroup\": \"COMMON\",\r\n    \"maxLevel\": 10,\r\n    \"fetchLastLevelOnly\": false\r\n  },\r\n  \"relationType\": \"Owns\",\r\n  \"assetTypes\": [\r\n    \"Measurement\"\r\n  ]\r\n};\r\n\r\nassetService.findByQuery(assetSearchQuery).subscribe(response => {\r\n  measurements = response;\r\n  console.log(\"measurements\", measurements);\r\n  const sessionIdFromUrl = getQueryParam('session_id');\r\n  if (sessionIdFromUrl) {\r\n    window.history.replaceState({}, document.title, window.location.pathname);\r\n    localStorage.removeItem('selectedProjectId');\r\n    checkPaymentStatus(sessionIdFromUrl, projectID);\r\n  } else {\r\n    initialize();\r\n  }\r\n});\r\n\r\n// Main initialization: fetch project info, check payment status and then fetch Products\r\nfunction initialize() {\r\n  // Get project info to obtain customer and project name\r\n  assetService.getAssetInfo(projectID).subscribe(info => {\r\n    customerId = info.customerId;\r\n    projectName = info.name || projectID;\r\n    checkSingleProjectStatus(projectID).then(result => {\r\n      if (result === 'paid') {\r\n        alert(\"The selected Project already has the generalReport activated.\");\r\n      } else if (result === 'openInvoice') {\r\n        alert(\"There is an open invoice for this Project. Please check your email inbox.\");\r\n      } else {\r\n        // Fetch stripe keys\r\n        attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n          customerStripeId = stripeId[0].value;\r\n          attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey'])\r\n            .subscribe(attribute => {\r\n              stripeSecretKey = attribute[0].value;\r\n              // Login to get bearer token for REST calls\r\n              fetch('https://cloud.pke-iot.expert/api/auth/login', {\r\n                method: 'POST',\r\n                headers: {\r\n                  'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                  \"username\": \"belimo.api@pke-iot.expert\",\r\n                  \"password\": \"vfx3cvr@VMJ3bxk3urg\"\r\n                })\r\n              })\r\n              .then(resp => resp.json())\r\n              .then(loginData => {\r\n                bearerToken = loginData.token;\r\n                // Query for Products from customer using a Contains relation.\r\n                const query = {\r\n                  parameters: {\r\n                    rootId: customerId.id,\r\n                    rootType: \"CUSTOMER\",\r\n                    direction: \"FROM\",\r\n                    relationTypeGroup: \"COMMON\",\r\n                    maxLevel: 1,\r\n                    fetchLastLevelOnly: false\r\n                  },\r\n                  relationType: \"Contains\",\r\n                  assetTypes: [\"Product\"]\r\n                };\r\n                return fetch('https://cloud.pke-iot.expert/api/assets', {\r\n                  method: 'POST',\r\n                  headers: {\r\n                    'accept': 'application/json',\r\n                    'Content-Type': 'application/json',\r\n                    'X-Authorization': 'Bearer ' + bearerToken\r\n                  },\r\n                  body: JSON.stringify(query)\r\n                });\r\n              })\r\n              .then(resp2 => resp2.json())\r\n              .then(assets => {\r\n                // Filter and assign products based on prodType.\r\n                let productFetches = assets.map(asset => {\r\n                  return new Promise((resolve) => {\r\n                    fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${asset.id.id}/values/attributes?keys=prodType,price_stripe_id`, {\r\n                      method: 'GET',\r\n                      headers: {\r\n                        'accept': 'application/json',\r\n                        'X-Authorization': 'Bearer ' + bearerToken\r\n                      }\r\n                    })\r\n                    .then(resp3 => resp3.json())\r\n                    .then(attributes => {\r\n                      if (attributes && attributes.length > 0) {\r\n                        let prodTypeAttr = attributes.find(a => a.key === 'prodType');\r\n                        // Depending on prodType assign to the proper product variable\r\n                        if (prodTypeAttr) {\r\n                          if (prodTypeAttr.value === 'generalReport') {\r\n                            productGeneral = asset;\r\n                          } else if (prodTypeAttr.value === 'detailReportUltrasonic') {\r\n                            productUltrasonic = asset;\r\n                          } else if (prodTypeAttr.value === 'detailReportLoraWan') {\r\n                            productLoraWan = asset;\r\n                          }\r\n                        }\r\n                      }\r\n                      resolve();\r\n                    })\r\n                    .catch(err => {\r\n                      console.error(\"Error fetching product attributes:\", err);\r\n                      resolve();\r\n                    });\r\n                  });\r\n                });\r\n                Promise.all(productFetches).then(() => {\r\n                  if (!productGeneral) {\r\n                    alert(\"General Report product not found.\");\r\n                    return;\r\n                  }\r\n                  // Now open the dialog for checkout\r\n                  openAddEntityDialog();\r\n                });\r\n              })\r\n              .catch(error => {\r\n                console.error(\"Error fetching products:\", error);\r\n                alert('Failed to fetch products. Please try again.');\r\n              });\r\n            });\r\n        });\r\n      }\r\n    }).catch(err => {\r\n      console.error('Error checking project status:', err);\r\n      alert('Failed to check project status. Please try again.');\r\n    });\r\n  });\r\n}\r\n\r\nfunction openAddEntityDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n  let vm = instance;\r\n  // For display purposes we may show available products (optional)\r\n  vm.products = {\r\n    general: productGeneral,\r\n    ultrasonic: productUltrasonic,\r\n    loraWan: productLoraWan\r\n  };\r\n  vm.buyInvoice = false;\r\n  vm.buyCard = false;\r\n  vm.addEntityFormGroup = vm.fb.group({});\r\n\r\n  vm.onSelectBuyInvoice = function(event) {\r\n    vm.buyInvoice = event.checked;\r\n    if (vm.buyInvoice) {\r\n      vm.buyCard = false;\r\n    }\r\n  };\r\n\r\n  vm.onSelectBuyCard = function(event) {\r\n    vm.buyCard = event.checked;\r\n    if (vm.buyCard) {\r\n      vm.buyInvoice = false;\r\n    }\r\n  };\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n\r\n  // When checking out, fetch price details for each product and compute totals for measurements.\r\n  vm.checkout = function () {\r\n    if (!productGeneral) {\r\n      alert(\"No General Report product found.\");\r\n      vm.dialogRef.close(null);\r\n      return;\r\n    }\r\n    // Helper: fetch price data for a given product asset.\r\n    function fetchPriceData(product) {\r\n      return new Promise((resolve, reject) => {\r\n        if (!product) {\r\n          return resolve(null);\r\n        }\r\n        fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${product.id.id}/values/attributes?keys=price_stripe_id`, {\r\n          method: 'GET',\r\n          headers: {\r\n            'accept': 'application/json',\r\n            'X-Authorization': 'Bearer ' + bearerToken\r\n          }\r\n        })\r\n        .then(resp => resp.json())\r\n        .then(attributes => {\r\n          let priceIdObj = attributes.find(attr => attr.key === 'price_stripe_id');\r\n          if (priceIdObj) {\r\n            // Fetch the price details from Stripe\r\n            fetch(`https://api.stripe.com/v1/prices/${priceIdObj.value}`, {\r\n              method: 'GET',\r\n              headers: {\r\n                'Authorization': `Bearer ${stripeSecretKey}`\r\n              }\r\n            })\r\n            .then(resp2 => {\r\n              if (!resp2.ok) {\r\n                throw new Error(resp2.statusText);\r\n              }\r\n              return resp2.json();\r\n            })\r\n            .then(priceData => {\r\n              resolve(priceData);\r\n            })\r\n            .catch(err => {\r\n              console.error(\"Error fetching Stripe price:\", err);\r\n              reject(err);\r\n            });\r\n          } else {\r\n            reject(\"Price ID not found for product \" + product.id.id);\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.error(\"Error fetching price_stripe_id:\", err);\r\n          reject(err);\r\n        });\r\n      });\r\n    }\r\n\r\n    Promise.all([\r\n      fetchPriceData(productGeneral),\r\n      fetchPriceData(productUltrasonic),\r\n      fetchPriceData(productLoraWan)\r\n    ]).then(([generalPriceData, ultrasonicPriceData, loraWanPriceData]) => {\r\n      if (vm.buyInvoice) {\r\n        createInvoiceForOneTimePurchase(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance);\r\n      } else if (vm.buyCard) {\r\n        createCheckoutSession(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance);\r\n      } else {\r\n        alert(\"Please select a payment method.\");\r\n      }\r\n    }).catch(err => {\r\n      console.error(\"Error fetching price data:\", err);\r\n      vm.dialogRef.close(null);\r\n    });\r\n  };\r\n}\r\n\r\n// Helper: Compute measurement totals and return an object:\r\n// { ultrasonicCount, loraWanSensorCount, includedMeasurements }\r\n// Only include a measurement if its detailReport attribute is not true,\r\n// its progress attribute is not \"aborted\", and for loraWan measurements only if there is at least one sensor.\r\nfunction computeMeasurementTotals() {\r\n  let ultrasonicCount = 0;\r\n  let loraWanSensorCount = 0;\r\n  let includedMeasurements = [];\r\n  let promises = measurements.map(meas => {\r\n    return new Promise((resolve) => {\r\n      attributeService.getEntityAttributes(\r\n        { entityType: 'ASSET', id: meas.id.id },\r\n        \"SERVER_SCOPE\",\r\n        ['measurementType', 'detailReport', 'progress']\r\n      ).subscribe(attrs => {\r\n        let measurementTypeVal = null;\r\n        let detailReportVal = false;\r\n        let progressVal = null;\r\n        attrs.forEach(a => {\r\n          if (a.key === 'measurementType') {\r\n            measurementTypeVal = a.value;\r\n          }\r\n          if (a.key === 'detailReport') {\r\n            detailReportVal = a.value;\r\n          }\r\n          if (a.key === 'progress') {\r\n            progressVal = a.value;\r\n          }\r\n        });\r\n        // Skip measurement if detailReport is true or progress is \"aborted\"\r\n        if (detailReportVal === true || detailReportVal === \"true\" ||\r\n            (progressVal && progressVal.toLowerCase() === \"aborted\")) {\r\n          return resolve();\r\n        }\r\n        if (measurementTypeVal === \"ultrasonic\") {\r\n          ultrasonicCount += 1;\r\n          includedMeasurements.push(meas.id.id);\r\n          return resolve();\r\n        } else if (measurementTypeVal === \"loraWan\") {\r\n          // For loraWan, fetch related sensors and only include if sensors exist.\r\n          getRelatedSensors(meas.id.id).subscribe(response => {\r\n            if (Array.isArray(response) && response.length > 0) {\r\n              loraWanSensorCount += response.length;\r\n              includedMeasurements.push(meas.id.id);\r\n            }\r\n            resolve();\r\n          }, err => {\r\n            console.error(\"Error fetching related sensors:\", err);\r\n            resolve();\r\n          });\r\n        } else {\r\n          resolve();\r\n        }\r\n      }, err => {\r\n        console.error(\"Error fetching measurement attributes:\", err);\r\n        resolve();\r\n      });\r\n    });\r\n  });\r\n  return Promise.all(promises).then(() => ({ ultrasonicCount, loraWanSensorCount, includedMeasurements }));\r\n}\r\n\r\n// Helper: Update a set of measurements with a given attribute key/value.\r\nfunction updateMeasurementsAttributes(attributeKey, attributeValue, measurementIds) {\r\n  measurementIds.forEach(id => {\r\n    attributeService.saveEntityAttributes(\r\n      { entityType: 'ASSET', id: id },\r\n      \"SERVER_SCOPE\",\r\n      [{ key: attributeKey, value: attributeValue }]\r\n    ).subscribe(\r\n      () => { console.log(`Updated measurement ${id} with ${attributeKey}`); },\r\n      (error) => { console.error(`Error updating measurement ${id} with ${attributeKey}:`, error); }\r\n    );\r\n  });\r\n}\r\n\r\n// Create invoice for one-time purchase for project and measurements\r\nasync function createInvoiceForOneTimePurchase(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance) {\r\n  try {\r\n    // Compute measurement totals and obtain the list of measurement IDs to update.\r\n    const { ultrasonicCount, loraWanSensorCount, includedMeasurements } = await computeMeasurementTotals();\r\n    // Create a draft invoice first\r\n    let invoiceBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      auto_advance: 'false',\r\n      collection_method: 'send_invoice',\r\n      days_until_due: '14'\r\n    });\r\n    const invoiceResp = await fetch('https://api.stripe.com/v1/invoices', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceBody\r\n    });\r\n    if (!invoiceResp.ok) {\r\n      throw new Error(`Error creating draft invoice: ${invoiceResp.statusText}`);\r\n    }\r\n    const invoiceData = await invoiceResp.json();\r\n    \r\n    // Create invoice item for Project Report (generalReport)\r\n    let invoiceItemBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      invoice: invoiceData.id,\r\n      amount: String(generalPriceData.unit_amount),\r\n      currency: generalPriceData.currency,\r\n      description: `Project Report for: ${projectName}`\r\n    });\r\n    let invoiceItemResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceItemBody\r\n    });\r\n    if (!invoiceItemResp.ok) {\r\n      throw new Error(`Error creating invoice item for project: ${invoiceItemResp.statusText}`);\r\n    }\r\n    await invoiceItemResp.json();\r\n    \r\n    // If there are ultrasonic measurements, add invoice item\r\n    if (ultrasonicCount > 0 && ultrasonicPriceData) {\r\n      let ultrasonicAmount = ultrasonicPriceData.unit_amount * ultrasonicCount;\r\n      let ultrasonicItemBody = new URLSearchParams({\r\n        customer: customerStripeId,\r\n        invoice: invoiceData.id,\r\n        amount: String(ultrasonicAmount),\r\n        currency: ultrasonicPriceData.currency,\r\n        description: `Ultrasonic Measurements (${ultrasonicCount} unit(s))`\r\n      });\r\n      let ultrasonicResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`,\r\n          'Content-Type': 'application/x-www-form-urlencoded'\r\n        },\r\n        body: ultrasonicItemBody\r\n      });\r\n      if (!ultrasonicResp.ok) {\r\n        throw new Error(`Error creating invoice item for ultrasonic measurements: ${ultrasonicResp.statusText}`);\r\n      }\r\n      await ultrasonicResp.json();\r\n    }\r\n    \r\n    // If there are loraWan measurements, add invoice item\r\n    if (loraWanSensorCount > 0 && loraWanPriceData) {\r\n      let loraWanAmount = loraWanPriceData.unit_amount * loraWanSensorCount;\r\n      let loraWanItemBody = new URLSearchParams({\r\n        customer: customerStripeId,\r\n        invoice: invoiceData.id,\r\n        amount: String(loraWanAmount),\r\n        currency: loraWanPriceData.currency,\r\n        description: `LoRaWAN Measurements (Total sensors: ${loraWanSensorCount})`\r\n      });\r\n      let loraWanResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`,\r\n          'Content-Type': 'application/x-www-form-urlencoded'\r\n        },\r\n        body: loraWanItemBody\r\n      });\r\n      if (!loraWanResp.ok) {\r\n        throw new Error(`Error creating invoice item for LoRaWAN measurements: ${loraWanResp.statusText}`);\r\n      }\r\n      await loraWanResp.json();\r\n    }\r\n    \r\n    // Finalize the invoice\r\n    const finalizeResp = await fetch(`https://api.stripe.com/v1/invoices/${invoiceData.id}/finalize`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!finalizeResp.ok) {\r\n      throw new Error(`Error finalizing invoice: ${finalizeResp.statusText}`);\r\n    }\r\n    await finalizeResp.json();\r\n    \r\n    // Save attributes for the project\r\n    const projectAttributes = [\r\n      { key: \"generalReport\", value: false },\r\n      { key: \"invoiceId\", value: invoiceData.id }\r\n    ];\r\n    attributeService.saveEntityAttributes(\r\n      { entityType: 'ASSET', id: projectID },\r\n      \"SERVER_SCOPE\",\r\n      projectAttributes\r\n    ).subscribe(\r\n      () => { console.log(\"Updated project with invoiceId\"); },\r\n      (error) => { console.error('Error updating project attribute:', error); }\r\n    );\r\n    // Also update each measurement that was included\r\n    updateMeasurementsAttributes(\"invoiceId\", invoiceData.id, includedMeasurements);\r\n    \r\n    alert(\"Invoice created and sent!\");\r\n    instance.dialogRef.close(null);\r\n  } catch (err) {\r\n    console.error(\"Error creating invoice:\", err);\r\n    alert(\"Failed to create invoice. Please try again.\");\r\n    instance.dialogRef.close(null);\r\n  }\r\n}\r\n\r\n// Create a Stripe Checkout session with multiple line items\r\nasync function createCheckoutSession(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance) {\r\n  try {\r\n    // Compute measurement totals and obtain the list of measurement IDs to update.\r\n    const { ultrasonicCount, loraWanSensorCount, includedMeasurements } = await computeMeasurementTotals();\r\n    const successUrl = url;\r\n    const cancelUrl = url;\r\n    // Build URLSearchParams for line items (Stripe expects line_items[0], line_items[1], etc.)\r\n    let bodyParams = new URLSearchParams({\r\n      'success_url': successUrl,\r\n      'cancel_url': cancelUrl,\r\n      'payment_method_types[]': 'card',\r\n      'mode': 'payment',\r\n      'customer': customerStripeId\r\n    });\r\n    // Line item for project report\r\n    bodyParams.append('line_items[0][price_data][currency]', generalPriceData.currency);\r\n    bodyParams.append('line_items[0][price_data][unit_amount]', String(generalPriceData.unit_amount));\r\n    bodyParams.append('line_items[0][price_data][product_data][name]', `Project Report for: ${projectName}`);\r\n    bodyParams.append('line_items[0][quantity]', '1');\r\n    \r\n    let index = 1;\r\n    // If ultrasonic measurements exist, add a line item\r\n    if (ultrasonicCount > 0 && ultrasonicPriceData) {\r\n      bodyParams.append(`line_items[${index}][price_data][currency]`, ultrasonicPriceData.currency);\r\n      bodyParams.append(`line_items[${index}][price_data][unit_amount]`, String(ultrasonicPriceData.unit_amount));\r\n      bodyParams.append(`line_items[${index}][price_data][product_data][name]`, `Ultrasonic Measurements (${ultrasonicCount} unit(s))`);\r\n      bodyParams.append(`line_items[${index}][quantity]`, String(ultrasonicCount));\r\n      index++;\r\n    }\r\n    // If loraWan measurements exist, add a line item\r\n    if (loraWanSensorCount > 0 && loraWanPriceData) {\r\n      bodyParams.append(`line_items[${index}][price_data][currency]`, loraWanPriceData.currency);\r\n      bodyParams.append(`line_items[${index}][price_data][unit_amount]`, String(loraWanPriceData.unit_amount));\r\n      bodyParams.append(`line_items[${index}][price_data][product_data][name]`, `LoRaWAN Measurements (Total sensors: ${loraWanSensorCount})`);\r\n      bodyParams.append(`line_items[${index}][quantity]`, String(loraWanSensorCount));\r\n      index++;\r\n    }\r\n    \r\n    const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: bodyParams\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.url) {\r\n      sessionId = data.id;\r\n      localStorage.setItem('sessionId', sessionId);\r\n      await new Promise((resolve, reject) => {\r\n        attributeService.saveEntityAttributes(\r\n          { entityType: 'ASSET', id: projectID },\r\n          \"SERVER_SCOPE\",\r\n          [{ key: \"sessionId\", value: sessionId }]\r\n        ).subscribe(\r\n          () => resolve(),\r\n          (error) => {\r\n            console.error('Error saving session ID attribute for project:', error);\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n      // Also update each measurement that was included\r\n      updateMeasurementsAttributes(\"sessionId\", sessionId, includedMeasurements);\r\n      \r\n      instance.dialogRef.close(null);\r\n      window.location.href = data.url;\r\n    } else {\r\n      console.error('Checkout session URL not found in response');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating checkout session:', error);\r\n  }\r\n}\r\n\r\nasync function checkPaymentStatus(sessionId, entityId) {\r\n  try {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      await fetchStripeKeysAndCustomerId();\r\n    }\r\n    const response = await fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.payment_status === 'paid') {\r\n      alert('Payment completed successfully!');\r\n      const attributes = [\r\n        { key: \"generalReport\", value: true }\r\n      ];\r\n      attributeService.saveEntityAttributes(\r\n        { entityType: 'ASSET', id: projectID },\r\n        \"SERVER_SCOPE\",\r\n        attributes\r\n      ).subscribe(\r\n        () => {},\r\n        (error) => {\r\n          console.error('Error saving generalReport attribute:', error);\r\n        }\r\n      );\r\n      return 'paid';\r\n    } else {\r\n      alert('Payment was not successful. Please try again.');\r\n      return data.payment_status;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking payment status:', error);\r\n    return 'error';\r\n  }\r\n}\r\n\r\nasync function fetchStripeKeysAndCustomerId() {\r\n  return new Promise((resolve, reject) => {\r\n    assetService.getAssetInfo(projectID).subscribe(info => {\r\n      customerId = info.customerId;\r\n      projectName = info.name || projectID;\r\n      attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n        customerStripeId = stripeId[0].value;\r\n        attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey']).subscribe(attribute => {\r\n          stripeSecretKey = attribute[0].value;\r\n          resolve();\r\n        }, reject);\r\n      }, reject);\r\n    }, reject);\r\n  });\r\n}\r\n\r\nfunction checkSingleProjectStatus(mId) {\r\n  return new Promise((resolve, reject) => {\r\n    attributeService.getEntityAttributes(\r\n      { entityType: 'ASSET', id: mId },\r\n      \"SERVER_SCOPE\",\r\n      ['generalReport','invoiceId','sessionId']\r\n    ).subscribe(attrs => {\r\n      let generalReportVal = false;\r\n      let invoiceIdVal = null;\r\n      let sessionIdVal = null;\r\n      attrs.forEach(a => {\r\n        if (a.key === 'generalReport') generalReportVal = a.value;\r\n        if (a.key === 'invoiceId') invoiceIdVal = a.value;\r\n        if (a.key === 'sessionId') sessionIdVal = a.value;\r\n      });\r\n      if (generalReportVal === true) {\r\n        resolve(\"paid\");\r\n      } else {\r\n        if (sessionIdVal) {\r\n          checkStripeSessionPaid(sessionIdVal).then(isSessionPaid => {\r\n            if (isSessionPaid) {\r\n              resolve(\"paid\");\r\n            } else if (invoiceIdVal) {\r\n              checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n                if (invStatus === 'paid') resolve(\"paid\");\r\n                else if (invStatus === 'open') resolve(\"openInvoice\");\r\n                else resolve(\"unpaid\");\r\n              }).catch(() => reject());\r\n            } else {\r\n              resolve(\"unpaid\");\r\n            }\r\n          }).catch(() => reject());\r\n        } else if (invoiceIdVal) {\r\n          checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n            if (invStatus === 'paid') resolve(\"paid\");\r\n            else if (invStatus === 'open') resolve(\"openInvoice\");\r\n            else resolve(\"unpaid\");\r\n          }).catch(() => reject());\r\n        } else {\r\n          resolve(\"unpaid\");\r\n        }\r\n      }\r\n    }, err => reject(err));\r\n  });\r\n}\r\n\r\nfunction checkStripeSessionPaid(sid) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sid}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.payment_status === 'paid') resolve(true);\r\n        else resolve(false);\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n\r\nfunction checkStripeInvoice(invoiceIdVal) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceIdVal}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.status === 'paid') {\r\n          resolve('paid');\r\n        } else if (d.status === 'open' || d.status === 'draft') {\r\n          resolve('open');\r\n        } else {\r\n          resolve(d.status);\r\n        }\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "445b7fcb-c70d-0c5b-fc7b-1c68bbe7d01f"
              },
              {
                "name": "Open Measurements",
                "icon": "straighten",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "var userRole = widgetContext.stateController.getStateParams().userRole;\r\n\r\n//console.log(\"user role:\", userRole);\r\n        \r\nif (userRole === 'Belimo Retrofit Users') {\r\n    return false;\r\n} else {\r\n/*    console.log(\"hello\");*/\r\n    return true;\r\n}\r\n    \r\n    /*return (userRoleValue !== 'Belimo Retrofit Users');*/",
                "type": "openDashboardState",
                "targetDashboardStateId": "all_measurements",
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "71c478b6-a4b1-e569-e99a-85d5562cc721"
              },
              {
                "name": "Edit Project",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"editEntityFormGroup\"\n      (ngSubmit)=\"save()\" \n      class=\"edit-entity-form\">\n    \n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>Edit Project {{entityName}}</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n    <div mat-dialog-content fxLayout=\"column\">\n        <div fxLayout=\"row\"\n             fxLayoutGap=\"8px\"\n             fxLayout.xs=\"column\"\n             fxLayoutGap.xs=\"0\">\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>Project ID</mat-label>\n                <input matInput \n                       formControlName=\"entityName\" \n                       required readonly>\n            </mat-form-field>\n\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>Project Name</mat-label>\n                <input matInput \n                       formControlName=\"entityLabel\">\n            </mat-form-field>\n        </div>\n\n        <div formGroupName=\"attributes\">\n            <div fxLayout=\"row\"\n                 fxLayout.xs=\"column\"\n                 fxLayoutGap.xs=\"0\">\n                <mat-form-field fxFlex class=\"mat-block\">\n                    <mat-label>Address</mat-label>\n                    <input matInput \n                           formControlName=\"address\">\n                </mat-form-field>\n            </div>\n\n            <div fxLayout=\"row\"\n                 fxLayoutGap=\"8px\"\n                 fxLayout.xs=\"column\"\n                 fxLayoutGap.xs=\"0\">\n                <mat-form-field fxFlex class=\"mat-block\">\n                    <mat-label>Latitude</mat-label>\n                    <input type=\"number\" \n                           step=\"any\" \n                           matInput \n                           formControlName=\"latitude\">\n                </mat-form-field>\n\n                <mat-form-field fxFlex class=\"mat-block\">\n                    <mat-label>Longitude</mat-label>\n                    <input type=\"number\"\n                           step=\"any\"\n                           matInput\n                           formControlName=\"longitude\">\n                </mat-form-field>\n            </div>\n\n            <div fxLayout=\"row\"\n                 fxLayoutGap=\"8px\"\n                 fxLayout.xs=\"column\"\n                 fxLayoutGap.xs=\"0\">\n                <mat-form-field fxFlex class=\"mat-block\">\n                    <mat-label>Progress</mat-label>\n                    <mat-select formControlName=\"progress\">\n                        <mat-option value=\"in preparation\">in preparation</mat-option>\n                        <mat-option value=\"active\">active</mat-option>\n                        <mat-option value=\"finished\">finished</mat-option>\n                    </mat-select>\n                </mat-form-field>\n            </div>\n        </div>\n    </div>\n\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n        <button mat-button\n                color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"cancel()\"\n                cdkFocusInitial>\n            Cancel\n        </button>\n        <button mat-button\n                mat-raised-button\n                color=\"primary\"\n                type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || editEntityFormGroup.invalid\">\n            Save\n        </button>\n    </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenEditEntityDialog();\n\nfunction openEditEntityDialog() {\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n}\n\nfunction EditEntityDialogController(instance) {\n    let vm = instance;\n    vm.entityName = entityName; \n    vm.entityType = entityId.entityType;\n    vm.attributes = {};\n    vm.entity = {};\n\n    vm.editEntityFormGroup = vm.fb.group({\n        entityName: ['', [vm.validators.required]],\n        entityLabel: [null],\n        attributes: vm.fb.group({\n            address: [null],\n            latitude: [null],\n            longitude: [null],\n            progress: [null]\n        })\n    });\n\n    getEntityInfo();\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.save = function() {\n        vm.editEntityFormGroup.markAsPristine();\n        widgetContext.rxjs.forkJoin([\n            saveAttributes(entityId),\n            saveEntity()\n        ]).subscribe(() => {\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n        });\n    };\n\n    function getEntityInfo() {\n        widgetContext.rxjs.forkJoin([\n            attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE'),\n            entityService.getEntity(entityId.entityType, entityId.id)\n        ]).subscribe(([attrData, entityData]) => {\n            vm.attributes = {};\n            for (let i = 0; i < attrData.length; i++) {\n                vm.attributes[attrData[i].key] = attrData[i].value;\n            }\n\n            vm.entity = entityData;\n\n            vm.editEntityFormGroup.patchValue({\n                entityName: vm.entity.name,\n                entityLabel: vm.entity.label,\n                attributes: {\n                    address: vm.attributes.address,\n                    latitude: vm.attributes.latitude,\n                    longitude: vm.attributes.longitude,\n                    progress: vm.attributes.progress\n                }\n            }, { emitEvent: false });\n        });\n    }\n\n    function saveEntity() {\n        const formValues = vm.editEntityFormGroup.value;\n        vm.entity.name = formValues.entityName;\n        vm.entity.label = formValues.entityLabel;\n\n        if (vm.entityType === 'ASSET') {\n            return assetService.saveAsset(vm.entity);\n        } else if (vm.entityType === 'DEVICE') {\n            return deviceService.saveDevice(vm.entity);\n        }\n        return widgetContext.rxjs.of([]);\n    }\n\n    function saveAttributes(entityId) {\n        const currentAttributes = vm.attributes;\n        const updatedAttributes = vm.editEntityFormGroup.value.attributes;\n        \n        let attributesArray = [];\n        for (let key in updatedAttributes) {\n            if (updatedAttributes.hasOwnProperty(key)) {\n                if (updatedAttributes[key] !== currentAttributes[key]) {\n                    attributesArray.push({ key: key, value: updatedAttributes[key] });\n                }\n            }\n        }\n\n        if (attributesArray.length > 0) {\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n        }\n        return widgetContext.rxjs.of([]);\n    }\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9dea6b62-3ef6-b94f-a46b-bee18c6842a4"
              },
              {
                "name": "Delete Project",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\r\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\r\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\n\r\nlet projectEntityId = entityId.id;\r\nlet customerId;\r\n\r\nlet customerName = widgetContext.stateController.getStateParams().entityName;\r\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n        customerId = widgetContext.stateController.getStateParams().entityId;\r\n    } else {\r\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\r\n    }\r\n\r\n\r\nlet assetSearchQuery = {\r\n  \"parameters\": {\r\n    \"rootId\": projectEntityId,\r\n    \"rootType\": \"ASSET\",\r\n    \"direction\": \"FROM\",\r\n    \"relationTypeGroup\": \"COMMON\",\r\n    \"maxLevel\": 10,\r\n    \"fetchLastLevelOnly\": false\r\n  },\r\n  \"relationType\": \"Owns\",\r\n  \"assetTypes\": [\r\n    \"Measurement\"\r\n  ]\r\n};\r\n\r\nlet doktorkitSearchQuery = {\r\n  \"parameters\": {\r\n    \"rootId\": projectEntityId,\r\n    \"rootType\": \"ASSET\",\r\n    \"direction\": \"FROM\",\r\n    \"relationTypeGroup\": \"COMMON\",\r\n    \"maxLevel\": 10,\r\n    \"fetchLastLevelOnly\": false\r\n  },\r\n  \"relationType\": \"Owns\",\r\n  \"assetTypes\": [\r\n    \"Doktorkit\"\r\n  ]\r\n};\r\n\r\nassetService.findByQuery(assetSearchQuery).subscribe(measurements => {\r\n    assetService.findByQuery(doktorkitSearchQuery).subscribe(doktorkits => {\r\n        openDeleteDoktorkitDialog(measurements, doktorkits);\r\n    })\r\n});\r\n\r\nfunction addKitToUnassignedDoktorkits(doktorkits) {\r\n    return getUnassignedKitGroup(customerId).pipe(\r\n        widgetContext.rxjs.switchMap((UnassignedKitGroup) => {\r\n            const addKitObservables = doktorkits.map((item) => {\r\n                \r\n                return entityGroupService.addEntityToEntityGroup(UnassignedKitGroup.id.id, item.id.id);\r\n            });\r\n            \r\n            return widgetContext.rxjs.forkJoin(addKitObservables);\r\n        })\r\n    );\r\n}\r\n\r\n\r\nfunction openDeleteDoktorkitDialog(measurements, doktorkits) {\r\n  var title = 'Are you sure you want to delete the Project ' + entityName + '?';\r\n  var content = 'Be careful, after the confirmation, the Project will be deleted including ' + measurements.length + ' measurements!';\r\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\r\n    function(result) {\r\n      if (result) {\r\n        deleteProject(measurements, doktorkits);\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nfunction deleteProject(measurements, doktorkits) {\r\n    addKitToUnassignedDoktorkits(doktorkits).subscribe();\r\n    deleteMeasurements(measurements);\r\n    assetService.deleteAsset(entityId.id).subscribe(\r\n        function() {\r\n            widgetContext.updateAliases();\r\n        }\r\n    );  \r\n}\r\n\r\nfunction deleteMeasurements(measurements) {\r\n    measurements.forEach(item => {\r\n        assetService.deleteAsset(item.id.id).subscribe(\r\n            function() {\r\n                widgetContext.updateAliases();\r\n            }\r\n        ); \r\n    })\r\n}\r\n\r\nfunction getUnassignedKitGroup(customerId) {\r\n  return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\r\n      widgetContext.rxjs.switchMap((entityGroups) => {\r\n          var UnassignedKitGroup = entityGroups.find(group => group.name === 'Unassigned Kit');\r\n          if (UnassignedKitGroup) {\r\n              return widgetContext.rxjs.of(UnassignedKitGroup);\r\n          } else {\r\n              UnassignedKitGroup = {\r\n                  type: 'ASSET',\r\n                  name: 'Unassigned Kit',\r\n                  ownerId: customerId\r\n              };\r\n              return entityGroupService.saveEntityGroup(UnassignedKitGroup);\r\n          }\r\n      })\r\n  );\r\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "338d9fd7-c752-eb0e-4687-2c2e32ca1a32"
              }
            ],
            "headerButton": [
              {
                "name": "Go back",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "arrow_back",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\nvar number = (widgetContext.stateController.getStateIndex())-1;\r\n\r\nparams['selectedProject'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\r\nwidgetContext.stateController.updateState(null,params);\r\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2a3709d3-3316-640a-1941-e403a03b2c70"
              },
              {
                "name": "Add Project",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "add",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px;\">\n  <mat-toolbar class=\"flex items-center\" color=\"primary\">\n    <mat-icon style=\"margin-right: 12px;\">folder_open</mat-icon>\n    <h2 style=\"margin: 0; font-size: 18px;\">Add Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col gap-2 p-4\">\n    <tb-image-input formControlName=\"projectPicture\"\n                    label=\"Project Picture\"\n                    noImageText=\"No picture selected\">\n    </tb-image-input>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project ID</mat-label>\n        <input matInput formControlName=\"name\" required readonly>\n        <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">\n          Project title is required.\n        </mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Label</mat-label>\n        <input matInput formControlName=\"entityLabel\">\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project address</mat-label>\n        <input matInput formControlName=\"address\" required autocomplete=\"off\" (input)=\"onAddressInput()\">\n        <button mat-icon-button matSuffix type=\"button\" aria-label=\"Search address\" (click)=\"searchAddress()\">\n            <mat-icon>search</mat-icon>\n        </button>\n        <mat-error *ngIf=\"addProjectFormGroup.get('address').hasError('required')\">\n          Address is required.\n        </mat-error>\n    </mat-form-field>\n    <mat-progress-bar *ngIf=\"addressSearchLoading\" mode=\"indeterminate\" color=\"accent\"></mat-progress-bar>\n    <mat-selection-list *ngIf=\"addressResults.length > 0\" [multiple]=\"false\" (selectionChange)=\"selectAddress($event)\">\n        <mat-list-option *ngFor=\"let result of addressResults\" [value]=\"result\">\n            {{ result.display_name }}\n        </mat-list-option>\n    </mat-selection-list>\n    <div class=\"flex gap-2\">\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n          <mat-label>Postcode</mat-label>\n          <input matInput formControlName=\"postcode\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n          <mat-label>City</mat-label>\n          <input matInput formControlName=\"city\">\n      </mat-form-field>\n    </div>\n    <div class=\"flex gap-2\">\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n          <mat-label>Latitude</mat-label>\n          <input matInput formControlName=\"latitude\" type=\"number\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n          <mat-label>Longitude</mat-label>\n          <input matInput formControlName=\"longitude\" type=\"number\">\n      </mat-form-field>\n    </div>\n  </div>\n  <div class=\"flex justify-end items-center gap-2 p-4\"\n       style=\"border-top: 1px solid #e0e0e0; background: #fafafa;\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"addProjectFormGroup.pristine || !addProjectFormGroup.valid\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\n//let $scope = widgetContext.$scope;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet customerId;\nlet shortNameAttr;\nlet customerShortName;\nlet nextProjectId = 0;\n\nlet customerName = widgetContext.stateController.getStateParams().entityName;\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n/*console.log(customerId.id);*/\n\nlet assetSearchQuery = {\n  \"parameters\": {\n    \"rootId\": customerId.id,\n    \"rootType\": \"CUSTOMER\",\n    \"direction\": \"FROM\",\n    \"relationTypeGroup\": \"COMMON\",\n    \"maxLevel\": 10,\n    \"fetchLastLevelOnly\": false\n  },\n  \"relationType\": \"Owns\",\n  \"assetTypes\": [\n    \"Project\"\n  ]\n};\nassetService.findByQuery(assetSearchQuery).subscribe(projects => {\n    /*console.log(projects);*/\n    nextProjectId = getLastProjectId(projects);\n    /*console.log(nextProjectId);*/\n    attributeService.getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName']).subscribe(attributes => {\n        shortNameAttr = attributes.find(attr => attr.key === 'shortName');\n        customerShortName = shortNameAttr ? shortNameAttr.value : customerName;\n        openAddProjectDialog();\n    });\n});\n\nfunction getLastProjectId(projects) {\n    let maxNumber = 0;\n    projects.forEach(item => {\n        const name = item.name;\n        const parts = name.split('_');\n        if (parts.length === 2) {\n            const number = parseInt(parts[1], 10);\n            if (number > maxNumber) {\n                maxNumber = number;\n            }\n        }\n    });\n    const nextProjectId = maxNumber + 1;\n    return nextProjectId;\n}\n\nfunction openAddProjectDialog() {\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\n}\n\nfunction AddProjectDialogController(instance) {\n  let vm = instance;\n\n  vm.addProjectFormGroup = vm.fb.group({\n    name: [customerShortName + \"_\" + nextProjectId, [vm.validators.required]],\n    entityLabel: [''],\n    address: [''],\n    postcode: [''],\n    city: [''],\n    latitude:[''],\n    longitude:[''],\n    projectPicture: ['']\n  });\n  \n  vm.addressResults = [];\n  vm.addressSearchLoading = false;\n  \n  vm.onAddressInput = function () {\n    vm.addressResults = [];\n  };\n  \n  vm.triggerAddressSearch = function () {\n    const query = vm.addProjectFormGroup.get('address').value;\n    const postcode = vm.addProjectFormGroup.get('postcode').value;\n    const city = vm.addProjectFormGroup.get('city').value;\n    \n    if (!query || query.length < 5) {\n      return;\n    }\n    \n    vm.addressSearchLoading = true;\n    \n    let searchQuery = query;\n    if (city) {\n      searchQuery += ', ' + city;\n    }\n    if (postcode) {\n      searchQuery += ', ' + postcode;\n    }\n    \n    const params = {\n      q: searchQuery,\n      format: 'json',\n      addressdetails: 1,\n      limit: 6\n    };\n    \n    if (postcode) {\n      params.postalcode = postcode;\n    }\n    \n    fetch(\n      'https://nominatim.openstreetmap.org/search?' +\n      new URLSearchParams(params)\n    )\n    .then(r => r.json())\n    .then(data => {\n      vm.addressResults = data;\n      vm.addressSearchLoading = false;\n    })\n    .catch(() => {\n      vm.addressSearchLoading = false;\n    });\n  };\n  \n  vm.selectAddress = function (item) {\n    const a = item.address || {};\n    const street = [a.road, a.house_number].filter(Boolean).join(' ');\n    const postcode = a.postcode || '';\n    const city = a.city || a.town || a.village || '';\n    \n    vm.addProjectFormGroup.patchValue({\n      address: street,\n      postcode: postcode,\n      city: city,\n      latitude: parseFloat(item.lat),\n      longitude: parseFloat(item.lon)\n    });\n    \n    vm.addressResults = [];\n    vm.addProjectFormGroup.markAsDirty();\n  };\n  \n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    vm.addProjectFormGroup.markAsPristine();\n    saveProjectObservable(customerId).subscribe(\n      function (Project) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToProjectRelation(customerId, Project.id),\n              saveAttributes(Project.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedProject = params['selectedProject'];\n                params['selectedProject'] = { entityId: Project.id, entityName: Project.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveProjectObservable(customerId) {\n    return getProjectsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((ProjectsGroup) => {\n            const formValues = vm.addProjectFormGroup.value;\n            let Project = {\n              name: formValues.name,\n              type: 'Project',\n              label: formValues.entityLabel,\n              customerId: customerId\n            };\n            return assetService.saveAsset(Project, ProjectsGroup.id.id)\n        })\n    );\n  }\n  \n  function getProjectsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\n              if (ProjectsGroup) {\n                  return widgetContext.rxjs.of(ProjectsGroup);\n              } else {\n                  ProjectsGroup = {\n                      type: 'ASSET',\n                      name: 'Projects',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(ProjectsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToProjectRelation(customerId, ProjectId) {\n      var relation = {\n          from: customerId,\n          to: ProjectId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'address',\n            value: vm.addProjectFormGroup.value.address\n        },\n        {\n            key: 'postcode',\n            value: vm.addProjectFormGroup.value.postcode || ''\n        },\n        {\n            key: 'city',\n            value: vm.addProjectFormGroup.value.city || ''\n        },\n        {\n            key: 'latitude',\n            value: vm.addProjectFormGroup.value.latitude || 48.1406022\n        },\n        {\n            key: 'longitude',\n            value: vm.addProjectFormGroup.value.longitude || 16.2932688\n        },\n        {\n            key: 'progress',\n            value: 'in preparation'\n        },\n        {\n            key: 'units',\n            value: 'metric'\n        },\n        {\n            key: 'projectPicture',\n            value: vm.addProjectFormGroup.value.projectPicture || ''\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e965b8a1-a6ac-5ae4-fd79-2b7220b91ed1"
              }
            ],
            "rowDoubleClick": [
              {
                "name": "Select Project",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4b22749d-c403-459d-3a3e-3b60d9b72dd7"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "pageSize": 1024,
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "titleIcon": null,
          "iconColor": null,
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "62bee3d4-61ba-6a86-0a99-a34e46518cff",
        "typeFullFqn": "system.cards.entities_table"
      },
      "a5b8a12b-275c-986c-6a8c-6550f4387837": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.measurement-admin.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": true,
            "entityNameColumnTitle": "Measurement ID",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Measurements",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b0061bd7-595f-a375-e74c-115b41049852",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "{i18n:custom.measurement.administration.action.measurement-alias}",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.7448728411727017,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.measurement.administration.action.address.title}",
                  "color": "#2196f3",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "20%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.1345774127559587,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "{i18n:custom.measurement.administration.action.measurement-type.title}",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.21730513453136835,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-progress.title}",
                  "color": "#607d8b",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar description;\r\nvar state = value;\r\nif (state == 'active') { // all key values here are strings\r\n  color = '#f3de61'; // Yellow\r\n  description = '{i18n:custom.diagnostics.state-filter.active.title}';\r\n} else if (state == 'in preparation') {\r\n  /*color = '#005757';*/\r\n  /*color = '#eef30b';*/\r\n  color = '#CAC1D2';// Grey\r\n  description = '{i18n:custom.diagnostics.state-filter.preparation.title}';\r\n}\r\nelse {\r\n  color = '#27AE60';//Green\r\n  description = '{i18n:custom.diagnostics.state-filter.finished.title}';  \r\n}\r\n\r\n\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>' + ' ' + description;",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.9236747260323768,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "detailReport",
                  "type": "attribute",
                  "label": "{i18n:custom.measurement.administration.action.report.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar detailReport = value;\r\nvar status;\r\nif (detailReport == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n  status = '{i18n:custom.measurement.administration.report.paid}';\r\n} else {\r\n  color = '#EB5757';\r\n  status = '{i18n:custom.measurement.administration.report.inactive}';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>' + ' ' + status;",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.2251796052421664,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "{i18n:custom.measurement.administration.action.select-measurement}",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "{i18n:custom.measurement.administration.action.unlock-report}",
                "icon": "verified",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "/*var userRole = widgetContext.stateController.getStateParams().userRole;\nif(userRole !==\"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\"){\n    return true;\n}else{\n    return false;\n}*/\n\nreturn false;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" (ngSubmit)=\"checkout()\" class=\"add-entity-form\" [formGroup]=\"addEntityFormGroup\">\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>Payment Options</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n    <div mat-dialog-content fxLayout=\"column\">\n        <div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"32px\">\n            <div fxLayout=\"column\">\n                <div>{{ 'custom.measurement.administration.unlock-report.pay-by-invoice' | translate }}</div>\n                <mat-checkbox [checked]=\"buyInvoice\" (change)=\"onSelectBuyInvoice($event)\"></mat-checkbox>\n            </div>\n            <div fxLayout=\"column\">\n                <div>{{ 'custom.measurement.administration.unlock-report.credit-card.alternative-payments' | translate }}</div>\n                <mat-checkbox [checked]=\"buyCard\" (change)=\"onSelectBuyCard($event)\"></mat-checkbox>\n            </div>\n        </div>\n    </div>\n\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\"  cdkFocusInitial> {{ 'action.cancel' | translate }}</button>\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || (!buyInvoice && !buyCard)\">\n            {{ 'custom.measurement.administration.unlock-report.checkout' | translate }}\n        </button>\n    </div>\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let injector = widgetContext.$scope.$injector;\r\nlet PageLink = widgetContext.pageLink;\r\nlet customDialog = injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet deviceService = injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet attributeService = injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet assetProfileService = injector.get(widgetContext.servicesMap.get('assetProfileService'));\r\nlet customerService = injector.get(widgetContext.servicesMap.get('customerService'));\r\nlet translationService = injector.get(widgetContext.servicesMap.get('translate'));\r\n\r\n\r\nlet stripeSecretKey;\r\nlet sessionId = '';\r\nlet products = [];\r\nlet measurementId = entityId.id;\r\nlet customerId;\r\nlet customerStripeId;\r\nlet measurementName = '';\r\nlet bearerToken = '';\r\nlet sensors;\r\nlet measurementType; // new global variable to store measurement type\r\nvar url = window.location.href;\r\nvar customer;\r\nif (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n        /*customerId = widgetContext.stateController.getStateParams().entityId;*/\r\n        \r\n        assetService.getAsset(measurementId).subscribe(measurement => {\r\n            customer = measurement.customerId;\r\n        });\r\n    } else {\r\n        customer = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\r\n    }\r\n\r\nfunction getRelatedSensors(measurementId){\r\n    let deviceQuery = {\r\n      parameters: {\r\n        rootId: measurementId,\r\n        rootType: \"ASSET\",\r\n        direction: \"FROM\",\r\n        relationTypeGroup: \"COMMON\",\r\n        maxLevel: 1073741824,\r\n        fetchLastLevelOnly: true\r\n      },\r\n      relationType: \"Measurement\",\r\n      deviceTypes: [\"Room Sensor CO2\"]\r\n    }\r\n    return deviceService.findByQuery(deviceQuery);\r\n}\r\n\r\nfunction getQueryParam(param) {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  return urlParams.get(param);\r\n}\r\n\r\nconst sessionIdFromUrl = getQueryParam('session_id');\r\nif (sessionIdFromUrl) {\r\n  window.history.replaceState({}, document.title, window.location.pathname);\r\n  localStorage.removeItem('selectedmeasurementId');\r\n  checkPaymentStatus(sessionIdFromUrl, measurementId);\r\n} else {\r\n  initialize();\r\n}\r\n\r\nfunction initialize() {\r\n  // First, fetch the measurementType for our current project (entityId)\r\n  attributeService.getEntityAttributes(\r\n    { entityType: 'ASSET', id: measurementId },\r\n    \"SERVER_SCOPE\",\r\n    [\"measurementType\"]\r\n  ).subscribe(mtAttributes => {\r\n    let measurementTypeVal = (mtAttributes && mtAttributes.length && mtAttributes[0].value) ? mtAttributes[0].value : null;\r\n    measurementType = measurementTypeVal; // save measurement type globally\r\n\r\n    // Decide which prodType is needed based on measurementType\r\n    if (measurementTypeVal === \"ultrasonic\") {\r\n      requiredProdType = \"detailReportUltrasonic\";\r\n    } else if (measurementTypeVal === \"loraWan\") {\r\n      requiredProdType = \"detailReportLoraWan\";\r\n    } else {\r\n      requiredProdType = null; \r\n    }\r\n\r\n    // Retrieve standard project info to get customerId, etc.\r\n    assetService.getAssetInfo(measurementId).subscribe(info => {\r\n      customerId = info.customerId;\r\n      measurementName = info.name || measurementId;\r\n\r\n      checkSingleProjectStatus(measurementId).then(result => {\r\n        if (result === 'paid') {\r\n          alert(translationService.instant('custom.payment.alert.report-already-activated'));\r\n        } else if (result === 'openInvoice') {\r\n          alert(translationService.instant('custom.payment.alert.open-invoice'));\r\n        } else {\r\n          attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n            customerStripeId = stripeId[0].value;\r\n            attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey'])\r\n              .subscribe(attribute => {\r\n                stripeSecretKey = attribute[0].value;\r\n\r\n                // Login to fetch bearer token for further asset & attribute API calls\r\n                fetch('https://cloud.pke-iot.expert/api/auth/login', {\r\n                  method: 'POST',\r\n                  headers: {\r\n                    'Content-Type': 'application/json'\r\n                  },\r\n                  body: JSON.stringify({\r\n                    \"username\": \"belimo.api@pke-iot.expert\",\r\n                    \"password\": \"vfx3cvr@VMJ3bxk3urg\"\r\n                  })\r\n                })\r\n                .then(resp => resp.json())\r\n                .then(loginData => {\r\n                  bearerToken = loginData.token;\r\n\r\n                  // We'll fetch all potential \"Product\" assets via REST\r\n                  const query = {\r\n                    parameters: {\r\n                      rootId: customer.id,\r\n                      rootType: \"CUSTOMER\",\r\n                      direction: \"FROM\",\r\n                      relationTypeGroup: \"COMMON\",\r\n                      maxLevel: 1073741824,\r\n                      fetchLastLevelOnly: true\r\n                    },\r\n                    relationType: \"Contains\",\r\n                    assetTypes: [\"Product\"]\r\n                  };\r\n\r\n                  return fetch('https://cloud.pke-iot.expert/api/assets', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                      'accept': 'application/json',\r\n                      'Content-Type': 'application/json',\r\n                      'X-Authorization': 'Bearer ' + bearerToken\r\n                    },\r\n                    body: JSON.stringify(query)\r\n                  });\r\n                })\r\n                .then(resp2 => resp2.json())\r\n                .then(assets => {\r\n                  console.log(\"All fetched products:\", assets);\r\n                  let filteredProducts = [];\r\n                  let productFetches = assets.map(asset => {\r\n                    return new Promise((resolve) => {\r\n                      fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${asset.id.id}/values/attributes?keys=prodType`, {\r\n                        method: 'GET',\r\n                        headers: {\r\n                          'accept': 'application/json',\r\n                          'X-Authorization': 'Bearer ' + bearerToken\r\n                        }\r\n                      })\r\n                      .then(resp3 => resp3.json())\r\n                      .then(attributes => {\r\n                        // Filter by requiredProdType\r\n                        let prodTypeAttr = attributes.find(a => a.key === 'prodType');\r\n                        if (prodTypeAttr && prodTypeAttr.value === requiredProdType) {\r\n                          filteredProducts.push(asset);\r\n                        }\r\n                        resolve();\r\n                      })\r\n                      .catch(err => {\r\n                        console.error(\"Error fetching prodType:\", err);\r\n                        resolve();\r\n                      });\r\n                    });\r\n                  });\r\n                  Promise.all(productFetches).then(() => {\r\n                    console.log(\"Filtered products:\", filteredProducts);\r\n                    products = filteredProducts;\r\n                    openAddEntityDialog();\r\n                  });\r\n                })\r\n                .catch(error => {\r\n                  console.error(\"Error fetching products:\", error);\r\n                  alert(translationService.instant('custom.payment.alert.failed-to-fetch'));\r\n                });\r\n              });\r\n          });\r\n        }\r\n      }).catch(err => {\r\n        console.error('Error checking project status:', err);\r\n        alert(translationService.instant('custom.payment.alert.failed-to-check'));\r\n      });\r\n    });\r\n  }, error => {\r\n    console.error('Failed to fetch measurementType:', error);\r\n    alert(translationService.instant('custom.payment.alert.unable-to-determine'));\r\n  });\r\n}\r\n\r\nfunction openAddEntityDialog() {\r\n  getRelatedSensors(measurementId).subscribe(response =>{\r\n    sensors = response;\r\n    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n  });\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n  let vm = instance;\r\n  vm.products = products;\r\n  vm.buyInvoice = false;\r\n  vm.buyCard = false;\r\n\r\n  vm.addEntityFormGroup = vm.fb.group({});\r\n\r\n  vm.onSelectBuyInvoice = function(event) {\r\n    vm.buyInvoice = event.checked;\r\n    if (vm.buyInvoice) {\r\n      vm.buyCard = false;\r\n    }\r\n  };\r\n\r\n  vm.onSelectBuyCard = function(event) {\r\n    vm.buyCard = event.checked;\r\n    if (vm.buyCard) {\r\n      vm.buyInvoice = false;\r\n    }\r\n  };\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n\r\n  vm.checkout = function () {\r\n    if (!vm.products.length) {\r\n      alert(translationService.instant('custom.payment.alert.no-product-found'));\r\n      vm.dialogRef.close(null);\r\n      return;\r\n    }\r\n    // We'll just pick the first product from the filtered list\r\n    const productId = vm.products[0].id.id;\r\n\r\n    // Fetch price_stripe_id via REST\r\n    fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${productId}/values/attributes?keys=price_stripe_id`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'accept': 'application/json',\r\n        'X-Authorization': 'Bearer ' + bearerToken\r\n      }\r\n    })\r\n    .then(resp => resp.json())\r\n    .then(attributes => {\r\n      let priceIdObj = attributes.find(attr => attr.key === 'price_stripe_id');\r\n      if (priceIdObj) {\r\n        const priceId = priceIdObj.value;\r\n        if (vm.buyInvoice) {\r\n          createInvoiceForOneTimePurchase(priceId, instance);\r\n        } else if (vm.buyCard) {\r\n          createCheckoutSession(priceId, instance);\r\n        } else {\r\n          alert(translationService.instant('custom.payment.alert.payment.method'));\r\n        }\r\n      } else {\r\n        console.error('Price ID not found for the product.');\r\n        vm.dialogRef.close(null);\r\n      }\r\n    })\r\n    .catch(err => {\r\n      console.error('Error fetching price_stripe_id:', err);\r\n      vm.dialogRef.close(null);\r\n    });\r\n  };\r\n}\r\n\r\nasync function createInvoiceForOneTimePurchase(priceId, instance) {\r\n  try {\r\n    const priceResp = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResp.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResp.statusText}`);\r\n    }\r\n    const priceData = await priceResp.json();\r\n\r\n    // Determine sensor count multiplier (default to 1)\r\n    let sensorCount = 1;\r\n    if (measurementType === \"loraWan\" && Array.isArray(sensors)) {\r\n      sensorCount = sensors.length;\r\n    }\r\n\r\n    // Multiply unit_amount by sensor count if needed\r\n    const amount = priceData.unit_amount * sensorCount;\r\n    const currency = priceData.currency;\r\n\r\n    let invoiceBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      auto_advance: 'false',\r\n      collection_method: 'send_invoice',\r\n      days_until_due: '14'\r\n    });\r\n    const invoiceResp = await fetch('https://api.stripe.com/v1/invoices', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceBody\r\n    });\r\n    if (!invoiceResp.ok) {\r\n      throw new Error(`Error creating draft invoice: ${invoiceResp.statusText}`);\r\n    }\r\n    const invoiceData = await invoiceResp.json();\r\n\r\n    let invoiceItemBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      invoice: invoiceData.id,\r\n      amount: amount.toString(),\r\n      currency: currency,\r\n      description: `One-time purchase for project: ${measurementName} (x${sensorCount} sensors)`\r\n    });\r\n    const invoiceItemResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceItemBody\r\n    });\r\n    if (!invoiceItemResp.ok) {\r\n      throw new Error(`Error creating invoice item: ${invoiceItemResp.statusText}`);\r\n    }\r\n    await invoiceItemResp.json();\r\n\r\n    const finalizeResp = await fetch(`https://api.stripe.com/v1/invoices/${invoiceData.id}/finalize`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!finalizeResp.ok) {\r\n      throw new Error(`Error finalizing invoice: ${finalizeResp.statusText}`);\r\n    }\r\n    await finalizeResp.json();\r\n\r\n    const attributes = [\r\n      { key: \"generalReport\", value: false },\r\n      { key: \"invoiceId\", value: invoiceData.id }\r\n    ];\r\n    attributeService.saveEntityAttributes(\r\n      { entityType: 'ASSET', id: measurementId },\r\n      \"SERVER_SCOPE\",\r\n      attributes\r\n    ).subscribe(\r\n      () => {\r\n        alert(translationService.instant('custom.payment.alert.invoice-created-and-sent'));\r\n        instance.dialogRef.close(null);\r\n      },\r\n      (error) => {\r\n        console.error('Error updating attributes:', error);\r\n        instance.dialogRef.close(null);\r\n      }\r\n    );\r\n  } catch (err) {\r\n    console.error(\"Error creating invoice:\", err);\r\n    alert(translationService.instant('custom.payment.alert.failed-to-create-invoice'));\r\n    instance.dialogRef.close(null);\r\n  }\r\n}\r\n\r\nasync function createCheckoutSession(priceId, instance) {\r\n  try {\r\n    const priceResponse = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResponse.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResponse.statusText}`);\r\n    }\r\n    const priceData = await priceResponse.json();\r\n    const isRecurring = priceData.recurring !== null;\r\n    const mode = isRecurring ? 'subscription' : 'payment';\r\n    const successUrl = url;\r\n    const cancelUrl = url;\r\n\r\n    // Determine sensor count multiplier (default to 1)\r\n    let sensorCount = 1;\r\n    if (measurementType === \"loraWan\" && Array.isArray(sensors)) {\r\n      sensorCount = sensors.length;\r\n    }\r\n\r\n    const bodyParams = new URLSearchParams({\r\n      'success_url': successUrl,\r\n      'cancel_url': cancelUrl,\r\n      'payment_method_types[]': 'card',\r\n      'mode': mode,\r\n      'customer': customerStripeId\r\n    });\r\n    bodyParams.append('line_items[0][price_data][currency]', priceData.currency);\r\n    bodyParams.append('line_items[0][price_data][unit_amount]', String(priceData.unit_amount));\r\n    bodyParams.append('line_items[0][price_data][product_data][name]', `One-time purchase for: ${measurementName} (x${sensorCount} sensors)`);\r\n    bodyParams.append('line_items[0][quantity]', String(sensorCount));\r\n\r\n    const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: bodyParams\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.url) {\r\n      sessionId = data.id;\r\n      localStorage.setItem('sessionId', sessionId);\r\n      await new Promise((resolve, reject) => {\r\n        attributeService.saveEntityAttributes(\r\n          { entityType: 'ASSET', id: measurementId },\r\n          \"SERVER_SCOPE\",\r\n          [{ key: \"sessionId\", value: sessionId }]\r\n        ).subscribe(\r\n          () => resolve(),\r\n          (error) => {\r\n            console.error('Error saving session ID attribute:', error);\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n      instance.dialogRef.close(null);\r\n      window.location.href = data.url;\r\n    } else {\r\n      console.error('Checkout session URL not found in response');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating checkout session:', error);\r\n  }\r\n}\r\n\r\nasync function checkPaymentStatus(sessionId, entityId) {\r\n  try {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      await fetchStripeKeysAndCustomerId();\r\n    }\r\n    const response = await fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.payment_status === 'paid') {\r\n      alert(translationService.instant('custom.payment.alert.payment-completed-successfully'));\r\n      const attributes = [\r\n        { key: \"generalReport\", value: true }\r\n      ];\r\n      attributeService.saveEntityAttributes(\r\n        { entityType: 'ASSET', id: measurementId },\r\n        \"SERVER_SCOPE\",\r\n        attributes\r\n      ).subscribe(\r\n        () => {},\r\n        (error) => {\r\n          console.error('Error saving report attribute:', error);\r\n        }\r\n      );\r\n      return 'paid';\r\n    } else {\r\n      alert(translationService.instant('custom.payment.alert.payment-was-not-successful'));\r\n      return data.payment_status;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking payment status:', error);\r\n    return 'error';\r\n  }\r\n}\r\n\r\nasync function fetchStripeKeysAndCustomerId() {\r\n  return new Promise((resolve, reject) => {\r\n    assetService.getAssetInfo(measurementId).subscribe(info => {\r\n      customerId = info.customerId;\r\n      measurementName = info.name || measurementId;\r\n      attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n        customerStripeId = stripeId[0].value;\r\n        attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey']).subscribe(attribute => {\r\n          stripeSecretKey = attribute[0].value;\r\n          resolve();\r\n        }, reject);\r\n      }, reject);\r\n    }, reject);\r\n  });\r\n}\r\n\r\nfunction checkSingleProjectStatus(mId) {\r\n  return new Promise((resolve, reject) => {\r\n    attributeService.getEntityAttributes(\r\n      { entityType: 'ASSET', id: mId },\r\n      \"SERVER_SCOPE\",\r\n      ['generalReport','invoiceId','sessionId']\r\n    ).subscribe(attrs => {\r\n      let generalReportVal = false;\r\n      let invoiceIdVal = null;\r\n      let sessionIdVal = null;\r\n      attrs.forEach(a => {\r\n        if (a.key === 'generalReport') generalReportVal = a.value;\r\n        if (a.key === 'invoiceId') invoiceIdVal = a.value;\r\n        if (a.key === 'sessionId') sessionIdVal = a.value;\r\n      });\r\n      if (generalReportVal === true) {\r\n        resolve(\"paid\");\r\n      } else {\r\n        if (sessionIdVal) {\r\n          checkStripeSessionPaid(sessionIdVal).then(isSessionPaid => {\r\n            if (isSessionPaid) {\r\n              resolve(\"paid\");\r\n            } else if (invoiceIdVal) {\r\n              checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n                if (invStatus === 'paid') resolve(\"paid\");\r\n                else if (invStatus === 'open') resolve(\"openInvoice\");\r\n                else resolve(\"unpaid\");\r\n              }).catch(() => reject());\r\n            } else {\r\n              resolve(\"unpaid\");\r\n            }\r\n          }).catch(() => reject());\r\n        } else if (invoiceIdVal) {\r\n          checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n            if (invStatus === 'paid') resolve(\"paid\");\r\n            else if (invStatus === 'open') resolve(\"openInvoice\");\r\n            else resolve(\"unpaid\");\r\n          }).catch(() => reject());\r\n        } else {\r\n          resolve(\"unpaid\");\r\n        }\r\n      }\r\n    }, err => reject(err));\r\n  });\r\n}\r\n\r\nfunction checkStripeSessionPaid(sid) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sid}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.payment_status === 'paid') resolve(true);\r\n        else resolve(false);\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n\r\nfunction checkStripeInvoice(invoiceIdVal) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceIdVal}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.status === 'paid') {\r\n          resolve('paid');\r\n        } else if (d.status === 'open' || d.status === 'draft') {\r\n          resolve('open');\r\n        } else {\r\n          resolve(d.status);\r\n        }\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d4a6017e-1c80-d8b8-a0d0-460bc596a925"
              },
              {
                "name": "{i18n:custom.measurement.administration.action.edit-floorplan}",
                "icon": "mdi:floor-plan",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "openDashboardState",
                "targetDashboardStateId": "add_plan",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "600px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "c46f25b3-1ce6-483a-c5d5-07dbf20f9d90"
              },
              {
                "name": "{i18n:custom.measurement.administration.action.assigned-devices}",
                "icon": "medical_services",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "measurement_devices",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "25vw",
                "popoverHeight": "25vh",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "71c478b6-a4b1-e569-e99a-85d5562cc721"
              },
              {
                "name": "{i18n:custom.measurement.administration.action.measurement-parameters}",
                "icon": "settings",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form\r\n  [formGroup]=\"addDeviceFormGroup\"\r\n  (ngSubmit)=\"save()\"\r\n  class=\"add-entity-form w-11/12 max-w-3xl mx-auto\">\r\n\r\n  <mat-toolbar class=\"flex items-center justify-between bg-primary text-white px-4\" color=\"primary\">\r\n    <h2 class=\"text-lg font-semibold\">{{ 'custom.diagnostics.action.edit-measurement-parameters.title' | translate }}</h2>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar\r\n    color=\"warn\"\r\n    mode=\"indeterminate\"\r\n    *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear class=\"space-y-4\">\r\n\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.assignment.title' | translate }}</ng-template>\r\n\r\n        <!-- Assigned Devices -->\r\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n          <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.assigned-devices.title' | translate }}</mat-label>\r\n          <mat-chip-grid\r\n            #chipList\r\n            aria-label=\"Assigned Devices\"\r\n            class=\"flex flex-wrap gap-2 mt-2\">\r\n            <mat-chip-row *ngFor=\"let dev of assignedDevices\" color=\"primary\" selected disableRipple>\r\n              {{ dev.name }}\r\n            </mat-chip-row>\r\n          </mat-chip-grid>\r\n            <input\r\n              matInput\r\n              [matChipInputFor]=\"chipList\"\r\n              readonly\r\n              [placeholder]=\"assignedDevices?.length ? '' : ('custom.diagnostics.action.edit-measurement-parameters.assigned-devices.error' | translate)\"/>\r\n        </mat-form-field>\r\n\r\n        <!-- Progress -->\r\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n          <mat-label>{{ 'custom.diagnostics.measurement-progress.title' | translate }}</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">{{ 'custom.diagnostics.state-filter.preparation.title' | translate }}</mat-option>\r\n            <mat-option value=\"active\">{{ 'custom.diagnostics.state-filter.active.title' | translate }}</mat-option>\r\n            <mat-option value=\"finished\">{{ 'custom.diagnostics.state-filter.finished.title' | translate }}</mat-option>\r\n            <mat-option value=\"aborted\">{{ 'custom.diagnostics.state-filter.aborted.title' | translate }}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start/End DateTime -->\r\n        <div class=\"flex w-full gap-2\">\r\n          <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-date.title' | translate }}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\"/>\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.start-time.title' | translate }}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\"/>\r\n          </mat-form-field>\r\n        </div>\r\n\r\n        <div class=\"flex w-full gap-2\">\r\n          <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-date.title' | translate }}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\"/>\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.end-time.title' | translate }}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\"/>\r\n          </mat-form-field>\r\n        </div>\r\n\r\n        <!-- Actions -->\r\n        <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{{ 'action.cancel' | translate }}</button>\r\n          <button\r\n            mat-button\r\n            matStepperNext\r\n            type=\"button\"\r\n            color=\"primary\"\r\n            *ngIf=\"showAttributesStep\"\r\n            [disabled]=\"!assignedDevicesAvailable\">\r\n            {{ 'custom.diagnostics.action.next.title' | translate }}\r\n          </button>\r\n          <button\r\n            mat-raised-button\r\n            color=\"primary\"\r\n            type=\"submit\"\r\n            *ngIf=\"!showAttributesStep\"\r\n            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\r\n            {{ 'action.save' | translate }}\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>{{ 'custom.diagnostics.action.edit-measurement-parameters.default-parameters.title' | translate }}</ng-template>\r\n\r\n        <div class=\"flex flex-col gap-2\">\r\n\r\n          <!-- Dimension -->\r\n          <fieldset class=\"fieldset\">\r\n            <legend class=\"fieldset-legend\">Dimension</legend>\r\n            <div class=\"flex w-full gap-2\">\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.title' | translate }}</mat-label>\r\n                <mat-select formControlName=\"dimension\" required>\r\n                  <mat-option *ngFor=\"let dim of dimensionOptions\" [value]=\"dim\">{{ dim }}</mat-option>\r\n                </mat-select>\r\n                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                  {{ 'custom.diagnostics.action.edit-measurement-parameters.dimension.error' | translate }}\r\n                </mat-error>\r\n              </mat-form-field>\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.nominal-flow.title' | translate }}</mat-label>\r\n                <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly/>\r\n              </mat-form-field>\r\n            </div>\r\n            <div class=\"flex gap-2\">\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.floor-volume.title' | translate }}</mat-label>\r\n                <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\"/>\r\n              </mat-form-field>\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.pump-power.title' | translate }}</mat-label>\r\n                <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\"/>\r\n              </mat-form-field>\r\n            </div>\r\n          </fieldset>\r\n\r\n          <!-- Installation -->\r\n          <fieldset class=\"fieldset\">\r\n            <legend class=\"fieldset-legend\">Installation</legend>\r\n            <div class=\"flex gap-2\">\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.title' | translate }}</mat-label>\r\n                <mat-select formControlName=\"installationType\" required>\r\n                  <mat-option value=\"heating\">{{ 'custom.diagnostics.measurement-type.heating.title' | translate }}</mat-option>\r\n                  <mat-option value=\"cooling\">{{ 'custom.diagnostics.measurement-type.cooling.title' | translate }}</mat-option>\r\n                </mat-select>\r\n                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                  {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.error' | translate }}\r\n                </mat-error>\r\n              </mat-form-field>\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.title' | translate }}</mat-label>\r\n                <mat-select formControlName=\"installationTypeOptions\" required>\r\n                  <ng-container\r\n                    *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                    <mat-option value=\"radiatorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.radiator-heating.title' | translate }}</mat-option>\r\n                    <mat-option value=\"floorHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.floor-heating.title' | translate }}</mat-option>\r\n                    <mat-option value=\"districtHeating\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.district-heating.title' | translate }}</mat-option>\r\n                    <mat-option value=\"heatingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.heating-other.title' | translate }}</mat-option>\r\n                  </ng-container>\r\n                  <ng-container\r\n                    *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                    <mat-option value=\"coolingCircuit\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-circuit.title' | translate }}</mat-option>\r\n                    <mat-option value=\"coolingCeiling\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-ceiling.title' | translate }}</mat-option>\r\n                    <mat-option value=\"chiller\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.chiller.title' | translate }}</mat-option>\r\n                    <mat-option value=\"coolingOther\">{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.cooling-other.title' | translate }}</mat-option>\r\n                  </ng-container>\r\n                </mat-select>\r\n                <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                  {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type-options.error' | translate }}\r\n                </mat-error>\r\n              </mat-form-field>\r\n            </div>\r\n          </fieldset>\r\n\r\n\r\n          <!-- Analysis -->\r\n          <fieldset class=\"fieldset\">\r\n            <legend class=\"fieldset-legend\">Analysis</legend>\r\n            <div class=\"flex gap-2\">\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature' | translate }}</mat-label>\r\n                <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\"/>\r\n              </mat-form-field>\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>Delta T</mat-label>\r\n                <input matInput formControlName=\"deltaT\" type=\"number\"/>\r\n              </mat-form-field>\r\n            </div>\r\n            <div class=\"flex gap-2\">\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold-setting' | translate }}</mat-label>\r\n                <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                  <mat-option value=\"above\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.above' | translate }}</mat-option>\r\n                  <mat-option value=\"below\">{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.selection.below' | translate }}</mat-option>\r\n                </mat-select>\r\n              </mat-form-field>\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.standard-outdoor-temperature-threshold' | translate }}</mat-label>\r\n                <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\"/>\r\n              </mat-form-field>\r\n            </div>\r\n            <div class=\"flex gap-2\">\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.analysis.maximum-power-threshold' | translate }}</mat-label>\r\n                <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\"/>\r\n              </mat-form-field>\r\n            </div>\r\n            <div class=\"flex gap-2\">\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{'unit.measures.area' | translate}}</mat-label>\r\n                <input matInput formControlName=\"area\" type=\"number\"/>\r\n              </mat-form-field>\r\n              <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'filter.unit' | translate}}</mat-label>\r\n                <input matInput formControlName=\"unit\" type=\"text\"/>\r\n              </mat-form-field>\r\n            </div>\r\n          </fieldset>\r\n\r\n          <!-- Weekly Operating Schedule -->\r\n          <fieldset class=\"fieldset\">\r\n            <legend class=\"fieldset-legend\">{{ 'custom.diagnostics.action.edit-measurement-parameters.timings.weekly-schedule.title' | translate }}</legend>\r\n            <div\r\n              formGroupName=\"weeklyOperatingSchedule\"\r\n              class=\"flex justify-between items-center gap-2\">\r\n              <mat-checkbox formControlName=\"monday\">{{ 'scheduler.monday-label' | translate }}</mat-checkbox>\r\n              <mat-checkbox formControlName=\"tuesday\">{{ 'scheduler.tuesday-label' | translate }}</mat-checkbox>\r\n              <mat-checkbox formControlName=\"wednesday\">{{ 'scheduler.wednesday-label' | translate }}</mat-checkbox>\r\n              <mat-checkbox formControlName=\"thursday\">{{ 'scheduler.thursday-label' | translate }}</mat-checkbox>\r\n              <mat-checkbox formControlName=\"friday\">{{ 'scheduler.friday-label' | translate }}</mat-checkbox>\r\n              <mat-checkbox formControlName=\"saturday\">{{ 'scheduler.saturday-label' | translate }}</mat-checkbox>\r\n              <mat-checkbox formControlName=\"sunday\">{{ 'scheduler.sunday-label' | translate }}</mat-checkbox>\r\n            </div>\r\n          </fieldset>\r\n\r\n        </div>\r\n\r\n        <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\"> {{ 'action.cancel' | translate }}</button>\r\n          <button mat-button matStepperPrevious color=\"primary\"> {{ 'action.back' | translate }}</button>\r\n          <button\r\n            mat-raised-button\r\n            color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\r\n             {{ 'action.save' | translate }}\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step (Commented Out) -->\r\n      <!--  -->\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = [\r\n    'customDialog',\r\n    'entityService',\r\n    'deviceService',\r\n    'entityGroupService',\r\n    'attributeService',\r\n    'entityRelationService',\r\n    'assetService'\r\n].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Invalid measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\", \"Temperature Sensor\", \"RESI\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            fetchAttributes(devices);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching devices:\", error);\r\n            fetchAttributes([]);\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDevices) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDevices, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching attributes:\", error);\r\n            openAddDeviceDialog(assignedDevices, []);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDevices, attributes) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        assignedDevices,\r\n        attributes,\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    // Retrieve data from vm.data provided to the controller\r\n    const {\r\n        measurementId,\r\n        assignedDevices = [],\r\n        attributes = [],\r\n    } = vm.data || {};\r\n    vm.assignedDevices = assignedDevices;\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n\r\n    // Retrieve measurementType and progress attribute values\r\n    const measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\r\n    const progressAttr = attributes.find(attr => attr.key === 'progress');\r\n    const measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\r\n    // Default progress to \"in preparation\" if not found\r\n    const progressValue = progressAttr ? progressAttr.value : 'in preparation';\r\n\r\n    // Allow editing if there are assigned devices OR if progress is not \"in preparation\"\r\n    vm.assignedDevicesAvailable = (assignedDevices.length > 0) || (progressValue !== 'in preparation');\r\n\r\n    // If you show a \"No devices assigned!\" text, update the condition accordingly.\r\n    // e.g., vm.showNoDevicesMessage = (assignedDevices.length === 0 && progressValue === 'in preparation');\r\n\r\n    // For additional UI logic  show attributes step only when devices are available and measurementType is 'ultrasonic'\r\n    vm.showAttributesStep = vm.assignedDevicesAvailable && (measurementType === 'ultrasonic');\r\n    /*vm.showAlarmThresholdsStep = vm.assignedDevicesAvailable;*/\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                progress: [{ value: progressValue, disabled: !vm.assignedDevicesAvailable }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                startTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area: [null],\r\n                unit: [null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            /*alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),*/\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Map known attribute keys to form controls\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                // Place 'progress' in assignmentStep; otherwise, in attributesStep\r\n                const stepGroup = (formControlName === 'progress') ? 'assignmentStep' : 'attributesStep';\r\n                vm.addDeviceFormGroup.get(`stepper.${stepGroup}.${formControlName}`).setValue(attr.value);\r\n            }\r\n            // Start/end times\r\n            else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = (attr.key === 'startTimeMs') ? 'startDate' : 'endDate';\r\n                    const timeControlName = (attr.key === 'startTimeMs') ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            }\r\n            // Weekly schedule\r\n            else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup.get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n            // Additional mapping for alarm threshold attributes can be added similarly.\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n\r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').valueChanges.subscribe(() => {\r\n            updateInstallationTypeOptions();\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').valueChanges.subscribe((val) => {\r\n            setDefaultDeltaT(val);\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.dimension').valueChanges.subscribe((dimension) => {\r\n            const nominalFlow = getNominalFlowByDimension(dimension);\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep.nominalFlow').setValue(nominalFlow);\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.nominalFlow').valueChanges.subscribe((val) => {\r\n            if (val) {\r\n                // Example: floor volume as 2% of nominalFlow\r\n                const floorVal = (val * 0.02).toFixed(3);\r\n                vm.addDeviceFormGroup.get('stepper.attributesStep.deltaTAnalysisFloorVolume').setValue(floorVal);\r\n            }\r\n        });\r\n\r\n        vm.addDeviceFormGroup.get('stepper.assignmentStep.progress').valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.showAttributesStep) {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep').disable();\r\n        } else {\r\n            vm.addDeviceFormGroup.get('stepper.attributesStep').enable();\r\n        }\r\n\r\n        if (!vm.assignedDevicesAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n\r\n        // Auto-set start time if progress is active and not already set.\r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        }\r\n        // Auto-set end time if progress indicates finished/aborted and no end time is set.\r\n        else if (\r\n            (progressControl.value === 'finished' || progressControl.value === 'aborted') &&\r\n            startDateControl.value && startTimeControl.value &&\r\n            !endDateControl.value && !endTimeControl.value\r\n        ) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const defaultDelta = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(defaultDelta);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        // const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;  // if needed\r\n\r\n        // Convert date/time values to epoch timestamps\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n        let attributesArray;\r\n        if (measurementType === 'ultrasonic') {\r\n            attributesArray = [\r\n                { key: 'xPos', value: 0.5 },\r\n                { key: 'yPos', value: 0.5 },\r\n                { key: 'installationType', value: attributesStep.installationType },\r\n                { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n                { key: 'progress', value: assignmentStep.progress },\r\n                { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n                { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n                { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n                { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n                { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n                { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n                {\r\n                    key: 'area',\r\n                    value: {\r\n                        value: attributesStep.area,\r\n                        unit: attributesStep.unit,\r\n                    },\r\n                },\r\n                { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n                { key: 'dimension', value: attributesStep.dimension },\r\n                { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n                { key: 'deltaT', value: attributesStep.deltaT },\r\n                { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n                { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            ];\r\n        } else {\r\n            attributesArray = [\r\n                { key: 'xPos', value: 0.5 },\r\n                { key: 'yPos', value: 0.5 },\r\n                { key: 'progress', value: assignmentStep.progress },\r\n                { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n                { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            ];\r\n        }\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                // Save successful; update aliases and close dialog\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error while saving attributes:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5dcb0be7-7d93-bf73-e7ae-c84bbf251a75"
              },
              {
                "name": "{i18n:custom.measurement.administration.action.edit-measurement}",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"editEntityFormGroup\"\r\n      (ngSubmit)=\"save()\" \r\n      class=\"edit-entity-form w-11/12 max-w-3xl mx-auto\">\r\n    \r\n    <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n        <h2 class=\"text-lg font-semibold\">{{ 'custom.measurement.administration.action.edit-measurement' | translate}}</h2>\r\n        <span class=\"flex-1\"></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon>close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n\r\n        <!-- First row: Name, Measurement alias -->\r\n        <div class=\"flex w-full gap-2\">\r\n\r\n            <!-- Name (Top-level form control) -->\r\n            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.measurement.administration.name.title' | translate}}</mat-label>\r\n                <input matInput \r\n                       formControlName=\"entityName\" \r\n                       required>\r\n                <mat-error *ngIf=\"editEntityFormGroup.get('entityName')?.hasError('required')\">\r\n                  {{'custom.measurement.administration.name.error.is-required' | translate}}\r\n                </mat-error>\r\n            </mat-form-field>\r\n\r\n            <!-- Measurement alias (Inside 'attributes' child form group) -->\r\n            <mat-form-field appearance=\"fill\" class=\"flex-1\" [formGroup]=\"editEntityFormGroup.controls['attributes']\">\r\n                <mat-label>{{'custom.measurement.administration.action.measurement-alias' | translate}}</mat-label>\r\n                <input matInput formControlName=\"locationName\">\r\n            </mat-form-field>\r\n        </div>\r\n\r\n        <!-- Second row: Address -->\r\n        <div class=\"flex w-full\">\r\n\r\n            <mat-form-field appearance=\"fill\" class=\"flex-1\" [formGroup]=\"editEntityFormGroup.controls['attributes']\">\r\n                <mat-label>{{ 'custom.measurement.administration.address.title' | translate}}</mat-label>\r\n                <input matInput formControlName=\"address\">\r\n            </mat-form-field>\r\n        </div>\r\n\r\n        <!-- Third row: Installation Type, Measurement Type -->\r\n        <div class=\"flex w-full gap-2\">\r\n\r\n            <!-- HIDE Installation Type if measurementType is 'loraWan' -->\r\n            <mat-form-field appearance=\"fill\" class=\"flex-1\"\r\n                            *ngIf=\"editEntityFormGroup.get('attributes.measurementType')?.value !== 'loraWan'\"\r\n                            [formGroup]=\"editEntityFormGroup.controls['attributes']\">\r\n                <mat-label>{{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.title' | translate}}</mat-label>\r\n                <mat-select formControlName=\"installationType\" required>\r\n                    <mat-option value=\"heating\">{{ 'custom.diagnostics.measurement-type.heating.title' | translate}}</mat-option>\r\n                    <mat-option value=\"cooling\">{{ 'custom.diagnostics.measurement-type.cooling.title' | translate}}</mat-option>\r\n                </mat-select>\r\n                <mat-error *ngIf=\"editEntityFormGroup.get('attributes.installationType')?.hasError('required')\">\r\n                 {{ 'custom.diagnostics.action.edit-measurement-parameters.installation-type.error' | translate}}\r\n                </mat-error>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field appearance=\"fill\" class=\"flex-1\" [formGroup]=\"editEntityFormGroup.controls['attributes']\">\r\n                <mat-label>{{ 'custom.measurement.administration.action.measurement-type.title' | translate}}</mat-label>\r\n                <mat-select formControlName=\"measurementType\" required>\r\n                    <mat-option value=\"ultrasonic\">{{ 'custom.diagnostics.measurement-type.ultrasonic.title' | translate}}</mat-option>\r\n                    <mat-option value=\"loraWan\">{{ 'custom.diagnostics.measurement-type.lorawan.title' | translate}}</mat-option>\r\n                </mat-select>\r\n                <mat-error *ngIf=\"editEntityFormGroup.get('attributes.measurementType')?.hasError('required')\">\r\n                  {{ 'custom.measurement.administration.action.measurement-type.error.is-required' | translate}}\r\n                </mat-error>\r\n            </mat-form-field>\r\n        </div>\r\n    </div>\r\n\r\n    <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n        <button mat-button\r\n                color=\"primary\"\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async)\"\r\n                (click)=\"cancel()\"\r\n                cdkFocusInitial>\r\n            {{ 'custom.diagnostics.action.cancel.title' | translate }}\r\n        </button>\r\n        <button mat-button\r\n                mat-raised-button\r\n                color=\"primary\"\r\n                type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || editEntityFormGroup.invalid\">\r\n            {{ 'action.save' | translate }}\r\n        </button>\r\n    </div>\r\n</form>\r\n",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.edit-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.edit-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.edit-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.edit-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenEditEntityDialog();\n\nfunction openEditEntityDialog() {\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n}\n\nfunction EditEntityDialogController(instance) {\n    let vm = instance;\n    vm.entityName = entityName; \n    vm.attributes = {};\n    vm.entity = {};\n\n    // Build the form group with a nested 'attributes' group\n    vm.editEntityFormGroup = vm.fb.group({\n        entityName: ['', [vm.validators.required]],\n        attributes: vm.fb.group({\n            locationName: [null],\n            address: [null],\n            installationType: [null],\n            measurementType: [null]\n        })\n    });\n\n    getEntityInfo();\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.save = function() {\n        // Mark the form as pristine right before saving\n        vm.editEntityFormGroup.markAsPristine();\n\n        // Save both entity main fields and attributes\n        widgetContext.rxjs.forkJoin([\n            saveAttributes(entityId),\n            saveEntity()\n        ]).subscribe(() => {\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n        });\n    };\n\n    function getEntityInfo() {\n        // Retrieve attributes + entity info in parallel\n        widgetContext.rxjs.forkJoin([\n            attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE'),\n            entityService.getEntity(entityId.entityType, entityId.id)\n        ]).subscribe(([attrData, entityData]) => {\n            vm.attributes = {};\n            // Populate vm.attributes from server response\n            for (let i = 0; i < attrData.length; i++) {\n                vm.attributes[attrData[i].key] = attrData[i].value;\n            }\n\n            vm.entity = entityData;\n\n            // Patch form values. \n            // Note that 'attributes' is a nested form group, so we pass an object for it.\n            vm.editEntityFormGroup.patchValue({\n                entityName: vm.entity.name,\n                attributes: {\n                    locationName: vm.attributes.locationName,\n                    address: vm.attributes.address,\n                    installationType: vm.attributes.installationType,\n                    measurementType: vm.attributes.measurementType\n                }\n            }, { emitEvent: false });\n        });\n    }\n\n    function saveEntity() {\n        const formValues = vm.editEntityFormGroup.value;\n        \n        // Always update name & label (ensures \"Save\" works even if no change)\n        vm.entity.name = formValues.entityName;\n\n        if (vm.entityType === 'ASSET') {\n            return assetService.saveAsset(vm.entity);\n        } else if (vm.entityType === 'DEVICE') {\n            return deviceService.saveDevice(vm.entity);\n        }\n        \n        // If some other type, or no changes, return an observable that completes.\n        return widgetContext.rxjs.of([]);\n    }\n\n    function saveAttributes(entityId) {\n        // Compare original vs. new values to only send changed attributes\n        const currentAttributes = vm.attributes;\n        const updatedAttributes = vm.editEntityFormGroup.value.attributes;\n        \n        let attributesArray = [];\n        for (let key in updatedAttributes) {\n            if (updatedAttributes.hasOwnProperty(key)) {\n                if (updatedAttributes[key] !== currentAttributes[key]) {\n                    attributesArray.push({ key: key, value: updatedAttributes[key] });\n                }\n            }\n        }\n\n        if (attributesArray.length > 0) {\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n        }\n        return widgetContext.rxjs.of([]);\n    }\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "eae3b679-7c47-2acc-0632-24a07f2cc8fd"
              },
              {
                "name": "{i18n:custom.measurement.administration.action.delete-measurement}",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet translationService = $injector.get(widgetContext.servicesMap.get('translate'));\n\nlet customerId;\nlet measurementEntityId = entityId.id;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        /*customerId = widgetContext.stateController.getStateParams().entityId;*/\n        \n        assetService.getAsset(measurementEntityId).subscribe(measurement => {\n            customerId = measurement.customerId;\n        });\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n\n\nlet doktorkitSearchQuery = {\n  \"parameters\": {\n    \"rootId\": measurementEntityId,\n    \"rootType\": \"ASSET\",\n    \"direction\": \"FROM\",\n    \"relationTypeGroup\": \"COMMON\",\n    \"maxLevel\": 10,\n    \"fetchLastLevelOnly\": false\n  },\n  \"relationType\": \"Owns\",\n  \"assetTypes\": [\n    \"Doktorkit\"\n  ]\n};\n\nassetService.findByQuery(doktorkitSearchQuery).subscribe(doktorkits => {\n        openDeleteMeasurementDialog(doktorkits);\n    });\n\n\nfunction addKitToUnassignedDoktorkits(doktorkits) {\n    return getUnassignedKitGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((UnassignedKitGroup) => {\n            const addKitObservables = doktorkits.map((item) => {\n                \n                return entityGroupService.addEntityToEntityGroup(UnassignedKitGroup.id.id, item.id.id);\n            });\n            \n            return widgetContext.rxjs.forkJoin(addKitObservables);\n        })\n    );\n}\nfunction getUnassignedKitGroup(customerId) {\n  return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n      widgetContext.rxjs.switchMap((entityGroups) => {\n          var UnassignedKitGroup = entityGroups.find(group => group.name === 'Unassigned Kit');\n          if (UnassignedKitGroup) {\n              return widgetContext.rxjs.of(UnassignedKitGroup);\n          } else {\n              UnassignedKitGroup = {\n                  type: 'ASSET',\n                  name: 'Unassigned Kit',\n                  ownerId: customerId\n              };\n              return entityGroupService.saveEntityGroup(UnassignedKitGroup);\n          }\n      })\n  );\n}\nfunction openDeleteMeasurementDialog(doktorkits) {\n  let titleTranslation = translationService.instant('custom.measurement.administration.action.delete-measurement-title',{ entityName: entityName });\n  let contentTranslation = translationService.instant('custom.measurement.administration.action.delete-measurement-content');\n\n  dialogs.confirm(\n    titleTranslation,\n    contentTranslation,\n    translationService.instant('action.cancel'),\n    translationService.instant('action.delete')\n  ).subscribe(function(result) {\n    if (result) {\n      deleteMeasurement(doktorkits);\n    }\n  });\n}\n\n\nfunction deleteMeasurement(doktorkits) {\n  addKitToUnassignedDoktorkits(doktorkits).subscribe();\n  let relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      let removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  let removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteMeasurementToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  let unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Measurement Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Measurement Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteMeasurementToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "338d9fd7-c752-eb0e-4687-2c2e32ca1a32"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:action.go-back}",
                "buttonType": "icon",
                "icon": "arrow_back",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\nvar number = (widgetContext.stateController.getStateIndex())-1;\r\n\r\nparams['selectedProject'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\r\nwidgetContext.stateController.updateState(null,params);\r\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c5d57113-32b2-f595-f932-7fd5f407c5a1"
              },
              {
                "name": "{i18n:custom.measurement.administration.action.add-measurement.title}",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addMeasurementFormGroup\"\r\n      (ngSubmit)=\"save()\"\r\n      class=\"add-entity-form w-11/12 max-w-3xl mx-auto\">\r\n\r\n  <!-- Optional if you're not mixing template-driven forms with reactive forms \r\n       <form #addEntityForm=\"ngForm\"> can be removed if not needed. -->\r\n\r\n  <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n    <h2>{{'custom.projects.add-measurement.add-measurement' | translate}}</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n\r\n      <!-- Measurement title -->\r\n      <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n        <mat-label>{{'custom.projects.add-measurement.measurement-id' | translate}}</mat-label>\r\n        <input matInput formControlName=\"name\" required readonly>\r\n        <mat-error *ngIf=\"addMeasurementFormGroup.get('name')?.hasError('required')\">\r\n          {{'custom.projects.add-measurement.measurement-title-required' | translate}}\r\n        </mat-error>\r\n      </mat-form-field>\r\n\r\n      <!-- Measurement alias -->\r\n      <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n        <mat-label>{{'custom.projects.add-measurement.measurement-alias' | translate}}</mat-label>\r\n        <input matInput formControlName=\"locationName\">\r\n        <mat-error *ngIf=\"addMeasurementFormGroup.get('locationName')?.hasError('required')\">\r\n          {{'custom.projects.add-measurement.measurement-alias-required' | translate}}\r\n        </mat-error>\r\n      </mat-form-field>\r\n\r\n      <!-- Address -->\r\n      <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n        <mat-label>{{'custom.projects.add-measurement.address' | translate}}</mat-label>\r\n        <input matInput formControlName=\"address\">\r\n        <!-- You can add an error check if required for \"address\" -->\r\n      </mat-form-field>\r\n    <!-- Measurement type -->\r\n          <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>{{'custom.projects.add-measurement.measurement-type' | translate}}</mat-label>\r\n            <mat-select formControlName=\"measurementType\" required>\r\n              <mat-option value=\"ultrasonic\">Ultrasonic</mat-option>\r\n              <mat-option value=\"loraWan\">LoRaWan</mat-option>\r\n            </mat-select>\r\n            <mat-error *ngIf=\"addMeasurementFormGroup.get('measurementType')?.hasError('required')\">\r\n              {{'custom.projects.add-measurement.measurement-type-required' | translate}}\r\n            </mat-error>\r\n          </mat-form-field>\r\n      <!-- Installation type (HIDDEN if measurementType is loraWan) -->\r\n      <mat-form-field appearance=\"fill\" class=\"flex-1\"\r\n                      *ngIf=\"addMeasurementFormGroup.get('measurementType')?.value !== 'loraWan'\">\r\n        <mat-label>{{'custom.projects.add-measurement.installation-type' | translate}}</mat-label>\r\n        <mat-select formControlName=\"installationType\" required>\r\n          <mat-option value=\"heating\">{{'custom.projects.add-measurement.heating' | translate}}</mat-option>\r\n          <mat-option value=\"cooling\">{{'custom.projects.add-measurement.cooling' | translate}}</mat-option>\r\n        </mat-select>\r\n        <mat-error *ngIf=\"addMeasurementFormGroup.get('installationType')?.hasError('required')\">\r\n          {{'custom.projects.add-measurement.installation-type-required' | translate}}\r\n        </mat-error>\r\n      </mat-form-field>\r\n\r\n    </div>\r\n\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n    <button mat-button\r\n            color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(isLoading$ | async)\"\r\n            (click)=\"cancel()\"\r\n            cdkFocusInitial>\r\n      {{'action.cancel' | translate}}\r\n    </button>\r\n    <button mat-button\r\n            mat-raised-button\r\n            color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"(isLoading$ | async) || addMeasurementFormGroup.invalid || !addMeasurementFormGroup.dirty\">\r\n      {{'custom.projects.add-measurement.add-measurement' | translate}}\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n\n/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nlet projectEntityId = widgetContext.stateController.getStateParams().selectedProject.entityId;\nlet nextMeasurementId = 0;\nlet longitude;\nlet latitude;\nlet address;\nlet customerId;\nlet customerName = widgetContext.stateController.getStateParams().entityName;\n\nconst NULL_UUID = '13814000-1dd2-11b2-8080-808080808080';\nfunction isValidCustomerId(id) {\n    return id && id !== NULL_UUID;\n}\n\nfunction initializeAndOpenDialog() {\n    let assetSearchQuery = {\n      \"parameters\": {\n        \"rootId\": projectEntityId.id,\n        \"rootType\": \"ASSET\",\n        \"direction\": \"FROM\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 10,\n        \"fetchLastLevelOnly\": false\n      },\n      \"relationType\": \"Owns\",\n      \"assetTypes\": [\n        \"Measurement\"\n      ]\n    };\n\n    assetService.findByQuery(assetSearchQuery).subscribe(measurements => {\n        nextMeasurementId = getLastMeasurementId(measurements);\n        attributeService.getEntityAttributes(projectEntityId,'SERVER_SCOPE',['longitude','latitude','address']).subscribe(projectatt => {\n            longitude = projectatt[2] ? projectatt[2].value : null;\n            latitude = projectatt[1] ? projectatt[1].value : null;\n            address = projectatt[0] ? projectatt[0].value : '';\n            openAddMeasurementDialog();\n        });\n    });\n}\n\n// Determine customerId: always fetch from project to ensure it's valid\nassetService.getAsset(projectEntityId.id).subscribe(project => {\n    if (project && project.customerId && isValidCustomerId(project.customerId.id)) {\n        // Ensure customerId has the correct structure with entityType\n        customerId = {\n            id: project.customerId.id,\n            entityType: project.customerId.entityType || 'CUSTOMER'\n        };\n        console.log(\"Using customerId from project:\", JSON.stringify(customerId));\n        initializeAndOpenDialog();\n    } else if (isValidCustomerId(widgetContext.currentUser.customerId)) {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n        console.log(\"Using customerId from currentUser:\", JSON.stringify(customerId));\n        initializeAndOpenDialog();\n    } else {\n        console.error(\"Cannot determine customerId.\");\n    }\n});\n\nfunction getLastMeasurementId(measurements) {\n    let maxNumber = 0;\n    measurements.forEach(item => {\n        const name = item.name;\n        const parts = name.split('_');\n        if (parts.length === 3) {\n            const number = parseInt(parts[2], 10);\n            if (number > maxNumber) {\n                maxNumber = number;\n            }\n        }\n    });\n    const nextMeasurementId = maxNumber + 1;\n    return nextMeasurementId;\n}\n\nfunction openAddMeasurementDialog() {\n    customDialog.customDialog(htmlTemplate,\n        AddMeasurementDialogController).subscribe();\n}\n\nfunction AddMeasurementDialogController(instance) {\n    let vm = instance;\n    let projectName = widgetContext.stateController.getStateParams().selectedProject.entityName;\n    vm.addMeasurementFormGroup = vm.fb.group({\n        name: [projectName + \"_\" + nextMeasurementId, [vm.validators.required]],\n        locationName: ['', [vm.validators.required]],\n        address: [address, [vm.validators.required]],\n        installationType: ['heating', [vm.validators.required]],\n        measurementType: ['ultrasonic', [vm.validators.required]]\n    });\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.save = function() {\n        const stateParams = widgetContext\n            .stateController.getStateParams();\n        var projectId;\n        projectId = {\n            id: (stateParams.selectedProject &&\n                    stateParams.selectedProject\n                    .entityId && stateParams\n                    .selectedProject.entityId.id) ?\n                stateParams.selectedProject.entityId\n                .id : '',\n            entityType: 'ASSET'\n        };\n/*        console.log(JSON.stringify(projectId));*/\n        vm.addMeasurementFormGroup.markAsPristine();\n        saveMeasurementObservable(customerId).subscribe(\n            function(Measurement) {\n                const observables = [\n                    saveCustomerToMeasurementRelation(\n                        customerId, Measurement\n                        .id),\n                    saveAttributes(Measurement\n                        .id)\n                ];\n\n                // Add saveProjectToMeasurementRelation to observables if projectId is not empty\n                if (projectId.id !== \"\") {\n                    observables.push(\n                        saveProjectToMeasurementRelation(\n                            projectId,\n                            Measurement.id));\n                }\n                widgetContext.rxjs.forkJoin(observables).subscribe(\n                    function() {\n                        var params =\n                            widgetContext\n                            .stateController\n                            .getStateParams();\n                        var selectedMeasurement =\n                            params[\n                                'selectedMeasurement'\n                                ];\n                        params[\n                            'selectedMeasurement'] = {\n                            entityId: Measurement\n                                .id,\n                            entityName: Measurement\n                                .name,\n                            entityLabel: ''\n                        };\n                        widgetContext\n                            .updateAliases();\n                        vm.dialogRef.close(\n                        null);\n                    }\n                );\n            }\n        );\n    };\n\n    function saveMeasurementObservable(customerId) {\n        return getMeasurementsGroup(customerId).pipe(\n            widgetContext.rxjs.switchMap((\n                MeasurementsGroup) => {\n                const formValues = vm\n                    .addMeasurementFormGroup.value;\n                let Measurement = {\n                    name: formValues.name,\n                    type: 'Measurement',\n                    customerId: customerId\n                };\n                return assetService.saveAsset(\n                    Measurement,\n                    MeasurementsGroup.id.id)\n            })\n        );\n    }\n\n    function getMeasurementsGroup(customerId) {\n/*        console.log(\"id:\", customerId);*/\n        return entityGroupService.getEntityGroupsByOwnerId(\n            customerId.entityType, customerId.id,\n            'ASSET').pipe(\n            widgetContext.rxjs.switchMap((\n                entityGroups) => {\n                    var MeasurementsGroup = entityGroups\n                        .find(group => group.name ===\n                            'Measurements');\n                    if (MeasurementsGroup) {\n                        return widgetContext.rxjs.of(\n                            MeasurementsGroup);\n                    } else {\n                        MeasurementsGroup = {\n                            type: 'ASSET',\n                            name: 'Measurements',\n                            ownerId: customerId\n                        };\n                        return entityGroupService\n                            .saveEntityGroup(\n                                MeasurementsGroup);\n                    }\n                })\n        );\n    }\n\n    function saveCustomerToMeasurementRelation(customerId,\n        MeasurementId) {\n        var relation = {\n            from: customerId,\n            to: MeasurementId,\n            typeGroup: 'COMMON',\n            type: 'Owns'\n        };\n        return entityRelationService.saveRelation(relation);\n    }\n\n    function saveProjectToMeasurementRelation(projectId,\n        MeasurementId) {\n        var relation = {\n            from: projectId,\n            to: MeasurementId,\n            typeGroup: 'COMMON',\n            type: 'Owns'\n        };\n        return entityRelationService.saveRelation(relation);\n    }\n\n    function saveAttributes(entityId) {\n        const formValues = vm.addMeasurementFormGroup.value;\n        let attributesArray = [{\n                key: 'latitude',\n                value: latitude\n            },\n            {\n                key: 'longitude',\n                value: longitude\n            },\n            {\n                key: 'address',\n                value: formValues.address\n            },\n            {\n                key: 'installationType',\n                value: formValues.installationType\n            },\n            {\n                key: 'locationName',\n                value: formValues.locationName\n            },\n            {\n                key: 'measurementType',\n                value: formValues.measurementType\n            },\n            {\n                key: 'state',\n                value: 'normal' // normal, minor, major, critical\n            },            \n            {\n                key: 'progress',\n                value: 'in preparation' // in preparation, active, finished, aborted\n            }, \n            {\n                key: 'active',\n                value: 'true'\n            },\n            {\n                key: 'units',\n                value: 'metric'\n            },\n            {\n                key: 'floorplan',\n                value: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K'\n            }\n        ];\n        return attributeService.saveEntityAttributes(\n            entityId, \"SERVER_SCOPE\", attributesArray);\n    }\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e965b8a1-a6ac-5ae4-fd79-2b7220b91ed1"
              },
              {
                "name": "unlock multiple analysis",
                "icon": "lock_open",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addEntityFormGroup\"\r\n      (ngSubmit)=\"onSubmit()\"\r\n      class=\"add-entity-form\">\r\n\r\n  <mat-toolbar color=\"primary\" fxLayout=\"row\">\r\n    <h2>Manage Measurements</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <!-- Loading bar -->\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n  <!-- Alert Messages -->\r\n  <div *ngIf=\"alerts && alerts.length\">\r\n    <div\r\n      *ngFor=\"let alert of alerts; let i = index\"\r\n      class=\"alert\"\r\n      [ngClass]=\"{\r\n        'alert-error': alert.type === 'error',\r\n        'alert-warning': alert.type === 'warning',\r\n        'alert-success': alert.type === 'success'\r\n      }\"\r\n    >\r\n      {{ alert.message }}\r\n      <span class=\"close-btn\" (click)=\"removeAlert(i)\">&times;</span>\r\n    </div>\r\n  </div>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n\r\n    <!-- STEP 1: Select Kits (Measurements) -->\r\n    <ng-container *ngIf=\"currentStep === 1\">\r\n      <div fxLayout=\"column\" fxLayoutGap=\"8px\">\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Select Measurements</mat-label>\r\n          <mat-select\r\n            formControlName=\"selectedMeasurements\"\r\n            multiple>\r\n            <mat-option\r\n              *ngFor=\"let measurement of measurements\"\r\n              [value]=\"measurement.id.id\">\r\n              {{ measurement.name }}\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addEntityFormGroup.get('selectedMeasurements')?.hasError('required')\">\r\n            Please select at least one Measurement\r\n          </mat-error>\r\n        </mat-form-field>\r\n      </div>\r\n    </ng-container>\r\n\r\n    <!-- STEP 2: Product + Invoice Option -->\r\n    <ng-container *ngIf=\"currentStep === 2\">\r\n      <div fxLayout=\"column\" fxLayoutGap=\"8px\">\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Select Product</mat-label>\r\n          <mat-select formControlName=\"product\" required>\r\n            <mat-option\r\n              *ngFor=\"let product of products\"\r\n              [value]=\"product.id.id\">\r\n              {{ product.name }}\r\n            </mat-option>\r\n          </mat-select>\r\n          <mat-error *ngIf=\"addEntityFormGroup.get('product')?.hasError('required')\">\r\n            Product selection is required\r\n          </mat-error>\r\n        </mat-form-field>\r\n\r\n        <mat-checkbox formControlName=\"invoice\">\r\n          Pay by Invoice (send invoice to customer email)\r\n        </mat-checkbox>\r\n      </div>\r\n    </ng-container>\r\n\r\n  </div>\r\n\r\n  <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n    <!-- Step Navigation -->\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            (click)=\"onPrevious()\"\r\n            *ngIf=\"currentStep === 2\">\r\n      Previous\r\n    </button>\r\n\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            (click)=\"onNext()\"\r\n            *ngIf=\"currentStep === 1\">\r\n      Next\r\n    </button>\r\n\r\n    <!-- Final submit on step 2 -->\r\n    <button mat-button mat-raised-button color=\"primary\"\r\n            type=\"submit\"\r\n            *ngIf=\"currentStep === 2\"\r\n            [disabled]=\"(isLoading$ | async) || addEntityFormGroup.invalid\">\r\n      Complete\r\n    </button>\r\n\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(isLoading$ | async)\"\r\n            (click)=\"cancel()\">\r\n      Cancel\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                "customCss": " /* Base alert styling */\n  .alert {\n    display: flex;\n    align-items: center;\n    padding: 1rem;\n    margin: 0.5rem 0;\n    border-radius: 4px;\n    color: #fff;\n    font-weight: 500;\n    font-family: sans-serif;\n    position: relative;\n  }\n\n  .alert .close-btn {\n    margin-left: auto;\n    cursor: pointer;\n    font-weight: bold;\n    padding: 0 0.5rem;\n    opacity: 0.8;\n  }\n  .alert .close-btn:hover {\n    opacity: 1;\n  }\n\n  /* Error (Red) */\n  .alert-error {\n    background-color: #f44336;\n    border-left: 6px solid #d32f2f;\n  }\n\n  /* Success (Green) */\n  .alert-success {\n    background-color: #4caf50;\n    border-left: 6px solid #388e3c;\n  }\n\n  /* Warning (Orange) */\n  .alert-warning {\n    background-color: #ff9800;\n    border-left: 6px solid #f57c00;\n  }",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet PageLink = widgetContext.pageLink;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet assetProfileService = $injector.get(widgetContext.servicesMap.get('assetProfileService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\n\r\nlet tenantId = \"efb63c10-b576-11ee-a6c2-a149ed03c64d\";\r\nlet projectID = widgetContext.stateController.getStateParams().selectedProject.entityId.id;\r\nlet stripeSecretKey;\r\nlet sessionId = '';\r\nlet products = [];\r\nlet measurements = [];\r\nlet measurementMap = {};\r\nlet customerId;\r\nlet customerStripeId;\r\nvar url = window.location.href;\r\n\r\nfunction getQueryParam(param) {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  return urlParams.get(param);\r\n}\r\n\r\nconst sessionIdFromUrl = getQueryParam('session_id');\r\nif (sessionIdFromUrl) {\r\n  window.history.replaceState({}, document.title, window.location.pathname);\r\n  let storedProductId = localStorage.getItem('selectedProductId');\r\n  localStorage.removeItem('selectedProductId');\r\n  checkPaymentStatus(sessionIdFromUrl, storedProductId);\r\n} else {\r\n  initialize();\r\n}\r\n\r\nfunction initialize() {\r\n  const pageLink = PageLink(50, 0);\r\n  const queryProducts = {\r\n    parameters: {\r\n      rootId: tenantId,\r\n      rootType: \"TENANT\",\r\n      direction: \"FROM\",\r\n      relationTypeGroup: \"COMMON\",\r\n      maxLevel: 1073741824,\r\n      fetchLastLevelOnly: true\r\n    },\r\n    relationType: \"Contains\",\r\n    assetTypes: [\"Product\"]\r\n  };\r\n  assetService.getAssetInfo(projectID).subscribe(info => {\r\n    customerId = info.customerId;\r\n    const queryMeasurements = {\r\n      parameters: {\r\n        rootId: customerId.id,\r\n        rootType: \"CUSTOMER\",\r\n        direction: \"FROM\",\r\n        relationTypeGroup: \"COMMON\",\r\n        maxLevel: 1,\r\n        fetchLastLevelOnly: false\r\n      },\r\n      relationType: \"Owns\",\r\n      assetTypes: [\"Measurement\"]\r\n    };\r\n    assetService.findByQuery(queryMeasurements).subscribe(allMeasurements => {\r\n      measurements = allMeasurements;\r\n      measurements.forEach(m => {\r\n        measurementMap[m.id.id] = { name: m.name, id: m.id.id };\r\n      });\r\n    });\r\n    attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n      customerStripeId = stripeId[0].value;\r\n      attributeService.getEntityAttributes({ entityType: 'TENANT', id: tenantId }, \"SERVER_SCOPE\", ['stripeKey'])\r\n        .subscribe(attr => {\r\n          stripeSecretKey = attr[0].value;\r\n          assetService.findByQuery(queryProducts).subscribe(assets => {\r\n            let filteredProducts = [];\r\n            let productFetches = assets.map(asset => {\r\n              return attributeService\r\n                .getEntityAttributes(asset.id, \"SERVER_SCOPE\", ['prodType'])\r\n                .toPromise()\r\n                .then(attributes => {\r\n                  if (attributes.length > 0 &&\r\n                      attributes[0].key === 'prodType' &&\r\n                      attributes[0].value === 'analysis') {\r\n                    filteredProducts.push(asset);\r\n                  }\r\n                });\r\n            });\r\n            Promise.all(productFetches).then(() => {\r\n              products = filteredProducts;\r\n              openAddEntityDialog();\r\n            });\r\n          });\r\n        });\r\n    });\r\n  });\r\n}\r\n\r\nfunction openAddEntityDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n  let vm = instance;\r\n  vm.currentStep = 1;\r\n  vm.measurements = measurements;\r\n  vm.products = products;\r\n  vm.alerts = [];\r\n\r\n  vm.addEntityFormGroup = vm.fb.group({\r\n    selectedMeasurements: [[], [vm.validators.required]],\r\n    product: ['', [vm.validators.required]],\r\n    invoice: [false]\r\n  });\r\n\r\n  vm.removeAlert = function (index) {\r\n    vm.alerts.splice(index, 1);\r\n  };\r\n  function addAlert(message, type) {\r\n    vm.alerts.push({ message, type });\r\n  }\r\n\r\n  vm.onNext = function () {\r\n    vm.alerts = [];\r\n    if (vm.addEntityFormGroup.get('selectedMeasurements').valid) {\r\n      let selected = vm.addEntityFormGroup.get('selectedMeasurements').value;\r\n      checkAllSelectedMeasurements(selected).then((checkResult) => {\r\n        if (checkResult.canProceed) {\r\n          vm.currentStep = 2;\r\n        } else {\r\n          if (checkResult.problemMeasurementsPaid.length > 0) {\r\n            addAlert(\r\n              \"Some selected Measurements have already the analysis activated: \" +\r\n              checkResult.problemMeasurementsPaid.join(\", \"),\r\n              \"warning\"\r\n            );\r\n          }\r\n          if (checkResult.problemMeasurementsOpen.length > 0) {\r\n            addAlert(\r\n              \"Some selected Measurements have an OPEN invoice. Please check your email: \" +\r\n              checkResult.problemMeasurementsOpen.join(\", \"),\r\n              \"warning\"\r\n            );\r\n          }\r\n        }\r\n      }).catch(() => {\r\n        addAlert(\"Failed to check measurement statuses.\", \"error\");\r\n      });\r\n    } else {\r\n      vm.addEntityFormGroup.get('selectedMeasurements').markAsTouched();\r\n    }\r\n  };\r\n\r\n  vm.onPrevious = function () {\r\n    vm.currentStep = 1;\r\n  };\r\n\r\n  vm.onSubmit = function () {\r\n    vm.addEntityFormGroup.markAllAsTouched();\r\n    if (vm.addEntityFormGroup.invalid) {\r\n      return;\r\n    }\r\n    const formValues = vm.addEntityFormGroup.value;\r\n    const selectedMeasurements = formValues.selectedMeasurements;\r\n    const selectedProductId = formValues.product;\r\n    const payByInvoice = formValues.invoice;\r\n    localStorage.setItem('selectedMeasurementIds', JSON.stringify(selectedMeasurements));\r\n    localStorage.setItem('selectedProductId', selectedProductId);\r\n    attributeService.getEntityAttributes(\r\n      { entityType: 'ASSET', id: selectedProductId },\r\n      \"SERVER_SCOPE\",\r\n      ['price_stripe_id']\r\n    ).subscribe(attrs => {\r\n      if (!attrs || attrs.length === 0) {\r\n        console.error('price_stripe_id not found for the selected product.');\r\n        return;\r\n      }\r\n      const priceId = attrs[0].value;\r\n      if (payByInvoice) {\r\n        createInvoiceForAllMeasurements(priceId, selectedMeasurements, vm);\r\n      } else {\r\n        createCheckoutSessionForAllMeasurements(priceId, selectedMeasurements, vm);\r\n      }\r\n    });\r\n  };\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n}\r\n\r\nfunction checkAllSelectedMeasurements(measurementIds) {\r\n  return new Promise((resolve, reject) => {\r\n    let checks = measurementIds.map(mId => checkSingleMeasurementStatus(mId));\r\n    Promise.all(checks).then(statuses => {\r\n      let problemMeasurementsPaid = [];\r\n      let problemMeasurementsOpen = [];\r\n      statuses.forEach((st, idx) => {\r\n        if (st === \"paid\") {\r\n          let nm = measurementMap[measurementIds[idx]] ? measurementMap[measurementIds[idx]].name : measurementIds[idx];\r\n          problemMeasurementsPaid.push(nm);\r\n        } else if (st === \"openInvoice\") {\r\n          let nm = measurementMap[measurementIds[idx]] ? measurementMap[measurementIds[idx]].name : measurementIds[idx];\r\n          problemMeasurementsOpen.push(nm);\r\n        }\r\n      });\r\n      if (problemMeasurementsPaid.length > 0 || problemMeasurementsOpen.length > 0) {\r\n        resolve({\r\n          canProceed: false,\r\n          problemMeasurementsPaid,\r\n          problemMeasurementsOpen\r\n        });\r\n      } else {\r\n        resolve({\r\n          canProceed: true,\r\n          problemMeasurementsPaid: [],\r\n          problemMeasurementsOpen: []\r\n        });\r\n      }\r\n    }).catch(reject);\r\n  });\r\n}\r\n\r\n/* \r\n   checkSingleMeasurementStatus(mId) -> returns:\r\n     \"paid\"       => analysis = true or paid session or invoice\r\n     \"openInvoice\"=> invoice found with status 'open' or 'draft'\r\n     \"unpaid\"     => can proceed\r\n*/\r\nfunction checkSingleMeasurementStatus(mId) {\r\n  return new Promise((resolve, reject) => {\r\n    attributeService.getEntityAttributes(\r\n      { entityType: 'ASSET', id: mId },\r\n      \"SERVER_SCOPE\",\r\n      ['analysis','invoiceId','sessionId']\r\n    ).subscribe(attrs => {\r\n      let analysisVal = false;\r\n      let invoiceIdVal = null;\r\n      let sessionIdVal = null;\r\n      attrs.forEach(a => {\r\n        if (a.key === 'analysis') analysisVal = a.value;\r\n        if (a.key === 'invoiceId') invoiceIdVal = a.value;\r\n        if (a.key === 'sessionId') sessionIdVal = a.value;\r\n      });\r\n      if (analysisVal === true) {\r\n        resolve(\"paid\");\r\n      } else {\r\n        if (sessionIdVal) {\r\n          checkStripeSessionPaid(sessionIdVal).then(isPaid => {\r\n            if (isPaid) {\r\n              resolve(\"paid\");\r\n            } else if (invoiceIdVal) {\r\n              checkStripeInvoiceStatus(invoiceIdVal).then(invStatus => {\r\n                if (invStatus === 'paid') resolve(\"paid\");\r\n                else if (invStatus === 'open') resolve(\"openInvoice\");\r\n                else resolve(\"unpaid\");\r\n              }).catch(() => reject());\r\n            } else {\r\n              resolve(\"unpaid\");\r\n            }\r\n          }).catch(() => reject());\r\n        } else if (invoiceIdVal) {\r\n          checkStripeInvoiceStatus(invoiceIdVal).then(invStatus => {\r\n            if (invStatus === 'paid') resolve(\"paid\");\r\n            else if (invStatus === 'open') resolve(\"openInvoice\");\r\n            else resolve(\"unpaid\");\r\n          }).catch(() => reject());\r\n        } else {\r\n          resolve(\"unpaid\");\r\n        }\r\n      }\r\n    }, error => {\r\n      reject(error);\r\n    });\r\n  });\r\n}\r\n\r\nfunction checkStripeSessionPaid(sid) {\r\n  return new Promise((resolve, reject) => {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      fetchStripeKeysAndCustomerId().then(() => {\r\n        doFetch();\r\n      }).catch(reject);\r\n    } else {\r\n      doFetch();\r\n    }\r\n    function doFetch() {\r\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sid}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n        .then(r => r.json())\r\n        .then(d => {\r\n          if (d.payment_status === 'paid') {\r\n            resolve(true);\r\n          } else {\r\n            resolve(false);\r\n          }\r\n        })\r\n        .catch(() => reject());\r\n    }\r\n  });\r\n}\r\n\r\n/* \r\n   checkStripeInvoiceStatus() -> returns 'paid', 'open', 'draft', etc.\r\n*/\r\nfunction checkStripeInvoiceStatus(invoiceId) {\r\n  return new Promise((resolve, reject) => {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      fetchStripeKeysAndCustomerId().then(() => {\r\n        doFetch();\r\n      }).catch(reject);\r\n    } else {\r\n      doFetch();\r\n    }\r\n    function doFetch() {\r\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n        .then(r => r.json())\r\n        .then(d => {\r\n          if (d.status === 'paid') {\r\n            resolve('paid');\r\n          } else if (d.status === 'open' || d.status === 'draft') {\r\n            resolve('open');\r\n          } else {\r\n            // fallback\r\n            resolve(d.status);\r\n          }\r\n        })\r\n        .catch(() => reject());\r\n    }\r\n  });\r\n}\r\n\r\nasync function createInvoiceForAllMeasurements(priceId, selectedMeasurementIds, instance) {\r\n  try {\r\n    const priceResp = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResp.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResp.statusText}`);\r\n    }\r\n    const priceData = await priceResp.json();\r\n    const amount = priceData.unit_amount;\r\n    const currency = priceData.currency;\r\n\r\n    let invoiceBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      auto_advance: 'false',\r\n      collection_method: 'send_invoice',\r\n      days_until_due: '14'\r\n    });\r\n    const invoiceResp = await fetch('https://api.stripe.com/v1/invoices', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceBody\r\n    });\r\n    if (!invoiceResp.ok) {\r\n      throw new Error(`Error creating draft invoice: ${invoiceResp.statusText}`);\r\n    }\r\n    const invoiceData = await invoiceResp.json();\r\n\r\n    for (let measurementId of selectedMeasurementIds) {\r\n      const measurementName = measurementMap[measurementId]\r\n        ? measurementMap[measurementId].name\r\n        : measurementId;\r\n      let invoiceItemBody = new URLSearchParams({\r\n        customer: customerStripeId,\r\n        invoice: invoiceData.id,\r\n        amount: amount.toString(),\r\n        currency: currency,\r\n        description: `One-time purchase for measurement: ${measurementName}`\r\n      });\r\n      const invoiceItemResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`,\r\n          'Content-Type': 'application/x-www-form-urlencoded'\r\n        },\r\n        body: invoiceItemBody\r\n      });\r\n      if (!invoiceItemResp.ok) {\r\n        throw new Error(`Error creating invoice item: ${invoiceItemResp.statusText}`);\r\n      }\r\n      await invoiceItemResp.json();\r\n    }\r\n\r\n    const finalizeResp = await fetch(`https://api.stripe.com/v1/invoices/${invoiceData.id}/finalize`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!finalizeResp.ok) {\r\n      throw new Error(`Error finalizing invoice: ${finalizeResp.statusText}`);\r\n    }\r\n    await finalizeResp.json();\r\n\r\n    const attributeTasks = selectedMeasurementIds.map(mId => {\r\n      const attrs = [\r\n        { key: \"analysis\", value: false },\r\n        { key: \"invoiceId\", value: invoiceData.id }\r\n      ];\r\n      return new Promise((resolve, reject) => {\r\n        attributeService.saveEntityAttributes(\r\n          { entityType: 'ASSET', id: mId },\r\n          \"SERVER_SCOPE\",\r\n          attrs\r\n        ).subscribe(resolve, reject);\r\n      });\r\n    });\r\n    await Promise.all(attributeTasks);\r\n\r\n    alert(\"Invoice created & sent for all selected measurements!\");\r\n    instance.dialogRef.close(null);\r\n  } catch (err) {\r\n    console.error(\"Error creating invoice for multiple measurements:\", err);\r\n    alert(\"Failed to create invoice. Please try again.\");\r\n    instance.dialogRef.close(null);\r\n  }\r\n}\r\n\r\nasync function createCheckoutSessionForAllMeasurements(priceId, selectedMeasurementIds, instance) {\r\n  try {\r\n    const priceResponse = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResponse.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResponse.statusText}`);\r\n    }\r\n    const priceData = await priceResponse.json();\r\n    const isRecurring = priceData.recurring !== null;\r\n    const mode = isRecurring ? 'subscription' : 'payment';\r\n\r\n    const amount = priceData.unit_amount;\r\n    const currency = priceData.currency;\r\n    const successUrl = url;\r\n    const cancelUrl = url;\r\n\r\n    const bodyParams = new URLSearchParams();\r\n    bodyParams.append('success_url', successUrl);\r\n    bodyParams.append('cancel_url', cancelUrl);\r\n    bodyParams.append('payment_method_types[]', 'card');\r\n    bodyParams.append('mode', mode);\r\n    bodyParams.append('customer', customerStripeId);\r\n\r\n    selectedMeasurementIds.forEach((mId, idx) => {\r\n      const measurementName = measurementMap[mId]\r\n        ? measurementMap[mId].name\r\n        : mId;\r\n      bodyParams.append(`line_items[${idx}][price_data][currency]`, currency);\r\n      bodyParams.append(`line_items[${idx}][price_data][unit_amount]`, amount.toString());\r\n      bodyParams.append(`line_items[${idx}][price_data][product_data][name]`, `Analysis for: ${measurementName}`);\r\n      bodyParams.append(`line_items[${idx}][quantity]`, '1');\r\n    });\r\n\r\n    const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: bodyParams\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error creating checkout session: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n\r\n    if (data.url) {\r\n      sessionId = data.id;\r\n      const attributeTasks = selectedMeasurementIds.map(mId => {\r\n        return new Promise((resolve, reject) => {\r\n          attributeService.saveEntityAttributes(\r\n            { entityType: 'ASSET', id: mId },\r\n            \"SERVER_SCOPE\",\r\n            [{ key: \"sessionId\", value: sessionId }]\r\n          ).subscribe(resolve, reject);\r\n        });\r\n      });\r\n      await Promise.all(attributeTasks);\r\n\r\n      instance.dialogRef.close(null);\r\n      window.location.href = data.url;\r\n    } else {\r\n      console.error('Checkout session URL not found in response');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating checkout session:', error);\r\n  }\r\n}\r\n\r\nasync function checkPaymentStatus(sessionId, entityId) {\r\n  try {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      await fetchStripeKeysAndCustomerId();\r\n    }\r\n    const response = await fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n\r\n    if (data.payment_status === 'paid') {\r\n      alert('Payment completed successfully!');\r\n      const selectedIdsString = localStorage.getItem('selectedMeasurementIds');\r\n      if (selectedIdsString) {\r\n        const selectedMeasurementIds = JSON.parse(selectedIdsString);\r\n        const attributeTasks = selectedMeasurementIds.map(mId => {\r\n          return new Promise((resolve, reject) => {\r\n            attributeService.saveEntityAttributes(\r\n              { entityType: 'ASSET', id: mId },\r\n              \"SERVER_SCOPE\",\r\n              [{ key: \"analysis\", value: true }]\r\n            ).subscribe(resolve, reject);\r\n          });\r\n        });\r\n        await Promise.all(attributeTasks);\r\n      }\r\n      localStorage.removeItem('selectedMeasurementIds');\r\n      return 'paid';\r\n    } else {\r\n      alert('Payment was not successful. Please try again.');\r\n      return data.payment_status;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking payment status:', error);\r\n    return 'error';\r\n  }\r\n}\r\n\r\nasync function fetchStripeKeysAndCustomerId() {\r\n  return new Promise((resolve, reject) => {\r\n    assetService.getAssetInfo(projectID).subscribe(info => {\r\n      customerId = info.customerId;\r\n      attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n        customerStripeId = stripeId[0].value;\r\n        attributeService.getEntityAttributes({ entityType: 'TENANT', id: tenantId }, \"SERVER_SCOPE\", ['stripeKey'])\r\n          .subscribe(attribute => {\r\n            stripeSecretKey = attribute[0].value;\r\n            resolve();\r\n          }, reject);\r\n      }, reject);\r\n    }, reject);\r\n  });\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "71aba539-7d5a-3fcc-4a3f-848a34924d2b"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "pageSize": 1024,
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "titleIcon": null,
          "iconColor": null
        },
        "row": 0,
        "col": 0,
        "id": "a5b8a12b-275c-986c-6a8c-6550f4387837",
        "typeFullFqn": "system.cards.entities_table"
      },
      "0b0d0bdd-688f-a26b-aec4-aee6d6d2e295": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "attribute",
                  "label": "name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7994729585988791
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8471925107896185
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.5649726231213095
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9029752783449481
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8119213318171292
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.6893217579882855
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\r\nvar majorCount = data[0]['majorAlarmsCount'];\r\nvar userRole = data[1].role;\r\n/*console.log(\"role:\", userRole);*/\r\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\r\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\r\nvar type;\r\nvar locationName;\r\nif (data && data.length) {\r\n    locationName = data[0]['locationName'] || 'N/A';\r\n    type = data[0]['Type'];\r\n} else {\r\n    locationName = 'N/A';\r\n    type = 'N/A';\r\n}\r\n\r\nvar ButtonHtml = '';\r\nif (userRole !== \"Belimo Retrofit Users\") {\r\n    ButtonHtml =\r\n        '<button id=\"parameters-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\r\n          '<span>Parameters</span>' +\r\n        '</button>' +\r\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\r\n          '<span>Projects</span>' +\r\n        '</button>';\r\n}\r\n\r\nvar header =\r\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\" fxLayoutGap=\"16px\" style=\"height: 100%; width: 100%; padding-top: 3px;\">' +\r\n    \r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"padding-left: 10px;\">' +\r\n        '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\r\n          '<mat-icon>arrow_back</mat-icon>' +\r\n        '</button>' +\r\n        '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' +\r\n      '</div>' +\r\n\r\n      /*'<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\">' +\r\n        '<div id=\"critical-alarms\" class=\"alarm-badge ' + criticalClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + criticalCount + '</span> Critical' +\r\n        '</div>' +\r\n        '<div id=\"major-alarms\" class=\"alarm-badge ' + majorClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + majorCount + '</span> Major' +\r\n        '</div>' +\r\n      '</div>' +*/\r\n\r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"8px\" style=\"padding-right: 10px;\">' +\r\n        /*'<button id=\"sensorData-button\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\r\n            '<mat-icon class=\"tb-mat-18\">sensors</mat-icon>' +\r\n            '<span>Sensor Data</span>' +\r\n          '</button>' +*/\r\n          '<button id=\"details-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\r\n          '<span>Details</span>' +\r\n        '</button>' +\r\n          ButtonHtml +\r\n        '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\r\n          '<span>Reports</span>' +\r\n        '</button>' +\r\n      '</div>' +\r\n    '</div>';\r\n\r\nreturn header;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n/*.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n*/\n.header {\n    height: 60px;                    /* Fixed height for medium screens */\n    display: flex;                   /* Use Flexbox for layout */\n    align-items: center;             /* Vertically center content */\n    justify-content: space-between;  /* Space items evenly horizontally */\n    padding: 0 20px;                 /* Horizontal padding only */\n    box-sizing: border-box;          /* Include padding in height */\n}\n\n/* Small screens: up to 600px wide */\n@media (max-width: 600px) {\n    .main-layout .header {\n        height: 50px;   /* Smaller height for small screens */\n        padding: 0 10px; /* Reduced horizontal padding */\n    }\n}\n\n/* Medium screens: 601px to 1024px */\n@media (min-width: 601px) and (max-width: 1024px) {\n    .main-layout .header {\n        height: 60px;    /* Default height */\n        padding: 0 15px; /* Adjust padding if needed */\n    }\n}\n\n/* Large screens: 1025px and above */\n@media (min-width: 1025px) {\n    .main-layout .header {\n        height: 70px;   /* Increased height for larger screens */\n        padding: 0 20px; /* Maintain horizontal padding */\n    }\n}\n\n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#parameters-button, #sensorData-button, #details-button, #projects-button, #report-button, #reports-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#parameters-button:hover, #sensorData-button:hover, #details-button:hover, #projects-button:hover, #report-button:hover, #reports-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#parameters-button mat-icon, #sensorData-button mat-icon, #details-button mat-icon, #projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#parameters-button span, #sensorData-button span, #details-button span, #projects-button span, #report-button span, #reports-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\nvar number = (widgetContext.stateController.getStateIndex())-1;\r\n\r\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\r\nwidgetContext.stateController.updateState(null,params);\r\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "details-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedKitAvailable || !assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedAssetsAndDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAssignedDevices(doktorkitId, assignedDoktorkitName) {\r\n    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: doktorkitId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Contains\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedDoktorkitName, assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDoktorkitName, assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedDoktorkitName,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedDoktorkitName,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedDoktorkitName !=='No Kit assigned' && assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n\r\n    vm.assignedKitAvailable = assignedDoktorkitName !== 'No Kit assigned!';\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedKit: [{ value: assignedDoktorkitName, disabled: true }, [vm.validators.required]],\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedKitAvailable || !vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "parameters-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <!--<mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>-->\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\n/*function fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}*/\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n/*    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }*/\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes('No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a3dee8ab-4de6-47d0-f54d-daa34853388b"
              },
              {
                "name": "sensorData-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e03cb06f-f0bb-73ef-09c9-8c443eaf3465"
              },
              {
                "name": "reports-button TODO",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "openRightLayout": false,
                "setEntityId": true,
                "stateEntityParamName": null,
                "id": "14b9862c-e434-2941-6ba4-fb09ae05d506"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "0b0d0bdd-688f-a26b-aec4-aee6d6d2e295"
      },
      "ac58fb06-a63f-26ea-d465-8532c8124780": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.project-administration.project-administration}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": true,
            "entityNameColumnTitle": "ID",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Projects",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
              "filterId": "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.23547368231999988,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-administration.address}",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8348661406382081,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-administration.progress}",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar description;\r\nvar state = value;\r\nif (state == 'active') { // all key values here are strings\r\n  color = '#f3de61'; // Yellow\r\n  description = '{i18n:custom.diagnostics.state-filter.active.title}';\r\n} else if (state == 'in preparation') {\r\n  /*color = '#005757';*/\r\n  /*color = '#eef30b';*/\r\n  color = '#CAC1D2';// Grey\r\n   description = '{i18n:custom.diagnostics.state-filter.preparation.title}';\r\n}else if (state == 'aborted') {\r\n  /*color = '#005757';*/\r\n  /*color = '#eef30b';*/\r\n  color = '#EB5757';// Grey\r\n   description = '{i18n:custom.diagnostics.state-filter.aborted.title}';\r\n}\r\nelse {\r\n  color = '#27AE60';//Green\r\n  description = '{i18n:custom.diagnostics.state-filter.finished.title}';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>' + ' ' + description;\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.15334267783981326,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "generalReport",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-administration.report}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar generalReport = value;\r\nvar state;\r\nif (generalReport == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n  state = '{i18n:custom.measurement.administration.report.paid}';\r\n} else {\r\n  color = '#EB5757';\r\n  state = '{i18n:custom.measurement.administration.report.inactive}';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>' + ' ' + state;",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.8238525865888777,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "{i18n:custom.diagnostics.project-administration.open-measurements}",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "measurements_new",
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "{i18n:custom.diagnostics.project-administration.general-report}",
                "icon": "verified",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "/*var userRole = widgetContext.stateController.getStateParams().userRole;\nif(userRole !==\"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\"){\n    return true;\n}else{\n    return false;\n}*/\n\nreturn false;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" (ngSubmit)=\"checkout()\" class=\"add-entity-form\" [formGroup]=\"addEntityFormGroup\">\r\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n        <h2>{{'custom.measurement.administration.unlock-report.payment-options' | translate}}</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <div mat-dialog-content fxLayout=\"column\">\r\n        <div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"32px\">\r\n            <div fxLayout=\"column\">\r\n                <div>{{'custom.measurement.administration.unlock-report.pay-by-invoice' | translate}}</div>\r\n                <mat-checkbox [checked]=\"buyInvoice\" (change)=\"onSelectBuyInvoice($event)\"></mat-checkbox>\r\n            </div>\r\n            <div fxLayout=\"column\">\r\n                <div>{{'custom.measurement.administration.unlock-report.credit-card.alternative-payments' | translate}}</div>\r\n                <mat-checkbox [checked]=\"buyCard\" (change)=\"onSelectBuyCard($event)\"></mat-checkbox>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\r\n            {{'action.cancel' | translate}}\r\n        </button>\r\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || (!buyInvoice && !buyCard)\">\r\n            {{'custom.measurement.administration.unlock-report.checkout' | translate}}\r\n        </button>\r\n    </div>\r\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet PageLink = widgetContext.pageLink;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet assetProfileService = $injector.get(widgetContext.servicesMap.get('assetProfileService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\nlet translationService = $injector.get(widgetContext.servicesMap.get('translate'));\r\nlet stripeSecretKey;\r\nlet sessionId = '';\r\nlet products = [];\r\nlet projectID = entityId.id;\r\nlet customerId;\r\nlet customerStripeId;\r\nlet bearerToken = '';\r\n\r\nvar customer;\r\nif (widgetContext.currentUser.authority !== 'CUSTOMER_USER') {\r\n  customer = widgetContext.stateController.getStateParams().entityId;  \r\n} else {\r\n  customer = { entityType: \"CUSTOMER\", id: widgetContext.currentUser.customerId };\r\n}\r\nconsole.log(\"customer\",customer);\r\nlet projectName = '';\r\nvar url = window.location.href;\r\n\r\nfunction getQueryParam(param) {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  return urlParams.get(param);\r\n}\r\n\r\nconst sessionIdFromUrl = getQueryParam('session_id');\r\nif (sessionIdFromUrl) {\r\n  window.history.replaceState({}, document.title, window.location.pathname);\r\n  localStorage.removeItem('selectedProjectId');\r\n  checkPaymentStatus(sessionIdFromUrl, projectID);\r\n} else {\r\n  initialize();\r\n}\r\n\r\nfunction initialize() {\r\n  const pageLink = PageLink(50, 0);\r\n  const query = {\r\n    parameters: {\r\n      rootId: customer.id,\r\n      rootType: \"TENANT\",\r\n      direction: \"FROM\",\r\n      relationTypeGroup: \"COMMON\",\r\n      maxLevel: 1,\r\n      fetchLastLevelOnly: false\r\n    },\r\n    relationType: \"Contains\",\r\n    assetTypes: [\"Product\"]\r\n  };\r\n\r\n  assetService.getAssetInfo(projectID).subscribe(info => {\r\n    customerId = info.customerId;\r\n    projectName = info.name || projectID;\r\n    /*console.log(\"projectID\", projectID);*/\r\n    checkSingleProjectStatus(projectID).then(result => {\r\n        /*console.log(\"result Proje\", result)*/\r\n      if (result === 'paid') {\r\n        alert(translationService.instant('custom.payment.alert.project-already-has-general-report'));\r\n      } else if (result === 'openInvoice') {\r\n        alert(translationService.instant('custom.payment.alert.open-invoice'));\r\n      } else {\r\n        attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n          customerStripeId = stripeId[0].value;\r\n          attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey'])\r\n            .subscribe(attribute => {\r\n              stripeSecretKey = attribute[0].value;\r\n              fetch('https://cloud.pke-iot.expert/api/auth/login', {\r\n                method: 'POST',\r\n                headers: {\r\n                  'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                  \"username\": \"belimo.api@pke-iot.expert\",\r\n                  \"password\": \"vfx3cvr@VMJ3bxk3urg\"\r\n                })\r\n              })\r\n              .then(resp => resp.json())\r\n              .then(loginData => {\r\n                bearerToken = loginData.token;\r\n                return fetch('https://cloud.pke-iot.expert/api/assets', {\r\n                  method: 'POST',\r\n                  headers: {\r\n                    'accept': 'application/json',\r\n                    'Content-Type': 'application/json',\r\n                    'X-Authorization': 'Bearer ' + bearerToken\r\n                  },\r\n                  body: JSON.stringify(query)\r\n                });\r\n              })\r\n              .then(resp2 => resp2.json())\r\n              .then(assets => {\r\n                /*console.log(\"All fetched products:\", assets);*/\r\n                let filteredProducts = [];\r\n                let productFetches = assets.map(asset => {\r\n                  return new Promise((resolve, reject) => {\r\n                    fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${asset.id.id}/values/attributes?keys=prodType`, {\r\n                      method: 'GET',\r\n                      headers: {\r\n                        'accept': 'application/json',\r\n                        'X-Authorization': 'Bearer ' + bearerToken\r\n                      }\r\n                    })\r\n                    .then(resp3 => resp3.json())\r\n                    .then(attributes => {\r\n                      if (attributes.length > 0 && attributes[0].key === 'prodType' && attributes[0].value === 'generalReport') {\r\n                        filteredProducts.push(asset);\r\n                      }\r\n                      resolve();\r\n                    })\r\n                    .catch(err => {\r\n                      console.error(\"Error fetching prodType:\", err);\r\n                      resolve();\r\n                    });\r\n                  });\r\n                });\r\n                Promise.all(productFetches).then(() => {\r\n                  /*console.log(\"Filtered products:\", filteredProducts);*/\r\n                  products = filteredProducts;\r\n                  openAddEntityDialog();\r\n                });\r\n              })\r\n              .catch(error => {\r\n                console.error(\"Error fetching products:\", error);\r\n                alert(translationService.instant('custom.payment.alert.fetch-products-failed'));\r\n              });\r\n            });\r\n        });\r\n      }\r\n    }).catch(err => {\r\n      console.error('Error checking project status:', err);\r\n      alert(translationService.instant('custom.payment.alert.check-project-status-failed'));\r\n    });\r\n  });\r\n}\r\n\r\nfunction openAddEntityDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n  let vm = instance;\r\n  vm.products = products;\r\n  vm.buyInvoice = false;\r\n  vm.buyCard = false;\r\n\r\n  vm.addEntityFormGroup = vm.fb.group({});\r\n\r\n  vm.onSelectBuyInvoice = function(event) {\r\n    vm.buyInvoice = event.checked;\r\n    if (vm.buyInvoice) {\r\n      vm.buyCard = false;\r\n    }\r\n  };\r\n\r\n  vm.onSelectBuyCard = function(event) {\r\n    vm.buyCard = event.checked;\r\n    if (vm.buyCard) {\r\n      vm.buyInvoice = false;\r\n    }\r\n  };\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n\r\n  vm.checkout = function () {\r\n    if (!vm.products.length) {\r\n      alert(translationService.instant('custom.payment.alert.product-not-found'));\r\n      vm.dialogRef.close(null);\r\n      return;\r\n    }\r\n    const productId = vm.products[0].id.id;\r\n    fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${productId}/values/attributes?keys=price_stripe_id`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'accept': 'application/json',\r\n        'X-Authorization': 'Bearer ' + bearerToken\r\n      }\r\n    })\r\n    .then(resp => resp.json())\r\n    .then(attributes => {\r\n      let priceIdObj = attributes.find(attr => attr.key === 'price_stripe_id');\r\n      if (priceIdObj) {\r\n        const priceId = priceIdObj.value;\r\n        if (vm.buyInvoice) {\r\n          createInvoiceForOneTimePurchase(priceId, instance);\r\n        } else if (vm.buyCard) {\r\n          createCheckoutSession(priceId, instance);\r\n        } else {\r\n          alert(translationService.instant('custom.payment.alert.select-payment-method'));\r\n        }\r\n      } else {\r\n        console.error('Price ID not found for the product (price_stripe_id).');\r\n        vm.dialogRef.close(null);\r\n      }\r\n    })\r\n    .catch(err => {\r\n      console.error('Error fetching price_stripe_id:', err);\r\n      vm.dialogRef.close(null);\r\n    });\r\n  };\r\n}\r\n\r\nasync function createInvoiceForOneTimePurchase(priceId, instance) {\r\n  try {\r\n    const priceResp = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResp.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResp.statusText}`);\r\n    }\r\n    const priceData = await priceResp.json();\r\n    const amount = priceData.unit_amount;\r\n    const currency = priceData.currency;\r\n\r\n    let invoiceBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      auto_advance: 'false',\r\n      collection_method: 'send_invoice',\r\n      days_until_due: '14'\r\n    });\r\n    const invoiceResp = await fetch('https://api.stripe.com/v1/invoices', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceBody\r\n    });\r\n    if (!invoiceResp.ok) {\r\n      throw new Error(`Error creating draft invoice: ${invoiceResp.statusText}`);\r\n    }\r\n    const invoiceData = await invoiceResp.json();\r\n\r\n    let invoiceItemBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      invoice: invoiceData.id,\r\n      amount: amount.toString(),\r\n      currency: currency,\r\n      description: `One-time purchase for project: ${projectName}`\r\n    });\r\n    const invoiceItemResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceItemBody\r\n    });\r\n    if (!invoiceItemResp.ok) {\r\n      throw new Error(`Error creating invoice item: ${invoiceItemResp.statusText}`);\r\n    }\r\n    await invoiceItemResp.json();\r\n\r\n    const finalizeResp = await fetch(`https://api.stripe.com/v1/invoices/${invoiceData.id}/finalize`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!finalizeResp.ok) {\r\n      throw new Error(`Error finalizing invoice: ${finalizeResp.statusText}`);\r\n    }\r\n    const finalizedInvoice = await finalizeResp.json();\r\n\r\n    const attributes = [\r\n      { key: \"generalReport\", value: false },\r\n      { key: \"invoiceId\", value: invoiceData.id }\r\n    ];\r\n    attributeService.saveEntityAttributes(\r\n      { entityType: 'ASSET', id: projectID },\r\n      \"SERVER_SCOPE\",\r\n      attributes\r\n    ).subscribe(\r\n      () => {\r\n        alert(translationService.instant('custom.payment.alert.invoice-created'));\r\n        instance.dialogRef.close(null);\r\n      },\r\n      (error) => {\r\n        console.error('Error updating generalReport attribute:', error);\r\n        instance.dialogRef.close(null);\r\n      }\r\n    );\r\n  } catch (err) {\r\n    console.error(\"Error creating invoice:\", err);\r\n    alert(translationService.instant('custom.payment.alert.invoice-creation-failed'));\r\n    instance.dialogRef.close(null);\r\n  }\r\n}\r\n\r\nasync function createCheckoutSession(priceId, instance) {\r\n  try {\r\n    const priceResponse = await fetch(`https://api.stripe.com/v1/prices/${priceId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!priceResponse.ok) {\r\n      throw new Error(`Error fetching price details: ${priceResponse.statusText}`);\r\n    }\r\n    const priceData = await priceResponse.json();\r\n    const isRecurring = priceData.recurring !== null;\r\n    const mode = isRecurring ? 'subscription' : 'payment';\r\n    const successUrl = url;\r\n    const cancelUrl = url;\r\n\r\n    const bodyParams = new URLSearchParams({\r\n      'success_url': successUrl,\r\n      'cancel_url': cancelUrl,\r\n      'payment_method_types[]': 'card',\r\n      'mode': mode,\r\n      'customer': customerStripeId\r\n    });\r\n    bodyParams.append('line_items[0][price_data][currency]', priceData.currency);\r\n    bodyParams.append('line_items[0][price_data][unit_amount]', String(priceData.unit_amount));\r\n    bodyParams.append('line_items[0][price_data][product_data][name]', `One-time purchase for: ${projectName}`);\r\n    bodyParams.append('line_items[0][quantity]', '1');\r\n\r\n    const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: bodyParams\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.url) {\r\n      sessionId = data.id;\r\n      localStorage.setItem('sessionId', sessionId);\r\n      await new Promise((resolve, reject) => {\r\n        attributeService.saveEntityAttributes(\r\n          { entityType: 'ASSET', id: projectID },\r\n          \"SERVER_SCOPE\",\r\n          [{ key: \"sessionId\", value: sessionId }]\r\n        ).subscribe(\r\n          () => resolve(),\r\n          (error) => {\r\n            console.error('Error saving session ID attribute:', error);\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n      instance.dialogRef.close(null);\r\n      window.location.href = data.url;\r\n    } else {\r\n      console.error('Checkout session URL not found in response');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating checkout session:', error);\r\n  }\r\n}\r\n\r\nasync function checkPaymentStatus(sessionId, entityId) {\r\n  try {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      await fetchStripeKeysAndCustomerId();\r\n    }\r\n    const response = await fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.payment_status === 'paid') {\r\n      alert(translationService.instant('custom.payment.alert.payment-successful'));\r\n      const attributes = [\r\n        { key: \"generalReport\", value: true }\r\n      ];\r\n      attributeService.saveEntityAttributes(\r\n        { entityType: 'ASSET', id: projectID },\r\n        \"SERVER_SCOPE\",\r\n        attributes\r\n      ).subscribe(\r\n        () => {},\r\n        (error) => {\r\n          console.error('Error saving generalReport attribute:', error);\r\n        }\r\n      );\r\n      return 'paid';\r\n    } else {\r\n      alert(translationService.instant('custom.payment.alert.payment-failed'));\r\n      return data.payment_status;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking payment status:', error);\r\n    return 'error';\r\n  }\r\n}\r\n\r\nasync function fetchStripeKeysAndCustomerId() {\r\n  return new Promise((resolve, reject) => {\r\n    assetService.getAssetInfo(projectID).subscribe(info => {\r\n      customerId = info.customerId;\r\n      projectName = info.name || projectID;\r\n      attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n        customerStripeId = stripeId[0].value;\r\n        attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey']).subscribe(attribute => {\r\n          stripeSecretKey = attribute[0].value;\r\n          resolve();\r\n        }, reject);\r\n      }, reject);\r\n    }, reject);\r\n  });\r\n}\r\n\r\nfunction checkSingleProjectStatus(mId) {\r\n  return new Promise((resolve, reject) => {\r\n    attributeService.getEntityAttributes(\r\n      { entityType: 'ASSET', id: mId },\r\n      \"SERVER_SCOPE\",\r\n      ['generalReport','invoiceId','sessionId']\r\n    ).subscribe(attrs => {\r\n      /*console.log(\"attrs\", attrs);*/\r\n      let generalReportVal = false;\r\n      let invoiceIdVal = null;\r\n      let sessionIdVal = null;\r\n      attrs.forEach(a => {\r\n        if (a.key === 'generalReport') generalReportVal = a.value;\r\n        if (a.key === 'invoiceId') invoiceIdVal = a.value;\r\n        if (a.key === 'sessionId') sessionIdVal = a.value;\r\n      });\r\n      if (generalReportVal === true) {\r\n        resolve(\"paid\");\r\n      } else {\r\n        if (sessionIdVal) {\r\n          checkStripeSessionPaid(sessionIdVal).then(isSessionPaid => {\r\n            if (isSessionPaid) {\r\n              resolve(\"paid\");\r\n            } else if (invoiceIdVal) {\r\n              checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n                if (invStatus === 'paid') resolve(\"paid\");\r\n                else if (invStatus === 'open') resolve(\"openInvoice\");\r\n                else resolve(\"unpaid\");\r\n              }).catch(() => reject());\r\n            } else {\r\n              resolve(\"unpaid\");\r\n            }\r\n          }).catch(() => reject());\r\n        } else if (invoiceIdVal) {\r\n          checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n            if (invStatus === 'paid') resolve(\"paid\");\r\n            else if (invStatus === 'open') resolve(\"openInvoice\");\r\n            else resolve(\"unpaid\");\r\n          }).catch(() => reject());\r\n        } else {\r\n          resolve(\"unpaid\");\r\n        }\r\n      }\r\n    }, err => reject(err));\r\n  });\r\n}\r\n\r\nfunction checkStripeSessionPaid(sid) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sid}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.payment_status === 'paid') resolve(true);\r\n        else resolve(false);\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n\r\nfunction checkStripeInvoice(invoiceIdVal) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceIdVal}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.status === 'paid') {\r\n          resolve('paid');\r\n        } else if (d.status === 'open' || d.status === 'draft') {\r\n          resolve('open');\r\n        } else {\r\n          resolve(d.status);\r\n        }\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "af52af6c-467d-ec11-91da-d10ad68c7c7a"
              },
              {
                "name": "{i18n:custom.diagnostics.project-administration.activate-all-reports}",
                "icon": "mdi:file-chart",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "/*var userRole = widgetContext.stateController.getStateParams().userRole;\nif(userRole !==\"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\"){\n    return true;\n}else{\n    return false;\n}*/\n\nreturn false;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" (ngSubmit)=\"checkout()\" class=\"add-entity-form\" [formGroup]=\"addEntityFormGroup\">\r\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n        <h2>{{'custom.measurement.administration.unlock-report.payment-options' | translate}}</h2>\r\n        <span fxFlex></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon class=\"material-icons\">close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <div mat-dialog-content fxLayout=\"column\">\r\n        <div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"32px\">\r\n            <div fxLayout=\"column\">\r\n                <div>{{'custom.measurement.administration.unlock-report.pay-by-invoice' | translate}}</div>\r\n                <mat-checkbox [checked]=\"buyInvoice\" (change)=\"onSelectBuyInvoice($event)\"></mat-checkbox>\r\n            </div>\r\n            <div fxLayout=\"column\">\r\n                <div>{{'custom.measurement.administration.unlock-report.credit-card.alternative-payments' | translate}}</div>\r\n                <mat-checkbox [checked]=\"buyCard\" (change)=\"onSelectBuyCard($event)\"></mat-checkbox>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n        <button mat-button color=\"primary\" type=\"button\" [disabled]=\"(isLoading$ | async)\" (click)=\"cancel()\" cdkFocusInitial>\r\n            {{'action.cancel' | translate}}\r\n        </button>\r\n        <button mat-button mat-raised-button color=\"primary\" type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || (!buyInvoice && !buyCard)\">\r\n            {{'custom.measurement.administration.unlock-report.checkout' | translate}}\r\n        </button>\r\n    </div>\r\n</form>",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet PageLink = widgetContext.pageLink;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet assetProfileService = $injector.get(widgetContext.servicesMap.get('assetProfileService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\nlet translationService = $injector.get(widgetContext.servicesMap.get('translate'));\r\nlet stripeSecretKey;\r\nlet sessionId = '';\r\nlet bearerToken = '';\r\nlet projectID = entityId.id;\r\nlet customerId;\r\nlet customerStripeId;\r\nlet projectName = '';\r\nlet measurements;\r\nvar customer;\r\nif (widgetContext.currentUser.authority !== 'CUSTOMER_USER') {\r\n  customer = widgetContext.stateController.getStateParams().entityId;  \r\n} else {\r\n  customer = { entityType: \"CUSTOMER\", id: widgetContext.currentUser.customerId };\r\n}\r\nvar url = window.location.href;\r\n\r\n// Global variables for products\r\nlet productGeneral, productUltrasonic, productLoraWan;\r\n\r\n// Helper: get query parameter from URL\r\nfunction getQueryParam(param) {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  return urlParams.get(param);\r\n}\r\n\r\n// Provided function to get related sensors for a measurement (loraWan type)\r\nfunction getRelatedSensors(measurementId){\r\n    let deviceQuery = {\r\n      parameters: {\r\n        rootId: measurementId,\r\n        rootType: \"ASSET\",\r\n        direction: \"FROM\",\r\n        relationTypeGroup: \"COMMON\",\r\n        maxLevel: 1073741824,\r\n        fetchLastLevelOnly: true\r\n      },\r\n      relationType: \"Measurement\",\r\n      deviceTypes: [\"Room Sensor CO2\"]\r\n    }\r\n    return deviceService.findByQuery(deviceQuery);\r\n}\r\n\r\n// First, fetch all measurements for the project (assets of type \"Measurement\")\r\nlet assetSearchQuery = {\r\n  \"parameters\": {\r\n    \"rootId\": projectID,\r\n    \"rootType\": \"ASSET\",\r\n    \"direction\": \"FROM\",\r\n    \"relationTypeGroup\": \"COMMON\",\r\n    \"maxLevel\": 10,\r\n    \"fetchLastLevelOnly\": false\r\n  },\r\n  \"relationType\": \"Owns\",\r\n  \"assetTypes\": [\r\n    \"Measurement\"\r\n  ]\r\n};\r\n\r\nassetService.findByQuery(assetSearchQuery).subscribe(response => {\r\n  measurements = response;\r\n  console.log(\"measurements\", measurements);\r\n  const sessionIdFromUrl = getQueryParam('session_id');\r\n  if (sessionIdFromUrl) {\r\n    window.history.replaceState({}, document.title, window.location.pathname);\r\n    localStorage.removeItem('selectedProjectId');\r\n    checkPaymentStatus(sessionIdFromUrl, projectID);\r\n  } else {\r\n    initialize();\r\n  }\r\n});\r\n\r\n// Main initialization: fetch project info, check payment status and then fetch Products\r\nfunction initialize() {\r\n  // Get project info to obtain customer and project name\r\n  assetService.getAssetInfo(projectID).subscribe(info => {\r\n    customerId = info.customerId;\r\n    projectName = info.name || projectID;\r\n    checkSingleProjectStatus(projectID).then(result => {\r\n      if (result === 'paid') {\r\n        alert(translationService.instant('custom.payment.alert.project-already-has-general-report'));\r\n      } else if (result === 'openInvoice') {\r\n        alert(translationService.instant('custom.payment.alert.open-invoice'));\r\n      } else {\r\n        // Fetch stripe keys\r\n        attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n          customerStripeId = stripeId[0].value;\r\n          attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey'])\r\n            .subscribe(attribute => {\r\n              stripeSecretKey = attribute[0].value;\r\n              // Login to get bearer token for REST calls\r\n              fetch('https://cloud.pke-iot.expert/api/auth/login', {\r\n                method: 'POST',\r\n                headers: {\r\n                  'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                  \"username\": \"belimo.api@pke-iot.expert\",\r\n                  \"password\": \"vfx3cvr@VMJ3bxk3urg\"\r\n                })\r\n              })\r\n              .then(resp => resp.json())\r\n              .then(loginData => {\r\n                bearerToken = loginData.token;\r\n                // Query for Products from customer using a Contains relation.\r\n                const query = {\r\n                  parameters: {\r\n                    rootId: customerId.id,\r\n                    rootType: \"CUSTOMER\",\r\n                    direction: \"FROM\",\r\n                    relationTypeGroup: \"COMMON\",\r\n                    maxLevel: 1,\r\n                    fetchLastLevelOnly: false\r\n                  },\r\n                  relationType: \"Contains\",\r\n                  assetTypes: [\"Product\"]\r\n                };\r\n                return fetch('https://cloud.pke-iot.expert/api/assets', {\r\n                  method: 'POST',\r\n                  headers: {\r\n                    'accept': 'application/json',\r\n                    'Content-Type': 'application/json',\r\n                    'X-Authorization': 'Bearer ' + bearerToken\r\n                  },\r\n                  body: JSON.stringify(query)\r\n                });\r\n              })\r\n              .then(resp2 => resp2.json())\r\n              .then(assets => {\r\n                // Filter and assign products based on prodType.\r\n                let productFetches = assets.map(asset => {\r\n                  return new Promise((resolve) => {\r\n                    fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${asset.id.id}/values/attributes?keys=prodType,price_stripe_id`, {\r\n                      method: 'GET',\r\n                      headers: {\r\n                        'accept': 'application/json',\r\n                        'X-Authorization': 'Bearer ' + bearerToken\r\n                      }\r\n                    })\r\n                    .then(resp3 => resp3.json())\r\n                    .then(attributes => {\r\n                      if (attributes && attributes.length > 0) {\r\n                        let prodTypeAttr = attributes.find(a => a.key === 'prodType');\r\n                        // Depending on prodType assign to the proper product variable\r\n                        if (prodTypeAttr) {\r\n                          if (prodTypeAttr.value === 'generalReport') {\r\n                            productGeneral = asset;\r\n                          } else if (prodTypeAttr.value === 'detailReportUltrasonic') {\r\n                            productUltrasonic = asset;\r\n                          } else if (prodTypeAttr.value === 'detailReportLoraWan') {\r\n                            productLoraWan = asset;\r\n                          }\r\n                        }\r\n                      }\r\n                      resolve();\r\n                    })\r\n                    .catch(err => {\r\n                      console.error(\"Error fetching product attributes:\", err);\r\n                      resolve();\r\n                    });\r\n                  });\r\n                });\r\n                Promise.all(productFetches).then(() => {\r\n                  if (!productGeneral) {\r\n                    alert(translationService.instant('custom.payment.alert.general-report-product-not-found'));\r\n                    return;\r\n                  }\r\n                  // Now open the dialog for checkout\r\n                  openAddEntityDialog();\r\n                });\r\n              })\r\n              .catch(error => {\r\n                console.error(\"Error fetching products:\", error);\r\n                alert(translationService.instant('custom.payment.alert.failed-to-fetch'));\r\n              });\r\n            });\r\n        });\r\n      }\r\n    }).catch(err => {\r\n      console.error('Error checking project status:', err);\r\n      alert(translationService.instant('custom.payment.alert.failed-to-check'));\r\n    });\r\n  });\r\n}\r\n\r\nfunction openAddEntityDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\r\n}\r\n\r\nfunction AddEntityDialogController(instance) {\r\n  let vm = instance;\r\n  // For display purposes we may show available products (optional)\r\n  vm.products = {\r\n    general: productGeneral,\r\n    ultrasonic: productUltrasonic,\r\n    loraWan: productLoraWan\r\n  };\r\n  vm.buyInvoice = false;\r\n  vm.buyCard = false;\r\n  vm.addEntityFormGroup = vm.fb.group({});\r\n\r\n  vm.onSelectBuyInvoice = function(event) {\r\n    vm.buyInvoice = event.checked;\r\n    if (vm.buyInvoice) {\r\n      vm.buyCard = false;\r\n    }\r\n  };\r\n\r\n  vm.onSelectBuyCard = function(event) {\r\n    vm.buyCard = event.checked;\r\n    if (vm.buyCard) {\r\n      vm.buyInvoice = false;\r\n    }\r\n  };\r\n\r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n\r\n  // When checking out, fetch price details for each product and compute totals for measurements.\r\n  vm.checkout = function () {\r\n    if (!productGeneral) {\r\n      alert(translationService.instant('custom.payment.alert.no-general-report-product-found'));\r\n      vm.dialogRef.close(null);\r\n      return;\r\n    }\r\n    // Helper: fetch price data for a given product asset.\r\n    function fetchPriceData(product) {\r\n      return new Promise((resolve, reject) => {\r\n        if (!product) {\r\n          return resolve(null);\r\n        }\r\n        fetch(`https://cloud.pke-iot.expert/api/plugins/telemetry/ASSET/${product.id.id}/values/attributes?keys=price_stripe_id`, {\r\n          method: 'GET',\r\n          headers: {\r\n            'accept': 'application/json',\r\n            'X-Authorization': 'Bearer ' + bearerToken\r\n          }\r\n        })\r\n        .then(resp => resp.json())\r\n        .then(attributes => {\r\n          let priceIdObj = attributes.find(attr => attr.key === 'price_stripe_id');\r\n          if (priceIdObj) {\r\n            // Fetch the price details from Stripe\r\n            fetch(`https://api.stripe.com/v1/prices/${priceIdObj.value}`, {\r\n              method: 'GET',\r\n              headers: {\r\n                'Authorization': `Bearer ${stripeSecretKey}`\r\n              }\r\n            })\r\n            .then(resp2 => {\r\n              if (!resp2.ok) {\r\n                throw new Error(resp2.statusText);\r\n              }\r\n              return resp2.json();\r\n            })\r\n            .then(priceData => {\r\n              resolve(priceData);\r\n            })\r\n            .catch(err => {\r\n              console.error(\"Error fetching Stripe price:\", err);\r\n              reject(err);\r\n            });\r\n          } else {\r\n            reject(\"Price ID not found for product \" + product.id.id);\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.error(\"Error fetching price_stripe_id:\", err);\r\n          reject(err);\r\n        });\r\n      });\r\n    }\r\n\r\n    Promise.all([\r\n      fetchPriceData(productGeneral),\r\n      fetchPriceData(productUltrasonic),\r\n      fetchPriceData(productLoraWan)\r\n    ]).then(([generalPriceData, ultrasonicPriceData, loraWanPriceData]) => {\r\n      if (vm.buyInvoice) {\r\n        createInvoiceForOneTimePurchase(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance);\r\n      } else if (vm.buyCard) {\r\n        createCheckoutSession(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance);\r\n      } else {\r\n        alert(translationService.instant('custom.payment.alert.payment.method'));\r\n      }\r\n    }).catch(err => {\r\n      console.error(\"Error fetching price data:\", err);\r\n      vm.dialogRef.close(null);\r\n    });\r\n  };\r\n}\r\n\r\n// Helper: Compute measurement totals and return an object:\r\n// { ultrasonicCount, loraWanSensorCount, includedMeasurements }\r\n// Only include a measurement if its detailReport attribute is not true,\r\n// its progress attribute is not \"aborted\", and for loraWan measurements only if there is at least one sensor.\r\nfunction computeMeasurementTotals() {\r\n  let ultrasonicCount = 0;\r\n  let loraWanSensorCount = 0;\r\n  let includedMeasurements = [];\r\n  let promises = measurements.map(meas => {\r\n    return new Promise((resolve) => {\r\n      attributeService.getEntityAttributes(\r\n        { entityType: 'ASSET', id: meas.id.id },\r\n        \"SERVER_SCOPE\",\r\n        ['measurementType', 'detailReport', 'progress']\r\n      ).subscribe(attrs => {\r\n        let measurementTypeVal = null;\r\n        let detailReportVal = false;\r\n        let progressVal = null;\r\n        attrs.forEach(a => {\r\n          if (a.key === 'measurementType') {\r\n            measurementTypeVal = a.value;\r\n          }\r\n          if (a.key === 'detailReport') {\r\n            detailReportVal = a.value;\r\n          }\r\n          if (a.key === 'progress') {\r\n            progressVal = a.value;\r\n          }\r\n        });\r\n        // Skip measurement if detailReport is true or progress is \"aborted\"\r\n        if (detailReportVal === true || detailReportVal === \"true\" ||\r\n            (progressVal && progressVal.toLowerCase() === \"aborted\")) {\r\n          return resolve();\r\n        }\r\n        if (measurementTypeVal === \"ultrasonic\") {\r\n          ultrasonicCount += 1;\r\n          includedMeasurements.push(meas.id.id);\r\n          return resolve();\r\n        } else if (measurementTypeVal === \"loraWan\") {\r\n          // For loraWan, fetch related sensors and only include if sensors exist.\r\n          getRelatedSensors(meas.id.id).subscribe(response => {\r\n            if (Array.isArray(response) && response.length > 0) {\r\n              loraWanSensorCount += response.length;\r\n              includedMeasurements.push(meas.id.id);\r\n            }\r\n            resolve();\r\n          }, err => {\r\n            console.error(\"Error fetching related sensors:\", err);\r\n            resolve();\r\n          });\r\n        } else {\r\n          resolve();\r\n        }\r\n      }, err => {\r\n        console.error(\"Error fetching measurement attributes:\", err);\r\n        resolve();\r\n      });\r\n    });\r\n  });\r\n  return Promise.all(promises).then(() => ({ ultrasonicCount, loraWanSensorCount, includedMeasurements }));\r\n}\r\n\r\n// Helper: Update a set of measurements with a given attribute key/value.\r\nfunction updateMeasurementsAttributes(attributeKey, attributeValue, measurementIds) {\r\n  measurementIds.forEach(id => {\r\n    attributeService.saveEntityAttributes(\r\n      { entityType: 'ASSET', id: id },\r\n      \"SERVER_SCOPE\",\r\n      [{ key: attributeKey, value: attributeValue }]\r\n    ).subscribe(\r\n      () => { console.log(`Updated measurement ${id} with ${attributeKey}`); },\r\n      (error) => { console.error(`Error updating measurement ${id} with ${attributeKey}:`, error); }\r\n    );\r\n  });\r\n}\r\n\r\n// Create invoice for one-time purchase for project and measurements\r\nasync function createInvoiceForOneTimePurchase(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance) {\r\n  try {\r\n    // Compute measurement totals and obtain the list of measurement IDs to update.\r\n    const { ultrasonicCount, loraWanSensorCount, includedMeasurements } = await computeMeasurementTotals();\r\n    // Create a draft invoice first\r\n    let invoiceBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      auto_advance: 'false',\r\n      collection_method: 'send_invoice',\r\n      days_until_due: '14'\r\n    });\r\n    const invoiceResp = await fetch('https://api.stripe.com/v1/invoices', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceBody\r\n    });\r\n    if (!invoiceResp.ok) {\r\n      throw new Error(`Error creating draft invoice: ${invoiceResp.statusText}`);\r\n    }\r\n    const invoiceData = await invoiceResp.json();\r\n    \r\n    // Create invoice item for Project Report (generalReport)\r\n    let invoiceItemBody = new URLSearchParams({\r\n      customer: customerStripeId,\r\n      invoice: invoiceData.id,\r\n      amount: String(generalPriceData.unit_amount),\r\n      currency: generalPriceData.currency,\r\n      description: `Project Report for: ${projectName}`\r\n    });\r\n    let invoiceItemResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: invoiceItemBody\r\n    });\r\n    if (!invoiceItemResp.ok) {\r\n      throw new Error(`Error creating invoice item for project: ${invoiceItemResp.statusText}`);\r\n    }\r\n    await invoiceItemResp.json();\r\n    \r\n    // If there are ultrasonic measurements, add invoice item\r\n    if (ultrasonicCount > 0 && ultrasonicPriceData) {\r\n      let ultrasonicAmount = ultrasonicPriceData.unit_amount * ultrasonicCount;\r\n      let ultrasonicItemBody = new URLSearchParams({\r\n        customer: customerStripeId,\r\n        invoice: invoiceData.id,\r\n        amount: String(ultrasonicAmount),\r\n        currency: ultrasonicPriceData.currency,\r\n        description: `Ultrasonic Measurements (${ultrasonicCount} unit(s))`\r\n      });\r\n      let ultrasonicResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`,\r\n          'Content-Type': 'application/x-www-form-urlencoded'\r\n        },\r\n        body: ultrasonicItemBody\r\n      });\r\n      if (!ultrasonicResp.ok) {\r\n        throw new Error(`Error creating invoice item for ultrasonic measurements: ${ultrasonicResp.statusText}`);\r\n      }\r\n      await ultrasonicResp.json();\r\n    }\r\n    \r\n    // If there are loraWan measurements, add invoice item\r\n    if (loraWanSensorCount > 0 && loraWanPriceData) {\r\n      let loraWanAmount = loraWanPriceData.unit_amount * loraWanSensorCount;\r\n      let loraWanItemBody = new URLSearchParams({\r\n        customer: customerStripeId,\r\n        invoice: invoiceData.id,\r\n        amount: String(loraWanAmount),\r\n        currency: loraWanPriceData.currency,\r\n        description: `LoRaWAN Measurements (Total sensors: ${loraWanSensorCount})`\r\n      });\r\n      let loraWanResp = await fetch('https://api.stripe.com/v1/invoiceitems', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`,\r\n          'Content-Type': 'application/x-www-form-urlencoded'\r\n        },\r\n        body: loraWanItemBody\r\n      });\r\n      if (!loraWanResp.ok) {\r\n        throw new Error(`Error creating invoice item for LoRaWAN measurements: ${loraWanResp.statusText}`);\r\n      }\r\n      await loraWanResp.json();\r\n    }\r\n    \r\n    // Finalize the invoice\r\n    const finalizeResp = await fetch(`https://api.stripe.com/v1/invoices/${invoiceData.id}/finalize`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!finalizeResp.ok) {\r\n      throw new Error(`Error finalizing invoice: ${finalizeResp.statusText}`);\r\n    }\r\n    await finalizeResp.json();\r\n    \r\n    // Save attributes for the project\r\n    const projectAttributes = [\r\n      { key: \"generalReport\", value: false },\r\n      { key: \"invoiceId\", value: invoiceData.id }\r\n    ];\r\n    attributeService.saveEntityAttributes(\r\n      { entityType: 'ASSET', id: projectID },\r\n      \"SERVER_SCOPE\",\r\n      projectAttributes\r\n    ).subscribe(\r\n      () => { console.log(\"Updated project with invoiceId\"); },\r\n      (error) => { console.error('Error updating project attribute:', error); }\r\n    );\r\n    // Also update each measurement that was included\r\n    updateMeasurementsAttributes(\"invoiceId\", invoiceData.id, includedMeasurements);\r\n    \r\n    alert(translationService.instant('custom.payment.alert.invoice-created-and-sent'));\r\n    instance.dialogRef.close(null);\r\n  } catch (err) {\r\n    console.error(\"Error creating invoice:\", err);\r\n    alert(translationService.instant('custom.payment.alert.failed-to-create-invoice'));\r\n    instance.dialogRef.close(null);\r\n  }\r\n}\r\n\r\n// Create a Stripe Checkout session with multiple line items\r\nasync function createCheckoutSession(generalPriceData, ultrasonicPriceData, loraWanPriceData, instance) {\r\n  try {\r\n    // Compute measurement totals and obtain the list of measurement IDs to update.\r\n    const { ultrasonicCount, loraWanSensorCount, includedMeasurements } = await computeMeasurementTotals();\r\n    const successUrl = url;\r\n    const cancelUrl = url;\r\n    // Build URLSearchParams for line items (Stripe expects line_items[0], line_items[1], etc.)\r\n    let bodyParams = new URLSearchParams({\r\n      'success_url': successUrl,\r\n      'cancel_url': cancelUrl,\r\n      'payment_method_types[]': 'card',\r\n      'mode': 'payment',\r\n      'customer': customerStripeId\r\n    });\r\n    // Line item for project report\r\n    bodyParams.append('line_items[0][price_data][currency]', generalPriceData.currency);\r\n    bodyParams.append('line_items[0][price_data][unit_amount]', String(generalPriceData.unit_amount));\r\n    bodyParams.append('line_items[0][price_data][product_data][name]', `Project Report for: ${projectName}`);\r\n    bodyParams.append('line_items[0][quantity]', '1');\r\n    \r\n    let index = 1;\r\n    // If ultrasonic measurements exist, add a line item\r\n    if (ultrasonicCount > 0 && ultrasonicPriceData) {\r\n      bodyParams.append(`line_items[${index}][price_data][currency]`, ultrasonicPriceData.currency);\r\n      bodyParams.append(`line_items[${index}][price_data][unit_amount]`, String(ultrasonicPriceData.unit_amount));\r\n      bodyParams.append(`line_items[${index}][price_data][product_data][name]`, `Ultrasonic Measurements (${ultrasonicCount} unit(s))`);\r\n      bodyParams.append(`line_items[${index}][quantity]`, String(ultrasonicCount));\r\n      index++;\r\n    }\r\n    // If loraWan measurements exist, add a line item\r\n    if (loraWanSensorCount > 0 && loraWanPriceData) {\r\n      bodyParams.append(`line_items[${index}][price_data][currency]`, loraWanPriceData.currency);\r\n      bodyParams.append(`line_items[${index}][price_data][unit_amount]`, String(loraWanPriceData.unit_amount));\r\n      bodyParams.append(`line_items[${index}][price_data][product_data][name]`, `LoRaWAN Measurements (Total sensors: ${loraWanSensorCount})`);\r\n      bodyParams.append(`line_items[${index}][quantity]`, String(loraWanSensorCount));\r\n      index++;\r\n    }\r\n    \r\n    const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: bodyParams\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.url) {\r\n      sessionId = data.id;\r\n      localStorage.setItem('sessionId', sessionId);\r\n      await new Promise((resolve, reject) => {\r\n        attributeService.saveEntityAttributes(\r\n          { entityType: 'ASSET', id: projectID },\r\n          \"SERVER_SCOPE\",\r\n          [{ key: \"sessionId\", value: sessionId }]\r\n        ).subscribe(\r\n          () => resolve(),\r\n          (error) => {\r\n            console.error('Error saving session ID attribute for project:', error);\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n      // Also update each measurement that was included\r\n      updateMeasurementsAttributes(\"sessionId\", sessionId, includedMeasurements);\r\n      \r\n      instance.dialogRef.close(null);\r\n      window.location.href = data.url;\r\n    } else {\r\n      console.error('Checkout session URL not found in response');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating checkout session:', error);\r\n  }\r\n}\r\n\r\nasync function checkPaymentStatus(sessionId, entityId) {\r\n  try {\r\n    if (!stripeSecretKey || !customerStripeId) {\r\n      await fetchStripeKeysAndCustomerId();\r\n    }\r\n    const response = await fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${stripeSecretKey}`\r\n      }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Error: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    if (data.payment_status === 'paid') {\r\n      alert(translationService.instant('custom.payment.alert.payment-completed-successfully'));\r\n      const attributes = [\r\n        { key: \"generalReport\", value: true }\r\n      ];\r\n      attributeService.saveEntityAttributes(\r\n        { entityType: 'ASSET', id: projectID },\r\n        \"SERVER_SCOPE\",\r\n        attributes\r\n      ).subscribe(\r\n        () => {},\r\n        (error) => {\r\n          console.error('Error saving generalReport attribute:', error);\r\n        }\r\n      );\r\n      return 'paid';\r\n    } else {\r\n      alert(translationService.instant('custom.payment.alert.payment-was-not-successful'));\r\n      return data.payment_status;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking payment status:', error);\r\n    return 'error';\r\n  }\r\n}\r\n\r\nasync function fetchStripeKeysAndCustomerId() {\r\n  return new Promise((resolve, reject) => {\r\n    assetService.getAssetInfo(projectID).subscribe(info => {\r\n      customerId = info.customerId;\r\n      projectName = info.name || projectID;\r\n      attributeService.getEntityAttributes(customerId, \"SERVER_SCOPE\", ['stripe_id']).subscribe(stripeId => {\r\n        customerStripeId = stripeId[0].value;\r\n        attributeService.getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey']).subscribe(attribute => {\r\n          stripeSecretKey = attribute[0].value;\r\n          resolve();\r\n        }, reject);\r\n      }, reject);\r\n    }, reject);\r\n  });\r\n}\r\n\r\nfunction checkSingleProjectStatus(mId) {\r\n  return new Promise((resolve, reject) => {\r\n    attributeService.getEntityAttributes(\r\n      { entityType: 'ASSET', id: mId },\r\n      \"SERVER_SCOPE\",\r\n      ['generalReport','invoiceId','sessionId']\r\n    ).subscribe(attrs => {\r\n      let generalReportVal = false;\r\n      let invoiceIdVal = null;\r\n      let sessionIdVal = null;\r\n      attrs.forEach(a => {\r\n        if (a.key === 'generalReport') generalReportVal = a.value;\r\n        if (a.key === 'invoiceId') invoiceIdVal = a.value;\r\n        if (a.key === 'sessionId') sessionIdVal = a.value;\r\n      });\r\n      if (generalReportVal === true) {\r\n        resolve(\"paid\");\r\n      } else {\r\n        if (sessionIdVal) {\r\n          checkStripeSessionPaid(sessionIdVal).then(isSessionPaid => {\r\n            if (isSessionPaid) {\r\n              resolve(\"paid\");\r\n            } else if (invoiceIdVal) {\r\n              checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n                if (invStatus === 'paid') resolve(\"paid\");\r\n                else if (invStatus === 'open') resolve(\"openInvoice\");\r\n                else resolve(\"unpaid\");\r\n              }).catch(() => reject());\r\n            } else {\r\n              resolve(\"unpaid\");\r\n            }\r\n          }).catch(() => reject());\r\n        } else if (invoiceIdVal) {\r\n          checkStripeInvoice(invoiceIdVal).then(invStatus => {\r\n            if (invStatus === 'paid') resolve(\"paid\");\r\n            else if (invStatus === 'open') resolve(\"openInvoice\");\r\n            else resolve(\"unpaid\");\r\n          }).catch(() => reject());\r\n        } else {\r\n          resolve(\"unpaid\");\r\n        }\r\n      }\r\n    }, err => reject(err));\r\n  });\r\n}\r\n\r\nfunction checkStripeSessionPaid(sid) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sid}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.payment_status === 'paid') resolve(true);\r\n        else resolve(false);\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}\r\n\r\nfunction checkStripeInvoice(invoiceIdVal) {\r\n  return new Promise((resolve, reject) => {\r\n    fetchStripeKeysAndCustomerId().then(() => {\r\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceIdVal}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${stripeSecretKey}`\r\n        }\r\n      })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        if (d.status === 'paid') {\r\n          resolve('paid');\r\n        } else if (d.status === 'open' || d.status === 'draft') {\r\n          resolve('open');\r\n        } else {\r\n          resolve(d.status);\r\n        }\r\n      })\r\n      .catch(() => reject());\r\n    }).catch(() => reject());\r\n  });\r\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e59f381b-83a6-a8d0-261e-3254bc37522c"
              },
              {
                "name": "{i18n:custom.diagnostics.project-administration.open-measurements}",
                "icon": "straighten",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "all_measurements",
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "71c478b6-a4b1-e569-e99a-85d5562cc721"
              },
              {
                "name": "{i18n:custom.diagnostics.project-administration.edit-project}",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"editEntityFormGroup\"\r\n      (ngSubmit)=\"save()\" \r\n      class=\"add-entity-form w-11/12 max-w-3xl mx-auto\">\r\n    \r\n    <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n        <h2 class=\"text-lg font-semibold\">\r\n  {{ 'custom.projects.edit-project.edit-project-name' | translate:{ entityName: entityName } }}\r\n</h2>\r\n        <span class=\"flex-1\"></span>\r\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n            <mat-icon>close</mat-icon>\r\n        </button>\r\n    </mat-toolbar>\r\n\r\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n\r\n    <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n        <div class=\"flex w-full gap-2\">\r\n            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.projects.edit-project.project-id' | translate }}</mat-label>\r\n                <input matInput \r\n                       formControlName=\"entityName\" \r\n                       required readonly>\r\n            </mat-form-field>\r\n\r\n            <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                <mat-label>{{ 'custom.projects.edit-project.project-name' | translate }}</mat-label>\r\n                <input matInput \r\n                       formControlName=\"entityLabel\">\r\n            </mat-form-field>\r\n        </div>\r\n\r\n        <div formGroupName=\"attributes\">\r\n            <div class=\"flex w-full\">\r\n                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                    <mat-label>{{ 'custom.projects.edit-project.address' | translate }}</mat-label>\r\n                    <input matInput \r\n                           formControlName=\"address\">\r\n                </mat-form-field>\r\n            </div>\r\n\r\n            <div class=\"flex w-full gap-2\">\r\n                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                    <mat-label>{{ 'custom.projects.edit-project.latitude' | translate }}</mat-label>\r\n                    <input type=\"number\" \r\n                           step=\"any\" \r\n                           matInput \r\n                           formControlName=\"latitude\">\r\n                </mat-form-field>\r\n\r\n                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                    <mat-label>{{ 'custom.projects.edit-project.longitude' | translate }}</mat-label>\r\n                    <input type=\"number\"\r\n                           step=\"any\"\r\n                           matInput\r\n                           formControlName=\"longitude\">\r\n                </mat-form-field>\r\n            </div>\r\n\r\n            <div class=\"flex w-full\">\r\n                <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n                    <mat-label>{{ 'custom.projects.edit-project.progress' | translate }}</mat-label>\r\n                    <mat-select formControlName=\"progress\">\r\n                        <mat-option value=\"in preparation\">{{ 'custom.projects.edit-project.in-preparation' | translate }}</mat-option>\r\n                        <mat-option value=\"active\">{{ 'custom.projects.edit-project.active' | translate }}</mat-option>\r\n                        <mat-option value=\"finished\">{{ 'custom.projects.edit-project.finished' | translate }}</mat-option>\r\n                    </mat-select>\r\n                </mat-form-field>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n        <button mat-button\r\n                color=\"primary\"\r\n                type=\"button\"\r\n                [disabled]=\"(isLoading$ | async)\"\r\n                (click)=\"cancel()\"\r\n                cdkFocusInitial>\r\n            {{ 'action.cancel' | translate }}\r\n        </button>\r\n        <button mat-button\r\n                mat-raised-button\r\n                color=\"primary\"\r\n                type=\"submit\"\r\n                [disabled]=\"(isLoading$ | async) || editEntityFormGroup.invalid\">\r\n            {{ 'action.save' | translate }}\r\n        </button>\r\n    </div>\r\n</form>",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenEditEntityDialog();\n\nfunction openEditEntityDialog() {\n    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n}\n\nfunction EditEntityDialogController(instance) {\n    let vm = instance;\n    vm.entityName = entityName; \n    vm.entityType = entityId.entityType;\n    vm.attributes = {};\n    vm.entity = {};\n\n    vm.editEntityFormGroup = vm.fb.group({\n        entityName: ['', [vm.validators.required]],\n        entityLabel: [null],\n        attributes: vm.fb.group({\n            address: [null],\n            latitude: [null],\n            longitude: [null],\n            progress: [null]\n        })\n    });\n\n    getEntityInfo();\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n\n    vm.save = function() {\n        vm.editEntityFormGroup.markAsPristine();\n        widgetContext.rxjs.forkJoin([\n            saveAttributes(entityId),\n            saveEntity()\n        ]).subscribe(() => {\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n        });\n    };\n\n    function getEntityInfo() {\n        widgetContext.rxjs.forkJoin([\n            attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE'),\n            entityService.getEntity(entityId.entityType, entityId.id)\n        ]).subscribe(([attrData, entityData]) => {\n            vm.attributes = {};\n            for (let i = 0; i < attrData.length; i++) {\n                vm.attributes[attrData[i].key] = attrData[i].value;\n            }\n\n            vm.entity = entityData;\n\n            vm.editEntityFormGroup.patchValue({\n                entityName: vm.entity.name,\n                entityLabel: vm.entity.label,\n                attributes: {\n                    address: vm.attributes.address,\n                    latitude: vm.attributes.latitude,\n                    longitude: vm.attributes.longitude,\n                    progress: vm.attributes.progress\n                }\n            }, { emitEvent: false });\n        });\n    }\n\n    function saveEntity() {\n        const formValues = vm.editEntityFormGroup.value;\n        vm.entity.name = formValues.entityName;\n        vm.entity.label = formValues.entityLabel;\n\n        if (vm.entityType === 'ASSET') {\n            return assetService.saveAsset(vm.entity);\n        } else if (vm.entityType === 'DEVICE') {\n            return deviceService.saveDevice(vm.entity);\n        }\n        return widgetContext.rxjs.of([]);\n    }\n\n    function saveAttributes(entityId) {\n        const currentAttributes = vm.attributes;\n        const updatedAttributes = vm.editEntityFormGroup.value.attributes;\n        \n        let attributesArray = [];\n        for (let key in updatedAttributes) {\n            if (updatedAttributes.hasOwnProperty(key)) {\n                if (updatedAttributes[key] !== currentAttributes[key]) {\n                    attributesArray.push({ key: key, value: updatedAttributes[key] });\n                }\n            }\n        }\n\n        if (attributesArray.length > 0) {\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n        }\n        return widgetContext.rxjs.of([]);\n    }\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9dea6b62-3ef6-b94f-a46b-bee18c6842a4"
              },
              {
                "name": "{i18n:custom.diagnostics.project-administration.delete-project}",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\r\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\r\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet translationService = $injector.get(widgetContext.servicesMap.get('translate'));\r\n\r\nlet projectEntityId = entityId.id;\r\nlet customerId;\r\n\r\nlet customerName = widgetContext.stateController.getStateParams().entityName;\r\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n        customerId = widgetContext.stateController.getStateParams().entityId;\r\n    } else {\r\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\r\n    }\r\n\r\n\r\nlet assetSearchQuery = {\r\n  \"parameters\": {\r\n    \"rootId\": projectEntityId,\r\n    \"rootType\": \"ASSET\",\r\n    \"direction\": \"FROM\",\r\n    \"relationTypeGroup\": \"COMMON\",\r\n    \"maxLevel\": 10,\r\n    \"fetchLastLevelOnly\": false\r\n  },\r\n  \"relationType\": \"Owns\",\r\n  \"assetTypes\": [\r\n    \"Measurement\"\r\n  ]\r\n};\r\n\r\nlet doktorkitSearchQuery = {\r\n  \"parameters\": {\r\n    \"rootId\": projectEntityId,\r\n    \"rootType\": \"ASSET\",\r\n    \"direction\": \"FROM\",\r\n    \"relationTypeGroup\": \"COMMON\",\r\n    \"maxLevel\": 10,\r\n    \"fetchLastLevelOnly\": false\r\n  },\r\n  \"relationType\": \"Owns\",\r\n  \"assetTypes\": [\r\n    \"Doktorkit\"\r\n  ]\r\n};\r\n\r\nassetService.findByQuery(assetSearchQuery).subscribe(measurements => {\r\n    assetService.findByQuery(doktorkitSearchQuery).subscribe(doktorkits => {\r\n        openDeleteDoktorkitDialog(measurements, doktorkits);\r\n    })\r\n});\r\n\r\nfunction addKitToUnassignedDoktorkits(doktorkits) {\r\n    return getUnassignedKitGroup(customerId).pipe(\r\n        widgetContext.rxjs.switchMap((UnassignedKitGroup) => {\r\n            const addKitObservables = doktorkits.map((item) => {\r\n                \r\n                return entityGroupService.addEntityToEntityGroup(UnassignedKitGroup.id.id, item.id.id);\r\n            });\r\n            \r\n            return widgetContext.rxjs.forkJoin(addKitObservables);\r\n        })\r\n    );\r\n}\r\n\r\n\r\nfunction openDeleteDoktorkitDialog(measurements, doktorkits) {\r\n  const title = translationService.instant(\r\n    'custom.doktorkits.delete.title',\r\n    { entityName: entityName }\r\n  );\r\n\r\n  const content = translationService.instant(\r\n    'custom.doktorkits.delete.content',\r\n    { count: measurements.length }\r\n  );\r\n\r\n  dialogs.confirm(\r\n    title,\r\n    content,\r\n    translationService.instant('action.cancel'),\r\n    translationService.instant('action.delete')\r\n  ).subscribe(function(result) {\r\n    if (result) {\r\n      deleteProject(measurements, doktorkits);\r\n    }\r\n  });\r\n}\r\n\r\n\r\n\r\nfunction deleteProject(measurements, doktorkits) {\r\n    addKitToUnassignedDoktorkits(doktorkits).subscribe();\r\n    deleteMeasurements(measurements);\r\n    assetService.deleteAsset(entityId.id).subscribe(\r\n        function() {\r\n            widgetContext.updateAliases();\r\n        }\r\n    );  \r\n}\r\n\r\nfunction deleteMeasurements(measurements) {\r\n    measurements.forEach(item => {\r\n        assetService.deleteAsset(item.id.id).subscribe(\r\n            function() {\r\n                widgetContext.updateAliases();\r\n            }\r\n        ); \r\n    })\r\n}\r\n\r\nfunction getUnassignedKitGroup(customerId) {\r\n  return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\r\n      widgetContext.rxjs.switchMap((entityGroups) => {\r\n          var UnassignedKitGroup = entityGroups.find(group => group.name === 'Unassigned Kit');\r\n          if (UnassignedKitGroup) {\r\n              return widgetContext.rxjs.of(UnassignedKitGroup);\r\n          } else {\r\n              UnassignedKitGroup = {\r\n                  type: 'ASSET',\r\n                  name: 'Unassigned Kit',\r\n                  ownerId: customerId\r\n              };\r\n              return entityGroupService.saveEntityGroup(UnassignedKitGroup);\r\n          }\r\n      })\r\n  );\r\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "338d9fd7-c752-eb0e-4687-2c2e32ca1a32"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.diagnostics.project-administration.go-back}",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "arrow_back",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\nvar number = (widgetContext.stateController.getStateIndex())-1;\r\n\r\nparams['selectedProject'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\r\nwidgetContext.stateController.updateState(null,params);\r\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0ecc1f07-ef78-a200-ed13-20cc8bec8f0f"
              },
              {
                "name": "{i18n:custom.diagnostics.project-administration.add-project}",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "add",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-primary-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form\n  #addEntityForm=\"ngForm\"\n  [formGroup]=\"addProjectFormGroup\"\n  (ngSubmit)=\"save()\"\n  class=\"add-entity-form\"\n  style=\"width: 600px;\"\n>\n\n  <!-- Header Toolbar -->\n  <mat-toolbar class=\"flex items-center\" color=\"primary\">\n    <mat-icon style=\"margin-right: 12px;\">folder_open</mat-icon>\n    <h2 style=\"margin: 0; font-size: 18px;\">\n      {{ 'custom.projects.add-project.add-project' | translate }}\n    </h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n\n  <!-- Progress -->\n  <mat-progress-bar\n    color=\"warn\"\n    mode=\"indeterminate\"\n    *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height:4px\" *ngIf=\"!(isLoading$ | async)\"></div>\n\n  <!-- Content -->\n  <div mat-dialog-content class=\"flex flex-col gap-2 p-4\">\n\n    <!-- Project Picture -->\n    <tb-image-input formControlName=\"projectPicture\"\n                    label=\"Project Picture\"\n                    noImageText=\"No picture selected\">\n    </tb-image-input>\n\n    <!-- Customer -->\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n      <mat-label>{{ 'custom.projects.add-project.customer' | translate }}</mat-label>\n      <mat-select\n        formControlName=\"selectedCustomerId\"\n        (selectionChange)=\"onCustomerSelected($event.value)\"\n        required>\n        <mat-option *ngFor=\"let c of customers\" [value]=\"c.id.id\">\n          {{ c.title }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n\n    <!-- Project ID + Label -->\n    <div class=\"flex w-full gap-2\">\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n        <mat-label>{{ 'custom.projects.add-project.project-id' | translate }}</mat-label>\n        <input matInput formControlName=\"name\" readonly required />\n      </mat-form-field>\n\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n        <mat-label>Label</mat-label>\n        <input matInput formControlName=\"entityLabel\" />\n      </mat-form-field>\n    </div>\n\n    <!-- Address -->\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n      <mat-label>{{ 'custom.projects.add-project.project-address' | translate }}</mat-label>\n      <input\n        matInput\n        formControlName=\"address\"\n        required\n        autocomplete=\"off\"\n        (input)=\"onAddressInput()\"\n      />\n      <button\n        mat-icon-button\n        matSuffix\n        type=\"button\"\n        aria-label=\"Search address\"\n        [disabled]=\"!addProjectFormGroup.get('address').value || addProjectFormGroup.get('address').value.length < 5\"\n        (click)=\"triggerAddressSearch()\">\n        <mat-icon>search</mat-icon>\n      </button>\n    </mat-form-field>\n\n    <!-- PLZ + Ort -->\n    <div class=\"flex w-full gap-2\">\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n        <mat-label>PLZ</mat-label>\n        <input matInput formControlName=\"postcode\" />\n      </mat-form-field>\n\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n        <mat-label>Ort</mat-label>\n        <input matInput formControlName=\"city\" />\n      </mat-form-field>\n    </div>\n    \n    <!-- Address search results -->\n    <div class=\"w-full\" *ngIf=\"addressResults.length\">\n      <mat-list>\n        <mat-list-item\n          *ngFor=\"let r of addressResults\"\n          (click)=\"selectAddress(r)\"\n          style=\"cursor:pointer\">\n          {{ r.display_name }}\n        </mat-list-item>\n      </mat-list>\n    </div>\n\n    <!-- Latitude + Longitude -->\n    <div class=\"flex w-full gap-2\">\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n        <mat-label>{{ 'custom.projects.add-project.latitude' | translate }}</mat-label>\n        <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\" required />\n      </mat-form-field>\n\n      <mat-form-field appearance=\"outline\" class=\"flex-1\">\n        <mat-label>{{ 'custom.projects.add-project.longitude' | translate }}</mat-label>\n        <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\" required />\n      </mat-form-field>\n    </div>\n\n  </div>\n\n  <!-- Footer -->\n  <div class=\"flex justify-end items-center gap-2 p-4\"\n       style=\"border-top: 1px solid #e0e0e0; background: #fafafa;\">\n    <button\n      mat-button\n      type=\"button\"\n      [disabled]=\"(isLoading$ | async)\"\n      (click)=\"cancel()\">\n      Cancel\n    </button>\n\n    <button\n      mat-raised-button\n      color=\"primary\"\n      type=\"submit\"\n      [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      {{ 'custom.projects.add-project.add-project' | translate }}\n    </button>\n  </div>\n\n</form>",
                "customCss": "/* =========================================================\r\n   Base layout\r\n   ========================================================= */\r\n\r\n.add-entity-form {\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* =========================================================\r\n   Material dialog behaviour\r\n   ========================================================= */\r\n\r\n.mat-dialog-container {\r\n  max-width: 90vw !important;\r\n  padding: 0 !important;\r\n}\r\n\r\n/* =========================================================\r\n   Form-field background (ThingsBoard look)\r\n   ========================================================= */\r\n\r\n/* enabled */\r\n.add-entity-form\r\n.mdc-text-field--filled:not(.mdc-text-field--disabled) {\r\n  background-color: #F4F9FE !important;\r\n}\r\n\r\n/* disabled */\r\n.add-entity-form\r\n.mdc-text-field--filled.mdc-text-field--disabled {\r\n  background-color: rgba(244, 249, 254, 0.5) !important;\r\n}\r\n\r\n/* focus overlay */\r\n.add-entity-form\r\n.mat-mdc-form-field-focus-overlay {\r\n  background-color: #F4F9FE !important;\r\n}\r\n\r\n/* disabled focus overlay */\r\n.add-entity-form\r\n.mat-mdc-form-field-disabled\r\n.mat-mdc-form-field-focus-overlay {\r\n  background-color: rgba(244, 249, 254, 0.5) !important;\r\n}\r\n\r\n/* =========================================================\r\n   Toolbar\r\n   ========================================================= */\r\n\r\n.add-entity-form mat-toolbar {\r\n  min-height: 56px;\r\n}\r\n\r\n.add-entity-form mat-toolbar h2 {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n}\r\n\r\n/* =========================================================\r\n   Address autocomplete dropdown\r\n   ========================================================= */\r\n\r\n.address-dropdown {\r\n  position: absolute;\r\n  top: 56px;              /* exactly below filled input */\r\n  left: 0;\r\n  width: 100%;\r\n  z-index: 1000;\r\n  background: #ffffff;\r\n  border-radius: 6px;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);\r\n}\r\n\r\n.address-item {\r\n  cursor: pointer;\r\n  padding: 8px 12px;\r\n}\r\n\r\n.address-item:hover {\r\n  background-color: rgba(0, 0, 0, 0.04);\r\n}\r\n\r\n/* =========================================================\r\n   Icons\r\n   ========================================================= */\r\n\r\nmat-icon {\r\n  vertical-align: middle;\r\n}\r\n\r\n/* =========================================================\r\n   Buttons\r\n   ========================================================= */\r\n\r\n.add-entity-form button[mat-raised-button] {\r\n  box-shadow: none;\r\n}\r\n\r\n.add-entity-form button[mat-raised-button]:hover {\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);\r\n}\r\n\r\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\n\r\nconst pageLink = widgetContext.pageLink(100, 0, null, null);\r\n\r\ncustomerService.getCustomers(pageLink).subscribe(customersPage => {\r\n    const customers = customersPage.data || [];\r\n    openDialog(customers);\r\n});\r\n\r\nfunction openDialog(customers) {\r\n    customDialog.customDialog(htmlTemplate, instance => {\r\n        instance.customers = customers;\r\n        return new AddProjectDialogController(instance);\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddProjectDialogController(instance) {\r\n    let vm = instance;\r\n    vm.customers = instance.customers || [];\r\n    vm.selectedOwnerId = null;\r\n    vm.addressResults = [];\r\n    vm.addressSearchLoading = false;\r\n\r\n\r\n    vm.addProjectFormGroup = vm.fb.group({\r\n        selectedCustomerId: [null, [vm.validators.required]],\r\n        name: ['', [vm.validators.required]],\r\n        entityLabel: [''],\r\n        address: [''],\r\n        postcode: [''],\r\n        city: [''],\r\n        latitude: [''],\r\n        longitude: [''],\r\n    projectPicture: ['']\r\n    });\r\n\r\n    vm.onCustomerSelected = function(customerId) {\r\n        vm.selectedOwnerId = { id: customerId, entityType: 'CUSTOMER' };\r\n        let query = {\r\n            parameters: {\r\n                rootId: vm.selectedOwnerId.id,\r\n                rootType: 'CUSTOMER',\r\n                direction: 'FROM',\r\n                relationTypeGroup: 'COMMON',\r\n                maxLevel: 10,\r\n                fetchLastLevelOnly: false\r\n            },\r\n            relationType: 'Owns',\r\n            assetTypes: ['Project']\r\n        };\r\n        assetService.findByQuery(query).subscribe(projects => {\r\n            let nextProjectId = getLastProjectId(projects);\r\n            attributeService.getEntityAttributes(vm.selectedOwnerId, 'SERVER_SCOPE', ['shortName']).subscribe(attrs => {\r\n                let attr = attrs.find(a => a.key === 'shortName');\r\n                let shortName = attr ? attr.value : 'customer';\r\n                vm.addProjectFormGroup.controls['name'].setValue(shortName + '_' + nextProjectId);\r\n            });\r\n        });\r\n    };\r\n    \r\n    vm.onAddressInput = function () {\r\n        vm.addressResults = [];\r\n    };\r\n    \r\n    vm.triggerAddressSearch = function () {\r\n    \r\n        const query = vm.addProjectFormGroup.get('address').value;\r\n        const postcode = vm.addProjectFormGroup.get('postcode').value;\r\n        const city = vm.addProjectFormGroup.get('city').value;\r\n    \r\n        if (!query || query.length < 5) {\r\n            return;\r\n        }\r\n    \r\n        vm.addressSearchLoading = true;\r\n    \r\n        // Build search query with filters\r\n        let searchQuery = query;\r\n        if (city) {\r\n            searchQuery += ', ' + city;\r\n        }\r\n        if (postcode) {\r\n            searchQuery += ', ' + postcode;\r\n        }\r\n    \r\n        const params = {\r\n            q: searchQuery,\r\n            format: 'json',\r\n            addressdetails: 1,\r\n            limit: 6\r\n        };\r\n    \r\n        // Add specific filters if provided\r\n        if (postcode) {\r\n            params.postalcode = postcode;\r\n        }\r\n    \r\n        fetch(\r\n            'https://nominatim.openstreetmap.org/search?' +\r\n            new URLSearchParams(params)\r\n        )\r\n        .then(r => r.json())\r\n        .then(data => {\r\n            vm.addressResults = data;\r\n            vm.addressSearchLoading = false;\r\n        })\r\n        .catch(() => {\r\n            vm.addressSearchLoading = false;\r\n        });\r\n    };\r\n    \r\n    vm.selectAddress = function (item) {\r\n    \r\n        const a = item.address || {};\r\n    \r\n        const street = [a.road, a.house_number].filter(Boolean).join(' ');\r\n        const postcode = a.postcode || '';\r\n        const city = a.city || a.town || a.village || '';\r\n    \r\n        vm.addProjectFormGroup.patchValue({\r\n            address: street,\r\n            postcode: postcode,\r\n            city: city,\r\n            latitude: parseFloat(item.lat),\r\n            longitude: parseFloat(item.lon)\r\n        });\r\n    \r\n        vm.addressResults = [];\r\n        vm.addProjectFormGroup.markAsDirty();\r\n    };\r\n\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        vm.addProjectFormGroup.markAsPristine();\r\n        let chosenCustomerId = vm.addProjectFormGroup.value.selectedCustomerId;\r\n        let customerId = { id: chosenCustomerId, entityType: 'CUSTOMER' };\r\n        saveProjectObservable(customerId).subscribe(Project => {\r\n            widgetContext.rxjs.forkJoin([\r\n                saveCustomerToProjectRelation(customerId, Project.id),\r\n                saveAttributes(Project.id)\r\n            ]).subscribe(() => {\r\n                let params = widgetContext.stateController.getStateParams();\r\n                params.selectedProject = {\r\n                    entityId: Project.id,\r\n                    entityName: Project.name,\r\n                    entityLabel: ''\r\n                };\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            });\r\n        });\r\n    };\r\n\r\n    function getLastProjectId(projects) {\r\n        let maxNumber = 0;\r\n        projects.forEach(item => {\r\n            const parts = item.name.split('_');\r\n            if (parts.length === 2) {\r\n                const number = parseInt(parts[1], 10);\r\n                if (number > maxNumber) {\r\n                    maxNumber = number;\r\n                }\r\n            }\r\n        });\r\n        return maxNumber + 1;\r\n    }\r\n\r\n    function saveProjectObservable(customerId) {\r\n        return getProjectsGroup(customerId).pipe(\r\n            widgetContext.rxjs.switchMap(ProjectsGroup => {\r\n                let formValues = vm.addProjectFormGroup.value;\r\n                let Project = {\r\n                    name: formValues.name,\r\n                    type: 'Project',\r\n                    label: formValues.entityLabel,\r\n                    customerId: customerId\r\n                };\r\n                return assetService.saveAsset(Project, ProjectsGroup.id.id);\r\n            })\r\n        );\r\n    }\r\n\r\n    function getProjectsGroup(customerId) {\r\n        return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\r\n            widgetContext.rxjs.switchMap(entityGroups => {\r\n                let ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\r\n                if (ProjectsGroup) {\r\n                    return widgetContext.rxjs.of(ProjectsGroup);\r\n                } else {\r\n                    ProjectsGroup = {\r\n                        type: 'ASSET',\r\n                        name: 'Projects',\r\n                        ownerId: customerId\r\n                    };\r\n                    return entityGroupService.saveEntityGroup(ProjectsGroup);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    function saveCustomerToProjectRelation(customerId, ProjectId) {\r\n        let relation = {\r\n            from: customerId,\r\n            to: ProjectId,\r\n            typeGroup: 'COMMON',\r\n            type: 'Owns'\r\n        };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n\r\n    function saveAttributes(entityId) {\r\n        let attributesArray = [\r\n            {\r\n                key: 'address',\r\n                value: vm.addProjectFormGroup.value.address\r\n            },{\r\n                key: 'postcode',\r\n                value: vm.addProjectFormGroup.value.postcode || ''\r\n            },{\r\n                key: 'city',\r\n                value: vm.addProjectFormGroup.value.city || ''\r\n            },{\r\n                key: 'latitude',\r\n                value: vm.addProjectFormGroup.value.latitude || 48.1406022\r\n            },{\r\n                key: 'longitude',\r\n                value: vm.addProjectFormGroup.value.longitude || 16.2932688\r\n            },\r\n            {\r\n                key: 'progress',\r\n                value: 'in preparation'\r\n            },\r\n            {\r\n                key: 'units',\r\n                value: 'metric'\r\n            },\r\n            {\r\n                key: 'projectPicture',\r\n                value: vm.addProjectFormGroup.value.projectPicture || ''\r\n            }\r\n        ];\r\n        return attributeService.saveEntityAttributes(entityId, 'SERVER_SCOPE', attributesArray);\r\n    }\r\n}\r\n\r\nfunction AddressSearchController(instance) {\r\n    let vm = instance;\r\n\r\n    vm.query = instance.initialQuery || '';\r\n    vm.results = [];\r\n    vm.loading = false;\r\n    vm.selected = null;\r\n\r\n    vm.searchAddress = function () {\r\n        if (!vm.query || vm.query.length < 5) {\r\n            vm.results = [];\r\n            return;\r\n        }\r\n\r\n        vm.loading = true;\r\n\r\n        fetch(\r\n            'https://nominatim.openstreetmap.org/search?' +\r\n            new URLSearchParams({\r\n                q: vm.query,\r\n                format: 'json',\r\n                addressdetails: 1,\r\n                limit: 6\r\n            })\r\n        )\r\n        .then(r => r.json())\r\n        .then(data => {\r\n            vm.results = data;\r\n            vm.loading = false;\r\n        })\r\n        .catch(() => vm.loading = false);\r\n    };\r\n\r\n    vm.select = function (item) {\r\n        const a = item.address || {};\r\n\r\n        const street = [a.road, a.house_number].filter(Boolean).join(' ');\r\n        const postcode = a.postcode || '';\r\n        const city = a.city || a.town || a.village || '';\r\n\r\n        vm.selected = {\r\n            address: `${street}, ${postcode}, ${city}`,\r\n            latitude: parseFloat(item.lat),\r\n            longitude: parseFloat(item.lon)\r\n        };\r\n    };\r\n\r\n    vm.confirm = function () {\r\n        if (vm.selected) {\r\n            vm.dialogRef.close(vm.selected);\r\n        }\r\n    };\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n}",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e965b8a1-a6ac-5ae4-fd79-2b7220b91ed1"
              }
            ],
            "rowDoubleClick": [
              {
                "name": "{i18n:custom.diagnostics.project-administration.select-project}",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a7ad4745-1f21-49fd-38f4-70825fe6875f"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "pageSize": 1024,
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "titleIcon": null,
          "iconColor": null,
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "ac58fb06-a63f-26ea-d465-8532c8124780",
        "typeFullFqn": "system.cards.entities_table"
      },
      "e422fc82-62a4-8372-2e84-134b0bc789cc": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.6263149932232661
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div style=\"width: 100%; height: 100%; padding: 0;\">\n   <tb-dashboard-state *ngIf=\"ctx.currentUser.authority === 'TENANT_ADMIN'\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"projects_card_tenant\"></tb-dashboard-state>\n   <tb-dashboard-state *ngIf=\"ctx.currentUser.authority === 'CUSTOMER_USER'\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"projects_card\"></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "let $injector = ctx.$scope.$injector;\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nlet stripeSecretKey;\nvar customer;\nif (ctx.currentUser.authority !== 'CUSTOMER_USER'){\n  customer = ctx.stateController.getStateParams().entityId;  \n}else{\n    customer = {entityType:\"CUSTOMER\",id: ctx.currentUser.customerId};\n}\nconst attributesKey = [{ key: \"generalReportCheck\", value: \"check\" }];\n            attributeService.saveEntityAttributes(\n              customer,\n              \"SERVER_SCOPE\",\n              attributesKey\n            ).subscribe();\n/*attributeService\n  .getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey'])\n  .subscribe(key => {\n    stripeSecretKey = key[0].value;\n    var projects;\n    if(data && data.length && data[0]['entityId'] && data[0]['aliasName'] !== 'Projects'){\n        projects = data;\n    }\n    // 2. Now iterate over all measurements in data.\n    data.forEach(project => {\n      let projectID = project.entityId;\n      if (!projectID) {\n        console.warn(\"No entityId found for project:\", project);\n        return; // Skip if we don't have an entity ID\n      }\n\n      // 3. Retrieve server-side attributes for each project.\n      attributeService\n        .getEntityAttributes({ entityType: 'ASSET', id: projectID }, 'SERVER_SCOPE')\n        .subscribe(response => {\n          // 4. Once the attributes come back, process them for session/invoice.\n          fetchAndUpdateAttributes(projectID, response);\n        });\n    });\n  });*/\n\n/**\n * This function checks the 'generalReport' attribute, then sessionId or invoiceId,\n * and if paid, it updates the 'generalReport' attribute to true.\n */\n/*function fetchAndUpdateAttributes(projectID, attributes) {\n  let generalReportAttr = attributes.find(attr => attr.key === 'generalReport' && attr.value !== null && attr.value !== undefined);\n  let generalReport = generalReportAttr ? generalReportAttr.value : false;\n\n  let sessionIdAttr = attributes.find(attr => attr.key === 'sessionId' && attr.value !== null && attr.value !== undefined);\n  let invoiceIdAttr = attributes.find(attr => attr.key === 'invoiceId' && attr.value !== null && attr.value !== undefined);\n  console.log(\"invoiceId\", invoiceIdAttr);\n\n  // If `generalReport` is not true, then we might need to check session or invoice\n  if (generalReport !== true) {\n    // Check for Stripe session\n    if (sessionIdAttr && stripeSecretKey) {\n      let sessionId = sessionIdAttr.value;\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': 'Bearer ' + stripeSecretKey\n        }\n      })\n        .then(response => response.json())\n        .then(sessionData => {\n            console.log(\"sessionData:\", sessionData.status);\n          if (sessionData.payment_status === 'paid') {\n            const attributesKey = [{ key: \"generalReport\", value: true }];\n            attributeService.saveEntityAttributes(\n              { entityType: 'ASSET', id: projectID },\n              \"SERVER_SCOPE\",\n              attributesKey\n            ).subscribe();\n          }\n        })\n        .catch(error => {\n          console.error('Error fetching session data:', error);\n        });\n    } \n    // Otherwise check for Stripe invoice\n    else if (invoiceIdAttr && stripeSecretKey) {\n      let invoiceId = invoiceIdAttr.value;\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceId}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': 'Bearer ' + stripeSecretKey\n        }\n      })\n        .then(response => response.json())\n        .then(invoiceData => {\n          console.log(\"Invoice status:\", invoiceData.status);\n          if (invoiceData.status === 'paid') {\n            const attributesKey = [{ key: \"generalReport\", value: true }];\n            attributeService.saveEntityAttributes(\n              { entityType: 'ASSET', id: projectID },\n              \"SERVER_SCOPE\",\n              attributesKey\n            ).subscribe();\n          }\n        })\n        .catch(error => {\n          console.error('Error fetching invoice data:', error);\n        });\n    }\n  }\n}*/\nvar admin = ctx.currentUser.authority === 'TENANT_ADMIN';\nreturn '<div style=\"width: 100%; height: 100%; padding: 0;\">'+\n    (admin?\n   ('<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"projects_card_tenant\"></tb-dashboard-state>')\n   :'<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"projects_card\"></tb-dashboard-state>')+\n'</div>';",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ""
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "borderRadius": "8px",
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "e422fc82-62a4-8372-2e84-134b0bc789cc",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "8c0dc9e5-4621-44d6-8d59-270d531417c6": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b0061bd7-595f-a375-e74c-115b41049852",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7029938900334383
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1736933255485,
                "endTimeMs": 1737019655485
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "let $injector = ctx.$scope.$injector;\r\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\r\nlet tenantId = \"efb63c10-b576-11ee-a6c2-a149ed03c64d\";\r\nlet stripeSecretKey;\r\n\r\nvar customer;\r\nif (ctx.currentUser.authority !== 'CUSTOMER_USER'){\r\n  customer = {entityType:\"TENANT\",id: ctx.currentUser.tenantId};\r\n}else{\r\n    customer = {entityType:\"CUSTOMER\",id: ctx.currentUser.customerId};\r\n}\r\n\r\n/*console.log(ctx.currentUser);*/\r\nconst attributesKey = [{ key: \"detailReportCheck\", value: \"check\" }];\r\n            attributeService.saveEntityAttributes(\r\n              customer,\r\n              \"SERVER_SCOPE\",\r\n              attributesKey\r\n            ).subscribe(/*response => {\r\n                //console.log(\"Done\");\r\n            }*/);\r\n/*// 1. Get the Stripe secret key once.\r\nattributeService\r\n  .getEntityAttributes(customer, \"SERVER_SCOPE\", ['stripeKey'])\r\n  .subscribe(key => {\r\n    stripeSecretKey = key[0].value;\r\n    // 2. Now iterate over all measurements in data.\r\n    data.forEach(measurement => {\r\n      let measurementID = measurement.entityId;\r\n      if (!measurementID) {\r\n        console.warn(\"No entityId found for measurement:\", measurement);\r\n        return; // Skip if we don't have an entity ID\r\n      }\r\n\r\n      // 3. Retrieve server-side attributes for each measurement.\r\n      attributeService\r\n        .getEntityAttributes({ entityType: 'ASSET', id: measurementID }, 'SERVER_SCOPE')\r\n        .subscribe(response => {\r\n          // 4. Once the attributes come back, process them for session/invoice.\r\n          fetchAndUpdateAttributes(measurementID, response);\r\n        });\r\n    });\r\n  });*/\r\n\r\n/**\r\n * This function checks the 'detailReport' attribute, then sessionId or invoiceId,\r\n * and if paid, it updates the 'detailReport' attribute to true.\r\n */\r\n/*function fetchAndUpdateAttributes(measurementID, attributes) {\r\n  let detailReportAttr = attributes.find(attr => attr.key === 'detailReport' && attr.value !== null && attr.value !== undefined);\r\n  let detailReport = detailReportAttr ? detailReportAttr.value : false;\r\n\r\n  let sessionIdAttr = attributes.find(attr => attr.key === 'sessionId' && attr.value !== null && attr.value !== undefined);\r\n  let invoiceIdAttr = attributes.find(attr => attr.key === 'invoiceId' && attr.value !== null && attr.value !== undefined);\r\n  console.log(\"invoiceId\", invoiceIdAttr);\r\n\r\n  // If `detailReport` is not true, then we might need to check session or invoice\r\n  if (detailReport !== true) {\r\n    // Check for Stripe session\r\n    if (sessionIdAttr && stripeSecretKey) {\r\n      let sessionId = sessionIdAttr.value;\r\n      fetch(`https://api.stripe.com/v1/checkout/sessions/${sessionId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': 'Bearer ' + stripeSecretKey\r\n        }\r\n      })\r\n        .then(response => response.json())\r\n        .then(sessionData => {\r\n            console.log(\"sessionData:\", sessionData.status);\r\n          if (sessionData.payment_status === 'paid') {\r\n            const attributesKey = [{ key: \"detailReport\", value: true }];\r\n            attributeService.saveEntityAttributes(\r\n              { entityType: 'ASSET', id: measurementID },\r\n              \"SERVER_SCOPE\",\r\n              attributesKey\r\n            ).subscribe();\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error('Error fetching session data:', error);\r\n        });\r\n    } \r\n    // Otherwise check for Stripe invoice\r\n    else if (invoiceIdAttr && stripeSecretKey) {\r\n      let invoiceId = invoiceIdAttr.value;\r\n      fetch(`https://api.stripe.com/v1/invoices/${invoiceId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': 'Bearer ' + stripeSecretKey\r\n        }\r\n      })\r\n        .then(response => response.json())\r\n        .then(invoiceData => {\r\n          console.log(\"Invoice status:\", invoiceData.status);\r\n          if (invoiceData.status === 'paid') {\r\n            const attributesKey = [{ key: \"detailReport\", value: true }];\r\n            attributeService.saveEntityAttributes(\r\n              { entityType: 'ASSET', id: measurementID },\r\n              \"SERVER_SCOPE\",\r\n              attributesKey\r\n            ).subscribe();\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error('Error fetching invoice data:', error);\r\n        });\r\n    }\r\n  }\r\n}*/\r\n\r\n// Return your layout or HTML\r\nreturn `\r\n<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\r\n  <tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"all_measurements_card\">\r\n  </tb-dashboard-state>\r\n</div>\r\n`;\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 100px;\n    margin: 6px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.main-layout .tb-mat-20 {\n    width: 1px;\n    height: 2px;\n    margin: 2px;\n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "8c0dc9e5-4621-44d6-8d59-270d531417c6"
      },
      "759db6af-2a40-7230-b19d-1b24ed66efff": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1713435502260,
                "endTimeMs": 1713521902260
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.measurement-devices.assigned-devices.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": true,
            "entityNameColumnTitle": "Name",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "Label",
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Entities table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "906dd8e6-abf4-bc27-7499-1318cb35ac80",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "{i18n:custom.diagnostics.measurement-devices.label.title}",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.902628947472164,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-devices.active.title}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar active = value;\r\nif (active == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n} else {\r\n  color = '#EB5757';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>';\r\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.8128568406469565,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "lastActivityTime",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.measurement-devices.last-activity.title}",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.0024491431557009946,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\r\n  return moment(value).format(\"DD.MM.YYYY HH:mm:ss\");\r\n}\r\nreturn '';\r\n"
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "{i18n:custom.diagnostics.measurement-devices.type.title}",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.41194127454705587,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "actionCellButton": [
              {
                "name": "{i18n:custom.diagnostics.measurement-devices.set-measurement-label.title}",
                "icon": "label",
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return !(data[\"Type\"] === 'P-Flow D116' || \r\n         data[\"Type\"] === 'LTE Status' || \r\n         data[\"Type\"] === 'LoRaWAN GAteway' || \r\n         data[\"Type\"] === 'RESI');",
                "type": "custom",
                "customFunction": {
                  "body": "utils.setRelatedEntityLabel(widgetContext, entityId);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/ECO Utils JS.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "dec548cf-31f3-8b01-c3fb-2481f865eb1f"
              },
              {
                "name": "{i18n:custom.diagnostics.measurement-devices.remove-device.title}",
                "icon": "remove_circle",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet translationService = $injector.get(widgetContext.servicesMap.get('translate'));\n\nlet customerId;\nconst MeasurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\nif (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n    /*vm.customerId = widgetContext.stateController.getStateParams().entityId;*/\n    assetService.getAsset(MeasurementId.id).subscribe(measurement => {\n    customerId = measurement.customerId;\n});\n} else {\n    customerId = {\n        id: widgetContext.currentUser.customerId,\n        entityType: 'CUSTOMER'\n    };\n}\n\nlet deviceVR;\ngetRelatedVRDevice(entityId.id).subscribe(result => {\n  deviceVR = result[0];\n  //console.log(\"device VR\", deviceVR);\n  openRemoveDeviceDialog();\n});\n\nfunction openRemoveDeviceDialog() {\n  let titleTranslation = translationService.instant(\n    'custom.diagnostics.measurement-devices.remove-device-title', { entityName: entityName });\n\n  let contentTranslation = translationService.instant(\n    'custom.diagnostics.measurement-devices.remove-device-content'\n  );\n\n  dialogs.confirm(\n    titleTranslation,\n    contentTranslation,\n    translationService.instant('action.cancel'),\n    translationService.instant('custom.diagnostics.measurement-devices.remove-device.remove-measurements')\n    ).subscribe(function(result) {\n    if (result) {\n      doRemoveDevice();\n    }\n  });\n}\n\n\nfunction doRemoveDevice() {\n  removeDevice(entityId, MeasurementId, customerId).subscribe(() => {\n      widgetContext.updateAliases();\n  });\n}\n\nfunction removeDevice(deviceId, MeasurementId, customerId) {\n    return getUnassignedDevicesGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n            return widgetContext.rxjs.forkJoin([\n                entityGroupService.addEntityToEntityGroup(unassignedDevicesGroup.id.id, deviceId.id),\n                deleteMeasurementToDeviceRelation(MeasurementId, deviceId),\n                deleteVRDeviceToDeviceRelation(deviceVR.id, deviceId),\n                deleteAttributes(deviceId)\n                //removePositionAttributes(deviceId)\n            ]);\n        })\n    );\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Measurement Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Measurement Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteMeasurementToDeviceRelation(MeasurementId, deviceId) {\n    return entityRelationService.deleteRelation(MeasurementId, 'Measurement', deviceId);\n}\n\nfunction deleteVRDeviceToDeviceRelation(deviceVRId, deviceId) {\n    return entityRelationService.deleteRelation(deviceVRId, 'VR', deviceId);\n}\nfunction deleteAttributes(deviceId){\n    return attributeService.deleteEntityAttributes(deviceId,\"SERVER_SCOPE\",[{ key: \"measurement\" }, { key: \"project\" }]);\n}\nfunction getRelatedVRDevice(deviceId) {\n  return deviceService.getDevice(deviceId).pipe(\n    widgetContext.rxjs.switchMap(device => {\n      //console.log(\"device\", device);\n      let type = device.type;\n      let typeVR = (type !== \"RESI\" && type !== \"IoT Gateway\") ? type + \" VR\" : \"Gateway VR\";\n      //console.log(\"typeVR\", typeVR);\n      let query = {\n        \"parameters\": {\n          \"rootId\": deviceId,\n          \"rootType\": \"DEVICE\",\n          \"direction\": \"TO\",\n          \"relationTypeGroup\": \"COMMON\",\n          \"maxLevel\": 1073741824,\n          \"fetchLastLevelOnly\": false\n        },\n        \"relationType\": \"VR\",\n        \"deviceTypes\": [typeVR]\n      };\n      return deviceService.findByQuery(query);\n    })\n  );\n}\n\nfunction removePositionAttributes(deviceId) {\n    return attributeService.deleteEntityAttributes(deviceId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "09f01c72-16c1-8d80-accd-ce150e7ae0be"
              }
            ],
            "headerButton": [
              {
                "name": "{i18n:custom.diagnostics.measurement-devices.go-back.title}",
                "buttonType": "icon",
                "icon": "arrow_back",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\nvar number = (widgetContext.stateController.getStateIndex())-1;\r\n\r\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\r\nwidgetContext.stateController.updateState(null,params);\r\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9a90ec87-fc5e-03ff-0ce3-ebaa79f64af3"
              },
              {
                "name": "{i18n:custom.diagnostics.measurement-devices.add-device.title}",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!-- HTML Template -->\r\n<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form mx-auto\" style=\"width: 800px;\">\r\n  <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n    <h2>{{ 'custom.diagnostics.measurement-devices.add-devices.add-device.title' | translate}}</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  \r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n    <!-- Warning message displayed on top -->\r\n    <div *ngIf=\"warningMessage\" style=\"color: #d32f2f; font-size: 14px; margin-bottom: 10px; border: 1px solid #d32f2f; padding: 8px; border-radius: 4px;\">\r\n      {{ warningMessage }}\r\n    </div>\r\n    \r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>{{ 'custom.diagnostics.measurement-devices.add-devices.assignment.title' | translate}}</ng-template>\r\n        <fieldset *ngIf=\"pFlowLimit || CO2Limit\" class=\"fieldset\" style=\"margin-bottom: 16px;\">\r\n          <div class=\"flex flex-col p-4 space-y-4\">\r\n            \r\n            <div class=\"flex w-full\">\r\n              <mat-icon *ngIf=\"pFlowLimit\" style=\"margin-right: 8px;\">info</mat-icon>\r\n              <p *ngIf=\"pFlowLimit\" style=\"font-size: 15px; margin: 0;\">\r\n                {{ 'custom.diagnostics.measurement-devices.add-devices.assignment.error.p-flow-limit' | translate }}\r\n              </p>\r\n            </div>\r\n            <div class=\"flex w-full\">\r\n              <mat-icon *ngIf=\"CO2Limit\" style=\"margin-right: 8px;\">info</mat-icon>\r\n              <p *ngIf=\"CO2Limit\" style=\"font-size: 15px; margin: 0;\">\r\n                  {{ 'custom.diagnostics.measurement-devices.add-devices.assignment.error.co2-sensor-limit' | translate }}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Device Input with Autocomplete and Filtering -->\r\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n          <mat-label>{{ 'custom.diagnostics.measurement-devices.add-devices.device.title' | translate}}</mat-label>\r\n          <input type=\"text\"\r\n                 matInput\r\n                 formControlName=\"device\"\r\n                 [matAutocomplete]=\"auto\"\r\n                 (keyup)=\"filterDevices()\"\r\n                 (focus)=\"resetFilter()\"\r\n                 required>\r\n          <mat-autocomplete #auto=\"matAutocomplete\" [displayWith]=\"displayDevice\">\r\n            <mat-option *ngFor=\"let device of filteredDevices\" [value]=\"device\">\r\n              <div class=\"device-item flex flex-col gap-1\">\r\n\r\n                <div class=\"flex flex-row\">\r\n\r\n                  <div>{{ device?.name }}</div>\r\n                </div>\r\n                <div class=\"flex flex-row justify-between items-center\">\r\n                  <div class=\"device-type\">{{ device?.type }}</div>\r\n                  <div class=\"device-label\">{{ device?.label }}</div>\r\n                </div>\r\n              </div>\r\n              <mat-divider></mat-divider>\r\n            </mat-option>\r\n          </mat-autocomplete>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').hasError('required')\">\r\n            {{ 'custom.diagnostics.measurement-devices.add-devices.device.error.required' | translate }}\r\n          </mat-error>\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.device').hasError('invalidDevice')\">\r\n              {{ 'custom.diagnostics.measurement-devices.add-devices.device.error.valid-device' | translate }}\r\n          </mat-error>\r\n        </mat-form-field>\r\n\r\n        <!-- Label Input Field -->\r\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n          <mat-label>{{ 'custom.diagnostics.measurement-devices.add-devices.measurement-label.title' | translate }}</mat-label>\r\n          <input matInput formControlName=\"label\">\r\n          <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.assignmentStep.label').hasError('required')\">\r\n            {{ 'custom.diagnostics.measurement-devices.add-devices.measurement-label.error.required' | translate }}\r\n          </mat-error>\r\n        </mat-form-field>\r\n        \r\n        <mat-form-field appearance=\"fill\" class=\"w-full\">\r\n          <mat-label>{{ 'custom.diagnostics.measurement-devices.add-devices.assigned-kit' | translate }}</mat-label>\r\n          <input matInput formControlName=\"kit\" disabled>\r\n        </mat-form-field>\r\n\r\n        <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n          <button mat-button color=\"primary\"\r\n                  type=\"button\"\r\n                  [disabled]=\"(isLoading$ | async)\"\r\n                  (click)=\"cancel()\" cdkFocusInitial>\r\n            {{ 'action.cancel' | translate }}\r\n          </button>\r\n          <button mat-button mat-raised-button color=\"primary\"\r\n                  type=\"submit\"\r\n                  [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid\">\r\n            {{ 'action.save' | translate }}\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": {
                  "body": "let $injector = widgetContext.$scope.$injector;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\r\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet translationService = $injector.get(widgetContext.servicesMap.get('translate'));\r\n\r\nlet asignedDevicesVr;\r\nlet measurementCustomer;\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nattributeService.getEntityAttributes(measurementId, 'SERVER_SCOPE', ['progress']).subscribe(progress=>{\r\n\r\n    if (!measurementId || !measurementId.id) {\r\n\r\n        console.error(\"Invalid measurementId:\", measurementId);\r\n\r\n    }else{\r\n\r\n        if (progress[0].value ==='finished' || progress[0].value === 'aborted'){\r\n            let titleTranslation = translationService.instant('custom.diagnostics.measurement-devices.add-devices.error.already-finished-or-aborted');\r\n            let progressTranslation = translationService.instant('custom.diagnostics.measurement-devices.add-devices.error.progress.title');\r\n            let stateTranslation = translationService.instant(clientUtils.toKebabCase(`custom.diagnostics.measurement-details.state.${progress[0]?.value}`));\r\n        \r\n            widgetContext.dialogs.alert(titleTranslation, `${progressTranslation}: ${stateTranslation}`);\r\n\r\n        } else {\r\n\r\n            assetService.getAsset(measurementId.id).subscribe(response =>{\r\n\r\n            //console.log(\"response\",response);\r\n\r\n            measurementCustomer = response.ownerId;\r\n\r\n            checkAssignedDevices(measurementId.id);\r\n\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n});\r\n\r\nfunction deleteVirtualDevice(deviceVR) {\r\n    // Assumes deviceVR.id.id is the proper identifier.\r\n    return deviceService.deleteDevice(deviceVR.id.id);\r\n}\r\n\r\nfunction getRelatedVRPflows(measurementId) {\r\n    // Adapted query to fetch multiple device types.\r\n    let query = {\r\n        \"parameters\": {\r\n            \"rootId\": measurementId,\r\n            \"rootType\": \"ASSET\",\r\n            \"direction\": \"FROM\",\r\n            \"relationTypeGroup\": \"COMMON\",\r\n            \"maxLevel\": 1073741824,\r\n            \"fetchLastLevelOnly\": false\r\n        },\r\n        \"relationType\": \"Measurement VR\",\r\n        \"deviceTypes\": [\"P-Flow D116 VR\", \"Room Sensor CO2 VR\", \"Gateway VR\", \"Temperature Sensor VR\"]\r\n    };\r\n    return deviceService.findByQuery(query);\r\n}\r\n\r\nfunction getRelatedKit(deviceId) {\r\n    let query = {\r\n        \"parameters\": {\r\n            \"rootId\": deviceId,\r\n            \"rootType\": \"DEVICE\",\r\n            \"direction\": \"TO\",\r\n            \"relationTypeGroup\": \"COMMON\",\r\n            \"maxLevel\": 1073741824,\r\n            \"fetchLastLevelOnly\": false\r\n        },\r\n        \"relationType\": \"Contains\",\r\n        \"assetTypes\": [\"Diagnostickit\"]\r\n    };\r\n    return assetService.findByQuery(query);\r\n}\r\n\r\n// Helper function to get kit subscription info.\r\nfunction getKitInfo(kitId) {\r\n    return attributeService.getEntityAttributes(kitId, 'SERVER_SCOPE', ['subscriptionStatus', 'validTo']);\r\n}\r\n\r\nfunction checkAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\", \"Temperature Sensor\", \"RESI\", \"IoT Gateway\"]\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            getRelatedVRPflows(measurementId).subscribe(result => {\r\n                // Rename pFlowsVr to asignedDevicesVr.\r\n                asignedDevicesVr = result;\r\n                let maxLimitPFlows = false;\r\n                let maxLimitRoomSensorCO2 = false;\r\n                const pFlows = devices.filter(device => device.type === \"P-Flow D116\");\r\n                const roomSensorCO2 = devices.filter(device => device.type === \"Room Sensor CO2\");\r\n\r\n                if (pFlows.length > 0) {\r\n                    maxLimitPFlows = true;\r\n                }\r\n                if (roomSensorCO2.length > 99) {\r\n                    maxLimitRoomSensorCO2 = true;\r\n                }\r\n\r\n                openAddDeviceDialog(maxLimitPFlows, maxLimitRoomSensorCO2, asignedDevicesVr);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error fetching devices:\", error);\r\n                openAddDeviceDialog(false, false, []);\r\n            });\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(maxLimitPFlows, maxLimitRoomSensorCO2, asignedDevicesVr) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        maxLimitPFlows,\r\n        maxLimitRoomSensorCO2,\r\n        asignedDevicesVr\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    let vm = instance;\r\n    const {\r\n        measurementId,\r\n        maxLimitPFlows,\r\n        maxLimitRoomSensorCO2,\r\n        asignedDevicesVr\r\n    } = vm.data || {};\r\n\r\n    vm.pFlowLimit = !!maxLimitPFlows;\r\n    vm.CO2Limit = !!maxLimitRoomSensorCO2;\r\n    vm.asignedDevicesVr = asignedDevicesVr; // Array of virtual devices\r\n\r\n    // This property will hold any warning message regarding kit expiry.\r\n    vm.warningMessage = null;\r\n\r\n    // Filtering/search variables\r\n    vm.availableDevices = [];\r\n    vm.filteredDevices = [];\r\n\r\n    // Device selection validator.\r\n    function deviceSelectionValidator(control) {\r\n       if (!control.value) { return null; }\r\n       return (typeof control.value === 'object' && control.value !== null)\r\n         ? null\r\n         : { invalidDevice: true };\r\n    }\r\n    \r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                device: [null, [vm.validators.required, deviceSelectionValidator]],\r\n                label: [{ value: null, disabled: false }],\r\n                kit: [{ value: null, disabled: true }]\r\n            })\r\n        })\r\n    });\r\n\r\n    vm.displayDevice = function(device) {\r\n        return device ? `${device.name} (${device.type})` : '';\r\n    };\r\n\r\n    vm.filterDevices = function () {\r\n        const searchValue = vm.addDeviceFormGroup.get('stepper.assignmentStep.device').value;\r\n        const filterValue = (typeof searchValue === 'string' ? searchValue.toLowerCase() : '');\r\n        if (!filterValue) {\r\n            vm.filteredDevices = vm.availableDevices.slice();\r\n            return;\r\n        }\r\n        vm.filteredDevices = vm.availableDevices.filter(device =>\r\n            device.name.toLowerCase().includes(filterValue) || \r\n            device.label.toLowerCase().includes(filterValue) ||\r\n            device.type.toLowerCase().includes(filterValue)\r\n        );\r\n    };\r\n    \r\n    vm.resetFilter = function () {\r\n        vm.filteredDevices = vm.availableDevices.slice();\r\n    };\r\n\r\n    vm.addDeviceFormGroup.get('stepper.assignmentStep.device').valueChanges.subscribe(value => {\r\n        vm.warningMessage = null;\r\n        if (typeof value === 'string') {\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.label').disable();\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.kit').setValue(null);\r\n        } else if (value) {\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.label').enable();\r\n            vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { label: value.label } } }, { emitEvent: false });\r\n            \r\n            let selectedDeviceId = value.deviceId.id;\r\n            let kitSearchQuery = {\r\n                parameters: {\r\n                    rootId: selectedDeviceId,\r\n                    rootType: 'DEVICE',\r\n                    direction: 'TO',\r\n                    relationTypeGroup: 'COMMON',\r\n                    maxLevel: 1073741824,\r\n                    fetchLastLevelOnly: false\r\n                },\r\n                relationType: 'Contains',\r\n                assetTypes: ['Diagnostickit']\r\n            };\r\n\r\n            assetService.findByQuery(kitSearchQuery).subscribe((kitData) => {\r\n                if (kitData && kitData.length > 0) {\r\n                    let kitName = kitData[0].name;\r\n                    vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { kit: kitName } } }, { emitEvent: false });\r\n                    let kitId = kitData[0].id;\r\n                    getKitInfo(kitId).subscribe(kitAttributes => {\r\n                        const subAttr = kitAttributes.find(attr => attr.key === 'subscriptionStatus');\r\n                        const validToAttr = kitAttributes.find(attr => attr.key === 'validTo');\r\n                        const status = subAttr ? subAttr.value.toLowerCase() : null;\r\n                        if ((status === 'canceled' || status === 'cancelled') && validToAttr) {\r\n                            let validToDate = new Date(validToAttr.value);\r\n                            let now = new Date();\r\n                            if (validToDate > now) {\r\n                                let diffDays = Math.ceil((validToDate - now) / (1000 * 3600 * 24));\r\n                                if (diffDays < 31) {\r\n                                    vm.warningMessage = `The diagnostic kit license for the selected device will expire in ${diffDays} days. Please refrain from assigning this device if the measurement duration exceeds this period to prevent potential data loss.`;\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                } else {\r\n                    vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { kit: '' } } }, { emitEvent: false });\r\n                }\r\n            }, (error) => {\r\n                console.error(\"Error fetching kit data:\", error);\r\n                vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { kit: '' } } }, { emitEvent: false });\r\n            });\r\n        }\r\n    });\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        // Retrieve selected device.\r\n        var device = vm.addDeviceFormGroup.value.stepper.assignmentStep.device;\r\n        if (!device) { return; }\r\n        \r\n        // Compute measurementName and expected virtual device name.\r\n        var measurementName = widgetContext.stateController.getStateParams().selectedMeasurement.entityName;\r\n        var expectedVrName = measurementName + \"_\" + device.name;\r\n\r\n        // Check if a virtual device already exists with the expected name.\r\n        var existingVr = vm.asignedDevicesVr ? vm.asignedDevicesVr.find(vrDevice => vrDevice.name === expectedVrName) : null;\r\n\r\n        // If found, do not show confirm, just create relation from selected device to the existing VR device.\r\n        if (existingVr) {\r\n            saveAttributes(device.deviceId).subscribe();\r\n            createRelationToExistingVR(existingVr);\r\n            return;\r\n        }\r\n\r\n        // Otherwise, for P-Flow D116, check if any conflicting VR exists.\r\n        if (device.type === \"P-Flow D116\") {\r\n            var conflictingVr = vm.asignedDevicesVr ? vm.asignedDevicesVr.find(vrDevice => vrDevice.type === \"P-Flow D116 VR\") : null;\r\n            if (conflictingVr) {\r\n                // Show confirmation if a conflicting VR (of type \"P-Flow D116 VR\") exists.\r\n                let title = 'Confirm Removal of conflicting Data';\r\n                let content = 'A Device that conflicts with selected one was already assigned ones to this measurement. ' +\r\n                              'Would you like to remove the existing data related to old device and assign the new one? ' +\r\n                              'Please note that all Data regarding the old device will be removed from this Measurement and that this action is irreversible.';\r\n                widgetContext.dialogs.confirm(title, content, 'Cancel', 'Remove and Assign').subscribe(function(result) {\r\n                    if (result) {\r\n                        deleteVirtualDevice(conflictingVr).subscribe(() => {\r\n                            proceedWithSave();\r\n                        }, (error) => {\r\n                            console.error(\"Error deleting virtual device:\", error);\r\n                        });\r\n                    } else {\r\n                        return;\r\n                    }\r\n                });\r\n                return;\r\n            }\r\n        }\r\n        // For non-P-Flow devices or if no conflict exists, create a new VR device.\r\n        proceedWithSave();\r\n\r\n        function createRelationToExistingVR(existingVr) {\r\n            var measurementId = widgetContext.stateController.getStateParams().selectedMeasurement.entityId;\r\n            var customerId = measurementCustomer;\r\n            var deviceId = device.deviceId;\r\n            widgetContext.rxjs.forkJoin([\r\n                entityGroupService.removeEntityFromEntityGroup(vm.unassignedDevicesGroup.id.id, deviceId.id),\r\n                saveDeviceToMeasurementRelation(measurementId, deviceId),\r\n                saveDeviceVRToMeasurementRelation(measurementId, existingVr.id),\r\n                saveDeviceToVrDeviceRelation(existingVr.id, deviceId),\r\n                saveAttributes(existingVr.id)\r\n            ]).subscribe(() => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            });\r\n        }\r\n\r\n        function proceedWithSave() {\r\n            var measurementId = widgetContext.stateController.getStateParams().selectedMeasurement.entityId;\r\n            var customerId = measurementCustomer;\r\n            var deviceId = device.deviceId;\r\n            var deviceNameVR = measurementName + \"_\" + device.name;\r\n            var deviceProfileVR = (device.type !== \"RESI\" && device.type !== \"IoT Gateway\") ? device.type + \" VR\" : \"Gateway VR\";\r\n            let deviceVR = {\r\n                name: deviceNameVR,\r\n                type: deviceProfileVR,\r\n                label: vm.addDeviceFormGroup.value.stepper.assignmentStep.label,\r\n                customerId: customerId,\r\n            };\r\n            deviceService.saveDevice(deviceVR).subscribe(savedDevice => {\r\n                widgetContext.rxjs.forkJoin([\r\n                    entityGroupService.removeEntityFromEntityGroup(vm.unassignedDevicesGroup.id.id, deviceId.id),\r\n                    saveDeviceToMeasurementRelation(measurementId, deviceId),\r\n                    saveDeviceVRToMeasurementRelation(measurementId, savedDevice.id),\r\n                    saveDeviceToVrDeviceRelation(savedDevice.id, deviceId),\r\n                    saveAttributes(savedDevice.id),\r\n                    saveAttributes(deviceId)\r\n                ]).subscribe(() => {\r\n                    widgetContext.updateAliases();\r\n                    vm.dialogRef.close(null);\r\n                });\r\n            });\r\n        }\r\n    };\r\n\r\n    init();\r\n\r\n    function init() {\r\n        vm.unassignedDevicesGroup = null;\r\n        vm.assignedDevicesGroup = null;\r\n        vm.availableDevices = [];\r\n        vm.assignedDevices = [];\r\n\r\n        if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n            vm.customerId = measurementCustomer;\r\n        } else {\r\n            vm.customerId = {\r\n                id: widgetContext.currentUser.customerId,\r\n                entityType: 'CUSTOMER'\r\n            };\r\n        }\r\n\r\n        entityGroupService.getEntityGroupsByOwnerId(vm.customerId.entityType, vm.customerId.id, 'DEVICE').subscribe((entityGroups) => {\r\n            vm.customerDevicesGroups = entityGroups;\r\n            vm.unassignedDevicesGroup = entityGroups.find(group => group.name === 'Unassigned Measurement Devices');\r\n            vm.assignedDevicesGroup = entityGroups.find(group => group.name === 'Measurement Devices');\r\n            const unassignedDiagnostickitGroup = entityGroups.find(group => group.name === 'Unassigned Diagnostickit Devices');\r\n\r\n            if (vm.unassignedDevicesGroup) {\r\n                var query = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.unassignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: { pageSize: 1000, page: 0 },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query).subscribe((data) => {\r\n                    vm.availableDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value,\r\n                            deviceId: entityData.entityId\r\n                        };\r\n                    });\r\n                    if (unassignedDiagnostickitGroup) {\r\n                        var kitQuery = {\r\n                            entityFilter: {\r\n                                type: 'entityGroup',\r\n                                groupType: 'DEVICE',\r\n                                entityGroup: unassignedDiagnostickitGroup.id.id\r\n                            },\r\n                            pageLink: { pageSize: 1000, page: 0 },\r\n                            entityFields: [{ key: 'name', type: 'ENTITY_FIELD' }]\r\n                        };\r\n                        entityService.findEntityDataByQuery(kitQuery).subscribe((kitData) => {\r\n                            const diagnostickitDeviceIds = kitData.data.map(entityData => entityData.entityId.id);\r\n                            vm.availableDevices = vm.availableDevices.filter(device => !diagnostickitDeviceIds.includes(device.deviceId.id));\r\n                            finalizeDevices();\r\n                        });\r\n                    } else {\r\n                        finalizeDevices();\r\n                    }\r\n                });\r\n            }\r\n            \r\n            function finalizeDevices() {\r\n                if (maxLimitPFlows === true) {\r\n                    vm.availableDevices = vm.availableDevices.filter(device => device.type !== \"P-Flow D116\");\r\n                }\r\n                if (maxLimitRoomSensorCO2 === true) {\r\n                    vm.availableDevices = vm.availableDevices.filter(device => device.type !== \"Room Sensor CO2\");\r\n                }\r\n                vm.availableDevices.sort(function (a, b) {\r\n                    const hexPattern = /^ECO_([0-9A-Fa-f]{8})/;\r\n                    const matchA = a.name.match(hexPattern);\r\n                    const matchB = b.name.match(hexPattern);\r\n                    if (matchA && matchB) {\r\n                        const numA = parseInt(matchA[1], 16);\r\n                        const numB = parseInt(matchB[1], 16);\r\n                        return numA - numB;\r\n                    } else {\r\n                        return a.name.localeCompare(b.name);\r\n                    }\r\n                });\r\n                \r\n                const filteredDevicesObservables = vm.availableDevices.map(device => {\r\n                    return getRelatedKit(device.deviceId.id).pipe(\r\n                        widgetContext.rxjs.switchMap(kitData => {\r\n                            if (kitData && kitData.length > 0) {\r\n                                const kitId = kitData[0].id;\r\n                                return getKitInfo(kitId).pipe(\r\n                                    widgetContext.rxjs.map(kitAttributes => {\r\n                                        const subAttr = kitAttributes.find(attr => attr.key === 'subscriptionStatus');\r\n                                        const validToAttr = kitAttributes.find(attr => attr.key === 'validTo');\r\n                                        const status = subAttr ? subAttr.value.toLowerCase() : null;\r\n                                        if ((status === 'canceled' || status === 'cancelled')) {\r\n                                            if (validToAttr) {\r\n                                                let validToDate = new Date(validToAttr.value);\r\n                                                let now = new Date();\r\n                                                if (validToDate > now) { return device; }\r\n                                            }\r\n                                            return null;\r\n                                        } else if (status === 'no subscription' || status === 'inactive') {\r\n                                            return null;\r\n                                        } else {\r\n                                            return device;\r\n                                        }\r\n                                    })\r\n                                );\r\n                            } else {\r\n                                return widgetContext.rxjs.of(device);\r\n                            }\r\n                        })\r\n                    );\r\n                });\r\n                \r\n                widgetContext.rxjs.forkJoin(filteredDevicesObservables).subscribe(results => {\r\n                    vm.availableDevices = results.filter(device => device !== null);\r\n                    filterDevicesByMeasurementType(measurementId);\r\n                    vm.filteredDevices = vm.availableDevices.slice();\r\n                });\r\n            }\r\n\r\n            if (vm.assignedDevicesGroup) {\r\n                var query2 = {\r\n                    entityFilter: {\r\n                        type: 'entityGroup',\r\n                        groupType: 'DEVICE',\r\n                        entityGroup: vm.assignedDevicesGroup.id.id\r\n                    },\r\n                    pageLink: { pageSize: 100, page: 0 },\r\n                    entityFields: [\r\n                        { key: 'name', type: 'ENTITY_FIELD' },\r\n                        { key: 'type', type: 'ENTITY_FIELD' },\r\n                        { key: 'label', type: 'ENTITY_FIELD' }\r\n                    ]\r\n                };\r\n                entityService.findEntityDataByQuery(query2).subscribe((data) => {\r\n                    vm.assignedDevices = data.data.map((entityData) => {\r\n                        return {\r\n                            deviceId: entityData.entityId,\r\n                            name: entityData.latest[\"ENTITY_FIELD\"].name.value,\r\n                            type: entityData.latest[\"ENTITY_FIELD\"].type.value,\r\n                            label: entityData.latest[\"ENTITY_FIELD\"].label.value\r\n                        };\r\n                    });\r\n                    if (additionalParams && (additionalParams.source === \"qrcode\" || additionalParams.source === \"replace Device\")) {\r\n                        checkAdditionalParams();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n    \r\n    function filterDevicesByMeasurementType(measurementId) {\r\n        attributeService.getEntityAttributes(measurementId, 'SERVER_SCOPE').subscribe(\r\n            (attributes) => {\r\n                const measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\r\n                if (!measurementTypeAttr) {\r\n                    console.warn(\"Measurement type attribute not found; no filtering applied.\");\r\n                    return;\r\n                }\r\n                const measurementType = measurementTypeAttr.value;\r\n                if (measurementType === 'ultrasonic') {\r\n                    vm.availableDevices = vm.availableDevices.filter(device =>\r\n                        ['P-Flow D116', 'Temperature Sensor', 'RESI'].includes(device.type)\r\n                    );\r\n                } else if (measurementType === 'loraWan') {\r\n                    vm.availableDevices = vm.availableDevices.filter(device =>\r\n                        device.type === 'Room Sensor CO2'\r\n                    );\r\n                }\r\n                vm.filteredDevices = vm.availableDevices.slice();\r\n            },\r\n            (error) => {\r\n                console.error(\"Error fetching measurement attributes:\", error);\r\n            }\r\n        );\r\n    }\r\n\r\n    function saveAttributes(deviceId) {\r\n        const attributesArray = [\r\n            { key: \"xPos\", value: \"0\" },\r\n            { key: \"yPos\", value: \"0\" },\r\n            { key: \"measurement\", value: widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityName },\r\n            { key: \"project\", value: widgetContext.stateController.getStateParams()?.selectedProject?.entityName}\r\n        ];\r\n        return attributeService.saveEntityAttributes(deviceId, 'SERVER_SCOPE', attributesArray);\r\n    }\r\n\r\n    function saveDeviceToMeasurementRelation(measurementId, deviceId) {\r\n        var relation = { from: measurementId, to: deviceId, typeGroup: 'COMMON', type: 'Measurement' };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n    function saveDeviceVRToMeasurementRelation(measurementId, deviceVRId) {\r\n        var relation = { from: measurementId, to: deviceVRId, typeGroup: 'COMMON', type: 'Measurement VR' };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n    function saveDeviceToVrDeviceRelation(deviceVRId, deviceId) {\r\n        var relation = { from: deviceVRId, to: deviceId, typeGroup: 'COMMON', type: 'VR' };\r\n        return entityRelationService.saveRelation(relation);\r\n    }\r\n\r\n    function updateDeviceLabel(device, label) {\r\n        if (device.label !== label) {\r\n            return deviceService.getDevice(device.deviceId.id).pipe(\r\n                widgetContext.rxjs.switchMap((origDevice) => {\r\n                    origDevice.label = label;\r\n                    return deviceService.saveDevice(origDevice);\r\n                })\r\n            );\r\n        } else {\r\n            return widgetContext.rxjs.of(null);\r\n        }\r\n    }\r\n\r\n    function checkAdditionalParams() {\r\n        const matchingAvailableDevice = vm.availableDevices.find(device => device.name === additionalParams.code);\r\n        const matchingAssignedDevice = vm.assignedDevices.find(device => device.name === additionalParams.code);\r\n        if (!matchingAvailableDevice && !matchingAssignedDevice) {\r\n            widgetContext.dialogs.alert(\"Device doesn't exist\").subscribe();\r\n        }\r\n        if (matchingAssignedDevice && !matchingAvailableDevice) {\r\n            getMeasurement(additionalParams.code);\r\n        }\r\n        if (matchingAvailableDevice && matchingAssignedDevice) {\r\n            vm.addDeviceFormGroup.patchValue({ stepper: { assignmentStep: { device: matchingAvailableDevice } } }, { emitEvent: false });\r\n            vm.addDeviceFormGroup.get('stepper.assignmentStep.device').markAsDirty();\r\n            vm.addDeviceFormGroup.updateValueAndValidity();\r\n            setTimeout(() => {\r\n                const selectElement = document.querySelector('input[formControlName=\"device\"]');\r\n                if (selectElement) { selectElement.dispatchEvent(new Event('input')); }\r\n                if (!vm.changeDetectorRef) {\r\n                    vm.changeDetectorRef = widgetContext.$scope.$injector.get('$rootScope').$root.$$childHead;\r\n                }\r\n                vm.changeDetectorRef.$applyAsync();\r\n            });\r\n        }\r\n    }\r\n\r\n    function getMeasurement(code) {\r\n        vm.deviceEntityId = null;\r\n        vm.relations = null;\r\n        vm.assignedToMeasurement = null;\r\n        deviceService.findByName(code)\r\n            .pipe(widgetContext.rxjs.map((origDevice) => {\r\n                    vm.deviceEntityId = origDevice.id.id;\r\n                })\r\n            ).subscribe(() => {\r\n                entityRelationService.findByTo({ 'id': vm.deviceEntityId, 'entityType': 'DEVICE' })\r\n                    .pipe(widgetContext.rxjs.map((origRelation) => {\r\n                        vm.relations = origRelation[0].from.id;\r\n                    })\r\n                ).subscribe(() => {\r\n                    assetService.getAsset(vm.relations)\r\n                        .pipe(widgetContext.rxjs.map((origAsset) => {\r\n                            vm.assignedToMeasurement = origAsset.name;\r\n                        })\r\n                    ).subscribe(() => {\r\n                        let actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\r\n                        let qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"replace-device\");\r\n                        let params = {\r\n                            \"measurement\": vm.assignedToMeasurement,\r\n                            \"device\": vm.deviceEntityId,\r\n                            \"code\": additionalParams.code\r\n                        };\r\n                        try {\r\n                            vm.dialogRef.close(null);\r\n                            widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\r\n                        } catch (error) {\r\n                            widgetContext.dialogs.alert('Error handling widget action:', error);\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n    }\r\n}\r\n",
                  "modules": {
                    "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js"
                  }
                },
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "628f2502-26dd-276f-8193-a0467dcdc695"
              },
              {
                "name": "{i18n:custom.diagnostics.measurement-devices.add-device-q.title}",
                "buttonType": "icon",
                "icon": "qr_code_scanner",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": true,
                "showWidgetActionFunction": "return false;",
                "type": "mobileAction",
                "mobileAction": {
                  "type": "scanQrCode",
                  "handleEmptyResultFunction": "// Optional function body to handle empty result. \n// Usually this happens when user cancels the action (for ex. by pressing phone back button). \n\nshowEmptyResultDialog('Scan QR code action was canceled!');\n\nfunction showEmptyResultDialog(message) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert('Empty result', message).subscribe();\n    }, 100);\n}\n",
                  "handleErrorFunction": "// Optional function body to handle error occurred while mobile action execution \n// - error - Error message\n\nshowErrorDialog('Failed to scan QR code', error);\n\nfunction showErrorDialog(title, error) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, error).subscribe();\n    }, 100);\n}\n",
                  "processQrCodeFunction": "// Function body to process result of QR code scanning. \n// - code - scanned QR code\n// - format - scanned QR code format\n//widgetContext.actionsApi.qrCodeCallback(code);\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet actionDescriptors = widgetContext.actionsApi.getActionDescriptors(\"elementClick\");\nlet qrCodeActionDescriptor = actionDescriptors.find(descriptor => descriptor.name === \"add-device\");\n\nlet params = {\n    source: \"qrcode\",\n    code: code\n}\ntry {\n    widgetContext.actionsApi.handleWidgetAction({}, qrCodeActionDescriptor, null, null, params);\n} catch (error) {\n    widgetContext.dialogs.alert('Error handling widget action:', error);\n}\n\n//showQrCodeDialog(\"Code\", code, format);\nfunction showQrCodeDialog(title, code, format) {\n    setTimeout(function() {\n        widgetContext.dialogs.alert(title, 'Code: ['+code+']<br>Format: ' + format).subscribe();\n    }, 100);\n}\n\n"
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "822d20eb-76b0-1464-e924-07f3abc70722"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "list",
          "iconColor": null,
          "titleFont": null,
          "titleColor": null,
          "enableDataExport": false,
          "desktopHide": true,
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "759db6af-2a40-7230-b19d-1b24ed66efff"
      },
      "8a9cf679-044c-bc77-c1f3-8d6e3dd7f76e": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Project Name",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "readonly",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.7261262741197994,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#048AD3",
                  "settings": {},
                  "_hash": 0.5038713353626756
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7434410240897191,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "Progress",
                  "color": "#ffc107",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "in preparation",
                        "label": "In Preparation"
                      },
                      {
                        "value": "active",
                        "label": "Active"
                      },
                      {
                        "value": "finished",
                        "label": "Finished"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.3710536025574047,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1707571374578,
                "endTimeMs": 1707657774578
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": null,
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "widgetTitle": "Doktorkit Attributes",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": true,
            "saveButtonLabel": "Save",
            "resetButtonLabel": "Undo",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 1,
            "rowGap": 5,
            "columnGap": 10
          },
          "title": "Update Multiple Attributes",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {
            "headerButton": []
          },
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleIcon": null,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "8a9cf679-044c-bc77-c1f3-8d6e3dd7f76e"
      },
      "a13d46ba-5bac-f5a0-4a1a-246e7d695a3b": {
        "typeFullFqn": "system.input_widgets.update_multiple_attributes",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Measurement ID",
                  "color": "#f44336",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "readonly",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.7261262741197994,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "Progress",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": false,
                    "isEditable": "readonly",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "in preparation",
                        "label": "in preparation"
                      },
                      {
                        "value": "active",
                        "label": "active"
                      },
                      {
                        "value": "finished",
                        "label": "finished"
                      },
                      {
                        "value": "aborted",
                        "label": "aborted"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.21095133710709724,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "Installation Type",
                  "color": "#e91e63",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "select",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [
                      {
                        "value": "cooling",
                        "label": "Cooling"
                      },
                      {
                        "value": "heating",
                        "label": "Heating"
                      }
                    ],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.21277466910118492,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.859170990312162,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "Measurement Alias",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.3661436310629984,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "Activity",
                  "color": "#8bc34a",
                  "settings": {
                    "dataKeyHidden": true,
                    "dataKeyType": "server",
                    "dataKeyValueType": "booleanSwitch",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.906407032891368,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "Longitude",
                  "color": "#607d8b",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.43074100328683707,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "Latitude",
                  "color": "#9c27b0",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "string",
                    "required": true,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.6537625289167603,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "from",
                  "type": "attribute",
                  "label": "From",
                  "color": "#3f51b5",
                  "settings": {
                    "dataKeyHidden": false,
                    "dataKeyType": "server",
                    "dataKeyValueType": "date",
                    "required": false,
                    "isEditable": "editable",
                    "disabledOnDataKey": "active",
                    "appearance": "outline",
                    "subscriptSizing": "fixed",
                    "slideToggleLabelPosition": "after",
                    "selectOptions": [],
                    "step": 1,
                    "minValue": null,
                    "maxValue": null,
                    "requiredErrorMessage": "",
                    "minValueErrorMessage": "",
                    "maxValueErrorMessage": "",
                    "invalidDateErrorMessage": "",
                    "invalidJsonErrorMessage": "",
                    "dialogTitle": "",
                    "saveButtonLabel": "",
                    "cancelButtonLabel": "",
                    "useCustomIcon": false,
                    "icon": "",
                    "customIcon": "",
                    "useGetValueFunction": false,
                    "getValueFunctionBody": "",
                    "useSetValueFunction": false,
                    "setValueFunctionBody": ""
                  },
                  "_hash": 0.5519683485420257,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1707571374578,
                "endTimeMs": 1707657774578
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": null,
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "40",
          "settings": {
            "widgetTitle": "Edit Measurement",
            "showResultMessage": true,
            "showActionButtons": true,
            "updateAllValues": true,
            "saveButtonLabel": "Save",
            "resetButtonLabel": "Undo",
            "showGroupTitle": false,
            "groupTitle": "${entityName}",
            "fieldsAlignment": "row",
            "fieldsInRow": 1,
            "rowGap": 5,
            "columnGap": 10
          },
          "title": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {
            "margin-top": "5px"
          },
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {
            "headerButton": []
          },
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleIcon": null,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "margin": "",
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "a13d46ba-5bac-f5a0-4a1a-246e7d695a3b"
      },
      "459728d3-2563-a76e-58c5-897af4411d74": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.2843241633853528
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.269921240377482,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "16px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<!--<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\">\n    </div>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n        <div fxFlex=\"50\" fxLayout=\"column\">\n            <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n            <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>\n        </div>\n        <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n        <div fxFlex=\"50\" fxLayout=\"column\">\n            <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n            <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>\n        </div>\n    </div>\n</div>-->\n<div fxLayout=\"row\" fxLayoutAlign=\"center center\" style=\"margin-bottom: 20px; padding: 10px; background-color: #ffffff;\">\n    <button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\n        <mat-icon class=\"tb-mat-18\">map</mat-icon>\n        <span>Plan</span>\n    </button>\n    <button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\n        <mat-icon class=\"tb-mat-18\">equalizer</mat-icon>\n        <span>Raw Data</span>\n    </button>\n</div>\n\n<!--<mat-tab-group>\n  <mat-tab label=\"Plan\">\n    <div class=\"market-layout\" \n         style=\"width: 100%; height: 100%; padding: 0;\" \n         fxLayout=\"column\">\n      <div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\">\n      </div>\n      <tb-dashboard-state \n          fxFlex=\"70\" \n          [ctx]=\"ctx\" \n          [syncParentStateParams]=\"true\" \n          stateId=\"measurement_plan\">\n      </tb-dashboard-state>\n      <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n      <div fxFlex=\"30\" fxLayout=\"row\">\n        <div fxFlex=\"50\" fxLayout=\"column\">\n          <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n          <tb-dashboard-state \n              fxFlex \n              [ctx]=\"ctx\" \n              stateId=\"measurement_filter\">\n          </tb-dashboard-state>\n        </div>\n        <mat-divider vertical \n            style=\"margin-left: 20px; margin-right: 20px;\">\n        </mat-divider>\n        <div fxFlex=\"50\" fxLayout=\"column\">\n          <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n          <tb-dashboard-state \n              fxFlex \n              [ctx]=\"ctx\" \n              stateId=\"state_filter\">\n          </tb-dashboard-state>\n        </div>\n      </div>\n    </div>\n  </mat-tab>\n  <mat-tab label=\"Raw Data\">\n  </mat-tab>\n</mat-tab-group>-->",
            "markdownTextFunction": "const locationName = data.locationName;\nconst name = data.name;\n\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + locationName + '</div>' +\n                   '<div class=\"subtitle\">' + name + '</div>' +\n                '</div>';\n\nreturn '<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">' +\n        header + \n        '<tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>' + \n        '<tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>' +\n        '<mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>' +\n        '<div fxFlex=\"30\" fxLayout=\"row\">' +\n            '<div fxFlex=\"60\" fxLayout=\"column\">' +\n                '<h5 style=\"padding-bottom: 15px;\">Filter</h5>' +\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>' +\n            '</div>' +\n            '<mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>' +\n            '<div fxFlex=\"40\" fxLayout=\"column\">' +\n                '<h5 style=\"padding-bottom: 15px;\">State filter</h5>' +\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>' +\n            '</div>' +\n        '</div>' +\n    '</div>';\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n/*.market-layout {\n    position: relative;\n    padding-top: 0; \n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n    margin-top: 0; \n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n    margin-top: -5px; \n}*/\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n.tb-widget-container .tb-widget .leaflet-control-zoom {\n    display: none;\n}\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "raw-data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_raw_data",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "40ba9137-777a-c574-eb7b-b53e1690a797"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "459728d3-2563-a76e-58c5-897af4411d74",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "a5a5575c-dac4-7d8a-0422-9a7754f2eab7": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.4880248004489329
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.334866663156842
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": "// let mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementAlarms';\r\nlet mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementSignalStrength';\r\n\r\nlet params = ctx.stateController.getStateParams();\r\nlet switchTimeWindow = null;\r\nlet startTimeMs, endTimeMs;\r\n\r\nif (data && data.length) {\r\n    startTimeMs = data[0].startTimeMs || 0;\r\n    endTimeMs = data[0].endTimeMs || 0;\r\n}\r\n\r\nif (startTimeMs !== 0 && endTimeMs !== 0) {\r\n    if (endTimeMs - startTimeMs <= 1209600000) {\r\n        switchTimeWindow = 1;\r\n    } else {\r\n        switchTimeWindow = 2;\r\n    }\r\n}\r\n\r\nvar vm = this;\r\n\r\nvm.onInit = function() {\r\n    \r\n};\r\n\r\nvm.updateMode = function(newMode) {\r\n    let params = vm.ctx.stateController.getStateParams() || {};\r\n    params.targetMode = newMode;\r\n    vm.ctx.stateController.updateState(null, params);\r\n};\r\n\r\nswitch (switchTimeWindow) {\r\n    case 1:\r\n    case 2:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: startTimeMs,\r\n                    endTimeMs: endTimeMs\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n    default:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: Date.now() - 1209600000,\r\n                    endTimeMs: Date.now()\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n}\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, params);\r\n\r\nreturn '' +\r\n'<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n  '<tb-dashboard-state style=\"height: 100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_card_header\"></tb-dashboard-state>' +\r\n  '<tb-dashboard-state style=\"height: 100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_card_details\"></tb-dashboard-state>' +\r\n  '<mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>' +\r\n  '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding: 10px 8px; background-color: #ffffff;\">' +\r\n    \r\n    '<button id=\"alarms-button\" type=\"button\" mat-button color=\"primary\" ' +\r\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\r\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementAlarms\\')\">' +\r\n      '<mat-icon class=\"tb-mat-18\">map</mat-icon>' +\r\n      '<span>Alarms</span>' +\r\n    '</button>' +\r\n    \r\n    '<button id=\"signal-strength-button\" type=\"button\" mat-button color=\"primary\" ' +\r\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\r\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementSignalStrength\\')\">' +\r\n      '<mat-icon class=\"tb-mat-18\">signal_cellular_alt</mat-icon>' +\r\n      '<span>Signal Strength</span>' +\r\n    '</button>' +\r\n  '</div>' +\r\n  \r\n  (mode === 'selectedMeasurementSignalStrength'\r\n    ? '<mat-expansion-panel style=\"margin: 8px; box-shadow: none; background-color: #fafafa;\">' +\r\n        '<mat-expansion-panel-header>' +\r\n          '<mat-panel-title style = \"color: #757575;\">' +\r\n            'Signal Strength Legend' +\r\n          '</mat-panel-title>' +\r\n        '</mat-expansion-panel-header>' +\r\n        '<mat-tab-group>' +\r\n          \r\n          '<mat-tab label=\"RSRP\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= -80</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-80 to -90</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-90 to -100</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -100</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"RSRQ\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= -10</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-10 to -15</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-15 to -20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -20</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"RSSI\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt; -65</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-65 to -75</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Fair</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-75 to -85</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Poor</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -85</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"SNR\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= 20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">13 to 20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">0 to 13</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= 0</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n        '</mat-tab-group>' +\r\n      '</mat-expansion-panel>'\r\n    : ''\r\n  ) +\r\n  \r\n  (mode === 'selectedMeasurementAlarms'\r\n    ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_alarms\"></tb-dashboard-state>'\r\n    : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"signal_strength\"></tb-dashboard-state>'\r\n  ) +\r\n'</div>';\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow.no-padding {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 4px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "default",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "a5a5575c-dac4-7d8a-0422-9a7754f2eab7",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "54cd8c20-b988-d755-8a92-901c3475f24a": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "attribute",
                  "label": "name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7994729585988791
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8471925107896185
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.5649726231213095
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9029752783449481
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\r\nvar majorCount = data[0]['majorAlarmsCount'];\r\n\r\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\r\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\r\nvar type;\r\nvar locationName;\r\nif (data && data.length) {\r\n    locationName = data[0]['locationName'] || 'N/A';\r\n    type = data[0]['Type'];\r\n} else {\r\n    locationName = 'N/A';\r\n    type = 'N/A';\r\n}\r\n\r\nvar header =\r\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"width: 100%; padding-top: 5px;\">' +\r\n    \r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"padding-left: 10px;\">' +\r\n        '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\r\n          '<mat-icon>arrow_back</mat-icon>' +\r\n        '</button>' +\r\n        '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' +\r\n      '</div>' +\r\n\r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\">' +\r\n        '<div id=\"critical-alarms\" class=\"alarm-badge ' + criticalClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + criticalCount + '</span> Critical' +\r\n        '</div>' +\r\n        '<div id=\"major-alarms\" class=\"alarm-badge ' + majorClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + majorCount + '</span> Major' +\r\n        '</div>' +\r\n      '</div>' +\r\n\r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"8px\" style=\"padding-right: 10px;\">' +\r\n        '<button id=\"parameters-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\r\n          '<span>Parameters</span>' +\r\n        '</button>' +\r\n        '<button id=\"details-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\r\n          '<span>Details</span>' +\r\n        '</button>' +\r\n        '<button id=\"sensorData-button\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\r\n            '<mat-icon class=\"tb-mat-18\">sensors</mat-icon>' +\r\n            '<span>Sensor Data</span>' +\r\n          '</button>' +\r\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\r\n          '<span>Projects</span>' +\r\n        '</button>' +\r\n        '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\r\n          '<span>Reports</span>' +\r\n        '</button>' +\r\n      '</div>' +\r\n    '</div>';\r\n\r\nreturn header;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#parameters-button, #sensorData-button, #details-button, #projects-button, #report-button, #reports-button {\n    width: 130px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#parameters-button:hover, #sensorData-button:hover, #details-button:hover, #projects-button:hover, #report-button:hover, #reports-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#parameters-button mat-icon, #sensorData-button mat-icon, #details-button mat-icon, #projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#parameters-button span, #sensorData-button span, #details-button span, #projects-button span, #report-button span, #reports-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "5392aff0-5ef7-11ef-a314-81782f443b0c",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "details-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedKitAvailable || !assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedAssetsAndDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAssignedDevices(doktorkitId, assignedDoktorkitName) {\r\n    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: doktorkitId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Contains\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedDoktorkitName, assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDoktorkitName, assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedDoktorkitName,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedDoktorkitName,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedDoktorkitName !=='No Kit assigned' && assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n\r\n    vm.assignedKitAvailable = assignedDoktorkitName !== 'No Kit assigned!';\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedKit: [{ value: assignedDoktorkitName, disabled: true }, [vm.validators.required]],\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedKitAvailable || !vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "parameters-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <!--<mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>-->\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\n/*function fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}*/\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n/*    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }*/\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes('No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a3dee8ab-4de6-47d0-f54d-daa34853388b"
              },
              {
                "name": "sensorData-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e03cb06f-f0bb-73ef-09c9-8c443eaf3465"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "54cd8c20-b988-d755-8a92-901c3475f24a"
      },
      "9333c78c-4b79-3cb7-6a73-9ff3c7cdfa32": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "attribute",
                  "label": "name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7994729585988791
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8471925107896185
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.5649726231213095
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9029752783449481
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\r\nvar majorCount = data[0]['majorAlarmsCount'];\r\n\r\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\r\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\r\nvar type;\r\nvar locationName;\r\nif (data && data.length) {\r\n    locationName = data[0]['locationName'] || 'N/A';\r\n    type = data[0]['Type'];\r\n} else {\r\n    locationName = 'N/A';\r\n    type = 'N/A';\r\n}\r\n\r\nvar header =\r\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\" style=\"width: 100%; padding-top: 5px;\">' +\r\n    \r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"padding-left: 10px;\">' +\r\n        '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\r\n          '<mat-icon>arrow_back</mat-icon>' +\r\n        '</button>' +\r\n        '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' +\r\n      '</div>' +\r\n\r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\">' +\r\n        '<div id=\"critical-alarms\" class=\"alarm-badge ' + criticalClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + criticalCount + '</span> Critical' +\r\n        '</div>' +\r\n        '<div id=\"major-alarms\" class=\"alarm-badge ' + majorClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + majorCount + '</span> Major' +\r\n        '</div>' +\r\n      '</div>' +\r\n\r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"8px\" style=\"padding-right: 10px;\">' +\r\n        '<button id=\"parameters-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\r\n          '<span>Parameters</span>' +\r\n        '</button>' +\r\n        '<button id=\"details-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\r\n          '<span>Details</span>' +\r\n        '</button>' +\r\n        '<button id=\"sensorData-button\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\r\n            '<mat-icon class=\"tb-mat-18\">sensors</mat-icon>' +\r\n            '<span>Sensor Data</span>' +\r\n          '</button>' +\r\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\r\n          '<span>Projects</span>' +\r\n        '</button>' +\r\n        '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\r\n          '<span>Reports</span>' +\r\n        '</button>' +\r\n      '</div>' +\r\n    '</div>';\r\n\r\nreturn header;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#parameters-button, #sensorData-button, #details-button, #projects-button, #report-button, #reports-button {\n    width: 130px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#parameters-button:hover, #sensorData-button:hover, #details-button:hover, #projects-button:hover, #report-button:hover, #reports-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#parameters-button mat-icon, #sensorData-button mat-icon, #details-button mat-icon, #projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#parameters-button span, #sensorData-button span, #details-button span, #projects-button span, #report-button span, #reports-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "5392aff0-5ef7-11ef-a314-81782f443b0c",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "details-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedKitAvailable || !assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedAssetsAndDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAssignedDevices(doktorkitId, assignedDoktorkitName) {\r\n    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: doktorkitId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Contains\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedDoktorkitName, assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDoktorkitName, assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedDoktorkitName,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedDoktorkitName,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedDoktorkitName !=='No Kit assigned' && assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n\r\n    vm.assignedKitAvailable = assignedDoktorkitName !== 'No Kit assigned!';\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedKit: [{ value: assignedDoktorkitName, disabled: true }, [vm.validators.required]],\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedKitAvailable || !vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "parameters-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <!--<mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>-->\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\n/*function fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}*/\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n/*    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }*/\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes('No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a3dee8ab-4de6-47d0-f54d-daa34853388b"
              },
              {
                "name": "sensorData-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e03cb06f-f0bb-73ef-09c9-8c443eaf3465"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "9333c78c-4b79-3cb7-6a73-9ff3c7cdfa32"
      },
      "5e539fb5-9647-9ddb-baa4-a7b57b0d5cb7": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.2843241633853528
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.269921240377482,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">\r\n  <div fxLayout=\"row\" fxLayoutAlign=\"center center\" style=\"margin-bottom: 20px; padding: 10px; background-color: #ffffff;\">\r\n    <button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\r\n      <mat-icon class=\"tb-mat-18\">map</mat-icon>\r\n      <span>Plan</span>\r\n    </button>\r\n    <button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\r\n      <mat-icon class=\"tb-mat-18\">equalizer</mat-icon>\r\n      <span>Raw Data</span>\r\n    </button>\r\n  </div>\r\n  <div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">\r\n    <div fxLayout=\"row\" fxLayoutAlign=\"end center\"  style=\"flex: 0;\"></div>\r\n    <tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_raw_data\"></tb-dashboard-state>\r\n  </div>\r\n</div>\r\n",
            "markdownTextFunction": "const locationName = data.locationName;\nconst name = data.name;\n\nvar header = '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"start stretch\" fxLayoutGap=\"8px\">' +\n                '<div fxLayout=\"column\" fxLayoutAlign=\"center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\n                '<div fxFlex fxLayout=\"column\" fxLayoutAlign=\"center\">' +\n                   '<div class=\"title\">' + locationName + '</div>' +\n                   '<div class=\"subtitle\">' + name + '</div>' +\n                '</div>';\n\nreturn '<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">' +\n        header + \n        '<tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>' + \n        '<tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>' +\n        '<mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>' +\n        '<div fxFlex=\"30\" fxLayout=\"row\">' +\n            '<div fxFlex=\"60\" fxLayout=\"column\">' +\n                '<h5 style=\"padding-bottom: 15px;\">Filter</h5>' +\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>' +\n            '</div>' +\n            '<mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>' +\n            '<div fxFlex=\"40\" fxLayout=\"column\">' +\n                '<h5 style=\"padding-bottom: 15px;\">State filter</h5>' +\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>' +\n            '</div>' +\n        '</div>' +\n    '</div>';\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n/*.market-layout {\n    position: relative;\n    padding-top: 0; \n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n    margin-top: 0; \n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n    margin-top: -5px; \n}*/\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n.tb-widget-container .tb-widget .leaflet-control-zoom {\n    display: none;\n}\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "plan-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c4006d08-abaf-f82d-9728-55e993339446"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "5e539fb5-9647-9ddb-baa4-a7b57b0d5cb7",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "9a7e456f-6613-ec74-93bc-1c1934b055ee": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.4880248004489329
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.334866663156842
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": "// let mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementAlarms';\r\nlet mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementSignalStrength';\r\n\r\nlet params = ctx.stateController.getStateParams();\r\nlet switchTimeWindow = null;\r\nlet startTimeMs, endTimeMs;\r\n\r\nif (data && data.length) {\r\n    startTimeMs = data[0].startTimeMs || 0;\r\n    endTimeMs = data[0].endTimeMs || 0;\r\n}\r\n\r\nif (startTimeMs !== 0 && endTimeMs !== 0) {\r\n    if (endTimeMs - startTimeMs <= 1209600000) {\r\n        switchTimeWindow = 1;\r\n    } else {\r\n        switchTimeWindow = 2;\r\n    }\r\n}\r\n\r\nvar vm = this;\r\n\r\nvm.onInit = function() {\r\n    \r\n};\r\n\r\nvm.updateMode = function(newMode) {\r\n    let params = vm.ctx.stateController.getStateParams() || {};\r\n    params.targetMode = newMode;\r\n    vm.ctx.stateController.updateState(null, params);\r\n};\r\n\r\nswitch (switchTimeWindow) {\r\n    case 1:\r\n    case 2:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: startTimeMs,\r\n                    endTimeMs: endTimeMs\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n    default:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: Date.now() - 1209600000,\r\n                    endTimeMs: Date.now()\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n}\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, params);\r\n\r\nreturn '' +\r\n'<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n  '<tb-dashboard-state style=\"height: 100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_card_header\"></tb-dashboard-state>' +\r\n  '<tb-dashboard-state style=\"height: 100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_card_details\"></tb-dashboard-state>' +\r\n  '<mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>' +\r\n  '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding: 10px 8px; background-color: #ffffff;\">' +\r\n    \r\n    '<button id=\"alarms-button\" type=\"button\" mat-button color=\"primary\" ' +\r\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\r\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementAlarms\\')\">' +\r\n      '<mat-icon class=\"tb-mat-18\">map</mat-icon>' +\r\n      '<span>Alarms</span>' +\r\n    '</button>' +\r\n    \r\n    '<button id=\"signal-strength-button\" type=\"button\" mat-button color=\"primary\" ' +\r\n      'style=\"flex: 1; text-align: center; background-color: #fafafa;\" ' +\r\n      'ng-click=\"vm.updateMode(\\'selectedMeasurementSignalStrength\\')\">' +\r\n      '<mat-icon class=\"tb-mat-18\">signal_cellular_alt</mat-icon>' +\r\n      '<span>Signal Strength</span>' +\r\n    '</button>' +\r\n  '</div>' +\r\n  \r\n  (mode === 'selectedMeasurementSignalStrength'\r\n    ? '<mat-expansion-panel style=\"margin: 8px; box-shadow: none; background-color: #fafafa;\">' +\r\n        '<mat-expansion-panel-header>' +\r\n          '<mat-panel-title style = \"color: #757575;\">' +\r\n            'Signal Strength Legend' +\r\n          '</mat-panel-title>' +\r\n        '</mat-expansion-panel-header>' +\r\n        '<mat-tab-group>' +\r\n          \r\n          '<mat-tab label=\"RSRP\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= -80</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-80 to -90</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-90 to -100</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -100</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"RSRQ\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= -10</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-10 to -15</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-15 to -20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -20</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"RSSI\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt; -65</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-65 to -75</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Fair</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">-75 to -85</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Poor</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= -85</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n          \r\n          '<mat-tab label=\"SNR\">' +\r\n            '<div style=\"padding: 10px 0;\">' +\r\n              '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                '<tr>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                  '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&gt;= 20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">13 to 20</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">0 to 13</td>' +\r\n                '</tr>' +\r\n                '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                  '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                  '<td style=\"padding: 5px 30px;\">&lt;= 0</td>' +\r\n                '</tr>' +\r\n              '</table>' +\r\n            '</div>' +\r\n          '</mat-tab>' +\r\n        '</mat-tab-group>' +\r\n      '</mat-expansion-panel>'\r\n    : ''\r\n  ) +\r\n  \r\n  (mode === 'selectedMeasurementAlarms'\r\n    ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_alarms\"></tb-dashboard-state>'\r\n    : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"signal_strength\"></tb-dashboard-state>'\r\n  ) +\r\n'</div>';\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow.no-padding {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 4px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "default",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              },
              {
                "name": "alarms-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['targetMode'] = 'selectedMeasurementAlarms'; \nconsole.log(params);\n\nwidgetContext.stateController.updateState('measurement_details', params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "bc77aad9-950d-0e07-2ac4-5b9c1feb696f"
              },
              {
                "name": "signal-strength-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['targetMode'] = 'selectedMeasurementSignalStrength';\nconsole.log(params);\n\nwidgetContext.stateController.updateState('measurement_details', params);\n\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d38d7ab2-d02d-d29d-b95a-051be76a7df3"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "9a7e456f-6613-ec74-93bc-1c1934b055ee",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "910346c6-1cf8-53c5-1aa1-9720fd4fccc5": {
        "typeFullFqn": "system.cards.timeseries_table",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 6.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "CHC_M_Energy_Heating",
                  "type": "timeseries",
                  "label": "Heating Energy",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.5339588626385932,
                  "aggregationType": null,
                  "units": "kWh",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_M_Energy_Cooling",
                  "type": "timeseries",
                  "label": "Cooling Energy",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.8436774960830804,
                  "aggregationType": null,
                  "units": "kWh",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_M_Volume",
                  "type": "timeseries",
                  "label": "Volume",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.93109330976059,
                  "aggregationType": null,
                  "units": "m",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.11415543582573862,
                  "aggregationType": null,
                  "units": "m/hr",
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value/1000;"
                },
                {
                  "name": "CHC_S_TemperatureDiff",
                  "type": "timeseries",
                  "label": "Temperature Difference",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.033769658898941346,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 10000,
              "timewindowMs": 3600000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1737883452714,
                "endTimeMs": 1737969852714
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "showTimestamp": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "enableSearch": true,
            "enableSelectColumnDisplay": true
          },
          "title": "Raw Data Table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "displayTimewindow": true,
          "configMode": "advanced",
          "titleFont": {
            "size": 18,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "titleIcon": null,
          "enableDataExport": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "No data found"
        },
        "row": 0,
        "col": 0,
        "id": "910346c6-1cf8-53c5-1aa1-9720fd4fccc5"
      },
      "58b917d2-5768-b5f9-1e78-e45c9491f4f5": {
        "typeFullFqn": "system.alarm_widgets.alarms_table",
        "type": "alarm",
        "sizeX": 10.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "realtime": {
              "interval": 1000,
              "timewindowMs": 86400000
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "alarmsTitle": "Alarms",
            "enableSelection": true,
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableFilter": true,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "true",
            "displayDetails": true,
            "allowAcknowledgment": true,
            "allowClear": true,
            "allowAssign": true,
            "displayActivity": true,
            "displayPagination": false,
            "defaultPageSize": 10,
            "defaultSortOrder": "-createdTime",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Alarms table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "alarmSource": {
            "type": "entity",
            "name": "",
            "entityAliasId": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
            "dataKeys": [
              {
                "name": "createdTime",
                "type": "alarm",
                "label": "Created time",
                "color": "#2196f3",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.021092237451093787,
                "funcBody": null
              },
              {
                "name": "originator",
                "type": "alarm",
                "label": "Originator",
                "color": "#4caf50",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.2780007688856758,
                "funcBody": null
              },
              {
                "name": "type",
                "type": "alarm",
                "label": "Type",
                "color": "#f44336",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.7323586880398418,
                "funcBody": null
              },
              {
                "name": "severity",
                "type": "alarm",
                "label": "Severity",
                "color": "#ffc107",
                "settings": {
                  "useCellStyleFunction": false,
                  "useCellContentFunction": false
                },
                "_hash": 0.09927019860088193,
                "funcBody": null
              },
              {
                "name": "status",
                "type": "alarm",
                "label": "Status",
                "color": "#607d8b",
                "settings": {
                  "useCellStyleFunction": false,
                  "cellStyleFunction": "",
                  "useCellContentFunction": false,
                  "cellContentFunction": ""
                },
                "_hash": 0.6588418951443418,
                "funcBody": null
              },
              {
                "name": "assignee",
                "type": "alarm",
                "label": "Assignee",
                "color": "#9c27b0",
                "settings": {},
                "_hash": 0.5008441077416634,
                "funcBody": null
              }
            ],
            "alarmFilterConfig": {
              "statusList": [
                "ACTIVE"
              ]
            }
          },
          "alarmsPollingInterval": 5,
          "showTitleIcon": false,
          "titleIcon": "warning",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "widgetStyle": {},
          "displayTimewindow": true,
          "actions": {},
          "configMode": "advanced",
          "alarmFilterConfig": {
            "statusList": [],
            "severityList": [],
            "typeList": [],
            "searchPropagatedAlarms": false,
            "assignedToCurrentUser": false,
            "assigneeId": null
          },
          "datasources": [],
          "titleFont": {
            "size": 24,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "600",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": false,
          "borderRadius": "0px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "58b917d2-5768-b5f9-1e78-e45c9491f4f5"
      },
      "bc5add29-c832-b4b5-6d04-211838ea4b9e": {
        "typeFullFqn": "system.input_widgets.update_server_image_attribute",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "floorplan",
                  "type": "attribute",
                  "label": "floorplan",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8113722299805075
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1737448895533,
                "endTimeMs": 1737535295533
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "widgetTitle": "",
            "showResultMessage": true,
            "displayPreview": true,
            "displayClearButton": true,
            "displayApplyButton": true,
            "displayDiscardButton": true
          },
          "title": "{i18n:custom.diagnostics.measurement-details.manage-floorplan}",
          "dropShadow": true,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "borderRadius": "0px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleFont": {
            "size": 22,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          }
        },
        "row": 0,
        "col": 0,
        "id": "bc5add29-c832-b4b5-6d04-211838ea4b9e"
      },
      "5d53c923-2245-6a3e-fcdd-ce0690d0424d": {
        "typeFullFqn": "system.cards.timeseries_table",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 6.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "430f6413-271a-248e-ea6f-7bfd6fd1f9f6",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "LTE_RSRP",
                  "type": "timeseries",
                  "label": "RSRP",
                  "color": "#2196f3",
                  "settings": {
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "var color = '#fff';\r\nif (value >= -80) {\r\n    color = 'rgba(39, 174, 96, 0.1)';\r\n} else if (value >= -90) {\r\n    color = 'rgba(255, 215, 0, 0.1)';\r\n} else if (value >= -100) {\r\n    color = 'rgba(255, 140, 0, 0.1)';\r\n}else if (value < -100) {\r\n    color = 'rgba(255, 0, 0, 0.1)';\r\n}\r\nreturn {\r\n  backgroundColor: color\r\n};",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.7120484320703409,
                  "units": "dBm",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "LTE_RSRQ",
                  "type": "timeseries",
                  "label": "RSRQ",
                  "color": "#4caf50",
                  "settings": {
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "var color = '#fff';\r\nif (value >= -10) {\r\n    color = 'rgba(39, 174, 96, 0.1)';\r\n} else if (value >= -15) {\r\n    color = 'rgba(255, 215, 0, 0.1)';\r\n} else if (value >= -20) {\r\n    color = 'rgba(255, 140, 0, 0.1)';\r\n}else if (value < -20) {\r\n    color = 'rgba(255, 0, 0, 0.1)';\r\n}\r\nreturn {\r\n  backgroundColor: color\r\n};",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.2508216888061736,
                  "units": "dB",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "LTE_RSSI",
                  "type": "timeseries",
                  "label": "RSSI",
                  "color": "#f44336",
                  "settings": {
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "var color = '#fff';\r\nif (value >= -65) {\r\n    color = 'rgba(39, 174, 96, 0.1)';\r\n} else if (value >= -75) {\r\n    color = 'rgba(255, 215, 0, 0.1)';\r\n} else if (value >= -85) {\r\n    color = 'rgba(255, 140, 0, 0.1)';\r\n}else if (value < -85) {\r\n    color = 'rgba(255, 0, 0, 0.1)';\r\n}\r\nreturn {\r\n  backgroundColor: color\r\n};",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.4997292895156009,
                  "units": "dBm",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "LTE_SN_RATIO",
                  "type": "timeseries",
                  "label": "SN RATIO",
                  "color": "#ffc107",
                  "settings": {
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "var color = '#fff';\r\nif (value >= 20) {\r\n    color = 'rgba(39, 174, 96, 0.1)';\r\n} else if (value >= 13) {\r\n    color = 'rgba(255, 215, 0, 0.1)';\r\n} else if (value >= 0) {\r\n    color = 'rgba(255, 140, 0, 0.1)';\r\n}else if (value < 0) {\r\n    color = 'rgba(255, 0, 0, 0.1)';\r\n}\r\nreturn {\r\n  backgroundColor: color\r\n};",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.6523948574184182,
                  "units": "dB",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 60000,
              "timewindowMs": 1800000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1737455358896,
                "endTimeMs": 1737541758896
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "enableSearch": false,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": false,
            "showCellActionsMenu": false,
            "reserveSpaceForHiddenAction": "true",
            "showTimestamp": true,
            "dateFormat": {
              "format": "yyyy/MM/dd HH:mm:ss",
              "lastUpdateAgo": false,
              "custom": false,
              "auto": false
            },
            "timestampExportOption": "onlyVisible",
            "displayPagination": true,
            "useEntityLabel": false,
            "defaultPageSize": 12,
            "hideEmptyLines": false,
            "disableStickyHeader": false,
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "Signal Strength",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "displayTimewindow": false,
          "configMode": "advanced",
          "titleFont": {
            "size": 22,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "titleIcon": null,
          "enableDataExport": false,
          "titleTooltip": "",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "5d53c923-2245-6a3e-fcdd-ce0690d0424d"
      },
      "a5acf8ea-5bf2-ebfd-0358-f5882accb3f0": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e23ea274-9aa0-8938-2b73-ff48762a93fc",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "${entityLabel}",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.10236620447545342,
                  "aggregationType": null,
                  "units": "C",
                  "decimals": 1,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.temperatures}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {
            "headerButton": []
          },
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "a5acf8ea-5bf2-ebfd-0358-f5882accb3f0"
      },
      "11062bbc-f7e6-bc7a-f406-642666929251": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e23ea274-9aa0-8938-2b73-ff48762a93fc",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "${entityLabel}",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.3489862002865809,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "#FFFFFF",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": "C",
                "decimals": 0,
                "show": true,
                "label": "{i18n:custom.diagnostics.temperature.title}",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": false,
              "showTotal": false,
              "showLatest": true,
              "valueFormat": null
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipHideZeroValues": null,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement.temperatures}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "11062bbc-f7e6-bc7a-f406-642666929251"
      },
      "11d63521-4382-92a5-e1db-85f466d4ebb6": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "attribute",
                  "label": "name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7994729585988791
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8471925107896185
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.5649726231213095
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.9029752783449481
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "var criticalCount = data[0]['criticalAlarmsCount'];\r\nvar majorCount = data[0]['majorAlarmsCount'];\r\n\r\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\r\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\r\nvar type;\r\nvar locationName;\r\nif (data && data.length) {\r\n    locationName = data[0]['locationName'] || 'N/A';\r\n    type = data[0]['Type'];\r\n} else {\r\n    locationName = 'N/A';\r\n    type = 'N/A';\r\n}\r\n\r\nvar header =\r\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\" fxLayoutGap=\"16px\" style=\"height: 100%; width: 100%; padding-top: 3px;\">' +\r\n    \r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"padding-left: 10px;\">' +\r\n        '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\r\n          '<mat-icon>arrow_back</mat-icon>' +\r\n        '</button>' +\r\n        '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' +\r\n      '</div>' +\r\n\r\n      /*'<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\">' +\r\n        '<div id=\"critical-alarms\" class=\"alarm-badge ' + criticalClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + criticalCount + '</span> Critical' +\r\n        '</div>' +\r\n        '<div id=\"major-alarms\" class=\"alarm-badge ' + majorClass + '\">' +\r\n          '<i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>' +\r\n          '<span class=\"alarm-count\">' + majorCount + '</span> Major' +\r\n        '</div>' +\r\n      '</div>' +*/\r\n\r\n      '<div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"8px\" style=\"padding-right: 10px;\">' +\r\n        /*'<button id=\"parameters-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\r\n          '<span>Parameters</span>' +\r\n        '</button>' +\r\n        '<button id=\"details-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\r\n          '<span>Details</span>' +\r\n        '</button>' +*/\r\n        /*'<button id=\"sensorData-button\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\r\n            '<mat-icon class=\"tb-mat-18\">sensors</mat-icon>' +\r\n            '<span>Sensor Data</span>' +\r\n          '</button>' +*/\r\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\r\n          '<span>Projects</span>' +\r\n        '</button>' +\r\n        '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\r\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\r\n          '<span>Reports</span>' +\r\n        '</button>' +\r\n      '</div>' +\r\n    '</div>';\r\n\r\nreturn header;\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n/*.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} */\n\n.header {\n    height: 60px;                    /* Fixed height for medium screens */\n    display: flex;                   /* Use Flexbox for layout */\n    align-items: center;             /* Vertically center content */\n    justify-content: space-between;  /* Space items evenly horizontally */\n    padding: 0 20px;                 /* Horizontal padding only */\n    box-sizing: border-box;          /* Include padding in height */\n}\n\n/* Small screens: up to 600px wide */\n@media (max-width: 600px) {\n    .main-layout .header {\n        height: 50px;   /* Smaller height for small screens */\n        padding: 0 10px; /* Reduced horizontal padding */\n    }\n}\n\n/* Medium screens: 601px to 1024px */\n@media (min-width: 601px) and (max-width: 1024px) {\n    .main-layout .header {\n        height: 60px;    /* Default height */\n        padding: 0 15px; /* Adjust padding if needed */\n    }\n}\n\n/* Large screens: 1025px and above */\n@media (min-width: 1025px) {\n    .main-layout .header {\n        height: 70px;   /* Increased height for larger screens */\n        padding: 0 20px; /* Maintain horizontal padding */\n    }\n}\n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#parameters-button, #sensorData-button, #details-button, #projects-button, #report-button, #reports-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#parameters-button:hover, #sensorData-button:hover, #details-button:hover, #projects-button:hover, #report-button:hover, #reports-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#parameters-button mat-icon, #sensorData-button mat-icon, #details-button mat-icon, #projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#parameters-button span, #sensorData-button span, #details-button span, #projects-button span, #report-button span, #reports-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\r\nvar number = (widgetContext.stateController.getStateIndex())-1;\r\n\r\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\r\nparams['selectedDevice'] = null;\r\nwidgetContext.stateController.updateState(null,params);\r\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "details-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedKitAvailable || !assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedAssetsAndDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAssignedDevices(doktorkitId, assignedDoktorkitName) {\r\n    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: doktorkitId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Contains\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedDoktorkitName, assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDoktorkitName, assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDoktorkitName, assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedDoktorkitName,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedDoktorkitName,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedDoktorkitName !=='No Kit assigned' && assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n\r\n    vm.assignedKitAvailable = assignedDoktorkitName !== 'No Kit assigned!';\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedKit: [{ value: assignedDoktorkitName, disabled: true }, [vm.validators.required]],\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedKitAvailable || !vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "parameters-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <!--<mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>-->\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedPFlowAvailable\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\n/*function fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}*/\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n/*    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }*/\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes('No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a3dee8ab-4de6-47d0-f54d-daa34853388b"
              },
              {
                "name": "sensorData-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e03cb06f-f0bb-73ef-09c9-8c443eaf3465"
              },
              {
                "name": "reports-button TODO",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "openRightLayout": false,
                "setEntityId": true,
                "stateEntityParamName": null,
                "id": "a556210c-b8ae-27a6-cc65-9001b01faa56"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "11d63521-4382-92a5-e1db-85f466d4ebb6"
      },
      "ae26d592-56d5-26b1-f755-3f1511e8572e": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8902879312951573
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1730110460337,
                "endTimeMs": 1730196860337
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var DeviceState;\r\nvar profile;\r\nconsole.log(data);\r\nif (data && data.length && data[0]['entityId']) {\r\n    profile = data[0].deviceType;\r\n    console.log(profile);\r\n    DeviceState = true;\r\n} else {\r\n    DeviceState = false;\r\n}\r\n\r\n// Determine which stateId to use based on the profile\r\nvar stateId;\r\n\r\nif (profile === 'Room Sensor CO2') {\r\n    stateId = 'sensor_charts_co2';\r\n} else if (profile === 'Room Sensor T' || profile === 'Temperature Sensor') {\r\n    stateId = 'sensor_charts_t';\r\n} else {\r\n    stateId = 'sensor_charts_t'; // Default stateId if DeviceState is false\r\n}\r\n\r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n       (DeviceState \r\n         ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"' + stateId + '\"></tb-dashboard-state>' \r\n         : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensor_charts_co2\"></tb-dashboard-state>') +\r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 100px;\n    margin: 6px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.main-layout .tb-mat-20 {\n    width: 1px;\n    height: 2px;\n    margin: 2px;\n}"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "ae26d592-56d5-26b1-f755-3f1511e8572e"
      },
      "61ecec7e-cd3d-1428-867e-0005238a0498": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.3201478718454889
                },
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.6150118691999449
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.597101853000302
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1737992974589,
                "endTimeMs": 1738079374589
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${measurementType}.\n",
            "markdownTextFunction": "var measurementTypeValue;\r\nlet switchTimeWindow = null;\r\nlet startTime, endTime;\r\nvar timeThreshold;\r\nvar deltaTime;\r\n\r\n\r\n\r\nif (data && data.length) {\r\n startTime = data[0].startTimeMs || 'N/A';\r\n endTime = data[0].endTimeMs || 'N/A';\r\n}\r\n\r\n\r\n\r\n/*if (startTime !== 'N/A' && endTime !== 'N/A') {\r\n if (endTime - startTime <= 1209600000) {\r\n switchTimeWindow = 1;\r\n } else {\r\n switchTimeWindow = 2;\r\n }\r\n}*/\r\n\r\n// If your data has the attribute directly on data[0]:\r\n if (data[0].measurementType === 'ultrasonic') {\r\n     measurementTypeValue = 'ultrasonic';\r\n } else if (data[0].measurementType === 'loraWan') {\r\n     measurementTypeValue = 'loraWan';\r\n     }\r\n\r\n// More commonly, if you have timeseries or attribute data stored in data[0].data[0].value:\r\n/*if (data[0].data[0].value === 'ultrasonic') {\r\n    measurementTypeValue = 'ultrasonic';\r\n} else if (data[0].data[0].value === 'loraWan') {\r\n    measurementTypeValue = 'loraWan';\r\n}\r\n*/\r\n\r\n/*switch (switchTimeWindow) {\r\n case 1: \r\n  case 2:\r\n  var newDashboardtimewindow = {\r\n  aggregation: {\r\n  limit: 100000,\r\n  type: \"NONE\"\r\n  },\r\n  hideAggInterval: false,\r\n  hideAggregation: false,\r\n  hideInterval: false,\r\n  history: {\r\n  historyType: 1,\r\n  fixedTimewindow: {\r\n  startTimeMs: startTime,\r\n  endTimeMs: endTime\r\n  }\r\n  },\r\n  selectedTab: 1\r\n  };\r\n  break;\r\n  default:\r\n  var newDashboardtimewindow = {\r\n  aggregation: {\r\n  limit: 100000,\r\n  type: \"NONE\"\r\n  },\r\n  hideAggInterval: false,\r\n  hideAggregation: false,\r\n  hideInterval: false,\r\n  history: {\r\n  historyType: 1,\r\n  fixedTimewindow: {\r\n  startTimeMs: Date.now() - 1209600000,\r\n  endTimeMs: Date.now()\r\n  }\r\n  },\r\n  selectedTab: 1\r\n  };\r\n  break;\r\n}*/\r\n\r\n// finished & aborted\r\nif (startTime !== 'N/A' && endTime !== 'N/A') {\r\n    deltaTime = endTime - startTime;\r\n    timeThreshold = 3024000000; // 35 days\r\n    if (deltaTime <= timeThreshold) { \r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: true,\r\n            hideAggregation: true,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: startTime, // now - 2 weeks\r\n                    endTimeMs: endTime\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n    } else {\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: true,\r\n            hideAggregation: true,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: endTime - timeThreshold, // now - 2 weeks\r\n                    endTimeMs: endTime\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        }; \r\n    }\r\n}\r\n// active\r\n    else if (startTime !== 'N/A' && endTime === 'N/A') {\r\n        timeThreshold = 3024000000; // 35 days\r\n        deltaTime = (Date.now())-startTime;\r\n        if(deltaTime>timeThreshold){\r\n            startTime = startTime+(deltaTime-timeThreshold);\r\n        }\r\n            var newDashboardtimewindow = {\r\n                aggregation: {\r\n                    limit: 100000,\r\n                    type: \"NONE\"\r\n                },\r\n                hideAggInterval: true,\r\n                hideAggregation: true,\r\n                hideInterval: false,\r\n                history: {\r\n                    historyType: 1,\r\n                    fixedTimewindow: {\r\n                        startTimeMs: startTime,\r\n                        endTimeMs: Date.now()\r\n                    }\r\n                },\r\n                selectedTab: 1\r\n        };\r\n    // default\r\n    }\r\nelse {\r\n    var newDashboardtimewindow = {\r\n        aggregation: {\r\n            limit: 100000,\r\n            type: \"NONE\"\r\n        },\r\n        hideAggInterval: true,\r\n        hideAggregation: true,\r\n        hideInterval: false,\r\n        history: {\r\n            historyType: 1,\r\n            fixedTimewindow: {\r\n                startTimeMs: Date.now() - 1209600000, // now - 2 weeks\r\n                endTimeMs: Date.now()\r\n            }\r\n        },\r\n        selectedTab: 1\r\n    };\r\n}\r\n\r\nlet params = ctx.stateController.getStateParams();\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, params);\r\n\r\n\r\n\r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n           (\r\n             measurementTypeValue === 'ultrasonic'\r\n               ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"ultrasonic\" stateId=\"measurement_details_ultrasonic\"></tb-dashboard-state>'\r\n               : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"loraWan\" stateId=\"measurement_details_loraWan\"></tb-dashboard-state>'\r\n           ) +\r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n/*.main-layout .header .title {\n    width: auto;\n    height: 50px;\n    padding-right: 15px; \n    font-size: 18px;\n    font-weight: 500;\n    background-color: #E0E0E0;\n    color: #28232D;\n    display: flex; \n    align-items: center; \n    justify-content: center;\n    gap: 2px;\n    margin-right: 10px;\n    border-radius: 4px;\n}*/\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #reports-button, #data-button, #report-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #reports-button:hover, #data-button:hover, #report-button:hover, #parameter-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #reports-button mat-icon, #data-button mat-icon, #report-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #data-button und #report-button */\n#projects-button span, #reports-button span, #data-button span, #report-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "margin": "0px",
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "61ecec7e-cd3d-1428-867e-0005238a0498"
      },
      "b381d5dc-4a65-04e6-4fb0-54c8d14e4f75": {
        "typeFullFqn": "system.cards.entities_table",
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1730110980841,
                "endTimeMs": 1730197380841
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0",
          "settings": {
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "displayEntityLabel": false,
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false,
            "entitiesTitle": "Entities"
          },
          "title": "Sensors",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "70ff25cd-3d47-b7fc-05e1-765294946bf0",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7573592191483534
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "displayTimewindow": false,
          "configMode": "advanced",
          "actions": {
            "rowClick": [
              {
                "name": "selectedDevice",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_loraWan",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "fa5baf05-0c4c-2092-bebf-ac5fb62d3770"
              }
            ]
          },
          "showTitleIcon": false,
          "titleIcon": "list",
          "iconColor": null,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal"
          },
          "titleColor": null,
          "enableDataExport": false,
          "margin": "0",
          "borderRadius": "8px",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "titleTooltip": ""
        },
        "row": 0,
        "col": 0,
        "id": "b381d5dc-4a65-04e6-4fb0-54c8d14e4f75"
      },
      "9191c815-bbc9-daf4-ed0e-c73b6a48d5b3": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e043f69e-804d-8e1d-062c-7da5becf5b51",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "${entityLabel}",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6204444548947727,
                  "units": "C",
                  "decimals": 0,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.temperature.title}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "9191c815-bbc9-daf4-ed0e-c73b6a48d5b3"
      },
      "2ffda43e-cad2-521c-6871-338d15b3b4cc": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "{i18n:custom.diagnostics.projects.title}",
            "enableSearch": true,
            "enableSelectColumnDisplay": false,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "showCellActionsMenu": true,
            "reserveSpaceForHiddenAction": "false",
            "displayEntityName": true,
            "entityNameColumnTitle": "{i18n:custom.diagnostics.project-id.title}",
            "displayEntityLabel": false,
            "entityLabelColumnTitle": "",
            "displayEntityType": false,
            "displayPagination": false,
            "defaultPageSize": 10,
            "pageStepCount": 3,
            "pageStepIncrement": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false,
            "rowStyleFunction": ""
          },
          "title": "{i18n:custom.diagnostics.projects.title}",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
              "filterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "{i18n:custom.diagnostics.project-name.title}",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.23547368231999988,
                  "decimals": 0,
                  "aggregationType": null,
                  "units": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-address.title}",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.8348661406382081,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": false,
                  "postFuncBody": null
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-progress.title}",
                  "color": "#f44336",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "return utils.getProgressHtml(value);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.15334267783981326,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "generalReport",
                  "type": "attribute",
                  "label": "{i18n:custom.diagnostics.project-report.title}",
                  "color": "#ffc107",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": "var color;\r\nvar description;\r\nvar generalReport = value;\r\nvar status;\r\nif (generalReport == 'true') { // all key values here are strings\r\n  color = '#27AE60';\r\n  status = 'paid';\r\n  description = '{i18n:custom.diagnostics.report-status.paid.title}';\r\n} else {\r\n  color = '#EB5757';\r\n  status = 'inactive';\r\n  description = '{i18n:custom.diagnostics.report-status.inactive.title}';\r\n}\r\nreturn '<span style=\"font-size: 18px; color: ' + color + '\">&#11044;</span>'+ ' ' + description;",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.47896411690699625,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Select Project",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedProject",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a7ad4745-1f21-49fd-38f4-70825fe6875f"
              }
            ],
            "actionCellButton": [
              {
                "name": "Project Wizard",
                "icon": "rocket_launch",
                "useShowWidgetActionFunction": false,
                "showWidgetActionFunction": "return data.progress === 'in preparation' || data.progress === 'active';",
                "type": "customPretty",
                "customHtml": "",
                "customCss": "",
                "customFunction": {
                  "body": "// Use the Project Wizard library with dataImporter for device assignment\nprojectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n    widgetContext.updateAliases();\n}, { dataImporter: dataImporter });\n",
                  "modules": {
                    "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                    "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9848fd08-5b93-6f97-dc69-65e325748065"
              }
            ],
            "headerButton": [
              {
                "name": "Connect",
                "buttonType": "raised",
                "showIcon": true,
                "icon": "addchart",
                "buttonColor": "#ffffff",
                "buttonFillColor": "var(--tb-accent-500)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": {
                  "body": "utils.dataConnectorDialog(widgetContext, entityId, entityName);",
                  "modules": {
                    "utils": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                  }
                },
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3c824487-b796-a41c-5d9e-7eca11e18a04"
              },
              {
                "name": "Project",
                "buttonType": "icon",
                "icon": "add",
                "buttonColor": "rgba(0, 0, 0, 0.87)",
                "customButtonStyle": {},
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"flex items-center\" color=\"primary\">\n    <mat-icon style=\"margin-right: 12px;\">folder_open</mat-icon>\n    <h2 style=\"margin: 0; font-size: 18px;\">Add Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col gap-2 p-4\">\n    <mat-form-field *ngIf=\"isTenantAdmin\" appearance=\"outline\" class=\"w-full\">\n      <mat-label>Customer</mat-label>\n      <mat-select formControlName=\"customer\" (selectionChange)=\"onCustomerChange()\" required>\n        <mat-option *ngFor=\"let c of customers\" [value]=\"c\">{{ c.name }}</mat-option>\n      </mat-select>\n      <mat-error *ngIf=\"addProjectFormGroup.get('customer')?.hasError('required')\">Customer is required.</mat-error>\n    </mat-form-field>\n    <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project ID</mat-label>\n        <input matInput formControlName=\"name\" required readonly>\n        <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">Project title is required.</mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Label</mat-label>\n        <input matInput formControlName=\"entityLabel\">\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n      <mat-label>Project address</mat-label>\n      <input matInput formControlName=\"address\" [matAutocomplete]=\"addrAuto\" autocomplete=\"off\">\n      <button mat-icon-button matSuffix type=\"button\" (click)=\"searchAddress()\" [disabled]=\"(addProjectFormGroup.get('address').value || '').length < 5\">\n        <mat-icon>search</mat-icon>\n      </button>\n      <mat-autocomplete #addrAuto=\"matAutocomplete\" [displayWith]=\"displayAddressOption\" (optionSelected)=\"onAddressSelected($event.option.value)\">\n        <mat-option *ngFor=\"let opt of addressOptions\" [value]=\"opt\">{{ opt.label }}</mat-option>\n      </mat-autocomplete>\n      <mat-hint *ngIf=\"(addProjectFormGroup.get('address').value || '').length < 5\">Enter at least 5 characters to search</mat-hint>\n    </mat-form-field>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Postal Code</mat-label>\n          <input matInput formControlName=\"postalCode\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 2;\">\n          <mat-label>City</mat-label>\n          <input matInput formControlName=\"city\">\n      </mat-form-field>\n    </div>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Latitude</mat-label>\n          <input matInput formControlName=\"latitude\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Longitude</mat-label>\n          <input matInput formControlName=\"longitude\">\n      </mat-form-field>\n    </div>\n  </div>\n  <div class=\"flex justify-end items-center gap-2 p-4\" style=\"border-top: 1px solid #e0e0e0; background: #fafafa;\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>",
                "customCss": "/* apply a half-opaque blue to disabled filled text-fields */\n.add-entity-form .mdc-text-field--filled.mdc-text-field--disabled {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n/* make sure the disabled focus-overlay is tinted the same */\n.add-entity-form .mat-mdc-form-field-disabled .mat-mdc-form-field-focus-overlay {\n  background-color: rgba(244, 249, 254, 0.5) !important;\n}\n\n.add-entity-form\n  .mdc-text-field--filled:not(.mdc-text-field--disabled) {\n  background-color: #F4F9FE !important;\n}\n\n.add-entity-form\n  .mat-mdc-form-field-focus-overlay {\n  background-color: #F4F9FE !important;\n}\n\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*.mat-form-field input[disabled] {\n  background-color: #f5f5f5;\n  cursor: not-allowed; \n  color: #9e9e9e;\n  \n}*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\n//let $scope = widgetContext.$scope;\r\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\r\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\r\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\r\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\r\n\r\nlet shortNameAttr;\r\nlet customerShortName;\r\nlet nextProjectId = 0;\r\n\r\nconst ctx = widgetContext;\r\nconst isTenantAdmin = ctx.currentUser.authority === 'TENANT_ADMIN';\r\n\r\nlet customers = [];\r\nlet customerId;\r\nlet customerName;\r\n\r\nconst pageLink = ctx.pageLink(1000, 0, null, null, null);\r\n\r\ncustomerService.getUserCustomers(pageLink).subscribe(pageData => {\r\n\r\n    customers = (pageData && pageData.data) ? pageData.data : [];\r\n\r\n    // Non-Tenant-Admin  genau ein Customer\r\n    if (!isTenantAdmin && customers.length === 1) {\r\n        const c = customers[0];\r\n        customerId = {\r\n            id: c.id.id,\r\n            entityType: 'CUSTOMER'\r\n        };\r\n        customerName = c.name;\r\n    }\r\n\r\n    openAddProjectDialog();\r\n});\r\n\r\nfunction getLastProjectId(projects) {\r\n    let maxNumber = 0;\r\n    projects.forEach(item => {\r\n        const name = item.name;\r\n        const parts = name.split('_');\r\n        if (parts.length === 2) {\r\n            const number = parseInt(parts[1], 10);\r\n            if (number > maxNumber) {\r\n                maxNumber = number;\r\n            }\r\n        }\r\n    });\r\n    const nextProjectId = maxNumber + 1;\r\n    return nextProjectId;\r\n}\r\n\r\nfunction openAddProjectDialog() {\r\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\r\n}\r\n\r\nfunction AddProjectDialogController(instance) {\r\n  let vm = instance;\r\n\r\n  vm.isTenantAdmin = isTenantAdmin;\r\n  vm.customers = customers;\r\n\r\nvm.addProjectFormGroup = vm.fb.group({\r\n    customer: [{ value: null, disabled: !isTenantAdmin }, vm.validators.required],\r\n    name: [{ value: '', disabled: true }, vm.validators.required],\r\n    entityLabel: [''],\r\n    projectPicture: [null],\r\n    address: [''],\r\n    postalCode: [''],\r\n    city: [''],\r\n    latitude: [''],\r\n    longitude: ['']\r\n});\r\n\r\n  // --- Address search state ---\r\n  vm.addressOptions = [];\r\n  vm._lastSelectedAddressLabel = null;\r\n\r\n  vm.displayAddressOption = function (opt) {\r\n    // MatAutocomplete calls displayWith with object OR string\r\n    if (!opt) return '';\r\n    return (typeof opt === 'string') ? opt : (opt.label || '');\r\n  };\r\n\r\n  vm.searchAddress = function () {\r\n    const qRaw = vm.addProjectFormGroup.get('address').value || '';\r\n    const q = (typeof qRaw === 'string') ? qRaw.trim() : vm.displayAddressOption(qRaw).trim();\r\n\r\n    if (q.length < 5) {\r\n      vm.addressOptions = [];\r\n      return;\r\n    }\r\n\r\n    searchAddressViaPhoton(q);\r\n  };\r\n\r\n  vm.onAddressSelected = function (opt) {\r\n    if (!opt) return;\r\n\r\n    vm._lastSelectedAddressLabel = opt.label;\r\n\r\n    // Patch-Objekt vorbereiten\r\n    const patchData = {\r\n      address: opt.label,\r\n      latitude: opt.lat,\r\n      longitude: opt.lon\r\n    };\r\n\r\n    // Nur postalCode und city setzen, wenn sie im Formular NICHT bereits ausgefllt sind\r\n    const currentPostalCode = (vm.addProjectFormGroup.get('postalCode').value || '').trim();\r\n    const currentCity = (vm.addProjectFormGroup.get('city').value || '').trim();\r\n\r\n    if (!currentPostalCode && opt.postcode) {\r\n      patchData.postalCode = opt.postcode;\r\n    }\r\n    if (!currentCity && opt.city) {\r\n      patchData.city = opt.city;\r\n    }\r\n\r\n    vm.addProjectFormGroup.patchValue(patchData);\r\n\r\n    vm.addProjectFormGroup.get('address').markAsDirty();\r\n    vm.addProjectFormGroup.get('latitude').markAsDirty();\r\n    vm.addProjectFormGroup.get('longitude').markAsDirty();\r\n\r\n    if (!currentPostalCode && opt.postcode) {\r\n      vm.addProjectFormGroup.get('postalCode').markAsDirty();\r\n    }\r\n    if (!currentCity && opt.city) {\r\n      vm.addProjectFormGroup.get('city').markAsDirty();\r\n    }\r\n\r\n    // optional: Ergebnisse leeren, damit Dropdown zugeht\r\n    vm.addressOptions = [];\r\n  };\r\n\r\n  // --- Debounced auto-search without rxjs operators ---\r\n  let addrTimer = null;\r\n  let lastQuery = '';\r\n\r\n  vm.addProjectFormGroup.get('address').valueChanges.subscribe(val => {\r\n    // Wenn eine Auswahl gerade gesetzt wurde, nicht sofort neu suchen\r\n    if (typeof val === 'string' && vm._lastSelectedAddressLabel && val === vm._lastSelectedAddressLabel) {\r\n      return;\r\n    }\r\n\r\n    const s = (typeof val === 'string')\r\n      ? val.trim()\r\n      : (vm.displayAddressOption(val) || '').trim();\r\n\r\n    // Reset results for short strings\r\n    if (s.length < 5) {\r\n      vm.addressOptions = [];\r\n      lastQuery = s;\r\n      if (addrTimer) {\r\n        clearTimeout(addrTimer);\r\n        addrTimer = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Simple distinctUntilChanged\r\n    if (s === lastQuery) {\r\n      return;\r\n    }\r\n    lastQuery = s;\r\n\r\n    // Debounce\r\n    if (addrTimer) {\r\n      clearTimeout(addrTimer);\r\n    }\r\n    addrTimer = setTimeout(() => {\r\n      searchAddressViaPhoton(s);\r\n    }, 350);\r\n  });\r\n\r\n\r\n  function searchAddressViaPhoton(query) {\r\n    // Hole postalCode und city aus dem Formular\r\n    const postalCode = (vm.addProjectFormGroup.get('postalCode').value || '').trim();\r\n    const city = (vm.addProjectFormGroup.get('city').value || '').trim();\r\n\r\n    // Verfeinerte Query erstellen\r\n    let refinedQuery = query;\r\n    if (postalCode) {\r\n      refinedQuery += ' ' + postalCode;\r\n    }\r\n    if (city) {\r\n      refinedQuery += ' ' + city;\r\n    }\r\n\r\n    const url =\r\n      'https://photon.komoot.io/api' +\r\n      '?q=' + encodeURIComponent(refinedQuery) +\r\n      '&limit=5';\r\n\r\n    fetch(url)\r\n      .then(res => {\r\n        if (!res.ok) throw new Error('HTTP ' + res.status);\r\n        return res.json();\r\n      })\r\n      .then(data => {\r\n        const features = (data && data.features) ? data.features : [];\r\n\r\n        vm.addressOptions = features.map(f => {\r\n          const p = f.properties || {};\r\n          const coords = (f.geometry && f.geometry.coordinates) ? f.geometry.coordinates : [null, null];\r\n          const lon = coords[0];\r\n          const lat = coords[1];\r\n\r\n          // Bausteine\r\n          const street = p.street || p.name || '';\r\n          const house = p.housenumber ? (' ' + p.housenumber) : '';\r\n          const place = (street + house).trim() || (p.label || p.name || '').trim();\r\n\r\n          const cc = (p.countrycode || '').toUpperCase();\r\n          const postcode = p.postcode || '';\r\n          const cityFromResult = p.city || p.town || p.village || p.state || '';\r\n\r\n          // Ziel-Format: \"Adresse, CC-PLZ Ort\"\r\n          let tail = '';\r\n          if (cc || postcode || cityFromResult) {\r\n            tail = (cc ? cc : '');\r\n            if (cc && postcode) tail += '-' + postcode;\r\n            else if (!cc && postcode) tail += postcode;\r\n            if ((cc || postcode) && cityFromResult) tail += ' ' + cityFromResult;\r\n            else if (!cc && !postcode && cityFromResult) tail += cityFromResult;\r\n          }\r\n\r\n          const label = tail ? (place + ', ' + tail) : place;\r\n\r\n          return {\r\n            label,\r\n            lat: (typeof lat === 'number') ? lat : parseFloat(lat),\r\n            lon: (typeof lon === 'number') ? lon : parseFloat(lon),\r\n            postcode: postcode,\r\n            city: cityFromResult,\r\n            raw: f\r\n          };\r\n        });\r\n      })\r\n      .catch(err => {\r\n        console.error('Address search failed', err);\r\n        vm.addressOptions = [];\r\n      });\r\n  }\r\n\r\n\r\n  \r\nif (!isTenantAdmin && customerId) {\r\n    vm.addProjectFormGroup.patchValue({\r\n        customer: customers[0]\r\n    });\r\n    vm.addProjectFormGroup.get('customer').markAsDirty();\r\n    loadCustomerData(customerId);\r\n}\r\n\r\n  \r\nvm.onCustomerChange = function () {\r\n    const c = vm.addProjectFormGroup.value.customer;\r\n    if (!c) return;\r\n\r\n    customerId = {\r\n        id: c.id.id,\r\n        entityType: 'CUSTOMER'\r\n    };\r\n    customerName = c.name;\r\n\r\n    loadCustomerData(customerId);\r\n};\r\n\r\n  \r\n  vm.cancel = function () {\r\n    vm.dialogRef.close(null);\r\n  };\r\n  \r\n  vm.save = function () {\r\n    vm.addProjectFormGroup.markAsPristine();\r\n    saveProjectObservable(customerId).subscribe(\r\n      function (Project) {\r\n          widgetContext.rxjs.forkJoin([\r\n              saveCustomerToProjectRelation(customerId, Project.id),\r\n              saveAttributes(Project.id)\r\n          ]).subscribe(\r\n              function () {\r\n                var params = widgetContext.stateController.getStateParams();\r\n                var selectedProject = params['selectedProject'];\r\n                params['selectedProject'] = { entityId: Project.id, entityName: Project.name, entityLabel: '' };\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n              }\r\n        );\r\n      }\r\n    );\r\n  };\r\n  \r\nfunction loadCustomerData(customerId) {\r\n\r\n    let assetSearchQuery = {\r\n        parameters: {\r\n            rootId: customerId.id,\r\n            rootType: 'CUSTOMER',\r\n            direction: 'FROM',\r\n            relationTypeGroup: 'COMMON',\r\n            maxLevel: 10,\r\n            fetchLastLevelOnly: false\r\n        },\r\n        relationType: 'Owns',\r\n        assetTypes: ['Project']\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(projects => {\r\n\r\n        nextProjectId = getLastProjectId(projects);\r\n\r\n        attributeService\r\n            .getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName'])\r\n            .subscribe(attributes => {\r\n\r\n                const shortNameAttr = attributes.find(a => a.key === 'shortName');\r\n                customerShortName = shortNameAttr\r\n                    ? shortNameAttr.value\r\n                    : customerName;\r\n\r\n                vm.addProjectFormGroup.patchValue({\r\n                    name: customerShortName + '_' + nextProjectId\r\n                });\r\n\r\n                vm.addProjectFormGroup.get('name').markAsDirty();\r\n            });\r\n    });\r\n}\r\n\r\n  function saveProjectObservable(customerId) {\r\n    return getProjectsGroup(customerId).pipe(\r\n        widgetContext.rxjs.switchMap((ProjectsGroup) => {\r\n            const formValues = vm.addProjectFormGroup.getRawValue();\r\n            let Project = {\r\n              name: formValues.name,\r\n              type: 'Project',\r\n              label: formValues.entityLabel,\r\n              customerId: customerId\r\n            };\r\n            return assetService.saveAsset(Project, ProjectsGroup.id.id)\r\n        })\r\n    );\r\n  }\r\n  \r\n  function getProjectsGroup(customerId) {\r\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\r\n          widgetContext.rxjs.switchMap((entityGroups) => {\r\n              var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\r\n              if (ProjectsGroup) {\r\n                  return widgetContext.rxjs.of(ProjectsGroup);\r\n              } else {\r\n                  ProjectsGroup = {\r\n                      type: 'ASSET',\r\n                      name: 'Projects',\r\n                      ownerId: customerId\r\n                  };\r\n                  return entityGroupService.saveEntityGroup(ProjectsGroup);\r\n              }\r\n          })\r\n      );\r\n  }\r\n\r\n  function saveCustomerToProjectRelation(customerId, ProjectId) {\r\n      var relation = {\r\n          from: customerId,\r\n          to: ProjectId,\r\n          typeGroup: 'COMMON',\r\n          type: 'Owns'\r\n      };\r\n      return entityRelationService.saveRelation(relation);\r\n  }\r\n  \r\n  function saveAttributes(entityId) {\r\n    let attributesArray = [\r\n        {\r\n            key: 'latitude',\r\n            value: vm.addProjectFormGroup.value.latitude || 48.1406022\r\n        },\r\n        {\r\n            key: 'longitude',\r\n            value: vm.addProjectFormGroup.value.longitude || 16.2932688\r\n        },\r\n        {\r\n            key: 'address',\r\n            value: vm.addProjectFormGroup.value.address\r\n        },        \r\n        {\r\n            key: 'progress',\r\n            value: 'in preparation'\r\n        },\r\n        {\n            key: 'units',\n            value: 'metric'\n        }\n    ];\n    // Add projectPicture if provided\n    if (vm.addProjectFormGroup.value.projectPicture) {\n        attributesArray.push({\n            key: 'projectPicture',\n            value: vm.addProjectFormGroup.value.projectPicture\n        });\n    }\r\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\r\n  }\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2c6e09e8-98b9-f1ca-0a64-7cce095767a2"
              }
            ],
            "rowDoubleClick": []
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "pageSize": 1024,
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "titleIcon": null,
          "iconColor": null,
          "borderRadius": "0px"
        },
        "row": 0,
        "col": 0,
        "id": "2ffda43e-cad2-521c-6871-338d15b3b4cc",
        "typeFullFqn": "system.cards.entities_table"
      },
      "c34e7990-7ac7-ffb3-53a5-813b423bcba6": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e043f69e-804d-8e1d-062c-7da5becf5b51",
              "dataKeys": [
                {
                  "name": "humidity",
                  "type": "timeseries",
                  "label": "${entityLabel}",
                  "color": "#048AD3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.5867083151051704,
                  "aggregationType": null,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.humidity.title}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "c34e7990-7ac7-ffb3-53a5-813b423bcba6"
      },
      "d41b3d58-d35d-7b1c-a192-04278ec02f88": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "e043f69e-804d-8e1d-062c-7da5becf5b51",
              "dataKeys": [
                {
                  "name": "vdd",
                  "type": "timeseries",
                  "label": "${entityLabel}",
                  "color": "#048AD3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "enablePointLabelBackground": false,
                      "pointLabelBackground": "rgba(255,255,255,0.56)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "enableLabelBackground": false,
                      "labelBackground": "rgba(255,255,255,0.56)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "comparisonSettings": {
                      "showValuesForComparison": false,
                      "comparisonValuesLabel": "",
                      "color": ""
                    }
                  },
                  "_hash": 0.6857402132492207,
                  "aggregationType": null,
                  "units": "%",
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return ((value-2700)/10);"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "interval": 1000
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": true,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "yAxes": {
              "default": {
                "units": null,
                "decimals": 0,
                "show": true,
                "label": "",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "thresholds": [],
            "dataZoom": true,
            "stack": false,
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "showLegend": true,
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipValueFormatter": null,
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "12px"
          },
          "title": "{i18n:custom.diagnostics.measurement-details.battery-level}",
          "dropShadow": false,
          "enableFullscreen": true,
          "titleStyle": null,
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "d41b3d58-d35d-7b1c-a192-04278ec02f88"
      },
      "b9d5f40b-23fd-c0b3-f832-470963eecfab": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a1259275-97cf-904a-15a9-9e107522eb5f",
              "filterId": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
              "dataKeys": [
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.07057010303477718
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8768256363159095
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7481769686268884
                },
                {
                  "name": "xPos",
                  "type": "attribute",
                  "label": "xPos",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.1947251343876919
                },
                {
                  "name": "yPos",
                  "type": "attribute",
                  "label": "yPos",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.8911555639185675
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8300505638957978
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#0091ea",
                  "settings": {},
                  "_hash": 0.32082557959927205
                },
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "temperature",
                  "color": "#512da8",
                  "settings": {},
                  "_hash": 0.24680864685323223,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "5d6907db-bad0-623f-389a-47e7ee2981b0",
              "filterId": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
              "dataKeys": [
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.7876756601471564,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#afb42b",
                  "settings": {},
                  "_hash": 0.8133480088844827,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#00796b",
                  "settings": {},
                  "_hash": 0.4937093092511089,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "xPos",
                  "type": "attribute",
                  "label": "xPos",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.18823677296060626,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "yPos",
                  "type": "attribute",
                  "label": "yPos",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.6309039008437192,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#2962ff",
                  "settings": {},
                  "_hash": 0.3746151295694715,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#ff6d00",
                  "settings": {},
                  "_hash": 0.023710096563531735,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "co2",
                  "type": "timeseries",
                  "label": "co2",
                  "color": "#512da8",
                  "settings": {},
                  "_hash": 0.4460309311574986
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "selectedDevice",
                  "color": "#c51162",
                  "settings": {},
                  "_hash": 0.7145163667848988,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value === 'true' || value === 'false') {\n    return true;\n} else {\n    return false;\n}"
                }
              ]
            },
            {
              "type": "entity",
              "entityAliasId": "b41759e3-cb61-1aaf-8b24-856e5f5a3889",
              "filterId": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
              "dataKeys": [
                {
                  "name": "xPos",
                  "type": "attribute",
                  "label": "xPos",
                  "color": "#689f38",
                  "settings": {},
                  "_hash": 0.11251144843157146,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "yPos",
                  "type": "attribute",
                  "label": "yPos",
                  "color": "#303f9f",
                  "settings": {},
                  "_hash": 0.76013730882728,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#fbc02d",
                  "settings": {},
                  "_hash": 0.42670180691148096,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#0288d1",
                  "settings": {},
                  "_hash": 0.8298562942134391,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#c2185b",
                  "settings": {},
                  "_hash": 0.6222873037249923,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#f57c00",
                  "settings": {},
                  "_hash": 0.45753130895487804,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "volumeFlow",
                  "color": "#512da8",
                  "settings": {},
                  "_hash": 0.19307298224311076,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": 3,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "image-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "OpenStreetMap.Mapnik",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": true,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "Selected Measurement",
            "imageUrlAttribute": "floorplan",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": null,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": true,
            "disableDoubleClickZooming": true,
            "disableZoomControl": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0,
            "markerOffsetY": 0.5,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": false,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "<div style=\"position: relative; white-space: nowrap; text-align: center; font-size: 12px; top: -5px;\"><span style=\"margin-left: -500%;\"></span><span style=\"border-radius: 10px; color: #fff; background-color: #666; padding-left: 5px; padding-right: 5px; padding-top: 3px; padding-bottom: 3px;\">${entityLabel}</span><span style=\"margin-right: -500%;\"></span></div>",
            "labelFunction": null,
            "showTooltip": true,
            "showTooltipAction": "hover",
            "autocloseTooltip": true,
            "useTooltipFunction": true,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}",
            "tooltipFunction": "var content = '<div style=\"font-family: Roboto;\">' +\r\n                 '<div style=\"font-size: 18px; font-weight: 500; padding-bottom: 8px;\">${entityLabel}</div>';\r\n                 \r\nvar deviceType = data['Type'];\r\nif (typeof deviceType !== undefined) {\r\n    content += '<div style=\"font-size: 13px; font-weight: normal;\">' + getInfoByDeviceType(deviceType) + '</div>';\r\n}\r\ncontent += '</div>';\r\nreturn content;\r\n\r\nfunction getInfoByDeviceType(type) {\r\n    switch (type) {\r\n        case 'P-Flow D116':    \r\n            return 'Volume Flow: ${volumeFlow:0} l/hr';\r\n        case 'Room Sensor T':\r\n            return 'Temperature: ${temperature:1}%';\r\n        case 'Room Sensor CO2':\r\n            return 'CO2 Level: ${co2:0}%';\r\n        case 'Door Sensor':\r\n            var open = data['open'] === 'true';\r\n            return 'State: ' + (open ? 'Open' : 'Closed');\r\n        case 'Motion Sensor':\r\n            var movement = data['movement'] === 'true';\r\n            return 'Movement detection: ' + (movement ? 'Detected' : 'None');\r\n        case 'Occupancy Sensor':\r\n            var occupied = data['occupied'] === 'true';\r\n            return 'State: ' + (occupied ? 'Occupied' : 'Vacant');\r\n        default:\r\n            return 'TODO';\r\n    }\r\n}\r\n",
            "tooltipOffsetX": 0.5,
            "tooltipOffsetY": -0.5,
            "color": "#FE7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var type = data['Type'];\nvar active = data['active'];\nvar state = data['state'];\nvar selectedDevice = data['selectedDevice'] === true;\nvar selectedMode = dsData.filter(function (data) { return data['selectedDevice'] === true; }).length > 0;\n\nvar status = state;\nif (active === 'false') {\n    status = 'disconnected';\n}\n\nvar text = getDeviceText(type, status);\n\nvar defaultMarkerWidth = 30;\n\nvar width = defaultMarkerWidth + getTextWidth(text);\n\nvar svgStr = getDeviceSvg(type, status, width, text, selectedDevice);\n\nvar encodedSvg = encodeURIComponent(svgStr);\n\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\n\n\n\nif (selectedDevice) {\n    width += 8;\n    defaultMarkerWidth += 8;\n}\n\nreturn {\n    url: svgUrl,\n    size: width,\n    markerOffset: [defaultMarkerWidth / 2, defaultMarkerWidth / 2],\n    tooltipOffset: [width * 0.5 - defaultMarkerWidth / 2, - (defaultMarkerWidth / 2)]\n};\n\n\n\nfunction getDeviceSvg(type, status, width, text, isSelected) {\n    var shape = getDeviceShape(type);\n    var color = getBackgroundColor(type, status);\n    var background = getDeviceBackground(color, width);\n    var svgWidth = isSelected ? (width + 8) : width;\n    var svgHeight = isSelected ? 38 : 30;\n    \n    var opacity = selectedMode && !selectedDevice ? 0.4 : 1;\n    \n    var deviceSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgWidth + '\" height=\"' + svgHeight + '\" viewBox=\"0 0 ' + svgWidth + ' ' + svgHeight + '\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                    wrapIfSelected(background + shape, isSelected);\n    if (status === 'disconnected') {\n        deviceSvg += wrapIfSelected('<path d=\"M6.92896 21.728L21.0711 7.58589L22.4853 9.00011L8.34317 23.1422L6.92896 21.728Z\" fill=\"' + color + '\"/>' +\n                     '<path d=\"M7.10692 21.3171C6.81393 21.0241 6.81393 20.5491 7.10692 20.2561L20.1852 7.17788C20.4781 6.88489 20.9532 6.88489 21.2462 7.17788V7.17788C21.5392 7.47088 21.5392 7.94591 21.2462 8.2389L8.16794 21.3171C7.87495 21.6101 7.39991 21.6101 7.10692 21.3171V21.3171Z\" fill=\"white\"/>', isSelected);\n    }\n    if (text !== '') {\n        var transform = isSelected ? '34 10' : '30 6';\n        deviceSvg += '<text transform=\"translate(' + transform + ')\" fill=\"white\" xml:space=\"preserve\" style=\"white-space: pre\" font-family=\"Roboto\" font-size=\"15.4\" font-weight=\"500\" letter-spacing=\"0em\"><tspan x=\"0.10664\" y=\"14.2637\">' + text + '</tspan></text>';\n    }\n    if (selectedDevice) {\n        deviceSvg += getDeviceSelectionStroke(width);\n    }\n    deviceSvg += '</svg>';\n    return deviceSvg;    \n}\n\nfunction wrapIfSelected(svg, isSelected) {\n    if (isSelected) {\n        return '<g transform=\"translate(4 4)\">' + svg + '</g>';\n    } else {\n        return svg;\n    }\n}\n\nfunction getDeviceBackground(color, width) {\n     if (width === 30) {\n         return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>';\n     } else {\n         return '<circle cx=\"15\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>' + \n                '<circle cx=\"' + (width - 15) + '\" cy=\"15\" r=\"15\" fill=\"'+ color +'\"/>' +\n                '<rect x=\"15\" y=\"0\" width=\"' + (width - 30) + '\" height=\"30\" rx=\"1\" fill=\"'+ color +'\"/>';\n     }\n}\n\nfunction getDeviceSelectionStroke(width) {\n     if (width === 30) {\n         return '<circle cx=\"19\" cy=\"19\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n     } else {\n         var rectWidth = width + 6;\n         return '<rect x=\"1\" y=\"1\" width=\"' + rectWidth + '\" height=\"36\" rx=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\n     }\n}\n\nfunction getBackgroundColor(type, status) {\n    switch(status) {\n        case 'major':\n            return '#D5C21B';\n        case 'critical':   \n            return '#E64A19';\n        case 'disconnected':\n            return '#CAC1D2';\n        case 'normal':\n        default:    \n            switch(type) {\n                case 'Room Sensor T':\n                    return '#4A8AEC';\n                case 'Room Sensor CO2':\n                    return '#4A8AEC';\n                default:\n                    return '#1F8B4D';\n            }\n            break;\n    }\n}\n\nfunction getTextWidth(text) {\n    var width = 0;\n    for (var i = 0; i < text.length; i++) {\n        var charWidth;\n        var character = text.charAt(i);\n        if (character === ' ') {\n            charWidth = 8;\n        } else if (character === '-') {\n            charWidth = 7;\n        } else if (character === '') {\n            charWidth = 5;\n        } else if (!isNaN(character * 1)){\n            charWidth = 9;\n        } else {\n            // Upper case\n            if (character === character.toUpperCase()) {\n                charWidth = 12;\n            // Lower case    \n            } else {\n                charWidth = 10;\n            }\n        }\n        width += charWidth;\n    }\n    return width;\n}\n\nfunction getDeviceText(type, status) {\n    switch(status) {\n        case 'disconnected':\n            return 'NO CONN';\n        case 'normal':\n        default:    \n            switch(type) {\n                case 'Temperature Sensor':\n                    var temperature = Number(data['temperature']);\n                    return 'T: ' + temperature.toFixed(1) + ' C';\n                case 'Room Sensor CO2':\n                    var co2 = Number(data['co2']);\n                    return 'CO2: ' + co2.toFixed(1) + ' ppm';\n                case 'P-Flow D116':\n                    var vFlow = Number(data['volumeFlow']);\n                    return 'Flow: ' + vFlow.toFixed(3)  + ' L/hr';\n                default:\n                    return '';\n            }\n            break;        \n    }\n}\n\nfunction getDeviceShape(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Temperature Sensor':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Room Sensor CO2':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M440-360q-17 0-28.5-11.5T400-400v-160q0-17 11.5-28.5T440-600h120q17 0 28.5 11.5T600-560v160q0 17-11.5 28.5T560-360H440Zm20-60h80v-120h-80v120Zm-300 60q-17 0-28.5-11.5T120-400v-160q0-17 11.5-28.5T160-600h120q17 0 28.5 11.5T320-560v40h-60v-20h-80v120h80v-20h60v40q0 17-11.5 28.5T280-360H160Zm520 120v-100q0-17 11.5-28.5T720-380h80v-40H680v-60h140q17 0 28.5 11.5T860-440v60q0 17-11.5 28.5T820-340h-80v40h120v60H680Z\" fill=\"white\"/>';\n        case 'Door Sensor':\n            return '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M19 9H11V21H19V9ZM13 17C13.5523 17 14 16.5523 14 16C14 15.4477 13.5523 15 13 15C12.4477 15 12 15.4477 12 16C12 16.5523 12.4477 17 13 17Z\" fill=\"white\"/>' +\n                   '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M21 22V8C21 7.44772 20.5523 7 20 7H10C9.44772 7 9 7.44772 9 8V22H8.5C8.22386 22 8 22.2239 8 22.5C8 22.7761 8.22386 23 8.5 23H21.5C21.7761 23 22 22.7761 22 22.5C22 22.2239 21.7761 22 21.5 22H21ZM20 8H10L10 22H20V8Z\" fill=\"white\"/>';\n        case 'Motion Sensor':\n            return '<path d=\"M7.5 10C7.22386 10 7 10.2239 7 10.5C7 10.7761 7.22386 11 7.5 11H9C9 11.5523 9.44772 12 10 12H20C20.5523 12 21 11.5523 21 11H22.5C22.7761 11 23 10.7761 23 10.5C23 10.2239 22.7761 10 22.5 10H7.5Z\" fill=\"white\"/>' +\n                   '<path d=\"M17.0001 17C17.5524 17 18.0001 16.5523 18.0001 16C18.0001 15.4477 17.5524 15 17.0001 15C16.4478 15 16.0001 15.4477 16.0001 16C16.0001 16.5523 16.4478 17 17.0001 17Z\" fill=\"white\"/>' +\n                   '<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15.0001 21C19.0804 21 22.4472 17.9453 22.9384 13.998C23.0066 13.45 22.5524 13 22.0001 13H8.00009C7.4478 13 6.99353 13.45 7.06173 13.998C7.55295 17.9453 10.9198 21 15.0001 21ZM17.0001 18C18.1047 18 19.0001 17.1046 19.0001 16C19.0001 14.8954 18.1047 14 17.0001 14C15.8955 14 15.0001 14.8954 15.0001 16C15.0001 17.1046 15.8955 18 17.0001 18Z\" fill=\"white\"/>';\n        case 'Occupancy Sensor':\n            return '<path d=\"M12 8.5C12 9.32843 11.3284 10 10.5 10C9.67157 10 9 9.32843 9 8.5C9 7.67157 9.67157 7 10.5 7C11.3284 7 12 7.67157 12 8.5Z\" fill=\"white\"/>' +\n                   '<path d=\"M10 22L10 19H11L11 22C11 22.5523 11.4477 23 12 23C12.5523 23 13 22.5523 13 22V17C13.5523 17 14 16.5523 14 16V12.8865C14 11.8446 13.1554 11 12.1135 11C12.0947 11 12.076 11.0005 12.0574 11.0016C12.0384 11.0005 12.0193 11 12 11L9 11C8.98072 11 8.96157 11.0005 8.94255 11.0016C8.92403 11.0005 8.90535 11 8.88652 11C7.84462 11 7 11.8446 7 12.8865V16C7 16.5523 7.44772 17 8 17V22C8 22.5523 8.44772 23 9 23C9.55229 23 10 22.5523 10 22Z\" fill=\"white\"/>' +\n                   '<path d=\"M21 23C20.4477 23 20 22.5523 20 22V19H19V22C19 22.5523 18.5523 23 18 23C17.4477 23 17 22.5523 17 22V19H15.7215C15.3724 19 15.1308 18.6513 15.2533 18.3244L17.4733 12.4045C17.7901 11.5597 18.5977 11 19.5 11C20.4023 11 21.2099 11.5597 21.5267 12.4045L23.7467 18.3244C23.8692 18.6513 23.6276 19 23.2785 19H22V22C22 22.5523 21.5523 23 21 23Z\" fill=\"white\"/>' +\n                   '<path d=\"M19.5 10C20.3284 10 21 9.32843 21 8.5C21 7.67157 20.3284 7 19.5 7C18.6716 7 18 7.67157 18 8.5C18 9.32843 18.6716 10 19.5 10Z\" fill=\"white\"/>';\n        default:\n            return '';\n    }\n}\n",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null
          },
          "title": "Doktorkit plan",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Select device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nvar selectedDevice = params['selectedDevice'];\nif (selectedDevice && selectedDevice.entityId.id === entityId.id) {\n    params['selectedDevice'] = null;\n} else {\n    params['selectedDevice'] = { entityId: entityId };\n}\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "c33ff837-63f4-df99-87f2-f2f409b5c997"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "noDataDisplayMessage": "",
          "widgetCss": ".leaflet-popup-content-wrapper, .leaflet-popup-tip {\n    background: #fff;\n    color: #333;\n    box-shadow: 0px 7px 14px rgba(40, 35, 45, 0.21);\n}\n\n.leaflet-popup-content-wrapper {\n    padding: 1px;\n    text-align: left;\n    border-radius: 4px;\n}\n\n.leaflet-container a.leaflet-popup-close-button {\n    padding: 8px 8px 0 0;\n}\n\n.leaflet-popup-content {\n    margin: 12px 25px 12px 16px;\n}\n\n.leaflet-popup-tip {\n    width: 14px;\n    height: 14px;\n}\n",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "b9d5f40b-23fd-c0b3-f832-470963eecfab",
        "typeFullFqn": "system.maps_v2.image_map"
      },
      "b84de4e1-8a84-b5cc-6b10-19292fefbb45": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8057369620518648
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.49953012506084726
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.21088975870489435
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5157976480659352
                },
                {
                  "name": "batteryLevel",
                  "type": "timeseries",
                  "label": "batteryLevel",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.1659349558331873
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.20684451568213258,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.5554495301365088
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.821480189837247
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.31692184501390863
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.14141450952611212
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": {
              "body": "var name, label, type, state, active, progress, locationName, installationType, installation, measurementType, address;\nif (data && data.length) {\n    name = data[0]['entityName'];\n    label = data[0]['Label'];\n    locationName = data[0]['locationName'];\n    installationType = data[0]['installationType'];\n    type = data[0]['Type'];\n    state = data[0]['state'];\n    active = data[0]['active'];\n    progress = data[0]['progress'];\n    measurementType = data[0]['measurementType'];\n    address = data[0]['address'];\n    if (active === 'false') {\n        state = 'disconnected';\n    }\n} else {\n    name = 'N/A';\n    label = 'N/A';\n    type = 'N/A';\n    state = 'N/A';\n    progress = 'N/A';\n    locationName = 'N/A';\n    installationType = 'N/A';\n    active = 'N/A';\n    measurementType ='N/A';\n}\n\n/*if (installationType === 'heating') {\n    installation = '<mat-icon>local_fire_department</mat-icon>Heating';\n} else if (installationType === 'cooling') {\n    installation = '<mat-icon>ac_unit</mat-icon>Cooling';\n} else {\n    installation = '<mat-icon>question_mark</mat-icon>N/A';\n}*/\n\nif (installationType === 'heating') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: red;\">local_fire_department</mat-icon><span style=\"margin-left: 8px;\">Heating</span></div>';\n} else if (installationType === 'cooling') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: blue;\">ac_unit</mat-icon><span style=\"margin-left: 8px;\">Cooling</span></div>';\n} else {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon>question_mark</mat-icon><span style=\"margin-left: 8px;\">N/A</span></div>';\n}\n\nvar header = '<div class=\"header flex flex-row justify-start items-stretch gap-2\">' +\n                // Zurck-Button\n                /*'<div class=\"flex flex-col justify-center items-center\">' +\n                  '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\n                    '<mat-icon>arrow_back</mat-icon>' +\n                  '</button>' +\n                '</div>' +\n                // Titel und Untertitel\n                '<div class=\"flex-1 flex flex-col justify-center items-center\">' +\n                  '<div class=\"title\">' + locationName + '</div>' +\n                  '<div class=\"subtitle\">' + name + '</div>' +\n                '</div>' +*/\n                // Container fr die beiden Buttons\n                '<div class=\"flex flex-row justify-center items-center gap-2\">' +\n                  // Parameter-Button\n                  '<button id=\"measurement-parameters\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n                    '<span>Parameters</span>' +\n                  '</button>' +\n                  // Sensors-Button\n                  '<button id=\"sensor-data\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">sensors</mat-icon>' +\n                    '<span>Sensor Data</span>' +\n                  '</button>' +\n                  // Details-Button\n                  '<button id=\"details-full\" data-device-type=\"' + encodeURIComponent(type) + '\" type=\"button\" mat-button color=\"primary\">' +\n                    '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\n                    '<span>Details</span>' +\n                  '</button>' +\n                '</div>' +\n             '</div>';\n\n\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">'\n  /* +    header + */\n  +   '<div class=\"params flex flex-row gap-2\">'\n  +     '<div class=\"param-cell flex-1 flex flex-col gap-2\">'\n  +       '<div class=\"param-title\">{i18n:custom.diagnostics.project-name.title}</div>'\n  +       '<div class=\"param\">' + label + '</div>'\n  +     '</div>'\n  +     '<div class=\"param-cell flex-1 flex flex-col gap-2\">'\n  +       '<div class=\"param-title\">{i18n:custom.diagnostics.project-address.title}</div>'\n  +       '<div class=\"param\">' + address + '</div>'\n  +     '</div>'\n  +     '<div class=\"param-cell flex-1 flex flex-col gap-2\">'\n  +       '<div class=\"param-title\">{i18n:custom.diagnostics.project-progress.title}</div>'\n  +       '<div class=\"param\">' + utils.getProgressHtml(progress) + '</div>'\n  +     '</div>'\n  +   '</div>'\n  + '</div>';\n",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js",
                "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".main-layout .header {\n    height: 60px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 0 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "5392aff0-5ef7-11ef-a314-81782f443b0c",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "37e5e007-da10-e64c-be1e-899094481e42"
              },
              {
                "name": "settings",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#settings', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getSettingsState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '400px', getSettingsHeight(type));\n\nfunction getSettingsState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_settings';\n        case 'Room Sensor T':            \n            return 'roomsensort_settings';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_settings';                      \n        case 'Door Sensor':\n            return 'door_settings';\n        case 'Motion Sensor':\n            return 'motion_sensor_settings';\n        case 'Occupancy Sensor':\n            return 'occupancy_sensor_settings';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getSettingsHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '800px';\n        case 'Room Sensor T':            \n            return '600px';\n        case 'Room Sensor CO2':            \n            return '800px';                  \n        case 'Door Sensor':\n            return '500px';\n        case 'Motion Sensor':\n            return '340px';\n        case 'Occupancy Sensor':\n            return '500px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "076da598-f2dc-6fda-6744-db268a4c6df7"
              },
              {
                "name": "battery-level",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "battery_level_details",
                "setEntityId": true,
                "stateEntityParamName": "selectedDevice",
                "openRightLayout": false,
                "popoverPreferredPlacement": "bottomRight",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "500px",
                "popoverHeight": "300px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "44417062-4a4f-0479-0042-93952e15436a"
              },
              {
                "name": "details-full",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1532b4d5-2d3c-872e-57ed-d477f9b2e502"
              },
              {
                "name": "details-day",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#details-day', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr('data-device-type'));\n\nvar stateId = getDeviceState(type);\n\nvar params = {\n    selectedDevice: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedDevice'\n};\n\nwidgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n\nfunction getDeviceState(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return 'pflow_details_full';\n        case 'Room Sensor T':            \n            return 'roomsensort_details_full';\n        case 'Room Sensor CO2':            \n            return 'roomsensorco2_details_full';                      \n        case 'Door Sensor':\n            return 'door_details_full';\n        case 'Motion Sensor':\n            return 'motion_details_full';\n        case 'Occupancy Sensor':\n            return 'occupancy_details_fulls';\n        default:\n            return 'unknown_settings';\n    }\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':            \n            return '1000px';\n        case 'Room Sensor CO2':            \n            return '1000px';                  \n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1831fd41-86a5-53ac-1e1b-ab4f23f60807"
              },
              {
                "name": "measurement-parameters",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "modules": {
                  "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                },
                "customFunction": "const measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\n\nif (!measurementId || !measurementId.id) {\n    console.error('No measurement selected');\n    return;\n}\n\nprojectWizard.openMeasurementParametersDialog(widgetContext, measurementId);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "a066a7c4-4bbb-d780-315e-af760f5b1e4e"
              },
              {
                "name": "sensor-data",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "sensor_data",
                "setEntityId": true,
                "stateEntityParamName": "selectedMeasurement",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "301c8f82-5367-e4eb-a578-ca81965b5e9a"
              }
            ],
            "headerButton": []
          },
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "b84de4e1-8a84-b5cc-6b10-19292fefbb45",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "64adf920-925b-142a-4930-757da20d765c": {
        "typeFullFqn": "system.time_series_chart",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_S_VolumeFlow",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#2196f3",
                  "settings": {
                    "yAxisId": "default",
                    "showInLegend": true,
                    "dataHiddenByDefault": false,
                    "type": "line",
                    "lineSettings": {
                      "showLine": true,
                      "step": false,
                      "stepType": "start",
                      "smooth": false,
                      "lineType": "solid",
                      "lineWidth": 2,
                      "showPoints": false,
                      "showPointLabel": false,
                      "pointLabelPosition": "top",
                      "pointLabelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "pointLabelColor": "rgba(0, 0, 0, 0.76)",
                      "pointShape": "emptyCircle",
                      "pointSize": 4,
                      "fillAreaSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    },
                    "barSettings": {
                      "showBorder": false,
                      "borderWidth": 2,
                      "borderRadius": 0,
                      "showLabel": false,
                      "labelPosition": "top",
                      "labelFont": {
                        "family": "Roboto",
                        "size": 11,
                        "sizeUnit": "px",
                        "style": "normal",
                        "weight": "400",
                        "lineHeight": "1"
                      },
                      "labelColor": "rgba(0, 0, 0, 0.76)",
                      "backgroundSettings": {
                        "type": "none",
                        "opacity": 0.4,
                        "gradient": {
                          "start": 100,
                          "end": 0
                        }
                      }
                    }
                  },
                  "_hash": 0.035444207015161044,
                  "units": "m/hr",
                  "decimals": 1,
                  "aggregationType": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value/1000;"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "hideAggregation": false,
            "hideAggInterval": false,
            "hideTimezone": false,
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 0,
              "interval": 300000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1742036092901,
                "endTimeMs": 1742122492901
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 25000
            },
            "timezone": null
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "top",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "thresholds": [],
            "dataZoom": false,
            "stack": false,
            "yAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "left",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "xAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "bottom",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "legendLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendLabelColor": "rgba(0, 0, 0, 0.76)",
            "showTooltip": true,
            "tooltipTrigger": "axis",
            "tooltipValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "tooltipValueColor": "rgba(0, 0, 0, 0.76)",
            "tooltipShowDate": true,
            "tooltipDateFormat": {
              "format": null,
              "lastUpdateAgo": false,
              "custom": false,
              "auto": true,
              "autoDateFormatSettings": {}
            },
            "tooltipDateFont": {
              "family": "Roboto",
              "size": 11,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipDateColor": "rgba(0, 0, 0, 0.76)",
            "tooltipDateInterval": true,
            "tooltipBackgroundColor": "rgba(255, 255, 255, 0.76)",
            "tooltipBackgroundBlur": 4,
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "yAxes": {
              "default": {
                "units": "m/hr",
                "decimals": 0,
                "show": true,
                "label": "Volume Flow",
                "labelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "600",
                  "lineHeight": "1"
                },
                "labelColor": "rgba(0, 0, 0, 0.54)",
                "position": "left",
                "showTickLabels": true,
                "tickLabelFont": {
                  "family": "Roboto",
                  "size": 12,
                  "sizeUnit": "px",
                  "style": "normal",
                  "weight": "400",
                  "lineHeight": "1"
                },
                "tickLabelColor": "rgba(0, 0, 0, 0.54)",
                "ticksFormatter": null,
                "showTicks": true,
                "ticksColor": "rgba(0, 0, 0, 0.54)",
                "showLine": true,
                "lineColor": "rgba(0, 0, 0, 0.54)",
                "showSplitLines": true,
                "splitLinesColor": "rgba(0, 0, 0, 0.12)",
                "id": "default",
                "order": 0
              }
            },
            "noAggregationBarWidthSettings": {
              "strategy": "group",
              "groupWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              },
              "barWidth": {
                "relative": true,
                "relativeWidth": 2,
                "absoluteWidth": 1000
              }
            },
            "animation": {
              "animation": true,
              "animationThreshold": 2000,
              "animationDuration": 500,
              "animationEasing": "cubicOut",
              "animationDelay": 0,
              "animationDurationUpdate": 300,
              "animationEasingUpdate": "cubicOut",
              "animationDelayUpdate": 0
            },
            "padding": "12px",
            "comparisonEnabled": false,
            "timeForComparison": "previousInterval",
            "comparisonCustomIntervalValue": 7200000,
            "comparisonXAxis": {
              "show": true,
              "label": "",
              "labelFont": {
                "family": "Roboto",
                "size": 12,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "600",
                "lineHeight": "1"
              },
              "labelColor": "rgba(0, 0, 0, 0.54)",
              "position": "top",
              "showTickLabels": true,
              "tickLabelFont": {
                "family": "Roboto",
                "size": 10,
                "sizeUnit": "px",
                "style": "normal",
                "weight": "400",
                "lineHeight": "1"
              },
              "tickLabelColor": "rgba(0, 0, 0, 0.54)",
              "ticksFormat": {},
              "showTicks": true,
              "ticksColor": "rgba(0, 0, 0, 0.54)",
              "showLine": true,
              "lineColor": "rgba(0, 0, 0, 0.54)",
              "showSplitLines": true,
              "splitLinesColor": "rgba(0, 0, 0, 0.12)"
            },
            "grid": {
              "show": false,
              "backgroundColor": null,
              "borderWidth": 1,
              "borderColor": "#ccc"
            },
            "legendColumnTitleFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "legendColumnTitleColor": "rgba(0, 0, 0, 0.38)",
            "legendValueFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500",
              "lineHeight": "16px"
            },
            "legendValueColor": "rgba(0, 0, 0, 0.87)",
            "tooltipLabelFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "400",
              "lineHeight": "16px"
            },
            "tooltipLabelColor": "rgba(0, 0, 0, 0.76)"
          },
          "title": "Time series chart",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": null,
          "configMode": "basic",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": false,
          "displayTimewindow": true,
          "titleFont": {
            "size": 16,
            "sizeUnit": "px",
            "family": "Roboto",
            "weight": "500",
            "style": "normal",
            "lineHeight": "24px"
          },
          "titleColor": "rgba(0, 0, 0, 0.87)",
          "titleTooltip": "",
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "units": "",
          "decimals": null,
          "noDataDisplayMessage": "",
          "timewindowStyle": {
            "showIcon": false,
            "iconSize": "24px",
            "icon": null,
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "400",
              "style": "normal",
              "lineHeight": "16px"
            },
            "color": "rgba(0, 0, 0, 0.38)",
            "displayTypePrefix": true
          },
          "margin": "0px",
          "borderRadius": "0px",
          "iconSize": "0px",
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "64adf920-925b-142a-4930-757da20d765c"
      },
      "d966cfd6-93e9-74cf-efa6-67911dffedfd": {
        "typeFullFqn": "system.indoor_horizontal_humidity_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 1,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
              "dataKeys": [
                {
                  "name": "CHC_C_Volume",
                  "type": "timeseries",
                  "label": "Volume Flow",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.16730164673977677,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "return value/1000;"
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1742055322915,
                "endTimeMs": 1742141722915
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "labelPosition": "top",
            "layout": "horizontal",
            "showLabel": true,
            "labelFont": {
              "family": "Roboto",
              "size": 16,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "labelColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.87)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showIcon": true,
            "iconSize": 40,
            "iconSizeUnit": "px",
            "icon": "water_drop",
            "iconColor": {
              "type": "constant",
              "color": "rgb(4, 138, 211)",
              "gradient": {
                "advancedMode": false,
                "gradient": [
                  "rgba(0, 255, 0, 1)",
                  "rgba(255, 0, 0, 1)"
                ],
                "gradientAdvanced": [
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(0, 255, 0, 1)"
                  },
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(255, 0, 0, 1)"
                  }
                ],
                "minValue": 0,
                "maxValue": 100
              },
              "rangeList": {
                "advancedMode": false,
                "range": [
                  {
                    "from": null,
                    "to": 30,
                    "color": "#FFA600"
                  },
                  {
                    "from": 30,
                    "to": 60,
                    "color": "#3FA71A"
                  },
                  {
                    "from": 60,
                    "to": null,
                    "color": "#D81838"
                  }
                ]
              },
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "valueFont": {
              "size": 36,
              "sizeUnit": "px",
              "family": "Roboto",
              "weight": "500",
              "style": "normal"
            },
            "valueColor": {
              "type": "constant",
              "color": "rgb(4, 138, 211)",
              "gradient": {
                "advancedMode": false,
                "gradient": [
                  "rgba(0, 255, 0, 1)",
                  "rgba(255, 0, 0, 1)"
                ],
                "gradientAdvanced": [
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(0, 255, 0, 1)"
                  },
                  {
                    "source": {
                      "type": "constant"
                    },
                    "color": "rgba(255, 0, 0, 1)"
                  }
                ],
                "minValue": 0,
                "maxValue": 100
              },
              "rangeList": {
                "advancedMode": false,
                "range": [
                  {
                    "from": null,
                    "to": 30,
                    "color": "#FFA600"
                  },
                  {
                    "from": 30,
                    "to": 60,
                    "color": "#3FA71A"
                  },
                  {
                    "from": 60,
                    "to": null,
                    "color": "#D81838"
                  }
                ]
              },
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "showDate": true,
            "dateFormat": {
              "format": null,
              "lastUpdateAgo": true,
              "custom": false
            },
            "dateFont": {
              "family": "Roboto",
              "size": 12,
              "sizeUnit": "px",
              "style": "normal",
              "weight": "500"
            },
            "dateColor": {
              "type": "constant",
              "color": "rgba(0, 0, 0, 0.38)",
              "colorFunction": "var temperature = value;\nif (typeof temperature !== undefined) {\n  var percent = (temperature + 60)/120 * 100;\n  return tinycolor.mix('blue', 'red', percent).toHexString();\n}\nreturn 'blue';"
            },
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "autoScale": true,
            "padding": ""
          },
          "title": "Horizontal humidity card",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "units": "m/hr",
          "decimals": 1,
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {},
          "configMode": "basic",
          "displayTimewindow": true,
          "margin": "0px",
          "borderRadius": "0px",
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "showTitleIcon": false,
          "titleTooltip": "",
          "titleFont": {
            "size": 12,
            "sizeUnit": "px",
            "family": null,
            "weight": null,
            "style": null,
            "lineHeight": "1.6"
          },
          "titleIcon": "",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "14px",
          "timewindowStyle": {
            "showIcon": true,
            "iconSize": "14px",
            "icon": "query_builder",
            "iconPosition": "left",
            "font": {
              "size": 12,
              "sizeUnit": "px",
              "family": null,
              "weight": null,
              "style": null,
              "lineHeight": "1"
            },
            "color": null
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "d966cfd6-93e9-74cf-efa6-67911dffedfd"
      },
      "678a80b3-1380-cdd2-495f-1701acde66c1": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
              "dataKeys": [
                {
                  "name": "title",
                  "type": "entityField",
                  "label": "Title",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.6231912076992963
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.03179212116453134
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.8801358300155324
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#EEEEEE",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "// 20.03.2025 DOJ\nvar params = ctx.stateController.getStateParams();\n\nvar criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\n\nvar criticalClass = (criticalCount && Number(criticalCount) > 0) ? 'critical' : 'inactive';\nvar majorClass    = (majorCount && Number(majorCount) > 0) ? 'major' : 'inactive';\n\nvar userRole = data[1].role;\nparams['userRole'] = userRole;\nctx.stateController.updateState(null,params);\n\nvar locationName;\nif (data && data.length) {\n    locationName = data[0]['entityName'] || 'N/A';\n} else {\n    locationName = 'N/A';\n}\n\n// Conditionally build the Projects button HTML\nvar projectsButtonHtml = '';\n/*if (userRole === \"Belimo Retrofit Engineers\") {\n    projectsButtonHtml =\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>Projects</span>' +\n        '</button>';\n}*/ if (userRole === \"Belimo Retrofit Engineer\") {\n    projectsButtonHtml =\n        /*'<button id=\"admin-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">admin_panel_settings</mat-icon>' +\n            '<span>Admin</span>' +\n        '</button>' +*/\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n        '</button>';\n} else if (userRole !== \"Belimo Retrofit Users\" && userRole !== \"Belimo Retrofit Engineer\") {\n    projectsButtonHtml =\n        '<button id=\"admin-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">admin_panel_settings</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.admin-btn.title}</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>{i18n:custom.diagnostics.projects-btn.title}</span>' +\n        '</button>';\n}\n\nconst header =\n  '<div class=\"header flex flex-row justify-between items-stretch\" style=\"margin:0;\">' +\n\n    '<div class=\"flex-none basis-[15%] flex flex-col items-center pl-[5px]\">' +\n      '<div class=\"title\" style=\"font-weight:550; font-size: 1.4em;\">' +\n        locationName +\n      '</div>' +\n    '</div>' +\n\n    '<div class=\"flex items-center pr-[5px]\">' +\n      projectsButtonHtml +\n/*      '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\" class=\"flex items-center\">' +\n        '<mat-icon class=\"tb-mat-18 mr-1\">assessment</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.reports-btn.title}</span>' +\n      '</button>' +*/\n    '</div>' +\n\n  '</div>';\n\n\n\n/*var header =\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between stretch\" fxLayoutGap=\"8px\" style=\"margin: 0px;\">' +\n      \n      '<div fxFlex=\"15\" fxLayout=\"column\" fxLayoutAlign=\"center\" style=\"padding-left: 5px;\" >' + // Reduced fxFlex from 40 to 20\n          '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' + // Reduce font size for title\n        '</div>' +\n\n      '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"8px\" style=\"padding-right: 5px;\">' +\n        projectsButtonHtml +\n        '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n          '<span>Reports</span>' +\n        '</button>' +\n      '</div>' +\n      \n    '</div>';*/\n\n/*return '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        header + \n            '<div id=\"home-dashboard\" style=\"width: 100%; height: 100%; margin-top: 10px;\">'+\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"home_dashboard_widgets\"></tb-dashboard-state>'+\n            '</div>'+\n        '</div>';*/\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">'\n/*  +   header*/\n  +   '<div id=\"home-dashboard\" class=\"w-full h-full\" style=\"width: 100%; height: 100%;\">'\n  +     '<tb-dashboard-state '\n  +       'class=\"flex-1\" '\n  +       '[ctx]=\"ctx\" '\n  +       '[syncParentStateParams]=\"true\" '\n  +       'stateId=\"home_dashboard_widgets\">'\n  +     '</tb-dashboard-state>'\n  +   '</div>'\n  + '</div>';\n\n\n\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n/*.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} */\n\n.header {\n    height: 60px;                    /* Fixed height for medium screens */\n    display: flex;                   /* Use Flexbox for layout */\n    align-items: center;             /* Vertically center content */\n    justify-content: space-between;  /* Space items evenly horizontally */\n    padding: 0 20px;                 /* Horizontal padding only */\n    box-sizing: border-box;          /* Include padding in height */\n}\n\n/* Small screens: up to 600px wide */\n@media (max-width: 600px) {\n    .main-layout .header {\n        height: 50px;   /* Smaller height for small screens */\n        padding: 0 10px; /* Reduced horizontal padding */\n    }\n}\n\n/* Medium screens: 601px to 1024px */\n@media (min-width: 601px) and (max-width: 1024px) {\n    .main-layout .header {\n        height: 60px;    /* Default height */\n        padding: 0 15px; /* Adjust padding if needed */\n    }\n}\n\n/* Large screens: 1025px and above */\n@media (min-width: 1025px) {\n    .main-layout .header {\n        height: 70px;   /* Increased height for larger screens */\n        padding: 0 20px; /* Maintain horizontal padding */\n    }\n}\n\n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #report-button, #reports-button, #admin-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#admin-button  {\n    background-color: red; /* Setzt die Hintergrundfarbe der Buttons */\n}\n\n#admin-button:hover  {\n    background-color: #FA6B6B; /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #report-button:hover, #reports-button:hover  {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon, #admin-button mat-icon  {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#projects-button span, #report-button span, #reports-button span, #admin-button span  {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>{i18n:custom.diagnostics.action.edit-measurement-parameters.title}</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n      <!-- Assignment Step -->\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n        \r\n        <!-- Assigned Kit Field -->\r\n        <!--<mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned Kit</mat-label>\r\n          <input matInput formControlName=\"assignedKit\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedKitAvailable}\">\r\n        </mat-form-field>-->\r\n\r\n        <!-- Assigned P-Flow Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Assigned P-Flow</mat-label>\r\n          <input matInput formControlName=\"assignedPFlow\" type=\"text\" readonly\r\n                 [ngClass]=\"{'error-text': !assignedPFlowAvailable}\">\r\n        </mat-form-field>\r\n\r\n        <!-- Progress Field -->\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>{i18n:custom.diagnostics.measurement-progress.title}</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">{i18n:custom.diagnostics.state-filter.preparation.title}</mat-option>\r\n            <mat-option value=\"active\">{i18n:custom.diagnostics.state-filter.active.title}</mat-option>\r\n            <mat-option value=\"finished\">{i18n:custom.diagnostics.state-filter.finished.title}</mat-option>\r\n            <mat-option value=\"aborted\">{i18n:custom.diagnostics.state-filter.aborted.title}</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <!-- Start Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.start-date.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.start-time.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <!-- End Date and Time -->\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.end-date.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.end-time.title}</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">{i18n:custom.diagnostics.action.cancel.title}</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" *ngIf=\"showAttributesStep\" [disabled]=\"!assignedPFlowAvailable\">{i18n:custom.diagnostics.action.next.title}</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Attributes Step -->\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <!-- Dimension -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.dimension.title}</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">{{ dimension }}</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                {i18n:custom.diagnostics.action.edit-measurement-parameters.dimension.error}\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.nominal-flow.title}</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-mearuement-parameters.floor-volume.title}</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>{i18n:custom.diagnostics.action.edit-measurement-parameters.pump-power.title}</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Installation Type -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\">\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Analysis -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\">\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"string\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <!-- Specific Side Information -->\r\n        <!--<fieldset class=\"fieldset\">\r\n          <legend>Specific Side Information</legend>\r\n          \r\n        </fieldset>-->\r\n\r\n        <!-- Weekly Operating Schedule -->\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div formGroupName=\"weeklyOperatingSchedule\" fxLayout=\"row\" fxLayoutGap=\"6px\" fxLayoutAlign=\"space-between center\">\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button matStepperNext color=\"primary\" type=\"button\" [disabled]=\"addDeviceFormGroup.invalid\">Next</button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">Save</button>\r\n        </div>\r\n      </mat-step>\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = ['customDialog', 'entityService', 'deviceService', 'entityGroupService', 'attributeService', 'entityRelationService', 'assetService'].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = widgetContext.stateController.getStateParams()?.selectedMeasurement?.entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Ungltige measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\n/*function fetchAssignedAssetsAndDevices(measurementId) {\r\n    const assetSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Owns\",\r\n        assetTypes: [\"Doktorkit\"],\r\n    };\r\n\r\n    assetService.findByQuery(assetSearchQuery).subscribe(\r\n        (doktorkits) => {\r\n            let assignedDoktorkitName = 'No Kit assigned!';\r\n            let doktorkitId = null;\r\n\r\n            if (doktorkits.length > 0) {\r\n                const assignedDoktorkit = doktorkits[0];\r\n                assignedDoktorkitName = assignedDoktorkit?.name || 'No Kit assigned!';\r\n                doktorkitId = assignedDoktorkit?.id?.id || null;\r\n            }\r\n\r\n            if (!doktorkitId) {\r\n                fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n                return;\r\n            }\r\n\r\n            fetchAssignedDevices(doktorkitId, assignedDoktorkitName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des Doktorkits:\", error);\r\n            fetchAttributes('No Kit assigned!', 'No P-Flow assigned!');\r\n        }\r\n    );\r\n}*/\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n/*    if (!doktorkitId) {\r\n        fetchAttributes(assignedDoktorkitName, 'No P-Flow assigned!');\r\n        return;\r\n    }*/\r\n\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (PFlows) => {\r\n            let assignedPFlowName = 'No P-Flow assigned!';\r\n\r\n            if (PFlows.length > 0) {\r\n                assignedPFlowName = PFlows[0]?.name || 'No P-Flow assigned!';\r\n            }\r\n\r\n            fetchAttributes(assignedPFlowName);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen des P-Flows:\", error);\r\n            fetchAttributes('No P-Flow assigned!');\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedPFlowName) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedPFlowName, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Fehler beim Abrufen der Attribute:\", error);\r\n            openAddDeviceDialog(assignedPFlowName, null);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedPFlowName, attributes) {\r\n    customDialog\r\n        .customDialog(htmlTemplate, AddDeviceDialogController, {\r\n            measurementId,\r\n            assignedPFlowName,\r\n            attributes,\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    const {\r\n        measurementId,\r\n        assignedPFlowName,\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n    \r\n    // Assuming assignedDoktorkitName and assignedPFlowName are defined somewhere in your code\r\n    if (assignedPFlowName !=='No P-Flow assigned!') {\r\n        vm.showAttributesStep = true;\r\n        vm.showAlarmThresholdsStep = true;\r\n    } else {\r\n        vm.showAttributesStep = false;\r\n        vm.showAlarmThresholdsStep = false;\r\n    }\r\n\r\n    vm.assignedPFlowAvailable = assignedPFlowName !== 'No P-Flow assigned!';\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                assignedPFlow: [{ value: assignedPFlowName, disabled: true }, [vm.validators.required]],\r\n                progress: [{ value: 'in preparation', disabled: true }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: true }],\r\n                startTime: [{ value: null, disabled: true }],\r\n                endDate: [{ value: null, disabled: true }],\r\n                endTime: [{ value: null, disabled: true }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area:[null],\r\n                unit:[null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Mapping between attribute keys and form control names\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                vm.addDeviceFormGroup\r\n                    .get(`stepper.${['progress'].includes(formControlName) ? 'assignmentStep' : 'attributesStep'}.${formControlName}`)\r\n                    .setValue(attr.value);\r\n            } else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = attr.key === 'startTimeMs' ? 'startDate' : 'endDate';\r\n                    const timeControlName = attr.key === 'startTimeMs' ? 'startTime' : 'endTime';\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            } else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n    \r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((installationTypeOptions) => {\r\n                setDefaultDeltaT(installationTypeOptions);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n         // New subscription to calculate and set deltaTAnalysisFloorVolume\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((nominalFlow) => {\r\n                if (nominalFlow) {\r\n                    const deltaTValue = (nominalFlow * 0.02).toFixed(3); // Calculate 2% of nominalFlow\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(deltaTValue);\r\n                }\r\n            });\r\n            \r\n        vm.addDeviceFormGroup\r\n        .get('stepper.assignmentStep.progress')\r\n        .valueChanges.subscribe((newValue) => {\r\n            if (newValue !== lastProgressValue) {\r\n                lastProgressValue = newValue;\r\n                updateProgressControl();\r\n            }\r\n        });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n\r\n        if (!vm.assignedPFlowAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n        \r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        } else if((progressControl.value === 'finished' || progressControl.value === 'aborted') && startDateControl.value && \r\n            startTimeControl.value && !endDateControl.value && !endTimeControl.value) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const deltaT = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup.get('stepper.attributesStep.deltaT').setValue(deltaT);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;\r\n\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            { key: 'area', value: {\"value\":attributesStep.area, \"unit\":attributesStep.unit}},\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Fehler beim Speichern der Attribute:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b"
              },
              {
                "name": "admin-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "27a13540-f6e7-11f0-9979-9f3434877bb4",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e63ea2ea-53c8-1e57-c98b-a33fc883593f"
              }
            ],
            "headerButton": []
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "678a80b3-1380-cdd2-495f-1701acde66c1"
      },
      "dc35f902-3824-8f1b-a870-fee55664d0bd": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"market-layout flex size-full flex-col\" style=\"padding:0; height:100%;\">\n  <!-- Block A - nur sichtbar, wenn KEIN Projekt gewhlt ist -->\n<!--  <div *ngIf=\"!ctx.stateController.getStateParams().selectedProject\" class=\"flex flex-col\" style=\"width:100%; height:100px;\">\n    <h5 class=\"market-title\">{i18n:custom.diagnostics.projects.title}</h5>\n    <tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" stateId=\"Measurement_state_filter\"> </tb-dashboard-state>\n  </div>-->\n  <!-- Block B - nur sichtbar, wenn EIN Projekt gewhlt ist -->\n  <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedProject\" style=\"height:100px;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"project_card_header\"></tb-dashboard-state>\n  <!-- Map container - switches between projects_map and selected_project_map -->\n  <div class=\"flex flex-1 flex-col\" style=\"position: relative;\">\n    <tb-dashboard-state \n      class=\"flex-1\" \n      [ctx]=\"ctx\" \n      [syncParentStateParams]=\"true\" \n      [stateId]=\"ctx.stateController.getStateParams().selectedProject ? 'selected_project_map' : 'projects_map'\">\n    </tb-dashboard-state>\n  </div>\n</div>",
            "markdownTextFunction": "// Zugriff auf State-Parameter und Initialisierung des HTML-Strings\r\nvar stateParams = ctx.stateController.getStateParams();\r\nvar selectedProject = stateParams ? stateParams.selectedProject : null;\r\nvar html = '<div style=\"display:flex; flex-direction:column; height:100%;\">';\r\n\r\n// Fall 1: Kein Projekt ausgewhlt\r\nif (!selectedProject) {\r\n    html += '<div style=\"height:170px; display:flex; flex-direction:column;\">';\r\n    html += '<h3>Projects</h3>';\r\n    html += '<h4>State filter</h4>';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"Measurement_state_filter\"></tb-dashboard-state>';\r\n    html += '<hr>';\r\n    html += '</div>';\r\n    // Unterer Bereich fllt den restlichen Platz (flex:1)\r\n    html += '<div style=\"flex:1;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"projects_map\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n\r\n// Fall 2: Ein Projekt ist ausgewhlt\r\n} else {\r\n    html += '<div style=\"height:170px;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"project_card_header\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n    // Unterer Bereich fllt den restlichen Platz\r\n    html += '<div style=\"flex:1;\">';\r\n    html += '<tb-dashboard-state ctx=\"ctx\" state-id=\"projects_map\"></tb-dashboard-state>';\r\n    html += '</div>';\r\n}\r\n\r\n// Abschlieender div-Tag und Rckgabe des HTML-Strings\r\nhtml += '</div>';\r\nreturn html;",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n.state-filter-title {\n    padding-bottom: 15px;\n    padding-left: 10px;\n}\n\n.market-layout .alarm-badges-layout {\n    position: absolute;\n    height: 50px;\n    top: 0;\n    left: 0;\n    right: 0;\n    z-index: 2;\n    display: flex;\n    justify-content: center;\n    pointer-events: none;\n}\n\n.market-layout .alarm-badges-layout .alarm-badges {\n    height: 50px;\n    width: 350px;\n    pointer-events: all;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 4px !important;\n    margin-bottom: 4px !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mdc-form-field > label {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "borderRadius": "8"
        },
        "row": 0,
        "col": 0,
        "id": "dc35f902-3824-8f1b-a870-fee55664d0bd",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "36164ff1-d530-f9fa-168f-841b2190d1ff": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.2843241633853528
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.269921240377482,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "floorplan",
                  "type": "attribute",
                  "label": "floorplan",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.8780681509751609
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7387368079086034
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<!--<div fxLayout=\"row\" fxLayoutAlign=\"center center\" style=\"margin-bottom: 20px; padding: 10px; background-color: #ffffff;\">\n    <button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\n        <mat-icon class=\"tb-mat-18\">map</mat-icon>\n        <span>Plan</span>\n    </button>\n    <button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">\n        <mat-icon class=\"tb-mat-18\">equalizer</mat-icon>\n        <span>Raw Data</span>\n    </button>\n</div>\n<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\">\n    </div>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n        <div fxFlex=\"50\" fxLayout=\"column\">\n            <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n            <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>\n        </div>\n        <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n        <div fxFlex=\"50\" fxLayout=\"column\">\n            <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n            <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>\n        </div>\n    </div>\n</div>-->\n\n<div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">\n  <div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding-top: 10px; background-color: #ffffff;\">\n    <button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">\n      <mat-icon class=\"tb-mat-18\">map</mat-icon><span>Plan</span>\n    </button>\n    <button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">\n      <mat-icon class=\"tb-mat-18\">equalizer</mat-icon><span>Raw Data</span>\n    </button>\n  </div>\n<div style=\"display: flex; justify-content: flex-end; padding: 10px;\">\n  <button id=\"manage-plan-button\" mat-icon-button style=\"background-color: #fafafa; color: #000;\">\n    <mat-icon>space_dashboard</mat-icon>\n  </button>\n</div>\n\n\n\n\n\n  <div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">\n    <div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\" style=\"flex: 0;\"></div>\n    <tb-dashboard-state style=\"flex: 2;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div style=\"flex: 1; display: flex; flex-direction: row;\">\n      <div style=\"flex: 1; display: flex; flex-direction: column;\">\n        <h5 style=\"padding-bottom: 7px;\">Filter</h5>\n        <tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>\n      </div>\n      <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n      <div style=\"flex: 1; display: flex; flex-direction: column;\">\n        <h5 style=\"padding-bottom: 7px;\">State filter</h5>\n        <tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>\n      </div>\n    </div>\n  </div>\n</div>\n",
            "markdownTextFunction": "var floorplanValue = data[0].floorplan;\n/*console.log(\"floorplan: \",data[0].floorplan);*/\nvar userRole = data[1].role || \"\";\n/*console.log(\"role:\", userRole);*/\nlet mode;\nif (floorplanValue && floorplanValue !== \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K\") {\n    mode = ctx.stateController.getStateParams().tabMode || 'selectedMeasurementPlan';\n} else {\n    mode = ctx.stateController.getStateParams().tabMode || 'selectedMeasurementRawData';\n}\n\n// 2) Conditionally build the Manage Plan button HTML\nvar managePlanButtonHtml = \"\";\nvar planHtml = '';\nif (mode === \"selectedMeasurementPlan\" && userRole !== \"Belimo Retrofit Users\") {\n    managePlanButtonHtml =\n      '<div class=\"flex justify-end pr-2\">' +\n        '<button id=\"manage-plan-button\" ' +\n                'type=\"button\" mat-button color=\"primary\" ' +\n                'class=\"text-center w-[200px]\"' +\n                'style = \"background-color: #FAFAFA; width: 200px;\">' +\n          '<mat-icon>map</mat-icon>' +\n          '<span>Manage Plan</span>' +\n        '</button>' +\n      '</div>';\n    planHtml =\n      '<tb-dashboard-state ' +\n        'class=\"flex-[2]\" ' +\n        '[ctx]=\"ctx\" ' +\n        '[syncParentStateParams]=\"true\" ' +\n        'stateId=\"measurement_plan\">' +\n      '</tb-dashboard-state>';\n} else if (mode === \"selectedMeasurementPlan\" && userRole === \"Belimo Retrofit Users\") {\n    planHtml =\n      '<tb-dashboard-state ' +\n        'class=\"flex-[2]\" ' +\n        '[ctx]=\"ctx\" ' +\n        '[syncParentStateParams]=\"true\" ' +\n        'stateId=\"measurement_plan_user\">' +\n      '</tb-dashboard-state>';\n}\n\nlet params = ctx.stateController.getStateParams();\n\nvar vm = this;\n\nvm.onInit = function() {\n};\n\nvm.updateMode = function(newMode) {\n    let params = vm.ctx.stateController.getStateParams() || {};\n    params.tabMode = newMode;\n    vm.ctx.stateController.updateState(null, params);\n};\n\nreturn '' +\n  '<div class=\"main-layout w-full h-full flex flex-col\">' +\n\n    '<div class=\"flex flex-row items-center justify-center gap-2 p-2 bg-white\">' +\n      '<button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" ' +\n        'style=\"background-color:#FAFAFA\" class=\"flex-1 text-center bg-gray-50\" ' +\n        'ng-click=\"vm.updateMode(\\'selectedMeasurementPlan\\')\">' +\n        '<mat-icon class=\"tb-mat-18\">map</mat-icon><span>Plan</span>' +\n      '</button>' +\n      '<button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" ' +\n        'style=\"background-color:#FAFAFA\" class=\"flex-1 text-center bg-gray-50\" ' +\n        'ng-click=\"vm.updateMode(\\'selectedMeasurementRawData\\')\">' +\n        '<mat-icon class=\"tb-mat-18\">equalizer</mat-icon><span>Raw Data</span>' +\n      '</button>' +\n    '</div>' +\n\n    managePlanButtonHtml +\n\n    (mode === 'selectedMeasurementRawData'\n      ? '<tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_raw_data\"></tb-dashboard-state>'\n      : \n        // market-layout: one container split 2:1 by inline flex\n        '<div style=\"flex:1; display:flex; flex-direction:column; overflow:hidden; padding:0;\">' +\n\n          // planHtml takes 2 parts\n          '<div style=\"flex:2; flex-basis:0; display:flex; flex-direction:column;\">' +\n            planHtml +\n          '</div>' +\n\n          '<mat-divider style=\"margin:10px 0;\"></mat-divider>' +\n\n          // filters take 1 part\n          '<div style=\"flex:1; flex-basis:0; display:flex; flex-direction:row; gap:20px; padding:8px;\">' +\n\n            '<div style=\"flex:1; display:flex; flex-direction:column;\">' +\n              '<h5 style=\"margin-bottom:8px;\">Filter</h5>' +\n              '<tb-dashboard-state style=\"flex:1; width:100%;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_filter\"></tb-dashboard-state>' +\n            '</div>' +\n\n            '<mat-divider vertical></mat-divider>' +\n\n            '<div style=\"flex:1; display:flex; flex-direction:column;\">' +\n              '<h5 style=\"margin-bottom:8px;\">State filter</h5>' +\n              '<tb-dashboard-state style=\"flex:1; width:100%;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"state_filter\"></tb-dashboard-state>' +\n            '</div>' +\n\n          '</div>' +\n\n        '</div>'\n    ) +\n\n  '</div>';\n\n\n\n\n\n/*var floorplanValue = data[0].floorplan.value;\n\nif (floorplanValue) {\n    // Return HTML if floorplanValue is not null, undefined, empty string, 0, or false\n    return '<div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">' +\n      '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"8px\" style=\"padding-top: 10px; background-color: #ffffff;\">' +\n        '<button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">' +\n          '<mat-icon class=\"tb-mat-18\">map</mat-icon><span>Plan</span>' +\n        '</button>' +\n        '<button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \">' +\n          '<mat-icon class=\"tb-mat-18\">equalizer</mat-icon><span>Raw Data</span>' +\n        '</button>' +\n      '</div>' +\n      '<div style=\"display: flex; justify-content: flex-end; padding: 10px;\">' +\n        '<button id=\"manage-plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center; background-color: #fafafa \"\">' +\n          '<mat-icon> map</mat-icon><span>Manage Plan</span>' +\n        '</button>' +\n      '</div>' +\n      '<div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">' +\n        '<div fxLayout=\"row\" fxLayoutAlign=\"end center\" fxLayoutGap=\"10px\" style=\"flex: 0;\"></div>' +\n        '<tb-dashboard-state style=\"flex: 2;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_plan\"></tb-dashboard-state>' +\n        '<mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>' +\n        '<div style=\"flex: 1; display: flex; flex-direction: row;\">' +\n          '<div style=\"flex: 1; display: flex; flex-direction: column;\">' +\n            '<h5 style=\"padding-bottom: 7px;\">Filter</h5>' +\n            '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"measurement_filter\"></tb-dashboard-state>' +\n          '</div>' +\n          '<mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>' +\n          '<div style=\"flex: 1; display: flex; flex-direction: column;\">' +\n            '<h5 style=\"padding-bottom: 7px;\">State filter</h5>' +\n            '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" stateId=\"state_filter\"></tb-dashboard-state>' +\n          '</div>' +\n        '</div>' +\n      '</div>' +\n    '</div>';\n} else {\n    // Return HTML if floorplanValue is null, undefined, empty string, etc.\n    return '<div style=\"height: 100%; display: flex; flex-direction: column; overflow: hidden;\">' +\n      '<div fxLayout=\"row\" fxLayoutAlign=\"center center\" style=\"margin-bottom: 20px; padding: 10px; background-color: #ffffff;\">' +\n        '<button id=\"plan-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">' +\n          '<mat-icon class=\"tb-mat-18\">map</mat-icon>' +\n          '<span>Plan</span>' +\n        '</button>' +\n        '<button id=\"raw-data-button\" type=\"button\" mat-button color=\"primary\" style=\"flex: 1; text-align: center;\">' +\n          '<mat-icon class=\"tb-mat-18\">equalizer</mat-icon>' +\n          '<span>Raw Data</span>' +\n        '</button>' +\n      '</div>' +\n      '<div class=\"market-layout\" style=\"flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;\">' +\n        '<div fxLayout=\"row\" fxLayoutAlign=\"end center\"  style=\"flex: 0;\"></div>' +\n        '<tb-dashboard-state style=\"flex: 1;\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_raw_data\"></tb-dashboard-state>' +\n      '</div>' +\n    '</div>';\n}\n*/",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n/*.market-layout {\n    position: relative;\n    padding-top: 0; \n}\n\n.market-title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n    margin-top: 0; \n}\n\n.market-subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n    margin-top: -5px; \n}*/\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field > label .mat-icon {\n    margin-left: 0;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-form-field .label-wrapper {\n    font-weight: bold;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch {\n    width: 42px;\n    margin-left: 8px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track {\n    border-radius: 16px;\n    height: 24px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle-track {\n    width: calc(100% - 24px);\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__handle {\n    border-radius: 10px;\n    width: 20px;\n    height: 20px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__ripple {\n    width: 40px;\n    height: 40px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__icons {\n    display: none;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after {\n    background: #fafafa;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-mdc-slide-toggle .mdc-switch .mdc-switch__track::after {\n    background: #F2994A;\n}\n\n.tb-widget-container .tb-widget .leaflet-control-zoom {\n    display: none;\n}\n",
          "noDataDisplayMessage": "",
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "raw-data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['tabMode'] = 'selectedMeasurementRawData'; \n//console.log(params);\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "473c03b6-d4f0-a790-a16c-123eed809d64"
              },
              {
                "name": "plan-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['tabMode'] = 'selectedMeasurementPlan'; \n//console.log(params);\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "636654fb-e2d7-fa7c-4356-aad908ca2a98"
              },
              {
                "name": "manage-plan-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "add_plan",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "popoverPreferredPlacement": "top",
                "popoverHideOnClickOutside": true,
                "popoverHideDashboardToolbar": true,
                "popoverWidth": "650px",
                "popoverHeight": "200px",
                "popoverStyle": {},
                "openInSeparateDialog": false,
                "openInPopover": true,
                "id": "a2b3cbcd-96e7-c9e7-c76f-5dda0d890f93"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "36164ff1-d530-f9fa-168f-841b2190d1ff",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "cdb435a1-59ea-074f-1456-0d8505f6cd18": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "startTimeMs",
                  "type": "attribute",
                  "label": "startTimeMs",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.4880248004489329
                },
                {
                  "name": "endTimeMs",
                  "type": "attribute",
                  "label": "endTimeMs",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.334866663156842
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817439,
                "endTimeMs": 1678283217439
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "# Markdown/HTML card \\n - **Current entity**: **${entityName}**. \\n - **Current value**: **${Random}**.",
            "markdownTextFunction": "// let mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementAlarms';\r\nlet mode = ctx.stateController.getStateParams().targetMode || 'selectedMeasurementSignalStrength';\r\n\r\nlet params = ctx.stateController.getStateParams();\r\nlet switchTimeWindow = null;\r\nlet startTimeMs, endTimeMs;\r\n\r\nif (data && data.length) {\r\n    startTimeMs = data[0].startTimeMs || 0;\r\n    endTimeMs = data[0].endTimeMs || 0;\r\n}\r\n\r\nif (startTimeMs !== 0 && endTimeMs !== 0) {\r\n    if (endTimeMs - startTimeMs <= 1209600000) {\r\n        switchTimeWindow = 1;\r\n    } else {\r\n        switchTimeWindow = 2;\r\n    }\r\n}\r\n\r\nvar vm = this;\r\n\r\nvm.onInit = function() {\r\n    \r\n};\r\n\r\nvm.updateMode = function(newMode) {\r\n    let params = vm.ctx.stateController.getStateParams() || {};\r\n    params.targetMode = newMode;\r\n    vm.ctx.stateController.updateState(null, params);\r\n};\r\n\r\nswitch (switchTimeWindow) {\r\n    case 1:\r\n    case 2:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: startTimeMs,\r\n                    endTimeMs: endTimeMs\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n    default:\r\n        var newDashboardtimewindow = {\r\n            aggregation: {\r\n                limit: 100000,\r\n                type: \"NONE\"\r\n            },\r\n            hideAggInterval: false,\r\n            hideAggregation: false,\r\n            hideInterval: false,\r\n            history: {\r\n                historyType: 1,\r\n                fixedTimewindow: {\r\n                    startTimeMs: Date.now() - 1209600000,\r\n                    endTimeMs: Date.now()\r\n                }\r\n            },\r\n            selectedTab: 1\r\n        };\r\n        break;\r\n}\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, params);\r\n\r\nreturn '' +\r\n  '<div style=\"display:flex; flex-direction:column; width:100%; height:100%; overflow:hidden;\">' +\r\n\r\n    // measurement header  fixed 100px\r\n    '<div style=\"flex:none; height:100px; width:100%;\">' +\r\n      '<tb-dashboard-state ' +\r\n        'style=\"height:100%; width:100%;\" ' +\r\n        '[ctx]=\"ctx\" [syncParentStateParams]=\"true\" ' +\r\n        'stateId=\"measurement_card_header\">' +\r\n      '</tb-dashboard-state>' +\r\n    '</div>' +\r\n\r\n    // measurement details  fixed 100px\r\n    '<div style=\"flex:none; height:100px; width:100%;\">' +\r\n      '<tb-dashboard-state ' +\r\n        'style=\"height:100%; width:100%;\" ' +\r\n        '[ctx]=\"ctx\" [syncParentStateParams]=\"true\" ' +\r\n        'stateId=\"measurement_card_details\">' +\r\n      '</tb-dashboard-state>' +\r\n    '</div>' +\r\n\r\n    // divider\r\n    '<div style=\"height:1px; width:100%; margin:8px 0; background-color:#e0e0e0;\"></div>' +\r\n\r\n    // button bar  fixed 64px\r\n    '<div style=\"display:flex; flex:none; height:64px; width:100%; padding:8px; background:#fff; box-sizing:border-box; gap:8px; justify-content:center; align-items:center;\">' +\r\n      '<button id=\"alarms-button\" ' +\r\n              'type=\"button\" mat-button color=\"primary\" ' +\r\n              'style=\"flex:1; text-align:center; background:#fafafa; padding:8px; border-radius:4px;\" ' +\r\n              'ng-click=\"vm.updateMode(\\'selectedMeasurementAlarms\\')\">' +\r\n        '<mat-icon class=\"tb-mat-18\">map</mat-icon>' +\r\n        '<span>Alarms</span>' +\r\n      '</button>' +\r\n      '<button id=\"signal-strength-button\" ' +\r\n              'type=\"button\" mat-button color=\"primary\" ' +\r\n              'style=\"flex:1; text-align:center; background:#fafafa; padding:8px; border-radius:4px;\" ' +\r\n              'ng-click=\"vm.updateMode(\\'selectedMeasurementSignalStrength\\')\">' +\r\n        '<mat-icon class=\"tb-mat-18\">signal_cellular_alt</mat-icon>' +\r\n        '<span>Signal Strength</span>' +\r\n      '</button>' +\r\n    '</div>' +\r\n\r\n    // main content  flexible remainder\r\n    '<div style=\"flex:1; overflow:visible; padding:8px; box-sizing:border-box;\">' +\r\n\r\n      // optional legend panel\r\n      (mode === 'selectedMeasurementSignalStrength'\r\n        ? '' +\r\n          '<mat-expansion-panel style=\"background-color:#FAFAFA; box-shadow:none; margin-bottom:8px;\">' +\r\n            '<mat-expansion-panel-header>' +\r\n              '<mat-panel-title style=\"color:#757575;\">Signal Strength Legend</mat-panel-title>' +\r\n            '</mat-expansion-panel-header>' +\r\n            '<mat-tab-group>' +\r\n              // RSRP Tab\r\n              '<mat-tab label=\"RSRP\">' +\r\n                '<div style=\"padding:10px 0;\">' +\r\n                  '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                    '<tr>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&gt;= -80</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">-80 to -90</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">-90 to -100</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&lt;= -100</td>' +\r\n                    '</tr>' +\r\n                  '</table>' +\r\n                '</div>' +\r\n              '</mat-tab>' +\r\n              // RSRQ Tab\r\n              '<mat-tab label=\"RSRQ\">' +\r\n                '<div style=\"padding:10px 0;\">' +\r\n                  '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                    '<tr>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&gt;= -10</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">-10 to -15</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">-15 to -20</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&lt;= -20</td>' +\r\n                    '</tr>' +\r\n                  '</table>' +\r\n                '</div>' +\r\n              '</mat-tab>' +\r\n              // RSSI Tab\r\n              '<mat-tab label=\"RSSI\">' +\r\n                '<div style=\"padding:10px 0;\">' +\r\n                  '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                    '<tr>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">Range (dBm)</th>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&gt; -65</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">-65 to -75</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Fair</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">-75 to -85</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Poor</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&lt;= -85</td>' +\r\n                    '</tr>' +\r\n                  '</table>' +\r\n                '</div>' +\r\n              '</mat-tab>' +\r\n              // SNR Tab\r\n              '<mat-tab label=\"SNR\">' +\r\n                '<div style=\"padding:10px 0;\">' +\r\n                  '<table style=\"border-collapse: collapse; font-size: 15px; width: auto; margin: 0 auto;\">' +\r\n                    '<tr>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">RF Experience</th>' +\r\n                      '<th style=\"text-align: left; padding: 5px 30px;\">Range (dB)</th>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(39, 174, 96, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Excellent</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&gt;= 20</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 215, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Good</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">13 to 20</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 140, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Mid Cell</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">0 to 13</td>' +\r\n                    '</tr>' +\r\n                    '<tr style=\"background-color: rgba(255, 0, 0, 0.1);\">' +\r\n                      '<td style=\"padding: 5px 30px; font-weight: bold;\">Cell Edge</td>' +\r\n                      '<td style=\"padding: 5px 30px;\">&lt;= 0</td>' +\r\n                    '</tr>' +\r\n                  '</table>' +\r\n                '</div>' +\r\n              '</mat-tab>' +\r\n            '</mat-tab-group>' +\r\n          '</mat-expansion-panel>'\r\n        : ''\r\n      ) +\r\n\r\n      // the dynamic state area (alarms or signal_strength)\r\n      '<div style=\"height:100%; width:100%;\">' +\r\n        (mode === 'selectedMeasurementAlarms'\r\n          ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_alarms\"></tb-dashboard-state>'\r\n          : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"signal_strength\"></tb-dashboard-state>'\r\n        ) +\r\n      '</div>' +\r\n\r\n    '</div>' +\r\n  '</div>';\r\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.mat-form-field input[disabled] {\n  background-color: #f5f5f5; /* Light grey background to indicate disabled state */\n  cursor: not-allowed; /* Change cursor to indicate non-interactive element */\n  color: #9e9e9e; /* Change text color to indicate disabled state */\n  \n}\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow.no-padding {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 4px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "default",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              },
              {
                "name": "alarms-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['targetMode'] = 'selectedMeasurementAlarms'; \n//console.log(params);\n\nwidgetContext.updateAliases();\n\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5858ee89-1140-5f22-75de-09d735b37df1"
              },
              {
                "name": "signal-strength-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['targetMode'] = 'selectedMeasurementSignalStrength';\n//console.log(params);\nwidgetContext.updateAliases();\nwidgetContext.stateController.updateState('measurement_details_ultrasonic', params);\n\n\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "cc7da9e0-1e94-489c-af1e-c0eea0165ff9"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "cdb435a1-59ea-074f-1456-0d8505f6cd18",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "8891fc49-6afe-386d-e186-465e9ff47747": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.03179212116453134
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.8801358300155324
                },
                {
                  "name": "name",
                  "type": "attribute",
                  "label": "name",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.13886520838148741
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.3442731354317581
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.9688188450715927
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.9826078157078795
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.654644606179237
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.4730365060482158
                },
                {
                  "name": "installationTypeOptions",
                  "type": "attribute",
                  "label": "installationTypeOptions",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.7216292409771887
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#EEEEEE",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": "let $injector = ctx.$scope.$injector;\nlet assetService = $injector.get(ctx.servicesMap.get('assetService'));\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nvar entityId;\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n    entityId = data[0]['entityId'];\n} else {\n    deviceState = false;\n    entityId = null;\n}\nvar userRole = data[1].role;\nvar stateParams = ctx.stateController.getStateParams();\nstateParams[\"userRole\"] = userRole;\nctx.stateController.updateState(null, stateParams);\n\nvar ButtonHtml = '';\nif (userRole === \"Belimo Retrofit Administrators\") {\n    ButtonHtml =\n        '<button id=\"parameter-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n            '<span>Parameters</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>Projects</span>' +\n        '</button>';\n}\nvar name, label, state, active, progress, locationName, installationType, installation, dimension, installationTypeOptions, measurementType, startTime, endTime;\nif (data && data.length) {\n    name = data[0]['entityName'] || 'N/A';\n    label = data[0]['Label'] || 'N/A';\n    locationName = data[0]['locationName'] || 'N/A';\n    installationType = data[0]['installationType'] || 'N/A';\n    installationTypeOptions = data[0]['installationTypeOptions'] || 'N/A';\n    dimension = data[0]['dimension'] || 'N/A';\n    state = data[0]['state'] || 'N/A';\n    active = data[0]['active'] || 'N/A';\n    progress = data[0]['progress'] || 'N/A';\n    measurementType = data[0]['measurementType'] || 'N/A';\n    startTime = data[0]['startTimeMs'] || 'N/A';\n    endTime = data[0]['endTimeMs'] || 'N/A';\n    if (active === 'false') {\n        state = 'disconnected';\n    }\n}\n\n// finished & aborted\nif (startTime !== 'N/A' && endTime !== 'N/A') {\n    deltaTime = endTime - startTime;\n    timeThreshold = 3024000000; // 35 days\n    if (deltaTime <= timeThreshold) { \n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: startTime, // now - 2 weeks\n                    endTimeMs: endTime\n                }\n            },\n            selectedTab: 1\n        };\n    } else {\n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: endTime - timeThreshold, // now - 2 weeks\n                    endTimeMs: endTime\n                }\n            },\n            selectedTab: 1\n        }; \n    }\n}\n// active\nelse if (startTime !== 'N/A' && endTime === 'N/A') {\n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: startTime,\n                    endTimeMs: Date.now()\n                }\n            },\n            selectedTab: 1\n    };\n// default\n}\nelse {\n    var newDashboardtimewindow = {\n        aggregation: {\n            limit: 100000,\n            type: \"NONE\"\n        },\n        hideAggInterval: true,\n        hideAggregation: true,\n        hideInterval: false,\n        history: {\n            historyType: 1,\n            fixedTimewindow: {\n                startTimeMs: Date.now() - 1209600000, // now - 2 weeks\n                endTimeMs: Date.now()\n            }\n        },\n        selectedTab: 1\n    };\n}\n\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\nctx.stateController.updateState(null, stateParams);\n\nvar projectAssetQuery = {\n    \"parameters\": {\n        \"rootId\": entityId,\n        \"rootType\": \"ASSET\",\n        \"direction\": \"TO\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 1073741824,\n        \"fetchLastLevelOnly\": false\n    },\n    \"relationType\": \"Owns\",\n    \"assetTypes\": [\n        \"Project\"\n    ]\n};\n\nassetService.findByQuery(projectAssetQuery).subscribe(\n    function(projects) {\n        if (projects && projects.length > 0) {\n            var projectId = projects[0].id.id || projects[0].id;\n            /*console.log(\"Found project with ID:\", projectId);*/\n\n            var measurementAssetsQuery = {\n                \"parameters\": {\n                    \"rootId\": projectId,\n                    \"rootType\": \"ASSET\",\n                    \"direction\": \"FROM\",\n                    \"relationTypeGroup\": \"COMMON\",\n                    \"maxLevel\": 1073741824,\n                    \"fetchLastLevelOnly\": false\n                },\n                \"relationType\": \"Owns\",\n                \"assetTypes\": [\n                    \"Measurement\"\n                ]\n            };\n\n            assetService.findByQuery(measurementAssetsQuery).subscribe(\n                function(measurements) {\n                   /* console.log(\"Measurements found:\", measurements);*/\n                    // Build the dropdown and insert it into the container beside the buttons\n                    var dropdownHtml = buildMeasurementDropdown(measurements);\n                    document.getElementById(\"measurement-dropdown-container\").innerHTML = dropdownHtml;\n                    // Now attach the change listener to the newly inserted dropdown\n                    var dropdownEl = document.getElementById(\"measurement-dropdown\");\n                    if (dropdownEl) {\n                        dropdownEl.addEventListener(\"change\", function(e) {\n                            onMeasurementChange(e.target.value);\n                        });\n                    }\n                },\n                function(error) {\n                    console.error(\"Error fetching measurements:\", error);\n                }\n            );\n        } else {\n            console.log(\"No project found.\");\n        }\n    },\n    function(error) {\n        console.error(\"Error fetching project:\", error);\n    }\n);\n\nif (installationType === 'heating') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: red;\">local_fire_department</mat-icon><span style=\"margin-left: 8px;\">Heating</span></div>';\n} else if (installationType === 'cooling') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: blue;\">ac_unit</mat-icon><span style=\"margin-left: 8px;\">Cooling</span></div>';\n} else {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon>question_mark</mat-icon><span style=\"margin-left: 8px;\">N/A</span></div>';\n}\n\nvar header =\n  '<div class=\"header flex flex-row justify-start items-stretch gap-4\" style=\"margin-bottom: 10px; margin-top:0px; margin-left: 0px; margin-right:0px;\">' +\n\n    // Back Button\n    '<div class=\"flex flex-col justify-center items-center\">' +\n      '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\n        '<mat-icon>arrow_back</mat-icon>' +\n      '</button>' +\n    '</div>' +\n\n    // Title (big & bold)\n    '<div class=\"flex-none flex flex-col justify-center items-center\">' +\n      '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' +\n    '</div>' +\n\n    // Parameters (evenly spaced)\n    '<div class=\"flex flex-row flex-1 justify-between gap-2\" style=\"margin-left: 100px;\">' +\n      '<div class=\"param-cell flex-1 flex flex-col gap-2\">' +\n        '<div class=\"param-title\">Installation:</div>' +\n        '<div class=\"param\">' + installation + '</div>' +\n      '</div>' +\n      '<div class=\"param-cell flex-1 flex flex-col gap-2\">' +\n        '<div class=\"param-title\">Type:</div>' +\n        '<div class=\"param\">' + installationTypeOptions + '</div>' +\n      '</div>' +\n      '<div class=\"param-cell flex-1 flex flex-col gap-2\">' +\n        '<div class=\"param-title\">State:</div>' +\n        '<div class=\"param\">' + getStateHtml(state) + '</div>' +\n      '</div>' +\n      '<div class=\"param-cell flex-1 flex flex-col gap-2\">' +\n        '<div class=\"param-title\">Progress:</div>' +\n        '<div class=\"param\">' + getStateHtml(progress) + '</div>' +\n      '</div>' +\n    '</div>' +\n\n    // Actions row\n    '<div class=\"flex flex-row justify-start items-center\">' +\n      ButtonHtml +\n      '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\n        '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n        '<span>Reports</span>' +\n      '</button>' +\n      '<div id=\"measurement-dropdown-container\"></div>' +\n    '</div>' +\n\n  '</div>';\n\n\nreturn '<div class=\"main-layout flex flex-col w-full h-full\">'\n  +    header\n  +    '<div id=\"home-dashboard\" class=\"w-full h-full mt-2.5\">'\n  +      '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" '\n  +      'stateId=\"measurement_details_ultrasonic_widgets\">'\n  +      '</tb-dashboard-state>'\n  +    '</div>'\n  +  '</div>';\n\n\n\n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n           '</span>';\n}\n\nfunction getStateSvg(state) {\n    switch (state) {\n        case 'in preparation':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/></svg>';\n        case 'active':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#f3de61\"/></svg>';\n        case 'finished':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#27AE60\"/></svg>';\n        case 'aborted':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"orange\"/></svg>';\n        case 'minor':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"yellow\"/></svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"green\"/></svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.93 16.73L16.07 2.59L17.49 4L3.34 18.14L1.93 16.73Z\" fill=\"#CAC1D2\"/>' +\n                   '</g>' +\n                   '<defs><clipPath id=\"clip0\"><rect width=\"20\" height=\"20\" fill=\"white\"/></clipPath></defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/></svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'critical';\n        case 'major':\n            return 'major';\n        case 'minor':\n            return 'minor';\n        case 'normal':\n            return 'normal';\n        case 'in preperation':\n            return 'in Preperation';\n        case 'active':\n            return 'active';\n        case 'finished':\n            return 'finished';\n        case 'aborted':\n            return 'aborted';\n        default:\n            return state;\n    }\n}\n\nvar measurementData = [];\n\nfunction buildMeasurementDropdown(measurements) {\n    measurementData = measurements;\n    \n    // Retrieve the current measurement's id from state params (if available)\n    var stateParams = ctx.stateController.getStateParams();\n    var currentMeasurementId = null;\n    if (stateParams && stateParams.selectedMeasurement) {\n        currentMeasurementId = stateParams.selectedMeasurement.entityId.id || stateParams.selectedMeasurement.entityId;\n    }\n    \n    // Filter and sort measurements, filtering out the current selection.\n    var sortedMeasurements = measurements\n        .filter(function(measurement) {\n            var mId = measurement.id.id || measurement.id;\n            return mId !== currentMeasurementId;\n        })\n        .sort(function(a, b) {\n            var aName = a.entityName || a.name || \"\";\n            var bName = b.entityName || b.name || \"\";\n            var aMatch = aName.match(/(\\d+)$/);\n            var bMatch = bName.match(/(\\d+)$/);\n            var aNum = aMatch ? parseInt(aMatch[1], 10) : 0;\n            var bNum = bMatch ? parseInt(bMatch[1], 10) : 0;\n            return aNum - bNum;\n        });\n    \n    var defaultTitle = (locationName && locationName !== 'N/A') ? locationName : \"Select Measurement\";\n    defaultTitle += \" \\u25BE\";\n    \n    var dropdownHtml = '<select id=\"measurement-dropdown\" style=\"width:180px; height:40px; padding:0 15px; font-size:18px; font-weight:500; background-color:#E0E0E0; color:#28232D; margin-right:10px; border:none; border-radius:4px; -webkit-appearance:none; appearance:none; white-space:pre;\" ' +\n    'onfocus=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\" ' +\n    'onblur=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\">';\n\n\n\n\n\n    dropdownHtml += '<option value=\"\" style=\" width:180px; background-color: #f0f0f0; color: #28232D; ' +\n                    'font-size: 18px; font-weight: 400; white-space: pre;\" selected; padding-right: 20px;>' +\n                    defaultTitle + '</option>';\n    \n    // Helper: pad a string to a fixed length (by characters)\n    function padString(str, length) {\n        str = str || \"\";\n        if (str.length >= length) return str.substring(0, length);\n        return str + \" \".repeat(length - str.length);\n    }\n    \n    // Define fixed column widths (in number of characters)\n    var leftColumnWidth = 30;  // for locationName\n    var rightColumnWidth = 30; // for entityName\n    \n    // Build each option for each measurement.\n    sortedMeasurements.forEach(function(measurement) {\n        var mId = measurement.id.id || measurement.id;\n        var optionId = \"measurement-option-\" + mId;\n        dropdownHtml += '<option id=\"'+ optionId +'\" value=\"' + mId + '\" ' +\n            'style=\"width:180px; height:40px; padding:0 15px; font-size:18px; font-weight:500; background-color:#E0E0E0; color:#28232D; margin-right:10px; border:none; border-radius:4px; -webkit-appearance:none; appearance:none; white-space:pre;\">' +\n            'Loading...' +\n            '</option>';\n        \n        // Fetch both locationName and measurementType asynchronously.\n        attributeService.getEntityAttributes(measurement.id, 'SERVER_SCOPE', ['locationName', 'measurementType'])\n    .subscribe(\n        function(attributes) {\n            // Check measurementType  if it is \"loraWan\", remove the option and skip further processing.\n            var measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\n            if (measurementTypeAttr && measurementTypeAttr.value === 'loraWan') {\n                var optionEl = document.getElementById(optionId);\n                if (optionEl) {\n                    optionEl.remove();\n                }\n                return;\n            }\n            \n            var locationAttr = attributes.find(attr => attr.key === 'locationName');\n            var locationDisplay = locationAttr ? locationAttr.value : \"N/A\";\n            var entityDisplay = measurement.entityName || measurement.name || mId;\n            // Pad both sides so that the divider always appears in the middle.\n            var leftText = padString(locationDisplay, leftColumnWidth);\n            var rightText = padString(entityDisplay, rightColumnWidth);\n            // Append non-breaking spaces for extra right-side padding.\n            var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\"; // Adjust count as needed\n            var displayText = leftText + \"  \" + rightText + trailingPadding;\n            var optionEl = document.getElementById(optionId);\n            if (optionEl) {\n                optionEl.innerHTML = displayText;\n            }\n        },\n        function(error) {\n            console.error(\"Error fetching attributes for measurement\", measurement, error);\n            var optionEl = document.getElementById(optionId);\n            if (optionEl) {\n                var entityDisplay = measurement.entityName || measurement.name || mId;\n                var leftText = padString(\"N/A\", leftColumnWidth);\n                var rightText = padString(entityDisplay, rightColumnWidth);\n                var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\";\n                optionEl.innerHTML = leftText + \"  \" + rightText + trailingPadding;\n            }\n        }\n    );\n    \n    });\n    \n    dropdownHtml += '</select>';\n    return dropdownHtml;\n}\n\n\n\nfunction onMeasurementChange(selectedMeasurementId) {\n    if (!selectedMeasurementId) return;\n    \n    var selectedMeasurement = measurementData.find(function(m) {\n        var mId = m.id.id || m.id;\n        return mId === selectedMeasurementId;\n    });\n    \n    if (!selectedMeasurement) {\n        console.error(\"Measurement object not found for id:\", selectedMeasurementId);\n        return;\n    }\n\n    attributeService.getEntityAttributes(selectedMeasurement.id, 'SERVER_SCOPE', ['installationType', 'measurementType'])\n      .subscribe(\n          attributes => {\n\n              var installationTypeAttr = attributes.find(attr => attr.key === 'installationType');\n              var measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\n              \n              var installationType = installationTypeAttr ? installationTypeAttr.value : null;\n              var measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\n\n              var updatedMeasurement = {\n                  entityId: {\n                      id: selectedMeasurement.id.id || selectedMeasurement.id,\n                      entityType: \"ASSET\"\n                  },\n                  entityName: selectedMeasurement.entityName || selectedMeasurement.name,\n                  entityLabel: selectedMeasurement.entityLabel || selectedMeasurement.label ||\n                               (selectedMeasurement.entityName || selectedMeasurement.name)\n              };\n\n              var params = ctx.stateController.getStateParams() || {};\n              params['selectedMeasurement'] = updatedMeasurement;\n              params['targetEntityParamName'] = \"selectedMeasurement\";\n              params['_ts'] = new Date().getTime();\n              \n              /*console.log(\"Updating selectedMeasurement to:\", updatedMeasurement, params, \"using stateId:\", stateId);*/\n\n              ctx.stateController.updateState('measurement_details_ultrasonic', params);\n          },\n          error => {\n              console.error(\"Error fetching attributes for measurement:\", error);\n          }\n      );\n}\n\n\n\n\n\n/*var criticalCount = data[0]['criticalAlarmsCount'];\nvar majorCount = data[0]['majorAlarmsCount'];\nvar userRole = data[1].role;\nconsole.log(\"role:\", userRole);\nvar criticalClass = criticalCount && Number(criticalCount) > 0 ? 'critical' : 'inactive';\nvar majorClass = majorCount && Number(majorCount) > 0 ? 'major' : 'inactive';\nvar type;\nvar locationName;\nif (data && data.length) {\n    locationName = data[0]['entityName'] || 'N/A';\n    type = data[0]['Type'];\n} else {\n    locationName = 'N/A';\n    type = 'N/A';\n}\n\nvar ButtonHtml = '';\nif (userRole === \"Belimo Retrofit Administrators\") {\n    ButtonHtml =\n        '<button id=\"parameters-button\" type=\"button\" mat-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n          '<span>Parameters</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n          '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n          '<span>Projects</span>' +\n        '</button>';\n}\n    \nvar header =\n    '<div class=\"header\" fxLayout=\"row\" fxLayoutAlign=\"space-between stretch\" fxLayoutGap=\"8px\" style=\"margin: 0px;\">' +\n    \n        '<div fxFlex=\"15\" fxLayout=\"row\" fxLayoutAlign=\"start center\" >' +\n            '<button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button>' +\n                '<mat-icon>arrow_back</mat-icon>' +\n            '</button>' +\n          '<div class=\"title\" style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' +\n        '</div>' +\n        \n        '<div fxLayout=\"row\" fxLayoutAlign=\"start center\" fxLayoutGap=\"8px\" style=\"padding-right: 5px;\">' +\n            '<button id=\"details-button\" type=\"button\" mat-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">dashboard-full</mat-icon>' +\n                '<span>Details</span>' +\n            '</button>' +\n            ButtonHtml +\n            '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\">' +\n                '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n                '<span>Reports</span>' +\n            '</button>' +\n        '</div>' +\n    '</div>';\n\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\n        header + \n            '<div id=\"home-dashboard\" style=\"width: 100%; height: 100%; margin-top: 10px;\">'+\n                '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_details_ultrasonic_widgets\"></tb-dashboard-state>'+\n            '</div>'+\n        '</div>';*/\n\n\n\n\n\n/*var projectsButtonHtml = '';*/\n/*if (userRole === \"Belimo Retrofit Engineers\") {\n    projectsButtonHtml =\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>Projects</span>' +\n        '</button>';\n}*/ /*if (userRole === \"Belimo Retrofit Administrators\") {\n    projectsButtonHtml =\n        '<button id=\"admin-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">admin_panel_settings</mat-icon>' +\n            '<span>Admin</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>Projects</span>' +\n        '</button>';\n}*/\n\n\n\n\n\n\n",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n/*.main-layout .header .title {\n    width: auto;\n    height: 50px;\n    padding-right: 15px; \n    font-size: 18px;\n    font-weight: 500;\n    background-color: #E0E0E0;\n    color: #28232D;\n    display: flex; \n    align-items: center; \n    justify-content: center;\n    gap: 2px;\n    margin-right: 10px;\n    border-radius: 4px;\n}*/\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #reports-button, #data-button, #report-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown {\n    width: auto; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#measurement-dropdown option {\n    background-color: #f0f0f0; /* Example background color */\n    color: #28232D;           /* Text color */\n    font-size: 18px;          /* Font size */\n    font-weight: 500;         /* Font weight */\n    /* Some browsers may support these, others might ignore them: */\n    padding: 5px;\n}\n\n\n#measurement-dropdown:focus {\n    outline: none !important;\n    border: none !important;\n    box-shadow: none !important;\n    outline-offset: 0 !important;\n}\n\n#measurement-dropdown::-moz-focus-inner {\n    border: 0 !important;\n}\n\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #reports-button:hover, #data-button:hover, #report-button:hover, #parameter-button:hover {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #reports-button mat-icon, #data-button mat-icon, #report-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #data-button und #report-button */\n#projects-button span, #reports-button span, #data-button span, #report-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n\r\n       <mat-form-field appearance=\"fill\" floatLabel=\"always\" class=\"mat-block\">\r\n  <mat-label>Assigned Devices</mat-label>\r\n  \r\n  <!-- Conditionally apply 'margin-top' and 'gap' only when assignedDevices exist -->\r\n  <mat-chip-grid\r\n  #chipList\r\n  aria-label=\"Assigned Devices\"\r\n  [ngStyle]=\"{\r\n    'display': 'flex',\r\n    'flex-wrap': 'wrap',\r\n    'gap': assignedDevices?.length ? '8px' : '0px',\r\n    'margin-top': assignedDevices?.length ? '8px' : '0px'\r\n  }\"\r\n>\r\n  <mat-chip-row\r\n    *ngFor=\"let dev of assignedDevices\"\r\n    color=\"primary\"\r\n    selected=\"true\"\r\n    disableRipple\r\n  >\r\n    {{ dev.name }}\r\n  </mat-chip-row>\r\n</mat-chip-grid>\r\n\r\n<input\r\n  matInput\r\n  [matChipInputFor]=\"chipList\"\r\n  readonly\r\n  [placeholder]=\"assignedDevices?.length ? '' : 'No devices assigned!'\"\r\n/>\r\n\r\n\r\n  <mat-error *ngIf=\"!assignedDevices?.length\">\r\n    No devices assigned!\r\n  </mat-error>\r\n</mat-form-field>\r\n\r\n\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button\r\n            mat-button\r\n            matStepperNext\r\n            color=\"primary\"\r\n            type=\"button\"\r\n            *ngIf=\"showAttributesStep\"\r\n            [disabled]=\"!assignedDevicesAvailable\"\r\n          >\r\n            Next\r\n          </button>\r\n           <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\" *ngIf=\"!showAttributesStep\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">\r\n                  {{ dimension }}\r\n                </mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error\r\n                *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\"\r\n              >\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error\r\n                *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\"\r\n              >\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"text\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div\r\n            formGroupName=\"weeklyOperatingSchedule\"\r\n            fxLayout=\"row\"\r\n            fxLayoutGap=\"6px\"\r\n            fxLayoutAlign=\"space-between center\"\r\n          >\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <!--<button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>-->\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <!--<mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High CO2 Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"highCo2CriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Temperature Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"highTemperatureCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Humidity Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"highHumidityCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High CO2 Major Threshold</mat-label>\r\n              <input matInput formControlName=\"highCo2MajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Temperature Major Threshold</mat-label>\r\n              <input matInput formControlName=\"highTemperatureMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Humidity Major Threshold</mat-label>\r\n              <input matInput formControlName=\"highHumidityMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>-->\r\n\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": ".mat-form-field input[disabled] {\n  background-color: #f5f5f5; /* Light grey background to indicate disabled state */\n  cursor: not-allowed; /* Change cursor to indicate non-interactive element */\n  color: #9e9e9e; /* Change text color to indicate disabled state */\n  \n}\n\nmat-icon {\n    vertical-align: middle; /* or baseline, top, bottom */\n    margin-right: 4px; /* space between icon and text */\n}\n\n.fieldset {\n    border: 1px solid #e2e8f0;\n    background: #ffffff;\n    color: #334155;\n    border-radius: 6px;\n    padding-bottom: 1px;\n    padding-top: 1px;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n.fieldset-legend {\n    margin-bottom: 0.375rem;\n    color: #334155;\n    background: #ffffff;\n    font-weight: 300;\n    border-radius: 6px;\n    padding: 2px;\n}\n.fieldset-container{\n    padding-bottom: 10px;\n}\n\n.disabled-checkbox {\n  pointer-events: none;\n  opacity: 0.5; /* To make it visually look disabled */\n}\n\n.disabled-fields {\n  pointer-events: none;   /* Prevents interaction */\n  opacity: 0.5;           /* Makes it look disabled */\n}\n\n/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = [\r\n    'customDialog',\r\n    'entityService',\r\n    'deviceService',\r\n    'entityGroupService',\r\n    'attributeService',\r\n    'entityRelationService',\r\n    'assetService'\r\n].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Invalid measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            fetchAttributes(devices);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching devices:\", error);\r\n            fetchAttributes([]);\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDevices) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDevices, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching attributes:\", error);\r\n            openAddDeviceDialog(assignedDevices, []);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDevices, attributes) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        assignedDevices,\r\n        attributes,\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    // const measurementType = vm.data.attributes[0].value;\r\n    const measurementTypeAttr = vm.data.attributes.find(attr => attr.key === 'measurementType');\r\n    const measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\r\n\r\n    const {\r\n        measurementId,\r\n        assignedDevices = [],\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n\r\n    vm.assignedDevices = assignedDevices;\r\n    vm.assignedDevicesAvailable = assignedDevices.length > 0;\r\n\r\n    vm.showAttributesStep = vm.assignedDevicesAvailable && (measurementType === 'ultrasonic');\r\n    /*vm.showAlarmThresholdsStep = vm.assignedDevicesAvailable;*/\r\n\r\n\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                progress: [{ value: 'in preparation', disabled: !vm.assignedDevicesAvailable }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                startTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area: [null],\r\n                unit: [null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            /*alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),*/\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Map known attribute keys to form controls\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                // If it's 'progress', put in assignmentStep; else in attributesStep\r\n                const stepGroup =\r\n                    (formControlName === 'progress')\r\n                        ? 'assignmentStep'\r\n                        : 'attributesStep';\r\n\r\n                vm.addDeviceFormGroup\r\n                  .get(`stepper.${stepGroup}.${formControlName}`)\r\n                  .setValue(attr.value);\r\n            }\r\n            // Start/end times\r\n            else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = (attr.key === 'startTimeMs') ? 'startDate' : 'endDate';\r\n                    const timeControlName = (attr.key === 'startTimeMs') ? 'startTime' : 'endTime';\r\n\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            }\r\n            // Weekly schedule\r\n            else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n            // If you had existing alarm threshold attributes, you could map them similarly\r\n            // e.g. if there's an attr.key === 'maxVolumeFlowCriticalThreshold', etc.\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n\r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((val) => {\r\n                setDefaultDeltaT(val);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((val) => {\r\n                if (val) {\r\n                    // Example: floorVolume is 2% of nominalFlow\r\n                    const floorVal = (val * 0.02).toFixed(3);\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(floorVal);\r\n                }\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.assignmentStep.progress')\r\n            .valueChanges.subscribe((newValue) => {\r\n                if (newValue !== lastProgressValue) {\r\n                    lastProgressValue = newValue;\r\n                    updateProgressControl();\r\n                }\r\n            });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n            \r\n    if (!vm.showAttributesStep) {\r\n          // For the entire step:\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').disable();\r\n          // or remove required validators from each control\r\n        } else {\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').enable();\r\n        }\r\n\r\n        if (!vm.assignedDevicesAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n\r\n        // If progress is active but no start time set, auto-set to now\r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        }\r\n        // If progress is finished/aborted but no end time set (and we have a start), auto-set end to now\r\n        else if (\r\n            (progressControl.value === 'finished' || progressControl.value === 'aborted') &&\r\n            startDateControl.value && startTimeControl.value &&\r\n            !endDateControl.value && !endTimeControl.value\r\n        ) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n   function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        \r\n        // Only clear if the current value isn't one of the valid options\r\n        const currentOption = vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').value;\r\n        if (!options.includes(currentOption)) {\r\n             vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n        }\r\n    }\r\n\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const defaultDelta = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.deltaT')\r\n            .setValue(defaultDelta);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n/*        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;*/\r\n\r\n        // Convert date/time to epoch\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            {\r\n                key: 'area',\r\n                value: {\r\n                    value: attributesStep.area,\r\n                    unit: attributesStep.unit\r\n                }\r\n            },\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n\r\n            /*{ key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },*/\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                // Save successful\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error while saving attributes:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b"
              },
              {
                "name": "admin-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "27a13540-f6e7-11f0-9979-9f3434877bb4",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e63ea2ea-53c8-1e57-c98b-a33fc883593f"
              },
              {
                "name": "details-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet attributeService = $injector.get(widgetContext\n    .servicesMap.get('attributeService'));\nconst targetElement = $($event.target).closest(\n    '#details-full', widgetContext.$container[0]);\n\nvar type = decodeURIComponent($(targetElement).attr(\n    'data-device-type'));\n//widgetContext.dialogs.alert('type:', JSON.stringify(type));\nlet installationType = \"\";\nvar params = {\n    selectedMeasurement: {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n    },\n    targetEntityParamName: 'selectedMeasurement'\n};\nattributeService.getEntityAttributes(entityId,\n    'SERVER_SCOPE', ['installationType']).subscribe(\n    attributes => {\n        installationType = attributes.find(attr => attr\n            .key === 'installationType').value;\n        //widgetContext.dialogs.alert('installationType:', JSON.stringify(installationType));\n        var stateId = getMeasurementState(type);\n        //widgetContext.dialogs.alert('stid:', stateId);\n        widgetContext.stateController.openState(stateId,\n            params, true);\n    });\n\n\n\n\n//widgetContext.actionsApi.openDashboardStateInPopover($event, stateId, params, true, 'bottomRight', true, '1600px', getDeviceHeight(type));\n/*Check Attributes of P-Flow (heating or cooling)*/\n\nfunction getMeasurementState(type) {\n    let state;\n    if (installationType.toLowerCase() === \"cooling\") {\n        state = 'measurement_details_cooling_full';\n    } else if (installationType.toLowerCase() ===\n        \"heating\") {\n        state = 'measurement_details_heating_full';\n    } else {\n        state = 'measurement_details_heating_full';\n    }\n    return state;\n}\n\nfunction getDeviceHeight(type) {\n    switch (type) {\n        case 'P-Flow D116':\n            return '1000px';\n        case 'Room Sensor T':\n            return '1000px';\n        case 'Room Sensor CO2':\n            return '1000px';\n        case 'Door Sensor':\n            return '1000px';\n        case 'Motion Sensor':\n            return '1000px';\n        case 'Occupancy Sensor':\n            return '1000px';\n        default:\n            return '35vh';\n    }\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "83e55ce6-c38a-63c2-7630-b5259c26a67d"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "8891fc49-6afe-386d-e186-465e9ff47747"
      },
      "39587e2b-40bb-0159-51d2-b73048880da1": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
              "dataKeys": [
                {
                  "name": "criticalAlarmsCount",
                  "type": "timeseries",
                  "label": "criticalAlarmsCount",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.03179212116453134
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "timeseries",
                  "label": "majorAlarmsCount",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.8801358300155324
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.0261914421979883
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.13757749246352646
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.7069742821698115
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.8877943737572298
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.40979602901363665
                },
                {
                  "name": "measurementType",
                  "type": "attribute",
                  "label": "measurementType",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.2662298453687968
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.9422651370834398
                },
                {
                  "name": "installationTypeOptions",
                  "type": "attribute",
                  "label": "installationTypeOptions",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.2737812788039522
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.02320659508559819
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1718716759837,
                "endTimeMs": 1718803159837
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#EEEEEE",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"market-layout\" style=\"width: 100%; height: 100%; padding: 0;\" fxLayout=\"column\">\n    <h5 class=\"market-title\">${entityName}</h5>\n    <tb-dashboard-state style=\"width: 100%; height: 90px;\" [ctx]=\"ctx\" stateId=\"alarm_badges\"></tb-dashboard-state>\n    <tb-dashboard-state fxFlex=\"70\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"plan\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 20px;\"></mat-divider>\n    <div fxFlex=\"30\" fxLayout=\"row\">\n     <div fxFlex=\"60\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">Filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"device-filter\"></tb-dashboard-state>\n     </div>\n     <mat-divider vertical style=\"margin-left: 20px; margin-right: 20px;\"></mat-divider>\n     <div fxFlex=\"40\" fxLayout=\"column\">\n        <h5 style=\"padding-bottom: 15px;\">State filter</h5>\n        <tb-dashboard-state fxFlex [ctx]=\"ctx\" stateId=\"state-filter\"></tb-dashboard-state>\n     </div>\n    </div>\n</div>",
            "markdownTextFunction": {
              "body": "let $injector = ctx.$scope.$injector;\nlet assetService = $injector.get(ctx.servicesMap.get('assetService'));\nlet attributeService = $injector.get(ctx.servicesMap.get('attributeService'));\nvar entityId;\nvar deviceState;\nif (data && data.length && data[0]['entityId']) {\n    deviceState = true;\n    entityId = data[0]['entityId'];\n} else {\n    deviceState = false;\n    entityId = null;\n}\nvar userRole = data[1].role;\nvar stateParams = ctx.stateController.getStateParams();\nstateParams[\"userRole\"] = userRole;\nctx.stateController.updateState(null, stateParams);\n\nvar ButtonHtml = '';\nif (userRole === \"Belimo Retrofit Administrators\") {\n    ButtonHtml =\n        '<button id=\"parameter-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">settings</mat-icon>' +\n            '<span>Parameters</span>' +\n        '</button>' +\n        '<button id=\"projects-button\" type=\"button\" mat-button color=\"primary\">' +\n            '<mat-icon class=\"tb-mat-18\">assignment</mat-icon>' +\n            '<span>Projects</span>' +\n        '</button>';\n}\nvar name, label, state, active, progress, locationName, installationType, installation, dimension, installationTypeOptions, measurementType, startTime, endTime;\nif (data && data.length) {\n    name = data[0]['entityName'] || 'N/A';\n    label = data[0]['Label'] || 'N/A';\n    locationName = data[0]['locationName'] || 'N/A';\n    installationType = data[0]['installationType'] || 'N/A';\n    installationTypeOptions = data[0]['installationTypeOptions'] || 'N/A';\n    dimension = data[0]['dimension'] || 'N/A';\n    state = data[0]['state'] || 'N/A';\n    active = data[0]['active'] || 'N/A';\n    progress = data[0]['progress'] || 'N/A';\n    measurementType = data[0]['measurementType'] || 'N/A';\n    startTime = data[0]['startTimeMs'] || 'N/A';\n    endTime = data[0]['endTimeMs'] || 'N/A';\n    if (active === 'false') {\n        state = 'disconnected';\n    }\n}\n\n// finished & aborted\nif (startTime !== 'N/A' && endTime !== 'N/A') {\n    deltaTime = endTime - startTime;\n    timeThreshold = 3024000000; // 35 days\n    if (deltaTime <= timeThreshold) { \n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: startTime, // now - 2 weeks\n                    endTimeMs: endTime\n                }\n            },\n            selectedTab: 1\n        };\n    } else {\n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: endTime - timeThreshold, // now - 2 weeks\n                    endTimeMs: endTime\n                }\n            },\n            selectedTab: 1\n        }; \n    }\n}\n// active\nelse if (startTime !== 'N/A' && endTime === 'N/A') {\n        var newDashboardtimewindow = {\n            aggregation: {\n                limit: 100000,\n                type: \"NONE\"\n            },\n            hideAggInterval: true,\n            hideAggregation: true,\n            hideInterval: false,\n            history: {\n                historyType: 1,\n                fixedTimewindow: {\n                    startTimeMs: startTime,\n                    endTimeMs: Date.now()\n                }\n            },\n            selectedTab: 1\n    };\n// default\n}\nelse {\n    var newDashboardtimewindow = {\n        aggregation: {\n            limit: 100000,\n            type: \"NONE\"\n        },\n        hideAggInterval: true,\n        hideAggregation: true,\n        hideInterval: false,\n        history: {\n            historyType: 1,\n            fixedTimewindow: {\n                startTimeMs: Date.now() - 1209600000, // now - 2 weeks\n                endTimeMs: Date.now()\n            }\n        },\n        selectedTab: 1\n    };\n}\n\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\nctx.stateController.updateState(null, stateParams);\n\nvar projectAssetQuery = {\n    \"parameters\": {\n        \"rootId\": entityId,\n        \"rootType\": \"ASSET\",\n        \"direction\": \"TO\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 1073741824,\n        \"fetchLastLevelOnly\": false\n    },\n    \"relationType\": \"Owns\",\n    \"assetTypes\": [\n        \"Project\"\n    ]\n};\n\nassetService.findByQuery(projectAssetQuery).subscribe(\n    function(projects) {\n        if (projects && projects.length > 0) {\n            var projectId = projects[0].id.id || projects[0].id;\n            /*console.log(\"Found project with ID:\", projectId);*/\n\n            var measurementAssetsQuery = {\n                \"parameters\": {\n                    \"rootId\": projectId,\n                    \"rootType\": \"ASSET\",\n                    \"direction\": \"FROM\",\n                    \"relationTypeGroup\": \"COMMON\",\n                    \"maxLevel\": 1073741824,\n                    \"fetchLastLevelOnly\": false\n                },\n                \"relationType\": \"Owns\",\n                \"assetTypes\": [\n                    \"Measurement\"\n                ]\n            };\n\n            assetService.findByQuery(measurementAssetsQuery).subscribe(\n                function(measurements) {\n                   /* console.log(\"Measurements found:\", measurements);*/\n                    // Build the dropdown and insert it into the container beside the buttons\n                    var dropdownHtml = buildMeasurementDropdown(measurements);\n                    document.getElementById(\"measurement-dropdown-container\").innerHTML = dropdownHtml;\n                    // Now attach the change listener to the newly inserted dropdown\n                    var dropdownEl = document.getElementById(\"measurement-dropdown\");\n                    if (dropdownEl) {\n                        dropdownEl.addEventListener(\"change\", function(e) {\n                            onMeasurementChange(e.target.value);\n                        });\n                    }\n                },\n                function(error) {\n                    console.error(\"Error fetching measurements:\", error);\n                }\n            );\n        } else {\n            console.log(\"No project found.\");\n        }\n    },\n    function(error) {\n        console.error(\"Error fetching project:\", error);\n    }\n);\n\nif (installationType === 'heating') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: red;\">local_fire_department</mat-icon><span style=\"margin-left: 8px;\">Heating</span></div>';\n} else if (installationType === 'cooling') {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon style=\"color: blue;\">ac_unit</mat-icon><span style=\"margin-left: 8px;\">Cooling</span></div>';\n} else {\n    installation = '<div style=\"display: flex; align-items: center;\"><mat-icon>question_mark</mat-icon><span style=\"margin-left: 8px;\">N/A</span></div>';\n}\n\nvar header =\n  '<div class=\"header flex flex-row items-stretch w-full gap-2 p-2\" style=\"margin-top:0px; margin-right:0px; margin-left:0px;\">' +\n\n    // Left group: Back button + Title\n    '<div class=\"flex flex-row items-center gap-2 flex-none\">' +\n      '<button id=\"go-back\" matTooltip=\"{i18n:action.go-back}\" type=\"button\" mat-icon-button class=\"p-2\">' +\n        '<mat-icon>arrow_back</mat-icon>' +\n      '</button>' +\n      '<div style=\"font-size: 1.4em; font-weight: 550;\">' + locationName + '</div>' +\n    '</div>' +\n\n    // Middle group: parameters evenly spaced\n    '<div class=\"flex-1 flex flex-row justify-evenly items-center\">' +\n      /* Installation & Type can be added similarly if needed */\n      '<div class=\"flex flex-col gap-2 items-start\">' +\n        '<span class=\"param-title font-medium\">{i18n:device.state}</span>' +\n        '<span class=\"param\">' + getStateHtml(state) + '</span>' +\n      '</div>' +\n      '<div class=\"flex flex-col gap-2 items-start\">' +\n        '<span class=\"param-title font-medium\">{i18n:custom.diagnostics.measurement-details.progress}</span>' +\n        '<span class=\"param\">' + getStateHtml(progress) + '</span>' +\n      '</div>' +\n    '</div>' +\n\n    // Right group: action buttons\n    '<div class=\"flex flex-row items-center flex-none\">' +\n      ButtonHtml +\n      '<button id=\"reports-button\" type=\"button\" mat-button color=\"primary\" class=\"flex items-center\">' +\n        '<mat-icon class=\"tb-mat-18\">assessment</mat-icon>' +\n        '<span>{i18n:custom.diagnostics.reports-btn.title}</span>' +\n      '</button>' +\n      '<div id=\"measurement-dropdown-container\" class=\"ml-4\"></div>' +\n    '</div>' +\n\n  '</div>';\n\nreturn '' +\n  '<div class=\"main-layout flex flex-col w-full h-full\">' +\n    header +\n    '<div id=\"home-dashboard\" class=\"flex-1 w-full h-full\" style=\"margin-top:5px;\">' +\n      '<tb-dashboard-state class=\"w-full h-full\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"measurement_details_lorawan_widgets\"></tb-dashboard-state>' +\n    '</div>' +\n  '</div>';\n\n\n\nfunction getStateHtml(state) {\n    var stateSvg = getStateSvg(state);\n    var encodedStateSvg = encodeURIComponent(stateSvg);\n    var stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\n    var stateLabel = getStateLabel(state);\n    return '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n           '</span>';\n}\n\nfunction getStateSvg(state) {\n    switch (state) {\n        case 'in preparation':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/></svg>';\n        case 'active':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#f3de61\"/></svg>';\n        case 'finished':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#27AE60\"/></svg>';\n        case 'aborted':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"red\"/></svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"orange\"/></svg>';\n        case 'minor':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"yellow\"/></svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"green\"/></svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.93 16.73L16.07 2.59L17.49 4L3.34 18.14L1.93 16.73Z\" fill=\"#CAC1D2\"/>' +\n                   '</g>' +\n                   '<defs><clipPath id=\"clip0\"><rect width=\"20\" height=\"20\" fill=\"white\"/></clipPath></defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/></svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    return `{i18n:custom.diagnostics.measurement-details.state.${clientUtils.toKebabCase(state)}}`\n}\n\nvar measurementData = [];\n\nfunction buildMeasurementDropdown(measurements) {\n    measurementData = measurements;\n    \n    // Retrieve the current measurement's id from state params (if available)\n    var stateParams = ctx.stateController.getStateParams();\n    var currentMeasurementId = null;\n    if (stateParams && stateParams.selectedMeasurement) {\n        currentMeasurementId = stateParams.selectedMeasurement.entityId.id || stateParams.selectedMeasurement.entityId;\n    }\n    \n    // Filter and sort measurements\n    var sortedMeasurements = measurements\n        .filter(function(measurement) {\n            var mId = measurement.id.id || measurement.id;\n            return mId !== currentMeasurementId;\n        })\n        .sort(function(a, b) {\n            var aName = a.entityName || a.name || \"\";\n            var bName = b.entityName || b.name || \"\";\n            var aMatch = aName.match(/(\\d+)$/);\n            var bMatch = bName.match(/(\\d+)$/);\n            var aNum = aMatch ? parseInt(aMatch[1], 10) : 0;\n            var bNum = bMatch ? parseInt(bMatch[1], 10) : 0;\n            return aNum - bNum;\n        });\n    \n\n    var defaultTitle = (locationName && locationName !== 'N/A') ? locationName : \"Select Measurement\";\n    defaultTitle += \" \\u25BE\";\n    \n    var dropdownHtml = '<select id=\"measurement-dropdown\" ' +\n        'onfocus=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\" ' +\n        'onblur=\"this.style.outline=\\'none\\'; this.style.boxShadow=\\'none\\';\" ' +\n        'style=\"height: 40px; padding: 0 15px; font-size: 18px; font-weight: 500; ' +\n        'background-color: #E0E0E0; color: #28232D; margin-right: 10px; border: none; ' +\n        'border-radius: 4px; -webkit-appearance: none; appearance: none; ' +\n        'white-space: pre;\">';\n\n    dropdownHtml += '<option value=\"\" style=\"background-color: #f0f0f0; color: #28232D; ' +\n                    'font-size: 18px; font-weight: 400; white-space: pre;\" selected; padding-right: 20px;>' +\n                    defaultTitle + '</option>';\n    \n    // Helper: pad a string to a fixed length (by characters)\n    function padString(str, length) {\n        str = str || \"\";\n        if (str.length >= length) return str.substring(0, length);\n        return str + \" \".repeat(length - str.length);\n    }\n    \n    // Define fixed column widths (in number of characters)\n    var leftColumnWidth = 30;  // for locationName\n    var rightColumnWidth = 30; // for entityName\n    \n    // Build each option\n    sortedMeasurements.forEach(function(measurement) {\n        var mId = measurement.id.id || measurement.id;\n        var optionId = \"measurement-option-\" + mId;\n        dropdownHtml += '<option id=\"'+ optionId +'\" value=\"' + mId + '\" ' +\n            'style=\"background-color: #f0f0f0; color: #28232D; font-size: 18px; ' +\n            'font-weight: 400; white-space: pre; padding-right: 20px;\">' +\n            'Loading...' +\n            '</option>';\n        \n        // Fetch the locationName asynchronously\n        attributeService.getEntityAttributes(measurement.id, 'SERVER_SCOPE', ['locationName'])\n    .subscribe(\n        function(attributes) {\n            var locationAttr = attributes.find(attr => attr.key === 'locationName');\n            var locationDisplay = locationAttr ? locationAttr.value : \"N/A\";\n            var entityDisplay = measurement.entityName || measurement.name || mId;\n            // Pad both sides so that the divider always appears in the middle.\n            var leftText = padString(locationDisplay, leftColumnWidth);\n            var rightText = padString(entityDisplay, rightColumnWidth);\n            // Append non-breaking spaces for extra right-side padding.\n            var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\"; // Adjust count as needed\n            var displayText = leftText + \"  \" + rightText + trailingPadding;\n            var optionEl = document.getElementById(optionId);\n            if (optionEl) {\n                optionEl.innerHTML = displayText;\n            }\n        },\n        function(error) {\n            console.error(\"Error fetching locationName for measurement\", measurement, error);\n            var entityDisplay = measurement.entityName || measurement.name || mId;\n            var leftText = padString(\"N/A\", leftColumnWidth);\n            var rightText = padString(entityDisplay, rightColumnWidth);\n            var trailingPadding = \"\\u00A0\\u00A0\\u00A0\\u00A0\";\n            var optionEl = document.getElementById(optionId);\n            if (optionEl) {\n                optionEl.innerHTML = leftText + \"  \" + rightText + trailingPadding;\n            }\n        }\n    );\n\n    });\n    \n    dropdownHtml += '</select>';\n    return dropdownHtml;\n}\n\n\nfunction onMeasurementChange(selectedMeasurementId) {\n    if (!selectedMeasurementId) return;\n    \n    var selectedMeasurement = measurementData.find(function(m) {\n        var mId = m.id.id || m.id;\n        return mId === selectedMeasurementId;\n    });\n    \n    if (!selectedMeasurement) {\n        console.error(\"Measurement object not found for id:\", selectedMeasurementId);\n        return;\n    }\n\n    attributeService.getEntityAttributes(selectedMeasurement.id, 'SERVER_SCOPE', ['installationType', 'measurementType'])\n      .subscribe(\n          attributes => {\n\n              var installationTypeAttr = attributes.find(attr => attr.key === 'installationType');\n              var measurementTypeAttr = attributes.find(attr => attr.key === 'measurementType');\n              \n              var installationType = installationTypeAttr ? installationTypeAttr.value : null;\n              var measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\n              \n              var stateId;\n              if (measurementType === 'loraWan') {\n                  stateId = 'measurement_details';\n              } else if (measurementType === 'ultrasonic' && installationType === 'heating') {\n                  stateId = 'measurement_details_heating_full';\n              } else if (measurementType === 'ultrasonic' && installationType === 'cooling') {\n                  stateId = 'measurement_details_cooling_full';\n              } else {\n                  stateId = 'measurement_details_heating_full';\n              }\n\n              var updatedMeasurement = {\n                  entityId: {\n                      id: selectedMeasurement.id.id || selectedMeasurement.id,\n                      entityType: \"ASSET\"\n                  },\n                  entityName: selectedMeasurement.entityName || selectedMeasurement.name,\n                  entityLabel: selectedMeasurement.entityLabel || selectedMeasurement.label ||\n                               (selectedMeasurement.entityName || selectedMeasurement.name)\n              };\n\n              var params = ctx.stateController.getStateParams() || {};\n              params['selectedMeasurement'] = updatedMeasurement;\n              params['targetEntityParamName'] = \"selectedMeasurement\";\n              params['_ts'] = new Date().getTime();\n              \n              //console.log(\"Updating selectedMeasurement to:\", updatedMeasurement, params, \"using stateId:\", stateId);\n\n              ctx.stateController.updateState(stateId, params);\n          },\n          error => {\n              console.error(\"Error fetching attributes for measurement:\", error);\n          }\n      );\n}\n\n\n\n\n",
              "modules": {
                "clientUtils": "tb-resource;/api/resource/js_module/tenant/client-utils.js"
              }
            },
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".alarm-badge {\n    cursor: pointer;\n    border-radius: 22px;\n    padding: 8px 20px;\n    color: #fff;\n    font-size: 18px;\n    transition: background-color 0.5s;\n}\n\n.alarm-badge.critical {\n    background-color: #E64A19;\n}\n\n.alarm-badge.major {\n    background-color: #D4C21B;\n}\n\n.alarm-badge.critical:hover {\n    background-color: #a13d1e;\n}\n\n.alarm-badge.major:hover {\n    background-color: #b7a715;\n}\n\n.alarm-badge.inactive {\n    pointer-events: none;\n    color: #CAC1D2;\n    background-color: rgba(202, 193, 210, 0.05);\n    border: 1px solid rgba(202, 193, 210, 0.15);\n}\n\n.alarm-badge i.fa {\n    padding-right: 8px;\n}\n\n.alarm-badge .alarm-count {\n    font-weight: 700;    \n}\n\n\n.tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n/*.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} */\n\n.header {\n    height: 60px;                    /* Fixed height for medium screens */\n    display: flex;                   /* Use Flexbox for layout */\n    align-items: center;             /* Vertically center content */\n    justify-content: space-between;  /* Space items evenly horizontally */\n    padding: 0 20px;                 /* Horizontal padding only */\n    box-sizing: border-box;          /* Include padding in height */\n}\n\n/* Small screens: up to 600px wide */\n@media (max-width: 600px) {\n    .main-layout .header {\n        height: 50px;   /* Smaller height for small screens */\n        padding: 0 10px; /* Reduced horizontal padding */\n    }\n}\n\n/* Medium screens: 601px to 1024px */\n@media (min-width: 601px) and (max-width: 1024px) {\n    .main-layout .header {\n        height: 60px;    /* Default height */\n        padding: 0 15px; /* Adjust padding if needed */\n    }\n}\n\n/* Large screens: 1025px and above */\n@media (min-width: 1025px) {\n    .main-layout .header {\n        height: 70px;   /* Increased height for larger screens */\n        padding: 0 20px; /* Maintain horizontal padding */\n    }\n}\n\n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n.blurred {\n  filter: blur(20px); /* Adjust the pixel value to control the amount of blur */\n}\n\n/* Header-Anpassungen */\n\n.main-layout {\n    background-color: #eeeeee; /* Hintergrundfarbe des gesamten Layouts */\n    width: 100%; /* Volle Breite */\n    height: 100%; /* Volle Hhe */\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 5px 5px; /* Vergrerter Abstand zum rechten Rand durch margin-right */\n    border-radius: 8px; /* Ecken des Headers abgerundet */\n    background-color: #fff; /* Optional: Hintergrundfarbe fr besseren Effekt */\n    padding: 8px; /* Optional: Innenabstand fr den Header */\n}\n\n/* Kleinere Symbole und Schriftgre, um Platz in den Buttons zu sparen */\n#projects-button, #report-button, #reports-button, #admin-button, #parameter-button {\n    width: 110px; /* Feste Breite der Buttons */\n    height: 40px; /* Feste Hhe der Buttons */\n    padding-right: 15px; \n    font-size: 13px; /* Schriftgre */\n    background-color: var(--tb-accent-500); /* Setzt die Hintergrundfarbe der Buttons */\n    color: white; /* Setzt die Schriftfarbe auf wei */\n    display: flex; /* Flexbox Layout fr bessere Kontrolle ber Inhalt */\n    align-items: center; /* Vertikale Zentrierung von Text und Icon */\n    justify-content: center; /* Horizontale Zentrierung von Text und Icon */\n    gap: 2px; /* Abstand zwischen dem Icon und dem Text */\n    margin-right: 10px; /* Abstand zum rechten Rand fr jeden Button */\n}\n\n#admin-button  {\n    background-color: red; /* Setzt die Hintergrundfarbe der Buttons */\n}\n\n/* Optional: Anpassung des Hover-Effekts */\n#projects-button:hover, #report-button:hover, #reports-button:hover, #admin-button:hover, #parameter-button:hover  {\n    background-color: var(--tb-accent-400); /* ndert die Hintergrundfarbe beim Hover */\n}\n\n/* Kleinere Symbole */\n#projects-button mat-icon, #report-button mat-icon, #reports-button mat-icon, #admin-button mat-icon, #parameter-button mat-icon {\n    font-size: 15px; /* Kleinere Symbolgre */\n    color: white; /* Setzt die Symbolfarbe auf wei */\n}\n\n/* ndert die Schriftfarbe nur fr #projects-button und #report-button */\n#projects-button span, #report-button span, #reports-button span, #admin-button span, #parameter-button span {\n    color: white; /* Setzt die Textfarbe auf wei */\n}\n.tb-markdown-view .params {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n    padding: 16px;\n    margin-bottom: 20px;\n}\n\n.tb-markdown-view .param-title {\n    font-size: 12px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.tb-markdown-view .param {\n    font-size: 12px;\n    font-weight: 500;\n    color: #212121;\n    line-height: 24px;\n    height: 24px;\n}\n\n.tb-markdown-view .param img.mat-icon {\n    vertical-align: bottom;\n}\n\n.tb-markdown-view .param #battery-level {\n    width: 24px;\n    height: 24px;\n    line-height: 24px;\n    padding: 2px;\n    min-width: 28px;\n    vertical-align: baseline;\n    display: inline-block;\n}\n\n.tb-markdown-view .param #battery-level .mat-mdc-button-touch-target {\n    height: 24px;\n}\n\n.tb-markdown-view .param #battery-level .mat-icon {\n    width: 24px;\n    height: 24px;\n    font-size: 24px;\n    margin: 0;    \n}\n\n"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "/*var params = widgetContext.stateController.getStateParams();\nwidgetContext.stateController.navigatePrevState(1);*/\n\nvar params = widgetContext.stateController.getStateParams();\nvar number = (widgetContext.stateController.getStateIndex())-1;\n\nparams['selectedMeasurement'] = null; //selectedLocation ersetzen mit passenden Parameter bei bedarf kann man mehrere params auf null setzten\nwidgetContext.stateController.updateState(null,params);\nwidgetContext.stateController.navigatePrevState(number);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "3f322658-688d-b138-be7f-b846ca2c2313"
              },
              {
                "name": "report-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_analysis_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f1807fda-9479-4263-5a80-c095fd0d80b8"
              },
              {
                "name": "data-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": "measurement_details_heating_full",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2d12f301-19ff-c8e2-637c-9b907e2c20ef"
              },
              {
                "name": "parameter-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form [formGroup]=\"addDeviceFormGroup\" (ngSubmit)=\"save()\" class=\"add-entity-form\">\r\n  <mat-toolbar fxLayout=\"row\" color=\"primary\">\r\n    <h2>Edit Measurement Parameters</h2>\r\n    <span fxFlex></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\"></mat-progress-bar>\r\n\r\n  <div mat-dialog-content fxLayout=\"column\">\r\n    <mat-horizontal-stepper formGroupName=\"stepper\" linear>\r\n\r\n      <mat-step formGroupName=\"assignmentStep\" label=\"Assignment\">\r\n        <ng-template matStepLabel>Assignment</ng-template>\r\n\r\n       <mat-form-field appearance=\"fill\" floatLabel=\"always\" class=\"mat-block\">\r\n  <mat-label>Assigned Devices</mat-label>\r\n  \r\n  <!-- Conditionally apply 'margin-top' and 'gap' only when assignedDevices exist -->\r\n  <mat-chip-grid\r\n  #chipList\r\n  aria-label=\"Assigned Devices\"\r\n  [ngStyle]=\"{\r\n    'display': 'flex',\r\n    'flex-wrap': 'wrap',\r\n    'gap': assignedDevices?.length ? '8px' : '0px',\r\n    'margin-top': assignedDevices?.length ? '8px' : '0px'\r\n  }\"\r\n>\r\n  <mat-chip-row\r\n    *ngFor=\"let dev of assignedDevices\"\r\n    color=\"primary\"\r\n    selected=\"true\"\r\n    disableRipple\r\n  >\r\n    {{ dev.name }}\r\n  </mat-chip-row>\r\n</mat-chip-grid>\r\n\r\n<input\r\n  matInput\r\n  [matChipInputFor]=\"chipList\"\r\n  readonly\r\n  [placeholder]=\"assignedDevices?.length ? '' : 'No devices assigned!'\"\r\n/>\r\n\r\n\r\n  <mat-error *ngIf=\"!assignedDevices?.length\">\r\n    No devices assigned!\r\n  </mat-error>\r\n</mat-form-field>\r\n\r\n\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>Progress</mat-label>\r\n          <mat-select formControlName=\"progress\">\r\n            <mat-option value=\"in preparation\">In Preparation</mat-option>\r\n            <mat-option value=\"active\">Active</mat-option>\r\n            <mat-option value=\"finished\">Finished</mat-option>\r\n            <mat-option value=\"aborted\">Aborted</mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>Start Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"startTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <section fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"16px\" style=\"width: 100%;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Date</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endDatePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endDate\" [matDatetimepicker]=\"endDatePicker\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n            <mat-label>End Time</mat-label>\r\n            <mat-datetimepicker-toggle [for]=\"endTimePicker\" matPrefix></mat-datetimepicker-toggle>\r\n            <mat-datetimepicker #endTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\r\n            <input matInput formControlName=\"endTime\" [matDatetimepicker]=\"endTimePicker\">\r\n          </mat-form-field>\r\n        </section>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button\r\n            mat-button\r\n            matStepperNext\r\n            color=\"primary\"\r\n            type=\"button\"\r\n            *ngIf=\"showAttributesStep\"\r\n            [disabled]=\"!assignedDevicesAvailable\"\r\n          >\r\n            Next\r\n          </button>\r\n           <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\" *ngIf=\"!showAttributesStep\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <mat-step formGroupName=\"attributesStep\" label=\"Attributes\" *ngIf=\"showAttributesStep\">\r\n        <ng-template matStepLabel>Default Parameters</ng-template>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Dimension</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Dimension</mat-label>\r\n              <mat-select formControlName=\"dimension\" required>\r\n                <mat-option *ngFor=\"let dimension of dimensionOptions\" [value]=\"dimension\">\r\n                  {{ dimension }}\r\n                </mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.dimension').hasError('required')\">\r\n                Dimension is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Nominal Flow (m/hr)</mat-label>\r\n              <input matInput formControlName=\"nominalFlow\" type=\"number\" readonly>\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Floor Volume (m/hr)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisFloorVolume\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Pump Power (W)</mat-label>\r\n              <input matInput formControlName=\"deltaTAnalysisPumpEnergy\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Installation</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type</mat-label>\r\n              <mat-select formControlName=\"installationType\" required>\r\n                <mat-option value=\"heating\">Heating</mat-option>\r\n                <mat-option value=\"cooling\">Cooling</mat-option>\r\n              </mat-select>\r\n              <mat-error *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').hasError('required')\">\r\n                Installation Type is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Installation Type Options</mat-label>\r\n              <mat-select formControlName=\"installationTypeOptions\" required>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'heating'\">\r\n                  <mat-option value=\"radiatorHeating\">Radiator Heating</mat-option>\r\n                  <mat-option value=\"floorHeating\">Floor Heating</mat-option>\r\n                  <mat-option value=\"districtHeating\">District Heating</mat-option>\r\n                  <mat-option value=\"heatingOther\">Heating Other</mat-option>\r\n                </ng-container>\r\n                <ng-container *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationType').value === 'cooling'\">\r\n                  <mat-option value=\"coolingCircuit\">Cooling Circuit</mat-option>\r\n                  <mat-option value=\"coolingCeiling\">Cooling Ceiling</mat-option>\r\n                  <mat-option value=\"chiller\">Chiller</mat-option>\r\n                  <mat-option value=\"coolingOther\">Cooling Other</mat-option>\r\n                </ng-container>\r\n              </mat-select>\r\n              <mat-error\r\n                *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').hasError('required')\"\r\n              >\r\n                Installation Type Option is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Analysis</legend>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Standard Outdoor Temperature</mat-label>\r\n              <input matInput formControlName=\"standardOutdoorTemperature\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Delta T</mat-label>\r\n              <input matInput formControlName=\"deltaT\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold Setting</mat-label>\r\n              <mat-select formControlName=\"loadCourseFilterTemperature\" required>\r\n                <mat-option value=\"above\">Above</mat-option>\r\n                <mat-option value=\"below\">Below</mat-option>\r\n              </mat-select>\r\n              <mat-error\r\n                *ngIf=\"addDeviceFormGroup.get('stepper.attributesStep.loadCourseFilterTemperature').hasError('required')\"\r\n              >\r\n                Temperature Condition is required.\r\n              </mat-error>\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Outside Temperature Threshold</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterTemperatureValue\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" fxFlex>\r\n              <mat-label>Maximum Power Threshold (%)</mat-label>\r\n              <input matInput formControlName=\"loadCourseFilterMaxPower\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxLayout=\"row\" fxLayoutGap=\"10px\">\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Area</mat-label>\r\n              <input matInput formControlName=\"area\" type=\"number\">\r\n            </mat-form-field>\r\n            <mat-form-field class=\"mat-block\" style=\"width:50%\">\r\n              <mat-label>Unit</mat-label>\r\n              <input matInput formControlName=\"unit\" type=\"text\">\r\n            </mat-form-field>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <fieldset class=\"fieldset\">\r\n          <legend>Weekly Operating Schedule</legend>\r\n          <div\r\n            formGroupName=\"weeklyOperatingSchedule\"\r\n            fxLayout=\"row\"\r\n            fxLayoutGap=\"6px\"\r\n            fxLayoutAlign=\"space-between center\"\r\n          >\r\n            <mat-checkbox formControlName=\"monday\">Mon</mat-checkbox>\r\n            <mat-checkbox formControlName=\"tuesday\">Tue</mat-checkbox>\r\n            <mat-checkbox formControlName=\"wednesday\">Wed</mat-checkbox>\r\n            <mat-checkbox formControlName=\"thursday\">Thu</mat-checkbox>\r\n            <mat-checkbox formControlName=\"friday\">Fri</mat-checkbox>\r\n            <mat-checkbox formControlName=\"saturday\">Sat</mat-checkbox>\r\n            <mat-checkbox formControlName=\"sunday\">Sun</mat-checkbox>\r\n          </div>\r\n        </fieldset>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <!--<button mat-button matStepperNext color=\"primary\" type=\"button\">\r\n            Next\r\n          </button>-->\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.pristine || addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>\r\n\r\n      <!-- Alarm Thresholds Step -->\r\n      <!--<mat-step formGroupName=\"alarmThresholdsStep\" label=\"Alarm Thresholds\" *ngIf=\"showAlarmThresholdsStep\">\r\n        <ng-template matStepLabel>Alarm Thresholds</ng-template>\r\n\r\n        <div fxLayout=\"row\" fxLayoutGap=\"24px\">\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High CO2 Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"highCo2CriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Temperature Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"highTemperatureCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Humidity Critical Threshold</mat-label>\r\n              <input matInput formControlName=\"highHumidityCriticalThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n          <div fxFlex=\"50%\">\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Volume Flow Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxVolumeFlowMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Max Energy Major Threshold</mat-label>\r\n              <input matInput formControlName=\"maxEnergyMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>Min Temperature Difference Major Threshold</mat-label>\r\n              <input matInput formControlName=\"minTemperatureDifferenceMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High CO2 Major Threshold</mat-label>\r\n              <input matInput formControlName=\"highCo2MajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Temperature Major Threshold</mat-label>\r\n              <input matInput formControlName=\"highTemperatureMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n\r\n            <mat-form-field class=\"mat-block\">\r\n              <mat-label>High Humidity Major Threshold</mat-label>\r\n              <input matInput formControlName=\"highHumidityMajorThreshold\" type=\"number\">\r\n            </mat-form-field>\r\n          </div>\r\n        </div>\r\n\r\n        <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\r\n          <button mat-button color=\"primary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\r\n          <button mat-button matStepperPrevious color=\"primary\" type=\"button\">Back</button>\r\n          <button mat-button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"addDeviceFormGroup.invalid\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </mat-step>-->\r\n\r\n    </mat-horizontal-stepper>\r\n  </div>\r\n</form>\r\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\r\nconst {\r\n    customDialog,\r\n    entityService,\r\n    deviceService,\r\n    entityGroupService,\r\n    attributeService,\r\n    entityRelationService,\r\n    assetService,\r\n} = [\r\n    'customDialog',\r\n    'entityService',\r\n    'deviceService',\r\n    'entityGroupService',\r\n    'attributeService',\r\n    'entityRelationService',\r\n    'assetService'\r\n].reduce((services, name) => {\r\n    services[name] = $injector.get(widgetContext.servicesMap.get(name));\r\n    return services;\r\n}, {});\r\n\r\nconst measurementId = entityId;\r\n\r\nif (!measurementId || !measurementId.id) {\r\n    console.error(\"Invalid measurementId:\", measurementId);\r\n} else {\r\n    fetchAssignedDevices(measurementId.id);\r\n}\r\n\r\nfunction fetchAssignedDevices(measurementId) {\r\n    const deviceSearchQuery = {\r\n        parameters: {\r\n            rootId: measurementId,\r\n            rootType: \"ASSET\",\r\n            direction: \"FROM\",\r\n            relationTypeGroup: \"COMMON\",\r\n            maxLevel: 100,\r\n            fetchLastLevelOnly: false,\r\n        },\r\n        relationType: \"Measurement\",\r\n        deviceTypes: [\"P-Flow D116\", \"Room Sensor CO2\"],\r\n    };\r\n\r\n    deviceService.findByQuery(deviceSearchQuery).subscribe(\r\n        (devices) => {\r\n            fetchAttributes(devices);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching devices:\", error);\r\n            fetchAttributes([]);\r\n        }\r\n    );\r\n}\r\n\r\nfunction fetchAttributes(assignedDevices) {\r\n    attributeService.getEntityAttributes(measurementId).subscribe(\r\n        (attributes) => {\r\n            openAddDeviceDialog(assignedDevices, attributes);\r\n        },\r\n        (error) => {\r\n            console.error(\"Error while fetching attributes:\", error);\r\n            openAddDeviceDialog(assignedDevices, []);\r\n        }\r\n    );\r\n}\r\n\r\nfunction openAddDeviceDialog(assignedDevices, attributes) {\r\n    customDialog.customDialog(htmlTemplate, AddDeviceDialogController, {\r\n        measurementId,\r\n        assignedDevices,\r\n        attributes,\r\n    }).subscribe();\r\n}\r\n\r\nfunction AddDeviceDialogController(instance) {\r\n    const vm = instance;\r\n    // const measurementType = vm.data.attributes[0].value;\r\n    const measurementTypeAttr = vm.data.attributes.find(attr => attr.key === 'measurementType');\r\n    const measurementType = measurementTypeAttr ? measurementTypeAttr.value : null;\r\n\r\n    const {\r\n        measurementId,\r\n        assignedDevices = [],\r\n        attributes = [],\r\n    } = vm.data || {};\r\n\r\n    vm.measurementId = measurementId;\r\n    vm.attributes = attributes;\r\n\r\n    vm.assignedDevices = assignedDevices;\r\n    vm.assignedDevicesAvailable = assignedDevices.length > 0;\r\n\r\n    vm.showAttributesStep = vm.assignedDevicesAvailable && (measurementType === 'ultrasonic');\r\n    /*vm.showAlarmThresholdsStep = vm.assignedDevicesAvailable;*/\r\n\r\n\r\n\r\n    vm.weekDays = [\r\n        { key: 'monday', label: 'Monday' },\r\n        { key: 'tuesday', label: 'Tuesday' },\r\n        { key: 'wednesday', label: 'Wednesday' },\r\n        { key: 'thursday', label: 'Thursday' },\r\n        { key: 'friday', label: 'Friday' },\r\n        { key: 'saturday', label: 'Saturday' },\r\n        { key: 'sunday', label: 'Sunday' },\r\n    ];\r\n    vm.heatingOptions = ['radiatorHeating', 'floorHeating', 'districtHeating', 'heatingOther'];\r\n    vm.coolingOptions = ['coolingCircuit', 'coolingCeiling', 'chiller', 'coolingOther'];\r\n    vm.dimensionOptions = ['DN15', 'DN20', 'DN25', 'DN32', 'DN40', 'DN50', 'DN65', 'DN80', 'DN100', 'DN125', 'DN150'];\r\n\r\n    vm.addDeviceFormGroup = vm.fb.group({\r\n        stepper: vm.fb.group({\r\n            assignmentStep: vm.fb.group({\r\n                progress: [{ value: 'in preparation', disabled: !vm.assignedDevicesAvailable }, [vm.validators.required]],\r\n                startDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                startTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endDate: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n                endTime: [{ value: null, disabled: !vm.assignedDevicesAvailable }],\r\n            }),\r\n            attributesStep: vm.fb.group({\r\n                installationType: [null, [vm.validators.required]],\r\n                installationTypeOptions: ['', [vm.validators.required]],\r\n                standardOutdoorTemperature: [null],\r\n                loadCourseAnalysisTemperature: [null],\r\n                loadCourseFilterTemperature: [null, [vm.validators.required]],\r\n                loadCourseFilterTemperatureValue: [null],\r\n                loadCourseFilterMaxPower: [null],\r\n                nominalFlow: [null],\r\n                deltaT: [null],\r\n                deltaTAnalysisPumpEnergy: [null],\r\n                deltaTAnalysisFloorVolume: [null],\r\n                dimension: [null],\r\n                area: [null],\r\n                unit: [null],\r\n                weeklyOperatingSchedule: vm.fb.group(\r\n                    vm.weekDays.reduce((acc, day) => {\r\n                        acc[day.key] = [false];\r\n                        return acc;\r\n                    }, {})\r\n                ),\r\n            }),\r\n            /*alarmThresholdsStep: vm.fb.group({\r\n                maxVolumeFlowCriticalThreshold: [null],\r\n                maxVolumeFlowMajorThreshold: [null],\r\n                maxEnergyCriticalThreshold: [null],\r\n                maxEnergyMajorThreshold: [null],\r\n                minTemperatureDifferenceCriticalThreshold: [null],\r\n                minTemperatureDifferenceMajorThreshold: [null],\r\n                highCo2CriticalThreshold: [null],\r\n                highCo2MajorThreshold: [null],\r\n                highTemperatureCriticalThreshold: [null],\r\n                highHumidityCriticalThreshold: [null],\r\n                highTemperatureMajorThreshold: [null],\r\n                highHumidityMajorThreshold: [null],\r\n            }),*/\r\n        }),\r\n    });\r\n\r\n    initializeFormValues();\r\n    setupFormSubscriptions();\r\n\r\n    function initializeFormValues() {\r\n        // Map known attribute keys to form controls\r\n        const attributeToFormControlMap = {\r\n            'installationType': 'installationType',\r\n            'installationTypeOptions': 'installationTypeOptions',\r\n            'loadCourseFilterTemperature': 'loadCourseFilterTemperature',\r\n            'loadCourseFilterTemperatureValue': 'loadCourseFilterTemperatureValue',\r\n            'dimension': 'dimension',\r\n            'nominalFlow': 'nominalFlow',\r\n            'pumpPower': 'deltaTAnalysisPumpEnergy',\r\n            'standardOutsideTemperature': 'standardOutdoorTemperature',\r\n            'loadCourseFilterMaxPower': 'loadCourseFilterMaxPower',\r\n            'deltaT': 'deltaT',\r\n            'deltaTAnalysisFloorVolume': 'deltaTAnalysisFloorVolume',\r\n            'loadCourseAnalysisTemperature': 'loadCourseAnalysisTemperature',\r\n            'progress': 'progress',\r\n        };\r\n\r\n        attributes.forEach((attr) => {\r\n            const formControlName = attributeToFormControlMap[attr.key];\r\n            if (formControlName) {\r\n                // If it's 'progress', put in assignmentStep; else in attributesStep\r\n                const stepGroup =\r\n                    (formControlName === 'progress')\r\n                        ? 'assignmentStep'\r\n                        : 'attributesStep';\r\n\r\n                vm.addDeviceFormGroup\r\n                  .get(`stepper.${stepGroup}.${formControlName}`)\r\n                  .setValue(attr.value);\r\n            }\r\n            // Start/end times\r\n            else if (attr.key === 'startTimeMs' || attr.key === 'endTimeMs') {\r\n                if (attr.value) {\r\n                    const dateTime = new Date(Number(attr.value));\r\n                    const dateControlName = (attr.key === 'startTimeMs') ? 'startDate' : 'endDate';\r\n                    const timeControlName = (attr.key === 'startTimeMs') ? 'startTime' : 'endTime';\r\n\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${dateControlName}`).setValue(dateTime);\r\n                    vm.addDeviceFormGroup.get(`stepper.assignmentStep.${timeControlName}`).setValue(dateTime);\r\n                }\r\n            }\r\n            // Weekly schedule\r\n            else if (attr.key === 'weeklySchedule') {\r\n                if (attr.value) {\r\n                    Object.keys(attr.value).forEach((day) => {\r\n                        vm.addDeviceFormGroup\r\n                            .get(`stepper.attributesStep.weeklyOperatingSchedule.${day}`)\r\n                            .setValue(attr.value[day]);\r\n                    });\r\n                }\r\n            }\r\n            // If you had existing alarm threshold attributes, you could map them similarly\r\n            // e.g. if there's an attr.key === 'maxVolumeFlowCriticalThreshold', etc.\r\n        });\r\n\r\n        updateProgressControl();\r\n    }\r\n\r\n    let lastProgressValue = null;\r\n\r\n    function setupFormSubscriptions() {\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationType')\r\n            .valueChanges.subscribe(() => {\r\n                updateInstallationTypeOptions();\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.installationTypeOptions')\r\n            .valueChanges.subscribe((val) => {\r\n                setDefaultDeltaT(val);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.dimension')\r\n            .valueChanges.subscribe((dimension) => {\r\n                const nominalFlow = getNominalFlowByDimension(dimension);\r\n                vm.addDeviceFormGroup\r\n                    .get('stepper.attributesStep.nominalFlow')\r\n                    .setValue(nominalFlow);\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.nominalFlow')\r\n            .valueChanges.subscribe((val) => {\r\n                if (val) {\r\n                    // Example: floorVolume is 2% of nominalFlow\r\n                    const floorVal = (val * 0.02).toFixed(3);\r\n                    vm.addDeviceFormGroup\r\n                        .get('stepper.attributesStep.deltaTAnalysisFloorVolume')\r\n                        .setValue(floorVal);\r\n                }\r\n            });\r\n\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.assignmentStep.progress')\r\n            .valueChanges.subscribe((newValue) => {\r\n                if (newValue !== lastProgressValue) {\r\n                    lastProgressValue = newValue;\r\n                    updateProgressControl();\r\n                }\r\n            });\r\n    }\r\n\r\n    function updateProgressControl() {\r\n        const progressControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.progress');\r\n        const startDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startDate');\r\n        const startTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.startTime');\r\n        const endDateControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endDate');\r\n        const endTimeControl = vm.addDeviceFormGroup.get('stepper.assignmentStep.endTime');\r\n            \r\n    if (!vm.showAttributesStep) {\r\n          // For the entire step:\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').disable();\r\n          // or remove required validators from each control\r\n        } else {\r\n          vm.addDeviceFormGroup.get('stepper.attributesStep').enable();\r\n        }\r\n\r\n        if (!vm.assignedDevicesAvailable) {\r\n            progressControl.disable();\r\n            startDateControl.disable();\r\n            startTimeControl.disable();\r\n            endDateControl.disable();\r\n            endTimeControl.disable();\r\n        } else {\r\n            progressControl.enable();\r\n            startDateControl.enable();\r\n            startTimeControl.enable();\r\n            endDateControl.enable();\r\n            endTimeControl.enable();\r\n        }\r\n\r\n        // If progress is active but no start time set, auto-set to now\r\n        if (progressControl.value === 'active' && !startDateControl.value && !startTimeControl.value) {\r\n            const now = new Date();\r\n            startDateControl.setValue(now);\r\n            startTimeControl.setValue(now);\r\n        }\r\n        // If progress is finished/aborted but no end time set (and we have a start), auto-set end to now\r\n        else if (\r\n            (progressControl.value === 'finished' || progressControl.value === 'aborted') &&\r\n            startDateControl.value && startTimeControl.value &&\r\n            !endDateControl.value && !endTimeControl.value\r\n        ) {\r\n            const now = new Date();\r\n            endDateControl.setValue(now);\r\n            endTimeControl.setValue(now);\r\n        }\r\n    }\r\n\r\n    function updateInstallationTypeOptions() {\r\n        const installationType = vm.addDeviceFormGroup.get('stepper.attributesStep.installationType').value;\r\n        let options = [];\r\n        if (installationType === 'heating') {\r\n            options = vm.heatingOptions;\r\n        } else if (installationType === 'cooling') {\r\n            options = vm.coolingOptions;\r\n        }\r\n        vm.filteredInstallationTypeOptions = options;\r\n        \r\n        // Only clear if the current value isn't one of the valid options\r\n        const currentOption = vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').value;\r\n        if (!options.includes(currentOption)) {\r\n             vm.addDeviceFormGroup.get('stepper.attributesStep.installationTypeOptions').setValue('');\r\n        }\r\n    }\r\n\r\n    function setDefaultDeltaT(installationTypeOptions) {\r\n        const deltaTValues = {\r\n            coolingCircuit: 6,\r\n            coolingCeiling: 3,\r\n            chiller: 6,\r\n            coolingOther: null,\r\n            radiatorHeating: 15,\r\n            floorHeating: 5,\r\n            districtHeating: 25,\r\n            heatingOther: null,\r\n        };\r\n        const defaultDelta = deltaTValues[installationTypeOptions] || null;\r\n        vm.addDeviceFormGroup\r\n            .get('stepper.attributesStep.deltaT')\r\n            .setValue(defaultDelta);\r\n    }\r\n\r\n    function getNominalFlowByDimension(dimension) {\r\n        const dimensionToNominalFlow = {\r\n            DN15: 1.5,\r\n            DN20: 2.5,\r\n            DN25: 3.5,\r\n            DN32: 6,\r\n            DN40: 10,\r\n            DN50: 15,\r\n            DN65: 28.8,\r\n            DN80: 39.6,\r\n            DN100: 72,\r\n            DN125: 111.6,\r\n            DN150: 162,\r\n        };\r\n        return dimensionToNominalFlow[dimension] || null;\r\n    }\r\n\r\n    function parseDateTime(dateObj, timeObj) {\r\n        if (!dateObj || !timeObj) return null;\r\n        const date = new Date(dateObj);\r\n        const time = new Date(timeObj);\r\n        date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\r\n        return date;\r\n    }\r\n\r\n    vm.cancel = function () {\r\n        vm.dialogRef.close(null);\r\n    };\r\n\r\n    vm.save = function () {\r\n        if (vm.addDeviceFormGroup.invalid) {\r\n            return;\r\n        }\r\n\r\n        const formData = vm.addDeviceFormGroup.value;\r\n        const assignmentStep = formData.stepper.assignmentStep;\r\n        const attributesStep = formData.stepper.attributesStep;\r\n/*        const alarmThresholdsStep = formData.stepper.alarmThresholdsStep;*/\r\n\r\n        // Convert date/time to epoch\r\n        const startDateTime = parseDateTime(assignmentStep.startDate, assignmentStep.startTime);\r\n        const endDateTime = parseDateTime(assignmentStep.endDate, assignmentStep.endTime);\r\n\r\n        const attributesArray = [\r\n            { key: 'xPos', value: 0.5 },\r\n            { key: 'yPos', value: 0.5 },\r\n            { key: 'installationType', value: attributesStep.installationType },\r\n            { key: 'installationTypeOptions', value: attributesStep.installationTypeOptions },\r\n            { key: 'progress', value: assignmentStep.progress },\r\n            { key: 'startTimeMs', value: startDateTime ? startDateTime.getTime() : null },\r\n            { key: 'endTimeMs', value: endDateTime ? endDateTime.getTime() : null },\r\n            { key: 'loadCourseAnalysisTemperature', value: attributesStep.loadCourseAnalysisTemperature },\r\n            { key: 'loadCourseFilterTemperature', value: attributesStep.loadCourseFilterTemperature },\r\n            { key: 'loadCourseFilterTemperatureValue', value: attributesStep.loadCourseFilterTemperatureValue },\r\n            { key: 'loadCourseFilterMaxPower', value: attributesStep.loadCourseFilterMaxPower },\r\n            {\r\n                key: 'area',\r\n                value: {\r\n                    value: attributesStep.area,\r\n                    unit: attributesStep.unit\r\n                }\r\n            },\r\n            { key: 'nominalFlow', value: attributesStep.nominalFlow },\r\n            { key: 'dimension', value: attributesStep.dimension },\r\n            { key: 'weeklySchedule', value: attributesStep.weeklyOperatingSchedule },\r\n            { key: 'deltaT', value: attributesStep.deltaT },\r\n            { key: 'deltaTAnalysisPumpEnergy', value: attributesStep.deltaTAnalysisPumpEnergy },\r\n            { key: 'deltaTAnalysisFloorVolume', value: attributesStep.deltaTAnalysisFloorVolume },\r\n\r\n            /*{ key: 'maxVolumeFlowCriticalThreshold', value: alarmThresholdsStep.maxVolumeFlowCriticalThreshold },\r\n            { key: 'maxVolumeFlowMajorThreshold', value: alarmThresholdsStep.maxVolumeFlowMajorThreshold },\r\n            { key: 'maxEnergyCriticalThreshold', value: alarmThresholdsStep.maxEnergyCriticalThreshold },\r\n            { key: 'maxEnergyMajorThreshold', value: alarmThresholdsStep.maxEnergyMajorThreshold },\r\n            { key: 'minTemperatureDifferenceCriticalThreshold', value: alarmThresholdsStep.minTemperatureDifferenceCriticalThreshold },\r\n            { key: 'minTemperatureDifferenceMajorThreshold', value: alarmThresholdsStep.minTemperatureDifferenceMajorThreshold },\r\n            { key: 'highCo2CriticalThreshold', value: alarmThresholdsStep.highCo2CriticalThreshold },\r\n            { key: 'highCo2MajorThreshold', value: alarmThresholdsStep.highCo2MajorThreshold },\r\n            { key: 'highTemperatureCriticalThreshold', value: alarmThresholdsStep.highTemperatureCriticalThreshold },\r\n            { key: 'highHumidityCriticalThreshold', value: alarmThresholdsStep.highHumidityCriticalThreshold },\r\n            { key: 'highTemperatureMajorThreshold', value: alarmThresholdsStep.highTemperatureMajorThreshold },\r\n            { key: 'highHumidityMajorThreshold', value: alarmThresholdsStep.highHumidityMajorThreshold },*/\r\n        ];\r\n\r\n        attributeService.saveEntityAttributes(vm.measurementId, \"SERVER_SCOPE\", attributesArray).subscribe(\r\n            () => {\r\n                // Save successful\r\n                widgetContext.updateAliases();\r\n                vm.dialogRef.close(null);\r\n            },\r\n            (error) => {\r\n                console.error(\"Error while saving attributes:\", error);\r\n            }\r\n        );\r\n    };\r\n}\r\n\r\n\r\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e8852d30-1382-e3f8-bb34-c16eaff29874"
              },
              {
                "name": "projects-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "projects",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0b68edbf-1d37-5555-d7d6-527e1a5f963b"
              },
              {
                "name": "admin-button",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": "",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "27a13540-f6e7-11f0-9979-9f3434877bb4",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e63ea2ea-53c8-1e57-c98b-a33fc883593f"
              }
            ]
          },
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "39587e2b-40bb-0159-51d2-b73048880da1"
      },
      "2c00789b-b7c4-ccf2-39a8-ee138226f777": {
        "typeFullFqn": "system.cards.markdown_card",
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8902879312951573
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1730110460337,
                "endTimeMs": 1730196860337
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "### Markdown/HTML card\n - **Current entity**: ${entityName}.\n - **Current value**: ${Random}.",
            "markdownTextFunction": "var DeviceState;\r\nvar profile;\r\n//console.log(data);\r\nif (data && data.length && data[0]['entityId']) {\r\n    profile = data[0].deviceType;\r\n    //console.log(profile);\r\n    DeviceState = true;\r\n} else {\r\n    DeviceState = false;\r\n}\r\n\r\n// Determine which stateId to use based on the profile\r\nvar stateId;\r\n\r\nif (profile === 'Room Sensor CO2') {\r\n    stateId = 'sensor_charts_co2';\r\n} else if (profile === 'Room Sensor T' || profile === 'Temperature Sensor') {\r\n    stateId = 'sensor_charts_t';\r\n} else {\r\n    stateId = 'sensor_charts_t'; // Default stateId if DeviceState is false\r\n}\r\n\r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n       (DeviceState \r\n         ? '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"' + stateId + '\"></tb-dashboard-state>' \r\n         : '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"sensor_charts_co2\"></tb-dashboard-state>') +\r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 100px;\n    margin: 6px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n\n.main-layout .tb-mat-20 {\n    width: 1px;\n    height: 2px;\n    margin: 2px;\n}"
          },
          "title": "Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "2c00789b-b7c4-ccf2-39a8-ee138226f777"
      },
      "b2beb7ce-103a-560f-cf9c-b7df21827bf0": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8853142583803868
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.8167362021349891
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "",
          "settings": {
            "useMarkdownTextFunction": true,
            "markdownTextPattern": "<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">\n    <section *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex fxLayout=\"column\">\n\t<h5 class=\"market-title\">{{ ctx.stateController.getStateParams().selectedDoktorkit.entityName }}</h5>\n\t<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_card\"></tb-dashboard-state>\n    </section>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" stateId=\"Doktorkits_card\"></tb-dashboard-state>\n    <mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>\n    <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Doktorkit_alarms\"></tb-dashboard-state>\n    <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedDoktorkit\" fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"false\" stateId=\"Doktorkits_alarms\"></tb-dashboard-state>\n</div>",
            "markdownTextFunction": "var projectState = ctx.stateController.getStateParams().selectedProject ? true : false;\r\n\r\nvar stateParams = ctx.stateController.getStateParams();\r\n\r\nctx.stateController.updateState(null, stateParams);\r\n\r\nvar newDashboardtimewindow = {\r\n    aggregation: {\r\n        limit: 50000,\r\n        type: \"NONE\"\r\n    },\r\n    hideAggInterval: true,\r\n    hideAggregation: true,\r\n    hideInterval: false,\r\n    history: {\r\n        historyType: 1,\r\n        fixedTimewindow: {\r\n            startTimeMs: Date.now() - 1209600000, // now - 2 weeks\r\n            endTimeMs: Date.now()\r\n        }\r\n    },\r\n    selectedTab: 1\r\n};\r\n\r\nvar userRole = data[0].role;\r\n\r\nvar stateParams = ctx.stateController.getStateParams();\r\nvar currentUser = ctx.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator';\r\nstateParams[\"userRole\"] = userRole;\r\n/*console.log(\"par:\", stateParams);*/\r\n\r\nctx.dashboard.dashboardTimewindowChangedSubject.next(newDashboardtimewindow);\r\nctx.stateController.updateState(null, stateParams);\r\n\r\nvar typeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M160-80q-33 0-56.5-23.5T80-160v-480q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v480q0 33-23.5 56.5T800-80H160Zm240-640h160v-80H400v80Zm40 360v120h80v-120h120v-80H520v-120h-80v120H320v80h120Z\"/></svg>';\r\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\r\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\r\n\r\nreturn '<div class=\"main-layout\" style=\"width: 100%; height: 100%;\" fxLayout=\"column\">' +\r\n          (projectState \r\n            ? ( '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"Measurements_card\"></tb-dashboard-state>' )\r\n            : ( '<tb-dashboard-state fxFlex [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"all_projects\"></tb-dashboard-state>' )) + \r\n       '</div>';\r\n",
            "applyDefaultMarkdownStyle": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget {\n    border-radius: 0px;\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow.no-padding {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 4px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "{i18n:action.go-back}",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedMeasurement'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              }
            ]
          },
          "pageSize": 1024,
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "borderRadius": "8"
        },
        "row": 0,
        "col": 0,
        "id": "b2beb7ce-103a-560f-cf9c-b7df21827bf0",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "0ff674a9-4e70-3742-720a-e681566c9b4f": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
              "filterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "latitude",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.862061599769905
                },
                {
                  "name": "longitude",
                  "type": "attribute",
                  "label": "longitude",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.017864596400994026
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "state",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.652632058135977
                },
                {
                  "name": "progress",
                  "type": "attribute",
                  "label": "progress",
                  "color": "#607d8b",
                  "settings": {},
                  "_hash": 0.35182491461913457
                },
                {
                  "name": "installationType",
                  "type": "attribute",
                  "label": "installationType",
                  "color": "#9c27b0",
                  "settings": {},
                  "_hash": 0.2357170844737564
                },
                {
                  "name": "locationName",
                  "type": "attribute",
                  "label": "locationName",
                  "color": "#8bc34a",
                  "settings": {},
                  "_hash": 0.7555775294467035
                },
                {
                  "name": "outsideHumidity",
                  "type": "timeseries",
                  "label": "outsideHumidity",
                  "color": "#cddc39",
                  "settings": {},
                  "_hash": 0.7038818406636014
                },
                {
                  "name": "outsideTemp",
                  "type": "timeseries",
                  "label": "outsideTemp",
                  "color": "#3f51b5",
                  "settings": {},
                  "_hash": 0.3584981742251683
                },
                {
                  "name": "majorAlarmsCount",
                  "type": "attribute",
                  "label": "majorAlarmsCount",
                  "color": "#e91e63",
                  "settings": {},
                  "_hash": 0.2457539608057584
                },
                {
                  "name": "criticalAlarmsCount",
                  "type": "attribute",
                  "label": "criticalAlarmsCount",
                  "color": "#ffeb3b",
                  "settings": {},
                  "_hash": 0.362993982508079
                },
                {
                  "name": "minorAlarmsCount",
                  "type": "attribute",
                  "label": "minorAlarmsCount",
                  "color": "#03a9f4",
                  "settings": {},
                  "_hash": 0.11733799988993221
                },
                {
                  "name": "warningAlarmsCount",
                  "type": "attribute",
                  "label": "warningAlarmsCount",
                  "color": "#ff9800",
                  "settings": {},
                  "_hash": 0.6269991260047776
                },
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#673ab7",
                  "settings": {},
                  "_hash": 0.9172342215995071
                },
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "name",
                  "color": "#009688",
                  "settings": {},
                  "_hash": 0.5180855877351238,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "label",
                  "color": "#00bcd4",
                  "settings": {},
                  "_hash": 0.8758870297077328,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "entityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6",
              "dataKeys": [
                {
                  "name": "role",
                  "type": "attribute",
                  "label": "role",
                  "color": "#795548",
                  "settings": {},
                  "_hash": 0.8815810998227034
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            },
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "latitude",
                  "type": "attribute",
                  "label": "selectedProject",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.5292772206260663,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": true,
                  "postFuncBody": "if (value) {\n    return true;\n} else {\n    return false;\n}",
                  "aggregationType": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678196817440,
                "endTimeMs": 1678283217440
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "CartoDB.Positron",
            "useCustomProvider": false,
            "customProviderTileUrl": "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "useV3": false,
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg",
              "apiKey": "kVXykxAfZ6LS4EbCTO02soFVfjA7HoBzNVVH9u7nzoE"
            },
            "mapImageUrl": "tb-image;/api/images/system/here_map_system_widget_map_image.svg",
            "imageEntityAlias": "",
            "imageUrlAttribute": "",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "latitude",
            "lngKeyName": "longitude",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 14,
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": false,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${locationName}",
            "labelFunction": null,
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": true,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}",
            "tooltipFunction": "const temperature = data.outsideTemp;\nconst humidity = data.outsideHumidity;\nconst pressure = data.pressure;\nconst longitude = data.longitude;\nconst latitude = data.latitude;\nvar locationName = data.locationName || 'N/A';\nconst installationType = data.installationType;\nconst address = data.address;\nconst name = data.name;\nconst label = data.label;\n\nconst userRole = dsData[dsData.length - 1].role;\n\n// Alarms\nconst state = data.state;\nconst progress = data.progress;\nconst criticalAlarms = data.criticalAlarmsCount || 'N/A';\nconst majorAlarms = data.majorAlarmsCount || 'N/A';\nconst minorAlarms = data.minorAlarmsCount || 'N/A';\nconst warningAlarms = data.warningAlarmsCount || 'N/A';\n\n// Farben fr Alarms\nconst criticalAlarmsColor = '#FF0000'; // Rot\nconst criticalAlarmsBgColor =\n'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\n\nconst majorAlarmsColor = '#FF8C00'; // Orange\nconst majorAlarmsBgColor =\n'rgba(255, 140, 0, 0.1)'; // Transparenter Orange\n\nconst minorAlarmsColor = '#FFD700'; // Gold\nconst minorAlarmsBgColor =\n'rgba(255, 215, 0, 0.1)'; // Transparenter Gold\n\nconst warningAlarmsColor = '#000000'; // Schwarz\nconst warningAlarmsBgColor =\n'rgba(128, 128, 128, 0.1)'; // Transparenter Grau\n\nvar ButtonHtml = '';\nif (userRole !== \"Belimo Retrofit Users\") {\n    ButtonHtml = '<div style=\"text-align: center\">' +\n        '<link-act name=\"all_measurements\">Edit Measurements</link-act>' +\n        '</div>';\n}\n/*console.log(ButtonHtml);*/\n\nif (locationName === 'N/A') {\n    locationName = label;\n}\n\nreturn '<div style=\"display:flex;flex-direction:column;margin-bottom:8px;font-family:\\'Roboto\\';font-weight:500;font-size:16px;line-height:24px;letter-spacing:0.25px;color:#29313C\">' +\n    '<div>' + locationName + ' | ' + name + '</div>' +\n    '<div style=\"width: 100%;border-bottom:1px solid rgba(0, 0, 0, 0.12);margin:12px 0;\"></div>' +\n\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Address</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    address + '</div>' +\n    '</div>' +\n/*    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Critical Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    criticalAlarmsColor + ';background-color:' +\n    criticalAlarmsBgColor + '\">' + criticalAlarms +\n    '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Major Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    majorAlarmsColor + ';background-color:' +\n    majorAlarmsBgColor + '\">' + majorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Minor Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    minorAlarmsColor + ';background-color:' +\n    minorAlarmsBgColor + '\">' + minorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Warning Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    warningAlarmsColor + ';background-color:' +\n    warningAlarmsBgColor + '\">' + warningAlarms + '</div>' +\n    '</div>' +*/\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Temperature</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    temperature + ' C</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Humidity</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    humidity + ' % r.H.</div>' +\n    '</div>' +\n    projectWizardButtonHtml +\n    ButtonHtml +\n    '</div>';",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": false,
            "colorFunction": null,
            "useMarkerImageFunction": true,
            "markerImage": null,
            "markerImageSize": 34,
            "markerImageFunction": "var progress = data['progress'];\r\nvar selectedProject = data['selectedProject'] === true;\r\nvar selectedMode = dsData.filter(function(data) { return data['selectedProject'] === true; }).length > 0;\r\n\r\nvar width = 30;\r\nvar svgStr = getDoktorkitSvg(progress, width, selectedProject);\r\nvar encodedSvg = encodeURIComponent(svgStr);\r\nvar svgUrl = 'data:image/svg+xml,' + encodedSvg;\r\nif (selectedProject) {\r\n  width += 8;\r\n}\r\nreturn {\r\n  url: svgUrl,\r\n  size: width,\r\n  markerOffset: [width / 2, width / 2],\r\n  tooltipOffset: [width * 0.5 - width / 2, -(width / 2)]\r\n};\r\n\r\nfunction getDoktorkitSvg(progress, width, isSelected) {\r\n    var color = getBackgroundColor(progress);\r\n    var background = getBackground(color);\r\n    var svgSize = isSelected ? (width + 8) : width;\r\n    var opacity = selectedMode && !isSelected ? 0.4 : 1;\r\n\r\n    // Home-Icon SVG (zentriert und skaliert)\r\n    var shape = '<g transform=\"translate(10,10) scale(0.8)\">' +\r\n                '<path d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\" fill=\"white\"/>' +\r\n                '</g>';\r\n\r\n    var projectSvg = '<svg opacity=\"' + opacity + '\" width=\"' + svgSize + '\" height=\"' + svgSize + '\" viewBox=\"0 0 46 46\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\r\n                     wrapIfSelected(background + shape, isSelected);\r\n    if (isSelected) {\r\n        projectSvg += getProjectSelectionStroke();\r\n    }\r\n    projectSvg += '</svg>';\r\n    return projectSvg;\r\n}\r\n\r\nfunction wrapIfSelected(svg, isSelected) {\r\n    if (isSelected) {\r\n        return '<g transform=\"translate(4,4)\">' + svg + '</g>';\r\n    } else {\r\n        return svg;\r\n    }\r\n}\r\n\r\n// Hintergrundkreis genau mittig\r\nfunction getBackground(color) {\r\n    return '<circle cx=\"19\" cy=\"19\" r=\"15\" fill=\"'+ color +'\"/>';\r\n}\r\n\r\n// Selektionsring exakt um den Hintergrundkreis herum\r\nfunction getProjectSelectionStroke() {\r\n    return '<circle cx=\"23\" cy=\"23\" r=\"18\" stroke=\"#D5C21B\" stroke-width=\"2\"/>';\r\n}\r\n\r\nfunction getBackgroundColor(progress) {\r\n  switch(progress) {\r\n    case 'in preperation': \r\n        return '#000000'; // '#CAC1D2'--> grau\r\n    case 'finished': \r\n        return '#27AE60'; // --> grn\r\n    case 'active': \r\n        return '#f3de61'; // --> gelb\r\n    default: \r\n        return '#000000'; // --> grau\r\n  }\r\n}",
            "markerImages": [],
            "showPolygon": false,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": false,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "polygonLabelFunction": null,
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonTooltipFunction": null,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonColorFunction": null,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "polygonStrokeColorFunction": null,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "circleLabelFunction": null,
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleTooltipFunction": null,
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleFillColorFunction": null,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "circleStrokeColorFunction": null,
            "useClusterMarkers": true,
            "zoomOnClick": true,
            "maxZoom": null,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true,
            "useIconCreateFunction": false,
            "clusterMarkerFunction": null
          },
          "title": "New OpenStreetMap",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Select Project",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nvar selectedProject = params['selectedProject'];\nif (selectedProject && selectedProject.entityId.id === entityId.id) {\n    params['selectedProject'] = null;\n} else {\n    params['selectedProject'] = { entityId: entityId, entityName: entityName, entityLabel: entityLabel };\n}\nwidgetContext.stateController.updateState(null, params);\n/*console.log(\"Params 1: \" + JSON.stringify(params));*/",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4de7962b-a1de-5cb1-cd78-993dc7863614"
              }
            ],
            "tooltipAction": [
              {
                "name": "all_measurements",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nparams['selectedProject'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedProject';\n/*params['selectedMeasurement'] = null;*/\n/*console.log(\"Params 2: \" + JSON.stringify(params));*/\nwidgetContext.stateController.openState('all_measurements', params);\t",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1ca54350-817a-27b3-26a7-3572544d8523"
              }
            ]
          },
          "showTitleIcon": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "displayTimewindow": true,
          "borderRadius": "0px",
          "pageSize": 1024
        },
        "row": 0,
        "col": 0,
        "id": "0ff674a9-4e70-3742-720a-e681566c9b4f",
        "typeFullFqn": "system.maps_v2.openstreetmap"
      },
      "f2279347-4693-4b0a-17c2-15d2887559fa": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1745755787013,
                "endTimeMs": 1745842187013
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              },
              {
                "label": "{i18n:widgets.maps.layer.topographic}",
                "provider": "openstreet",
                "layerType": "Esri.WorldTopoMap",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "OpenStreetMap.HOT",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "Esri.WorldStreetMap",
                "referenceLayer": null
              },
              {
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
                "dsFilterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
                "additionalDataSources": null,
                "additionalDataKeys": [
                  {
                    "name": "progress",
                    "type": "attribute",
                    "label": "progress",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.9725950885098493
                  },
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.2872987416504812,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  },
                  {
                    "name": "address",
                    "type": "attribute",
                    "label": "address",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8026110588871542
                  },
                  {
                    "name": "outsideTemp",
                    "type": "timeseries",
                    "label": "outsideTemp",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.759902282076257
                  },
                  {
                    "name": "outsideHumidity",
                    "type": "timeseries",
                    "label": "outsideHumidity",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.05821233805088244
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8646915284773707,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "label": {
                  "show": true,
                  "type": "function",
                  "pattern": "${entityName}",
                  "patternFunction": {
                    "body": "var color = utils.getProgressColor(data.progress).color;\r\n\r\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \r\n           '${entityName}' + \r\n        '</span>';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js",
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js"
                    }
                  }
                },
                "tooltip": {
                  "show": false,
                  "trigger": "hover",
                  "autoclose": true,
                  "type": "function",
                  "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} C<br/><small>See tooltip settings for details</small>",
                  "offsetX": 0,
                  "offsetY": -1,
                  "patternFunction": {
                    "body": "const locationName = data.locationName || data.label || entityName;\nconst name = data.name || entityName;\nconst progress = data.progress;\nconst address = data.address || '';\n\nlet progressHtml = '';\nif (progress) {\n    let color, bgColor, label;\n    switch (progress) {\n        case 'active':\n            color = '#27AE60';\n            bgColor = 'rgba(39, 174, 96, 0.12)';\n            label = 'Active';\n            break;\n        case 'in preparation':\n            color = '#F2994A';\n            bgColor = 'rgba(242, 153, 74, 0.12)';\n            label = 'In Preparation';\n            break;\n        case 'finished':\n            color = '#2F80ED';\n            bgColor = 'rgba(47, 128, 237, 0.12)';\n            label = 'Finished';\n            break;\n        case 'aborted':\n            color = '#EB5757';\n            bgColor = 'rgba(235, 87, 87, 0.12)';\n            label = 'Aborted';\n            break;\n        default:\n            color = '#828282';\n            bgColor = 'rgba(130, 130, 130, 0.12)';\n            label = progress || 'Unknown';\n    }\n    progressHtml = '<span style=\"padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 500; color: ' + color + '; background-color: ' + bgColor + ';\">' + label + '</span>';\n}\n\nreturn '<div style=\"font-family: Roboto; font-size: 14px;\">' +\n    '<div style=\"font-weight: 600; margin-bottom: 4px;\">' + locationName + '</div>' +\n    '<div style=\"color: #666; font-size: 12px; margin-bottom: 4px;\">' + name + '</div>' +\n    (progressHtml ? '<div>' + progressHtml + '</div>' : '') +\n    '<div style=\"color: #999; font-size: 11px; margin-top: 8px;\">Click for details</div>' +\n    '</div>';",
                    "modules": {}
                  },
                  "tagActions": null
                },
                "click": {
                  "type": "customPretty",
                  "customHtml": "<form class=\"project-popup-form\">\n  <button class=\"popup-close\" mat-icon-button (click)=\"close()\" type=\"button\">\n    <mat-icon class=\"material-icons\">close</mat-icon>\n  </button>\n  <div mat-dialog-content>\n    <!-- Project Picture -->\n    <section *ngIf=\"project.picture\" class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <img class=\"project-picture\" [src]=\"project.picture\"/>\n    </section>\n    \n    <!-- Project Name -->\n    <section class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <div class=\"popup-title\">{{ project.locationName }}</div>\n      <div class=\"popup-subtitle\">{{ project.name }}</div>\n    </section>\n    \n    <mat-divider style=\"margin-bottom: 16px;\"></mat-divider>\n    \n    <!-- Project Details -->\n    <section class=\"flex flex-col gap-2\" style=\"padding-bottom: 16px;\">\n      <div class=\"flex flex-row items-baseline\">\n        <div class=\"popup-label\">Address</div>\n        <div class=\"popup-value\">{{ project.address }}</div>\n      </div>\n      <div class=\"flex flex-row items-center\">\n        <div class=\"popup-label\">Progress</div>\n        <div class=\"popup-badge\" [style.color]=\"project.progressStyle.color\" [style.background-color]=\"project.progressStyle.bgColor\">\n          {{ project.progressStyle.label }}\n        </div>\n      </div>\n      <div class=\"flex flex-row items-center\" *ngIf=\"project.measurementsCount !== null\">\n        <div class=\"popup-label\">Measurements</div>\n        <div class=\"popup-value\">{{ project.measurementsCount }}</div>\n      </div>\n    </section>\n    \n    <!-- Timestamps -->\n    <section *ngIf=\"project.startTime || project.endTime\" class=\"flex flex-row gap-2 flex-wrap\" style=\"padding-bottom: 16px;\">\n      <div *ngIf=\"project.startTime\" class=\"timestamp-badge\" [style.color]=\"project.startTime.color\" [style.background-color]=\"project.startTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.startTime.icon }}</mat-icon>\n        <span>{{ project.startTime.label }}</span>\n      </div>\n      <div *ngIf=\"project.endTime\" class=\"timestamp-badge\" [style.color]=\"project.endTime.color\" [style.background-color]=\"project.endTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.endTime.icon }}</mat-icon>\n        <span>{{ project.endTime.label }}</span>\n      </div>\n    </section>\n    \n    <!-- Buttons -->\n    <section class=\"flex flex-row gap-2 items-center justify-center\" style=\"padding-top: 8px;\">\n      <button *ngIf=\"showWizardButton\" type=\"button\" mat-flat-button color=\"primary\" class=\"popup-button wizard-button\" (click)=\"openProjectWizard()\">\n        <mat-icon>rocket_launch</mat-icon>\n        <span>Project Wizard</span>\n      </button>\n      <button type=\"button\" mat-stroked-button color=\"primary\" class=\"popup-button\" (click)=\"openMeasurements()\">\n        <mat-icon>assignment</mat-icon>\n        <span>Measurements</span>\n      </button>\n    </section>\n  </div>\n</form>",
                  "customCss": ".project-popup-form {\n    width: 420px;\n    position: relative;\n    padding: 16px;\n}\n\n.project-popup-form .mat-mdc-dialog-content {\n    max-height: 95vh;\n    padding: 0;\n}\n\n.project-popup-form .popup-close {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    z-index: 1;\n}\n\n.project-popup-form .project-picture {\n    width: 160px;\n    height: 160px;\n    border-radius: 8px;\n    object-fit: cover;\n}\n\n.project-popup-form .popup-title {\n    font-weight: 600;\n    font-size: 18px;\n    line-height: 24px;\n    color: #29313C;\n    text-align: center;\n}\n\n.project-popup-form .popup-subtitle {\n    font-size: 14px;\n    color: #666;\n    text-align: center;\n}\n\n.project-popup-form .popup-label {\n    font-size: 13px;\n    line-height: 16px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.38);\n    width: 110px;\n    flex-shrink: 0;\n}\n\n.project-popup-form .popup-value {\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: 500;\n    letter-spacing: 0.25px;\n    color: #29313C;\n}\n\n.project-popup-form .popup-badge {\n    display: inline-block;\n    padding: 4px 8px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 16px;\n}\n\n.project-popup-form .timestamp-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 500;\n}\n\n.project-popup-form .popup-button {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.project-popup-form .wizard-button {\n    background-color: #307FE5;\n}\n\n.project-popup-form .mat-mdc-outlined-button.mat-primary:not(:disabled),\n.project-popup-form .mat-mdc-stroked-button.mat-primary:not(:disabled) {\n    color: #307FE5;\n    border-color: #307FE5;\n}",
                  "customFunction": {
                    "body": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet rxjs = widgetContext.rxjs;\n\n// Load attributes and relations in parallel\nrxjs.forkJoin([\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', \n        ['locationName', 'address', 'progress', 'startTimeMs', 'endTimeMs', 'projectPicture']\n    ),\n    entityRelationService.findByFrom(entityId, 'Owns')\n]).subscribe(function(results) {\n    let attributes = results[0];\n    let relations = results[1];\n    \n    let attrMap = {};\n    attributes.forEach(function(attr) {\n        attrMap[attr.key] = attr.value;\n    });\n    \n    // Count measurements (relations with type Owns to ASSETs)\n    let measurementsCount = relations.filter(function(rel) {\n        return rel.to && rel.to.entityType === 'ASSET';\n    }).length;\n    \n    openProjectPopupDialog(attrMap, measurementsCount);\n});\n\nfunction openProjectPopupDialog(attrMap, measurementsCount) {\n    customDialog.customDialog(htmlTemplate, ProjectPopupController).subscribe();\n    \n    function ProjectPopupController(instance) {\n        let vm = instance;\n        \n        // Progress styling\n        let progressStyle = getProgressColor(attrMap.progress);\n        \n        // Timestamp styling\n        let startTime = getTimestampStyle(attrMap.startTimeMs, 'start');\n        let endTime = getTimestampStyle(attrMap.endTimeMs, 'end');\n        \n        vm.project = {\n            name: entityName,\n            locationName: attrMap.locationName || entityLabel || entityName,\n            address: attrMap.address || 'N/A',\n            progress: attrMap.progress,\n            progressStyle: progressStyle,\n            picture: attrMap.projectPicture || null,\n            startTime: startTime,\n            endTime: endTime,\n            measurementsCount: measurementsCount\n        };\n        \n        vm.showWizardButton = (attrMap.progress === 'in preparation' || attrMap.progress === 'active');\n        \n        vm.close = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        vm.openProjectWizard = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            }, { dataImporter: dataImporter });\n        };\n        \n        vm.openMeasurements = function() {\n            vm.dialogRef.close(null);\n            var params = widgetContext.stateController.getStateParams();\n            var selectedProject = params['selectedProject'];\n            if (selectedProject && selectedProject.entityId.id === entityId.id) {\n                params['selectedProject'] = null;\n            } else {\n                params['selectedProject'] = { \n                    entityId: entityId, \n                    entityName: entityName, \n                    entityLabel: entityLabel \n                };\n            }\n            widgetContext.stateController.updateState(null, params);\n        };\n        \n        // Helper functions\n        function getProgressColor(progress) {\n            let color, bgColor, label;\n            switch (progress) {\n                case 'in preparation':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'In Preparation';\n                    break;\n                case 'planned':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'Planned';\n                    break;\n                case 'active':\n                    color = '#27AE60';\n                    bgColor = 'rgba(39, 174, 96, 0.12)';\n                    label = 'Active';\n                    break;\n                case 'finished':\n                    color = '#2F80ED';\n                    bgColor = 'rgba(47, 128, 237, 0.12)';\n                    label = 'Finished';\n                    break;\n                case 'aborted':\n                    color = '#EB5757';\n                    bgColor = 'rgba(235, 87, 87, 0.12)';\n                    label = 'Aborted';\n                    break;\n                default:\n                    color = '#828282';\n                    bgColor = 'rgba(130, 130, 130, 0.12)';\n                    label = progress || 'N/A';\n            }\n            return { color: color, bgColor: bgColor, label: label };\n        }\n        \n        function getTimestampStyle(timestampMs, type) {\n            if (timestampMs === null || timestampMs === undefined) {\n                return null;\n            }\n            var date = new Date(Number(timestampMs));\n            var pad = function(n) { return n.toString().padStart(2, '0'); };\n            var formattedTime = date.getFullYear() + '-' + pad(date.getMonth() + 1) + '-' + pad(date.getDate()) +\n                ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n            \n            var icon, color, bgColor, label;\n            if (type === 'start') {\n                icon = 'play_circle';\n                color = '#27AE60';\n                bgColor = 'rgba(39, 174, 96, 0.12)';\n                label = 'Start: ' + formattedTime;\n            } else {\n                icon = 'stop_circle';\n                color = '#2F80ED';\n                bgColor = 'rgba(47, 128, 237, 0.12)';\n                label = 'End: ' + formattedTime;\n            }\n            return { icon: icon, color: color, bgColor: bgColor, label: label };\n        }\n    }\n}",
                    "modules": {
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                      "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                    }
                  },
                  "customResources": [],
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "add",
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "icon",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "size": 40,
                  "color": {
                    "type": "function",
                    "color": "#307FE5",
                    "rangeKey": null,
                    "range": null,
                    "colorFunction": {
                      "body": "return utils.getProgressColor(data.progress).color;",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    }
                  },
                  "iconContainer": "iconContainer4",
                  "icon": "domain"
                },
                "markerImage": {
                  "type": "image",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": true,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedProject",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.5634367819170003,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce"
              },
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "role",
                    "type": "attribute",
                    "label": "role",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7014478669430672
                  },
                  {
                    "name": "displayAbortedMeasurement",
                    "type": "attribute",
                    "label": "displayAbortedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8011587598224269
                  },
                  {
                    "name": "displayActiveMeasurement",
                    "type": "attribute",
                    "label": "displayActiveMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8205299052205228
                  },
                  {
                    "name": "displayFinishedMeasurement",
                    "type": "attribute",
                    "label": "displayFinishedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.038665901375789624
                  },
                  {
                    "name": "displayPreparationMeasurement",
                    "type": "attribute",
                    "label": "displayPreparationMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.21373032656145663
                  }
                ],
                "dsEntityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [
              "metric"
            ],
            "dragModeButton": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [
              {
                "label": "Filter",
                "icon": "filter_alt",
                "color": "#0000008A",
                "action": {
                  "type": "openDashboardState",
                  "targetDashboardStateId": "Measurement_state_filter",
                  "setEntityId": true,
                  "stateEntityParamName": null,
                  "openRightLayout": false,
                  "popoverPreferredPlacement": "top",
                  "popoverHideOnClickOutside": true,
                  "popoverHideDashboardToolbar": true,
                  "popoverWidth": "300px",
                  "popoverHeight": "250px",
                  "popoverStyle": {
                    "padding": "16px",
                    "borderRadius": "8px",
                    "boxShadow": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
                    "background": "#ffffff"
                  },
                  "openInSeparateDialog": false,
                  "openInPopover": true
                }
              }
            ],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "8px"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": true,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {
            "headerButton": []
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "f2279347-4693-4b0a-17c2-15d2887559fa"
      },
      "fb583db5-3fc6-275a-34f4-120bfe140af2": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1745755787013,
                "endTimeMs": 1745842187013
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 50000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              },
              {
                "label": "{i18n:widgets.maps.layer.topographic}",
                "provider": "openstreet",
                "layerType": "Esri.WorldTopoMap",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "OpenStreetMap.HOT",
                "referenceLayer": null
              },
              {
                "label": null,
                "provider": "openstreet",
                "layerType": "Esri.WorldStreetMap",
                "referenceLayer": null
              },
              {
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
                "dsFilterId": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
                "additionalDataSources": null,
                "additionalDataKeys": [
                  {
                    "name": "progress",
                    "type": "attribute",
                    "label": "progress",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.9725950885098493
                  },
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.2872987416504812,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  },
                  {
                    "name": "address",
                    "type": "attribute",
                    "label": "address",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8026110588871542
                  },
                  {
                    "name": "outsideTemp",
                    "type": "timeseries",
                    "label": "outsideTemp",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.759902282076257
                  },
                  {
                    "name": "outsideHumidity",
                    "type": "timeseries",
                    "label": "outsideHumidity",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.05821233805088244
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8646915284773707,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "label": {
                  "show": true,
                  "type": "function",
                  "pattern": "${entityName}",
                  "patternFunction": {
                    "body": "var color = utils.getProgressColor(data.progress).color;\r\n\r\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \r\n           '${entityName}' + \r\n        '</span>';",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                    }
                  }
                },
                "tooltip": {
                  "show": false,
                  "type": "function",
                  "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} C<br/><small>See tooltip settings for details</small>",
                  "patternFunction": {
                    "body": "const locationName = data.locationName || data.label || entityName;\nconst name = data.name || entityName;\nconst progress = data.progress;\nconst address = data.address || '';\n\nlet progressHtml = '';\nif (progress) {\n    let color, bgColor, label;\n    switch (progress) {\n        case 'active':\n            color = '#27AE60';\n            bgColor = 'rgba(39, 174, 96, 0.12)';\n            label = 'Active';\n            break;\n        case 'in preparation':\n            color = '#F2994A';\n            bgColor = 'rgba(242, 153, 74, 0.12)';\n            label = 'In Preparation';\n            break;\n        case 'finished':\n            color = '#2F80ED';\n            bgColor = 'rgba(47, 128, 237, 0.12)';\n            label = 'Finished';\n            break;\n        case 'aborted':\n            color = '#EB5757';\n            bgColor = 'rgba(235, 87, 87, 0.12)';\n            label = 'Aborted';\n            break;\n        default:\n            color = '#828282';\n            bgColor = 'rgba(130, 130, 130, 0.12)';\n            label = progress || 'Unknown';\n    }\n    progressHtml = '<span style=\"padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: 500; color: ' + color + '; background-color: ' + bgColor + ';\">' + label + '</span>';\n}\n\nreturn '<div style=\"font-family: Roboto; font-size: 14px;\">' +\n    '<div style=\"font-weight: 600; margin-bottom: 4px;\">' + locationName + '</div>' +\n    '<div style=\"color: #666; font-size: 12px; margin-bottom: 4px;\">' + name + '</div>' +\n    (progressHtml ? '<div>' + progressHtml + '</div>' : '') +\n    '<div style=\"color: #999; font-size: 11px; margin-top: 8px;\">Click for details</div>' +\n    '</div>';",
                    "modules": {}
                  },
                  "trigger": "hover",
                  "autoclose": true,
                  "offsetX": 0,
                  "offsetY": -1,
                  "tagActions": null
                },
                "click": {
                  "type": "customPretty",
                  "customHtml": "<form class=\"project-popup-form\">\n  <button class=\"popup-close\" mat-icon-button (click)=\"close()\" type=\"button\">\n    <mat-icon class=\"material-icons\">close</mat-icon>\n  </button>\n  <div mat-dialog-content>\n    <!-- Project Picture -->\n    <section *ngIf=\"project.picture\" class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <img class=\"project-picture\" [src]=\"project.picture\"/>\n    </section>\n    \n    <!-- Project Name -->\n    <section class=\"flex flex-col items-center justify-center\" style=\"padding-bottom: 16px;\">\n      <div class=\"popup-title\">{{ project.locationName }}</div>\n      <div class=\"popup-subtitle\">{{ project.name }}</div>\n    </section>\n    \n    <mat-divider style=\"margin-bottom: 16px;\"></mat-divider>\n    \n    <!-- Project Details -->\n    <section class=\"flex flex-col gap-2\" style=\"padding-bottom: 16px;\">\n      <div class=\"flex flex-row items-baseline\">\n        <div class=\"popup-label\">Address</div>\n        <div class=\"popup-value\">{{ project.address }}</div>\n      </div>\n      <div class=\"flex flex-row items-center\">\n        <div class=\"popup-label\">Progress</div>\n        <div class=\"popup-badge\" [style.color]=\"project.progressStyle.color\" [style.background-color]=\"project.progressStyle.bgColor\">\n          {{ project.progressStyle.label }}\n        </div>\n      </div>\n      <div class=\"flex flex-row items-center\" *ngIf=\"project.measurementsCount !== null\">\n        <div class=\"popup-label\">Measurements</div>\n        <div class=\"popup-value\">{{ project.measurementsCount }}</div>\n      </div>\n    </section>\n    \n    <!-- Timestamps -->\n    <section *ngIf=\"project.startTime || project.endTime\" class=\"flex flex-row gap-2 flex-wrap\" style=\"padding-bottom: 16px;\">\n      <div *ngIf=\"project.startTime\" class=\"timestamp-badge\" [style.color]=\"project.startTime.color\" [style.background-color]=\"project.startTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.startTime.icon }}</mat-icon>\n        <span>{{ project.startTime.label }}</span>\n      </div>\n      <div *ngIf=\"project.endTime\" class=\"timestamp-badge\" [style.color]=\"project.endTime.color\" [style.background-color]=\"project.endTime.bgColor\">\n        <mat-icon style=\"font-size: 14px; width: 14px; height: 14px; margin-right: 4px;\">{{ project.endTime.icon }}</mat-icon>\n        <span>{{ project.endTime.label }}</span>\n      </div>\n    </section>\n    \n    <!-- Buttons -->\n    <section class=\"flex flex-row gap-2 items-center justify-center\" style=\"padding-top: 8px;\">\n      <button *ngIf=\"showWizardButton\" type=\"button\" mat-flat-button color=\"primary\" class=\"popup-button wizard-button\" (click)=\"openProjectWizard()\">\n        <mat-icon>rocket_launch</mat-icon>\n        <span>Project Wizard</span>\n      </button>\n      <button type=\"button\" mat-stroked-button color=\"primary\" class=\"popup-button\" (click)=\"openMeasurements()\">\n        <mat-icon>assignment</mat-icon>\n        <span>Measurements</span>\n      </button>\n    </section>\n  </div>\n</form>",
                  "customCss": ".project-popup-form {\n    width: 420px;\n    position: relative;\n    padding: 16px;\n}\n\n.project-popup-form .mat-mdc-dialog-content {\n    max-height: 95vh;\n    padding: 0;\n}\n\n.project-popup-form .popup-close {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    z-index: 1;\n}\n\n.project-popup-form .project-picture {\n    width: 160px;\n    height: 160px;\n    border-radius: 8px;\n    object-fit: cover;\n}\n\n.project-popup-form .popup-title {\n    font-weight: 600;\n    font-size: 18px;\n    line-height: 24px;\n    color: #29313C;\n    text-align: center;\n}\n\n.project-popup-form .popup-subtitle {\n    font-size: 14px;\n    color: #666;\n    text-align: center;\n}\n\n.project-popup-form .popup-label {\n    font-size: 13px;\n    line-height: 16px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.38);\n    width: 110px;\n    flex-shrink: 0;\n}\n\n.project-popup-form .popup-value {\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: 500;\n    letter-spacing: 0.25px;\n    color: #29313C;\n}\n\n.project-popup-form .popup-badge {\n    display: inline-block;\n    padding: 4px 8px;\n    border-radius: 8px;\n    font-size: 12px;\n    font-weight: 500;\n    line-height: 16px;\n}\n\n.project-popup-form .timestamp-badge {\n    display: inline-flex;\n    align-items: center;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 11px;\n    font-weight: 500;\n}\n\n.project-popup-form .popup-button {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n}\n\n.project-popup-form .wizard-button {\n    background-color: #307FE5;\n}\n\n.project-popup-form .mat-mdc-outlined-button.mat-primary:not(:disabled),\n.project-popup-form .mat-mdc-stroked-button.mat-primary:not(:disabled) {\n    color: #307FE5;\n    border-color: #307FE5;\n}",
                  "customFunction": {
                    "body": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet rxjs = widgetContext.rxjs;\n\n// Load attributes and relations in parallel\nrxjs.forkJoin([\n    attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE', \n        ['locationName', 'address', 'progress', 'startTimeMs', 'endTimeMs', 'projectPicture']\n    ),\n    entityRelationService.findByFrom(entityId, 'Owns')\n]).subscribe(function(results) {\n    let attributes = results[0];\n    let relations = results[1];\n    \n    let attrMap = {};\n    attributes.forEach(function(attr) {\n        attrMap[attr.key] = attr.value;\n    });\n    \n    // Count measurements (relations with type Owns to ASSETs)\n    let measurementsCount = relations.filter(function(rel) {\n        return rel.to && rel.to.entityType === 'ASSET';\n    }).length;\n    \n    openProjectPopupDialog(attrMap, measurementsCount);\n});\n\nfunction openProjectPopupDialog(attrMap, measurementsCount) {\n    customDialog.customDialog(htmlTemplate, ProjectPopupController).subscribe();\n    \n    function ProjectPopupController(instance) {\n        let vm = instance;\n        \n        // Progress styling\n        let progressStyle = getProgressColor(attrMap.progress);\n        \n        // Timestamp styling\n        let startTime = getTimestampStyle(attrMap.startTimeMs, 'start');\n        let endTime = getTimestampStyle(attrMap.endTimeMs, 'end');\n        \n        vm.project = {\n            name: entityName,\n            locationName: attrMap.locationName || entityLabel || entityName,\n            address: attrMap.address || 'N/A',\n            progress: attrMap.progress,\n            progressStyle: progressStyle,\n            picture: attrMap.projectPicture || null,\n            startTime: startTime,\n            endTime: endTime,\n            measurementsCount: measurementsCount\n        };\n        \n        vm.showWizardButton = (attrMap.progress === 'in preparation' || attrMap.progress === 'active');\n        \n        vm.close = function() {\n            vm.dialogRef.close(null);\n        };\n        \n        vm.openProjectWizard = function() {\n            vm.dialogRef.close(null);\n            projectWizard.openProjectWizardDialog(widgetContext, entityId, entityName, entityLabel, function() {\n                widgetContext.updateAliases();\n            }, { dataImporter: dataImporter });\n        };\n        \n        vm.openMeasurements = function() {\n            vm.dialogRef.close(null);\n            var params = widgetContext.stateController.getStateParams();\n            var selectedProject = params['selectedProject'];\n            if (selectedProject && selectedProject.entityId.id === entityId.id) {\n                params['selectedProject'] = null;\n            } else {\n                params['selectedProject'] = { \n                    entityId: entityId, \n                    entityName: entityName, \n                    entityLabel: entityLabel \n                };\n            }\n            widgetContext.stateController.updateState(null, params);\n        };\n        \n        // Helper functions\n        function getProgressColor(progress) {\n            let color, bgColor, label;\n            switch (progress) {\n                case 'in preparation':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'In Preparation';\n                    break;\n                case 'planned':\n                    color = '#F2994A';\n                    bgColor = 'rgba(242, 153, 74, 0.12)';\n                    label = 'Planned';\n                    break;\n                case 'active':\n                    color = '#27AE60';\n                    bgColor = 'rgba(39, 174, 96, 0.12)';\n                    label = 'Active';\n                    break;\n                case 'finished':\n                    color = '#2F80ED';\n                    bgColor = 'rgba(47, 128, 237, 0.12)';\n                    label = 'Finished';\n                    break;\n                case 'aborted':\n                    color = '#EB5757';\n                    bgColor = 'rgba(235, 87, 87, 0.12)';\n                    label = 'Aborted';\n                    break;\n                default:\n                    color = '#828282';\n                    bgColor = 'rgba(130, 130, 130, 0.12)';\n                    label = progress || 'N/A';\n            }\n            return { color: color, bgColor: bgColor, label: label };\n        }\n        \n        function getTimestampStyle(timestampMs, type) {\n            if (timestampMs === null || timestampMs === undefined) {\n                return null;\n            }\n            var date = new Date(Number(timestampMs));\n            var pad = function(n) { return n.toString().padStart(2, '0'); };\n            var formattedTime = date.getFullYear() + '-' + pad(date.getMonth() + 1) + '-' + pad(date.getDate()) +\n                ' ' + pad(date.getHours()) + ':' + pad(date.getMinutes());\n            \n            var icon, color, bgColor, label;\n            if (type === 'start') {\n                icon = 'play_circle';\n                color = '#27AE60';\n                bgColor = 'rgba(39, 174, 96, 0.12)';\n                label = 'Start: ' + formattedTime;\n            } else {\n                icon = 'stop_circle';\n                color = '#2F80ED';\n                bgColor = 'rgba(47, 128, 237, 0.12)';\n                label = 'End: ' + formattedTime;\n            }\n            return { icon: icon, color: color, bgColor: bgColor, label: label };\n        }\n    }\n}",
                    "modules": {
                      "projectWizard": "tb-resource;/api/resource/js_module/tenant/ECO Project Wizard.js",
                      "dataImporter": "tb-resource;/api/resource/js_module/tenant/ECO Data Importer.js"
                    }
                  },
                  "customResources": [],
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "add",
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "icon",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "iconContainer": "iconContainer4",
                  "icon": "domain",
                  "size": 40,
                  "color": {
                    "type": "function",
                    "color": "#307FE5",
                    "rangeKey": null,
                    "range": null,
                    "colorFunction": {
                      "body": "return utils.getProgressColor(data.progress).color;",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/tenant/ECO Diagnostics Utils JS.js"
                      }
                    }
                  }
                },
                "markerImage": {
                  "type": "image",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": true,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedProject",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.5634367819170003,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": null,
                    "postFuncBody": null
                  }
                ],
                "dsEntityAliasId": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce"
              },
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "role",
                    "type": "attribute",
                    "label": "role",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7014478669430672
                  },
                  {
                    "name": "displayAbortedMeasurement",
                    "type": "attribute",
                    "label": "displayAbortedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8011587598224269
                  },
                  {
                    "name": "displayActiveMeasurement",
                    "type": "attribute",
                    "label": "displayActiveMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.8205299052205228
                  },
                  {
                    "name": "displayFinishedMeasurement",
                    "type": "attribute",
                    "label": "displayFinishedMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.038665901375789624
                  },
                  {
                    "name": "displayPreparationMeasurement",
                    "type": "attribute",
                    "label": "displayPreparationMeasurement",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.21373032656145663
                  }
                ],
                "dsEntityAliasId": "7b659beb-1601-5b67-528e-0846d1a0efa6"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [
              "metric"
            ],
            "dragModeButton": true,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [
              {
                "label": "Filter",
                "icon": "filter_alt",
                "color": "#0000008A",
                "action": {
                  "type": "openDashboardState",
                  "targetDashboardStateId": "Measurement_state_filter",
                  "setEntityId": true,
                  "stateEntityParamName": null,
                  "openRightLayout": false,
                  "popoverPreferredPlacement": "top",
                  "popoverHideOnClickOutside": true,
                  "popoverHideDashboardToolbar": true,
                  "popoverWidth": "300px",
                  "popoverHeight": "250px",
                  "popoverStyle": {
                    "padding": "16px",
                    "borderRadius": "8px",
                    "boxShadow": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
                    "background": "#ffffff"
                  },
                  "openInSeparateDialog": false,
                  "openInPopover": true
                }
              },
              {
                "label": "Add Project",
                "icon": "add",
                "color": "#0000008a",
                "action": {
                  "type": "placeMapItem",
                  "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px; max-width: 90vw;\">\n  <mat-toolbar class=\"flex items-center\" color=\"primary\">\n    <mat-icon style=\"margin-right: 12px;\">folder_open</mat-icon>\n    <h2 style=\"margin: 0; font-size: 18px;\">Add Project</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col gap-2 p-4\">\n    <mat-form-field *ngIf=\"isTenantAdmin\" appearance=\"outline\" class=\"w-full\">\n      <mat-label>Customer</mat-label>\n      <mat-select formControlName=\"customer\" (selectionChange)=\"onCustomerChange()\" required>\n        <mat-option *ngFor=\"let c of customers\" [value]=\"c\">{{ c.name }}</mat-option>\n      </mat-select>\n      <mat-error *ngIf=\"addProjectFormGroup.get('customer')?.hasError('required')\">Customer is required.</mat-error>\n    </mat-form-field>\n    <tb-image-input formControlName=\"projectPicture\" label=\"Project Picture\" noImageText=\"No picture selected\"></tb-image-input>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project ID</mat-label>\n        <input matInput formControlName=\"name\" required readonly>\n        <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">Project title is required.</mat-error>\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Label</mat-label>\n        <input matInput formControlName=\"entityLabel\">\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"w-full\">\n        <mat-label>Project address</mat-label>\n        <input matInput formControlName=\"address\">\n    </mat-form-field>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Postal Code</mat-label>\n          <input matInput formControlName=\"postalCode\">\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 2;\">\n          <mat-label>City</mat-label>\n          <input matInput formControlName=\"city\">\n      </mat-form-field>\n    </div>\n    <div style=\"display: flex; gap: 8px;\">\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Latitude</mat-label>\n          <input matInput formControlName=\"latitude\" readonly>\n      </mat-form-field>\n      <mat-form-field appearance=\"outline\" style=\"flex: 1;\">\n          <mat-label>Longitude</mat-label>\n          <input matInput formControlName=\"longitude\" readonly>\n      </mat-form-field>\n    </div>\n  </div>\n  <div class=\"flex justify-end items-center gap-2 p-4\" style=\"border-top: 1px solid #e0e0e0; background: #fafafa;\">\n    <button mat-button (click)=\"cancel()\" type=\"button\">Cancel</button>\n    <button mat-raised-button color=\"primary\" type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\n      <mat-icon style=\"font-size: 18px; width: 18px; height: 18px; margin-right: 4px;\">save</mat-icon>\n      Save\n    </button>\n  </div>\n</form>\n",
                  "customCss": "",
                  "customFunction": "/*========================================================================*/\n/*========  Add Project with Customer Selection & Reverse Geocoding  =====*/\n/*========================================================================*/\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet $http = $injector.get(widgetContext.servicesMap.get('http'));\n\n// Get marker coordinates\nconst markerLat = additionalParams.coordinates.x;\nconst markerLon = additionalParams.coordinates.y;\n\nconsole.log(\"Marker Coordinates: \", markerLat, markerLon);\n\n// Check if Tenant Admin\nconst isTenantAdmin = widgetContext.currentUser.authority === 'TENANT_ADMIN';\nconst pageLink = widgetContext.pageLink(1000, 0, null, null, null);\n\n// Shared variables for async operations\nlet customers = [];\nlet selectedCustomerId = null;\nlet selectedCustomerName = null;\nlet addressData = null;\nlet nextProjectId = 0;\nlet customerShortName = '';\n\n// Step 1: Reverse Geocoding\nreverseGeocode(markerLat, markerLon)\n  .then(data => {\n    addressData = data;\n    console.log('Reverse geocoding result:', addressData);\n\n    // Step 2: Fetch customers\n    return fetchCustomers();\n  })\n  .then(() => {\n    console.log('Customers fetched:', customers);\n\n    // Step 3: Open dialog with customer selection\n    openAddProjectDialog();\n  })\n  .catch(error => {\n    console.error('Error in Add Project workflow:', error);\n  });\n\n/**\n * Reverse Geocoding: Converts lat/lon to address using Photon API\n * Address format: Straenname Hausnummer, CC-Postleitzahl Ort\n */\nfunction reverseGeocode(lat, lon) {\n  return new Promise((resolve, reject) => {\n    const url = `https://photon.komoot.io/reverse?lat=${lat}&lon=${lon}&limit=1`;\n\n    $http.get(url).subscribe(\n      response => {\n        if (response && response.features && response.features.length > 0) {\n          const feature = response.features[0];\n          const props = feature.properties;\n\n          // Build address in format: Straenname Hausnummer, CC-Postleitzahl Ort\n          let street = props.street || props.name || '';\n          let housenumber = props.housenumber || '';\n          let postcode = props.postcode || '';\n          let city = props.city || props.town || props.village || '';\n          let countryCode = props.countrycode ? props.countrycode.toUpperCase() : '';\n\n          // Street + Housenumber part\n          let addressLine = street;\n          if (housenumber) {\n            addressLine += ' ' + housenumber;\n          }\n\n          // CC-Postcode + City part\n          let locationLine = '';\n          if (countryCode && postcode) {\n            locationLine = countryCode + '-' + postcode;\n          } else if (postcode) {\n            locationLine = postcode;\n          }\n          if (city) {\n            locationLine += (locationLine ? ' ' : '') + city;\n          }\n\n          // Combined format: \"Street Number, CC-Postcode City\"\n          let fullAddress = addressLine;\n          if (locationLine) {\n            fullAddress += ', ' + locationLine;\n          }\n\n          const result = {\n            address: fullAddress,\n            postalCode: postcode,\n            city: city,\n            latitude: lat,\n            longitude: lon\n          };\n\n          resolve(result);\n        } else {\n          resolve({\n            address: '',\n            postalCode: '',\n            city: '',\n            latitude: lat,\n            longitude: lon\n          });\n        }\n      },\n      error => {\n        console.error('Photon API error:', error);\n        reject(error);\n      }\n    );\n  });\n}\n\n/**\n * Fetch customers based on user role\n */\nfunction fetchCustomers() {\n  return new Promise((resolve, reject) => {\n    customerService.getUserCustomers(pageLink).subscribe(\n      pageData => {\n        customers = (pageData && pageData.data) ? pageData.data : [];\n\n        // Non-Tenant-Admin  automatically select the single customer\n        if (!isTenantAdmin && customers.length === 1) {\n          const c = customers[0];\n          selectedCustomerId = {\n            id: c.id.id,\n            entityType: 'CUSTOMER'\n          };\n          selectedCustomerName = c.name;\n        }\n\n        resolve();\n      },\n      error => {\n        console.error('Error fetching customers:', error);\n        reject(error);\n      }\n    );\n  });\n}\n\nfunction openAddProjectDialog() {\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\n}\n\nfunction AddProjectDialogController(instance) {\n  let vm = instance;\n\n  vm.isTenantAdmin = isTenantAdmin;\n  vm.customers = customers;\n\n  // FormGroup erstellen\n  vm.addProjectFormGroup = vm.fb.group({\n    customer: [{ value: null, disabled: !isTenantAdmin }, vm.validators.required],\n    name: [{ value: '', disabled: true }, vm.validators.required],\n    entityLabel: [''],\n    projectPicture: [''],\n    address: [addressData ? addressData.address : ''],\n    postalCode: [addressData ? addressData.postalCode : ''],\n    city: [addressData ? addressData.city : ''],\n    latitude: [addressData ? addressData.latitude.toFixed(6) : markerLat.toFixed(6)],\n    longitude: [addressData ? addressData.longitude.toFixed(6) : markerLon.toFixed(6)]\n  });\n\n  // Customer vorausfllen (Non-Tenant-Admin)\n  if (!isTenantAdmin && selectedCustomerId) {\n    vm.addProjectFormGroup.patchValue({\n      customer: customers[0]\n    });\n    vm.addProjectFormGroup.get('customer').markAsDirty();\n    loadCustomerData(selectedCustomerId, selectedCustomerName);\n  }\n\n  // Customer Change Handler\n  vm.onCustomerChange = function () {\n    const c = vm.addProjectFormGroup.getRawValue().customer;\n    if (!c) return;\n\n    selectedCustomerId = {\n      id: c.id.id,\n      entityType: 'CUSTOMER'\n    };\n    selectedCustomerName = c.name;\n\n    loadCustomerData(selectedCustomerId, selectedCustomerName);\n  };\n\n  // Load customer-specific data (projects + shortName)\n  function loadCustomerData(customerId, customerName) {\n    const assetSearchQuery = {\n      \"parameters\": {\n        \"rootId\": customerId.id,\n        \"rootType\": \"CUSTOMER\",\n        \"direction\": \"FROM\",\n        \"relationTypeGroup\": \"COMMON\",\n        \"maxLevel\": 10,\n        \"fetchLastLevelOnly\": false\n      },\n      \"relationType\": \"Owns\",\n      \"assetTypes\": [\"Project\"]\n    };\n\n    assetService.findByQuery(assetSearchQuery).subscribe(projects => {\n      nextProjectId = getLastProjectId(projects);\n\n      attributeService\n        .getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName'])\n        .subscribe(attributes => {\n          const shortNameAttr = attributes.find(a => a.key === 'shortName');\n          customerShortName = shortNameAttr ? shortNameAttr.value : customerName;\n\n          vm.addProjectFormGroup.patchValue({\n            name: customerShortName + '_' + nextProjectId\n          });\n\n          vm.addProjectFormGroup.get('name').markAsDirty();\n        });\n    });\n  }\n\n  function getLastProjectId(projects) {\n    let maxNumber = 0;\n    projects.forEach(item => {\n      const name = item.name;\n      const parts = name.split('_');\n      if (parts.length === 2) {\n        const number = parseInt(parts[1], 10);\n        if (number > maxNumber) {\n          maxNumber = number;\n        }\n      }\n    });\n    return maxNumber + 1;\n  }\n\n  vm.cancel = function() {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function () {\n    if (!selectedCustomerId) {\n      console.error('No customer selected');\n      return;\n    }\n\n    // Validate that name is set\n    const formValues = vm.addProjectFormGroup.getRawValue();\n    if (!formValues.name || formValues.name === '') {\n      console.error('Project name is not set. Please select a customer first.');\n      return;\n    }\n\n    vm.addProjectFormGroup.markAsPristine();\n    saveProjectObservable(selectedCustomerId).subscribe(\n      function (Project) {\n        widgetContext.rxjs.forkJoin([\n          saveCustomerToProjectRelation(selectedCustomerId, Project.id),\n          saveAttributes(Project.id)\n        ]).subscribe(\n          function () {\n            var params = widgetContext.stateController.getStateParams();\n            params['selectedProject'] = {\n              entityId: Project.id,\n              entityName: Project.name,\n              entityLabel: ''\n            };\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n          }\n        );\n      }\n    );\n  };\n\n  function saveProjectObservable(customerId) {\n    return getProjectsGroup(customerId).pipe(\n      widgetContext.rxjs.switchMap((ProjectsGroup) => {\n        const formValues = vm.addProjectFormGroup.getRawValue();\n        let Project = {\n          name: formValues.name,\n          type: 'Project',\n          label: formValues.entityLabel,\n          customerId: customerId\n        };\n        return assetService.saveAsset(Project, ProjectsGroup.id.id)\n      })\n    );\n  }\n\n  function saveAttributes(entityId) {\n    let attributesArray = getMapItemLocationAttributes();\n    const formValues = vm.addProjectFormGroup.getRawValue();\n\n    attributesArray.push({key: 'address', value: formValues.address});\n    attributesArray.push({key: 'postalCode', value: formValues.postalCode});\n    attributesArray.push({key: 'city', value: formValues.city});\n    attributesArray.push({key: 'progress', value: 'in preparation'});\n    attributesArray.push({key: 'units', value: 'metric'});\n    attributesArray.push({key: 'projectPicture', value: formValues.projectPicture || ''});\n\n    if (attributesArray.length > 0) {\n      return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n    }\n    return widgetContext.rxjs.of([]);\n  }\n\n  function getProjectsGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n      widgetContext.rxjs.switchMap((entityGroups) => {\n        var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\n        if (ProjectsGroup) {\n          return widgetContext.rxjs.of(ProjectsGroup);\n        } else {\n          ProjectsGroup = {\n            type: 'ASSET',\n            name: 'Projects',\n            ownerId: customerId\n          };\n          return entityGroupService.saveEntityGroup(ProjectsGroup);\n        }\n      })\n    );\n  }\n\n  function saveCustomerToProjectRelation(customerId, ProjectId) {\n    var relation = {\n      from: customerId,\n      to: ProjectId,\n      typeGroup: 'COMMON',\n      type: 'Owns'\n    };\n    return entityRelationService.saveRelation(relation);\n  }\n\n  function getMapItemLocationAttributes() {\n    const attributes = [];\n    const mapItemType = $event.shape;\n    if (mapItemType === 'Marker') {\n      const mapType = widgetContext.mapInstance.type();\n      attributes.push({key: mapType === 'image' ? 'xPos' : 'latitude', value: additionalParams.coordinates.x});\n      attributes.push({key: mapType === 'image' ? 'yPos' : 'longitude', value: additionalParams.coordinates.y});\n    } else if (mapItemType === 'Rectangle' || mapItemType === 'Polygon') {\n      attributes.push({key: 'perimeter', value: additionalParams.coordinates});\n    } else if (mapItemType === 'Circle') {\n      attributes.push({key: 'circle', value: additionalParams.coordinates});\n    }\n    return attributes;\n  }\n}\n",
                  "customResources": [],
                  "mapItemType": "marker",
                  "mapItemTooltips": {},
                  "openInSeparateDialog": false,
                  "openInPopover": false
                }
              }
            ],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "8px"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": true,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "advanced",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "8px",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {
            "headerButton": []
          },
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "fb583db5-3fc6-275a-34f4-120bfe140af2"
      },
      "9fcb2ae1-cc3c-dc5a-9e1e-78830a5076f7": {
        "typeFullFqn": "system.charts.basic_timeseries",
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": "",
              "entityAliasId": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
              "dataKeys": [
                {
                  "name": "temperature",
                  "type": "timeseries",
                  "label": "Temperature",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.5555217927853249,
                  "units": "C",
                  "decimals": 0
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              },
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "stack": false,
            "fontSize": 10,
            "fontColor": "#545454",
            "showTooltip": true,
            "tooltipIndividual": false,
            "tooltipCumulative": false,
            "hideZeros": false,
            "grid": {
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1,
              "color": "#545454",
              "backgroundColor": null,
              "tickColor": "#DDDDDD"
            },
            "xaxis": {
              "title": null,
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "min": null,
              "max": null,
              "title": null,
              "showLabels": true,
              "color": "#545454",
              "tickSize": null,
              "tickDecimals": 0,
              "ticksFormatter": ""
            },
            "shadowSize": 4,
            "smoothLines": false,
            "comparisonEnabled": false,
            "xaxisSecond": {
              "axisPosition": "top",
              "title": null,
              "showLabels": true
            },
            "showLegend": true,
            "legendConfig": {
              "direction": "column",
              "position": "bottom",
              "sortDataKeys": false,
              "showMin": true,
              "showMax": true,
              "showAvg": true,
              "showTotal": false,
              "showLatest": true
            },
            "customLegendEnabled": false
          },
          "title": "Tempe",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "configMode": "advanced",
          "actions": {},
          "showTitleIcon": false,
          "titleIcon": "thermostat",
          "iconColor": "#1F6BDD",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "titleFont": null,
          "titleColor": null,
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "9fcb2ae1-cc3c-dc5a-9e1e-78830a5076f7"
      }
    },
    "states": {
      "default": {
        "name": "{i18n:custom.diagnostics.projects.title}",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "678a80b3-1380-cdd2-495f-1701acde66c1": {
                "sizeX": 48,
                "sizeY": 24,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 48,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "alarm_badges": {
        "name": "{i18n:custom.diagnostics.states.alarm-badges}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "225675bf-745f-b2bc-b83c-52d751910205": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "battery_level_details": {
        "name": "{i18n:custom.diagnostics.states.battery-level-details}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "af27e6f5-e59b-8413-1bfa-7af5b36a4e5b": {
                "sizeX": 25,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "occupancy_sensor_details": {
        "name": "{i18n:custom.diagnostics.states.occupancy-sensor-details}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "33b97c6e-ccca-4677-2ae1-6b8c6339f036": {
                "sizeX": 80,
                "sizeY": 3,
                "row": 0,
                "col": 0
              },
              "96f25bbc-79bc-c367-440b-e4bb292f7656": {
                "sizeX": 80,
                "sizeY": 37,
                "row": 3,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 80,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "occupancy_sensor_settings": {
        "name": "{i18n:custom.diagnostics.states.occupancy-sensor-settings}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "9ab503a5-3c68-5dfb-d55a-8672bf48ada9": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "motion_sensor_details": {
        "name": "{i18n:custom.diagnostics.states.motion-sensor-details}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "49056eb9-3240-4315-84e8-73ea065e4652": {
                "sizeX": 80,
                "sizeY": 3,
                "row": 0,
                "col": 0
              },
              "bb3e4bc4-7f69-b8df-c554-dfdffd83a4dc": {
                "sizeX": 80,
                "sizeY": 37,
                "row": 3,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 80,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "motion_sensor_settings": {
        "name": "{i18n:custom.diagnostics.states.motion-sensor-settings}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "5364ac11-0129-8771-7bb1-67718bd3efda": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "all_critical_alarms": {
        "name": "{i18n:custom.diagnostics.states.all-critical-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "d680c934-edcf-4cf0-7073-cc1fb4530391": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "all_major_alarms": {
        "name": "{i18n:custom.diagnostics.states.all-major-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "106a5add-e710-6fea-e975-a7f9b61e2802": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "all_alarm_badges": {
        "name": "{i18n:custom.diagnostics.states.all-alarm-badges}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "8805b23e-efea-86a7-d754-9fdfe37acbaa": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "pflow_details": {
        "name": "{i18n:custom.diagnostics.states.pflow-details}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "d966cfd6-93e9-74cf-efa6-67911dffedfd": {
                "sizeX": 80,
                "sizeY": 38,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 0,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "roomsensort_details": {
        "name": "{i18n:custom.diagnostics.states.roomsensor-t-details}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "d4b83442-1ea0-9415-6a0b-1f7935f9bd7c": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 0,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "roomsensorco2_details": {
        "name": "{i18n:custom.diagnostics.states.roomsensor-co2-details}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "87fc8197-77df-8eb8-ad06-b3adf7dfd24a": {
                "sizeX": 80,
                "sizeY": 43,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 0,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "pflow_settings": {
        "name": "{i18n:custom.diagnostics.states.pflow-settings}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ab49ec6b-ce93-15dd-53ea-c67bb6a2c01c": {
                "sizeX": 80,
                "sizeY": 27,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "roomsensorco2_settings": {
        "name": "{i18n:custom.diagnostics.states.room-sensor-co2-settings}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "c44b1059-5a11-90ca-1bfe-fece6fa42852": {
                "sizeX": 80,
                "sizeY": 23,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "roomsensorco2_details_full": {
        "name": "{i18n:custom.diagnostics.states.room-sensor-co2}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2bc5f64c-7fee-8bb6-336d-8a2cbf961524": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 12,
                "col": 0
              },
              "cf5253e9-b2c8-ac67-491f-282c24015c21": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 12,
                "col": 40
              },
              "e9207298-bc6a-64ad-e3db-5643079ea688": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 32,
                "col": 0
              },
              "680c4c4a-31e7-b07f-1679-38b96e3d9805": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 32,
                "col": 40
              },
              "aa210274-7e83-dd1e-76a8-d529b493763a": {
                "sizeX": 40,
                "sizeY": 8,
                "row": 4,
                "col": 0
              },
              "4da35c6f-23cf-8e97-0199-31df847bf881": {
                "sizeX": 14,
                "sizeY": 8,
                "row": 4,
                "col": 40
              },
              "9a1a3549-3407-a31b-ed9a-78818516d3e0": {
                "sizeX": 13,
                "sizeY": 8,
                "row": 4,
                "col": 54
              },
              "28432f7d-12b7-a81d-208e-27e2710ac818": {
                "sizeX": 13,
                "sizeY": 8,
                "row": 4,
                "col": 67
              },
              "27f8ed33-fd9a-5dba-0121-70f6b5c3991b": {
                "sizeX": 80,
                "sizeY": 4,
                "row": 0,
                "col": 0
              },
              "2179cb06-cda4-771a-810d-2f978012b858": {
                "sizeX": 40,
                "sizeY": 16,
                "row": 52,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "roomsensort_details_full": {
        "name": "{i18n:custom.diagnostics.states.room-sensor-t}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6917478a-b64c-bf6f-8a55-92f1704fc6b5": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 12,
                "col": 0
              },
              "070179fc-7774-89e8-ec56-1ef4f1c1c8b8": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 12,
                "col": 40
              },
              "7f5d298e-ace3-6483-1092-1c6b50934a19": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 32,
                "col": 0
              },
              "a840f0bb-80fb-abca-4576-801d29551ba0": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 32,
                "col": 40
              },
              "b4c2a5f0-b2d3-af37-7585-f2ea20fd928a": {
                "sizeX": 40,
                "sizeY": 8,
                "row": 4,
                "col": 0
              },
              "3ae8dcc8-ab98-9029-9ce7-ef3278d38a4b": {
                "sizeX": 20,
                "sizeY": 8,
                "row": 4,
                "col": 40
              },
              "c8f8d8bd-675c-fa4c-5347-f86d3bf18bc0": {
                "sizeX": 20,
                "sizeY": 8,
                "row": 4,
                "col": 60
              },
              "eb0fd3f6-1a82-f6d5-8986-6c000af388be": {
                "sizeX": 80,
                "sizeY": 4,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "roomsensort_settings": {
        "name": "{i18n:custom.diagnostics.states.roomsensor-t-settings}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4ac2a89e-42b7-ebfb-eae1-e881e40943af": {
                "sizeX": 80,
                "sizeY": 40,
                "row": 4,
                "col": 0
              },
              "956f112c-836d-5fdb-4697-320d30c41d2b": {
                "sizeX": 80,
                "sizeY": 4,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "pflow_details_day": {
        "name": "{i18n:custom.diagnostics.states.pflow-details-day}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "29c4ec73-3130-f5e7-5f6f-fa646591108e": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 0,
                "col": 0
              },
              "5661ff7b-5b0c-bd01-4898-2dfda22776dd": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 0,
                "col": 40
              },
              "e3277349-ad52-3e0a-015c-f260a68bb0cf": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 20,
                "col": 0
              },
              "3d4965dd-8090-5d23-d81e-231301edd42f": {
                "sizeX": 40,
                "sizeY": 20,
                "row": 20,
                "col": 40
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "details_heating": {
        "name": "{i18n:custom.diagnostics.states.details-heating}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "87314bbb-97ef-cc18-88c5-b27cb0d97bdf": {
                "sizeX": 24,
                "sizeY": 20,
                "row": 0,
                "col": 0
              },
              "e8e3d4be-2720-0677-2c04-ff9a5fdb2447": {
                "sizeX": 24,
                "sizeY": 7,
                "row": 20,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "details_cooling": {
        "name": "{i18n:custom.diagnostics.states.details-cooling}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f337da30-2ec6-4c29-ee85-8d63e210b4e4": {
                "sizeX": 24,
                "sizeY": 20,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "details_co2": {
        "name": "{i18n:custom.diagnostics.states.details-co2}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {},
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "details_t": {
        "name": "{i18n:custom.diagnostics.states.details-t}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {},
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "pflow_details_header_cooling": {
        "name": "pflow_details_header_cooling",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "477d7249-dc45-1b10-d654-c6dbcd64891f": {
                "sizeX": 24,
                "sizeY": 1,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "pflow_details_header_heating": {
        "name": "pflow_details_header_heating",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2401f1f4-a8fd-a132-a006-588b3ab4ad55": {
                "sizeX": 24,
                "sizeY": 1,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "sensorCO2_details_header": {
        "name": "sensorC02_details_header",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6c236701-eaf6-c11c-77e8-bf54e7b97581": {
                "sizeX": 24,
                "sizeY": 1,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "sensorCO2_header_buttons": {
        "name": "sensorCO2_header_buttons",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "80ed8bf1-aad0-a5a5-535f-6f404f000320": {
                "sizeX": 8,
                "sizeY": 2,
                "row": 0,
                "col": 0
              },
              "ab87c892-d194-6ac8-f5a2-4628926b3e97": {
                "sizeX": 8,
                "sizeY": 2,
                "row": 0,
                "col": 16
              },
              "72261d07-1672-31e6-9d4d-892a6a0a672c": {
                "sizeX": 8,
                "sizeY": 2,
                "row": 0,
                "col": 8
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "sensorT_details_header": {
        "name": "sensorT_details_header",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f119a080-11c4-049c-0f89-17fd12719edb": {
                "sizeX": 24,
                "sizeY": 1,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "sensorT_header_buttons": {
        "name": "sensorT_header_buttons",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "00d6d8b9-bbdc-863a-35e4-24dd4a7efd69": {
                "sizeX": 8,
                "sizeY": 2,
                "row": 0,
                "col": 0
              },
              "f3ac0043-1b43-f234-c053-4d40928ab225": {
                "sizeX": 8,
                "sizeY": 2,
                "row": 0,
                "col": 16
              },
              "51d3fa62-6a83-4c88-e873-fb6a3b88d94b": {
                "sizeX": 8,
                "sizeY": 2,
                "row": 0,
                "col": 8
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "roi": {
        "name": "{i18n:custom.diagnostics.states.roi}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {},
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "layoutType": "default"
            }
          }
        }
      },
      "power_measurement_cooling": {
        "name": "{i18n:custom.diagnostics.states.power-measurement}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "fb3ae59b-bb2f-7bd3-4a88-8b6fc7374aec": {
                "sizeX": 41,
                "sizeY": 3,
                "row": 0,
                "col": 0
              },
              "0186d4b5-cc3c-7b88-d260-b0ad618c5e56": {
                "sizeX": 41,
                "sizeY": 3,
                "row": 0,
                "col": 41
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 81,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Measurements_card": {
        "name": "{i18n:custom.diagnostics.states.measurements-card}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6e0676c2-49cd-846e-9c94-80c6b2c0218c": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": false,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "Measurements_alarms": {
        "name": "{i18n:custom.diagnostics.states.measurements-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "e6cefd55-e905-d7ce-8f86-08635fbe2679": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_card_details": {
        "name": "{i18n:custom.diagnostics.states.measurement-card-details}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "aa7ff32f-7ec6-0a0a-4f83-8903765633e1": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_card_header": {
        "name": "{i18n:custom.diagnostics.states.measurement-card-header}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "e8e3d4be-2720-0677-2c04-ff9a5fdb2447": {
                "sizeX": 24,
                "sizeY": 7,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_alarms": {
        "name": "{i18n:custom.diagnostics.states.measurement-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4c8da7a1-659f-e2e5-220c-4128a217e872": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": false,
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurements_card": {
        "name": "{i18n:custom.diagnostics.states.measurement-card}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "592649d5-d648-e75f-0dc6-5c8ccd94b6d7": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurements_card_mobile": {
        "name": "{i18n:custom.diagnostics.states.measurement-card}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "e3d99119-f445-4079-37e3-7b4992e60521": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_details_cooling_full": {
        "name": "{i18n:custom.diagnostics.states.data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f0dfbf6c-c2b0-2975-eb81-df9748cae9a5": {
                "sizeX": 80,
                "sizeY": 96,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_header_buttons_cooling": {
        "name": "measurement_header_buttons_cooling",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "06eaaf19-559a-967f-7911-9619d9a57607": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 20
              },
              "4e40953b-c12c-d708-164d-5b70bbf2a968": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 40
              },
              "dc347069-3e77-444f-88bc-89244f6b673f": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 60
              },
              "bc6323a3-b6b2-1682-d675-ec84f43d282c": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_header_buttons_heating": {
        "name": "measurement_header_buttons_heating",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "35967d36-4117-f746-7cea-f04152cc3f37": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 20
              },
              "3390e8ee-14d3-1ead-2dc6-4600bc4ae29e": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 40
              },
              "11d78927-a872-be78-96aa-3b4606f174fd": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 60
              },
              "7f1de781-2af6-c3f6-e8aa-4d11c9c637fe": {
                "sizeX": 20,
                "sizeY": 7,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "power_measurement_heating": {
        "name": "{i18n:custom.diagnostics.states.power-measurement}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "f209084b-5a75-d2cf-3d73-fe40d7db1f60": {
                "sizeX": 40,
                "sizeY": 3,
                "row": 0,
                "col": 40
              },
              "439a6caa-89b9-46fe-0daf-b5c2a80e41b3": {
                "sizeX": 40,
                "sizeY": 3,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_details_heating_full": {
        "name": "{i18n:custom.diagnostics.states.data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                "sizeX": 80,
                "sizeY": 70,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": false,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            },
            "breakpoints": {
              "md": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              },
              "sm": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              },
              "xs": {
                "gridSettings": {
                  "backgroundColor": "#EEEEEE",
                  "columns": 80,
                  "margin": 5,
                  "outerMargin": true,
                  "backgroundSizeMode": "auto 100%",
                  "autoFillHeight": false,
                  "backgroundImageUrl": null,
                  "mobileAutoFillHeight": false,
                  "mobileRowHeight": 70,
                  "layoutType": "default",
                  "minColumns": 80,
                  "viewFormat": "list",
                  "rowHeight": 70
                },
                "widgets": {
                  "6ccd99bd-8562-4e6b-e42b-e7f3c026a129": {
                    "sizeX": 80,
                    "sizeY": 70,
                    "row": 0,
                    "col": 0
                  }
                }
              }
            }
          }
        }
      },
      "measurement_settings_cooling": {
        "name": "{i18n:custom.diagnostics.states.measurement-settings}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "27f828db-8b95-3386-8a3a-df9c1f75b737": {
                "sizeX": 80,
                "sizeY": 4,
                "row": 0,
                "col": 0
              },
              "fa4b7c84-2a5a-d1a3-efdc-f4f236fad799": {
                "sizeX": 80,
                "sizeY": 42,
                "row": 4,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_settings_heating": {
        "name": "{i18n:custom.diagnostics.states.measurement-settings}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b632f7ae-1a4c-1cf8-fe73-72b5fe064888": {
                "sizeX": 80,
                "sizeY": 4,
                "row": 0,
                "col": 0
              },
              "30be4621-8d89-f075-23cf-61e291b96f06": {
                "sizeX": 80,
                "sizeY": 42,
                "row": 4,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "Measurement_state_filter": {
        "name": "{i18n:custom.diagnostics.states.measurement-state-filter}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b8f0acc2-6e90-13a7-c7bb-6f67fddc27ea": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_plan": {
        "name": "{i18n:custom.diagnostics.states.plan}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7a37cf70-51c1-aef6-ef15-27041e016bd5": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "state_filter": {
        "name": "{i18n:custom.diagnostics.states.state-filter}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ff1eb384-d7f3-2a33-ca59-2296652ca079": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_filter": {
        "name": "{i18n:custom.diagnostics.states.measurement-filter}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4d269bd2-0e40-1c62-0385-a1ab42115c6d": {
                "sizeX": 24,
                "sizeY": 5,
                "row": 0,
                "col": 0,
                "mobileHeight": 4
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 51,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_data_cooling": {
        "name": "{i18n:custom.diagnostics.states.measurement-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7a36c052-6804-1d2c-f3e9-b9ed5dac5420": {
                "sizeX": 80,
                "sizeY": 20,
                "row": 20,
                "col": 0
              },
              "3fda1b23-00b0-4999-0128-01040c961775": {
                "sizeX": 80,
                "sizeY": 21,
                "row": 40,
                "col": 0
              },
              "fe140916-565b-011d-3429-ac76a7b5cb55": {
                "sizeX": 80,
                "sizeY": 20,
                "row": 0,
                "col": 0
              },
              "11062bbc-f7e6-bc7a-f406-642666929251": {
                "sizeX": 80,
                "sizeY": 21,
                "row": 61,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_data_cooling_header": {
        "name": "{i18n:custom.diagnostics.states.measurement-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b70192cf-42b2-333a-0301-e057bf2eec00": {
                "sizeX": 20,
                "sizeY": 9,
                "row": 0,
                "col": 40
              },
              "d697b7ec-551e-fe5b-5f4f-ac78e4e5207c": {
                "sizeX": 20,
                "sizeY": 9,
                "row": 0,
                "col": 60
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_report_cooling_header": {
        "name": "{i18n:custom.diagnostics.states.measurement-report}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2b8ba61e-2750-15df-bc70-07cc290cbe83": {
                "sizeX": 40,
                "sizeY": 9,
                "row": 0,
                "col": 40
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_report_heating_header": {
        "name": "{i18n:custom.diagnostics.states.measurement-report}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "db99f5e8-955e-55c4-31b5-1d05c028cc4c": {
                "sizeX": 40,
                "sizeY": 9,
                "row": 0,
                "col": 40
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "measurement_data_heating": {
        "name": "{i18n:custom.diagnostics.states.measurement-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "60492841-691e-4aaf-2079-661426ccd30d": {
                "sizeX": 80,
                "sizeY": 20,
                "row": 0,
                "col": 0,
                "resizable": true,
                "mobileHeight": null
              },
              "96ce98de-c2ee-4d11-1317-208ab21d346c": {
                "sizeX": 80,
                "sizeY": 20,
                "row": 20,
                "col": 0
              },
              "4e1a1bc0-e7a2-a7db-3486-930af4fef035": {
                "sizeX": 80,
                "sizeY": 21,
                "row": 40,
                "col": 0
              },
              "a5acf8ea-5bf2-ebfd-0358-f5882accb3f0": {
                "sizeX": 80,
                "sizeY": 21,
                "row": 61,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_data_heating_header": {
        "name": "{i18n:custom.diagnostics.states.measurement-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "6ba7fe94-7200-fc06-9ad8-21cb0cf36479": {
                "sizeX": 20,
                "sizeY": 9,
                "row": 0,
                "col": 40
              },
              "37fbc640-6df7-6604-0f78-68b1285679ee": {
                "sizeX": 20,
                "sizeY": 9,
                "row": 0,
                "col": 60
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 80,
              "margin": 5,
              "outerMargin": true,
              "backgroundSizeMode": "auto 100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "sensors": {
        "name": "{i18n:custom.diagnostics.states.sensors}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "3ca713e9-31b0-85f5-bf19-a706095abeda": {
                "sizeX": 80,
                "sizeY": 37,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 80,
              "margin": 5,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 80,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "sensor_data": {
        "name": "{i18n:custom.diagnostics.states.sensor-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7af6c9bf-4916-efb4-59db-6ed309edbdde": {
                "sizeX": 24,
                "sizeY": 16,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "layoutType": "default",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "sensor_charts_co2": {
        "name": "{i18n:custom.diagnostics.states.sensor-charts}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "649f24ef-7d15-4059-3823-0d81c54101dc": {
                "sizeX": 41,
                "sizeY": 19,
                "row": 0,
                "col": 0,
                "resizable": true,
                "preserveAspectRatio": false
              },
              "ed5da7c5-02bf-09c0-3f12-caefcbf36cd7": {
                "sizeX": 21,
                "sizeY": 4,
                "row": 58,
                "col": 40,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "ae4fa934-fc77-b9e5-8920-9987b32dbab6": {
                "sizeX": 20,
                "sizeY": 4,
                "row": 58,
                "col": 20,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "720d70c4-8845-3052-43de-be6d8fc98a01": {
                "sizeX": 20,
                "sizeY": 4,
                "row": 58,
                "col": 0,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "4dcb82fa-72ef-14e3-c54a-44dbc36eb417": {
                "sizeX": 20,
                "sizeY": 4,
                "row": 58,
                "col": 61,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "0486fd1e-360b-e18d-3e9a-c43c555cc0fe": {
                "sizeX": 21,
                "sizeY": 8,
                "row": 68,
                "col": 16,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "b381d5dc-4a65-04e6-4fb0-54c8d14e4f75": {
                "sizeX": 13,
                "sizeY": 16,
                "row": 62,
                "col": 1,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "9191c815-bbc9-daf4-ed0e-c73b6a48d5b3": {
                "sizeX": 41,
                "sizeY": 19,
                "row": 19,
                "col": 0,
                "resizable": true,
                "preserveAspectRatio": true
              },
              "c34e7990-7ac7-ffb3-53a5-813b423bcba6": {
                "sizeX": 41,
                "sizeY": 19,
                "preserveAspectRatio": false,
                "resizable": true,
                "row": 19,
                "col": 41
              },
              "d41b3d58-d35d-7b1c-a192-04278ec02f88": {
                "sizeX": 41,
                "sizeY": 19,
                "preserveAspectRatio": false,
                "resizable": true,
                "row": 0,
                "col": 41
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 80,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "autoFillHeight": false,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 40,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "sensor_charts_t": {
        "name": "{i18n:custom.diagnostics.states.sensor-charts}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "01b57f7f-f414-bc7c-6812-5dd5225647fd": {
                "sizeX": 41,
                "sizeY": 24,
                "row": 5,
                "col": 0
              },
              "5f3c6baf-c439-2035-55d8-452f2b4189bc": {
                "sizeX": 27,
                "sizeY": 5,
                "row": 0,
                "col": 0
              },
              "9fa6ddf2-ac2f-6bda-b319-c1f14e2282fb": {
                "sizeX": 27,
                "sizeY": 5,
                "row": 0,
                "col": 27
              },
              "2b1276c2-7a3f-5a63-4c80-04cdde36f526": {
                "sizeX": 27,
                "sizeY": 5,
                "row": 0,
                "col": 54
              },
              "843ceccf-46a3-26d5-6d27-43da879d2274": {
                "sizeX": 41,
                "sizeY": 25,
                "row": 29,
                "col": 0
              },
              "c12fb268-5630-0789-3a3d-b1603bfe590f": {
                "sizeX": 40,
                "sizeY": 25,
                "row": 29,
                "col": 41
              },
              "83485f16-ee24-9e2d-7272-aec8d40e9a4b": {
                "sizeX": 40,
                "sizeY": 24,
                "row": 5,
                "col": 41
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 81,
              "margin": 5,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "layoutType": "default",
              "minColumns": 81,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "projects_card": {
        "name": "{i18n:custom.diagnostics.states.project-administration}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "62bee3d4-61ba-6a86-0a99-a34e46518cff": {
                "sizeX": 24,
                "sizeY": 15,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "all_measurements_card": {
        "name": "{i18n:custom.diagnostics.states.measurements}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "a5b8a12b-275c-986c-6a8c-6550f4387837": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "projects_card_tenant": {
        "name": "{i18n:custom.diagnostics.states.project-administration}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ac58fb06-a63f-26ea-d465-8532c8124780": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "projects": {
        "name": "{i18n:custom.diagnostics.states.project-administration}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "e422fc82-62a4-8372-2e84-134b0bc789cc": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#EEEEEE",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "all_measurements": {
        "name": "{i18n:custom.diagnostics.states.measurement-administration}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "8c0dc9e5-4621-44d6-8d59-270d531417c6": {
                "sizeX": 25,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "projects_map": {
        "name": "{i18n:custom.diagnostics.states.projects-map}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "fb583db5-3fc6-275a-34f4-120bfe140af2": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "edit_measurement_alias": {
        "name": "{i18n:custom.diagnostics.states.edit-measurement-alias}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "a13d46ba-5bac-f5a0-4a1a-246e7d695a3b": {
                "sizeX": 20,
                "sizeY": 4,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 20,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 12,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_devices": {
        "name": "{i18n:custom.diagnostics.states.measurement-devices}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "759db6af-2a40-7230-b19d-1b24ed66efff": {
                "sizeX": 29,
                "sizeY": 16,
                "desktopHide": false,
                "row": 0,
                "col": 0,
                "resizable": true
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "edit_project_alias": {
        "name": "{i18n:custom.diagnostics.states.edit-project-alias}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "8a9cf679-044c-bc77-c1f3-8d6e3dd7f76e": {
                "sizeX": 24,
                "sizeY": 10,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_details_plan": {
        "name": "measurement_details_plan",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "459728d3-2563-a76e-58c5-897af4411d74": {
                "sizeX": 15,
                "sizeY": 11,
                "row": 1,
                "col": 0
              },
              "a5a5575c-dac4-7d8a-0422-9a7754f2eab7": {
                "sizeX": 9,
                "sizeY": 11,
                "row": 1,
                "col": 15
              },
              "54cd8c20-b988-d755-8a92-901c3475f24a": {
                "sizeX": 24,
                "sizeY": 1,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "measurement_details_raw_data": {
        "name": "${selectedMeasurement:entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "9333c78c-4b79-3cb7-6a73-9ff3c7cdfa32": {
                "sizeX": 24,
                "sizeY": 1,
                "row": 0,
                "col": 0
              },
              "5e539fb5-9647-9ddb-baa4-a7b57b0d5cb7": {
                "sizeX": 15,
                "sizeY": 12,
                "row": 1,
                "col": 0
              },
              "9a7e456f-6613-ec74-93bc-1c1934b055ee": {
                "sizeX": 9,
                "sizeY": 12,
                "row": 1,
                "col": 15
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%"
            }
          }
        }
      },
      "measurement_raw_data": {
        "name": "{i18n:custom.diagnostics.states.measurement-raw-data}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "910346c6-1cf8-53c5-1aa1-9720fd4fccc5": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "projects_alarms": {
        "name": "{i18n:custom.diagnostics.states.projects-alarms}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "58b917d2-5768-b5f9-1e78-e45c9491f4f5": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "add_plan": {
        "name": "{i18n:custom.diagnostics.states.add-plan}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "bc5add29-c832-b4b5-6d04-211838ea4b9e": {
                "sizeX": 25,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "signal_strength": {
        "name": "{i18n:custom.diagnostics.states.signal-strength}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "5d53c923-2245-6a3e-fcdd-ce0690d0424d": {
                "sizeX": 25,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_details_loraWan": {
        "name": "${selectedMeasurement:entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "11d63521-4382-92a5-e1db-85f466d4ebb6": {
                "sizeX": 96,
                "sizeY": 5,
                "row": 50,
                "col": 0,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "ae26d592-56d5-26b1-f755-3f1511e8572e": {
                "sizeX": 96,
                "sizeY": 62,
                "row": 55,
                "col": 0,
                "resizable": true,
                "preserveAspectRatio": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "39587e2b-40bb-0159-51d2-b73048880da1": {
                "sizeX": 96,
                "sizeY": 50,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 96,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_details_ultrasonic": {
        "name": "${selectedMeasurement:entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "34bb2f8f-4bf0-dac4-a017-badfac3e31bb": {
                "sizeX": 123,
                "sizeY": 77,
                "row": 107,
                "col": 0,
                "mobileHide": true,
                "resizable": true,
                "desktopHide": true
              },
              "ffbfe096-2667-28d1-7142-e25b1de3fd5d": {
                "sizeX": 69,
                "sizeY": 77,
                "row": 107,
                "col": 123,
                "resizable": true,
                "preserveAspectRatio": false,
                "mobileHide": true,
                "desktopHide": true
              },
              "0b0d0bdd-688f-a26b-aec4-aee6d6d2e295": {
                "sizeX": 192,
                "sizeY": 7,
                "row": 100,
                "col": 0,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "8891fc49-6afe-386d-e186-465e9ff47747": {
                "sizeX": 192,
                "sizeY": 100,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#EEEEEE",
              "columns": 192,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default",
              "minColumns": 48,
              "viewFormat": "grid",
              "rowHeight": 70
            }
          }
        }
      },
      "measurement_details": {
        "name": "${selectedMeasurement:entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "61ecec7e-cd3d-1428-867e-0005238a0498": {
                "sizeX": 52,
                "sizeY": 27,
                "row": 0,
                "col": 0
              },
              "39587e2b-40bb-0159-51d2-b73048880da1": {
                "sizeX": 96,
                "sizeY": 50,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 48,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 48,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "all_projects": {
        "name": "{i18n:custom.diagnostics.states.all-projects}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2ffda43e-cad2-521c-6871-338d15b3b4cc": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_plan_user": {
        "name": "{i18n:custom.diagnostics.states.measurement-plan}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b9d5f40b-23fd-c0b3-f832-470963eecfab": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "project_card_header": {
        "name": "{i18n:custom.diagnostics.states.projects-card}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "b84de4e1-8a84-b5cc-6b10-19292fefbb45": {
                "sizeX": 24,
                "sizeY": 7,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "pflow_details___copy_1": {
        "id": "pflow_details___copy_1",
        "name": "pflow_details - Copy 1",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "64adf920-925b-142a-4930-757da20d765c": {
                "sizeX": 85,
                "sizeY": 38,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 80,
              "margin": 0,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      },
      "home_dashboard_widgets": {
        "name": "{i18n:custom.diagnostics.states.home-dashboard-widgets}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "dc35f902-3824-8f1b-a870-fee55664d0bd": {
                "sizeX": 15,
                "sizeY": 11,
                "row": 0,
                "col": 0
              },
              "b2beb7ce-103a-560f-cf9c-b7df21827bf0": {
                "sizeX": 9,
                "sizeY": 11,
                "row": 0,
                "col": 15
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_details_ultrasonic_widgets": {
        "name": "measurement details ultrasonic widgets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "36164ff1-d530-f9fa-168f-841b2190d1ff": {
                "sizeX": 15,
                "sizeY": 12,
                "row": 0,
                "col": 0
              },
              "cdb435a1-59ea-074f-1456-0d8505f6cd18": {
                "sizeX": 9,
                "sizeY": 12,
                "preserveAspectRatio": false,
                "resizable": true,
                "row": 0,
                "col": 15
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "measurement_details_lorawan_widgets": {
        "name": "measurement details lorawan widgets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "2c00789b-b7c4-ccf2-39a8-ee138226f777": {
                "sizeX": 24,
                "sizeY": 15,
                "preserveAspectRatio": true,
                "resizable": true,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": false,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "selected_project_map": {
        "name": "{i18n:custom.diagnostics.states.selected-project-map}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "0ff674a9-4e70-3742-720a-e681566c9b4f": {
                "sizeX": 7,
                "sizeY": 9,
                "row": 14,
                "col": 0,
                "resizable": true,
                "mobileHide": true,
                "desktopHide": true
              },
              "f2279347-4693-4b0a-17c2-15d2887559fa": {
                "sizeX": 24,
                "sizeY": 14,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "layoutType": "default",
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 10,
              "outerMargin": false,
              "backgroundSizeMode": "100%",
              "minColumns": 24,
              "viewFormat": "grid",
              "autoFillHeight": true,
              "rowHeight": 70,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "roomsensort_details___copy_1": {
        "id": "roomsensort_details___copy_1",
        "name": "roomsensorT_details - Copy 1",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "9fcb2ae1-cc3c-dc5a-9e1e-78830a5076f7": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#FFFFFF",
              "columns": 24,
              "margin": 0,
              "outerMargin": true,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "layoutType": "default"
            }
          }
        }
      }
    },
    "entityAliases": {
      "783dd5f0-d34d-946d-a82f-95d3a6eaadd1": {
        "id": "783dd5f0-d34d-946d-a82f-95d3a6eaadd1",
        "alias": "Doktorkits",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetNameFilter": "",
          "assetTypes": [
            "Doktorkit"
          ]
        }
      },
      "1d799daf-1882-7a76-938b-c97e8c08ff11": {
        "id": "1d799daf-1882-7a76-938b-c97e8c08ff11",
        "alias": "Selected Doktorkit",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null
        }
      },
      "129977b6-de2f-546b-7df8-2040f39f8732": {
        "id": "129977b6-de2f-546b-7df8-2040f39f8732",
        "alias": "Doktorkit Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Chiller",
            "Freezer",
            "Smart Shelf",
            "Smart Bin",
            "Door Sensor",
            "Liquid Level Sensor",
            "Occupancy Sensor",
            "Smoke Sensor",
            "Motion Sensor",
            "P-Flow D116",
            "Room Sensor CO2",
            "Room",
            "Room Sensor T"
          ]
        }
      },
      "7b659beb-1601-5b67-528e-0846d1a0efa6": {
        "id": "7b659beb-1601-5b67-528e-0846d1a0efa6",
        "alias": "Current user",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "b755362a-b545-8ee6-a67b-df2c9e39d6e5": {
        "id": "b755362a-b545-8ee6-a67b-df2c9e39d6e5",
        "alias": "Selected device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null
        }
      },
      "cdf692dd-915b-cdc8-7b51-fc8980c44135": {
        "id": "cdf692dd-915b-cdc8-7b51-fc8980c44135",
        "alias": "Door Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Door Sensor"
          ]
        }
      },
      "15130463-060f-d497-b4ee-39cfc42d3096": {
        "id": "15130463-060f-d497-b4ee-39cfc42d3096",
        "alias": "Occupancy Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Occupancy Sensor"
          ]
        }
      },
      "88fa493d-e8a6-93b9-1d99-ee3d9cbe8487": {
        "id": "88fa493d-e8a6-93b9-1d99-ee3d9cbe8487",
        "alias": "Smoke Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Smoke Sensor"
          ]
        }
      },
      "6073fc37-70ca-4537-f15a-c7dbdd56b343": {
        "id": "6073fc37-70ca-4537-f15a-c7dbdd56b343",
        "alias": "Motion Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDoktorkit",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Motion Sensor"
          ]
        }
      },
      "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82": {
        "id": "6c0a1eb1-b0e7-1578-a4f0-c0e0c8a77c82",
        "alias": "Current owner",
        "filter": {
          "type": "singleEntity",
          "resolveMultiple": false,
          "singleEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          }
        }
      },
      "b41759e3-cb61-1aaf-8b24-856e5f5a3889": {
        "id": "b41759e3-cb61-1aaf-8b24-856e5f5a3889",
        "alias": "P-Flow D116",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "P-Flow D116"
          ]
        }
      },
      "a1259275-97cf-904a-15a9-9e107522eb5f": {
        "id": "a1259275-97cf-904a-15a9-9e107522eb5f",
        "alias": "Room Sensors T",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor T"
          ]
        }
      },
      "5d6907db-bad0-623f-389a-47e7ee2981b0": {
        "id": "5d6907db-bad0-623f-389a-47e7ee2981b0",
        "alias": "Room Sensors CO2",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor CO2"
          ]
        }
      },
      "d63f1302-8c37-ca6d-76ff-033d16969b1a": {
        "id": "d63f1302-8c37-ca6d-76ff-033d16969b1a",
        "alias": "SelectedEntity",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "SelectedEntity",
          "defaultStateEntity": {
            "entityType": "ASSET",
            "id": "feca5d50-6906-11ef-9bb9-b94f875dce3b"
          }
        }
      },
      "432d69f7-88cf-15c4-69ef-6ea4f27aac50": {
        "id": "432d69f7-88cf-15c4-69ef-6ea4f27aac50",
        "alias": "Selected Doktorkit1",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": false,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedDevice",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "TO",
          "maxLevel": 1,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "assetTypes": [
            "Doktorkit"
          ]
        }
      },
      "d873a1ea-6540-b9dc-b254-70b2900a45d9": {
        "id": "d873a1ea-6540-b9dc-b254-70b2900a45d9",
        "alias": "Single Device",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": null,
          "defaultStateEntity": null
        }
      },
      "ae29d67c-e1c3-0479-1e39-9207f44f9990": {
        "id": "ae29d67c-e1c3-0479-1e39-9207f44f9990",
        "alias": "All P-Flows",
        "filter": {
          "type": "deviceType",
          "resolveMultiple": true,
          "deviceTypes": [
            "P-Flow D116"
          ],
          "deviceNameFilter": ""
        }
      },
      "a5025959-4eb0-bbfb-1bef-115e0c344ebf": {
        "id": "a5025959-4eb0-bbfb-1bef-115e0c344ebf",
        "alias": "Measurement",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Measurement"
          ],
          "assetNameFilter": ""
        }
      },
      "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9": {
        "id": "a05e02ae-75d9-4410-c6f7-17ceb5a28ba9",
        "alias": "Selected Measurement",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null
        }
      },
      "cd72a6f3-8ac8-11ef-aa7b-13581cf4c95d": {
        "id": "cd72a6f3-8ac8-11ef-aa7b-13581cf4c95d",
        "alias": "All Entities: Measurement",
        "filter": {
          "resolveMultiple": true,
          "type": "assetType",
          "assetNameFilter": "",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "e84cedc2-95ee-c038-4d48-ef91acc6a4cc": {
        "id": "e84cedc2-95ee-c038-4d48-ef91acc6a4cc",
        "alias": "Temperature Sensor",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": true,
          "relationType": "Contains",
          "deviceTypes": [
            "Temperature Sensor"
          ]
        }
      },
      "f3843d4e-b8c6-a299-fb02-e522271f7c35": {
        "id": "f3843d4e-b8c6-a299-fb02-e522271f7c35",
        "alias": "sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 2,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Room Sensor CO2",
            "Room Sensor T"
          ]
        }
      },
      "70ff25cd-3d47-b7fc-05e1-765294946bf0": {
        "id": "70ff25cd-3d47-b7fc-05e1-765294946bf0",
        "alias": "Measurement Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement",
          "deviceTypes": [
            "Room Sensor CO2",
            "Room Sensor T"
          ]
        }
      },
      "2ad8a8aa-5f43-9902-6258-79e6421b1fb2": {
        "id": "2ad8a8aa-5f43-9902-6258-79e6421b1fb2",
        "alias": "Projects",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Project"
          ]
        }
      },
      "b0061bd7-595f-a375-e74c-115b41049852": {
        "id": "b0061bd7-595f-a375-e74c-115b41049852",
        "alias": "Measurements",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "3e0192c2-97b8-b3a1-2a43-399659e8d7e1": {
        "id": "3e0192c2-97b8-b3a1-2a43-399659e8d7e1",
        "alias": "All Projects",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Project"
          ],
          "assetNameFilter": ""
        }
      },
      "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce": {
        "id": "1c43e3cf-6ca2-f2f1-65c0-45d7b82735ce",
        "alias": "Selected Project",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null
        }
      },
      "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6": {
        "id": "6a54233e-e9c7-7e5d-626b-c1cf3a0a30a6",
        "alias": "Project",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetTypes": [
            "Project"
          ],
          "assetNameFilter": ""
        }
      },
      "906dd8e6-abf4-bc27-7499-1318cb35ac80": {
        "id": "906dd8e6-abf4-bc27-7499-1318cb35ac80",
        "alias": "Measurement Devices1",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement",
          "deviceTypes": [
            "P-Flow D116",
            "Temperature Sensor",
            "Room Sensor T",
            "Room Sensor CO2",
            "RESI",
            "LTE Status",
            "LoRaWAN Gateway"
          ]
        }
      },
      "0995cad1-8408-0071-28a7-c305d95429e2": {
        "id": "0995cad1-8408-0071-28a7-c305d95429e2",
        "alias": "Project Measurements",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedProject",
          "defaultStateEntity": null,
          "rootEntity": {
            "entityType": "CURRENT_CUSTOMER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "Measurement"
          ]
        }
      },
      "0aeb5a06-c961-6c9b-d253-199be04f61c5": {
        "id": "0aeb5a06-c961-6c9b-d253-199be04f61c5",
        "alias": "VR Pflow",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "P-Flow D116 VR"
          ]
        }
      },
      "e043f69e-804d-8e1d-062c-7da5becf5b51": {
        "id": "e043f69e-804d-8e1d-062c-7da5becf5b51",
        "alias": "Room Sensor CO2 VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Room Sensor CO2 VR"
          ]
        }
      },
      "430f6413-271a-248e-ea6f-7bfd6fd1f9f6": {
        "id": "430f6413-271a-248e-ea6f-7bfd6fd1f9f6",
        "alias": "Gateway VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Gateway VR"
          ]
        }
      },
      "e23ea274-9aa0-8938-2b73-ff48762a93fc": {
        "id": "e23ea274-9aa0-8938-2b73-ff48762a93fc",
        "alias": "Temperature Sensors VR",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedMeasurement",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Measurement VR",
          "deviceTypes": [
            "Temperature Sensor VR"
          ]
        }
      }
    },
    "filters": {
      "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8": {
        "id": "3a46fadd-6a79-1f15-1c39-f7f0a30ab5f8",
        "filter": "Device filter",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smart Shelf",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displaySmartShelf",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Freezer",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFreezer",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Chiller",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayChiller",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smart Bin",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayWasteBin",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Door Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayDoorSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Liquid Level Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayLiquidLevelSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Motion Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMotionSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Occupancy Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayOccupancySensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Smoke Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displaySmokeSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "P-Flow D116",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPFlowD116",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Room Sensor T",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayRoomSensorT",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Room Sensor CO2",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayRoomSensorCO2",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "Temperature Sensor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayTemperatureSensor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          },
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "state"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "critical",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayCritical",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "major",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMajor",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "normal",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayNormal",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          },
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "active"
            },
            "valueType": "BOOLEAN",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": true,
                          "dynamicValue": null
                        },
                        "type": "BOOLEAN"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": false,
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayDisconnected",
                            "inherit": false
                          }
                        },
                        "type": "BOOLEAN"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "35492bf9-fb1b-d326-8b75-f0c24db7a976": {
        "id": "35492bf9-fb1b-d326-8b75-f0c24db7a976",
        "filter": "State filter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "state"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "normal",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayNormalDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "critical",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayCriticalDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "major",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMajorDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "minor",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayMinorDoktorkit",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "2d011a64-3af4-277a-980d-904145c28912": {
        "id": "2d011a64-3af4-277a-980d-904145c28912",
        "filter": "Progress filter",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "progress"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preparation",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPreparationMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "active",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayActiveMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "finished",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFinishedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "aborted",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayAbortedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preperation",
                          "dynamicValue": null
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "dfd37bd2-bb12-d529-9ea0-999958063eb5": {
        "id": "dfd37bd2-bb12-d529-9ea0-999958063eb5",
        "filter": "Progress filter projects",
        "keyFilters": [
          {
            "key": {
              "type": "ATTRIBUTE",
              "key": "progress"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "OR",
                  "predicates": [
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preparation",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayPreparationMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "active",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayActiveMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "finished",
                          "dynamicValue": {
                            "sourceType": "CURRENT_USER",
                            "sourceAttribute": "displayFinishedMeasurement",
                            "inherit": false
                          }
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    },
                    {
                      "keyFilterPredicate": {
                        "operation": "EQUAL",
                        "value": {
                          "defaultValue": "in preperation",
                          "dynamicValue": null
                        },
                        "ignoreCase": false,
                        "type": "STRING"
                      },
                      "userInfo": {
                        "editable": true,
                        "label": "",
                        "autogeneratedLabel": true,
                        "order": 0
                      }
                    }
                  ],
                  "type": "COMPLEX"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "409ee35d-10ed-b257-7161-3ee1d74855a5": {
        "id": "409ee35d-10ed-b257-7161-3ee1d74855a5",
        "filter": "CO2",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Room Sensor CO2",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "1c512dc2-e762-a4d6-a30a-dc26cd05d381": {
        "id": "1c512dc2-e762-a4d6-a30a-dc26cd05d381",
        "filter": "Temp",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Room Sensor T",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      },
      "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09": {
        "id": "ef4e6f57-8c73-bf88-47e1-1fbe0acc7f09",
        "filter": "Project",
        "keyFilters": [
          {
            "key": {
              "type": "ENTITY_FIELD",
              "key": "type"
            },
            "valueType": "STRING",
            "predicates": [
              {
                "keyFilterPredicate": {
                  "operation": "EQUAL",
                  "value": {
                    "defaultValue": "Project",
                    "dynamicValue": null
                  },
                  "ignoreCase": false,
                  "type": "STRING"
                },
                "userInfo": {
                  "editable": true,
                  "label": "",
                  "autogeneratedLabel": true,
                  "order": 0
                }
              }
            ]
          }
        ],
        "editable": false
      }
    },
    "timewindow": {
      "aggregation": {
        "limit": 50000,
        "type": "NONE"
      },
      "hideAggInterval": true,
      "hideAggregation": true,
      "history": {
        "historyType": 1,
        "fixedTimewindow": {
          "startTimeMs": 1767792855590,
          "endTimeMs": 1769002455590
        }
      },
      "selectedTab": 1
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": true,
      "showEntitiesSelect": false,
      "showDashboardTimewindow": true,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true,
      "titleColor": "rgba(0,0,0,0.870588)",
      "showDashboardLogo": false,
      "dashboardLogoUrl": null,
      "hideToolbar": false,
      "showFilters": true,
      "showUpdateDashboardImage": false,
      "dashboardCss": ".tb-widget-container > .tb-widget {\n    border-radius: 8px;\n}\n\n.tb-widget-container {\n    border-radius: 8px;\n}\n\n\ngridster-item:not(.tb-noselect) > .tb-widget-container > .tb-widget {\n    cursor: default !important;\n}\n\n.tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-row {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-legend-keys {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-markdown-view .tb-progress-cover, .tb-widget-container > .tb-widget .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-widget-container > .tb-widget .tb-markdown-view div, .tb-widget-container > .tb-widget .tb-markdown-view p {\n    line-height: normal;\n}\n\n"
    }
  },
  "name": "Measurements",
  "resources": null,
  "id": {
    "entityType": "DASHBOARD",
    "id": "d086f510-f6be-11f0-adb4-33b9bcf3ddd0"
  },
  "createdTime": 1768995985121,
  "tenantId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  },
  "customerId": null,
  "assignedCustomers": null,
  "externalId": {
    "entityType": "DASHBOARD",
    "id": "d086f510-f6be-11f0-adb4-33b9bcf3ddd0"
  },
  "version": 100,
  "ownerId": {
    "entityType": "TENANT",
    "id": "efb63c10-b576-11ee-a6c2-a149ed03c64d"
  }
}