{
  "widget": {
    "typeFullFqn": "system.map",
    "type": "latest",
    "sizeX": 8.5,
    "sizeY": 6,
    "config": {
      "datasources": [],
      "timewindow": {
        "displayValue": "",
        "selectedTab": 0,
        "realtime": {
          "realtimeType": 1,
          "interval": 1000,
          "timewindowMs": 60000,
          "quickInterval": "CURRENT_DAY",
          "hideInterval": false,
          "hideLastInterval": false,
          "hideQuickInterval": false
        },
        "history": {
          "historyType": 0,
          "interval": 1000,
          "timewindowMs": 60000,
          "fixedTimewindow": {
            "startTimeMs": 1745755787013,
            "endTimeMs": 1745842187013
          },
          "quickInterval": "CURRENT_DAY",
          "hideInterval": false,
          "hideLastInterval": false,
          "hideFixedInterval": false,
          "hideQuickInterval": false
        },
        "aggregation": {
          "type": "AVG",
          "limit": 50000
        }
      },
      "showTitle": true,
      "backgroundColor": "rgba(0, 0, 0, 0)",
      "color": "rgba(0, 0, 0, 0.87)",
      "padding": "0px",
      "settings": {
        "mapType": "geoMap",
        "layers": [
          {
            "label": "{i18n:widgets.maps.layer.roadmap}",
            "provider": "openstreet",
            "layerType": "CartoDB.Positron",
            "referenceLayer": null
          },
          {
            "label": "{i18n:widgets.maps.layer.satellite}",
            "provider": "openstreet",
            "layerType": "Esri.WorldImagery"
          },
          {
            "label": "{i18n:widgets.maps.layer.hybrid}",
            "provider": "openstreet",
            "layerType": "Esri.WorldImagery",
            "referenceLayer": "openstreetmap_hybrid"
          },
          {
            "label": "Topographic",
            "provider": "openstreet",
            "layerType": "Esri.WorldTopoMap",
            "referenceLayer": null
          },
          {
            "label": "Hot",
            "provider": "openstreet",
            "layerType": "OpenStreetMap.HOT",
            "referenceLayer": null
          },
          {
            "label": null,
            "provider": "openstreet",
            "layerType": "Esri.WorldStreetMap",
            "referenceLayer": null
          }
        ],
        "imageSource": null,
        "markers": [
          {
            "dsType": "entity",
            "dsLabel": "",
            "dsDeviceId": null,
            "dsEntityAliasId": "df6ecbc0-0dae-bc9b-fbeb-96b5c11f9ebc",
            "dsFilterId": "3744b253-8d5c-7528-b178-0c8be5c3adca",
            "additionalDataSources": null,
            "additionalDataKeys": [
              {
                "name": "progress",
                "type": "attribute",
                "label": "progress",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.9725950885098493
              },
              {
                "name": "name",
                "type": "entityField",
                "label": "name",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.2872987416504812,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "locationName",
                "type": "attribute",
                "label": "locationName",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.9686714923687729
              },
              {
                "name": "label",
                "type": "entityField",
                "label": "label",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.11734397732048452,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              },
              {
                "name": "address",
                "type": "attribute",
                "label": "address",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.8026110588871542
              },
              {
                "name": "outsideTemp",
                "type": "timeseries",
                "label": "outsideTemp",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.759902282076257
              },
              {
                "name": "outsideHumidity",
                "type": "timeseries",
                "label": "outsideHumidity",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.05821233805088244
              }
            ],
            "label": {
              "show": true,
              "type": "function",
              "pattern": "${entityName}",
              "patternFunction": "function getBackgroundColor(progress) {\r\n  switch(progress) {\r\n    case 'in preparation': \r\n        return '#9C27B0'; // '#CAC1D2'--> grau\r\n    case 'finished': \r\n        return '#4CAF50'; // --> gr\u00fcn\r\n    case 'active': \r\n        return '#F5DD00'; // --> gelb\r\n    default: \r\n        return 'black'; // --> grau\r\n  }\r\n}\r\n\r\nvar color = getBackgroundColor(data.progress);\r\n\r\nreturn '<span style=\"border: solid ' + color + '; border-radius: 10px; color: ' + color + '; background-color: #fff; padding: 3px 5px; font-size: 14px; position: relative; bottom: 6px;\">' + \r\n           '${entityName}' + \r\n        '</span>';"
            },
            "tooltip": {
              "show": true,
              "type": "function",
              "pattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} \u00b0C<br/><small>See tooltip settings for details</small>",
              "patternFunction": "const temperature = data.outsideTemp;\nconst humidity = data.outsideHumidity;\nconst pressure = data.pressure;\nconst longitude = data.longitude;\nconst latitude = data.latitude;\nvar locationName = data.locationName || 'N/A';\nconst installationType = data.installationType;\nconst address = data.address;\nconst name = data.name;\nconst label = data.label;\n/*console.log(data[0]);\nconsole.log(data[1]);\nconsole.log(data[2]);\nconsole.log(data);\nconsole.log(dsData[dsData.length -1]);*/\nconst userRole = dsData[dsData.length -1].role;\n\n// Alarms\nconst state = data.state;\nconst progress = data.progress;\nconst criticalAlarms = data.criticalAlarmsCount || 'N/A';\nconst majorAlarms = data.majorAlarmsCount || 'N/A';\nconst minorAlarms = data.minorAlarmsCount || 'N/A';\nconst warningAlarms = data.warningAlarmsCount || 'N/A';\n\n// Farben f\u00fcr Alarms\nconst criticalAlarmsColor = '#FF0000'; // Rot\nconst criticalAlarmsBgColor =\n'rgba(255, 0, 0, 0.1)'; // Transparenter Rot\n\nconst majorAlarmsColor = '#FF8C00'; // Orange\nconst majorAlarmsBgColor =\n'rgba(255, 140, 0, 0.1)'; // Transparenter Orange\n\nconst minorAlarmsColor = '#FFD700'; // Gold\nconst minorAlarmsBgColor =\n'rgba(255, 215, 0, 0.1)'; // Transparenter Gold\n\nconst warningAlarmsColor = '#000000'; // Schwarz\nconst warningAlarmsBgColor =\n'rgba(128, 128, 128, 0.1)'; // Transparenter Grau\n\nvar ButtonHtml = '';\nif (userRole !== \"Belimo Retrofit Users\") {\n    ButtonHtml = '<div style=\"text-align: center\">' +\n        '<link-act name=\"delete-project\">Delete Project</link-act>' +\n        '</div>';\n}\n\nif (locationName === 'N/A') {\n    locationName = label;\n}\n\nreturn '<div style=\"display:flex;flex-direction:column;margin-bottom:8px;font-family:\\'Roboto\\';font-weight:500;font-size:16px;line-height:24px;letter-spacing:0.25px;color:#29313C\">' +\n    '<div>' + locationName + ' | ' + name + '</div>' +\n    '<div style=\"width: 100%;border-bottom:1px solid rgba(0, 0, 0, 0.12);margin:12px 0;\"></div>' +\n\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Address</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    address + '</div>' +\n    '</div>' +\n/*    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Critical Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    criticalAlarmsColor + ';background-color:' +\n    criticalAlarmsBgColor + '\">' + criticalAlarms +\n    '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Major Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    majorAlarmsColor + ';background-color:' +\n    majorAlarmsBgColor + '\">' + majorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Minor Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    minorAlarmsColor + ';background-color:' +\n    minorAlarmsBgColor + '\">' + minorAlarms + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Warning Alarms</div>' +\n    '<div style=\"width:fit-content;padding:4px 8px;border-radius:8px;line-height:20px;font-size:14px;font-weight:500;letter-spacing:0.25px;color:' +\n    warningAlarmsColor + ';background-color:' +\n    warningAlarmsBgColor + '\">' + warningAlarms + '</div>' +\n    '</div>' +*/\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Temperature</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    temperature + ' \u00b0C</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Humidity</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    humidity + ' % r.H.</div>' +\n    '</div>' +\n    '<div style=\"display:flex;flex-direction:row;align-items:baseline;margin-bottom:9px;\">' +\n    '<div style=\"font-size:13px;line-height:16px;font-weight:500;color:rgba(0, 0, 0, 0.38);width:100px\">Progress</div>' +\n    '<div style=\"font-size:14px;line-height:20px;font-weight:500;letter-spacing:0.25px\">' +\n    progress + '</div>' +\n    '</div>' +\n    '<div style=\"display:flex;justify-content:center;margin-top:16px;padding-top:12px;border-top:1px solid rgba(0, 0, 0, 0.12);\">' +\n    '<link-act name=\"all_measurements\" style=\"display:inline-flex;align-items:center;gap:8px;padding:8px 16px;background-color:#1F6BDD;color:white;border-radius:4px;text-decoration:none;font-weight:500;font-size:14px;box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:pointer;\">' +\n    '<i class=\"material-icons\" style=\"font-size:18px;width:18px;height:18px;line-height:18px;\">edit</i>' +\n    '<span>Edit Measurements</span>' +\n    '</link-act>' +\n    '</div>' +\n    '</div>';",
              "trigger": "click",
              "autoclose": true,
              "offsetX": 0,
              "offsetY": -1,
              "tagActions": [
                {
                  "name": "all_measurements",
                  "type": "custom",
                  "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nparams['selectedProject'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedProject';\n/*params['selectedMeasurement'] = null;*/\nconsole.log(\"Params 2: \" + JSON.stringify(params));\nwidgetContext.stateController.openState('all_measurements', params);",
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                {
                  "name": "delete-project",
                  "type": "custom",
                  "customFunction": "// Injector & service setup\r\nconst $injector          = widgetContext.$scope.$injector;\r\nconst dialogs            = $injector.get(widgetContext.servicesMap.get('dialogs'));\r\nconst assetService       = $injector.get(widgetContext.servicesMap.get('assetService'));\r\nconst deviceService      = $injector.get(widgetContext.servicesMap.get('deviceService'));\r\nconst entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\r\n\r\n// IDs & names\r\nconst projectEntityId = entityId.id;\r\nlet customerId;\r\nif (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\r\n  customerId = widgetContext.stateController.getStateParams().entityId;\r\n} else {\r\n  customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER' };\r\n}\r\nconst projectName = entityName;\r\n\r\n// Search query for Measurements owned by this project\r\nconst assetSearchQuery = {\r\n  parameters: {\r\n    rootId:             projectEntityId,\r\n    rootType:           'ASSET',\r\n    direction:          'FROM',\r\n    relationTypeGroup:  'COMMON',\r\n    maxLevel:           10,\r\n    fetchLastLevelOnly: false\r\n  },\r\n  relationType: 'Owns',\r\n  assetTypes:   ['Measurement']\r\n};\r\n\r\n// 1) Load measurements, VR\u2010devices & devices in parallel\r\nassetService.findByQuery(assetSearchQuery).pipe(\r\n  widgetContext.rxjs.switchMap(measurements => {\r\n    const vrCalls = measurements.map(m => {\r\n      const q = {\r\n        parameters: { rootId: m.id.id, rootType: 'ASSET', direction: 'FROM', relationTypeGroup: 'COMMON', maxLevel: 10, fetchLastLevelOnly: false },\r\n        relationType: 'Measurement VR',\r\n        deviceTypes:  ['P-Flow D116 VR','Temperature Sensor VR','Room Sensor CO2 VR','Gateway VR']\r\n      };\r\n      return deviceService.findByQuery(q);\r\n    });\r\n    const devCalls = measurements.map(m => {\r\n      const q = {\r\n        parameters: { rootId: m.id.id, rootType: 'ASSET', direction: 'FROM', relationTypeGroup: 'COMMON', maxLevel: 10, fetchLastLevelOnly: false },\r\n        relationType: 'Measurement',\r\n        deviceTypes:  ['P-Flow D116','Temperature Sensor','Room Sensor CO2','Gateway','RESI']\r\n      };\r\n      return deviceService.findByQuery(q);\r\n    });\r\n    return widgetContext.rxjs.forkJoin({\r\n      measurements: widgetContext.rxjs.of(measurements),\r\n      vrArrays:     widgetContext.rxjs.forkJoin(vrCalls),\r\n      deviceArrays: widgetContext.rxjs.forkJoin(devCalls)\r\n    });\r\n  })\r\n).subscribe(({ measurements, vrArrays, deviceArrays }) => {\r\n  const vrDevices = vrArrays.flat();\r\n  const devices   = deviceArrays.flat();\r\n\r\n  // 2) Open confirmation dialog\r\n  const title   = `Are you sure you want to delete the Project ${projectName}?`;\r\n  const content = `Be careful: this will delete the project and its ${measurements.length} measurements.`;\r\n  dialogs.confirm(title, content, 'Cancel', 'Delete').pipe(\r\n    widgetContext.rxjs.filter(Boolean),\r\n    // 3) assign & delete sequence\r\n    widgetContext.rxjs.switchMap(() =>\r\n      // wrap the assign step in catchError so a 404 here won't abort everything\r\n      assignToUnassignedMeasurementsGroup(devices).pipe(\r\n        widgetContext.rxjs.catchError(err => {\r\n          console.warn('Could not assign devices\u2014continuing delete anyway', err);\r\n          return widgetContext.rxjs.of(null);\r\n        }),\r\n        // then delete VR devices\r\n        widgetContext.rxjs.switchMap(() =>\r\n          widgetContext.rxjs.forkJoin(\r\n            vrDevices.map(d =>\r\n              deviceService.deleteDevice(d.id.id).pipe(\r\n                widgetContext.rxjs.catchError(err => {\r\n                  console.error(`Error deleting VR device ${d.id.id}:`, err);\r\n                  return widgetContext.rxjs.of(null);\r\n                })\r\n              )\r\n            )\r\n          )\r\n        ),\r\n        // then delete measurements\r\n        widgetContext.rxjs.switchMap(() =>\r\n          widgetContext.rxjs.forkJoin(\r\n            measurements.map(m =>\r\n              assetService.deleteAsset(m.id.id).pipe(\r\n                widgetContext.rxjs.catchError(err => {\r\n                  console.error(`Error deleting measurement ${m.id.id}:`, err);\r\n                  return widgetContext.rxjs.of(null);\r\n                })\r\n              )\r\n            )\r\n          )\r\n        ),\r\n        // finally delete the project asset\r\n        widgetContext.rxjs.switchMap(() =>\r\n          assetService.deleteAsset(projectEntityId).pipe(\r\n            widgetContext.rxjs.catchError(err => {\r\n              console.error(`Error deleting project ${projectEntityId}:`, err);\r\n              return widgetContext.rxjs.of(null);\r\n            })\r\n          )\r\n        )\r\n      )\r\n    )\r\n  ).subscribe({\r\n    next: () => widgetContext.updateAliases(),\r\n    error: err => console.error('Delete flow fatal error:', err)\r\n  });\r\n});\r\n\r\n// Helper: assign all devices into \u201cUnassigned Measurement Devices\u201d group\r\nfunction assignToUnassignedMeasurementsGroup(devices) {\r\n    \r\n  return getUnassignedMeasurementGroup(customerId).pipe(\r\n    widgetContext.rxjs.switchMap(group => {\r\n        console.log(\"group\", group);\r\n        console.log(\"devices\", devices[0]);\r\n      const adds = devices.map(d =>\r\n        entityGroupService.addEntityToEntityGroup(/*group.id.id*/ \"61542e91-25c4-11f0-96af-dfbf0c87e3fe\", d.id.id).pipe(\r\n          widgetContext.rxjs.catchError(err => {\r\n            console.error(`Error assigning device ${d.id.id}:`, err);\r\n            return widgetContext.rxjs.of(null);\r\n          })\r\n        )\r\n      );\r\n      return widgetContext.rxjs.forkJoin(adds.length ? adds : [widgetContext.rxjs.of(null)]);\r\n    })\r\n  );\r\n}\r\n\r\n// Helper: get or create the \u201cUnassigned Measurement Devices\u201d group\r\nfunction getUnassignedMeasurementGroup(customerId) {\r\n  return entityGroupService\r\n    .getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE')\r\n    .pipe(\r\n      widgetContext.rxjs.switchMap(entityGroups => {\r\n        const grp = entityGroups.find(g => g.name === 'Unassigned Measurement Devices');\r\n        if (grp) {\r\n          return widgetContext.rxjs.of(grp);\r\n        } else {\r\n          const newGrp = { type: 'DEVICE', name: 'Unassigned Measurement Devices', ownerId: customerId };\r\n          return entityGroupService.saveEntityGroup(newGrp);\r\n        }\r\n      })\r\n    );\r\n}\r\n",
                  "openInSeparateDialog": false,
                  "openInPopover": false
                }
              ]
            },
            "click": {
              "type": "custom",
              "customFunction": "var params = widgetContext.stateController.getStateParams();\nvar selectedProject = params['selectedProject'];\nif (selectedProject && selectedProject.entityId.id === entityId.id) {\n    params['selectedProject'] = null;\n} else {\n    params['selectedProject'] = { entityId: entityId, entityName: entityName, entityLabel: entityLabel };\n}\nwidgetContext.stateController.updateState(null, params);\n/*console.log(\"Params 1: \" + JSON.stringify(params));*/",
              "openInSeparateDialog": false,
              "openInPopover": false
            },
            "groups": null,
            "edit": {
              "enabledActions": [
                "add",
                "move"
              ],
              "attributeScope": "SERVER_SCOPE",
              "snappable": false
            },
            "xKey": {
              "name": "latitude",
              "label": "latitude",
              "type": "attribute",
              "settings": {},
              "color": "#2196f3"
            },
            "yKey": {
              "name": "longitude",
              "label": "longitude",
              "type": "attribute",
              "settings": {},
              "color": "#2196f3"
            },
            "markerType": "icon",
            "markerShape": {
              "shape": "markerShape1",
              "size": 34,
              "color": {
                "type": "constant",
                "color": "#307FE5"
              }
            },
            "markerIcon": {
              "iconContainer": "iconContainer4",
              "icon": "domain",
              "size": 40,
              "color": {
                "type": "function",
                "color": "#307FE5",
                "rangeKey": null,
                "range": null,
                "colorFunction": "function getBackgroundColor(progress) {\r\n  switch(progress) {\r\n    case 'in preparation': \r\n        return '#9C27B0'; // '#CAC1D2'--> grau\r\n    case 'finished': \r\n        return '#4CAF50'; // --> gr\u00fcn\r\n    case 'active': \r\n        return '#F5DD00'; // --> gelb\r\n    default: \r\n        return 'black'; // --> grau\r\n  }\r\n}\r\n\r\nreturn getBackgroundColor(data.progress);"
              }
            },
            "markerImage": {
              "type": "image",
              "image": "/assets/markers/shape1.svg",
              "imageSize": 34
            },
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "markerClustering": {
              "enable": true,
              "zoomOnClick": true,
              "maxZoom": null,
              "maxClusterRadius": 80,
              "zoomAnimation": true,
              "showCoverageOnHover": true,
              "spiderfyOnMaxZoom": true,
              "chunkedLoad": false,
              "lazyLoad": true,
              "useClusterMarkerColorFunction": false,
              "clusterMarkerColorFunction": null
            }
          }
        ],
        "polygons": [],
        "circles": [],
        "additionalDataSources": [
          {
            "dsType": "entity",
            "dsLabel": "",
            "dataKeys": [
              {
                "name": "latitude",
                "type": "attribute",
                "label": "selectedProject",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.5634367819170003,
                "aggregationType": null,
                "units": null,
                "decimals": null,
                "funcBody": null,
                "usePostProcessing": null,
                "postFuncBody": null
              }
            ],
            "dsEntityAliasId": "faef915b-be60-5c6b-d62c-114957e80421"
          },
          {
            "dsType": "entity",
            "dsLabel": "",
            "dataKeys": [
              {
                "name": "role",
                "type": "attribute",
                "label": "role",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.7014478669430672
              }
            ],
            "dsEntityAliasId": "203b0867-b867-ef98-1791-03046c133b7d"
          }
        ],
        "controlsPosition": "topleft",
        "zoomActions": [
          "scroll",
          "doubleClick",
          "controlButtons"
        ],
        "scales": [
          "metric"
        ],
        "dragModeButton": false,
        "fitMapBounds": true,
        "useDefaultCenterPosition": false,
        "defaultCenterPosition": "48.140447,11.569030",
        "defaultZoomLevel": null,
        "mapPageSize": 16384,
        "mapActionButtons": [
          {
            "label": "Add Project",
            "icon": "add",
            "color": "#0000008a",
            "action": {
              "type": "placeMapItem",
              "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form max-w-3xl mx-auto\" style=\"width: 600px; max-width: 90vw;\">\r\n  <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n    <h2 class=\"text-lg font-semibold\">Add Project</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n    <div class=\"flex flex-col gap-0 sm:gap-2\">\r\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>Project ID</mat-label>\r\n            <input matInput formControlName=\"name\" required readonly>\r\n            <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">\r\n              Project title is required.\r\n            </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>Label</mat-label>\r\n            <input matInput formControlName=\"entityLabel\">\r\n        </mat-form-field>\r\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>Project address</mat-label>\r\n            <input matInput formControlName=\"address\">\r\n        </mat-form-field>\r\n        <div style=\"display: flex; gap: 8px;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n              <mat-label>Postal Code</mat-label>\r\n              <input matInput formControlName=\"postalCode\">\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 2;\">\r\n              <mat-label>City</mat-label>\r\n              <input matInput formControlName=\"city\">\r\n          </mat-form-field>\r\n        </div>\r\n        <div style=\"display: flex; gap: 8px;\">\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n              <mat-label>Latitude</mat-label>\r\n              <input matInput formControlName=\"latitude\" readonly>\r\n          </mat-form-field>\r\n          <mat-form-field appearance=\"fill\" style=\"flex: 1;\">\r\n              <mat-label>Longitude</mat-label>\r\n              <input matInput formControlName=\"longitude\" readonly>\r\n          </mat-form-field>\r\n        </div>\r\n    </div>\r\n  </div>\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(isLoading$ | async)\"\r\n            (click)=\"cancel()\" cdkFocusInitial>\r\n      Cancel\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\r\n      Add Project\r\n    </button>\r\n  </div>\r\n</form>\r\n",
              "customCss": "",
              "customFunction": "/*========================================================================*/\n/*==================  Add Project with Reverse Geocoding  ================*/\n/*========================================================================*/\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet $http = $injector.get(widgetContext.servicesMap.get('http'));\nlet customerId;\nlet shortNameAttr;\nlet customerShortName;\nlet nextProjectId = 0;\nlet currentAddressData = null;\n\nlet customerName = widgetContext.stateController.getStateParams().entityName;\nlet userRole = widgetContext.stateController.getStateParams().userRole;\n\n// Get marker coordinates\nconst markerLat = additionalParams.coordinates.x;\nconst markerLon = additionalParams.coordinates.y;\n\nif (widgetContext.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator') {\n    customerId = widgetContext.stateController.getStateParams().entityId;\n} else {\n    customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n}\nconsole.log(\"CustomerID: \", customerId.id);\nconsole.log(\"Marker Coordinates: \", markerLat, markerLon);\n\nlet assetSearchQuery = {\n  \"parameters\": {\n    \"rootId\": customerId.id,\n    \"rootType\": \"CUSTOMER\",\n    \"direction\": \"FROM\",\n    \"relationTypeGroup\": \"COMMON\",\n    \"maxLevel\": 10,\n    \"fetchLastLevelOnly\": false\n  },\n  \"relationType\": \"Owns\",\n  \"assetTypes\": [\n    \"Project\"\n  ]\n};\n\nconsole.log(\"Asset Search Query: \", assetSearchQuery);\n\nassetService.findByQuery(assetSearchQuery).subscribe(projects => {\n    console.log(\"Projects: \", projects);\n    nextProjectId = getLastProjectId(projects);\n    console.log(\"Next Project ID: \", nextProjectId);\n    attributeService.getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName']).subscribe(attributes => {\n        shortNameAttr = attributes.find(attr => attr.key === 'shortName');\n        customerShortName = shortNameAttr ? shortNameAttr.value : customerName;\n\n        // Reverse geocoding: get address from coordinates\n        reverseGeocode(markerLat, markerLon).then(addressData => {\n            openAddProjectDialog(addressData);\n        }).catch(error => {\n            console.error('Reverse geocoding failed:', error);\n            openAddProjectDialog(null);\n        });\n    });\n});\n\nfunction getLastProjectId(projects) {\n    let maxNumber = 0;\n    projects.forEach(item => {\n        const name = item.name;\n        const parts = name.split('_');\n        if (parts.length === 2) {\n            const number = parseInt(parts[1], 10);\n            if (number > maxNumber) {\n                maxNumber = number;\n            }\n        }\n    });\n    const nextProjectId = maxNumber + 1;\n    return nextProjectId;\n}\n\n/**\n * Reverse Geocoding: Converts lat/lon to address using Photon API\n * Address format: Stra\u00dfenname Hausnummer, CC-Postleitzahl Ort\n */\nfunction reverseGeocode(lat, lon) {\n    return new Promise((resolve, reject) => {\n        const url = `https://photon.komoot.io/reverse?lat=${lat}&lon=${lon}&limit=1`;\n\n        $http.get(url).subscribe(\n            response => {\n                if (response && response.features && response.features.length > 0) {\n                    const feature = response.features[0];\n                    const props = feature.properties;\n\n                    // Build address in format: Stra\u00dfenname Hausnummer, CC-Postleitzahl Ort\n                    let street = props.street || props.name || '';\n                    let housenumber = props.housenumber || '';\n                    let postcode = props.postcode || '';\n                    let city = props.city || props.town || props.village || '';\n                    let countryCode = props.countrycode ? props.countrycode.toUpperCase() : '';\n\n                    // Street + Housenumber part\n                    let addressLine = street;\n                    if (housenumber) {\n                        addressLine += ' ' + housenumber;\n                    }\n\n                    // CC-Postcode + City part\n                    let locationLine = '';\n                    if (countryCode && postcode) {\n                        locationLine = countryCode + '-' + postcode;\n                    } else if (postcode) {\n                        locationLine = postcode;\n                    }\n                    if (city) {\n                        locationLine += (locationLine ? ' ' : '') + city;\n                    }\n\n                    // Combined format: \"Street Number, CC-Postcode City\"\n                    let fullAddress = addressLine;\n                    if (locationLine) {\n                        fullAddress += ', ' + locationLine;\n                    }\n\n                    const addressData = {\n                        address: fullAddress,\n                        postalCode: postcode,\n                        city: city,\n                        latitude: lat,\n                        longitude: lon\n                    };\n\n                    console.log('Reverse geocoding result:', addressData);\n                    resolve(addressData);\n                } else {\n                    resolve({\n                        address: '',\n                        postalCode: '',\n                        city: '',\n                        latitude: lat,\n                        longitude: lon\n                    });\n                }\n            },\n            error => {\n                console.error('Photon API error:', error);\n                reject(error);\n            }\n        );\n    });\n}\n\nfunction openAddProjectDialog(addressData) {\n  currentAddressData = addressData;\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\n}\n\nfunction AddProjectDialogController(instance) {\n  let vm = instance;\n\n  // Initialize form with address data from reverse geocoding\n  const initialValues = {\n    name: customerShortName + \"_\" + nextProjectId,\n    entityLabel: '',\n    address: currentAddressData ? currentAddressData.address : '',\n    postalCode: currentAddressData ? currentAddressData.postalCode : '',\n    city: currentAddressData ? currentAddressData.city : '',\n    latitude: currentAddressData ? currentAddressData.latitude.toFixed(6) : markerLat.toFixed(6),\n    longitude: currentAddressData ? currentAddressData.longitude.toFixed(6) : markerLon.toFixed(6)\n  };\n\n  vm.addProjectFormGroup = vm.fb.group({\n    name: [initialValues.name, [vm.validators.required]],\n    entityLabel: [initialValues.entityLabel],\n    address: [initialValues.address],\n    postalCode: [initialValues.postalCode],\n    city: [initialValues.city],\n    latitude: [initialValues.latitude],\n    longitude: [initialValues.longitude]\n  });\n\n  vm.cancel = function() {\n      vm.dialogRef.close(null);\n  };\n\n  vm.save = function () {\n    vm.addProjectFormGroup.markAsPristine();\n    saveProjectObservable(customerId).subscribe(\n      function (Project) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToProjectRelation(customerId, Project.id),\n              saveAttributes(Project.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedProject = params['selectedProject'];\n                params['selectedProject'] = { entityId: Project.id, entityName: Project.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveProjectObservable(customerId) {\n    return getProjectsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((ProjectsGroup) => {\n            const formValues = vm.addProjectFormGroup.value;\n            let Project = {\n              name: formValues.name,\n              type: 'Project',\n              label: formValues.entityLabel,\n              customerId: customerId\n            };\n            return assetService.saveAsset(Project, ProjectsGroup.id.id)\n        })\n    );\n  }\n\n  function saveAttributes(entityId) {\n      let attributesArray = getMapItemLocationAttributes();\n      const formValues = vm.addProjectFormGroup.value;\n\n      attributesArray.push({key: 'address', value: formValues.address});\n      attributesArray.push({key: 'postalCode', value: formValues.postalCode});\n      attributesArray.push({key: 'city', value: formValues.city});\n      attributesArray.push({key: 'progress', value: 'in preparation'});\n      attributesArray.push({key: 'units', value: 'metric'});\n\n      if (attributesArray.length > 0) {\n          return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n      }\n      return widgetContext.rxjs.of([]);\n  }\n\n  function getProjectsGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n        widgetContext.rxjs.switchMap((entityGroups) => {\n            var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\n            if (ProjectsGroup) {\n                return widgetContext.rxjs.of(ProjectsGroup);\n            } else {\n                ProjectsGroup = {\n                    type: 'ASSET',\n                    name: 'Projects',\n                    ownerId: customerId\n                };\n                return entityGroupService.saveEntityGroup(ProjectsGroup);\n            }\n        })\n    );\n  }\n\n  function saveCustomerToProjectRelation(customerId, ProjectId) {\n    var relation = {\n        from: customerId,\n        to: ProjectId,\n        typeGroup: 'COMMON',\n        type: 'Owns'\n    };\n    return entityRelationService.saveRelation(relation);\n  }\n\n  function getMapItemLocationAttributes() {\n      const attributes = [];\n      const mapItemType = $event.shape;\n      if (mapItemType === 'Marker') {\n          const mapType = widgetContext.mapInstance.type();\n          attributes.push({key: mapType === 'image' ? 'xPos' : 'latitude', value: additionalParams.coordinates.x});\n          attributes.push({key: mapType === 'image' ? 'yPos' : 'longitude', value: additionalParams.coordinates.y});\n      } else if (mapItemType === 'Rectangle' || mapItemType === 'Polygon') {\n          attributes.push({key: 'perimeter', value: additionalParams.coordinates});\n      } else if (mapItemType === 'Circle') {\n          attributes.push({key: 'circle', value: additionalParams.coordinates});\n      }\n      return attributes;\n  }\n}\n",
              "customResources": [],
              "mapItemType": "marker",
              "mapItemTooltips": {},
              "openInSeparateDialog": false,
              "openInPopover": false
            }
          }
        ],
        "background": {
          "type": "color",
          "color": "#fff",
          "overlay": {
            "enabled": false,
            "color": "rgba(255,255,255,0.72)",
            "blur": 3
          }
        },
        "padding": "8px"
      },
      "title": "Projects",
      "useDashboardTimewindow": true,
      "displayTimewindow": true,
      "showTitleIcon": false,
      "titleTooltip": "",
      "dropShadow": false,
      "enableFullscreen": false,
      "widgetStyle": {},
      "widgetCss": "",
      "titleStyle": {
        "fontSize": "24px",
        "fontWeight": 700,
        "padding": "5px 10px 5px 10px"
      },
      "pageSize": 1024,
      "noDataDisplayMessage": "",
      "configMode": "advanced",
      "titleFont": null,
      "titleColor": null,
      "margin": "0px",
      "borderRadius": "8px",
      "iconSize": "24px",
      "titleIcon": "map",
      "iconColor": "#1F6BDD",
      "actions": {
        "headerButton": [
          {
            "name": "Add Project",
            "buttonType": "flat",
            "showIcon": true,
            "icon": "add",
            "buttonColor": "#ffffff",
            "buttonFillColor": "#3d9be9",
            "useShowWidgetActionFunction": true,
            "showWidgetActionFunction": "return false;",
            "type": "placeMapItem",
            "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addProjectFormGroup\"\r\n      (ngSubmit)=\"save()\" class=\"add-entity-form max-w-3xl mx-auto\" style=\"width: 350px;\">\r\n  <mat-toolbar class=\"flex items-center bg-primary text-white px-4\" color=\"primary\">\r\n    <h2 class=\"text-lg font-semibold\">Add Project</h2>\r\n    <span class=\"flex-1\"></span>\r\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\r\n      <mat-icon class=\"material-icons\">close</mat-icon>\r\n    </button>\r\n  </mat-toolbar>\r\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\r\n  </mat-progress-bar>\r\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\r\n  <div mat-dialog-content class=\"flex flex-col p-4 space-y-4\">\r\n    <div class=\"flex flex-col gap-0 sm:gap-2\">\r\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>Project ID</mat-label>\r\n            <input matInput formControlName=\"name\" required readonly>\r\n            <mat-error *ngIf=\"addProjectFormGroup.get('name').hasError('required')\">\r\n              Project title is required.\r\n            </mat-error>\r\n        </mat-form-field>\r\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>Label</mat-label>\r\n            <input matInput formControlName=\"entityLabel\">\r\n        </mat-form-field>\r\n        <mat-form-field appearance=\"fill\" class=\"flex-1\">\r\n            <mat-label>Project address</mat-label>\r\n            <input matInput formControlName=\"address\">\r\n        </mat-form-field>\r\n    </div>\r\n  </div>\r\n  <div mat-dialog-actions class=\"flex justify-end gap-2\">\r\n    <button mat-button color=\"primary\"\r\n            type=\"button\"\r\n            [disabled]=\"(isLoading$ | async)\"\r\n            (click)=\"cancel()\" cdkFocusInitial>\r\n      Cancel\r\n    </button>\r\n    <button mat-button mat-raised-button color=\"primary\"\r\n            type=\"submit\"\r\n            [disabled]=\"(isLoading$ | async) || addProjectFormGroup.invalid || !addProjectFormGroup.dirty\">\r\n      Add Project\r\n    </button>\r\n  </div>\r\n</form>\r\n",
            "customCss": "",
            "customFunction": "/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nlet customerId;\nlet shortNameAttr;\nlet customerShortName;\nlet nextProjectId = 0;\n\nlet customerName = widgetContext.stateController.getStateParams().entityName;\nlet userRole = widgetContext.stateController.getStateParams().userRole;\n\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN' || userRole === 'ECO Administrator') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\nconsole.log(\"CustomerID: \", customerId.id);\n\nlet assetSearchQuery = {\n  \"parameters\": {\n    \"rootId\": customerId.id,\n    \"rootType\": \"CUSTOMER\",\n    \"direction\": \"FROM\",\n    \"relationTypeGroup\": \"COMMON\",\n    \"maxLevel\": 10,\n    \"fetchLastLevelOnly\": false\n  },\n  \"relationType\": \"Owns\",\n  \"assetTypes\": [\n    \"Project\"\n  ]\n};\n\nconsole.log(\"Asset Search Query: \", assetSearchQuery);\n\nassetService.findByQuery(assetSearchQuery).subscribe(projects => {\n    console.log(\"Projects: \", projects);\n    nextProjectId = getLastProjectId(projects);\n    console.log(\"Next Project ID: \", nextProjectId);\n    attributeService.getEntityAttributes(customerId, 'SERVER_SCOPE', ['shortName']).subscribe(attributes => {\n        shortNameAttr = attributes.find(attr => attr.key === 'shortName');\n        customerShortName = shortNameAttr ? shortNameAttr.value : customerName;\n        openAddProjectDialog();\n    });\n});\n\nfunction getLastProjectId(projects) {\n    let maxNumber = 0;\n    projects.forEach(item => {\n        const name = item.name;\n        const parts = name.split('_');\n        if (parts.length === 2) {\n            const number = parseInt(parts[1], 10);\n            if (number > maxNumber) {\n                maxNumber = number;\n            }\n        }\n    });\n    const nextProjectId = maxNumber + 1;\n    return nextProjectId;\n}\n\nfunction openAddProjectDialog() {\n  customDialog.customDialog(htmlTemplate, AddProjectDialogController).subscribe();\n}\n\nfunction AddProjectDialogController(instance) {\n  let vm = instance;\n\n  vm.addProjectFormGroup = vm.fb.group({\n    name: [customerShortName + \"_\" + nextProjectId, [vm.validators.required]],\n    entityLabel: [''],\n    address: ['']\n  });\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n    \n    vm.save = function () {\n    vm.addProjectFormGroup.markAsPristine();\n    saveProjectObservable(customerId).subscribe(\n      function (Project) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToProjectRelation(customerId, Project.id),\n              saveAttributes(Project.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedProject = params['selectedProject'];\n                params['selectedProject'] = { entityId: Project.id, entityName: Project.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n    };\n\n/*    function saveEntityObservable() {\n        const formValues = vm.addEntityFormGroup.value;\n        let entity = {\n            name: formValues.entityName,\n            type: formValues.type,\n            label: formValues.entityLabel\n        };\n        if (formValues.entityType == 'ASSET') {\n            return assetService.saveAsset(entity);\n        } else if (formValues.entityType == 'DEVICE') {\n            return deviceService.saveDevice(entity);\n        }\n    }*/\n    \n    function saveProjectObservable(customerId) {\n    return getProjectsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((ProjectsGroup) => {\n            const formValues = vm.addProjectFormGroup.value;\n            let Project = {\n              name: formValues.name,\n              type: 'Project',\n              label: formValues.entityLabel,\n              customerId: customerId\n            };\n            return assetService.saveAsset(Project, ProjectsGroup.id.id)\n        })\n    );\n    }\n\n    function saveAttributes(entityId) {\n        let attributesArray = getMapItemLocationAttributes();\n        attributesArray.push({key: 'address', value: vm.addProjectFormGroup.value.address});\n        attributesArray.push({key: 'progress', value: 'in preparation'});\n        attributesArray.push({key: 'units', value: 'metric'});\n        \n        if (attributesArray.length > 0) {\n            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n        }\n        return widgetContext.rxjs.of([]);\n    }\n    \n    function getProjectsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var ProjectsGroup = entityGroups.find(group => group.name === 'Projects');\n              if (ProjectsGroup) {\n                  return widgetContext.rxjs.of(ProjectsGroup);\n              } else {\n                  ProjectsGroup = {\n                      type: 'ASSET',\n                      name: 'Projects',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(ProjectsGroup);\n              }\n          })\n      );\n    }\n    \n    function saveCustomerToProjectRelation(customerId, ProjectId) {\n      var relation = {\n          from: customerId,\n          to: ProjectId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n    }\n\n    function getMapItemLocationAttributes() {\n        const attributes = [];\n        const mapItemType = $event.shape;\n        if (mapItemType === 'Marker') {\n            const mapType = widgetContext.mapInstance.type();\n            attributes.push({key: mapType === 'image' ? 'xPos' : 'latitude', value: additionalParams.coordinates.x});\n            attributes.push({key: mapType === 'image' ? 'yPos' : 'longitude', value: additionalParams.coordinates.y});\n        } else if (mapItemType === 'Rectangle' || mapItemType === 'Polygon') {\n            attributes.push({key: 'perimeter', value: additionalParams.coordinates});\n        } else if (mapItemType === 'Circle') {\n            attributes.push({key: 'circle', value: additionalParams.coordinates});\n        }\n        return attributes;\n    }\n}\n",
            "customResources": [],
            "mapItemType": "marker",
            "mapItemTooltips": {},
            "openInSeparateDialog": false,
            "openInPopover": false,
            "id": "31810d56-1400-76b9-850d-456f65f78d35"
          }
        ]
      },
      "enableDataExport": false
    },
    "row": 0,
    "col": 0,
    "id": "812eba56-40ea-35cd-6287-dffef871b246"
  },
  "aliasesInfo": {
    "datasourceAliases": {},
    "targetDeviceAlias": null
  },
  "filtersInfo": {
    "datasourceFilters": {}
  },
  "originalSize": {
    "sizeX": 13,
    "sizeY": 12,
    "resizable": false
  },
  "originalColumns": 24,
  "widgetExportInfo": {
    "markers": {
      "0": {
        "alias": {
          "alias": "Projects",
          "filter": {
            "type": "assetSearchQuery",
            "resolveMultiple": true,
            "rootStateEntity": true,
            "stateEntityParamName": null,
            "defaultStateEntity": {
              "entityType": "CURRENT_USER_OWNER",
              "id": "13814000-1dd2-11b2-8080-808080808080"
            },
            "rootEntity": null,
            "direction": "FROM",
            "maxLevel": 1,
            "fetchLastLevelOnly": false,
            "relationType": "Owns",
            "assetTypes": [
              "Project"
            ]
          }
        },
        "filter": {
          "filter": "Progress filter projects",
          "keyFilters": [
            {
              "key": {
                "type": "ATTRIBUTE",
                "key": "progress"
              },
              "valueType": "STRING",
              "predicates": [
                {
                  "keyFilterPredicate": {
                    "operation": "OR",
                    "predicates": [
                      {
                        "keyFilterPredicate": {
                          "operation": "EQUAL",
                          "value": {
                            "defaultValue": "in preparation",
                            "dynamicValue": {
                              "sourceType": "CURRENT_USER",
                              "sourceAttribute": "displayPreparationMeasurement",
                              "inherit": false
                            }
                          },
                          "ignoreCase": false,
                          "type": "STRING"
                        },
                        "userInfo": {
                          "editable": true,
                          "label": "",
                          "autogeneratedLabel": true,
                          "order": 0
                        }
                      },
                      {
                        "keyFilterPredicate": {
                          "operation": "EQUAL",
                          "value": {
                            "defaultValue": "active",
                            "dynamicValue": {
                              "sourceType": "CURRENT_USER",
                              "sourceAttribute": "displayActiveMeasurement",
                              "inherit": false
                            }
                          },
                          "ignoreCase": false,
                          "type": "STRING"
                        },
                        "userInfo": {
                          "editable": true,
                          "label": "",
                          "autogeneratedLabel": true,
                          "order": 0
                        }
                      },
                      {
                        "keyFilterPredicate": {
                          "operation": "EQUAL",
                          "value": {
                            "defaultValue": "finished",
                            "dynamicValue": {
                              "sourceType": "CURRENT_USER",
                              "sourceAttribute": "displayFinishedMeasurement",
                              "inherit": false
                            }
                          },
                          "ignoreCase": false,
                          "type": "STRING"
                        },
                        "userInfo": {
                          "editable": true,
                          "label": "",
                          "autogeneratedLabel": true,
                          "order": 0
                        }
                      },
                      {
                        "keyFilterPredicate": {
                          "operation": "EQUAL",
                          "value": {
                            "defaultValue": "in preperation",
                            "dynamicValue": null
                          },
                          "ignoreCase": false,
                          "type": "STRING"
                        },
                        "userInfo": {
                          "editable": true,
                          "label": "",
                          "autogeneratedLabel": true,
                          "order": 0
                        }
                      }
                    ],
                    "type": "COMPLEX"
                  },
                  "userInfo": {
                    "editable": true,
                    "label": "",
                    "autogeneratedLabel": true,
                    "order": 0
                  }
                }
              ]
            }
          ],
          "editable": false
        }
      }
    },
    "additionalDataSources": {
      "0": {
        "alias": {
          "alias": "Selected Project",
          "filter": {
            "type": "stateEntity",
            "resolveMultiple": false,
            "stateEntityParamName": "selectedProject",
            "defaultStateEntity": null
          }
        }
      },
      "1": {
        "alias": {
          "alias": "Current Owner",
          "filter": {
            "type": "singleEntity",
            "resolveMultiple": false,
            "singleEntity": {
              "entityType": "CURRENT_USER",
              "id": "13814000-1dd2-11b2-8080-808080808080"
            }
          }
        }
      }
    }
  }
}