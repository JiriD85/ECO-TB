---
phase: 05-diagnostic-roomkit-lorawan
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js library/ECO Project Wizard.js
autonomous: true

must_haves:
  truths:
    - "Room Sensor CO2 devices show CO2 value with ppm unit"
    - "Room Sensor CO2 devices show Temperature value with degrees Celsius unit"
    - "Room Sensor CO2 devices show Humidity value with percentage unit"
    - "Room Sensor CO2 devices show Battery value with percentage unit"
    - "Values auto-refresh with existing 5-second interval"
  artifacts:
    - path: "js library/ECO Project Wizard.js"
      provides: "Room Sensor CO2 timeseries support"
      contains: "Room Sensor CO2"
  key_links:
    - from: "fetchAllTimeseries condition"
      to: "TIMESERIES_UNITS/TIMESERIES_LABELS constants"
      via: "key lookup in formatTimeseriesValue"
      pattern: "info\\.type === 'Room Sensor CO2'"
---

<objective>
Add Room Sensor CO2 (LoRaWAN) telemetry display to the Measurement Info dialog.

Purpose: Enable users to see live CO2, temperature, humidity, and battery values for LoRaWAN-connected Room Sensor devices in the measurement overview.

Output: Extended timeseries fetching that includes Room Sensor CO2 devices with all 4 telemetry values displayed with correct units.
</objective>

<execution_context>
@/Users/jiridockal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jiridockal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-diagnostic-roomkit-lorawan/05-RESEARCH.md
@.planning/phases/03-timeseries-live/03-01-SUMMARY.md

# Implementation file
@js library/ECO Project Wizard.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Room Sensor CO2 telemetry constants</name>
  <files>js library/ECO Project Wizard.js</files>
  <action>
    Add three new telemetry keys to the TIMESERIES_UNITS and TIMESERIES_LABELS constants (around lines 2221-2247).

    Note: 'temperature' key already exists and is shared with Temperature Sensor - no change needed for temperature.

    Add to TIMESERIES_UNITS (after 'temperature': 'Â°C'):
    - 'co2': 'ppm'
    - 'humidity': '%'
    - 'battery': '%'

    Add to TIMESERIES_LABELS (after 'temperature': 'Temperature'):
    - 'co2': 'CO2'
    - 'humidity': 'Humidity'
    - 'battery': 'Battery'
  </action>
  <verify>
    Read the file and confirm all 6 new entries exist in the constants (3 in TIMESERIES_UNITS, 3 in TIMESERIES_LABELS).
  </verify>
  <done>
    TIMESERIES_UNITS contains co2/ppm, humidity/%, battery/% entries.
    TIMESERIES_LABELS contains co2/CO2, humidity/Humidity, battery/Battery entries.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Room Sensor CO2 device type handling</name>
  <files>js library/ECO Project Wizard.js</files>
  <action>
    In the fetchAllTimeseries function (around line 2857-2863), add a new condition for Room Sensor CO2 device type.

    Current code:
    ```javascript
    if (info.type === 'P-Flow D116') {
      keys = pflowKeys;
    } else if (info.type === 'Temperature Sensor') {
      keys = ['temperature'];
    }
    ```

    Add after the Temperature Sensor condition:
    ```javascript
    else if (info.type === 'Room Sensor CO2') {
      keys = ['co2', 'temperature', 'humidity', 'battery'];
    }
    ```

    This follows the exact same pattern as Temperature Sensor, with the device type string 'Room Sensor CO2' already defined in the deviceSearchQuery.deviceTypes array on line 2666.
  </action>
  <verify>
    Read the file and confirm the new condition exists in fetchAllTimeseries function.
    Grep for "Room Sensor CO2" to verify the condition is added.
  </verify>
  <done>
    fetchAllTimeseries function includes condition: `else if (info.type === 'Room Sensor CO2')` with keys ['co2', 'temperature', 'humidity', 'battery'].
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Grep for 'co2' in ECO Project Wizard.js - should find entries in TIMESERIES_UNITS, TIMESERIES_LABELS, and the device type condition
2. Grep for 'Room Sensor CO2' - should find device type condition in fetchAllTimeseries
3. Verify constants syntax is valid JavaScript (no trailing commas issues, proper quoting)
4. Sync to ThingsBoard: `node sync/sync.js sync --js`
5. Test in browser by opening a measurement dialog that has a Room Sensor CO2 device
</verification>

<success_criteria>
1. Room Sensor CO2 devices display 4 timeseries values: CO2 (ppm), Temperature (C), Humidity (%), Battery (%)
2. Values format correctly with units via existing formatTimeseriesValue function
3. Auto-refresh continues to work at 5-second intervals for all device types
4. No JavaScript errors in browser console
5. Styling consistent with P-Flow and Temperature Sensor display (blue left border)
</success_criteria>

<output>
After completion, create `.planning/phases/05-diagnostic-roomkit-lorawan/05-01-SUMMARY.md`
</output>
