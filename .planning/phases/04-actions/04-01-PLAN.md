---
phase: 04-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js library/ECO Project Wizard.js
autonomous: true

must_haves:
  truths:
    - "User can click 'Details' button and navigate to measurement details state"
    - "User can click 'Dashboard' button and navigate to Measurements_card state"
    - "User can click 'Parameters' button and open the parameters dialog"
    - "Dialog closes after any navigation action"
    - "Auto-refresh interval is cleared before navigation (no orphaned timers)"
  artifacts:
    - path: "js library/ECO Project Wizard.js"
      provides: "Navigation functions in openMeasurementInfoDialog"
      contains: "goToDetails"
    - path: "js library/ECO Project Wizard.js"
      provides: "Action buttons in dialog footer"
      contains: "Dashboard"
  key_links:
    - from: "openMeasurementInfoDialog"
      to: "stateController.openState"
      via: "goToDetails/goToDashboard functions"
      pattern: "stateController\\.openState"
    - from: "openMeasurementInfoDialog"
      to: "openMeasurementParametersDialog"
      via: "openParams function"
      pattern: "openMeasurementParametersDialog\\(widgetContext"
---

<objective>
Add navigation and action buttons to the Measurement Info Dialog

Purpose: Enable users to quickly navigate to related views (Details, Dashboard) or open the Parameters dialog directly from the info popup, completing the v1 feature set.

Output: Extended `openMeasurementInfoDialog` function with action buttons in footer
</objective>

<execution_context>
@/Users/jiridockal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jiridockal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-actions/04-RESEARCH.md

# Source file to modify
@js library/ECO Project Wizard.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add navigation functions to dialog controller</name>
  <files>js library/ECO Project Wizard.js</files>
  <action>
In the `openMeasurementInfoDialog` function, add three navigation functions to the controller:

1. **cleanupAndNavigate(stateId)** - Helper that:
   - Clears `vm.refreshInterval` if exists (CRITICAL: prevents orphaned timers)
   - Closes dialog via `vm.dialogRef.close(null)`
   - Calls `widgetContext.stateController.openState(stateId, params, false)`
   - Params should include: `{ selectedMeasurement: { entityId, entityName, entityLabel }, targetEntityParamName: 'selectedMeasurement' }`

2. **vm.goToDetails** - Determines correct state based on `vm.installationType`:
   - 'cooling' -> `measurement_details_cooling_full`
   - otherwise -> `measurement_details_heating_full`
   - Calls cleanupAndNavigate with determined state

3. **vm.goToDashboard** - Navigates to `Measurements_card` state:
   - Calls cleanupAndNavigate('Measurements_card')

4. **vm.openParams** - Opens parameters dialog:
   - Clears `vm.refreshInterval` if exists
   - Closes dialog via `vm.dialogRef.close(null)`
   - Calls existing `openMeasurementParametersDialog(widgetContext, vm.measurementId, null)`

These functions should be added in the controller constructor (MeasurementInfoDialogController), after the existing vm assignments but before any data loading.
  </action>
  <verify>
Search for `goToDetails` and `stateController.openState` in ECO Project Wizard.js - both should exist after edit
  </verify>
  <done>
Three navigation functions (goToDetails, goToDashboard, openParams) added to controller with proper interval cleanup
  </done>
</task>

<task type="auto">
  <name>Task 2: Add action buttons to dialog footer HTML</name>
  <files>js library/ECO Project Wizard.js</files>
  <action>
In the `openMeasurementInfoDialog` function, modify the dialog HTML template to add action buttons in the footer area.

Replace or extend the existing close button row with a new footer containing:

```html
<div class="flex justify-end items-center gap-2 p-4" style="border-top: 1px solid #e0e0e0; background: #fafafa;">
  <button mat-raised-button type="button" (click)="goToDetails()"
          style="background-color: #305680; color: white;">
    <mat-icon style="margin-right: 4px; font-size: 18px; width: 18px; height: 18px;">analytics</mat-icon>
    Details
  </button>
  <button mat-raised-button type="button" (click)="goToDashboard()"
          style="background-color: #27AE60; color: white;">
    <mat-icon style="margin-right: 4px; font-size: 18px; width: 18px; height: 18px;">dashboard</mat-icon>
    Dashboard
  </button>
  <button mat-raised-button type="button" (click)="openParams()"
          style="background-color: #F2994A; color: white;">
    <mat-icon style="margin-right: 4px; font-size: 18px; width: 18px; height: 18px;">settings</mat-icon>
    Parameters
  </button>
  <span class="flex-1"></span>
  <button mat-raised-button color="primary" type="button" (click)="cancel()">
    Close
  </button>
</div>
```

Button colors:
- Details: #305680 (ECO blue) - primary navigation
- Dashboard: #27AE60 (green) - dashboard view
- Parameters: #F2994A (orange) - settings/config action
- Close: mat color="primary" (existing style)
  </action>
  <verify>
Search for `goToDashboard()` and `goToDetails()` in the HTML template - should appear as (click) handlers
  </verify>
  <done>
Four action buttons visible in dialog footer: Details (blue), Dashboard (green), Parameters (orange), Close (primary)
  </done>
</task>

</tasks>

<verification>
1. Open the Measurements Dashboard in ThingsBoard
2. Click Info action on any measurement row
3. Verify dialog shows action buttons in footer: Details, Dashboard, Parameters, Close
4. Click "Details" - verify navigation to measurement_details_heating_full or measurement_details_cooling_full
5. Reopen dialog, click "Dashboard" - verify navigation to Measurements_card state
6. Reopen dialog, click "Parameters" - verify parameters dialog opens
7. Verify no console errors about orphaned intervals after navigation
</verification>

<success_criteria>
- All three navigation buttons visible and styled correctly
- Details button navigates to correct state based on installationType
- Dashboard button navigates to Measurements_card state
- Parameters button opens existing parameters dialog
- Dialog closes before navigation (no dialog stacking)
- Refresh interval cleared before navigation (no console errors)
- Close button still works as before
</success_criteria>

<output>
After completion, create `.planning/phases/04-actions/04-01-SUMMARY.md`
</output>
