{
  "ruleChain": {
    "name": "Get OpenWeather Data REST API",
    "type": "CORE",
    "firstRuleNodeId": null,
    "root": false,
    "debugMode": false,
    "configuration": null,
    "additionalInfo": {
      "description": ""
    }
  },
  "metadata": {
    "version": 51,
    "firstNodeIndex": 7,
    "nodes": [
      {
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "Latitude/Longitude",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1741871737120
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "tellFailureIfAbsent": true,
          "fetchTo": "METADATA",
          "clientAttributeNames": [],
          "sharedAttributeNames": [],
          "serverAttributeNames": [
            "latitude",
            "longitude",
            "units",
            "progress"
          ],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 782,
          "layoutY": 467
        }
      },
      {
        "type": "org.thingsboard.rule.engine.rest.TbRestApiCallNode",
        "name": "OpenWeatherMap",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743516335165
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 3,
        "configuration": {
          "restEndpointUrlPattern": "https://api.openweathermap.org/data/2.5/weather?lat=${ss_latitude}&lon=${ss_longitude}&units=${ss_units}&appid=${weatherAPIToken}",
          "requestMethod": "GET",
          "useSimpleClientHttpFactory": false,
          "parseToPlainText": false,
          "ignoreRequestBody": false,
          "enableProxy": false,
          "useSystemProxyProperties": false,
          "proxyScheme": null,
          "proxyHost": null,
          "proxyPort": 0,
          "proxyUser": null,
          "proxyPassword": null,
          "readTimeoutMs": 1000,
          "maxParallelRequestsCount": 32,
          "headers": {
            "Content-Type": "application/json"
          },
          "credentials": {
            "type": "anonymous"
          },
          "maxInMemoryBufferSizeInKb": 256
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1052,
          "layoutY": 382
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Fetch Data",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743513936006
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "var newMsg = {\r\n    \"outsideTemp\": msg.main.temp,\r\n    \"outsideTempFeelsLike\": msg.main.feels_like,\r\n    \"outsideMaxTemp\": msg.main.temp_max,\r\n    \"outsideMinTemp\": msg.main.temp_min,\r\n    \"outsideHumidity\": msg.main.humidity,\r\n    \"visibility\": msg.visibility,\r\n    \"windSpeed\": msg.wind.speed,\r\n    \"windDeg\": msg.wind.deg,\r\n    \"windGust\": msg.wind.gust,\r\n    \"pressure\": msg.main.pressure,\r\n    \"clouds\": msg.clouds.all,\r\n    \"weather\": msg.weather[0].description\r\n};\r\n\r\nreturn {msg: newMsg, metadata: metadata, msgType: \"POST_TELEMETRY_REQUEST\"};"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1049,
          "layoutY": 492
        }
      },
      {
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "Save TS",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743514172160
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "defaultTTL": 0,
          "useServerTs": false,
          "processingSettings": {
            "type": "ON_EVERY_MESSAGE"
          }
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1345,
          "layoutY": 437
        }
      },
      {
        "type": "org.thingsboard.rule.engine.metadata.TbGetTenantAttributeNode",
        "name": "Get Tenant API Key",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1741871764686
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "dataToFetch": "ATTRIBUTES",
          "dataMapping": {
            "weatherAPIToken": "weatherAPIToken"
          },
          "fetchTo": "METADATA"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 779,
          "layoutY": 386
        }
      },
      {
        "type": "org.thingsboard.rule.engine.debug.TbMsgGeneratorNode",
        "name": "All Customers",
        "debugSettings": null,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 2,
        "configuration": {
          "msgCount": 0,
          "periodInSeconds": 3600,
          "scriptLang": "TBEL",
          "jsScript": "var msg = { temp: 42, humidity: 77 };\nvar metadata = { data: 40 };\nvar msgType = \"POST_TELEMETRY_REQUEST\";\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };",
          "tbelScript": "var msg = {};\nvar metadata = {};\nvar msgType = \"POST_TELEMETRY_REQUEST\";\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };",
          "originatorId": "efb837e0-b576-11ee-a6c2-a149ed03c64d",
          "originatorType": "ENTITY_GROUP"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 108,
          "layoutY": 636
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbDuplicateMsgToGroupNode",
        "name": "Duplicate to Customers",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743515205610
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "entityGroupId": null,
          "entityGroupIsMessageOriginator": true
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 106,
          "layoutY": 351
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbDuplicateMsgToRelatedNode",
        "name": "Duplicate to Assets",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743516421557
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "relationsQuery": {
            "fetchLastLevelOnly": false,
            "direction": "FROM",
            "maxLevel": "1",
            "filters": [
              {
                "relationType": "Owns",
                "entityTypes": [
                  "ASSET"
                ]
              }
            ]
          }
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 398,
          "layoutY": 350
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbAssetTypeSwitchNode",
        "name": "Project",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743516302855
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "version": 0
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 399,
          "layoutY": 456
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbDuplicateMsgToRelatedNode",
        "name": "Propage to Measurement",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1741872409365
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "relationsQuery": {
            "fetchLastLevelOnly": false,
            "direction": "FROM",
            "maxLevel": 1,
            "filters": [
              {
                "relationType": "Owns",
                "entityTypes": [
                  "ASSET"
                ]
              }
            ]
          }
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1347,
          "layoutY": 558
        }
      },
      {
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "Save TS Measurement",
        "debugSettings": null,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "defaultTTL": 0,
          "useServerTs": false,
          "processingSettings": {
            "type": "ON_EVERY_MESSAGE"
          }
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1353,
          "layoutY": 684
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbJsSwitchNode",
        "name": "Switch active",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743514944088
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);",
          "tbelScript": "if (metadata.ss_progress === \"active\" || metadata.ss_progress === \"in preparation\") {\n    return [\"api\"];\n} else {\n    return [\"other\"];\n}"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1046,
          "layoutY": 278
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbDuplicateMsgToRelatedNode",
        "name": "Duplicate to Customers",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743515302203
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "relationsQuery": {
            "fetchLastLevelOnly": false,
            "direction": "FROM",
            "maxLevel": "3",
            "filters": [
              {
                "relationType": "Owns",
                "entityTypes": [
                  "CUSTOMER"
                ]
              }
            ]
          }
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 101,
          "layoutY": 446
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbDuplicateMsgToGroupByNameNode",
        "name": "Duplicate To Customers",
        "debugSettings": {
          "failuresEnabled": true,
          "allEnabled": false,
          "allEnabledUntil": 1743516296747
        },
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "searchEntityGroupForTenantOnly": false,
          "considerMessageOriginatorAsAGroupOwner": false,
          "groupType": "CUSTOMER",
          "groupName": "All"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 509,
          "layoutY": 223
        }
      }
    ],
    "connections": [
      {
        "fromIndex": 0,
        "toIndex": 11,
        "type": "Success"
      },
      {
        "fromIndex": 1,
        "toIndex": 2,
        "type": "Success"
      },
      {
        "fromIndex": 2,
        "toIndex": 3,
        "type": "Success"
      },
      {
        "fromIndex": 3,
        "toIndex": 9,
        "type": "Success"
      },
      {
        "fromIndex": 4,
        "toIndex": 0,
        "type": "Success"
      },
      {
        "fromIndex": 7,
        "toIndex": 8,
        "type": "Success"
      },
      {
        "fromIndex": 8,
        "toIndex": 4,
        "type": "Project"
      },
      {
        "fromIndex": 8,
        "toIndex": 4,
        "type": "default"
      },
      {
        "fromIndex": 9,
        "toIndex": 10,
        "type": "Success"
      },
      {
        "fromIndex": 11,
        "toIndex": 1,
        "type": "api"
      },
      {
        "fromIndex": 13,
        "toIndex": 7,
        "type": "Success"
      }
    ],
    "ruleChainConnections": null
  }
}